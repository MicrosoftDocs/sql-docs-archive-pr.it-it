---
title: Analizzare i deadlock con SQL Server Profiler | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: profiler
ms.topic: conceptual
helpviewer_keywords:
- process nodes [SQL Server Profiler]
- Profiler [SQL Server Profiler], deadlocks
- deadlocks [SQL Server], identifying cause
- resource nodes [SQL Server Profiler]
- graphs [SQL Server Profiler]
- SQL Server Profiler, deadlocks
- events [SQL Server], deadlocks
- edges [SQL Server Profiler]
ms.assetid: 72d6718f-501b-4ea6-b344-c0e653f19561
author: stevestein
ms.author: sstein
ms.openlocfilehash: 3414cda74d75dbacf10ed98b6fc6d50da2feaa18
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87711295"
---
# <a name="analyze-deadlocks-with-sql-server-profiler"></a><span data-ttu-id="71338-102">Analizzare deadlock con SQL Server Profiler</span><span class="sxs-lookup"><span data-stu-id="71338-102">Analyze Deadlocks with SQL Server Profiler</span></span>
  <span data-ttu-id="71338-103">[!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] consente di identificare la causa di un deadlock.</span><span class="sxs-lookup"><span data-stu-id="71338-103">Use [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to identify the cause of a deadlock.</span></span> <span data-ttu-id="71338-104">I deadlock si verificano in caso di dipendenza ciclica tra due o più thread o processi per alcuni set di risorse in SQL Server.</span><span class="sxs-lookup"><span data-stu-id="71338-104">A deadlock occurs when there is a cyclic dependency between two or more threads, or processes, for some set of resources within SQL Server.</span></span> <span data-ttu-id="71338-105">Tramite [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)], è possibile creare una traccia che registra, riproduce e visualizza gli eventi deadlock da analizzare.</span><span class="sxs-lookup"><span data-stu-id="71338-105">Using [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)], you can create a trace that records, replays, and displays deadlock events for analysis.</span></span>  
  
 <span data-ttu-id="71338-106">Per tracciare gli eventi deadlock, aggiungere la classe di evento **Deadlock graph** a una traccia.</span><span class="sxs-lookup"><span data-stu-id="71338-106">To trace deadlock events, add the **Deadlock graph** event class to a trace.</span></span> <span data-ttu-id="71338-107">Questa classe di evento consente di popolare la colonna di dati **TextData** nella traccia con dati XML sul processo e gli oggetti coinvolti nel deadlock.</span><span class="sxs-lookup"><span data-stu-id="71338-107">This event class populates the **TextData** data column in the trace with XML data about the process and objects that are involved in the deadlock.</span></span> [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] <span data-ttu-id="71338-108">può estrarre il documento XML in un file XML del deadlock (con estensione xdl) visualizzabile in un secondo momento in SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="71338-108">can extract the XML document to a deadlock XML (.xdl) file which you can view later in SQL Server Management Studio.</span></span> <span data-ttu-id="71338-109">È possibile configurare [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] per estrarre gli eventi **Deadlock graph** in un singolo file contenente tutti gli eventi **Deadlock graph** oppure in file distinti.</span><span class="sxs-lookup"><span data-stu-id="71338-109">You can configure [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to extract **Deadlock graph** events to a single file that contains all **Deadlock graph** events, or to separate files.</span></span> <span data-ttu-id="71338-110">È possibile eseguire l'estrazione in uno dei modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="71338-110">This extraction can be done in any of the following ways:</span></span>  
  
-   <span data-ttu-id="71338-111">Durante la configurazione della traccia, con la scheda **Impostazioni estrazione eventi** . Si noti che questa scheda non viene visualizzata a meno che non si selezioni l'evento **Deadlock graph** nella scheda **Selezione eventi** .</span><span class="sxs-lookup"><span data-stu-id="71338-111">At trace configuration time, using the **Events Extraction Settings** tab. Note that this tab does not appear until you select the **Deadlock graph** event on the **Events Selection** tab.</span></span>  
  
-   <span data-ttu-id="71338-112">Con il comando **Estrai eventi di SQL Server** del menu **File** .</span><span class="sxs-lookup"><span data-stu-id="71338-112">Using the **Extract SQL Server Events** option on the **File** menu.</span></span>  
  
-   <span data-ttu-id="71338-113">Per estrarre e salvare singoli eventi è anche possibile fare clic con il pulsante destro del mouse su un evento specifico e scegliere **Estrai dati eventi**.</span><span class="sxs-lookup"><span data-stu-id="71338-113">Individual events can also be extracted and saved by right-clicking a specific event and choosing **Extract Event Data**.</span></span>  
  
## <a name="deadlock-graphs"></a><span data-ttu-id="71338-114">Grafici di deadlock</span><span class="sxs-lookup"><span data-stu-id="71338-114">Deadlock Graphs</span></span>  
 [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] <span data-ttu-id="71338-115">e [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] usano per descrivere un deadlock un grafico</span><span class="sxs-lookup"><span data-stu-id="71338-115">and [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] use a deadlock wait-for graph to describe a deadlock.</span></span> <span data-ttu-id="71338-116">che contiene i nodi dei processi, i nodi delle risorse e archi che rappresentano le relazioni tra i processi e le risorse.</span><span class="sxs-lookup"><span data-stu-id="71338-116">The deadlock wait-for graph contains process nodes, resource nodes, and edges representing the relationships between the processes and the resources.</span></span> <span data-ttu-id="71338-117">Nella tabella seguente vengono descritti i componenti di questi grafici:</span><span class="sxs-lookup"><span data-stu-id="71338-117">The components of wait-for graphs are defined in the following table:</span></span>  
  
 <span data-ttu-id="71338-118">Nodo di processo</span><span class="sxs-lookup"><span data-stu-id="71338-118">Process node</span></span>  
 <span data-ttu-id="71338-119">Un thread che esegue un'attività, ad esempio INSERT, UPDATE o DELETE.</span><span class="sxs-lookup"><span data-stu-id="71338-119">A thread that performs a task; for example, INSERT, UPDATE, or DELETE.</span></span>  
  
 <span data-ttu-id="71338-120">Nodo di risorsa</span><span class="sxs-lookup"><span data-stu-id="71338-120">Resource node</span></span>  
 <span data-ttu-id="71338-121">Un oggetto di database, ad esempio una tabella, un indice o una riga.</span><span class="sxs-lookup"><span data-stu-id="71338-121">A database object; for example, a table, index, or row.</span></span>  
  
 <span data-ttu-id="71338-122">Microsoft Edge</span><span class="sxs-lookup"><span data-stu-id="71338-122">Edge</span></span>  
 <span data-ttu-id="71338-123">Una relazione tra un processo e una risorsa.</span><span class="sxs-lookup"><span data-stu-id="71338-123">A relationship between a process and a resource.</span></span> <span data-ttu-id="71338-124">Un arco di tipo `request` viene generato quando un processo è in attesa di una risorsa.</span><span class="sxs-lookup"><span data-stu-id="71338-124">A `request` edge occurs when a process waits for a resource.</span></span> <span data-ttu-id="71338-125">Un arco di tipo `owner` viene generato quando una risorsa è in attesa di un processo.</span><span class="sxs-lookup"><span data-stu-id="71338-125">An `owner` edge occurs when a resource waits for a process.</span></span> <span data-ttu-id="71338-126">Nella descrizione dell'arco è inclusa la modalità di blocco,</span><span class="sxs-lookup"><span data-stu-id="71338-126">The lock mode is included in the edge description.</span></span> <span data-ttu-id="71338-127">ad esempio **Modalità: X**.</span><span class="sxs-lookup"><span data-stu-id="71338-127">For example, **Mode: X**.</span></span>  
  
## <a name="deadlock-process-node"></a><span data-ttu-id="71338-128">Nodo di processo del deadlock</span><span class="sxs-lookup"><span data-stu-id="71338-128">Deadlock Process Node</span></span>  
 <span data-ttu-id="71338-129">In questo tipo di grafico, il nodo del processo contiene informazioni sul processo.</span><span class="sxs-lookup"><span data-stu-id="71338-129">In a wait-for graph, the process node contains information about the process.</span></span> <span data-ttu-id="71338-130">Nella tabella seguente vengono illustrati i componenti di un processo.</span><span class="sxs-lookup"><span data-stu-id="71338-130">The following table explains the components of a process.</span></span>  
  
|<span data-ttu-id="71338-131">Componente</span><span class="sxs-lookup"><span data-stu-id="71338-131">Component</span></span>|<span data-ttu-id="71338-132">Definizione</span><span class="sxs-lookup"><span data-stu-id="71338-132">Definition</span></span>|  
|---------------|----------------|  
|<span data-ttu-id="71338-133">ID processo server</span><span class="sxs-lookup"><span data-stu-id="71338-133">Server process Id</span></span>|<span data-ttu-id="71338-134">Identificatore di processo del server (SPID). Identificatore assegnato dal server al processo proprietario del blocco.</span><span class="sxs-lookup"><span data-stu-id="71338-134">Server process identifier (SPID), a server assigned identifier for the process owning the lock.</span></span>|  
|<span data-ttu-id="71338-135">ID batch server</span><span class="sxs-lookup"><span data-stu-id="71338-135">Server batch Id</span></span>|<span data-ttu-id="71338-136">Identificatore del batch server (SBID).</span><span class="sxs-lookup"><span data-stu-id="71338-136">Server batch identifier (SBID).</span></span>|  
|<span data-ttu-id="71338-137">ID contesto esecuzione</span><span class="sxs-lookup"><span data-stu-id="71338-137">Execution context Id</span></span>|<span data-ttu-id="71338-138">Identificatore del contesto di esecuzione (ECID).</span><span class="sxs-lookup"><span data-stu-id="71338-138">Execution context identifier (ECID).</span></span> <span data-ttu-id="71338-139">ID del contesto di esecuzione di un thread specifico associato a un valore SPID specifico.</span><span class="sxs-lookup"><span data-stu-id="71338-139">The execution context ID of a given thread associated with a specific SPID.</span></span><br /><br /> <span data-ttu-id="71338-140">ECID = {0,1,2,3, *...n*}, dove 0 rappresenta sempre il thread principale o padre e {1,2,3, *...n*} rappresenta i thread secondari.</span><span class="sxs-lookup"><span data-stu-id="71338-140">ECID = {0,1,2,3, *...n*}, where 0 always represents the main or parent thread, and {1,2,3, *...n*} represent the subthreads.</span></span>|  
|<span data-ttu-id="71338-141">Priorità deadlock</span><span class="sxs-lookup"><span data-stu-id="71338-141">Deadlock priority</span></span>|<span data-ttu-id="71338-142">Priorità dei deadlock per il processo.</span><span class="sxs-lookup"><span data-stu-id="71338-142">Deadlock priority for the process.</span></span> <span data-ttu-id="71338-143">Per altre informazioni sui possibili valori, vedere [SET DEADLOCK_PRIORITY &#40;Transact-SQL&#41;](/sql/t-sql/statements/set-deadlock-priority-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="71338-143">For more information about possible values, see [SET DEADLOCK_PRIORITY &#40;Transact-SQL&#41;](/sql/t-sql/statements/set-deadlock-priority-transact-sql).</span></span>|  
|<span data-ttu-id="71338-144">Log utilizzato</span><span class="sxs-lookup"><span data-stu-id="71338-144">Log Used</span></span>|<span data-ttu-id="71338-145">Quantità di spazio del log utilizzata dal processo.</span><span class="sxs-lookup"><span data-stu-id="71338-145">Amount of log space used by the process.</span></span>|  
|<span data-ttu-id="71338-146">ID proprietario</span><span class="sxs-lookup"><span data-stu-id="71338-146">Owner Id</span></span>|<span data-ttu-id="71338-147">ID transazione per i processi che utilizzano transazioni e che sono in attesa in un blocco.</span><span class="sxs-lookup"><span data-stu-id="71338-147">Transaction ID for the processes which are using transactions and currently waiting on a lock.</span></span>|  
|<span data-ttu-id="71338-148">Descrittore transazione</span><span class="sxs-lookup"><span data-stu-id="71338-148">Transaction descriptor</span></span>|<span data-ttu-id="71338-149">Puntatore al descrittore della transazione che descrive lo stato della transazione.</span><span class="sxs-lookup"><span data-stu-id="71338-149">Pointer to the transaction descriptor that describes the state of the transaction.</span></span>|  
|<span data-ttu-id="71338-150">Buffer di input</span><span class="sxs-lookup"><span data-stu-id="71338-150">Input buffer</span></span>|<span data-ttu-id="71338-151">Buffer di input del processo corrente. Consente di definire il tipo di evento e l'istruzione eseguita.</span><span class="sxs-lookup"><span data-stu-id="71338-151">Input buffer of the current process, defines the type of event and the statement being executed.</span></span> <span data-ttu-id="71338-152">I valori possibili sono:</span><span class="sxs-lookup"><span data-stu-id="71338-152">Possible values include:</span></span><br /><br /> <span data-ttu-id="71338-153">**Lingua**</span><span class="sxs-lookup"><span data-stu-id="71338-153">**Language**</span></span><br /><br /> <span data-ttu-id="71338-154">**RPC**</span><span class="sxs-lookup"><span data-stu-id="71338-154">**RPC**</span></span><br /><br /> <span data-ttu-id="71338-155">**Nessuno**</span><span class="sxs-lookup"><span data-stu-id="71338-155">**None**</span></span>|  
|<span data-ttu-id="71338-156">.</span><span class="sxs-lookup"><span data-stu-id="71338-156">Statement</span></span>|<span data-ttu-id="71338-157">Tipo di istruzione.</span><span class="sxs-lookup"><span data-stu-id="71338-157">Type of statement.</span></span> <span data-ttu-id="71338-158">I valori possibili sono:</span><span class="sxs-lookup"><span data-stu-id="71338-158">Possible values are:</span></span><br /><br /> <span data-ttu-id="71338-159">**NOP**</span><span class="sxs-lookup"><span data-stu-id="71338-159">**NOP**</span></span><br /><br /> <span data-ttu-id="71338-160">**SELECT**</span><span class="sxs-lookup"><span data-stu-id="71338-160">**SELECT**</span></span><br /><br /> <span data-ttu-id="71338-161">**UPDATE**</span><span class="sxs-lookup"><span data-stu-id="71338-161">**UPDATE**</span></span><br /><br /> <span data-ttu-id="71338-162">**INSERT**</span><span class="sxs-lookup"><span data-stu-id="71338-162">**INSERT**</span></span><br /><br /> <span data-ttu-id="71338-163">**DELETE**</span><span class="sxs-lookup"><span data-stu-id="71338-163">**DELETE**</span></span><br /><br /> <span data-ttu-id="71338-164">**Unknown**</span><span class="sxs-lookup"><span data-stu-id="71338-164">**Unknown**</span></span>|  
  
## <a name="deadlock-resource-node"></a><span data-ttu-id="71338-165">Nodo di risorsa del deadlock</span><span class="sxs-lookup"><span data-stu-id="71338-165">Deadlock Resource Node</span></span>  
 <span data-ttu-id="71338-166">In un deadlock, due processi sono in attesa ognuno di una risorsa mantenuta dall'altro processo.</span><span class="sxs-lookup"><span data-stu-id="71338-166">In a deadlock, two processes are each waiting for a resource held by the other process.</span></span> <span data-ttu-id="71338-167">In un grafico di deadlock, le risorse sono visualizzate come nodi di risorsa.</span><span class="sxs-lookup"><span data-stu-id="71338-167">In a deadlock graph, the resources are displayed as resource nodes.</span></span>  
  
  
