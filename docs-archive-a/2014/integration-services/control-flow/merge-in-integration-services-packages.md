---
title: MERGE nei pacchetti di Integration Services | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- MERGE statement [SQL Server]
ms.assetid: 7e44a5c2-e6d6-4fe2-a079-4f95ccdb147b
author: chugugrace
ms.author: chugu
ms.openlocfilehash: cc6de738d44b91a9e2a4885978ba4a46dfede8cf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87627321"
---
# <a name="merge-in-integration-services-packages"></a><span data-ttu-id="70a62-102">MERGE in Integration Services Packages</span><span class="sxs-lookup"><span data-stu-id="70a62-102">MERGE in Integration Services Packages</span></span>
  <span data-ttu-id="70a62-103">Nella versione corrente di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]l'istruzione SQL in un'attività Esegui SQL può contenere un'istruzione MERGE.</span><span class="sxs-lookup"><span data-stu-id="70a62-103">In the current release of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], the SQL statement in an Execute SQL task can contain a MERGE statement.</span></span> <span data-ttu-id="70a62-104">che consente di eseguire più operazioni INSERT, UPDATE e DELETE in una singola istruzione.</span><span class="sxs-lookup"><span data-stu-id="70a62-104">This MERGE statement enables you to accomplish multiple INSERT, UPDATE, and DELETE operations in a single statement.</span></span>  
  
 <span data-ttu-id="70a62-105">Per utilizzare l'istruzione MERGE in un pacchetto, effettuare le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="70a62-105">To use the MERGE statement in a package, follow these steps:</span></span>  
  
-   <span data-ttu-id="70a62-106">Creare un'attività Flusso di dati per caricare, trasformare e salvare l'origine dati in una tabella temporanea o di staging.</span><span class="sxs-lookup"><span data-stu-id="70a62-106">Create a Data Flow task that loads, transforms, and saves the source data to a temporary or staging table.</span></span>  
  
-   <span data-ttu-id="70a62-107">Creare un'attività Esegui SQL contenente l'istruzione MERGE.</span><span class="sxs-lookup"><span data-stu-id="70a62-107">Create an Execute SQL task that contains the MERGE statement.</span></span>  
  
-   <span data-ttu-id="70a62-108">Connettere l'attività Flusso di dati all'attività Esegui SQL e utilizzare i dati della tabella di staging come input per l'istruzione MERGE.</span><span class="sxs-lookup"><span data-stu-id="70a62-108">Connect the Data Flow task to the Execute SQL task, and use the data in the staging table as the input for the MERGE statement.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="70a62-109">Anche se un'istruzione MERGE richiede in genere una tabella di staging in questo scenario, le prestazioni dell'istruzione MERGE sono solitamente superiori a quelle della ricerca riga per riga eseguita con la trasformazione Ricerca.</span><span class="sxs-lookup"><span data-stu-id="70a62-109">Although a MERGE statement typically requires a staging table in this scenario, the performance of the MERGE statement usually exceeds that of the row-by-row lookup performed by the Lookup transformation.</span></span> <span data-ttu-id="70a62-110">MERGE risulta utile anche quando, a causa delle dimensioni elevate di una tabella di ricerca, viene verificata la memoria a disposizione della trasformazione Ricerca per la memorizzazione nella cache della relativa tabella di riferimento.</span><span class="sxs-lookup"><span data-stu-id="70a62-110">MERGE is also useful when the large size of a lookup table would test the memory that is available to the Lookup transformation for caching its reference table.</span></span>  
  
 <span data-ttu-id="70a62-111">Nelle altre sezioni di questo argomento vengono descritti alcuni utilizzi aggiuntivi dell'istruzione MERGE.</span><span class="sxs-lookup"><span data-stu-id="70a62-111">The remainder of this topic discusses some additional uses for the MERGE statement.</span></span>  
  
 <span data-ttu-id="70a62-112">Per un componente di destinazione di esempio che supporta l'utilizzo dell'istruzione MERGE, vedere l'esempio nella community CodePlex relativo alla [destinazione MERGE](https://go.microsoft.com/fwlink/?LinkId=141215).</span><span class="sxs-lookup"><span data-stu-id="70a62-112">For a sample destination component that supports the use of the MERGE statement, see the CodePlex community sample, [MERGE Destination](https://go.microsoft.com/fwlink/?LinkId=141215).</span></span>  
  
## <a name="using-merge"></a><span data-ttu-id="70a62-113">Utilizzo di MERGE</span><span class="sxs-lookup"><span data-stu-id="70a62-113">Using MERGE</span></span>  
 <span data-ttu-id="70a62-114">In genere, si utilizza l'istruzione MERGE quando si desidera applicare modifiche quali inserimenti, aggiornamenti ed eliminazioni da una tabella a un'altra.</span><span class="sxs-lookup"><span data-stu-id="70a62-114">Typically, you use the MERGE statement when you want to apply changes that include inserts, updates, and deletions from one table to another table.</span></span> <span data-ttu-id="70a62-115">Prima di [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], per eseguire questo processo erano necessarie una trasformazione Ricerca e più trasformazioni Comando OLE DB.</span><span class="sxs-lookup"><span data-stu-id="70a62-115">Prior to [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], this process required both a Lookup transformation and multiple OLE DB Command transformations.</span></span> <span data-ttu-id="70a62-116">Con la trasformazione Ricerca veniva eseguita una ricerca riga per riga per determinare se ogni riga era nuova o era stata modificata.</span><span class="sxs-lookup"><span data-stu-id="70a62-116">The Lookup transformation performed a row-by-row lookup to determine whether each row was new or changed.</span></span> <span data-ttu-id="70a62-117">Con la trasformazione Comando OLE DB venivano quindi eseguite tutte le necessarie operazioni INSERT, UPDATE e DELETE.</span><span class="sxs-lookup"><span data-stu-id="70a62-117">The OLE DB Command transformations then performed the necessary INSERT, UPDATE, and DELETE operations.</span></span> <span data-ttu-id="70a62-118">A partire da [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)]una singola istruzione MERGE può sostituire sia la trasformazione Ricerca sia le trasformazioni Comando OLE DB corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="70a62-118">Beginning in [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], a single MERGE statement can replace both the Lookup transformation and the corresponding OLE DB Command transformations.</span></span>  
  
### <a name="merge-with-incremental-loads"></a><span data-ttu-id="70a62-119">MERGE con caricamenti incrementali</span><span class="sxs-lookup"><span data-stu-id="70a62-119">MERGE with Incremental Loads</span></span>  
 <span data-ttu-id="70a62-120">La funzionalità Change Data Capture, una novità di [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] , rende più affidabile l'esecuzione di caricamenti incrementali in un data warehouse.</span><span class="sxs-lookup"><span data-stu-id="70a62-120">The change data capture functionality that is new in [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] makes it easier to perform incremental loads reliably to a data warehouse.</span></span> <span data-ttu-id="70a62-121">Come alternativa all'utilizzo di trasformazioni Comando OLE DB con parametri per l'esecuzione di inserimenti e aggiornamenti, è possibile utilizzare l'istruzione MERGE per combinare le due operazioni.</span><span class="sxs-lookup"><span data-stu-id="70a62-121">As an alternative to using parameterized OLE DB Command transformations to perform the inserts and the updates, you can use the MERGE statement to combine both operations.</span></span>  
  
 <span data-ttu-id="70a62-122">Per altre informazioni, vedere [Applicazione delle modifiche alla destinazione](../change-data-capture/apply-the-changes-to-the-destination.md).</span><span class="sxs-lookup"><span data-stu-id="70a62-122">For more information, see [Apply the Changes to the Destination](../change-data-capture/apply-the-changes-to-the-destination.md).</span></span>  
  
#### <a name="merge-in-other-scenarios"></a><span data-ttu-id="70a62-123">MERGE in altri scenari</span><span class="sxs-lookup"><span data-stu-id="70a62-123">MERGE in Other Scenarios</span></span>  
 <span data-ttu-id="70a62-124">Negli scenari seguenti è possibile utilizzare l'istruzione MERGE all'esterno o all'interno di un pacchetto di [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="70a62-124">In the following scenarios, you can use the MERGE statement either outside or inside an [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] package.</span></span> <span data-ttu-id="70a62-125">Un pacchetto di [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , tuttavia, è spesso richiesto per caricare questi dati da più origini eterogenee e quindi per combinare e pulire i dati.</span><span class="sxs-lookup"><span data-stu-id="70a62-125">However, an [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] package is often required to load this data from multiple heterogeneous sources, and then to combine and cleanse the data.</span></span> <span data-ttu-id="70a62-126">Pertanto, valutare la possibilità di utilizzare l'istruzione MERGE in un pacchetto per praticità e facilità di manutenzione.</span><span class="sxs-lookup"><span data-stu-id="70a62-126">Therefore, you might consider using the MERGE statement in a package for convenience and ease of maintenance.</span></span>  
  
##### <a name="track-buying-habits"></a><span data-ttu-id="70a62-127">Rilevare le abitudini di acquisto</span><span class="sxs-lookup"><span data-stu-id="70a62-127">Track Buying Habits</span></span>  
 <span data-ttu-id="70a62-128">Nella tabella FactBuyingHabits del data warehouse viene rilevata l'ultima data in cui un cliente ha acquistato un determinato prodotto.</span><span class="sxs-lookup"><span data-stu-id="70a62-128">The FactBuyingHabits table in the data warehouse tracks the last date on which a customer bought a given product.</span></span> <span data-ttu-id="70a62-129">La tabella è costituita dalle colonne ProductID, CustomerID e PurchaseDate.</span><span class="sxs-lookup"><span data-stu-id="70a62-129">The table consists of ProductID, CustomerID and PurchaseDate columns.</span></span> <span data-ttu-id="70a62-130">Ogni settimana, il database transazionale genera una tabella PurchaseRecords che include gli acquisti eseguiti durante tale settimana.</span><span class="sxs-lookup"><span data-stu-id="70a62-130">Every week, the transactional database generates a PurchaseRecords table that includes the purchases made during that week.</span></span> <span data-ttu-id="70a62-131">L'obiettivo è quello di utilizzare una singola istruzione MERGE per unire le informazioni della tabella PurchaseRecords nella tabella FactBuyingHabits.</span><span class="sxs-lookup"><span data-stu-id="70a62-131">The objective is to use a single MERGE statement to merge the information in the PurchaseRecords table into the FactBuyingHabits table.</span></span> <span data-ttu-id="70a62-132">Per le coppie prodotto-cliente che non esistono, l'istruzione MERGE inserisce nuove righe.</span><span class="sxs-lookup"><span data-stu-id="70a62-132">For product-customer pairs that do not exist, the MERGE statement inserts new rows.</span></span> <span data-ttu-id="70a62-133">Per le coppie prodotto-cliente che esistono, l'istruzione MERGE aggiorna la data di acquisto più recente.</span><span class="sxs-lookup"><span data-stu-id="70a62-133">For product-customer pairs that exist, the MERGE statement updates the most recent date-of-purchase.</span></span>  
  
###### <a name="track-price-history"></a><span data-ttu-id="70a62-134">Rilevare la cronologia dei prezzi</span><span class="sxs-lookup"><span data-stu-id="70a62-134">Track Price History</span></span>  
 <span data-ttu-id="70a62-135">La tabella DimBook rappresenta l'elenco di libri nell'inventario di un libraio e identifica la cronologia dei prezzi di ogni libro.</span><span class="sxs-lookup"><span data-stu-id="70a62-135">The DimBook table represents the list of books in the inventory of a book seller and identifies the price history of each book.</span></span> <span data-ttu-id="70a62-136">La tabella contiene le colonne ISBN, ProductID, Price, Shelf e IsCurrent.</span><span class="sxs-lookup"><span data-stu-id="70a62-136">This table has these columns: ISBN, ProductID, Price, Shelf, and IsCurrent.</span></span> <span data-ttu-id="70a62-137">Include inoltre un'unica riga per ogni prezzo assegnato al libro.</span><span class="sxs-lookup"><span data-stu-id="70a62-137">This table also has one row for each price the book has had.</span></span> <span data-ttu-id="70a62-138">Una di queste righe contiene il prezzo corrente.</span><span class="sxs-lookup"><span data-stu-id="70a62-138">One of these rows contains the current price.</span></span> <span data-ttu-id="70a62-139">Per indicare quale riga contiene il prezzo corrente, il valore della colonna IsCurrent per tale riga è impostato su 1.</span><span class="sxs-lookup"><span data-stu-id="70a62-139">To indicate which row contains the current price, the value of the IsCurrent column for that row is set to 1.</span></span>  
  
 <span data-ttu-id="70a62-140">Ogni settimana, il database genera una tabella WeeklyChanges che contiene le modifiche di prezzo e i nuovi libri aggiunti durante la settimana.</span><span class="sxs-lookup"><span data-stu-id="70a62-140">Every week, the database generates a WeeklyChanges table that contains price changes for the week and new books that were added during the week.</span></span> <span data-ttu-id="70a62-141">Utilizzando una singola istruzione MERGE, è possibile applicare le modifiche della tabella WeeklyChanges alla tabella DimBook.</span><span class="sxs-lookup"><span data-stu-id="70a62-141">By using a single MERGE statement, you can apply the changes in the WeeklyChanges table to the DimBook table.</span></span> <span data-ttu-id="70a62-142">L'istruzione MERGE inserisce nuove righe per i libri appena aggiunti e imposta la colonna IsCurrent su 0 per le righe di libri esistenti il cui prezzo è stato modificato.</span><span class="sxs-lookup"><span data-stu-id="70a62-142">The MERGE statement inserts new rows for newly-added books, and updates the IsCurrent column to 0 for rows of existing books whose prices have changed.</span></span> <span data-ttu-id="70a62-143">Inserisce inoltre nuove righe per i libri il cui prezzo è stato modificato e, per queste nuove righe, imposta il valore della colonna IsCurrent su 1.</span><span class="sxs-lookup"><span data-stu-id="70a62-143">The MERGE statement also inserts new rows for books whose prices have changed, and for these new rows, sets the value of the IsCurrent column to 1.</span></span>  
  
### <a name="merge-a-table-with-new-data-against-the-old-table"></a><span data-ttu-id="70a62-144">Unire una tabella contenente nuovi dati con la tabella precedente</span><span class="sxs-lookup"><span data-stu-id="70a62-144">Merge a Table with New Data Against the Old Table</span></span>  
 <span data-ttu-id="70a62-145">Il database modella le proprietà di un oggetto usando uno "schema aperto", ovvero una tabella contiene coppie nome-valore per ogni proprietà.</span><span class="sxs-lookup"><span data-stu-id="70a62-145">The database models the properties of an object by using an "open schema," that is, a table contains name-value pairs for each property.</span></span> <span data-ttu-id="70a62-146">La tabella Properties contiene tre colonne: EntityID, PropertyID e Value.</span><span class="sxs-lookup"><span data-stu-id="70a62-146">The Properties table has three columns: EntityID, PropertyID, and Value.</span></span> <span data-ttu-id="70a62-147">È necessario sincronizzare una versione più recente della tabella, denominata NewProperties, con la tabella Properties.</span><span class="sxs-lookup"><span data-stu-id="70a62-147">A NewProperties table that is a newer version of the table has to be synchronized with the Properties table.</span></span> <span data-ttu-id="70a62-148">A tale scopo, è possibile utilizzare una singola istruzione MERGE per effettuare le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="70a62-148">To synchronize these two tables, you can use a single MERGE statement to perform the following operations:</span></span>  
  
-   <span data-ttu-id="70a62-149">Eliminare proprietà dalla tabella Properties se non si trovano nella tabella NewProperties.</span><span class="sxs-lookup"><span data-stu-id="70a62-149">Delete properties from the Properties table if they are absent from the NewProperties table.</span></span>  
  
-   <span data-ttu-id="70a62-150">Aggiornare i valori per le proprietà presenti nella tabella Properties con i nuovi valori della tabella NewProperties.</span><span class="sxs-lookup"><span data-stu-id="70a62-150">Update values for properties that are in the Properties table with new values found in the NewProperties table.</span></span>  
  
-   <span data-ttu-id="70a62-151">Inserire nuove proprietà per le proprietà presenti nella tabella NewProperties ma che non si trovano nella tabella Properties.</span><span class="sxs-lookup"><span data-stu-id="70a62-151">Insert new properties for properties that are in the NewProperties table but are not found in the Properties table.</span></span>  
  
 <span data-ttu-id="70a62-152">Questo approccio risulta utile negli scenari simili agli scenari di replica, in cui l'obiettivo è quello di mantenere sincronizzati i dati di due tabelle in due server.</span><span class="sxs-lookup"><span data-stu-id="70a62-152">This approach is useful in scenarios that resemble replication scenarios, where the objective is to keep data in two tables on two servers synchronized.</span></span>  
  
### <a name="track-inventory"></a><span data-ttu-id="70a62-153">Tenere traccia dell'inventario</span><span class="sxs-lookup"><span data-stu-id="70a62-153">Track Inventory</span></span>  
 <span data-ttu-id="70a62-154">Il database Inventory contiene una tabella ProductsInventory con le colonne ProductID e StockOnHand.</span><span class="sxs-lookup"><span data-stu-id="70a62-154">The Inventory database has a ProductsInventory table that has ProductID and StockOnHand columns.</span></span> <span data-ttu-id="70a62-155">In una tabella Shipments con le colonne ProductID, CustomerID e Quantity vengono rilevate le spedizioni di prodotti ai clienti.</span><span class="sxs-lookup"><span data-stu-id="70a62-155">A Shipments table with ProductID, CustomerID, and Quantity columns tracks shipments of products to customers.</span></span> <span data-ttu-id="70a62-156">La tabella ProductInventory deve essere aggiornata ogni giorno in base alle informazioni presenti nella tabella Shipments.</span><span class="sxs-lookup"><span data-stu-id="70a62-156">The ProductInventory table has to be updated daily based on information in the Shipments table.</span></span> <span data-ttu-id="70a62-157">Con una singola istruzione MERGE è possibile ridurre l'inventario nella tabella ProductInventory in base alle spedizioni effettuate.</span><span class="sxs-lookup"><span data-stu-id="70a62-157">A single MERGE statement can reduce the inventory in the ProductInventory table based on the shipments made.</span></span> <span data-ttu-id="70a62-158">Se l'inventario per un prodotto è stato ridotto a 0, con l'istruzione MERGE è possibile eliminare anche la riga di tale prodotto dalla tabella ProductInventory.</span><span class="sxs-lookup"><span data-stu-id="70a62-158">If the inventory for a product has been reduced to 0, that MERGE statement can also delete that product row from the ProductInventory table.</span></span>  
  
  
