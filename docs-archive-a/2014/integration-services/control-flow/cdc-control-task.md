---
title: Attività di controllo CDC | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.ssis.designer.cdccontroltask.f1
ms.assetid: 6404dc7f-550c-47cc-b901-c072742f430a
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 36f98a02842353fd5196432738f4ebd8b2efb46c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87627943"
---
# <a name="cdc-control-task"></a><span data-ttu-id="a6261-102">Attività di controllo CDC</span><span class="sxs-lookup"><span data-stu-id="a6261-102">CDC Control Task</span></span>
  <span data-ttu-id="a6261-103">L'attività di controllo CDC viene utilizzata per controllare il ciclo di vita di pacchetti Change Data Capture (CDC).</span><span class="sxs-lookup"><span data-stu-id="a6261-103">The CDC Control task is used to control the life cycle of change data capture (CDC) packages.</span></span> <span data-ttu-id="a6261-104">Questa attività consente di gestire la sincronizzazione del pacchetto CDC con il pacchetto di caricamento iniziale e la gestione di intervalli di numeri di sequenza del file di log (LSN) elaborati in un'esecuzione di un pacchetto CDC.</span><span class="sxs-lookup"><span data-stu-id="a6261-104">It handles CDC package synchronization with the initial load package, the management of Log Sequence Number (LSN) ranges that are processed in a run of a CDC package.</span></span> <span data-ttu-id="a6261-105">L'attività di controllo CDC, inoltre, consente di gestire gli scenari di errore e il recupero da errori.</span><span class="sxs-lookup"><span data-stu-id="a6261-105">In addition, the CDC Control task deals with error scenarios and recovery.</span></span>  
  
 <span data-ttu-id="a6261-106">L'attività di controllo CDC consente di gestire lo stato del pacchetto CDC in una variabile del pacchetto SSIS e di renderlo persistente in una tabella di database, in modo che lo stato venga mantenuto tra attivazioni del pacchetto e tra più pacchetti che eseguono insieme un processo CDC comune. Un'attività, ad esempio, può essere responsabile del caricamento iniziale e l'altra degli aggiornamenti trickle-feed.</span><span class="sxs-lookup"><span data-stu-id="a6261-106">The CDC Control task maintains the state of the CDC package in an SSIS package variable and it can also persist it in a database table so that the state is maintained across package activations and between multiple packages that together perform a common CDC process (for example, one task may be responsible for the initial loading and the other for the trickle-feed updates).</span></span>  
  
 <span data-ttu-id="a6261-107">L'attività di controllo CDC supporta due gruppi di operazioni.</span><span class="sxs-lookup"><span data-stu-id="a6261-107">The CDC Control task supports two groups of operations.</span></span> <span data-ttu-id="a6261-108">Mediante un gruppo viene gestita la sincronizzazione del caricamento iniziale e dell'elaborazione delle modifiche; mediante l'altro gruppo viene gestito l'intervallo di elaborazione delle modifiche degli LSN per un'esecuzione di un pacchetto CDC e di tenere traccia degli elementi elaborati correttamente.</span><span class="sxs-lookup"><span data-stu-id="a6261-108">One group handles the synchronization of initial load and change processing, and the other manages the change-processing range of LSNs for a run of a CDC package and keeps track of what was processed successfully.</span></span>  
  
 <span data-ttu-id="a6261-109">Nelle operazioni seguenti viene gestita la sincronizzazione del caricamento iniziale e dell'elaborazione delle modifiche:</span><span class="sxs-lookup"><span data-stu-id="a6261-109">The following operations handle the synchronization of initial load and change processing:</span></span>  
  
|<span data-ttu-id="a6261-110">Operazione</span><span class="sxs-lookup"><span data-stu-id="a6261-110">Operation</span></span>|<span data-ttu-id="a6261-111">Descrizione</span><span class="sxs-lookup"><span data-stu-id="a6261-111">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="a6261-112">ResetCdcState</span><span class="sxs-lookup"><span data-stu-id="a6261-112">ResetCdcState</span></span>|<span data-ttu-id="a6261-113">Questa operazione viene utilizzata per reimpostare lo stato CDC persistente associato al contesto CDC corrente.</span><span class="sxs-lookup"><span data-stu-id="a6261-113">This operation is used to reset the persistent CDC state associated with the current CDC context.</span></span> <span data-ttu-id="a6261-114">Dopo l'esecuzione di questa operazione, l'LSN massimo corrente della tabella LSN-timestamp `sys.fn_cdc_get_max_lsn` diventa l'inizio dell'intervallo di elaborazione successivo.</span><span class="sxs-lookup"><span data-stu-id="a6261-114">After this operation is run, the current maximum LSN from the LSN-timestamp `sys.fn_cdc_get_max_lsn` table becomes the start of the range for the next processing range.</span></span> <span data-ttu-id="a6261-115">Per questa operazione è necessaria una connessione al database di origine.</span><span class="sxs-lookup"><span data-stu-id="a6261-115">This operation requires a connection to the source database.</span></span>|  
|<span data-ttu-id="a6261-116">MarkInitialLoadStart</span><span class="sxs-lookup"><span data-stu-id="a6261-116">MarkInitialLoadStart</span></span>|<span data-ttu-id="a6261-117">Questa operazione viene utilizzata all'inizio di un pacchetto di caricamento iniziale per registrare l'LSN corrente nel database di origine prima che tramite il pacchetto di caricamento iniziale venga avviata la lettura delle tabelle di origine.</span><span class="sxs-lookup"><span data-stu-id="a6261-117">This operation is used at the beginning of an initial-load package to record the current LSN in the source database before the initial-load package starts reading the source tables.</span></span> <span data-ttu-id="a6261-118">Per questa operazione è necessaria una connessione al database di origine per chiamare `sys.fn_cdc_get_max_lsn`.</span><span class="sxs-lookup"><span data-stu-id="a6261-118">This requires a connection to the source database to call `sys.fn_cdc_get_max_lsn`.</span></span><br /><br /> <span data-ttu-id="a6261-119">Se si seleziona MarkInitialLoadStart quando si usa CDC di [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] , ovvero non di Oracle, l'utente specificato nella gestione connessione deve essere db_owner o sysadmin.</span><span class="sxs-lookup"><span data-stu-id="a6261-119">If you select MarkInitialLoadStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is, not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="a6261-120">MarkInitialLoadEnd</span><span class="sxs-lookup"><span data-stu-id="a6261-120">MarkInitialLoadEnd</span></span>|<span data-ttu-id="a6261-121">Questa operazione viene utilizzata alla fine di un pacchetto di caricamento iniziale per registrare l'LSN corrente nel database di origine dopo che il pacchetto di caricamento iniziale completa la lettura delle tabelle di origine.</span><span class="sxs-lookup"><span data-stu-id="a6261-121">This operation is used at the end of an initial-load package to record the current LSN in the source database after the initial-load package finished reading the source tables.</span></span> <span data-ttu-id="a6261-122">Questo LSN viene determinato registrando la data e l'ora correnti in cui si è verificata l'operazione ed eseguendo quindi una query sulla tabella di mapping `cdc.lsn_time_`nel database CDC per trovare una modifica successiva alla data e all'ora.</span><span class="sxs-lookup"><span data-stu-id="a6261-122">This LSN is determined by recording the current time when this operation occurred and then querying the `cdc.lsn_time_`mapping table in the CDC database looking for a change that occurred after that time.</span></span><br /><br /> <span data-ttu-id="a6261-123">Se si seleziona MarkInitialLoadEnd quando si usa CDC di [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] , ovvero non di Oracle, l'utente specificato nella gestione connessione deve essere db_owner o sysadmin.</span><span class="sxs-lookup"><span data-stu-id="a6261-123">If you select MarkInitialLoadEnd when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="a6261-124">MarkCdcStart</span><span class="sxs-lookup"><span data-stu-id="a6261-124">MarkCdcStart</span></span>|<span data-ttu-id="a6261-125">Questa operazione viene utilizzata quando il caricamento iniziale viene eseguito da un database snapshot.</span><span class="sxs-lookup"><span data-stu-id="a6261-125">This operation is used when then the initial load is made from a snapshot database.</span></span> <span data-ttu-id="a6261-126">In questo caso, l'elaborazione delle modifiche deve iniziare immediatamente dopo l'LSN dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="a6261-126">In this case, the change processing should start immediately after the snapshot LSN.</span></span> <span data-ttu-id="a6261-127">È possibile specificare il nome del database snapshot da utilizzare e l'attività di controllo CDC esegue una query su [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] per trovare l'LSN dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="a6261-127">You can specify the name of the snapshot database to use and the CDC Control task queries [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] for the snapshot LSN.</span></span> <span data-ttu-id="a6261-128">È inoltre possibile scegliere di specificare direttamente l'LSN dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="a6261-128">You also have the option to directly specify the snapshot LSN.</span></span><br /><br /> <span data-ttu-id="a6261-129">Se si seleziona MarkCdcStart quando si usa CDC di [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] , ovvero non di Oracle, l'utente specificato nella gestione connessione deve essere db_owner o sysadmin.</span><span class="sxs-lookup"><span data-stu-id="a6261-129">If you select MarkCdcStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
  
 <span data-ttu-id="a6261-130">Le operazioni seguenti vengono utilizzate per gestire l'intervallo di elaborazione:</span><span class="sxs-lookup"><span data-stu-id="a6261-130">The following operations are used to manage the processing range:</span></span>  
  
|<span data-ttu-id="a6261-131">Operazione</span><span class="sxs-lookup"><span data-stu-id="a6261-131">Operation</span></span>|<span data-ttu-id="a6261-132">Descrizione</span><span class="sxs-lookup"><span data-stu-id="a6261-132">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="a6261-133">GetProcessingRange</span><span class="sxs-lookup"><span data-stu-id="a6261-133">GetProcessingRange</span></span>|<span data-ttu-id="a6261-134">Questa operazione viene utilizzata prima di richiamare il flusso di dati che utilizza il flusso di dati dell'origine CDC.</span><span class="sxs-lookup"><span data-stu-id="a6261-134">This operation is used before invoking the data flow that uses the CDC Source data flow.</span></span> <span data-ttu-id="a6261-135">L'operazione consente di stabilire un intervallo di LSN letti dal flusso di dati dell'origine CDC quando il flusso di dati viene richiamato.</span><span class="sxs-lookup"><span data-stu-id="a6261-135">It establishes a range of LSNs that the CDC Source data flow reads when invoked.</span></span> <span data-ttu-id="a6261-136">L'intervallo viene archiviato in una variabile del pacchetto SSIS utilizzata dall'origine CDC durante l'elaborazione del flusso di dati.</span><span class="sxs-lookup"><span data-stu-id="a6261-136">The range is stored in an SSIS package variable that is used by the CDC Source during data-flow processing.</span></span><br /><br /> <span data-ttu-id="a6261-137">Per altre informazioni sugli stati che vengono archiviati, vedere [Definire una variabile di stato](../data-flow/define-a-state-variable.md).</span><span class="sxs-lookup"><span data-stu-id="a6261-137">For more information about the states that are stored, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>|  
|<span data-ttu-id="a6261-138">MarkProcessedRange</span><span class="sxs-lookup"><span data-stu-id="a6261-138">MarkProcessedRange</span></span>|<span data-ttu-id="a6261-139">Questa operazione avviene dopo ogni esecuzione CDC (una volta completato il flusso di dati CDC) per registrare l'ultimo LSN elaborato completamente nell'esecuzione CDC.</span><span class="sxs-lookup"><span data-stu-id="a6261-139">: This operation is executed after each CDC run (after the CDC data flow is completed successfully) to record the last LSN that was fully processed in the CDC run.</span></span> <span data-ttu-id="a6261-140">Alla successiva esecuzione di GetProcessingRange, questa posizione corrisponde all'inizio dell'intervallo di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="a6261-140">The next time GetProcessingRange is executed, this position is the start of the processing range.</span></span>|  
  
## <a name="handling-cdc-state-persistency"></a><span data-ttu-id="a6261-141">Gestione della persistenza dello stato CDC</span><span class="sxs-lookup"><span data-stu-id="a6261-141">Handling CDC State Persistency</span></span>  
 <span data-ttu-id="a6261-142">L'attività di controllo CDC consente di gestire uno stato persistente tra attivazioni.</span><span class="sxs-lookup"><span data-stu-id="a6261-142">The CDC Control task maintains a persistent state between activations.</span></span> <span data-ttu-id="a6261-143">Le informazioni archiviate nello stato CDC vengono utilizzate per determinare e gestire l'intervallo di elaborazione per il pacchetto CDC e per il rilevamento di eventuali condizioni di errore.</span><span class="sxs-lookup"><span data-stu-id="a6261-143">The information stored in the CDC state is used to determine and maintain the processing range for the CDC package and for detecting error conditions.</span></span> <span data-ttu-id="a6261-144">Lo stato persistente viene archiviato come stringa.</span><span class="sxs-lookup"><span data-stu-id="a6261-144">The persistent state is stored as a string.</span></span> <span data-ttu-id="a6261-145">Per altre informazioni, vedere [Definire una variabile di stato](../data-flow/define-a-state-variable.md).</span><span class="sxs-lookup"><span data-stu-id="a6261-145">For more information, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>  
  
 <span data-ttu-id="a6261-146">L'attività di controllo CDC supporta due tipi di persistenza dello stato</span><span class="sxs-lookup"><span data-stu-id="a6261-146">The CDC Control task supports two types of state persistency</span></span>  
  
-   <span data-ttu-id="a6261-147">Persistenza dello stato manuale: in questo caso, l'attività di controllo CDC gestisce lo stato archiviato in una variabile del pacchetto, ma lo sviluppatore del pacchetto deve leggere la variabile da un archivio persistente prima di chiamare il controllo CDC e quindi riscriverla nell'archivio persistente dopo l'ultima chiamata del controllo CDC e il completamento dell'esecuzione CDC.</span><span class="sxs-lookup"><span data-stu-id="a6261-147">Manual State Persistency: In this case, the CDC Control task manages the state stored in a package variable but the package developer must read the variable from a persistent store before calling the CDC Control and then write it back to that persistent store after the CDC Control is last called and the CDC run completes.</span></span>  
  
-   <span data-ttu-id="a6261-148">Persistenza dello stato automatica: lo stato CDC viene archiviato in una tabella di un database.</span><span class="sxs-lookup"><span data-stu-id="a6261-148">Automatic State Persistency: The CDC state is stored in a table in a database.</span></span> <span data-ttu-id="a6261-149">Lo stato viene archiviato con un nome specificato nella proprietà **StateName** in una tabella denominata nella proprietà **Table to Use for Storing State** , inclusa in una gestione connessione selezionata per l'archiviazione dello stato.</span><span class="sxs-lookup"><span data-stu-id="a6261-149">The state is stored under a name provided in the **StateName** property in a table named in the **Table to Use for Storing State** property, which is located in a selected connection manager for storing the state.</span></span> <span data-ttu-id="a6261-150">Il valore predefinito è la gestione connessione di origine, ma secondo la pratica comune è consigliabile impostare il valore sulla gestione connessione di destinazione.</span><span class="sxs-lookup"><span data-stu-id="a6261-150">The default is the source connection manager but the common practice is for it to be the target connection manager.</span></span> <span data-ttu-id="a6261-151">Tramite l'attività di controllo CDC viene aggiornato il valore di stato nella tabella di stato e viene eseguito il commit di tale valore come parte della transazione di ambiente.</span><span class="sxs-lookup"><span data-stu-id="a6261-151">The CDC Control task updates the state value in the state table and this is committed as part of the ambient transaction.</span></span>  
  
## <a name="error-handling"></a><span data-ttu-id="a6261-152">Gestione degli errori</span><span class="sxs-lookup"><span data-stu-id="a6261-152">Error Handling</span></span>  
 <span data-ttu-id="a6261-153">È possibile che l'attività di controllo CDC restituisca un errore nei casi seguenti:</span><span class="sxs-lookup"><span data-stu-id="a6261-153">The CDC Control task may report an error when:</span></span>  
  
-   <span data-ttu-id="a6261-154">Non è possibile leggere lo stato CDC persistente o l'aggiornamento dello stato persistente non riesce.</span><span class="sxs-lookup"><span data-stu-id="a6261-154">It fails to read the persistent CDC state or when updating the persistent state fails.</span></span>  
  
-   <span data-ttu-id="a6261-155">Non è possibile leggere le informazioni LSN correnti dal database di origine.</span><span class="sxs-lookup"><span data-stu-id="a6261-155">It fails to read the current LSN information from the source database.</span></span>  
  
-   <span data-ttu-id="a6261-156">Lo stato CDC letto non è coerente.</span><span class="sxs-lookup"><span data-stu-id="a6261-156">The CDC state read is not consistent.</span></span>  
  
 <span data-ttu-id="a6261-157">In tutti questi casi, l'attività di controllo CDC restituisce un errore che può essere gestito tramite la modalità standard di gestione degli errori del flusso di controllo in SSIS.</span><span class="sxs-lookup"><span data-stu-id="a6261-157">In all of these cases, the CDC Control task reports an error that can be handled in the standard way SSIS handles control-flow errors.</span></span>  
  
 <span data-ttu-id="a6261-158">L'attività di controllo CDC può inoltre restituire un avviso quando l'operazione GetProcessingRange viene richiamata direttamente dopo un'altra operazione GetProcessingRange senza che venga chiamata l'operazione MarkProcessedRange.</span><span class="sxs-lookup"><span data-stu-id="a6261-158">The CDC Control task may also report a warning when the Get Processing Range operation is invoked directly after another Get Processing Range operation without Mark Processed Range being called.</span></span> <span data-ttu-id="a6261-159">Ciò indica che l'esecuzione precedente non è riuscita o che è possibile che un altro pacchetto CDC con lo stesso nome di stato CDC sia in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="a6261-159">This is an indication that the previous run failed or that another CDC package may be running using the same CDC state name.</span></span>  
  
## <a name="configuring-the-cdc-control-task"></a><span data-ttu-id="a6261-160">Configurazione dell'attività di controllo CDC</span><span class="sxs-lookup"><span data-stu-id="a6261-160">Configuring the CDC Control Task</span></span>  
 <span data-ttu-id="a6261-161">È possibile impostare le proprietà tramite Progettazione SSIS o a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="a6261-161">You can set properties through SSIS Designer or programmatically.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="a6261-162">Contenuto della sezione</span><span class="sxs-lookup"><span data-stu-id="a6261-162">In This Section</span></span>  
  
-   [<span data-ttu-id="a6261-163">Editor dell'attività di controllo CDC</span><span class="sxs-lookup"><span data-stu-id="a6261-163">CDC Control Task Editor</span></span>](../cdc-control-task-editor.md)  
  
-   [<span data-ttu-id="a6261-164">Proprietà personalizzate dell'attività di controllo CDC</span><span class="sxs-lookup"><span data-stu-id="a6261-164">CDC Control Task Custom Properties</span></span>](cdc-control-task-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="a6261-165">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="a6261-165">Related Tasks</span></span>  
 [<span data-ttu-id="a6261-166">Definire una variabile di stato</span><span class="sxs-lookup"><span data-stu-id="a6261-166">Define a State Variable</span></span>](../data-flow/define-a-state-variable.md)  
  
## <a name="related-content"></a><span data-ttu-id="a6261-167">Contenuto correlato</span><span class="sxs-lookup"><span data-stu-id="a6261-167">Related Content</span></span>  
  
-   <span data-ttu-id="a6261-168">Articolo tecnico [Installing Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252958)(Installazione di Microsoft SQL Server 2012 Change Data Capture per Oracle di Attunity) nel sito Web social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="a6261-168">Technical article, [Installing Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252958), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="a6261-169">Articolo tecnico [Troubleshoot Configuration Issues in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252960)(Risoluzione dei problemi di configurazione in Microsoft Change Data Capture per Oracle di Attunity) nel sito Web social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="a6261-169">Technical article, [Troubleshoot Configuration Issues in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252960), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="a6261-170">Articolo tecnico [Troubleshoot CDC Instance Errors in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252961)(Risoluzione degli errori di istanze di CDC in Microsoft Change Data Capture per Oracle di Attunity) nel sito Web social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="a6261-170">Technical article, [Troubleshoot CDC Instance Errors in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252961), on social.technet.microsoft.com.</span></span>  
  
  
