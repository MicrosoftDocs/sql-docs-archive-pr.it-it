---
title: Usare i token nei passaggi dei processi | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ssms
ms.topic: conceptual
helpviewer_keywords:
- job steps [SQL Server Agent]
- security [SQL Server Agent], enabling alert job step tokens
- SQL Server Agent jobs, job steps
- tokens [SQL Server]
- escape macros [SQL Server Agent]
ms.assetid: 105bbb66-0ade-4b46-b8e4-f849e5fc4d43
author: stevestein
ms.author: sstein
ms.openlocfilehash: 9d90b6660dd4b65e4e1d9b832b39ffaa275c83bc
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87726411"
---
# <a name="use-tokens-in-job-steps"></a><span data-ttu-id="124f4-102">Utilizzo dei token nei passaggi dei processi</span><span class="sxs-lookup"><span data-stu-id="124f4-102">Use Tokens in Job Steps</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="124f4-103">Agent consente di usare token negli script per passaggi di processi [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="124f4-103">Agent allows you to use tokens in [!INCLUDE[tsql](../../includes/tsql-md.md)] job step scripts.</span></span> <span data-ttu-id="124f4-104">L'utilizzo di token quando si scrivono passaggi di processo offre la stessa flessibilità assicurata dalle variabili quando si scrivono programmi software.</span><span class="sxs-lookup"><span data-stu-id="124f4-104">Using tokens when you write your job steps gives you the same flexibility that variables provide when you write software programs.</span></span> <span data-ttu-id="124f4-105">Dopo aver inserito un token nello script di un passaggio di processo, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent sostituisce il token in fase di esecuzione, prima che il passaggio di processo venga eseguito dal sottosistema [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="124f4-105">After you insert a token in a job step script, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces the token at run time, before the job step is executed by the [!INCLUDE[tsql](../../includes/tsql-md.md)] subsystem.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="124f4-106">In [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1 la sintassi del token dei passaggi del processo di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent è stata modificata.</span><span class="sxs-lookup"><span data-stu-id="124f4-106">Starting with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step token syntax changed.</span></span> <span data-ttu-id="124f4-107">Di conseguenza, è necessario inserire una macro di escape con tutti i token utilizzati nei passaggi di processo. In caso contrario, questi passaggi avranno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="124f4-107">As a result, an escape macro must now accompany all tokens used in job steps, or else those job steps will fail.</span></span> <span data-ttu-id="124f4-108">L'utilizzo delle macro di escape e l'aggiornamento dei passaggi di processo di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent che utilizzano token sono illustrati nelle sezioni "Informazioni sull'utilizzo dei token", "Token e macro di[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent" e "Aggiornamento dei passaggi di processo per l'utilizzo di macro" riportate di seguito.</span><span class="sxs-lookup"><span data-stu-id="124f4-108">Using escape macros and updating your [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job steps that use tokens are described in the following sections, "Understanding Using Tokens," "[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent Tokens and Macros," and "Updating Job Steps to Use Macros."</span></span> <span data-ttu-id="124f4-109">È inoltre cambiata la sintassi di [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] che prevedeva l'utilizzo delle parentesi quadre per chiamare i token dei passaggi di processo di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent, ad esempio "`[DATE]`".</span><span class="sxs-lookup"><span data-stu-id="124f4-109">In addition, the [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] syntax, which used square brackets to call out [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step tokens (for example, "`[DATE]`") has also changed.</span></span> <span data-ttu-id="124f4-110">È ora necessario racchiudere tra parentesi i nomi dei token e inserire il simbolo di dollaro (`$`) all'inizio della sintassi del token,</span><span class="sxs-lookup"><span data-stu-id="124f4-110">You must now enclose token names in parentheses and place a dollar sign (`$`) at the beginning of the token syntax.</span></span> <span data-ttu-id="124f4-111">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="124f4-111">For example:</span></span>  
>   
>  <span data-ttu-id="124f4-112">`$(ESCAPE_` *macro name* `(DATE))`</span><span class="sxs-lookup"><span data-stu-id="124f4-112">`$(ESCAPE_` *macro name* `(DATE))`</span></span>  
  
## <a name="understanding-using-tokens"></a><span data-ttu-id="124f4-113">Informazioni sull'utilizzo dei token</span><span class="sxs-lookup"><span data-stu-id="124f4-113">Understanding Using Tokens</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="124f4-114">Qualsiasi utente di Windows con autorizzazioni di scrittura per il registro eventi di Windows è in grado di accedere ai passaggi di processo attivati dagli avvisi di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent o di WMI.</span><span class="sxs-lookup"><span data-stu-id="124f4-114">Any Windows user with write permissions on the Windows Event Log can access job steps that are activated by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent alerts or WMI alerts.</span></span> <span data-ttu-id="124f4-115">Per evitare rischi per la sicurezza, i token di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent che possono essere utilizzati in processi attivati dagli avvisi sono disabilitati per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="124f4-115">To avoid this security risk, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent tokens that can be used in jobs activated by alerts are disabled by default.</span></span> <span data-ttu-id="124f4-116">Questi token sono: **a-DBN**, **a-SVR**, **a-Err**, **a-SEV**, **a-MSG**. e **WMI ( *`property`* )**.</span><span class="sxs-lookup"><span data-stu-id="124f4-116">These tokens are: **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**., and **WMI(*`property`*)**.</span></span> <span data-ttu-id="124f4-117">Si noti che in questa versione l'utilizzo dei token è esteso a tutti gli avvisi.</span><span class="sxs-lookup"><span data-stu-id="124f4-117">Note that in this release, use of tokens is extended to all alerting.</span></span>  
>   
>  <span data-ttu-id="124f4-118">Se si desidera utilizzare questi token, verificare innanzitutto che solo i membri di gruppi di sicurezza di Windows trusted, ad esempio il gruppo Administrators, dispongano delle autorizzazioni di scrittura per il registro eventi del computer in cui è installato [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="124f4-118">If you need to use these tokens, first ensure that only members of trusted Windows security groups, such as the Administrators group, have write permissions on the Event Log of the computer where [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] resides.</span></span> <span data-ttu-id="124f4-119">A questo punto, fare clic con il pulsante destro del mouse su **SQL Server Agent** in Esplora oggetti, scegliere **Proprietà**e nella pagina **Sistema avvisi** selezionare **Sostituisci token per tutte le risposte del processo ad avvisi** per abilitare questi token.</span><span class="sxs-lookup"><span data-stu-id="124f4-119">Then, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select **Replace tokens for all job responses to alerts** to enable these tokens.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="124f4-120">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent i token vengono sostituiti da valori stringa letterali esatti con un'operazione semplice ed efficiente.</span><span class="sxs-lookup"><span data-stu-id="124f4-120">Agent token replacement is simple and efficient: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces an exact literal string value for the token.</span></span> <span data-ttu-id="124f4-121">Tutti i token effettuano una distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="124f4-121">All tokens are case-sensitive.</span></span> <span data-ttu-id="124f4-122">È necessario prendere in considerazione tale comportamento nei passaggi di processo e indicare correttamente i token da utilizzare oppure convertire la stringa di sostituzione nel tipo di dati corretto.</span><span class="sxs-lookup"><span data-stu-id="124f4-122">Your job steps must take this into account and correctly quote the tokens you use or convert the replacement string to the correct data type.</span></span>  
  
 <span data-ttu-id="124f4-123">Ad esempio, è possibile utilizzare l'istruzione seguente per inserire il nome del database in un passaggio di processo:</span><span class="sxs-lookup"><span data-stu-id="124f4-123">For example, you might use the following statement to print the name of the database in a job step:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
 <span data-ttu-id="124f4-124">In questo esempio la macro **ESCAPE_SQUOTE** viene inserita con il token **A-DBN** .</span><span class="sxs-lookup"><span data-stu-id="124f4-124">In this example, the **ESCAPE_SQUOTE** macro is inserted with the **A-DBN** token.</span></span> <span data-ttu-id="124f4-125">In fase di esecuzione il token **A-DBN** verrà sostituito con il nome del database appropriato.</span><span class="sxs-lookup"><span data-stu-id="124f4-125">At run time, the **A-DBN** token will be replaced with the appropriate database name.</span></span> <span data-ttu-id="124f4-126">Tramite la macro di escape è possibile utilizzare caratteri di escape per eventuali virgolette singole inavvertitamente passate nella stringa di sostituzione del token.</span><span class="sxs-lookup"><span data-stu-id="124f4-126">The escape macro escapes any single quotation marks that may be inadvertently passed in the token replacement string.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="124f4-127">In Agent una virgoletta singola verrà sostituita con due virgolette singole nella stringa finale.</span><span class="sxs-lookup"><span data-stu-id="124f4-127">Agent will replace one single quotation mark with two single quotation marks in the final string.</span></span>  
  
 <span data-ttu-id="124f4-128">Se ad esempio la stringa passata per sostituire il token è `AdventureWorks2012'SELECT @@VERSION --`, il comando eseguito dal passaggio di processo di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent sarà il seguente:</span><span class="sxs-lookup"><span data-stu-id="124f4-128">For example, if the string passed to replace the token is `AdventureWorks2012'SELECT @@VERSION --`, the command executed by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step will be:</span></span>  
  
 `PRINT N'Current database name is AdventureWorks2012''SELECT @@VERSION --' ;`  
  
 <span data-ttu-id="124f4-129">In questo caso, l'istruzione inserita `SELECT @@VERSION`non verrà eseguita.</span><span class="sxs-lookup"><span data-stu-id="124f4-129">In this case, the inserted statement, `SELECT @@VERSION`, does not execute.</span></span> <span data-ttu-id="124f4-130">Al contrario, la virgoletta singola aggiuntiva indurrà il server ad analizzare l'istruzione inserita come stringa.</span><span class="sxs-lookup"><span data-stu-id="124f4-130">Instead, the extra single quotation mark causes the server to parse the inserted statement as a string.</span></span> <span data-ttu-id="124f4-131">Se la stringa di sostituzione del token non contiene una virgoletta singola, per nessun carattere verranno utilizzati caratteri di escape e il passaggio di processo contenente il token verrà eseguito come previsto.</span><span class="sxs-lookup"><span data-stu-id="124f4-131">If the token replacement string does not contain a single quotation mark, no characters are escaped and the job step containing the token executes as intended.</span></span>  
  
 <span data-ttu-id="124f4-132">Per eseguire il debug dell'utilizzo dei token nei passaggi di processo, utilizzare istruzioni PRINT come `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` e salvare l'output del passaggio di processo in un file o in una tabella.</span><span class="sxs-lookup"><span data-stu-id="124f4-132">To debug token usage in your job steps, use print statements such as `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` and save job step output to a file or table.</span></span> <span data-ttu-id="124f4-133">Usare la pagina **Avanzate** della finestra di dialogo **Proprietà passaggio processo** per specificare un file o una tabella per l'output del passaggio di processo.</span><span class="sxs-lookup"><span data-stu-id="124f4-133">Use the **Advanced** page of the **Job Step Properties** dialog box to specify a job step output file or table.</span></span>  
  
## <a name="sql-server-agent-tokens-and-macros"></a><span data-ttu-id="124f4-134">Token e macro di SQL Server Agent</span><span class="sxs-lookup"><span data-stu-id="124f4-134">SQL Server Agent Tokens and Macros</span></span>  
 <span data-ttu-id="124f4-135">Nelle tabelle seguenti vengono elencati e illustrati i token e le macro supportati da [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span><span class="sxs-lookup"><span data-stu-id="124f4-135">The following tables list and describe the tokens and macros that [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent supports.</span></span>  
  
### <a name="sql-server-agent-tokens"></a><span data-ttu-id="124f4-136">Token di SQL Server Agent</span><span class="sxs-lookup"><span data-stu-id="124f4-136">SQL Server Agent Tokens</span></span>  
  
|<span data-ttu-id="124f4-137">token</span><span class="sxs-lookup"><span data-stu-id="124f4-137">Token</span></span>|<span data-ttu-id="124f4-138">Descrizione</span><span class="sxs-lookup"><span data-stu-id="124f4-138">Description</span></span>|  
|-----------|-----------------|  
|<span data-ttu-id="124f4-139">**(A-DBN)**</span><span class="sxs-lookup"><span data-stu-id="124f4-139">**(A-DBN)**</span></span>|<span data-ttu-id="124f4-140">nome del database.</span><span class="sxs-lookup"><span data-stu-id="124f4-140">Database name.</span></span> <span data-ttu-id="124f4-141">Se il processo viene eseguito da un avviso, il valore del nome del database sostituisce automaticamente il token nel passaggio di processo.</span><span class="sxs-lookup"><span data-stu-id="124f4-141">If the job is run by an alert, the database name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="124f4-142">**(A-SVR)**</span><span class="sxs-lookup"><span data-stu-id="124f4-142">**(A-SVR)**</span></span>|<span data-ttu-id="124f4-143">Nome del server.</span><span class="sxs-lookup"><span data-stu-id="124f4-143">Server name.</span></span> <span data-ttu-id="124f4-144">Se il processo viene eseguito da un avviso, il valore del nome del server sostituisce automaticamente il token nel passaggio di processo.</span><span class="sxs-lookup"><span data-stu-id="124f4-144">If the job is run by an alert, the server name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="124f4-145">**(A-ERR)**</span><span class="sxs-lookup"><span data-stu-id="124f4-145">**(A-ERR)**</span></span>|<span data-ttu-id="124f4-146">Numero di errore.</span><span class="sxs-lookup"><span data-stu-id="124f4-146">Error number.</span></span> <span data-ttu-id="124f4-147">Se il processo viene eseguito da un avviso, il valore del numero di errore sostituisce automaticamente il token nel passaggio di processo.</span><span class="sxs-lookup"><span data-stu-id="124f4-147">If the job is run by an alert, the error number value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="124f4-148">**(A-SEV)**</span><span class="sxs-lookup"><span data-stu-id="124f4-148">**(A-SEV)**</span></span>|<span data-ttu-id="124f4-149">Gravità dell'errore.</span><span class="sxs-lookup"><span data-stu-id="124f4-149">Error severity.</span></span> <span data-ttu-id="124f4-150">Se il processo viene eseguito da un avviso, il valore della gravità dell'errore sostituisce automaticamente il token nel passaggio di processo.</span><span class="sxs-lookup"><span data-stu-id="124f4-150">If the job is run by an alert, the error severity value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="124f4-151">**(A-MSG)**</span><span class="sxs-lookup"><span data-stu-id="124f4-151">**(A-MSG)**</span></span>|<span data-ttu-id="124f4-152">Testo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="124f4-152">Message text.</span></span> <span data-ttu-id="124f4-153">Se il processo viene eseguito da un avviso, il valore del testo del messaggio sostituisce automaticamente il token nel passaggio di processo.</span><span class="sxs-lookup"><span data-stu-id="124f4-153">If the job is run by an alert, the message text value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="124f4-154">**Data**</span><span class="sxs-lookup"><span data-stu-id="124f4-154">**(DATE)**</span></span>|<span data-ttu-id="124f4-155">Data corrente nel formato AAAAMMGG.</span><span class="sxs-lookup"><span data-stu-id="124f4-155">Current date (in YYYYMMDD format).</span></span>|  
|<span data-ttu-id="124f4-156">**(INST)**</span><span class="sxs-lookup"><span data-stu-id="124f4-156">**(INST)**</span></span>|<span data-ttu-id="124f4-157">Nome dell'istanza.</span><span class="sxs-lookup"><span data-stu-id="124f4-157">Instance name.</span></span> <span data-ttu-id="124f4-158">Il nome di un'istanza predefinita di questo token sarà MSSQLSERVER.</span><span class="sxs-lookup"><span data-stu-id="124f4-158">For a default instance, this token will have the default instance name: MSSQLSERVER.</span></span>|  
|<span data-ttu-id="124f4-159">**JobID**</span><span class="sxs-lookup"><span data-stu-id="124f4-159">**(JOBID)**</span></span>|<span data-ttu-id="124f4-160">ID del processo.</span><span class="sxs-lookup"><span data-stu-id="124f4-160">Job ID.</span></span>|  
|<span data-ttu-id="124f4-161">**(MACH)**</span><span class="sxs-lookup"><span data-stu-id="124f4-161">**(MACH)**</span></span>|<span data-ttu-id="124f4-162">Nome del computer.</span><span class="sxs-lookup"><span data-stu-id="124f4-162">Computer name.</span></span>|  
|<span data-ttu-id="124f4-163">**(MSSA)**</span><span class="sxs-lookup"><span data-stu-id="124f4-163">**(MSSA)**</span></span>|<span data-ttu-id="124f4-164">Nome del servizio SQLServerAgent master.</span><span class="sxs-lookup"><span data-stu-id="124f4-164">Master SQLServerAgent service name.</span></span>|  
|<span data-ttu-id="124f4-165">**(OSCMD)**</span><span class="sxs-lookup"><span data-stu-id="124f4-165">**(OSCMD)**</span></span>|<span data-ttu-id="124f4-166">Prefisso per il programma usato per l'esecuzione dei passaggi di processo **CmdExec** .</span><span class="sxs-lookup"><span data-stu-id="124f4-166">Prefix for the program used to run **CmdExec** job steps.</span></span>|  
|<span data-ttu-id="124f4-167">**(SQLDIR)**</span><span class="sxs-lookup"><span data-stu-id="124f4-167">**(SQLDIR)**</span></span>|<span data-ttu-id="124f4-168">Directory in cui è installato [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="124f4-168">The directory in which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is installed.</span></span> <span data-ttu-id="124f4-169">Per impostazione predefinita corrisponde a C:\Programmi\Microsoft SQL Server\MSSQL.</span><span class="sxs-lookup"><span data-stu-id="124f4-169">By default, this value is C:\Program Files\Microsoft SQL Server\MSSQL.</span></span>|  
|<span data-ttu-id="124f4-170">**(SQLLOGDIR)**</span><span class="sxs-lookup"><span data-stu-id="124f4-170">**(SQLLOGDIR)**</span></span>|<span data-ttu-id="124f4-171">Token di sostituzione per il percorso della cartella del log degli errori di SQL Server, ad esempio $(ESCAPE_SQUOTE(SQLLOGDIR)).</span><span class="sxs-lookup"><span data-stu-id="124f4-171">Replacement token for the SQL Server error log folder path - for example, $(ESCAPE_SQUOTE(SQLLOGDIR)).</span></span>|  
|<span data-ttu-id="124f4-172">**(STEPCT)**</span><span class="sxs-lookup"><span data-stu-id="124f4-172">**(STEPCT)**</span></span>|<span data-ttu-id="124f4-173">Numero di esecuzioni del passaggio, escluse le esecuzioni non completate.</span><span class="sxs-lookup"><span data-stu-id="124f4-173">A count of the number of times this step has executed (excluding retries).</span></span> <span data-ttu-id="124f4-174">Può essere utilizzato dal comando del passaggio per imporre l'interruzione di un ciclo a più passaggi.</span><span class="sxs-lookup"><span data-stu-id="124f4-174">Can be used by the step command to force termination of a multistep loop.</span></span>|  
|<span data-ttu-id="124f4-175">**(STEPID)**</span><span class="sxs-lookup"><span data-stu-id="124f4-175">**(STEPID)**</span></span>|<span data-ttu-id="124f4-176">ID del passaggio.</span><span class="sxs-lookup"><span data-stu-id="124f4-176">Step ID.</span></span>|  
|<span data-ttu-id="124f4-177">**(SRVR)**</span><span class="sxs-lookup"><span data-stu-id="124f4-177">**(SRVR)**</span></span>|<span data-ttu-id="124f4-178">Nome del computer che esegue [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="124f4-178">Name of the computer running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="124f4-179">Se l'istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] è un'istanza denominata, questo token include il nome dell'istanza.</span><span class="sxs-lookup"><span data-stu-id="124f4-179">If the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance is a named instance, this includes the instance name.</span></span>|  
|<span data-ttu-id="124f4-180">**TEMPO**</span><span class="sxs-lookup"><span data-stu-id="124f4-180">**(TIME)**</span></span>|<span data-ttu-id="124f4-181">Ora corrente nel formato HHMMSS.</span><span class="sxs-lookup"><span data-stu-id="124f4-181">Current time (in HHMMSS format).</span></span>|  
|<span data-ttu-id="124f4-182">**(STRTTM)**</span><span class="sxs-lookup"><span data-stu-id="124f4-182">**(STRTTM)**</span></span>|<span data-ttu-id="124f4-183">Ora nel formato HHMMSS in cui è stata avviata l'esecuzione del processo.</span><span class="sxs-lookup"><span data-stu-id="124f4-183">The time (in HHMMSS format) that the job began executing.</span></span>|  
|<span data-ttu-id="124f4-184">**(STRTDT)**</span><span class="sxs-lookup"><span data-stu-id="124f4-184">**(STRTDT)**</span></span>|<span data-ttu-id="124f4-185">Data nel formato AAAAMMGG in cui è stata avviata l'esecuzione del processo.</span><span class="sxs-lookup"><span data-stu-id="124f4-185">The date (in YYYYMMDD format) that the job began executing.</span></span>|  
|<span data-ttu-id="124f4-186">**(WMI(** *property* **))**</span><span class="sxs-lookup"><span data-stu-id="124f4-186">**(WMI(** *property* **))**</span></span>|<span data-ttu-id="124f4-187">Per i processi eseguiti in risposta ad avvisi WMI, indica il valore della proprietà specificata da *property*.</span><span class="sxs-lookup"><span data-stu-id="124f4-187">For jobs that run in response to WMI alerts, the value of the property specified by *property*.</span></span> <span data-ttu-id="124f4-188">Ad esempio, `$(WMI(DatabaseName))` specifica il valore della proprietà **DatabaseName** per l'evento WMI che ha provocato l'esecuzione dell'avviso.</span><span class="sxs-lookup"><span data-stu-id="124f4-188">For example, `$(WMI(DatabaseName))` provides the value of the **DatabaseName** property for the WMI event that caused the alert to run.</span></span>|  
  
### <a name="sql-server-agent-escape-macros"></a><span data-ttu-id="124f4-189">Macro di escape di SQL Server Agent</span><span class="sxs-lookup"><span data-stu-id="124f4-189">SQL Server Agent Escape Macros</span></span>  
  
|<span data-ttu-id="124f4-190">Macro di escape</span><span class="sxs-lookup"><span data-stu-id="124f4-190">Escape Macros</span></span>|<span data-ttu-id="124f4-191">Descrizione</span><span class="sxs-lookup"><span data-stu-id="124f4-191">Description</span></span>|  
|-------------------|-----------------|  
|<span data-ttu-id="124f4-192">**$(ESCAPE_SQUOTE(** *nome_token* **))**</span><span class="sxs-lookup"><span data-stu-id="124f4-192">**$(ESCAPE_SQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="124f4-193">Utilizza caratteri di escape per virgolette singole (') nella stringa di sostituzione del token.</span><span class="sxs-lookup"><span data-stu-id="124f4-193">Escapes single quotation marks (') in the token replacement string.</span></span> <span data-ttu-id="124f4-194">Sostituisce una virgoletta singola con due virgolette singole.</span><span class="sxs-lookup"><span data-stu-id="124f4-194">Replaces one single quotation mark with two single quotation marks.</span></span>|  
|<span data-ttu-id="124f4-195">**$(ESCAPE_DQUOTE(** *nome_token* **))**</span><span class="sxs-lookup"><span data-stu-id="124f4-195">**$(ESCAPE_DQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="124f4-196">Utilizza caratteri di escape per virgolette doppie (") nella stringa di sostituzione del token.</span><span class="sxs-lookup"><span data-stu-id="124f4-196">Escapes double quotation marks (") in the token replacement string.</span></span> <span data-ttu-id="124f4-197">Sostituisce una virgoletta doppia con due virgolette doppie.</span><span class="sxs-lookup"><span data-stu-id="124f4-197">Replaces one double quotation mark with two double quotation marks.</span></span>|  
|<span data-ttu-id="124f4-198">**$(ESCAPE_RBRACKET(** *nome_token* **))**</span><span class="sxs-lookup"><span data-stu-id="124f4-198">**$(ESCAPE_RBRACKET(** *token_name* **))**</span></span>|<span data-ttu-id="124f4-199">Utilizza caratteri di escape per parentesi chiuse (]) nella stringa di sostituzione del token.</span><span class="sxs-lookup"><span data-stu-id="124f4-199">Escapes right brackets (]) in the token replacement string.</span></span> <span data-ttu-id="124f4-200">Sostituisce una parentesi chiusa con due parentesi chiuse.</span><span class="sxs-lookup"><span data-stu-id="124f4-200">Replaces one right bracket with two right brackets.</span></span>|  
|<span data-ttu-id="124f4-201">**$(ESCAPE_NONE(** *nome_token* **))**</span><span class="sxs-lookup"><span data-stu-id="124f4-201">**$(ESCAPE_NONE(** *token_name* **))**</span></span>|<span data-ttu-id="124f4-202">Sostituisce il token senza utilizzare caratteri di escape per i caratteri della stringa.</span><span class="sxs-lookup"><span data-stu-id="124f4-202">Replaces token without escaping any characters in the string.</span></span> <span data-ttu-id="124f4-203">Questa macro viene utilizzata per assicurare la compatibilità con le versioni precedenti in ambienti in cui si presuppone che le stringhe di sostituzione dei token provengano esclusivamente da utenti trusted.</span><span class="sxs-lookup"><span data-stu-id="124f4-203">This macro is provided to support backward compatibility in environments where token replacement strings are only expected from trusted users.</span></span> <span data-ttu-id="124f4-204">Per ulteriori informazioni, vedere "Aggiornamento dei passaggi di processo per l'utilizzo di macro" più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="124f4-204">For more information, see "Updating Job Steps to Use Macros," later in this topic.</span></span>|  
  
## <a name="updating-job-steps-to-use-macros"></a><span data-ttu-id="124f4-205">Aggiornamento dei passaggi di processo per l'utilizzo di macro</span><span class="sxs-lookup"><span data-stu-id="124f4-205">Updating Job Steps to Use Macros</span></span>  
 <span data-ttu-id="124f4-206">In [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, i passaggi di processo che contengono token senza macro di escape avranno esito negativo e restituiranno un messaggio di errore in cui è indicato che il passaggio di processo contiene uno o più token che devono essere aggiornati con una macro prima che il processo possa essere eseguito.</span><span class="sxs-lookup"><span data-stu-id="124f4-206">Beginning with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, job steps that contain tokens without escape macros will fail and return an error message indicating the job step contains one or more tokens that must be updated with a macro before the job can run.</span></span>  
  
 <span data-ttu-id="124f4-207">Nell'articolo 915845 della [!INCLUDE[msCoName](../../includes/msconame-md.md)] Knowledge Base: [I processi di SQL Server Agent che usano token hanno esito negativo in SQL Server 2005 Service Pack 1](https://support.microsoft.com/kb/915845)viene specificato uno script che può essere usato per aggiornare tutti i passaggi di processo che usano token con la macro **ESCAPE_NONE** .</span><span class="sxs-lookup"><span data-stu-id="124f4-207">A script is provided with [!INCLUDE[msCoName](../../includes/msconame-md.md)] Knowledge Base article 915845: [SQL Server Agent Job Steps That Use Tokens Fail in SQL Server 2005 Service Pack 1](https://support.microsoft.com/kb/915845).You can use this script to update all of your job steps that use tokens with the **ESCAPE_NONE** macro.</span></span> <span data-ttu-id="124f4-208">Dopo aver usato questo script, è consigliabile esaminare al più presto i passaggi di processo che usano token e sostituire la macro **ESCAPE_NONE** con una macro di escape appropriata per il contesto del passaggio di processo.</span><span class="sxs-lookup"><span data-stu-id="124f4-208">After using this script, we recommend that you review your job steps that use tokens as soon as possible, and replace the **ESCAPE_NONE** macro with an escape macro that is appropriate for the job step context.</span></span>  
  
 <span data-ttu-id="124f4-209">Nella tabella seguente viene indicata la modalità di gestione della sostituzione del token in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agente.</span><span class="sxs-lookup"><span data-stu-id="124f4-209">The following table describes how token replacement is handled by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="124f4-210">Per attivare o disattivare la sostituzione dei token relativi agli avvisi, fare clic con il pulsante destro del mouse su **SQL Server Agent** in Esplora oggetti, scegliere **Proprietà**e selezionare o deselezionare la casella di controllo **Sostituisci token per tutte le risposte del processo ad avvisi** nella pagina **Sistema avvisi** .</span><span class="sxs-lookup"><span data-stu-id="124f4-210">To turn alert token replacement on or off, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select or clear the **Replace tokens for all job responses to alerts** check box.</span></span>  
  
|<span data-ttu-id="124f4-211">Sintassi dei token</span><span class="sxs-lookup"><span data-stu-id="124f4-211">Token syntax</span></span>|<span data-ttu-id="124f4-212">Sostituzione dei token relativi agli avvisi attivata</span><span class="sxs-lookup"><span data-stu-id="124f4-212">Alert token replacement on</span></span>|<span data-ttu-id="124f4-213">Sostituzione dei token relativi agli avvisi disattivata</span><span class="sxs-lookup"><span data-stu-id="124f4-213">Alert token replacement off</span></span>|  
|------------------|--------------------------------|---------------------------------|  
|<span data-ttu-id="124f4-214">La macro ESCAPE è stata utilizzata</span><span class="sxs-lookup"><span data-stu-id="124f4-214">ESCAPE macro used</span></span>|<span data-ttu-id="124f4-215">Tutti i token presenti nei processi sono stati sostituiti correttamente.</span><span class="sxs-lookup"><span data-stu-id="124f4-215">All tokens in jobs are successfully replaced.</span></span>|<span data-ttu-id="124f4-216">I token attivati da avvisi non vengono sostituiti.</span><span class="sxs-lookup"><span data-stu-id="124f4-216">Tokens activated by alerts are not replaced.</span></span> <span data-ttu-id="124f4-217">Questi token sono **a-DBN**, **a-SVR**, **a-Err**, **a-SEV**, **a-MSG**e **WMI ( *`property`* )**.</span><span class="sxs-lookup"><span data-stu-id="124f4-217">These tokens are **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**, and **WMI(*`property`*)**.</span></span> <span data-ttu-id="124f4-218">Altri token statici sono stati sostituiti correttamente.</span><span class="sxs-lookup"><span data-stu-id="124f4-218">Other static tokens are replaced successfully.</span></span>|  
|<span data-ttu-id="124f4-219">La macro ESCAPE non è stata utilizzata</span><span class="sxs-lookup"><span data-stu-id="124f4-219">No ESCAPE macro used</span></span>|<span data-ttu-id="124f4-220">Tutti i processi contenenti token hanno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="124f4-220">Any jobs containing tokens fail.</span></span>|<span data-ttu-id="124f4-221">Tutti i processi contenenti token hanno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="124f4-221">Any jobs containing tokens fail.</span></span>|  
  
## <a name="token-syntax-update-examples"></a><span data-ttu-id="124f4-222">Esempi di aggiornamento della sintassi dei token</span><span class="sxs-lookup"><span data-stu-id="124f4-222">Token Syntax Update Examples</span></span>  
  
### <a name="a-using-tokens-in-non-nested-strings"></a><span data-ttu-id="124f4-223">R.</span><span class="sxs-lookup"><span data-stu-id="124f4-223">A.</span></span> <span data-ttu-id="124f4-224">Utilizzo di token in stringhe non nidificate</span><span class="sxs-lookup"><span data-stu-id="124f4-224">Using tokens in non-nested strings</span></span>  
 <span data-ttu-id="124f4-225">Nell'esempio seguente viene illustrato come aggiornare uno script semplice non nidificato con la macro di escape appropriata.</span><span class="sxs-lookup"><span data-stu-id="124f4-225">The following example shows how to update a simple non-nested script with the appropriate escape macro.</span></span> <span data-ttu-id="124f4-226">Prima di eseguire lo script di aggiornamento, lo script del passaggio di processo seguente utilizza un token per inserire il nome del database appropriato:</span><span class="sxs-lookup"><span data-stu-id="124f4-226">Before running the update script, the following job step script uses a job step token to print the appropriate database name:</span></span>  
  
 `PRINT N'Current database name is $(A-DBN)' ;`  
  
 <span data-ttu-id="124f4-227">Dopo aver eseguito lo script di aggiornamento, una macro `ESCAPE_NONE` viene inserita prima del token `A-DBN` .</span><span class="sxs-lookup"><span data-stu-id="124f4-227">After running the update script, an `ESCAPE_NONE` macro is inserted before the `A-DBN` token.</span></span> <span data-ttu-id="124f4-228">Poiché le virgolette singole vengono utilizzate per delimitare la stringa di stampa, è necessario aggiornare il passaggio di processo inserendo la macro `ESCAPE_SQUOTE` nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="124f4-228">Because single quotation marks are used to delimit the print string, you must update the job step by inserting the `ESCAPE_SQUOTE` macro as follows:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
### <a name="b-using-tokens-in-nested-strings"></a><span data-ttu-id="124f4-229">B.</span><span class="sxs-lookup"><span data-stu-id="124f4-229">B.</span></span> <span data-ttu-id="124f4-230">Utilizzo di token in stringhe nidificate</span><span class="sxs-lookup"><span data-stu-id="124f4-230">Using tokens in nested strings</span></span>  
 <span data-ttu-id="124f4-231">Negli script dei passaggi di processo in cui i token vengono utilizzati in istruzioni o stringhe nidificate, è necessario riscrivere le istruzioni nidificate come più istruzioni prima di inserire le macro di escape appropriate.</span><span class="sxs-lookup"><span data-stu-id="124f4-231">In job step scripts where tokens are used in nested strings or statements, the nested statements should be rewritten as multiple statements before inserting the appropriate escape macros.</span></span>  
  
 <span data-ttu-id="124f4-232">Si consideri, ad esempio, il passaggio di processo seguente che non è stato aggiornato con una macro di escape e nel quale viene utilizzato il token `A-MSG` :</span><span class="sxs-lookup"><span data-stu-id="124f4-232">For example, consider the following job step, which uses the `A-MSG` token and has not been updated with an escape macro:</span></span>  
  
 `PRINT N'Print ''$(A-MSG)''' ;`  
  
 <span data-ttu-id="124f4-233">Dopo aver eseguito lo script di aggiornamento, una macro `ESCAPE_NONE` viene inserita con il token.</span><span class="sxs-lookup"><span data-stu-id="124f4-233">After running the update script, an `ESCAPE_NONE` macro is inserted with the token.</span></span> <span data-ttu-id="124f4-234">In questo caso, tuttavia, è necessario riscrivere lo script senza utilizzare la nidificazione nel modo seguente e inserire la macro `ESCAPE_SQUOTE` per utilizzare correttamente caratteri di escape per i delimitatori che potrebbero essere passati nella stringa di sostituzione del token:</span><span class="sxs-lookup"><span data-stu-id="124f4-234">However, in this case, you would have to rewrite the script without using nesting as follows and insert the `ESCAPE_SQUOTE` macro to properly escape delimiters that may be passed in the token replacement string:</span></span>  
  
 `DECLARE @msgString nvarchar(max)`  
  
 `SET @msgString = '$(ESCAPE_SQUOTE(A-MSG))'`  
  
 `SET @msgString = QUOTENAME(@msgString,'''')`  
  
 `PRINT N'Print ' + @msgString ;`  
  
 <span data-ttu-id="124f4-235">Si noti inoltre che in questo esempio la funzione QUOTENAME imposta il carattere utilizzato per le virgolette.</span><span class="sxs-lookup"><span data-stu-id="124f4-235">Note also in this example that the QUOTENAME function sets the quote character.</span></span>  
  
### <a name="c-using-tokens-with-the-escape_none-macro"></a><span data-ttu-id="124f4-236">C.</span><span class="sxs-lookup"><span data-stu-id="124f4-236">C.</span></span> <span data-ttu-id="124f4-237">Utilizzo di token con la macro ESCAPE_NONE</span><span class="sxs-lookup"><span data-stu-id="124f4-237">Using tokens with the ESCAPE_NONE macro</span></span>  
 <span data-ttu-id="124f4-238">L'esempio seguente fa parte di uno script in cui `job_id` viene recuperato dalla tabella `sysjobs` e in cui il token `JOBID` viene utilizzato per popolare la variabile `@JobID` dichiarata in precedenza nello script come tipo di dati binario.</span><span class="sxs-lookup"><span data-stu-id="124f4-238">The following example is part of a script that retrieves the `job_id` from the `sysjobs` table and uses the `JOBID` token to populate the `@JobID` variable, which was declared earlier in the script as a binary data type.</span></span> <span data-ttu-id="124f4-239">Poiché non è necessario alcun delimitatore per i tipi di dati binari, la macro `ESCAPE_NONE` viene utilizzata con il token `JOBID` .</span><span class="sxs-lookup"><span data-stu-id="124f4-239">Note that because no delimiters are required for binary data types, the `ESCAPE_NONE` macro is used with the `JOBID` token.</span></span> <span data-ttu-id="124f4-240">Non è necessario aggiornare questo passaggio di processo dopo aver eseguito lo script di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="124f4-240">You would not need to update this job step after running the update script.</span></span>  
  
 `SELECT * FROM msdb.dbo.sysjobs`  
  
 `WHERE @JobID = CONVERT(uniqueidentifier, $(ESCAPE_NONE(JOBID))) ;`  
  
## <a name="see-also"></a><span data-ttu-id="124f4-241">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="124f4-241">See Also</span></span>  
 <span data-ttu-id="124f4-242">[Implementazione di processi](implement-jobs.md) </span><span class="sxs-lookup"><span data-stu-id="124f4-242">[Implement Jobs](implement-jobs.md) </span></span>  
 [<span data-ttu-id="124f4-243">Gestire passaggi di processo</span><span class="sxs-lookup"><span data-stu-id="124f4-243">Manage Job Steps</span></span>](manage-job-steps.md)  
  
  
