---
title: Configurare Analysis Services per la delega vincolata Kerberos | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 6d751477-6bf1-48b4-8833-5a631bbe7650
author: minewiskan
ms.author: owend
ms.openlocfilehash: 03b852acb4868cd384ef34948c6aff70541638a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87714904"
---
# <a name="configure-analysis-services-for-kerberos-constrained-delegation"></a><span data-ttu-id="d7c20-102">Configurare Analysis Services per la delega vincolata Kerberos</span><span class="sxs-lookup"><span data-stu-id="d7c20-102">Configure Analysis Services for Kerberos constrained delegation</span></span>
  <span data-ttu-id="d7c20-103">Quando si configura Analysis Services per l'autenticazione Kerberos, è probabile che si desideri ottenere uno o entrambi i seguenti risultati: che Analysis Services rappresenti un'identità utente per l'esecuzione di query sui dati oppure che Analysis Services deleghi un'identità utente per un servizio di livello inferiore.</span><span class="sxs-lookup"><span data-stu-id="d7c20-103">When configuring Analysis Services for Kerberos authentication, you are most likely interested in achieving one or both of the following outcomes: having Analysis Services impersonate a user identity when querying data; or having Analysis Services delegate a user identity to a down-level service.</span></span> <span data-ttu-id="d7c20-104">Ogni scenario prevede requisiti di configurazione lievemente diversi.</span><span class="sxs-lookup"><span data-stu-id="d7c20-104">Each scenario calls for slightly different configuration requirements.</span></span> <span data-ttu-id="d7c20-105">Entrambi gli scenari richiedono che si verifichi la correttezza della configurazione.</span><span class="sxs-lookup"><span data-stu-id="d7c20-105">Both scenarios require verification to ensure configuration was done properly.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="d7c20-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager per [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** è uno strumento di diagnostica che semplifica la risoluzione dei problemi di connettività correlati a Kerberos con [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d7c20-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="d7c20-107">Per altre informazioni, vedere [Microsoft Kerberos Configuration Manager per SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="d7c20-107">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
 <span data-ttu-id="d7c20-108">In questo argomento sono incluse le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="d7c20-108">This topic contains the following sections:</span></span>  
  
-   [<span data-ttu-id="d7c20-109">Consentire ad Analysis Services di rappresentare un'identità utente</span><span class="sxs-lookup"><span data-stu-id="d7c20-109">Allow Analysis Services to impersonate a user identity</span></span>](#bkmk_impersonate)  
  
-   [<span data-ttu-id="d7c20-110">Configurare Analysis Services per la delega trusted</span><span class="sxs-lookup"><span data-stu-id="d7c20-110">Configure Analysis Services for trusted delegation</span></span>](#bkmk_delegate)  
  
-   [<span data-ttu-id="d7c20-111">Verificare l'identità rappresentata o delegata</span><span class="sxs-lookup"><span data-stu-id="d7c20-111">Test for impersonated or delegated identity</span></span>](#bkmk_test)  
  
> [!NOTE]  
>  <span data-ttu-id="d7c20-112">La delega non è necessaria se la connessione ad Analysis Services è un hop singolo o se per la soluzione vengono usate credenziali archiviate fornite dal servizio di archiviazione sicura di SharePoint o da Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="d7c20-112">Delegation is not required if the connection to Analysis Services is a single hop, or your solution uses stored credentials provided by SharePoint Secure Store Service or Reporting Services.</span></span> <span data-ttu-id="d7c20-113">Se tutte le connessioni sono connessioni dirette da Excel a un database di Analysis Services oppure si basano su credenziali archiviate, è possibile usare Kerberos (o NTLM) senza dovere configurare la delega vincolata.</span><span class="sxs-lookup"><span data-stu-id="d7c20-113">If all connections are direct connections from Excel to an Analysis Services database, or based on stored credentials, you can use Kerberos (or NTLM) without having to configure constrained delegation.</span></span>  
>   
>  <span data-ttu-id="d7c20-114">La delega vincolata Kerberos è necessaria se l'identità utente deve passare tra più connessioni di computer (noto come "doppio hop").</span><span class="sxs-lookup"><span data-stu-id="d7c20-114">Kerberos constrained delegation is required if the user identity has to flow over multiple computer connections (known as "double-hop").</span></span> <span data-ttu-id="d7c20-115">Quando l'accesso ai dati di Analysis Services dipende dall'identità dell'utente e la richiesta di connessione proviene da un servizio di delega, usare l'elenco di controllo disponibile nella sezione successiva per accertarsi che Analysis Services sia in grado di rappresentare il chiamante originale.</span><span class="sxs-lookup"><span data-stu-id="d7c20-115">When Analysis Services data access is contingent upon user identity, and the connection request is from a delegating service, use the checklist in the next section to ensure that Analysis Services is able to impersonate the original caller.</span></span> <span data-ttu-id="d7c20-116">Per altre informazioni sui flussi di autenticazione di Analysis Services, vedere la pagina relativa all' [autenticazione di Microsoft Business Intelligence e alla delega dell'identità](https://go.microsoft.com/fwlink/?LinkID=286576).</span><span class="sxs-lookup"><span data-stu-id="d7c20-116">For more information about Analysis Services authentication flows, see [Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576).</span></span>  
>   
>  <span data-ttu-id="d7c20-117">Ai fini della sicurezza, Microsoft consiglia sempre le deleghe vincolate rispetto a quelle non vincolate.</span><span class="sxs-lookup"><span data-stu-id="d7c20-117">As a security best practice, Microsoft always recommends constrained delegation over unconstrained delegation.</span></span> <span data-ttu-id="d7c20-118">Le deleghe non vincolate rappresentano un rischio maggiore per la sicurezza poiché consentono all'identità del servizio di rappresentare un altro utente in *qualsiasi* computer, servizio o applicazione a downstream (rispetto ai servizi definiti in modo esplicito tramite la delega vincolata).</span><span class="sxs-lookup"><span data-stu-id="d7c20-118">Unconstrained delegation is a major security risk because it allows the service identity to impersonate another user on *any* downstream computer, service, or application (as opposed to just those services explicitly defined via constrained delegation).</span></span>  
  
##  <a name="allow-analysis-services-to-impersonate-a-user-identity"></a><a name="bkmk_impersonate"></a><span data-ttu-id="d7c20-119">Consenti Analysis Services di rappresentare un'identità utente</span><span class="sxs-lookup"><span data-stu-id="d7c20-119">Allow Analysis Services to impersonate a user identity</span></span>  
 <span data-ttu-id="d7c20-120">Per consentire ai servizi di livello superiore come Reporting Services, IIS o SharePoint di rappresentare un'identità utente in Analysis Services, è necessario configurare la delega vincolata Kerberos per tali servizi.</span><span class="sxs-lookup"><span data-stu-id="d7c20-120">To allow up-level services such as Reporting Services, IIS, or SharePoint to impersonate a user identity on Analysis Services, you must configure Kerberos constrained delegation for those services.</span></span> <span data-ttu-id="d7c20-121">In questo scenario, Analysis Services rappresenta l'utente corrente usando l'identità fornita dal servizio di delega e restituisce i risultati in base all'appartenenza dell'identità in questione ai ruoli.</span><span class="sxs-lookup"><span data-stu-id="d7c20-121">In this scenario, Analysis Services impersonates the current user using the identity provided by the delegating service, returning results based on role membership of that user identity.</span></span>  
  
|<span data-ttu-id="d7c20-122">Attività</span><span class="sxs-lookup"><span data-stu-id="d7c20-122">Task</span></span>|<span data-ttu-id="d7c20-123">Descrizione</span><span class="sxs-lookup"><span data-stu-id="d7c20-123">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="d7c20-124">Passaggio 1: Verificare che gli account siano idonei per la delega</span><span class="sxs-lookup"><span data-stu-id="d7c20-124">Step 1: Verify that accounts are suitable for delegation</span></span>|<span data-ttu-id="d7c20-125">Assicurarsi che gli account usati per eseguire i servizi siano provvisti delle proprietà corrette in Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d7c20-125">Ensure that the accounts used to run the services have the correct properties in Active Directory.</span></span> <span data-ttu-id="d7c20-126">Gli account di servizio in Active Directory non devono essere contrassegnati come account sensibili o essere esplicitamente esclusi dagli scenari di delega.</span><span class="sxs-lookup"><span data-stu-id="d7c20-126">Service accounts in Active Directory must not be marked as sensitive accounts, or specifically excluded from delegation scenarios.</span></span> <span data-ttu-id="d7c20-127">Per altre informazioni, vedere [Informazioni sugli account utente](https://go.microsoft.com/fwlink/?LinkId=235818).</span><span class="sxs-lookup"><span data-stu-id="d7c20-127">For more information, see [Understanding User Accounts](https://go.microsoft.com/fwlink/?LinkId=235818).</span></span><br /><br /> <span data-ttu-id="d7c20-128">Importante in genere, tutti gli account e i server devono appartenere allo stesso dominio di Active Directory o a domini trusted nella stessa foresta. \*\* \* \* \* \* \*\*</span><span class="sxs-lookup"><span data-stu-id="d7c20-128">**\*\* Important \*\*** Generally, all accounts and servers must belong to the same Active Directory domain or to trusted domains in the same forest.</span></span> <span data-ttu-id="d7c20-129">Tuttavia, poiché Windows Server 2012 supporta la delega tra i limiti di dominio, è possibile configurare la delega vincolata Kerberos in un limite di dominio se il livello funzionale del dominio è Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="d7c20-129">However, because Windows Server 2012 supports delegation across domain boundaries, you can configure Kerberos constrained delegation across a domain boundary if the domain functional level is Windows Server 2012.</span></span> <span data-ttu-id="d7c20-130">Un'altra alternativa consiste nel configurare Analysis Services per l'accesso HTTP e usare i metodi di autenticazione di IIS per la connessione client.</span><span class="sxs-lookup"><span data-stu-id="d7c20-130">Another alternative is to configure Analysis Services for HTTP access and use IIS authentication methods on the client connection.</span></span> <span data-ttu-id="d7c20-131">Per altre informazioni, vedere [Configurare l'accesso HTTP ad Analysis Services in Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md)(Autenticazione di Microsoft Business Intelligence e la delega dell'identità).</span><span class="sxs-lookup"><span data-stu-id="d7c20-131">For more information, see [Configure HTTP Access to Analysis Services on Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span></span>|  
|<span data-ttu-id="d7c20-132">Passaggio 2: Registrare il nome SPN</span><span class="sxs-lookup"><span data-stu-id="d7c20-132">Step 2: Register the SPN</span></span>|<span data-ttu-id="d7c20-133">Prima di impostare una delega vincolata, è necessario registrare un nome SPN per l'istanza di Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="d7c20-133">Before setting up constrained delegation, you must register a Service Principle Name (SPN) for the Analysis Services instance.</span></span> <span data-ttu-id="d7c20-134">Il nome SPN di Analysis Services sarà necessario quando si configura la delega vincolata Kerberos per i servizi di livello intermedio.</span><span class="sxs-lookup"><span data-stu-id="d7c20-134">You will need the Analysis Services SPN when configuring Kerberos constrained delegation for middle tier services.</span></span> <span data-ttu-id="d7c20-135">Per istruzioni, vedere [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) .</span><span class="sxs-lookup"><span data-stu-id="d7c20-135">See [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) for instructions.</span></span><br /><br /> <span data-ttu-id="d7c20-136">Un nome SPN specifica l'identità univoca di un servizio in un dominio configurato per l'autenticazione Kerberos.</span><span class="sxs-lookup"><span data-stu-id="d7c20-136">A Service Principle Name (SPN) specifies the unique identity of a service in a domain configured for Kerberos authentication.</span></span> <span data-ttu-id="d7c20-137">Le connessioni client in cui viene usata la sicurezza integrata spesso richiedono un nome SPN nell'ambito dell'autenticazione SSPI.</span><span class="sxs-lookup"><span data-stu-id="d7c20-137">Client connections using integrated security often request an SPN as part of SSPI authentication.</span></span> <span data-ttu-id="d7c20-138">La richiesta viene inoltrata a un controller di dominio Active Directory e la delega vincolata Kerberos concede un ticket se al nome SPN presentato dal client corrisponde una registrazione del nome SPN in Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d7c20-138">The request is forwarded to an Active Directory Domain Controller (DC), with the KDC granting a ticket if the SPN presented by the client has a matching SPN registration in Active Directory.</span></span>|  
|<span data-ttu-id="d7c20-139">Passaggio 3: Configurare la delega vincolata</span><span class="sxs-lookup"><span data-stu-id="d7c20-139">Step 3: Configure constrained delegation</span></span>|<span data-ttu-id="d7c20-140">Dopo avere convalidato gli account che si desidera usare e averne registrato i relativi nomi SPN, il passaggio successivo consiste nel configurare i servizi di livello superiore, quali IIS, Reporting Services o i servizi Web di SharePoint, per la delega vincolata, specificando il nome SPN di Analysis Services come servizio specifico per cui la delega è consentita.</span><span class="sxs-lookup"><span data-stu-id="d7c20-140">After validating the accounts you want to use and registering SPNs for those accounts, your next step is to configure up-level services, such as IIS, Reporting Services, or SharePoint web services for constrained delegation, specifying the Analysis Services SPN as the specific service for which delegation is allowed.</span></span><br /><br /> <span data-ttu-id="d7c20-141">I servizi eseguiti in SharePoint, ad esempio Excel Services o Reporting Services in modalità SharePoint, spesso ospitano cartelle di lavoro e report che usano dati tabulari o multidimensionali di Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="d7c20-141">Services that run in SharePoint, such as Excel Services or Reporting Services in SharePoint mode, often host workbooks and reports that consume Analysis Services multidimensional or tabular data.</span></span> <span data-ttu-id="d7c20-142">La configurazione della delega vincolata per tali servizi è una normale attività necessaria per supportare l'aggiornamento dei dati da Excel Services.</span><span class="sxs-lookup"><span data-stu-id="d7c20-142">Configuring constrained delegation for these services is a common configuration task, and necessary for supporting data refresh from Excel Services.</span></span> <span data-ttu-id="d7c20-143">I collegamenti riportati di seguito forniscono istruzioni per i servizi di SharePoint e per altri servizi che con tutta probabilità presentano una richiesta di connessione dati a valle per i dati di Analysis Services:</span><span class="sxs-lookup"><span data-stu-id="d7c20-143">The following links provide instructions for SharePoint services, as well as other services likely to present a downstream data connection request for Analysis Services data:</span></span><br /><br /> <span data-ttu-id="d7c20-144">[Delega dell'identità per Excel Services (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) o [How to configure Excel Services in SharePoint Server 2010 for Kerberos authentication](https://support.microsoft.com/kb/2466519)</span><span class="sxs-lookup"><span data-stu-id="d7c20-144">[Identity delegation for Excel Services (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) or [How to configure Excel Services in SharePoint Server 2010 for Kerberos authentication](https://support.microsoft.com/kb/2466519)</span></span><br /><br /> [<span data-ttu-id="d7c20-145">Delega dell'identità per PerformancePoint Services (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="d7c20-145">Identity delegation for PerformancePoint Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299827)<br /><br /> [<span data-ttu-id="d7c20-146">Delega dell'identità per SQL Server Reporting Services (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="d7c20-146">Identity delegation for SQL Server Reporting Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299828)<br /><br /> <span data-ttu-id="d7c20-147">Per IIS 7.0, vedere [Configure Windows Authentication (IIS 7)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) [Configurare l'autenticazione di Windows (IIS 7)] o [How to configure SQL Server 2008 Analysis Services and SQL Server 2005 Analysis Services to use Kerberos authentication](https://support.microsoft.com/kb/917409)(Come configurare SQL Server 2008 Analysis Services e SQL Server 2005 Analysis Services per usare l'autenticazione Kerberos).</span><span class="sxs-lookup"><span data-stu-id="d7c20-147">For IIS 7.0 see [Configure Windows Authentication (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) or [How to configure SQL Server 2008 Analysis Services and SQL Server 2005 Analysis Services to use Kerberos authentication](https://support.microsoft.com/kb/917409).</span></span>|  
|<span data-ttu-id="d7c20-148">Passaggio 4: Test delle connessioni</span><span class="sxs-lookup"><span data-stu-id="d7c20-148">Step 4: Test connections</span></span>|<span data-ttu-id="d7c20-149">Durante i test, connettersi da computer remoti usando identità differenti ed eseguire le query su Analysis Services usando le stesse applicazioni degli utenti aziendali.</span><span class="sxs-lookup"><span data-stu-id="d7c20-149">When testing, connect from remote computers, under different identities, and query Analysis Services using the same applications as business users.</span></span> <span data-ttu-id="d7c20-150">È possibile usare SQL Server Profiler per il monitoraggio della connessione.</span><span class="sxs-lookup"><span data-stu-id="d7c20-150">You can use SQL Server Profiler to monitor the connection.</span></span> <span data-ttu-id="d7c20-151">Nella richiesta verrà visualizzata l'identità dell'utente.</span><span class="sxs-lookup"><span data-stu-id="d7c20-151">You should see the user identity on the request.</span></span> <span data-ttu-id="d7c20-152">Per altre informazioni, vedere [Verificare l'identità rappresentata o delegata](#bkmk_test) in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="d7c20-152">For more information, see [Test for impersonated or delegated identity](#bkmk_test) in this section.</span></span>|  
  
##  <a name="configure-analysis-services-for-trusted-delegation"></a><a name="bkmk_delegate"></a><span data-ttu-id="d7c20-153">Configurare Analysis Services per la delega Trusted</span><span class="sxs-lookup"><span data-stu-id="d7c20-153">Configure Analysis Services for trusted delegation</span></span>  
 <span data-ttu-id="d7c20-154">La configurazione di Analysis Services per la delega vincolata Kerberos consente al servizio di rappresentare un'identità client per un servizio di livello inferiore, ad esempio il motore di database relazionale, in modo che sia possibile eseguire query sui dati come se il client fosse connesso direttamente.</span><span class="sxs-lookup"><span data-stu-id="d7c20-154">Configuring Analysis Services for Kerberos constrained delegation allows the service to impersonate a client identity on a down-level service, such as the relational database engine, so that data can be queried as if the client was connected directly.</span></span>  
  
 <span data-ttu-id="d7c20-155">Gli scenari di delega per Analysis Services sono limitati ai modelli tabulari configurati per la modalità `DirectQuery`.</span><span class="sxs-lookup"><span data-stu-id="d7c20-155">Delegation scenarios for Analysis Services are limited to tabular models configured for `DirectQuery` mode.</span></span> <span data-ttu-id="d7c20-156">Questo è l'unico scenario in cui Analysis Services può passare credenziali delegate a un altro servizio.</span><span class="sxs-lookup"><span data-stu-id="d7c20-156">This is the only scenario in which Analysis Services can pass delegated credentials to another service.</span></span> <span data-ttu-id="d7c20-157">In tutti gli altri scenari, ad esempio gli scenari di SharePoint descritti nella sezione precedente, Analysis Services si trova all'estremità ricevente della catena della delega.</span><span class="sxs-lookup"><span data-stu-id="d7c20-157">In all other scenarios, such as SharePoint scenarios mentioned in the previous section, Analysis Services is on the receiving end of the delegation chain.</span></span> <span data-ttu-id="d7c20-158">Per altre informazioni su DirectQuery, vedere [Modalità DirectQuery &#40;SSAS tabulare&#41;](../tabular-models/directquery-mode-ssas-tabular.md).</span><span class="sxs-lookup"><span data-stu-id="d7c20-158">For more information about DirectQuery, see [DirectQuery Mode &#40;SSAS Tabular&#41;](../tabular-models/directquery-mode-ssas-tabular.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d7c20-159">È un luogo comune ritenere che l'archiviazione ROLAP, le operazioni di elaborazione o l'accesso a partizioni remote rappresentino i requisiti per la delega vincolata.</span><span class="sxs-lookup"><span data-stu-id="d7c20-159">A common misconception is that ROLAP storage, processing operations, or access to remote partitions somehow introduce requirements for constrained delegation.</span></span> <span data-ttu-id="d7c20-160">Non è così.</span><span class="sxs-lookup"><span data-stu-id="d7c20-160">This is not the case.</span></span> <span data-ttu-id="d7c20-161">Tutte queste operazioni vengono eseguite direttamente dall'account del servizio (definito anche account di elaborazione) per proprio conto.</span><span class="sxs-lookup"><span data-stu-id="d7c20-161">All of these operations are executed directly by the service account (also referred to as the processing account), on its own behalf.</span></span> <span data-ttu-id="d7c20-162">La delega non è necessaria per queste operazioni in Analysis Services, visto che le autorizzazioni per tali operazioni vengono concesse direttamente all'account del servizio. Ad esempio, per consentire al servizio di elaborare i dati, è sufficiente concedere le autorizzazioni db_datareader nel database relazionale.</span><span class="sxs-lookup"><span data-stu-id="d7c20-162">Delegation is not required for these operations in Analysis Services, given that permissions for such operations are granted directly to the service account (for example, granting db_datareader permissions on the relational database so that the service can process data).</span></span> <span data-ttu-id="d7c20-163">Per altre informazioni sulle operazioni server e le autorizzazioni, vedere [Configurare gli account del servizio &#40;Analysis Services&#41;](configure-service-accounts-analysis-services.md).</span><span class="sxs-lookup"><span data-stu-id="d7c20-163">For more information about server operations and permissions, see [Configure Service Accounts &#40;Analysis Services&#41;](configure-service-accounts-analysis-services.md).</span></span>  
  
 <span data-ttu-id="d7c20-164">In questa sezione viene illustrato come configurare Analysis Services per la delega trusted.</span><span class="sxs-lookup"><span data-stu-id="d7c20-164">This section explains how to set up Analysis Services for trusted delegation.</span></span> <span data-ttu-id="d7c20-165">Dopo aver completato questa attività, Analysis Services potrà passare le credenziali delegate a SQL Server, a supporto della modalità DirectQuery usata nelle soluzioni tabulari.</span><span class="sxs-lookup"><span data-stu-id="d7c20-165">After you complete this task, Analysis Services will be able to pass delegated credentials to SQL Server, in support of DirectQuery mode used in Tabular solutions.</span></span>  
  
 <span data-ttu-id="d7c20-166">Prima di iniziare:</span><span class="sxs-lookup"><span data-stu-id="d7c20-166">Before you start:</span></span>  
  
-   <span data-ttu-id="d7c20-167">Verificare che Analysis Services sia avviato.</span><span class="sxs-lookup"><span data-stu-id="d7c20-167">Verify that Analysis Services is started.</span></span>  
  
-   <span data-ttu-id="d7c20-168">Verificare che il nome SPN registrato per Analysis Services sia valido.</span><span class="sxs-lookup"><span data-stu-id="d7c20-168">Verify the SPN registered for Analysis Services is valid.</span></span> <span data-ttu-id="d7c20-169">Per istruzioni, vedere [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md)</span><span class="sxs-lookup"><span data-stu-id="d7c20-169">For instructions, see [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md)</span></span>  
  
 <span data-ttu-id="d7c20-170">Quando entrambi i prerequisiti vengono soddisfatti, continuare con la procedura seguente.</span><span class="sxs-lookup"><span data-stu-id="d7c20-170">When both prerequisites are satisfied, continue with the following steps.</span></span> <span data-ttu-id="d7c20-171">Si noti che è necessario essere un amministratore di dominio per configurare la delega vincolata.</span><span class="sxs-lookup"><span data-stu-id="d7c20-171">Note that you must be a domain administrator to set up constrained delegation.</span></span>  
  
1.  <span data-ttu-id="d7c20-172">In Utenti e computer di Active Directory, individuare l'account del servizio con cui viene eseguito Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="d7c20-172">In Active Directory Users and Computers, find the service account under which Analysis Services runs.</span></span> <span data-ttu-id="d7c20-173">Fare clic con il pulsante destro del mouse sull'account del servizio e scegliere **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="d7c20-173">Right-click the service account and choose **Properties**.</span></span>  
  
     <span data-ttu-id="d7c20-174">A fini illustrativi, le seguenti catture di schermata usano OlapSvc e SQLSvc per rappresentare rispettivamente Analysis Services e SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d7c20-174">For illustrative purposes, the following screenshots use OlapSvc and SQLSvc to represent Analysis Services and SQL Server, respectively.</span></span>  
  
     <span data-ttu-id="d7c20-175">OlapSvc è l'account che verrà configurato per la delega vincolata in SQLSvc.</span><span class="sxs-lookup"><span data-stu-id="d7c20-175">OlapSvc is the account that will be configured for constrained delegation to SQLSvc.</span></span> <span data-ttu-id="d7c20-176">Al termine di questa attività, OlapSvc disporrà delle autorizzazioni necessarie per passare le credenziali delegate su un ticket di servizio a SQLSvc, rappresentando il chiamante originale al momento di richiedere i dati.</span><span class="sxs-lookup"><span data-stu-id="d7c20-176">When you complete this task, OlapSvc will have permission to pass delegated credentials on a service ticket to SQLSvc, impersonating the original caller when requesting data.</span></span>  
  
2.  <span data-ttu-id="d7c20-177">Nella scheda Delega selezionare **Utente attendibile per la delega solo ai servizi specificati**, seguito da **Usa solo Kerberos**.</span><span class="sxs-lookup"><span data-stu-id="d7c20-177">On the Delegation tab, select **Trust this user for delegation to specified services only**, followed by **Use Kerberos only**.</span></span> <span data-ttu-id="d7c20-178">Fare clic su **Aggiungi** per specificare il servizio per il quale Analysis Services è autorizzato a delegare le credenziali.</span><span class="sxs-lookup"><span data-stu-id="d7c20-178">Click **Add** to specify which service Analysis Services is permitted to delegate credentials.</span></span>  
  
     <span data-ttu-id="d7c20-179">La scheda Delega è disponibile solo se l'account utente (OlapSvc) viene assegnato a un servizio (Analysis Services) e il servizio dispone di un nome SPN registrato.</span><span class="sxs-lookup"><span data-stu-id="d7c20-179">Delegation tab appears only when the user account (OlapSvc) is assigned to a service (Analysis Services), and the service has an SPN registered for it.</span></span> <span data-ttu-id="d7c20-180">Per registrare il nome SPN è necessario che il servizio sia in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="d7c20-180">SPN registration requires that the service is running.</span></span>  
  
     <span data-ttu-id="d7c20-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span><span class="sxs-lookup"><span data-stu-id="d7c20-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span></span>  
  
3.  <span data-ttu-id="d7c20-182">Nella pagina Aggiungi servizi, fare clic su **Utenti o computer**.</span><span class="sxs-lookup"><span data-stu-id="d7c20-182">On the Add Services page, click **Users or Computers**.</span></span>  
  
     <span data-ttu-id="d7c20-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span><span class="sxs-lookup"><span data-stu-id="d7c20-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span></span>  
  
4.  <span data-ttu-id="d7c20-184">Nella pagina Seleziona utenti o computer immettere l'account usato per eseguire l'istanza di SQL Server che fornisce i dati ai database del modello tabulare di Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="d7c20-184">On the Select Users or Computer page, enter the account used to run the SQL Server instance providing data to Analysis Services tabular model databases.</span></span> <span data-ttu-id="d7c20-185">Fare clic su **OK** per accettare l'account del servizio.</span><span class="sxs-lookup"><span data-stu-id="d7c20-185">Click **OK** to accept the service account.</span></span>  
  
     <span data-ttu-id="d7c20-186">Se non è possibile selezionare l'account desiderato, verificare che SQL Server sia in esecuzione e disponga di un nome SPN registrato per tale account.</span><span class="sxs-lookup"><span data-stu-id="d7c20-186">If you cannot select the account you want, verify that SQL Server is running and has an SPN registered for that account.</span></span> <span data-ttu-id="d7c20-187">Per altre informazioni sui nomi SPN per il motore di database, vedere [Register a Service Principal Name for Kerberos Connections](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span><span class="sxs-lookup"><span data-stu-id="d7c20-187">For more information about SPNs for the database engine, see [Register a Service Principal Name for Kerberos Connections](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
     <span data-ttu-id="d7c20-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span><span class="sxs-lookup"><span data-stu-id="d7c20-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span></span>  
  
5.  <span data-ttu-id="d7c20-189">L'istanza di SQL Server dovrebbe ora apparire in Aggiungi servizi.</span><span class="sxs-lookup"><span data-stu-id="d7c20-189">The SQL Server instance should now appear in Add Services.</span></span> <span data-ttu-id="d7c20-190">Nell'elenco saranno inoltre presente gli altri eventuali servizi che usano l'account in questione.</span><span class="sxs-lookup"><span data-stu-id="d7c20-190">Any service also using that account will also appear in the list.</span></span> <span data-ttu-id="d7c20-191">Scegliere l'istanza di SQL Server da usare.</span><span class="sxs-lookup"><span data-stu-id="d7c20-191">Choose the SQL Server instance you want to use.</span></span> <span data-ttu-id="d7c20-192">Fare clic su **OK** per accettare l'istanza.</span><span class="sxs-lookup"><span data-stu-id="d7c20-192">Click **OK** to accept the instance.</span></span>  
  
     <span data-ttu-id="d7c20-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span><span class="sxs-lookup"><span data-stu-id="d7c20-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span></span>  
  
6.  <span data-ttu-id="d7c20-194">La pagina delle proprietà dell'account del servizio di Analysis Services dovrebbe apparire analoga a quella nella cattura di schermata seguente.</span><span class="sxs-lookup"><span data-stu-id="d7c20-194">The properties page of the Analysis Services service account should now look similar to the following screenshot.</span></span> <span data-ttu-id="d7c20-195">Fare clic su **OK** per salvare le modifiche.</span><span class="sxs-lookup"><span data-stu-id="d7c20-195">Click **OK** to save your changes.</span></span>  
  
     <span data-ttu-id="d7c20-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span><span class="sxs-lookup"><span data-stu-id="d7c20-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span></span>  
  
7.  <span data-ttu-id="d7c20-197">Verificare che la delega avvenga in modo corretto eseguendo la connessione a un computer client remoto, con un'identità diversa ed eseguendo una query sul modello tabulare.</span><span class="sxs-lookup"><span data-stu-id="d7c20-197">Test for successful delegation by connecting from a remote client computer, under a different identity, and query the tabular model.</span></span> <span data-ttu-id="d7c20-198">L'identità utente dovrebbe essere presente nella richiesta in SQL Server Profiler.</span><span class="sxs-lookup"><span data-stu-id="d7c20-198">You should see the user identity on the request in SQL Server Profiler.</span></span>  
  
##  <a name="test-for-impersonated-or-delegated-identity"></a><a name="bkmk_test"></a><span data-ttu-id="d7c20-199">Test per identità rappresentata o delegata</span><span class="sxs-lookup"><span data-stu-id="d7c20-199">Test for impersonated or delegated identity</span></span>  
 <span data-ttu-id="d7c20-200">Usare SQL Server Profiler per monitorare l'identità dell'utente che esegue query sui dati.</span><span class="sxs-lookup"><span data-stu-id="d7c20-200">Use SQL Server Profiler to monitor the identity of the user who is querying data.</span></span>  
  
1.  <span data-ttu-id="d7c20-201">Avviare **SQL Server Profiler** nell'istanza di Analysis Services e quindi avviare una nuova traccia.</span><span class="sxs-lookup"><span data-stu-id="d7c20-201">Start **SQL Server Profiler** on the Analysis Services instance and then start a new trace.</span></span>  
  
2.  <span data-ttu-id="d7c20-202">In Selezione eventi, verificare che `Audit Login` e `Audit Logout` siano selezionati nella sezione Controllo di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="d7c20-202">In Events Selection, verify that `Audit Login` and `Audit Logout` are checked in the Security Audit section.</span></span>  
  
3.  <span data-ttu-id="d7c20-203">Connettersi ad Analysis Services tramite un servizio di applicazione (ad esempio SharePoint o Reporting Services) da un computer client remoto.</span><span class="sxs-lookup"><span data-stu-id="d7c20-203">Connect to Analysis Services via an application service (such as SharePoint or Reporting Services) from a remote client computer.</span></span> <span data-ttu-id="d7c20-204">L'evento Audit Login visualizzerà l'identità dell'utente che si connette ad Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="d7c20-204">The Audit Login event will show the identity of the user connecting to Analysis Services.</span></span>  
  
 <span data-ttu-id="d7c20-205">Per un test completo è necessario usare strumenti di monitoraggio della rete in grado di acquisire richieste e risposte Kerberos.</span><span class="sxs-lookup"><span data-stu-id="d7c20-205">Thorough testing will require the use of network monitoring tools that can capture Kerberos requests and responses on the network.</span></span> <span data-ttu-id="d7c20-206">A tale scopo è possibile usare l'utilità Network Monitor (netmon.exe), con filtro per Kerberos.</span><span class="sxs-lookup"><span data-stu-id="d7c20-206">The Network Monitor utility (netmon.exe), filtered for Kerberos, can be used for this task.</span></span> <span data-ttu-id="d7c20-207">Per altre informazioni sull'utilizzo di Netmon 3.4 e di altri strumenti per verificare l'autenticazione Kerberos, vedere [Configurazione dell'autenticazione Kerberos: configurazione di base (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span><span class="sxs-lookup"><span data-stu-id="d7c20-207">For more information about using Netmon 3.4 and other tools for testing Kerberos authentication, see [Configuring Kerberos authentication: Core configuration (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span></span>  
  
 <span data-ttu-id="d7c20-208">Vedere inoltre [La finestra di dialogo che più disorienta in Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) per una descrizione dettagliata di ciascuna opzione nella scheda Delega della finestra di dialogo delle proprietà dell'oggetto di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d7c20-208">Additionally, see [The Most Confusing Dialog Box in Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) for a thorough description of each option in the Delegation tab of the Active Directory object's property dialog box.</span></span> <span data-ttu-id="d7c20-209">Questo articolo spiega inoltre come usare LDP per eseguire i test e interpretarne i relativi risultati.</span><span class="sxs-lookup"><span data-stu-id="d7c20-209">This article also explains how to use LDP to test and interpret test results.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d7c20-210">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="d7c20-210">See Also</span></span>  
 <span data-ttu-id="d7c20-211">[Delega di identità e autenticazione di Microsoft Business Intelligence](https://go.microsoft.com/fwlink/?LinkID=286576) </span><span class="sxs-lookup"><span data-stu-id="d7c20-211">[Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576) </span></span>  
 <span data-ttu-id="d7c20-212">[Autenticazione reciproca tramite Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span><span class="sxs-lookup"><span data-stu-id="d7c20-212">[Mutual Authentication Using Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span></span>  
 <span data-ttu-id="d7c20-213">[Connetti a Analysis Services](connect-to-analysis-services.md) </span><span class="sxs-lookup"><span data-stu-id="d7c20-213">[Connect to Analysis Services](connect-to-analysis-services.md) </span></span>  
 <span data-ttu-id="d7c20-214">[Registrazione del nome SPN per un'istanza di Analysis Services](spn-registration-for-an-analysis-services-instance.md) </span><span class="sxs-lookup"><span data-stu-id="d7c20-214">[SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) </span></span>  
 [<span data-ttu-id="d7c20-215">Proprietà delle stringhe di connessione &#40;Analysis Services&#41;</span><span class="sxs-lookup"><span data-stu-id="d7c20-215">Connection String Properties &#40;Analysis Services&#41;</span></span>](connection-string-properties-analysis-services.md)  
  
  
