---
title: Replica, Rilevamento modifiche, Change Data Capture e Gruppi di disponibilità AlwaysOn (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- change tracking [SQL Server], AlwaysOn Availability Groups
- change data capture [SQL Server], AlwaysOn Availability Groups
- Availability Groups [SQL Server], interoperability
- replication [SQL Server], AlwaysOn Availability Groups
ms.assetid: e17a9ca9-dd96-4f84-a85d-60f590da96ad
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e8ea6257cb906177b9eb224d718eecf54fb94119
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87626300"
---
# <a name="replication-change-tracking-change-data-capture-and-alwayson-availability-groups-sql-server"></a><span data-ttu-id="e009d-102">Replica, Rilevamento modifiche, Change Data Capture e Gruppi di disponibilità AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e009d-102">Replication, Change Tracking, Change Data Capture, and AlwaysOn Availability Groups (SQL Server)</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="e009d-103">Le funzionalità di replica, di rilevamento delle modifiche (CT, Change Tracking) e Change Data Capture (CDC) sono supportate in [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e009d-103">Replication, change data capture (CDC), and change tracking (CT) are supported on [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="e009d-104">vengono fornite disponibilità elevata e funzionalità aggiuntive di recupero database.</span><span class="sxs-lookup"><span data-stu-id="e009d-104">helps provide high availability and additional database recovery capabilities.</span></span>  
  
 
  
##  <a name="overview-of-replication-on-alwayson-availability-groups"></a><a name="Overview"></a><span data-ttu-id="e009d-105">Panoramica della replica in Gruppi di disponibilità AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="e009d-105">Overview of Replication on AlwaysOn Availability Groups</span></span>  
  
###  <a name="publisher-redirection"></a><a name="PublisherRedirect"></a> <span data-ttu-id="e009d-106">Reindirizzamento del server di pubblicazione</span><span class="sxs-lookup"><span data-stu-id="e009d-106">Publisher Redirection</span></span>  
 <span data-ttu-id="e009d-107">Se un database pubblicato è compatibile con [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], il database di distribuzione tramite cui viene fornito agli agenti l'accesso al database di pubblicazione viene configurato con le voci redirected_publishers.</span><span class="sxs-lookup"><span data-stu-id="e009d-107">When a published database is aware of [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], the distributor that provides agent access to the publishing database is configured with redirected_publishers entries.</span></span> <span data-ttu-id="e009d-108">Tramite queste voci la coppia server di pubblicazione/database configurata originariamente viene reindirizzata, usando un nome del listener del gruppo di disponibilità per connettersi al server e al database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="e009d-108">These entries redirect the originally configured publisher/database pair, making use of an availability group listener name to connect to the publisher and publishing database.</span></span> <span data-ttu-id="e009d-109">Il failover delle connessioni stabilite tramite il nome del listener del gruppo di disponibilità avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="e009d-109">Established connections through the availability group listener name will fail on failover.</span></span> <span data-ttu-id="e009d-110">Al riavvio dell'agente di replica dopo il failover, la connessione verrà reindirizzata automaticamente al nuovo database primario.</span><span class="sxs-lookup"><span data-stu-id="e009d-110">When the replication agent restarts after failover, the connection will automatically be redirected to the new primary.</span></span>  
  
 <span data-ttu-id="e009d-111">In un gruppo di disponibilità AlwaysOn un database secondario non può essere un server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="e009d-111">In an AlwaysOn availability group a secondary database cannot be a publisher.</span></span> <span data-ttu-id="e009d-112">La ripubblicazione non è supportata quando la replica è combinata con [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e009d-112">Republishing is not supported when replication is combined with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="e009d-113">Se un database pubblicato è membro di un gruppo di disponibilità e il server di pubblicazione viene reindirizzato, è necessario reindirizzarlo a un nome del listener del gruppo di disponibilità associato al gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="e009d-113">If a published database is a member of an availability group and the publisher is redirected, it must be redirected to an availability group listener name associated with the availability group.</span></span> <span data-ttu-id="e009d-114">Non è possibile reindirizzarlo a un nodo esplicito.</span><span class="sxs-lookup"><span data-stu-id="e009d-114">It may not be redirected to an explicit node.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e009d-115">Dopo il failover su una replica secondaria, tramite Monitoraggio replica non è possibile regolare il nome dell'istanza di pubblicazione di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] e le informazioni sulla replica continueranno a essere visualizzate con il nome dell'istanza primaria originale di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e009d-115">After failover to a secondary replica, Replication Monitor is unable to adjust the name of the publishing instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and will continue to display replication information under the name of the original primary instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="e009d-116">Dopo il failover, non è possibile immettere un token di traccia tramite Monitoraggio replica, nondimeno un token di traccia immesso nel nuovo server di pubblicazione tramite [!INCLUDE[tsql](../../../includes/tsql-md.md)]è visibile in Monitoraggio replica.</span><span class="sxs-lookup"><span data-stu-id="e009d-116">After failover, a tracer token cannot be entered by using the Replication Monitor, however a tracer token entered on the new publisher by using [!INCLUDE[tsql](../../../includes/tsql-md.md)], is visible in Replication Monitor.</span></span>  
  
###  <a name="general-changes-to-replication-agents-to-support-alwayson-availability-groups"></a><a name="Changes"></a><span data-ttu-id="e009d-117">Modifiche generali apportate agli agenti di replica per supportare Gruppi di disponibilità AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="e009d-117">General Changes to Replication Agents to Support AlwaysOn Availability Groups</span></span>  
 <span data-ttu-id="e009d-118">Tre agenti di replica sono stati modificati per supportare la funzionalità [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e009d-118">Three replication agents were modified to support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="e009d-119">Gli agenti di lettura log, snapshot e di merge sono stati modificati in modo da eseguire query sul database di distribuzione per il server di pubblicazione reindirizzato e usare il nome del listener del gruppo di disponibilità restituito, se è stato dichiarato un server di pubblicazione reindirizzato, per connettersi al server di pubblicazione del database.</span><span class="sxs-lookup"><span data-stu-id="e009d-119">The Log Reader, Snapshot, and Merge agents were modified to query the distribution database for the redirected publisher and to use the returned availability group listener name, if a redirected publisher was declared, to connect to the database publisher.</span></span>  
  
 <span data-ttu-id="e009d-120">Per impostazione predefinita, quando gli agenti eseguono una query sul database di distribuzione per determinare se il server di pubblicazione originale è stato reindirizzato, l'appropriatezza del database di destinazione o del reindirizzamento corrente verrà verificata prima che l'host reindirizzato venga restituito all'agente.</span><span class="sxs-lookup"><span data-stu-id="e009d-120">By default, when the agents query the distributor to determine whether the original publisher has been redirected, the suitability of the current target or redirection will be verified prior to returning the redirected host to the agent.</span></span> <span data-ttu-id="e009d-121">Questo è il comportamento consigliato.</span><span class="sxs-lookup"><span data-stu-id="e009d-121">This is recommended behavior.</span></span> <span data-ttu-id="e009d-122">Tuttavia, se l'avvio dell'agente si verifica molto frequentemente, l'overhead associato alla stored procedure di convalida può essere ritenuto troppo costoso.</span><span class="sxs-lookup"><span data-stu-id="e009d-122">However, if agent start up occurs very frequently the overhead associated with the validation stored procedure may be deemed too costly.</span></span> <span data-ttu-id="e009d-123">Una nuova opzione della riga di comando, *BypassPublisherValidation*, è stata aggiunta agli agenti di lettura log, snapshot e di merge.</span><span class="sxs-lookup"><span data-stu-id="e009d-123">A new command line switch, *BypassPublisherValidation*, has been added to the Logreader, Snapshot, and Merge agents.</span></span> <span data-ttu-id="e009d-124">Quando viene usata l'opzione, il server di pubblicazione reindirizzato viene restituito immediatamente all'agente e l'esecuzione della stored procedure di convalida viene ignorata.</span><span class="sxs-lookup"><span data-stu-id="e009d-124">When the switch is used, the redirected publisher is returned immediately to the agent and execution of the validation stored procedure is bypassed.</span></span>  
  
 <span data-ttu-id="e009d-125">Gli errori restituiti dalla stored procedure di convalida vengono registrati nei log della cronologia degli agenti.</span><span class="sxs-lookup"><span data-stu-id="e009d-125">Failures returned from the validation stored procedure are logged in the agent history logs.</span></span> <span data-ttu-id="e009d-126">Gli errori con gravità maggiore o uguale a 16 causeranno l'interruzione degli agenti.</span><span class="sxs-lookup"><span data-stu-id="e009d-126">Those errors with severity greater than or equal to 16 will cause the agents to terminate.</span></span> <span data-ttu-id="e009d-127">Gli agenti includono ora alcune funzionalità per effettuare nuovi tentativi in modo da gestire la disconnessione prevista da un database pubblicato in caso di failover su un nuovo database primario.</span><span class="sxs-lookup"><span data-stu-id="e009d-127">Some retry capabilities have been built in to the agents to handle the expected disconnect from a published database when it fails over to a new primary.</span></span>  
  
#### <a name="log-reader-agent-modifications"></a><span data-ttu-id="e009d-128">Modifiche all'agente di lettura log</span><span class="sxs-lookup"><span data-stu-id="e009d-128">Log Reader Agent Modifications</span></span>  
 <span data-ttu-id="e009d-129">L'agente di lettura log include le modifiche riportate di seguito.</span><span class="sxs-lookup"><span data-stu-id="e009d-129">The Logreader Agent has the following changes.</span></span>  
  
-   <span data-ttu-id="e009d-130">**Coerenza dei database replicati**</span><span class="sxs-lookup"><span data-stu-id="e009d-130">**Replicated Database Consistency**</span></span>  
  
     <span data-ttu-id="e009d-131">Quando un database pubblicato è membro di un gruppo di disponibilità AlwaysOn, per impostazione predefinita tramite la lettura log non vengono elaborati record di log che non sono già stati finalizzati in tutte le repliche secondarie del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="e009d-131">When a published database is a member of an AlwaysOn availability group, by default the log reader will not process log records that have not already been hardened at all availability group secondary replicas.</span></span> <span data-ttu-id="e009d-132">In questo modo, viene garantito che al failover tutte le righe replicate a un sottoscrittore siano anche presenti nel nuovo database primario.</span><span class="sxs-lookup"><span data-stu-id="e009d-132">This insures that on failover, all rows replicated to a subscriber also are present at the new primary.</span></span>  
  
     <span data-ttu-id="e009d-133">Se nel server di pubblicazione sono disponibili solo due repliche di disponibilità AlwaysOn, una primaria e una secondaria, e si verifica un failover, la replica primaria originale rimane inattiva perché l'agente di lettura log non procede finché tutti i database secondari non saranno riportati online o finché le repliche secondarie in cui si è verificato l'errore non verranno rimosse dal gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="e009d-133">When the publisher has only two AlwaysOn availability replicas (one primary and one secondary) and a failover happens, the original primary replica remains down because the logreader does not move forward until all secondary databases are brought back online or until the failing secondary replicas are removed from the availability group.</span></span> <span data-ttu-id="e009d-134">L'agente di lettura log, che attualmente viene eseguito nel database secondario, non procederà poiché tramite AlwaysOn non è possibile finalizzare le eventuali modifiche in nessun database secondario.</span><span class="sxs-lookup"><span data-stu-id="e009d-134">The logreader, now running against the secondary database, will not proceed forward since AlwaysOn cannot harden any changes to any secondary database.</span></span> <span data-ttu-id="e009d-135">Per consentire all'agente di lettura log di procedere e mantenere la funzionalità di ripristino di emergenza, rimuovere la replica primaria originale dal gruppo di disponibilità usando ALTER AVAILABITY GROUP <nome_gruppo> REMOVE REPLICA.</span><span class="sxs-lookup"><span data-stu-id="e009d-135">To allow the logreader to proceed further and still have disaster recovery capacity, remove the original primary replica from the availability group using ALTER AVAILABITY GROUP <group_name> REMOVE REPLICA.</span></span> <span data-ttu-id="e009d-136">Successivamente, aggiungere una nuova replica secondaria al gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="e009d-136">Then add a new secondary replica to the availability group.</span></span>  
  
-   <span data-ttu-id="e009d-137">**Flag di traccia 1448**</span><span class="sxs-lookup"><span data-stu-id="e009d-137">**Trace flag 1448**</span></span>  
  
     <span data-ttu-id="e009d-138">Con il flag di traccia 1448 è possibile far procedere l'agente lettura log repliche anche se il ricevimento di una modifica non è stato riconosciuto dalle repliche secondarie asincrone.</span><span class="sxs-lookup"><span data-stu-id="e009d-138">Trace flag 1448 enables the replication log reader to move forward even if the asynchronous secondary replicas have not acknowledged the reception of a change.</span></span> <span data-ttu-id="e009d-139">Anche con questo flag di traccia abilitato, tramite l'agente di lettura log vengono sempre attese le repliche secondarie sincrone.</span><span class="sxs-lookup"><span data-stu-id="e009d-139">Even with this trace flag enabled,, the log reader always waits for the synchronous secondary replicas.</span></span> <span data-ttu-id="e009d-140">L'agente di lettura log non procederà oltre il riconoscimento minimo delle repliche secondarie sincrone.</span><span class="sxs-lookup"><span data-stu-id="e009d-140">The log reader will not go beyond the min ack of the synchronous secondary replicas.</span></span> <span data-ttu-id="e009d-141">Questo flag di traccia si applica all'istanza di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], non solo a un gruppo di disponibilità, a un database di disponibilità o a un'istanza di lettura log.</span><span class="sxs-lookup"><span data-stu-id="e009d-141">This trace flag applies to the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], not just to an availability group, an availability database, or a log reader instance.</span></span> <span data-ttu-id="e009d-142">Questo flag di traccia diventa immediatamente effettivo senza un riavvio.</span><span class="sxs-lookup"><span data-stu-id="e009d-142">This trace flag takes effect immediately without a restart.</span></span> <span data-ttu-id="e009d-143">Può essere attivato anticipatamente o quando si verifica un errore in una replica secondaria asincrona.</span><span class="sxs-lookup"><span data-stu-id="e009d-143">It can be activated ahead of time or when an asynchronous secondary replica fails.</span></span>  
  
###  <a name="stored-procedures-supporting-alwayson"></a><a name="StoredProcs"></a><span data-ttu-id="e009d-144">Stored procedure che supportano AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="e009d-144">Stored Procedures Supporting AlwaysOn</span></span>  
  
-   <span data-ttu-id="e009d-145">**sp_redirect_publisher**</span><span class="sxs-lookup"><span data-stu-id="e009d-145">**sp_redirect_publisher**</span></span>  
  
     <span data-ttu-id="e009d-146">La stored procedure **sp_redirect_publisher** viene usata per specificare un server di pubblicazione reindirizzato per una coppia server di pubblicazione/database esistente.</span><span class="sxs-lookup"><span data-stu-id="e009d-146">The stored procedure **sp_redirect_publisher** is used to specify a redirected publisher for an existing publisher/database pair.</span></span> <span data-ttu-id="e009d-147">Se il server di pubblicazione appartiene a un gruppo di disponibilità, il server di pubblicazione reindirizzato è il nome del listener del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="e009d-147">If the publisher database belongs to an availability group, the redirected publisher is the availability group listener name.</span></span>  
  
-   <span data-ttu-id="e009d-148">**sp_get_redirected_publisher**</span><span class="sxs-lookup"><span data-stu-id="e009d-148">**sp_get_redirected_publisher**</span></span>  
  
     <span data-ttu-id="e009d-149">La stored procedure **sp_get_redirected_publisher** viene usata dagli agenti di replica per eseguire una query su un database di distribuzione allo scopo di determinare se per una coppia server di pubblicazione/database è definito un server di pubblicazione reindirizzato.</span><span class="sxs-lookup"><span data-stu-id="e009d-149">The stored procedure **sp_get_redirected_publisher** is used by replication agents to query a distributor to determine whether a publisher/database pair has a defined redirected publisher.</span></span> <span data-ttu-id="e009d-150">Questa stored procedure ha due scopi.</span><span class="sxs-lookup"><span data-stu-id="e009d-150">This stored procedure serves two purposes.</span></span> <span data-ttu-id="e009d-151">Innanzitutto, consente all'agente di determinare se il server di pubblicazione originale è stato reindirizzato.</span><span class="sxs-lookup"><span data-stu-id="e009d-151">First, it allows the agent to determine whether the original publisher has been redirected.</span></span> <span data-ttu-id="e009d-152">In secondo luogo, può anche avviare l'esecuzione di una stored procedure di convalida nel database di distribuzione (**sp_validate_redirected_publisher**) per verificare l'appropriatezza del nodo di destinazione del reindirizzamento a fungere da server di pubblicazione per il database denominato.</span><span class="sxs-lookup"><span data-stu-id="e009d-152">Second, it may also initiate a validation stored procedure run at the distributor (**sp_validate_redirected_publisher**) that verifies the suitability of the target node of the redirection to serve as a publisher for the named database.</span></span>  
  
     <span data-ttu-id="e009d-153">Per eseguire questa stored procedure è necessario che il chiamante sia membro del ruolo del server **sysadmin** , del ruolo del database **db_owner** per il database di distribuzione o di un **elenco di accesso alla pubblicazione** per una pubblicazione definita associata al server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="e009d-153">To execute this stored procedure the caller must either be a member of the **sysadmin** server role, the **db_owner** database role for the distribution database, or a member of a **Publication Access List** for a defined publication associated with the publisher database.</span></span>  
  
-   <span data-ttu-id="e009d-154">**sp_validate_redirected_publisher**</span><span class="sxs-lookup"><span data-stu-id="e009d-154">**sp_validate_redirected_publisher**</span></span>  
  
     <span data-ttu-id="e009d-155">Questa stored procedure tenta di convalidare la capacità del server di pubblicazione corrente di ospitare il database pubblicato.</span><span class="sxs-lookup"><span data-stu-id="e009d-155">This stored procedure attempts to validate that the current publisher is capable of hosting the published database.</span></span> <span data-ttu-id="e009d-156">Può essere chiamata in qualsiasi momento per verificare che l'host corrente per il database pubblicato sia in grado di supportare la replica.</span><span class="sxs-lookup"><span data-stu-id="e009d-156">It can be called at any time to verify that the current host for the published database is capable of supporting replication.</span></span>  
  
-   <span data-ttu-id="e009d-157">**sp_validate_replicate_hosts_as_publishers**</span><span class="sxs-lookup"><span data-stu-id="e009d-157">**sp_validate_replicate_hosts_as_publishers**</span></span>  
  
     <span data-ttu-id="e009d-158">Benché sia utile per gli agenti garantire che il server primario corrente funzioni come server di pubblicazione di replica per un server di pubblicazione, una funzionalità di convalida più generale è necessaria per stabilire la validità di un'intera topologia di replica in un database di disponibilità AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="e009d-158">While it is useful for the agents to insure that the current primary can function as the replication publisher for a publisher database, a more general validation capability is needed to establish the validity of an entire replication topology on an AlwaysOn availability database.</span></span> <span data-ttu-id="e009d-159">La stored procedure **sp_validate_replica_hosts_as_publishers** è progettata per tale esigenza.</span><span class="sxs-lookup"><span data-stu-id="e009d-159">The stored procedure **sp_validate_replica_hosts_as_publishers** is designed to fill this need.</span></span>  
  
     <span data-ttu-id="e009d-160">Questa stored procedure viene sempre eseguita manualmente.</span><span class="sxs-lookup"><span data-stu-id="e009d-160">This stored procedure is always run manually.</span></span> <span data-ttu-id="e009d-161">Il chiamante deve avere il ruolo di **sysadmin** nel database di distribuzione, **dbowner** nel database di distribuzione o deve essere membro dell' **elenco di accesso alla pubblicazione** di una pubblicazione del server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="e009d-161">The caller must either be **sysadmin** at the distributor, **dbowner** of the distribution database, or a member of the **Publication Access List** of a publication of the publisher database.</span></span> <span data-ttu-id="e009d-162">Inoltre, l'accesso del chiamante deve essere valido per tutti gli host di replica di disponibilità e devono essere disponibili privilegi selezionati nel database di disponibilità associato al server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="e009d-162">In addition, the login of the caller must be a valid login for all of the availability replica hosts, and have select privileges on the availability database associated with the publisher database.</span></span>  
  
###  <a name="change-data-capture"></a><a name="CDC"></a> <span data-ttu-id="e009d-163">Change Data Capture</span><span class="sxs-lookup"><span data-stu-id="e009d-163">Change Data Capture</span></span>  
 <span data-ttu-id="e009d-164">Nei database abilitati per Change Data Capture (CDC) è possibile sfruttare [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] non solo per assicurare che il database rimanga disponibile in caso di errore, ma anche per fare in modo che le modifiche apportate alle tabelle del database continuino a essere monitorate e depositate nelle tabelle delle modifiche CDC.</span><span class="sxs-lookup"><span data-stu-id="e009d-164">Databases enabled for change data capture (CDC) are able to leverage [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] in order to insure not only that the database remains available in the event of failure, but that changes to the database tables continue to be monitored and deposited in the CDC change tables.</span></span> <span data-ttu-id="e009d-165">L'ordine in cui CDC e [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] sono configurati non è importante.</span><span class="sxs-lookup"><span data-stu-id="e009d-165">The order in which CDC and [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] are configured is not important.</span></span> <span data-ttu-id="e009d-166">I database abilitati per CDC possono essere aggiunti a [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]e i database che sono membri di un gruppo di disponibilità AlwaysOn possono essere abilitati per CDC.</span><span class="sxs-lookup"><span data-stu-id="e009d-166">CDC enabled databases can be added to [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], and databases that are members of an AlwaysOn availability group can be enabled for CDC.</span></span> <span data-ttu-id="e009d-167">In entrambi i casi, tuttavia, la configurazione di CDC viene sempre eseguita nella replica corrente o progettata.</span><span class="sxs-lookup"><span data-stu-id="e009d-167">In both cases, however, CDC configuration is always performed on the current or intended primary replica.</span></span> <span data-ttu-id="e009d-168">In CDC viene usato l'agente di lettura log e sono presenti le stesse limitazioni descritte nella sezione **Modifiche all'agente di lettura log** riportata in precedenza in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="e009d-168">CDC uses the log reader agent and has the same limitations as described in the **Log Reader Agent Modifications** section earlier in this topic.</span></span>  
  
-   <span data-ttu-id="e009d-169">**Raccolta di modifiche per Change Data Capture senza replica**</span><span class="sxs-lookup"><span data-stu-id="e009d-169">**Harvesting Changes for Change Data Capture Without Replication**</span></span>  
  
     <span data-ttu-id="e009d-170">Se CDC è abilitato per un database, ma la replica non lo è, il processo di acquisizione usato per raccogliere le modifiche dal log e depositarle nelle tabelle delle modifiche CDC viene eseguito nell'host CDC come processo di SQL Agent.</span><span class="sxs-lookup"><span data-stu-id="e009d-170">If CDC is enabled for a database, but replication is not, the capture process used to harvest changes from the log and deposit them in CDC change tables runs at the CDC host as its own SQL Agent job.</span></span>  
  
     <span data-ttu-id="e009d-171">Per riprendere la raccolta delle modifiche dopo il failover, è necessario eseguire la stored procedure **sp_cdc_add_job** nel nuovo database primario per creare il processo di acquisizione locale.</span><span class="sxs-lookup"><span data-stu-id="e009d-171">In order to resume the harvesting of changes after failover, the stored procedure **sp_cdc_add_job** must be run at the new primary to create the local capture job.</span></span>  
  
     <span data-ttu-id="e009d-172">Nell'esempio seguente viene creato il processo di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="e009d-172">The following example creates the capture job.</span></span>  
  
    ```  
    EXEC sys.sp_cdc_add_job @job_type = 'capture';  
    ```  
  
-   <span data-ttu-id="e009d-173">**Raccolta di modifiche per Change Data Capture con replica**</span><span class="sxs-lookup"><span data-stu-id="e009d-173">**Harvesting Changes for Change Data Capture With Replication**</span></span>  
  
     <span data-ttu-id="e009d-174">Se sia CDC sia la replica sono abilitati per un database, tramite la lettura log viene gestito il popolamento delle tabelle delle modifiche CDC.</span><span class="sxs-lookup"><span data-stu-id="e009d-174">If both CDC and replication are enabled for a database, the log reader handles the population of the CDC change tables.</span></span> <span data-ttu-id="e009d-175">In questo caso, le tecniche usate dalla replica per sfruttare [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] garantiranno che le modifiche continueranno a essere raccolte dal log e depositate nelle tabelle delle modifiche CDC dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="e009d-175">In this case, the techniques used by replication to leverage [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] will insure that changes continue to be harvested from the log and deposited in CDC change tables after failover.</span></span> <span data-ttu-id="e009d-176">Non è necessario aggiungere alcuna azione in questa configurazione di CDC per assicurare che le tabelle delle modifiche vengano popolate.</span><span class="sxs-lookup"><span data-stu-id="e009d-176">Nothing additional needs to be done for CDC in this configuration to insure that the change tables are populated.</span></span>  
  
-   <span data-ttu-id="e009d-177">**Pulizia di Change Data Capture**</span><span class="sxs-lookup"><span data-stu-id="e009d-177">**Change Data Capture Cleanup**</span></span>  
  
     <span data-ttu-id="e009d-178">Per assicurare l'esecuzione della pulizia appropriata nel nuovo database primario, è necessario creare sempre un processo di pulizia locale.</span><span class="sxs-lookup"><span data-stu-id="e009d-178">To insure that appropriate cleanup occurs at the new primary database, a local cleanup job should always be created.</span></span> <span data-ttu-id="e009d-179">Nell'esempio seguente viene creato il processo di pulizia.</span><span class="sxs-lookup"><span data-stu-id="e009d-179">The following example creates the cleanup job.</span></span>  
  
    ```  
    EXEC sys.sp_cdc_add_job @job_type = 'cleanup';  
    ```  
  
    > [!NOTE]  
    >  <span data-ttu-id="e009d-180">È consigliabile creare i processi per tutte le possibili destinazioni di failover prima del failover e contrassegnarli come disabilitati finché la replica di disponibilità in un host non diventa la nuova replica primaria.</span><span class="sxs-lookup"><span data-stu-id="e009d-180">You should create the jobs at all of the possible failover targets before failover, and mark them as disabled until the availability replica at a host becomes the new primary replica.</span></span> <span data-ttu-id="e009d-181">È inoltre necessario disabilitare i processi CDC in esecuzione nel database primario precedente quando il database locale diventa un database secondario.</span><span class="sxs-lookup"><span data-stu-id="e009d-181">The CDC jobs running at the old primary database should be also disabled when the local database becomes a secondary database.</span></span> <span data-ttu-id="e009d-182">Per disabilitare e abilitare i processi, usare l' *@enabled* opzione di [sp_update_job &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-update-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e009d-182">To disable and enable jobs, use the *@enabled* option of [sp_update_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-update-job-transact-sql).</span></span> <span data-ttu-id="e009d-183">Per altre informazioni sulla creazione di processi CDC, vedere [sys.sp_cdc_add_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e009d-183">For more information about creating CDC jobs, see [sys.sp_cdc_add_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql).</span></span>  
  
-   <span data-ttu-id="e009d-184">**Aggiunta di ruoli CDC a una replica di database primario AlwaysOn**</span><span class="sxs-lookup"><span data-stu-id="e009d-184">**Adding CDC Roles to an AlwaysOn Primary Database Replica**</span></span>  
  
     <span data-ttu-id="e009d-185">Quando una tabella è abilitata per CDC, è possibile associare un ruolo di database all'istanza di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="e009d-185">When a table is enabled for CDC, it is possible to associate a database role with the capture instance.</span></span> <span data-ttu-id="e009d-186">Se viene specificato un ruolo, l'utente che desidera usare le funzioni con valori di tabella di CDC per accedere alle modifiche della tabella deve non solo disporre dell'accesso SELECT alle colonne della tabella con rilevamento, ma essere anche un membro del ruolo denominato.</span><span class="sxs-lookup"><span data-stu-id="e009d-186">If a role is specified, the user wishing to use the CDC table-valued functions to access changes for the table must not only have select access to the tracked table columns, but must also be a member of the named role.</span></span> <span data-ttu-id="e009d-187">Se il ruolo specificato non esiste già, verrà creato.</span><span class="sxs-lookup"><span data-stu-id="e009d-187">If the specified role does not already exist, the role will be created.</span></span> <span data-ttu-id="e009d-188">Quando i ruoli del database vengono aggiunti automaticamente a un database primario AlwaysOn, i ruoli vengono propagati anche nei database secondari del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="e009d-188">When database roles are automatically added to an AlwaysOn primary database, the roles are also propagated to the secondary databases of the availability group.</span></span>  
  
-   <span data-ttu-id="e009d-189">**Applicazioni client che accedono a CDC e AlwaysOn**</span><span class="sxs-lookup"><span data-stu-id="e009d-189">**Client Applications Accessing CDC Change Data and Always On**</span></span>  
  
     <span data-ttu-id="e009d-190">Le applicazioni client che usano le funzioni con valori di tabella o server collegati per accedere ai dati delle tabelle delle modifiche devono poter essere in grado di individuare un host CDC appropriato dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="e009d-190">Client applications that use the table-valued functions (TVFs) or linked servers to access change table data also need the ability to locate an appropriate CDC host after failover.</span></span> <span data-ttu-id="e009d-191">Il nome del listener del gruppo di disponibilità è il meccanismo fornito da [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] per consentire in modo trasparente il reindirizzamento di una connessione a un host differente.</span><span class="sxs-lookup"><span data-stu-id="e009d-191">The availability group listener name is the mechanism provided by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] to transparently allow a connection to be retargeted to a different host.</span></span> <span data-ttu-id="e009d-192">Una volta associato a un gruppo di disponibilità, un nome del listener del gruppo di disponibilità è disponibile per essere usato nelle stringhe di connessione TCP.</span><span class="sxs-lookup"><span data-stu-id="e009d-192">Once an availability group listener name is associated with an availability group, it is available to be used in TCP connection strings.</span></span> <span data-ttu-id="e009d-193">Due diversi scenari di connessione sono supportati tramite il nome del listener del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="e009d-193">Two different connection scenarios are supported through the availability group listener name.</span></span>  
  
    -   <span data-ttu-id="e009d-194">In uno si assicura che le richieste di connessione vengano sempre indirizzate alla replica primaria corrente.</span><span class="sxs-lookup"><span data-stu-id="e009d-194">One insures that connection requests are always directed to the current primary replica.</span></span>  
  
    -   <span data-ttu-id="e009d-195">Nell'altro si garantisce che le richieste di connessione vengano indirizzate a una replica secondaria di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="e009d-195">One insures that connection requests are directed to a read-only secondary replica.</span></span>  
  
     <span data-ttu-id="e009d-196">Se usato per individuare una replica secondaria di sola lettura, è necessario anche definire un elenco di routing di sola lettura per il gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="e009d-196">If used to locate a read-only secondary replica, a read-only routing list must also be defined for the availability group.</span></span> <span data-ttu-id="e009d-197">Per altre informazioni sull'accesso in routing ai database secondari leggibili, vedere [Per configurare repliche di disponibilità per il routing di sola lettura](../../listeners-client-connectivity-application-failover.md#ConfigureARsForROR).</span><span class="sxs-lookup"><span data-stu-id="e009d-197">For more information about routing access to readable secondaries, see [To Configure Availability Replicas for Read-Only Routing](../../listeners-client-connectivity-application-failover.md#ConfigureARsForROR).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="e009d-198">Nella creazione di un nome del listener del gruppo di disponibilità e nell'utilizzo dello stesso nelle applicazioni client per accedere alla replica di database del gruppo di disponibilità si verifica un ritardo di propagazione.</span><span class="sxs-lookup"><span data-stu-id="e009d-198">There is some propagation delay associated with the creation of an availability group listener name and its use by client applications to access an availability group database replica.</span></span>  
  
     <span data-ttu-id="e009d-199">Usare la query seguente per determinare se un nome del listener del gruppo di disponibilità è stato definito per il gruppo di disponibilità che ospita un database CDC.</span><span class="sxs-lookup"><span data-stu-id="e009d-199">Use the following query to determine whether an availability group listener name has been defined for the availability group hosting a CDC database.</span></span> <span data-ttu-id="e009d-200">La query restituirà il nome del listener del gruppo di disponibilità se ne è stato creato uno.</span><span class="sxs-lookup"><span data-stu-id="e009d-200">The query will return the availability group listener name if one has been created.</span></span>  
  
    ```  
    SELECT dns_name   
    FROM sys.availability_group_listeners AS l  
    INNER JOIN sys.availability_databases_cluster AS d  
        ON l.group_id = d.group_id  
    WHERE d.database_name = N'MyCDCDB';  
    ```  
  
-   <span data-ttu-id="e009d-201">**Reindirizzamento del carico delle query a una replica secondaria leggibile**</span><span class="sxs-lookup"><span data-stu-id="e009d-201">**Redirecting the Query Load to a Readable Secondary Replica**</span></span>  
  
     <span data-ttu-id="e009d-202">Anche se in molti casi tramite un'applicazione client verrà sempre effettuato il tentativo di connessione alla replica primaria corrente, questo non è il solo modo per sfruttare [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e009d-202">While in many cases a client application will always want to connect to the current primary replica that is not the only way to leverage [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="e009d-203">Se un gruppo di disponibilità viene configurato per supportare repliche secondarie leggibili, è possibile raggruppare i dati delle modifiche anche dai nodi secondari.</span><span class="sxs-lookup"><span data-stu-id="e009d-203">If an availability group is configured to support readable secondary replicas, change data can also be gathered from secondary nodes.</span></span>  
  
     <span data-ttu-id="e009d-204">Quando viene configurato un gruppo di disponibilità, l'attributo ALLOW_CONNECTIONS associato a SECONDARY_ROLE viene usato per specificare il tipo di accesso secondario supportato.</span><span class="sxs-lookup"><span data-stu-id="e009d-204">When an availability group is configured, the ALLOW_CONNECTIONS attribute associated with the SECONDARY_ROLE is used to specify the type of secondary access supported.</span></span> <span data-ttu-id="e009d-205">Se viene configurato come ALL, tutte le connessioni al database secondario saranno accettate, ma solo quelle per cui viene richiesto l'accesso in sola lettura avranno esito positivo.</span><span class="sxs-lookup"><span data-stu-id="e009d-205">If configured as ALL, all connections to the secondary will be allowed, but only those requiring read only access will succeed.</span></span> <span data-ttu-id="e009d-206">Se viene configurato come READ_ONLY, è necessario specificare la finalità di sola lettura mentre si stabilisce la connessione al database secondario affinché la connessione venga stabilita.</span><span class="sxs-lookup"><span data-stu-id="e009d-206">If configured as READ_ONLY, it is necessary to specify read only intent when making the connection to the secondary database in order for the connection to succeed.</span></span> <span data-ttu-id="e009d-207">Per altre informazioni, vedere [Configurare l'accesso in sola lettura in una replica di disponibilità &#40;SQL Server&#41;](configure-read-only-access-on-an-availability-replica-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="e009d-207">For more information, see [Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;](configure-read-only-access-on-an-availability-replica-sql-server.md).</span></span>  
  
     <span data-ttu-id="e009d-208">La query seguente può essere usata per determinare se la finalità di sola lettura è necessaria per connettersi a una replica secondaria leggibile.</span><span class="sxs-lookup"><span data-stu-id="e009d-208">The following query can be used to determine whether read-only intent is needed to connect to a readable secondary replica.</span></span>  
  
    ```  
    SELECT g.name AS AG, replica_server_name, secondary_role_allow_connections_desc  
    FROM sys.availability_replicas AS r  
    JOIN sys.availability_groups AS g  
        ON r.group_id = g.group_id  
    WHERE g.name = N'MY_AG_NAME;  
    ```  
  
     <span data-ttu-id="e009d-209">Per individuare la replica secondaria è possibile usare il nome del listener del gruppo di disponibilità o il nome del nodo esplicito.</span><span class="sxs-lookup"><span data-stu-id="e009d-209">Either the availability group listener name or the explicit node name can be used to locate the secondary replica.</span></span> <span data-ttu-id="e009d-210">Se viene usato il nome del listener del gruppo di disponibilità, l'accesso verrà indirizzato a qualsiasi replica secondaria adatta.</span><span class="sxs-lookup"><span data-stu-id="e009d-210">If the availability group listener name is used, access will be directed to any suitable secondary replica.</span></span>  
  
     <span data-ttu-id="e009d-211">Quando `sp_addlinkedserver` viene usato per creare un server collegato per accedere al database secondario, il *@datasrc* parametro viene usato per il nome del listener del gruppo di disponibilità o il nome del server esplicito e il *@provstr* parametro viene usato per specificare la finalità di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="e009d-211">When `sp_addlinkedserver` is used to create a linked server to access the secondary, the *@datasrc* parameter is used for the availability group listener name or the explicit server name, and the *@provstr* parameter is used to specify read-only intent.</span></span>  
  
    ```  
    EXEC sp_addlinkedserver   
    @server = N'linked_svr',   
    @srvproduct=N'SqlServer',  
    @provider=N'SQLNCLI11',   
    @datasrc=N'AG_Listener_Name',   
    @provstr=N'ApplicationIntent=ReadOnly',   
    @catalog=N'MY_DB_NAME';  
    ```  
  
-   <span data-ttu-id="e009d-212">**Accesso client ai dati delle modifiche CDC e account di accesso al dominio**</span><span class="sxs-lookup"><span data-stu-id="e009d-212">**Client Access to CDC Change Data and Domain Logins**</span></span>  
  
     <span data-ttu-id="e009d-213">In generale, è consigliabile usare account di accesso al dominio per l'accesso client ai dati delle modifiche nei database che sono membri di gruppi di disponibilità AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="e009d-213">In general, you should use domain logins for client access to change data residing in databases that are members of AlwaysOn availability groups.</span></span> <span data-ttu-id="e009d-214">Per assicurare accesso continuato ai dati delle modifiche dopo il failover, l'utente del dominio avrà bisogno di privilegi di accesso su tutti gli host che supportano repliche del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="e009d-214">To insure continued access to change data after failover, the domain user will need access privileges on all of the hosts supporting availability group replicas.</span></span> <span data-ttu-id="e009d-215">Se un utente di database viene aggiunto a un database in una replica primaria e l'utente è associato a un account di accesso al dominio, tale utente viene propagato nei database secondari e continua a essere associato all'account di accesso al dominio specificato.</span><span class="sxs-lookup"><span data-stu-id="e009d-215">If a database user is added to a database in a primary replica, and the user is associated with a domain login, the database user is propagated to secondary databases and continues to be associated with the specified domain login.</span></span> <span data-ttu-id="e009d-216">Se il nuovo utente del database è associato a un account di accesso con autenticazione SQL Server, l'utente nei database secondari sarà propagato senza un account di accesso.</span><span class="sxs-lookup"><span data-stu-id="e009d-216">If the new database user is associated with a SQL Server authentication login, the user at the secondary databases will be propagated without a login.</span></span> <span data-ttu-id="e009d-217">Mentre l'accesso con autenticazione [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] associato potrebbe essere usato per accedere ai dati delle modifiche nel database primario dove l'utente del database è stato definito originariamente, il nodo è il solo in cui sarebbe possibile l'accesso.</span><span class="sxs-lookup"><span data-stu-id="e009d-217">While the associated [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] authentication login could be used to access change data at the primary where the database user was originally defined, that node is the only one where access would be possible.</span></span> <span data-ttu-id="e009d-218">L'accesso con autenticazione [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] non consentirebbe di accedere ai dati da un database secondario, né da un nuovo database primario diverso dal database originale dove è stato definito l'utente del database.</span><span class="sxs-lookup"><span data-stu-id="e009d-218">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] authentication login would not be able to access data from any secondary database, nor from any new primary databases other than the original database where the database user was defined.</span></span>  
  
###  <a name="change-tracking"></a><a name="CT"></a> <span data-ttu-id="e009d-219">Rilevamento delle modifiche</span><span class="sxs-lookup"><span data-stu-id="e009d-219">Change Tracking</span></span>  
 <span data-ttu-id="e009d-220">Un database abilitato per il rilevamento delle modifiche (CT) può far parte di un gruppo di disponibilità AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="e009d-220">A database enabled for change tracking (CT) can be part of an AlwaysOn availability group.</span></span> <span data-ttu-id="e009d-221">Non è necessaria alcuna configurazione aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="e009d-221">No additional configuration is needed.</span></span> <span data-ttu-id="e009d-222">Le applicazioni client di rilevamento delle modifiche in cui vengono usate le funzioni con valori di tabella CDC per accedere ai dati delle modifiche devono poter essere in grado di individuare la replica primaria dopo il failover.</span><span class="sxs-lookup"><span data-stu-id="e009d-222">Change tracking client applications that use the CDC table-valued functions (TVFs) to access change data will need the ability to locate the primary replica after failover.</span></span> <span data-ttu-id="e009d-223">Se l'applicazione client viene connessa tramite il nome del listener del gruppo di disponibilità, le richieste di connessione verranno sempre indirizzate in modo appropriato alla replica primaria corrente.</span><span class="sxs-lookup"><span data-stu-id="e009d-223">If the client application connects through the availability group listener name, connection requests will always be appropriately directed to the current primary replica.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e009d-224">I dati del rilevamento modifiche devono sempre essere ottenuti dalla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="e009d-224">Change tracking data must always be obtained from the primary replica.</span></span> <span data-ttu-id="e009d-225">Un tentativo di accedere ai dati delle modifiche da una replica secondaria comporterà l'errore seguente:</span><span class="sxs-lookup"><span data-stu-id="e009d-225">An attempt to access change data from a secondary replica will result in the following error:</span></span>  
>   
>  <span data-ttu-id="e009d-226">Messaggio 22117, livello 16, stato 1, riga 1</span><span class="sxs-lookup"><span data-stu-id="e009d-226">Msg 22117, Level 16, State 1, Line1</span></span>  
>   
>  <span data-ttu-id="e009d-227">Per i database membri di una replica secondaria (cioè per i database secondari), il rilevamento delle modifiche non è supportato.</span><span class="sxs-lookup"><span data-stu-id="e009d-227">For databases that are members of a secondary replica (that is, for secondary databases), change tracking is not supported.</span></span> <span data-ttu-id="e009d-228">Eseguire le query di rilevamento modifiche sui database nella replica primaria.</span><span class="sxs-lookup"><span data-stu-id="e009d-228">Run change tracking queries on the databases in the primary replica.</span></span>  
  
##  <a name="prerequisites-restrictions-and-considerations-for-using-replication"></a><a name="Prereqs"></a> <span data-ttu-id="e009d-229">Prerequisiti, restrizioni e considerazioni per l'utilizzo della replica</span><span class="sxs-lookup"><span data-stu-id="e009d-229">Prerequisites, Restrictions, and Considerations for Using Replication</span></span>  
 <span data-ttu-id="e009d-230">In questa sezione vengono descritte le considerazioni per la distribuzione della replica con la funzionalità [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], inclusi prerequisiti, restrizioni e suggerimenti.</span><span class="sxs-lookup"><span data-stu-id="e009d-230">This section describes considerations for deploying replication with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], including prerequisites, restrictions, and recommendations.</span></span>  
  
### <a name="prerequisites"></a><span data-ttu-id="e009d-231">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="e009d-231">Prerequisites</span></span>  
  
-   <span data-ttu-id="e009d-232">Quando si usano la replica transazionale e il database di pubblicazione si trova in un gruppo di disponibilità, sia nel server di pubblicazione che nel database di distribuzione deve essere in esecuzione almeno [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e009d-232">When using transactional replication and the publishing database is in an availability group both the publisher and the distributor must run at least [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span> <span data-ttu-id="e009d-233">Il sottoscrittore può invece usare un livello inferiore di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e009d-233">The subscriber can be using a lower level of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="e009d-234">Quando si usano la replica di tipo merge e il database di pubblicazione è in un gruppo di disponibilità:</span><span class="sxs-lookup"><span data-stu-id="e009d-234">When using merge replication and the publishing database is in an availability group:</span></span>  
  
    -   <span data-ttu-id="e009d-235">Sottoscrizione push: sia nel server di pubblicazione che nel database di distribuzione deve essere in esecuzione almeno [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e009d-235">Push subscription: Both the publisher and the distributor must run at least [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span>  
  
    -   <span data-ttu-id="e009d-236">Sottoscrizione pull: nel server di pubblicazione e nei database di distribuzione e sottoscrittore deve essere in esecuzione almeno [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e009d-236">Pull subscription: The publisher, distributor, and subscriber databases must be on at least [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span> <span data-ttu-id="e009d-237">Ciò è dovuto al fatto che l'agente di merge nel sottoscrittore deve comprendere il modo in cui in un gruppo di disponibilità può essere eseguito il failover sul secondario.</span><span class="sxs-lookup"><span data-stu-id="e009d-237">This is because the merge agent on the subscriber must understand how an availability group can fail over to its secondary.</span></span>  
  
-   <span data-ttu-id="e009d-238">L'inserimento del database di distribuzione in un gruppo di disponibilità non è supportato.</span><span class="sxs-lookup"><span data-stu-id="e009d-238">Placing the distribution database on an availability group is not supported.</span></span>  
  
-   <span data-ttu-id="e009d-239">Le istanze del server di pubblicazione soddisfano tutti i prerequisiti richiesti per fare parte di un gruppo di disponibilità AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="e009d-239">The Publisher instances satisfy all the prerequisites required to participate in an AlwaysOn availability group.</span></span> <span data-ttu-id="e009d-240">Per ulteriori informazioni [, vedere Prerequisiti, restrizioni e consigli per Gruppi di disponibilità AlwaysOn &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span><span class="sxs-lookup"><span data-stu-id="e009d-240">For more information see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="restrictions"></a><span data-ttu-id="e009d-241">Restrizioni</span><span class="sxs-lookup"><span data-stu-id="e009d-241">Restrictions</span></span>  
 <span data-ttu-id="e009d-242">Combinazioni supportate di replica in [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="e009d-242">Supported combinations of replication on [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]:</span></span>  
  
|||||  
|-|-|-|-|  
||<span data-ttu-id="e009d-243">**Autore**</span><span class="sxs-lookup"><span data-stu-id="e009d-243">**Publisher**</span></span>|<span data-ttu-id="e009d-244">**Server di distribuzione** <sup>3</sup></span><span class="sxs-lookup"><span data-stu-id="e009d-244">**Distributor** <sup>3</sup></span></span>|<span data-ttu-id="e009d-245">**Sottoscrittore**</span><span class="sxs-lookup"><span data-stu-id="e009d-245">**Subscriber**</span></span>|  
|<span data-ttu-id="e009d-246">**Transazionale**</span><span class="sxs-lookup"><span data-stu-id="e009d-246">**Transactional**</span></span>|<span data-ttu-id="e009d-247">Sì<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="e009d-247">Yes<sup>1</sup></span></span>|<span data-ttu-id="e009d-248">No</span><span class="sxs-lookup"><span data-stu-id="e009d-248">No</span></span>|<span data-ttu-id="e009d-249">Sì<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="e009d-249">Yes<sup>2</sup></span></span>|  
|<span data-ttu-id="e009d-250">**P2P**</span><span class="sxs-lookup"><span data-stu-id="e009d-250">**P2P**</span></span>|<span data-ttu-id="e009d-251">No</span><span class="sxs-lookup"><span data-stu-id="e009d-251">No</span></span>|<span data-ttu-id="e009d-252">No</span><span class="sxs-lookup"><span data-stu-id="e009d-252">No</span></span>|<span data-ttu-id="e009d-253">No</span><span class="sxs-lookup"><span data-stu-id="e009d-253">No</span></span>|  
|<span data-ttu-id="e009d-254">**Merge**</span><span class="sxs-lookup"><span data-stu-id="e009d-254">**Merge**</span></span>|<span data-ttu-id="e009d-255">Sì</span><span class="sxs-lookup"><span data-stu-id="e009d-255">Yes</span></span>|<span data-ttu-id="e009d-256">No</span><span class="sxs-lookup"><span data-stu-id="e009d-256">No</span></span>|<span data-ttu-id="e009d-257">Sì<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="e009d-257">Yes<sup>2</sup></span></span>|  
|<span data-ttu-id="e009d-258">**Snapshot**</span><span class="sxs-lookup"><span data-stu-id="e009d-258">**Snapshot**</span></span>|<span data-ttu-id="e009d-259">Sì</span><span class="sxs-lookup"><span data-stu-id="e009d-259">Yes</span></span>|<span data-ttu-id="e009d-260">No</span><span class="sxs-lookup"><span data-stu-id="e009d-260">No</span></span>|<span data-ttu-id="e009d-261">Sì<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="e009d-261">Yes<sup>2</sup></span></span>|  
  
 <span data-ttu-id="e009d-262"><sup>1</sup> non include il supporto per la replica transazionale bidirezionale e reciproca.</span><span class="sxs-lookup"><span data-stu-id="e009d-262"><sup>1</sup> Does not include support for bi-directional and reciprocal transactional replication.</span></span>  
  
 <span data-ttu-id="e009d-263"><sup>2</sup> il failover al database di replica è una procedura manuale.</span><span class="sxs-lookup"><span data-stu-id="e009d-263"><sup>2</sup> Failover to the replica database is a manual procedure.</span></span> <span data-ttu-id="e009d-264">Il failover automatico non è fornito.</span><span class="sxs-lookup"><span data-stu-id="e009d-264">Automatic failover is not provided.</span></span>  
  
 <span data-ttu-id="e009d-265"><sup>3</sup> il database del server di distribuzione non è supportato per l'utilizzo con [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] o il mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="e009d-265"><sup>3</sup> The Distributor database is not supported for use with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] or database mirroring.</span></span>  
  
### <a name="considerations"></a><span data-ttu-id="e009d-266">Considerazioni</span><span class="sxs-lookup"><span data-stu-id="e009d-266">Considerations</span></span>  
  
-   <span data-ttu-id="e009d-267">Non è supportato l'utilizzo del database di distribuzione con [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] o il mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="e009d-267">The distribution database is not supported for use with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] or database mirroring.</span></span> <span data-ttu-id="e009d-268">La configurazione della replica è associata all'istanza di SQL Server in cui è configurato il database di distribuzione; pertanto non è possibile eseguire il mirroring o la replica del database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="e009d-268">Replication configuration is coupled to the SQL Server instance where the Distributor is configured; therefore the distribution database cannot be mirrored or replicated.</span></span> <span data-ttu-id="e009d-269">Per fornire la disponibilità elevata per il database di distribuzione, usare un cluster di failover di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e009d-269">To provide high availability for the Distributor, use a SQL Server failover cluster.</span></span> <span data-ttu-id="e009d-270">Per altre informazioni, vedere [Istanze del cluster di failover Always On (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="e009d-270">For more information, see [AlwaysOn Failover Cluster Instances (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
-   <span data-ttu-id="e009d-271">Il failover del Sottoscrittore su un database secondario, se supportato, è una procedura manuale relativamente complessa.</span><span class="sxs-lookup"><span data-stu-id="e009d-271">Subscriber failover to a secondary database, while supported, is a relatively complex manual procedure.</span></span> <span data-ttu-id="e009d-272">La procedura è essenzialmente identica al metodo usato per il failover a un database sottoscrittore con mirroring.</span><span class="sxs-lookup"><span data-stu-id="e009d-272">The procedure is essentially identical to the method used to fail over a mirrored subscriber database.</span></span> <span data-ttu-id="e009d-273">È necessario che nei Sottoscrittori sia in esecuzione [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] o versione successiva perché possano fare parte di un gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="e009d-273">Subscribers must be running [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] or later to participate in an availability group.</span></span>  
  
-   <span data-ttu-id="e009d-274">I metadati e gli oggetti esterni al database, ad esempio account di accesso, processi e server collegati, non vengono propagati alle repliche secondarie.</span><span class="sxs-lookup"><span data-stu-id="e009d-274">Metadata and objects that exist outside the database are not propagated to the secondary replicas, including logins, jobs, linked servers.</span></span> <span data-ttu-id="e009d-275">Se i metadati e gli oggetti sono necessari nel nuovo database primario dopo il failover, è necessario copiarli manualmente.</span><span class="sxs-lookup"><span data-stu-id="e009d-275">If you require the metadata and objects at the new primary database after failover, you must copy them manually.</span></span> <span data-ttu-id="e009d-276">Per altre informazioni, vedere [Gestione di account di accesso e processi per i database di un gruppo di disponibilità &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span><span class="sxs-lookup"><span data-stu-id="e009d-276">For more information, see [Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="e009d-277">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="e009d-277">Related Tasks</span></span>  
 <span data-ttu-id="e009d-278">**Replica**</span><span class="sxs-lookup"><span data-stu-id="e009d-278">**Replication**</span></span>  
  
-   [<span data-ttu-id="e009d-279">Configurare la replica per i gruppi di disponibilità AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e009d-279">Configure Replication for AlwaysOn Availability Groups (SQL Server)</span></span>](always-on-availability-groups-sql-server.md)  
  
-   [<span data-ttu-id="e009d-280">Gestione di un database di pubblicazione AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e009d-280">Maintaining an AlwaysOn Publication Database &#40;SQL Server&#41;</span></span>](maintaining-an-always-on-publication-database-sql-server.md)  
  
-   [<span data-ttu-id="e009d-281">Domande frequenti sull'amministrazione della replica</span><span class="sxs-lookup"><span data-stu-id="e009d-281">Replication Administration FAQ</span></span>](../../../relational-databases/replication/administration/frequently-asked-questions-for-replication-administrators.md)  
  
 <span data-ttu-id="e009d-282">**Change data capture**</span><span class="sxs-lookup"><span data-stu-id="e009d-282">**Change data capture**</span></span>  
  
-   [<span data-ttu-id="e009d-283">Abilitare e disabilitare Change Data Capture &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e009d-283">Enable and Disable Change Data Capture &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/enable-and-disable-change-data-capture-sql-server.md)  
  
-   [<span data-ttu-id="e009d-284">Amministrare e monitorare Change Data Capture &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e009d-284">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
-   [<span data-ttu-id="e009d-285">Usare i dati delle modifiche &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e009d-285">Work with Change Data &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/work-with-change-data-sql-server.md)  
  
 <span data-ttu-id="e009d-286">**Change tracking**</span><span class="sxs-lookup"><span data-stu-id="e009d-286">**Change tracking**</span></span>  
  
-   [<span data-ttu-id="e009d-287">Abilitare e disabilitare il rilevamento delle modifiche &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e009d-287">Enable and Disable Change Tracking &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/enable-and-disable-change-tracking-sql-server.md)  
  
-   [<span data-ttu-id="e009d-288">Gestire il rilevamento delle modifiche &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e009d-288">Manage Change Tracking &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/manage-change-tracking-sql-server.md)  
  
-   [<span data-ttu-id="e009d-289">Utilizzare il rilevamento delle modifiche &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e009d-289">Work with Change Tracking &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/work-with-change-tracking-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="e009d-290">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="e009d-290">See Also</span></span>  
 <span data-ttu-id="e009d-291">[Sottoscrittori della replica e Gruppi di disponibilità AlwaysOn &#40;SQL Server&#41;](replication-subscribers-and-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e009d-291">[Replication Subscribers and AlwaysOn Availability Groups &#40;SQL Server&#41;](replication-subscribers-and-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="e009d-292">[Prerequisiti, restrizioni e consigli per Gruppi di disponibilità AlwaysOn &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md) </span><span class="sxs-lookup"><span data-stu-id="e009d-292">[Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md) </span></span>  
 <span data-ttu-id="e009d-293">[Panoramica di Gruppi di disponibilità AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e009d-293">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="e009d-294">Gruppi di disponibilità AlwaysOn: istanze del cluster di failover AlwaysOn di [interoperabilità (SQL Server)](always-on-availability-groups-interoperability-sql-server.md) [(SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e009d-294">[AlwaysOn Availability Groups: Interoperability (SQL Server)](always-on-availability-groups-interoperability-sql-server.md) [AlwaysOn Failover Cluster Instances (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) </span></span>  
 <span data-ttu-id="e009d-295">[Informazioni su Change Data Capture &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e009d-295">[About Change Data Capture &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="e009d-296">[Informazioni sul rilevamento delle modifiche &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-tracking-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e009d-296">[About Change Tracking &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-tracking-sql-server.md) </span></span>  
 <span data-ttu-id="e009d-297">[Replica di SQL Server](../../../relational-databases/replication/sql-server-replication.md) </span><span class="sxs-lookup"><span data-stu-id="e009d-297">[SQL Server Replication](../../../relational-databases/replication/sql-server-replication.md) </span></span>  
 <span data-ttu-id="e009d-298">[Tenere traccia delle modifiche ai dati &#40;SQL Server&#41;](../../../relational-databases/track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e009d-298">[Track Data Changes &#40;SQL Server&#41;](../../../relational-databases/track-changes/track-data-changes-sql-server.md) </span></span>  
 [<span data-ttu-id="e009d-299">sys.sp_cdc_add_job &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="e009d-299">sys.sp_cdc_add_job &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql)  
  
  
