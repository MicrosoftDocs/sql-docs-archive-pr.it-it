---
title: Transazioni tra database non supportate per il mirroring del database o la Gruppi di disponibilità AlwaysOn (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- cross-database transactions [SQL Server]
- transactions [database mirroring]
- Availability Groups [SQL Server], interoperability
- troubleshooting [SQL Server], cross-database transactions
ms.assetid: 9f7ed895-ad65-43e3-ba08-00d7bff1456d
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: a0e23e073375c8f00317003635df8ec0b69883cd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87724963"
---
# <a name="cross-database-transactions-not-supported-for-database-mirroring-or-alwayson-availability-groups-sql-server"></a><span data-ttu-id="c4e40-102">Transazioni tra database non supportate per il mirroring del database o i gruppi di disponibilità AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c4e40-102">Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups (SQL Server)</span></span>
  <span data-ttu-id="c4e40-103">Le transazioni tra database e quelle distribuite non sono supportate da [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] o dal mirroring del database</span><span class="sxs-lookup"><span data-stu-id="c4e40-103">Cross-database transactions and distributed transactions are not supported by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] or by database mirroring.</span></span> <span data-ttu-id="c4e40-104">perché l'atomicità e integrità delle transazioni non può essere garantita per i motivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="c4e40-104">This is because transaction atomicity/integrity cannot be guaranteed for the following reasons:</span></span>  
  
-   <span data-ttu-id="c4e40-105">In caso di transazioni tra database, il relativo commit viene eseguito in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="c4e40-105">For cross-database transactions: Each database commits independently.</span></span> <span data-ttu-id="c4e40-106">Pertanto, anche per i database presenti in un solo gruppo di disponibilità, potrebbe verificarsi un failover dopo il commit di una transazione da parte di un database, ma prima che la stessa operazione venga effettuata da un altro database.</span><span class="sxs-lookup"><span data-stu-id="c4e40-106">Therefore, even for databases in a single availability group, a failover could occur after one database commits a transaction but before the other database does.</span></span> <span data-ttu-id="c4e40-107">Per il mirroring del database questo problema è ancora più complesso perché dopo un failover, il database con mirroring si trova in genere in un'istanza del server diversa dall'altro database e, anche se viene eseguito il mirroring di entrambi i database tra gli stessi due partner, non esiste garanzia alcuna che verrà eseguito il failover di entrambi i database contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="c4e40-107">For database mirroring this issue is compounded because after a failover, the mirrored database is typically on a different server instance from the other database, and  even if both databases are mirrored between the same two partners, there is no guarantee that both databases will fail over at the same time.</span></span>  
  
-   <span data-ttu-id="c4e40-108">In caso di transazioni distribuite, dopo un failover, tramite il nuovo server principale o la nuova replica primaria non è possibile effettuare la connessione al Distributed Transaction Coordinator (DTC) nel server principale o nella replica primaria precedente.</span><span class="sxs-lookup"><span data-stu-id="c4e40-108">For distributed transactions: After a failover, the new principal server/primary replica is unable to connect to the distributed transaction coordinator on the previous principal server/primary replica.</span></span> <span data-ttu-id="c4e40-109">Per questo motivo, tramite il nuovo server principale o la nuova replica primaria non è possibile ottenere lo stato delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="c4e40-109">Therefore, the new principal server/primary replica cannot obtain the transaction status.</span></span>  
  
 <span data-ttu-id="c4e40-110">Nell'esempio di mirroring del database seguente si illustra come può verificarsi un'incoerenza logica.</span><span class="sxs-lookup"><span data-stu-id="c4e40-110">The following database mirroring example illustrates how a logical inconsistency could occur.</span></span> <span data-ttu-id="c4e40-111">In questo esempio un'applicazione utilizza una transazione tra database per inserire due righe di dati. Una riga viene inserita in una tabella in un database con mirroring, A, l'altra viene inserita in un altro database, B. Il database A viene sottoposto a mirroring in modalità a protezione elevata con failover automatico.</span><span class="sxs-lookup"><span data-stu-id="c4e40-111">In this example, an application uses a cross-database transaction to insert two rows of data: one row is inserted into a table in a mirrored database, A, and the other row is inserted into a table in another database, B. Database A is being mirrored in high-safety mode with automatic failover.</span></span> <span data-ttu-id="c4e40-112">Durante il commit della transazione, il database A diventa non disponibile e viene automaticamente eseguito il failover della sessione di mirroring sul mirror del database A.</span><span class="sxs-lookup"><span data-stu-id="c4e40-112">While the transaction is being committed, database A becomes unavailable, and the mirroring session automatically fails over to the mirror of database A.</span></span>  
  
 <span data-ttu-id="c4e40-113">Dopo il failover, è possibile che il commit della transazione tra database abbia esito positivo sul database B, ma non sul database di cui è stato eseguito il failover.</span><span class="sxs-lookup"><span data-stu-id="c4e40-113">After the failover, the cross-database transaction might be successfully committed on database B but not on the failed-over database.</span></span> <span data-ttu-id="c4e40-114">Questa situazione si verifica qualora il server principale originale del database A non abbia inviato il log per la transazione tra database al server mirror prima dell'errore.</span><span class="sxs-lookup"><span data-stu-id="c4e40-114">This would occur if the original principal server for database A had not sent the log for the cross-database transaction to the mirror server before the failure.</span></span> <span data-ttu-id="c4e40-115">Dopo il failover, tale transazione non è più presente nel nuovo server principale.</span><span class="sxs-lookup"><span data-stu-id="c4e40-115">After the failover, that transaction would not exist on the new principal server.</span></span> <span data-ttu-id="c4e40-116">I database A e B diventano incoerenti perché i dati inseriti nel database B rimangono inalterati, mentre quelli inseriti nel database A sono stati persi.</span><span class="sxs-lookup"><span data-stu-id="c4e40-116">Databases A and B would become inconsistent, because the data inserted in database B remains intact, but the data inserted in database A has been lost.</span></span>  
  
 <span data-ttu-id="c4e40-117">Uno scenario analogo può verificarsi quando si utilizza una transazione MS DTC.</span><span class="sxs-lookup"><span data-stu-id="c4e40-117">A similar scenario can occur while using a MS DTC transaction.</span></span> <span data-ttu-id="c4e40-118">Ad esempio, dopo il failover, il nuovo server principale contatta MS DTC.</span><span class="sxs-lookup"><span data-stu-id="c4e40-118">For example, after failover, the new principal contacts MS DTC.</span></span> <span data-ttu-id="c4e40-119">MS DTC, tuttavia, non rileva il nuovo server principale e termina tutte le transazioni di cui si sta preparando il commit e per le quali in altri database il commit viene considerato eseguito.</span><span class="sxs-lookup"><span data-stu-id="c4e40-119">But MS DTC has no knowledge of the new principal server, and it terminates any transactions that are "preparing to commit," which are considered committed in other databases.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="c4e40-120">L'utilizzo del mirroring del database o dei gruppi di disponibilità con DTC non comporta un'installazione non supportata di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c4e40-120">Using Database Mirroring or Availability Groups together with DTC does not result in an unsupported SQL Server installation.</span></span> <span data-ttu-id="c4e40-121">Se, tuttavia, un database fa parte di una sessione di mirroring del database o di un gruppo di disponibilità e nel database viene utilizzato anche DTC, i problemi di supporto verranno esaminati da Microsoft solo se non correlati all'utilizzo combinato del mirroring del database o dei gruppi di disponibilità con DTC.</span><span class="sxs-lookup"><span data-stu-id="c4e40-121">If, however, a database is part of a Database Mirroring session or an Availability Group and DTC is also used in the database, support issues will be investigated by Microsoft only if unrelated to the combined use of Database Mirroring or Availability Groups with DTC.</span></span>  
  
  
