---
title: Eseguire un failover manuale forzato di un gruppo di disponibilità (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
f1_keywords:
- sql12.swb.availabilitygroup.forcefailover.f1
helpviewer_keywords:
- Availability Groups [SQL Server], failover
- failover [SQL Server], AlwaysOn Availability Groups
ms.assetid: 222288fe-ffc0-4567-b624-5d91485d70f0
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: f36908102a09eb1ef1f7a485898da715deb4253b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87627403"
---
# <a name="perform-a-forced-manual-failover-of-an-availability-group-sql-server"></a><span data-ttu-id="53363-102">Eseguire un failover manuale forzato di un gruppo di disponibilità (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="53363-102">Perform a Forced Manual Failover of an Availability Group (SQL Server)</span></span>
  <span data-ttu-id="53363-103">In questo argomento viene illustrato come eseguire un failover forzato (con possibile perdita di dati) in un gruppo di disponibilità AlwaysOn tramite [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)]o PowerShell in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="53363-103">This topic describes how to perform a forced failover (with possible data loss) on an AlwaysOn availability group by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or PowerShell in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="53363-104">Un failover forzato rappresenta un tipo di failover manuale che deve essere utilizzato esclusivamente per il ripristino di emergenza, se non è possibile eseguire un [failover manuale pianificato](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md) .</span><span class="sxs-lookup"><span data-stu-id="53363-104">A forced failover is a form of manual failover that is intended strictly for disaster recovery, when a [planned manual failover](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md) is not possible.</span></span> <span data-ttu-id="53363-105">Se si forza il failover in una replica secondaria non sincronizzata, è possibile che vengano persi alcuni dati.</span><span class="sxs-lookup"><span data-stu-id="53363-105">If you force failover to an unsynchronized secondary replica, some data loss is possible.</span></span> <span data-ttu-id="53363-106">È pertanto consigliabile forzare il failover solo se è necessario ripristinare immediatamente il servizio nel gruppo di disponibilità e si è disposti a rischiare la perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="53363-106">Therefore, we strongly recommend that you force failover only if you must restore service to the availability group immediately and you are willing to risk losing data.</span></span>  
  
 <span data-ttu-id="53363-107">Dopo un failover forzato, la destinazione a cui è stato eseguito il failover del gruppo di disponibilità diventa la nuova replica primaria.</span><span class="sxs-lookup"><span data-stu-id="53363-107">After a forced failover, the failover target to which the availability group was failed over becomes the new primary replica.</span></span> <span data-ttu-id="53363-108">I database secondari nelle repliche secondarie rimanenti vengono sospesi e dovranno essere ripresi manualmente.</span><span class="sxs-lookup"><span data-stu-id="53363-108">The secondary databases in the remaining secondary replicas are suspended and must be manually resumed.</span></span> <span data-ttu-id="53363-109">Quando la replica primaria precedente diventa disponibile, passa al ruolo secondario. In questo modo i database primari precedenti diventano database secondari e passano allo stato SUSPENDED.</span><span class="sxs-lookup"><span data-stu-id="53363-109">When the former primary replica becomes available, it transitions to the secondary role, causing the former primary databases to become secondary databases and transition into the SUSPENDED state.</span></span> <span data-ttu-id="53363-110">Prima di riprendere uno specifico database secondario, è possibile che si riesca a recuperare i dati perduti.</span><span class="sxs-lookup"><span data-stu-id="53363-110">Before you resume a given secondary database, you might be able to recover lost data from it.</span></span> <span data-ttu-id="53363-111">Si tenga tuttavia presente che il troncamento del log delle transazioni viene ritardato in uno specifico database primario mentre i relativi database secondari sono sospesi.</span><span class="sxs-lookup"><span data-stu-id="53363-111">However, notice that transaction log truncation is delayed on a given primary database while any of its secondary databases is suspended.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="53363-112">La sincronizzazione dei dati con il database primario non verrà eseguita fino a quando non viene ripreso il database secondario.</span><span class="sxs-lookup"><span data-stu-id="53363-112">Data synchronization with the primary database will not occur until the secondary database is resumed.</span></span> <span data-ttu-id="53363-113">Per informazioni sulla ripresa di un database secondario, vedere [Completamento: Attività essenziali dopo un failover forzato](#FollowUp) più avanti in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="53363-113">For information about resuming a secondary database, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp) later in this article.</span></span>  
  
 <span data-ttu-id="53363-114">È necessario eseguire un failover forzato nelle situazioni di emergenza indicate di seguito.</span><span class="sxs-lookup"><span data-stu-id="53363-114">Performing a forced failover is necessary in the following emergency situations:</span></span>  
  
-   <span data-ttu-id="53363-115">Dopo aver forzato il quorum del cluster WSFC (*forced quorum*), sarà necessario forzare il failover di ogni gruppo di disponibilità (con possibile perdita di dati).</span><span class="sxs-lookup"><span data-stu-id="53363-115">After forcing quorum on the WSFC cluster (*forced quorum*), you need to force failover each availability group (with possible data loss).</span></span> <span data-ttu-id="53363-116">Il failover forzato è necessario poiché lo stato effettivo dei valori del cluster WSFC potrebbe essere andato perso.</span><span class="sxs-lookup"><span data-stu-id="53363-116">Forcing failover is required because the real state of the WSFC cluster values might have been lost.</span></span> <span data-ttu-id="53363-117">È tuttavia possibile evitare la perdita di dati, se si riesce a forzare il failover nell'istanza del server che ospitava la replica primaria prima di forzare il quorum o in una replica secondaria sincronizzata prima di forzare il quorum.</span><span class="sxs-lookup"><span data-stu-id="53363-117">However, you can avoid data loss, if are able to force failover on the server instance that was hosting the replica that was the primary replica before you forced quorum or to a secondary replica that was synchronized before you forced quorum.</span></span> <span data-ttu-id="53363-118">Per ulteriori informazioni, vedere [Metodi possibili per evitare la perdita di dati dopo aver forzato il quorum](#WaysToAvoidDataLoss)più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="53363-118">For more information, see [Potential Ways to Avoid Data Loss After Quorum is Forced](#WaysToAvoidDataLoss), later in this topic.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="53363-119">Se il quorum viene recuperato naturalmente, senza bisogno di forzarlo, le repliche di disponibilità verranno sottoposte al normale processo di recupero.</span><span class="sxs-lookup"><span data-stu-id="53363-119">If quorum is regained by natural means instead of being forced, the availability replicas will go through normal recovery.</span></span> <span data-ttu-id="53363-120">Se la replica primaria non risulta ancora disponibile dopo aver recuperato il quorum, è possibile eseguire un failover manuale pianificato in una replica secondaria sincronizzata.</span><span class="sxs-lookup"><span data-stu-id="53363-120">If the primary replica is still unavailable after quorum is regained, you can perform a planned manual failover to a synchronized secondary replica.</span></span>  
  
     <span data-ttu-id="53363-121">Per informazioni sulla forzatura del quorum, vedere [Ripristino di emergenza WSFC tramite quorum forzato &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="53363-121">For information about forcing quorum, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span> <span data-ttu-id="53363-122">Per informazioni sui motivi per cui il failover forzato è necessario dopo la forzatura del quorum, vedere [Failover e modalità di failover &#40;gruppi di disponibilità AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="53363-122">For information about why forcing failover is required after forcing quorum, see [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="53363-123">Se la replica primaria non è più disponibile dopo che il cluster WSFC ha conseguito un quorum integro, è possibile forzare il failover (con possibile perdita di dati) in qualsiasi replica con ruolo in stato SECONDARY o RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="53363-123">If the primary replica becomes unavailable when the WSFC cluster has a healthy quorum, you can force failover (with possible data loss), to any replica whose role is in the SECONDARY or RESOLVING state.</span></span> <span data-ttu-id="53363-124">Se possibile, forzare il failover in una replica secondaria con commit sincrono che era sincronizzata quando la replica primaria è andata persa.</span><span class="sxs-lookup"><span data-stu-id="53363-124">If possible, force failover to a synchronous-commit secondary replica that was synchronized when the primary replica was lost.</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="53363-125">Quando il cluster WSFC consegue un quorum integro, se si esegue un comando di failover forzato in una replica secondaria sincronizzata, la replica eseguirà in realtà un failover manuale pianificato.</span><span class="sxs-lookup"><span data-stu-id="53363-125">When the WSFC cluster has a healthy quorum, if you issue a force failover command on a synchronized secondary replica, the replica actually performs a planned manual failover.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="53363-126">Per altre informazioni sui prerequisiti e sui consigli per il failover forzato e per uno scenario di esempio in cui si usa un failover forzato per il recupero da un errore irreversibile, vedere [Scenario di esempio: Utilizzo di un failover forzato per il ripristino da un errore irreversibile](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md#ExampleRecoveryFromCatastrophy) più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="53363-126">For more information about the prerequisites and recommendations for forcing failover and for an example scenario that uses a forced failover to recover from a catastrophic failure, see [Example Scenario: Using a Forced Failover to Recover from a Catastrophic Failure](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md#ExampleRecoveryFromCatastrophy), later in this topic.</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="53363-127">Prima di iniziare</span><span class="sxs-lookup"><span data-stu-id="53363-127">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="53363-128">Limitazioni e restrizioni</span><span class="sxs-lookup"><span data-stu-id="53363-128">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="53363-129">L'unico caso in cui non è possibile eseguire un failover forzato si verifica quando il cluster WSFC (Windows Server Failover Clustering) non dispone del quorum.</span><span class="sxs-lookup"><span data-stu-id="53363-129">The only time that you cannot perform a forced failover is when Windows Server Failover Clustering (WSFC) cluster lacks quorum.</span></span>  
  
-   <span data-ttu-id="53363-130">È possibile che si verifichi una perdita di dati durante il failover forzato di un gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="53363-130">Data loss is possible during the forced failover of an availability group.</span></span> <span data-ttu-id="53363-131">Inoltre, se la replica primaria è in esecuzione quando si inizia un failover forzato, è possibile che i client siano ancora connessi ai database primari precedenti.</span><span class="sxs-lookup"><span data-stu-id="53363-131">In addition, if the primary replica is running when you initiate a forced failover, clients might still be connected to former primary databases.</span></span> <span data-ttu-id="53363-132">Pertanto, è consigliabile forzare il failover solo se la replica primaria non è più in esecuzione e si è disposti a rischiare la perdita di dati per ripristinare l'accesso ai database nel gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="53363-132">Therefore, we strongly recommend that you force failover only if the primary replica is no longer running and if you are willing to risk losing data in order to restore access to databases in the availability group.</span></span>  
  
-   <span data-ttu-id="53363-133">Quando un database secondario si trova nello stato REVERTING o INITIALIZING, il failover forzato provocherebbe il mancato avvio del database come database primario.</span><span class="sxs-lookup"><span data-stu-id="53363-133">When a secondary database in the REVERTING or INITIALIZING state, forcing failover would cause the database to fail to start as a primary database.</span></span> <span data-ttu-id="53363-134">Se il database era nello stato INITIALIZING, sarà necessario applicare i record del log mancanti da un backup del database o ripristinare completamente il database.</span><span class="sxs-lookup"><span data-stu-id="53363-134">If the database was in the INTIAILIZGING state the you will need to apply the missing log records from a database backup or fully restore the database from scratch.</span></span> <span data-ttu-id="53363-135">Se il database era nello stato REVERTING, sarà necessario ripristinare completamente il database dai backup.</span><span class="sxs-lookup"><span data-stu-id="53363-135">If the database was in the REVERTING state you will need to fully restore the database from backups.</span></span>  
  
-   <span data-ttu-id="53363-136">Un comando di failover viene eseguito non appena la destinazione di failover avrà accettato il comando.</span><span class="sxs-lookup"><span data-stu-id="53363-136">A failover command returns as soon as the failover target has accepted the command.</span></span> <span data-ttu-id="53363-137">Tuttavia, il recupero del database si verifica in modo asincrono dopo che il gruppo di disponibilità ha completato il failover.</span><span class="sxs-lookup"><span data-stu-id="53363-137">However, database recovery occurs asynchronously after the availability group has finished failing over.</span></span>  
  
-   <span data-ttu-id="53363-138">La coerenza tra i database all'interno del gruppo di disponibilità non viene mantenuta nel failover.</span><span class="sxs-lookup"><span data-stu-id="53363-138">Cross-database consistency across databases within the availability group is not maintained on failover.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="53363-139">Le transazioni tra database e quelle distribuite non sono supportate in [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="53363-139">Cross-database transactions and distributed transactions are not supported by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="53363-140">Per altre informazioni, vedere [Transazioni tra database non supportate per il mirroring del database o i gruppi di disponibilità AlwaysOn &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="53363-140">For more information, see [Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md).</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="53363-141">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="53363-141">Prerequisites</span></span>  
  
-   <span data-ttu-id="53363-142">Il cluster WSFC dispone del quorum.</span><span class="sxs-lookup"><span data-stu-id="53363-142">The WSFC cluster has quorum.</span></span> <span data-ttu-id="53363-143">Se il cluster non dispone del quorum, vedere [Ripristino di emergenza WSFC tramite quorum forzato &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="53363-143">If the cluster lacks quorum, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span>  
  
-   <span data-ttu-id="53363-144">È necessario connettersi a un'istanza del server che ospita una replica con ruolo in stato SECONDARY o RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="53363-144">You must be able to connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state.</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="53363-145">Indicazioni</span><span class="sxs-lookup"><span data-stu-id="53363-145">Recommendations</span></span>  
  
-   <span data-ttu-id="53363-146">Non forzare il failover mentre la replica primaria è ancora in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="53363-146">Do not force failover while the primary replica is still running.</span></span>  
  
-   <span data-ttu-id="53363-147">Se possibile, forzare il failover solo in una destinazione di failover con database secondari in stato NOT SYNCHRONIZED, SYNCHRONIZED o SYNCHRONIZING.</span><span class="sxs-lookup"><span data-stu-id="53363-147">If possible, force failover only to a failover target whose secondary databases are either in the NOT SYNCHRONIZED, SYNCHRONIZED, or SYNCHRONIZING state.</span></span> <span data-ttu-id="53363-148">Per informazioni sulle implicazioni del failover forzato quando un database secondario è nello stato INITIALIZING o REVERTING, vedere [Limitazioni e restrizioni](#Restrictions), in precedenza in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="53363-148">For information about the implications of forcing failover when a secondary database is in the INTIAILIZGING or REVERTING state, see [Limitations and Restrictions](#Restrictions), earlier in this topic.</span></span>  
  
-   <span data-ttu-id="53363-149">In genere la latenza di un determinato database secondario, rispetto al database primario, dovrebbe essere simile nelle diverse repliche secondarie con commit asincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-149">Typically, the latency of a given secondary database, relative to the primary database, should be similar on different asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="53363-150">Tuttavia, in caso di failover forzato, la perdita di dati può costituire un problema significativo.</span><span class="sxs-lookup"><span data-stu-id="53363-150">However, when forcing failover, data loss can be a significant concern.</span></span> <span data-ttu-id="53363-151">È pertanto consigliabile determinare la latenza relativa delle copie dei database nelle diverse repliche secondarie.</span><span class="sxs-lookup"><span data-stu-id="53363-151">Therefore, consider taking time to determine the relative latency of the copies of the databases on different secondary replicas.</span></span> <span data-ttu-id="53363-152">Per determinare quale copia di un database secondario specifico presenta la latenza minima, confrontare i relativi LSN di fine log.</span><span class="sxs-lookup"><span data-stu-id="53363-152">To determine which copy of a given secondary database has the least latency, compare their end-of-log LSNs.</span></span> <span data-ttu-id="53363-153">Un LSN di fine log più elevato indica una minore latenza.</span><span class="sxs-lookup"><span data-stu-id="53363-153">A higher the end-of-log LSN indicates less latency.</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="53363-154">Per confrontare gli LSN di fine log, connettersi in sequenza a ogni replica secondaria online ed eseguire una query su [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) per ottenere il valore **end_of_log_lsn** di ogni database secondario locale.</span><span class="sxs-lookup"><span data-stu-id="53363-154">To compare end-of-log LSNs, connect to each online secondary replica, in turn, and query [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) for the **end_of_log_lsn** value of each local secondary database.</span></span> <span data-ttu-id="53363-155">Confrontare quindi gli LSN di fine log delle diverse copie di ogni database.</span><span class="sxs-lookup"><span data-stu-id="53363-155">Then, compare the end-of-log LSNs of the different copies of each database.</span></span> <span data-ttu-id="53363-156">Si noti che database diversi potrebbero presentare i relativi LSN più elevati in repliche secondarie diverse.</span><span class="sxs-lookup"><span data-stu-id="53363-156">Note that different databases might have their highest LSNs on different secondary replicas.</span></span> <span data-ttu-id="53363-157">In tal caso, la destinazione del failover più appropriata dipenderà dall'importanza relativa che si attribuisce ai dati nei diversi database,</span><span class="sxs-lookup"><span data-stu-id="53363-157">In this case, the most appropriate failover target depends on the relative importance that you place on the data in the different databases.</span></span> <span data-ttu-id="53363-158">ovvero per quale di questi database si preferirebbe ridurre al minimo una possibile perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="53363-158">That is, for which of these databases would you most want to minimize possible data loss?</span></span>  
  
-   <span data-ttu-id="53363-159">Se i client sono in grado di connettersi alla replica primaria originale, un failover forzato incorre nel rischio di comportamento split-brain.</span><span class="sxs-lookup"><span data-stu-id="53363-159">If clients are able to connect to the original primary, a forced failover incurs some risk of split brain behavior.</span></span> <span data-ttu-id="53363-160">Prima di forzare il failover, è consigliabile impedire ai client di accedere alla replica primaria originale.</span><span class="sxs-lookup"><span data-stu-id="53363-160">Before you force failover, we strongly recommend that you prevent clients from accessing the original primary replica.</span></span> <span data-ttu-id="53363-161">In caso contrario, dopo il failover forzato, i database primari originali e i database primari correnti possono essere aggiornati in modo indipendente gli uni dagli altri.</span><span class="sxs-lookup"><span data-stu-id="53363-161">Otherwise, after failover is forced, the original primary databases and the current primary databases could be updated independently of the other.</span></span>  
  
###  <a name="potential-ways-to-avoid-data-loss-after-quorum-is-forced"></a><a name="WaysToAvoidDataLoss"></a> <span data-ttu-id="53363-162">Metodi possibili per evitare la perdita di dati dopo aver forzato il quorum</span><span class="sxs-lookup"><span data-stu-id="53363-162">Potential Ways to Avoid Data Loss After Quorum is Forced</span></span>  
 <span data-ttu-id="53363-163">In alcune condizioni di errore dopo che il quorum è andato perso, è possibile evitare la perdita di dati nei modi indicati di seguito.</span><span class="sxs-lookup"><span data-stu-id="53363-163">Under some failure conditions after quorum is lost, you can avoid prevent data loss, as follows:</span></span>  
  
-   <span data-ttu-id="53363-164">**Se la replica primaria originale torna online**</span><span class="sxs-lookup"><span data-stu-id="53363-164">**If the original primary replica comes online**</span></span>  
  
     <span data-ttu-id="53363-165">Se il quorum viene perso e la forzatura del quorum WSFC implica il ripristino del nodo del cluster che ospita la replica primaria di un gruppo di disponibilità, è possibile evitare la perdita di dati per questo gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="53363-165">If quorum is lost and forcing WSFC quorum restores the cluster node that hosts the primary replica of an availability group, you can prevent data loss for this availability group.</span></span> <span data-ttu-id="53363-166">Connettersi alla replica primaria ed eseguire un failover forzato (FAILOVER_ALLOW_DATA_LOSS).</span><span class="sxs-lookup"><span data-stu-id="53363-166">Connect to the primary replica and perform a forced failover (FAILOVER_ALLOW_DATA_LOSS).</span></span> <span data-ttu-id="53363-167">In questo modo la replica primaria torna online.</span><span class="sxs-lookup"><span data-stu-id="53363-167">This brings the primary replica back online.</span></span> <span data-ttu-id="53363-168">Non si verifica alcuna perdita di dati, in quanto viene eseguito il failover forzato nella replica primaria originale.</span><span class="sxs-lookup"><span data-stu-id="53363-168">Because you perform the forced failover to the original primary replica, there is no data loss.</span></span>  
  
-   <span data-ttu-id="53363-169">**Se una replica secondaria sincronizzata con commit sincrono torna online**</span><span class="sxs-lookup"><span data-stu-id="53363-169">**If a synchronized synchronous-commit secondary replica comes online**</span></span>  
  
     <span data-ttu-id="53363-170">Se il quorum viene perso e la forzatura del quorum WSFC implica il ripristino del nodo del cluster che ospita una replica secondaria sincronizzata di un gruppo di disponibilità, è possibile evitare la perdita di dati per questo gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="53363-170">If quorum is lost and forcing WSFC quorum restores a cluster node that hosts a synchronized secondary replica for an availability group, you should be able to prevent data loss for this availability group.</span></span> <span data-ttu-id="53363-171">Se il nodo ripristinato era attivo nel momento in cui il quorum è andato perso, è possibile determinare se può verificarsi una perdita di dati in un database specifico eseguendo una query sulla colonna **is_failover_ready** della vista a gestione dinamica (DMV) [sys.dm_hadr_database_replica_cluster_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-cluster-states-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="53363-171">If the restored node was up at the time that quorum was lost, you can determine whether data loss could occur on a given database by querying the **is_failover_ready** column of the [sys.dm_hadr_database_replica_cluster_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-cluster-states-transact-sql) dynamic management view.</span></span> <span data-ttu-id="53363-172">Ad esempio, per un'istanza del server denominata `sql108w2k8r22`, eseguire la query qui indicata:</span><span class="sxs-lookup"><span data-stu-id="53363-172">For example, for a server instance named `sql108w2k8r22`, issue the following query:</span></span>  
  
    ```  
    SELECT * FROM sys.dm_hadr_database_replica_cluster_states  
       WHERE replica_id=(SELECT replica_id FROM sys.availability_replicas   
          WHERE replica_server_name ='sql108w2k8r22')  
    ```  
  
    > [!CAUTION]  
    >  <span data-ttu-id="53363-173">Se il nodo ripristinato non era attivo nel momento in cui il quorum è andato perso, **is_failover_ready** potrebbe non riflettere l'effettivo stato del cluster nel momento in cui la replica primaria è passata offline.</span><span class="sxs-lookup"><span data-stu-id="53363-173">If the restored node was not up at the time quorum was lost, **is_failover_ready** may not reflect the cluster's actual state at the time the primary replica went offline.</span></span> <span data-ttu-id="53363-174">Quindi il valore **is_failover_ready** è utile solo se il nodo dell'host era attivo nel momento in cui si è verificato l'errore.</span><span class="sxs-lookup"><span data-stu-id="53363-174">Therefore, the **is_failover_ready** value is only good if the host node at the time of the failure.</span></span> <span data-ttu-id="53363-175">Per altre informazioni, vedere "Motivi per cui è necessario il failover forzato dopo aver forzato il quorum" in [Failover e modalità di failover &#40;gruppi di disponibilità AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="53363-175">For more information, see "Why Forced Failover is Required After Forcing Quorum" in [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
     <span data-ttu-id="53363-176">Se **is_failover_ready** è uguale a 1, il database viene contrassegnato come sincronizzato nel cluster ed è pronto per il failover.</span><span class="sxs-lookup"><span data-stu-id="53363-176">If **is_failover_ready** = 1, the database is marked as synchronized in the cluster and is ready for a failover.</span></span> <span data-ttu-id="53363-177">Se **is_failover_ready** è uguale a 1 in ogni database di una determinata replica secondaria, è possibile eseguire un failover forzato (FORCE_FAILOVER_ALLOW_DATA_LOSS) senza perdita di dati nella replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="53363-177">If **is_failover_ready** = 1 on every database on a given secondary replica, you can perform a forced failover (FORCE_FAILOVER_ALLOW_DATA_LOSS) without data loss on this secondary replica.</span></span> <span data-ttu-id="53363-178">La replica secondaria sincronizzata torna online nel ruolo primario, ovvero come nuova replica primaria, con tutti i dati intatti.</span><span class="sxs-lookup"><span data-stu-id="53363-178">The synchronized secondary replica comes online in the primary role, that is, as the new primary replica, with all the data intact.</span></span>  
  
     <span data-ttu-id="53363-179">Se **is_failover_ready** è uguale a 0, il database non viene contrassegnato come sincronizzato nel cluster e *non* è pronto per un failover manuale pianificato.</span><span class="sxs-lookup"><span data-stu-id="53363-179">If **is_failover_ready** = 0, the database is not marked as synchronized in the cluster and is *not* ready for a planned manual failover.</span></span> <span data-ttu-id="53363-180">Se si forza il failover nella replica secondaria host, i dati verranno persi nel database.</span><span class="sxs-lookup"><span data-stu-id="53363-180">If you force failover to the host secondary replica, data will be lost on this database.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="53363-181">Se si forza il failover in una replica secondaria, la quantità di dati che andranno perduti dipenderà dal ritardo della destinazione di failover rispetto alla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="53363-181">When you force failover to a secondary replica, the amount of data loss will depend on how far the failover target is lagging behind the primary replica.</span></span> <span data-ttu-id="53363-182">Purtroppo, quando il cluster WSFC non dispone del quorum o il quorum è stato forzato, non è possibile valutare la quantità di dati che potrebbero andare perduti.</span><span class="sxs-lookup"><span data-stu-id="53363-182">Unfortunately, when the WSFC cluster lacks quorum or quorum has been forced, you cannot assess the amount of potential data loss.</span></span> <span data-ttu-id="53363-183">Si noti, tuttavia, che una volta che il cluster WSFC avrà recuperato un quorum integro, sarà possibile iniziare a tenere traccia della potenziale perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="53363-183">Note, however, that once the WSFC cluster regains a healthy quorum, you could begin to track potential data loss.</span></span> <span data-ttu-id="53363-184">Per altre informazioni, vedere "Come tenere traccia della potenziale perdita di dati" in [Failover e modalità di failover&#40;gruppi di disponibilità AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="53363-184">For more information, see "Tracking Potential Data Loss" in [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="53363-185">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="53363-185">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="53363-186">Autorizzazioni</span><span class="sxs-lookup"><span data-stu-id="53363-186">Permissions</span></span>  
 <span data-ttu-id="53363-187">È necessaria l'autorizzazione ALTER AVAILABILITY GROUP nel gruppo di disponibilità, l'autorizzazione CONTROL AVAILABILITY GROUP, l'autorizzazione ALTER ANY AVAILABILITY GROUP o l'autorizzazione CONTROL SERVER.</span><span class="sxs-lookup"><span data-stu-id="53363-187">Requires ALTER AVAILABILITY GROUP permission on the availability group, CONTROL AVAILABILITY GROUP permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="53363-188">Utilizzo di SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="53363-188">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="53363-189">**Per forzare il failover (con possibile perdita di dati)**</span><span class="sxs-lookup"><span data-stu-id="53363-189">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="53363-190">In Esplora oggetti connettersi a un'istanza del server che ospita una replica con stato SECONDARY o RESOLVING nel gruppo di disponibilità di cui è necessario eseguire il failover ed espandere l'albero del server.</span><span class="sxs-lookup"><span data-stu-id="53363-190">In Object Explorer, connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over, and expand the server tree.</span></span>  
  
2.  <span data-ttu-id="53363-191">Espandere il nodo **Disponibilità elevata AlwaysOn** e il nodo **Gruppi di disponibilità** .</span><span class="sxs-lookup"><span data-stu-id="53363-191">Expand the **AlwaysOn High Availability** node and the **Availability Groups** node.</span></span>  
  
3.  <span data-ttu-id="53363-192">Fare clic con il pulsante destro del mouse sul gruppo di disponibilità di cui eseguire il failover e selezionare il comando **Failover** .</span><span class="sxs-lookup"><span data-stu-id="53363-192">Right-click the availability group to be failed over, and select the **Failover** command.</span></span>  
  
4.  <span data-ttu-id="53363-193">Verrà avviata la Creazione guidata Gruppo di disponibilità di failover.</span><span class="sxs-lookup"><span data-stu-id="53363-193">This launches the Failover Availability Group Wizard.</span></span> <span data-ttu-id="53363-194">Per altre informazioni, vedere [Usare la procedura guidata Failover gruppo di disponibilità &#40;SQL Server Management Studio&#41;](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="53363-194">For more information, see [Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md).</span></span>  
  
5.  <span data-ttu-id="53363-195">Dopo avere forzato il failover di un gruppo di disponibilità, completare i passaggi necessari.</span><span class="sxs-lookup"><span data-stu-id="53363-195">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="53363-196">Per altre informazioni, vedere [Completamento: Attività essenziali dopo un failover forzato](#FollowUp) più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="53363-196">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="53363-197">Uso di Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="53363-197">Using Transact-SQL</span></span>  
 <span data-ttu-id="53363-198">**Per forzare il failover (con possibile perdita di dati)**</span><span class="sxs-lookup"><span data-stu-id="53363-198">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="53363-199">Connettersi a un'istanza del server che ospita una replica con ruolo in stato SECONDARY o RESOLVING nel gruppo di disponibilità di cui è necessario eseguire il failover.</span><span class="sxs-lookup"><span data-stu-id="53363-199">Connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over.</span></span>  
  
2.  <span data-ttu-id="53363-200">Utilizzare l'istruzione [ALTER AVAILABILITY GROUP](/sql/t-sql/statements/alter-availability-group-transact-sql) , come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="53363-200">Use the [ALTER AVAILABILITY GROUP](/sql/t-sql/statements/alter-availability-group-transact-sql) statement, as follows:</span></span>  
  
     <span data-ttu-id="53363-201">ALTER AVAILABILITY GROUP *nome_gruppo* FORCE_FAILOVER_ALLOW_DATA_LOSS</span><span class="sxs-lookup"><span data-stu-id="53363-201">ALTER AVAILABILITY GROUP *group_name* FORCE_FAILOVER_ALLOW_DATA_LOSS</span></span>  
  
     <span data-ttu-id="53363-202">dove *nome_gruppo* è il nome del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="53363-202">where *group_name* is the name of the availability group.</span></span>  
  
     <span data-ttu-id="53363-203">Nell'esempio seguente viene eseguito il failover forzato del gruppo di disponibilità `AccountsAG` alla replica secondaria locale.</span><span class="sxs-lookup"><span data-stu-id="53363-203">The following example forces the `AccountsAG` availability group to fail over to the local secondary replica.</span></span>  
  
    ```sql
    ALTER AVAILABILITY GROUP AccountsAG FORCE_FAILOVER_ALLOW_DATA_LOSS;  
    ```  
  
3.  <span data-ttu-id="53363-204">Dopo avere forzato il failover di un gruppo di disponibilità, completare i passaggi necessari.</span><span class="sxs-lookup"><span data-stu-id="53363-204">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="53363-205">Per altre informazioni, vedere [Completamento: Attività essenziali dopo un failover forzato](#FollowUp) più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="53363-205">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
##  <a name="using-powershell"></a><a name="PowerShellProcedure"></a> <span data-ttu-id="53363-206">Utilizzo di PowerShell</span><span class="sxs-lookup"><span data-stu-id="53363-206">Using PowerShell</span></span>  
 <span data-ttu-id="53363-207">**Per forzare il failover (con possibile perdita di dati)**</span><span class="sxs-lookup"><span data-stu-id="53363-207">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="53363-208">Modificare la directory ( `cd` ) in un'istanza del server che ospita una replica il cui ruolo si trova nello stato SECONDARY o RESOLVING nel gruppo di disponibilità di cui è necessario eseguire il failover.</span><span class="sxs-lookup"><span data-stu-id="53363-208">Change directory (`cd`) to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over.</span></span>  
  
2.  <span data-ttu-id="53363-209">Utilizzare il cmdlet `Switch-SqlAvailabilityGroup` con il parametro `AllowDataLoss` in uno dei formati seguenti:</span><span class="sxs-lookup"><span data-stu-id="53363-209">Use the `Switch-SqlAvailabilityGroup` cmdlet with the `AllowDataLoss` parameter in one of the following forms:</span></span>  
  
    -   `-AllowDataLoss`  
  
         <span data-ttu-id="53363-210">Per impostazione predefinita, specificando il parametro `-AllowDataLoss` con `Switch-SqlAvailabilityGroup`, viene segnalato che il failover forzato può comportare la perdita di transazioni di cui non è stato eseguito il commit e viene richiesta la conferma dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="53363-210">By default `-AllowDataLoss` parameter causes `Switch-SqlAvailabilityGroup` to prompt you to remind you that forcing failover might result in the loss of uncommitted transactions and to request confirmation.</span></span> <span data-ttu-id="53363-211">Per continuare, immettere `Y`. Per annullare l'operazione, immettere `N`.</span><span class="sxs-lookup"><span data-stu-id="53363-211">To continue, enter `Y`; to cancel the operation, enter `N`.</span></span>  
  
         <span data-ttu-id="53363-212">Nell'esempio seguente viene eseguito un failover forzato (con possibile perdita di dati) del gruppo di disponibilità `MyAg` nella replica secondaria nell'istanza del server denominata `SecondaryServer\InstanceName`.</span><span class="sxs-lookup"><span data-stu-id="53363-212">The following example performs a forced failover (with possible data loss) of the availability group `MyAg` to the secondary replica on the server instance named `SecondaryServer\InstanceName`.</span></span> <span data-ttu-id="53363-213">Verrà richiesto di confermare questa operazione.</span><span class="sxs-lookup"><span data-stu-id="53363-213">You will be prompted to confirm this operation.</span></span>  
  
        ```powershell
        Switch-SqlAvailabilityGroup -Path SQLSERVER:\Sql\SecondaryServer\InstanceName\AvailabilityGroups\MyAg -AllowDataLoss  
        ```  
  
    -   <span data-ttu-id="53363-214">**-AllowDataLoss-Force**</span><span class="sxs-lookup"><span data-stu-id="53363-214">**-AllowDataLoss-Force**</span></span>  
  
         <span data-ttu-id="53363-215">Per iniziare un failover forzato senza conferma, specificare i parametri `-AllowDataLoss` e `-Force`.</span><span class="sxs-lookup"><span data-stu-id="53363-215">To initiate a forced failover without confirmation, specify both the `-AllowDataLoss` and `-Force` parameters.</span></span> <span data-ttu-id="53363-216">Ciò si rivela utile per includere il comando in uno script ed eseguirlo senza l'interazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="53363-216">This is useful if you want to include the command in a script and run it without user interaction.</span></span>  <span data-ttu-id="53363-217">Utilizzare tuttavia l'opzione `-Force` con cautela, perché un failover forzato può causare la perdita di dati dai database che fanno parte del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="53363-217">However, use the `-Force` option with caution, because a forced failover might result in the loss of data from databases participating the availability group.</span></span>  
  
         <span data-ttu-id="53363-218">Nell'esempio seguente viene eseguito il failover forzato (con possibile perdita di dati) del gruppo di disponibilità `MyAg` nell'istanza del server denominata `SecondaryServer\InstanceName`.</span><span class="sxs-lookup"><span data-stu-id="53363-218">The following example performs a forced failover (with possible data loss) of the availability group `MyAg` to the server instance named `SecondaryServer\InstanceName`.</span></span> <span data-ttu-id="53363-219">Con l'opzione `-Force` viene eliminata la conferma di questa operazione.</span><span class="sxs-lookup"><span data-stu-id="53363-219">The `-Force` option suppresses confirmation of this operation.</span></span>  
  
        ```powershell
        Switch-SqlAvailabilityGroup -Path SQLSERVER:\Sql\SecondaryServer\InstanceName\AvailabilityGroups\MyAg -AllowDataLoss -Force  
        ```  
  
    > [!NOTE]  
    >  <span data-ttu-id="53363-220">Per visualizzare la sintassi di un cmdlet, utilizzare il cmdlet `Get-Help` nell'ambiente [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell.</span><span class="sxs-lookup"><span data-stu-id="53363-220">To view the syntax of a cmdlet, use the `Get-Help` cmdlet in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell environment.</span></span> <span data-ttu-id="53363-221">Per altre informazioni, vedere [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="53363-221">For more information, see [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span></span>  
  
3.  <span data-ttu-id="53363-222">Dopo avere forzato il failover di un gruppo di disponibilità, completare i passaggi necessari.</span><span class="sxs-lookup"><span data-stu-id="53363-222">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="53363-223">Per altre informazioni, vedere [Completamento: Attività essenziali dopo un failover forzato](#FollowUp) più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="53363-223">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
 <span data-ttu-id="53363-224">**Per impostare e utilizzare il provider PowerShell per SQL Server**</span><span class="sxs-lookup"><span data-stu-id="53363-224">**To set up and use the SQL Server PowerShell provider**</span></span>  
  
-   [<span data-ttu-id="53363-225">Provider PowerShell per SQL Server</span><span class="sxs-lookup"><span data-stu-id="53363-225">SQL Server PowerShell Provider</span></span>](../../../powershell/sql-server-powershell-provider.md)  
  
##  <a name="follow-up-essential-tasks-after-a-forced-failover"></a><a name="FollowUp"></a> <span data-ttu-id="53363-226">Completamento: Attività essenziali dopo un failover forzato</span><span class="sxs-lookup"><span data-stu-id="53363-226">Follow Up: Essential Tasks After a Forced Failover</span></span>  
  
1.  <span data-ttu-id="53363-227">Dopo un failover forzato, la replica secondaria a cui è stato eseguito il failover diventa la nuova replica primaria.</span><span class="sxs-lookup"><span data-stu-id="53363-227">After a forced failover, the secondary replica to which you failed over becomes the new primary replica.</span></span> <span data-ttu-id="53363-228">Tuttavia, per rendere accessibile ai client tale replica di disponibilità, potrebbe essere necessario riconfigurare il quorum WSFC o modificare la configurazione della modalità di disponibilità del gruppo di disponibilità, nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="53363-228">However, to make that availability replica accessible to clients, you might need to reconfigure the WSFC quorum or adjust the availability-mode configuration of the availability group, as follows:</span></span>  
  
    -   <span data-ttu-id="53363-229">**Se è stato eseguito il failover al di fuori del [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]:**  modificare i voti del quorum dei nodi WSFC per riflettere la nuova configurazione del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="53363-229">**If you failed over outside of the [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]:**  Adjust the quorum votes of the WSFC nodes to reflect your new availability group configuration.</span></span> <span data-ttu-id="53363-230">Se il nodo WSFC che ospita la replica secondaria di destinazione non dispone di un voto del quorum WSFC, potrebbe essere necessario forzare il quorum WSFC.</span><span class="sxs-lookup"><span data-stu-id="53363-230">If the WSFC node that hosts the target secondary replica does not have a WSFC quorum vote, you might need to force WSFC quorum.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="53363-231">Un [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)] esiste solo se due repliche di disponibilità (inclusa la replica primaria precedente) sono configurate per la modalità commit sincrono con failover automatico.</span><span class="sxs-lookup"><span data-stu-id="53363-231">An [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)] exists only if two availability replicas (including the previous primary replica) are configured for synchronous-commit mode with automatic failover.</span></span>  
  
         <span data-ttu-id="53363-232">**Per modificare i voti del quorum**</span><span class="sxs-lookup"><span data-stu-id="53363-232">**To adjust quorum votes**</span></span>  
  
        -   [<span data-ttu-id="53363-233">Visualizzare le impostazioni NodeWeight per il quorum del cluster</span><span class="sxs-lookup"><span data-stu-id="53363-233">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
        -   [<span data-ttu-id="53363-234">Configurare le impostazioni NodeWeight per il quorum del cluster</span><span class="sxs-lookup"><span data-stu-id="53363-234">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
        -   [<span data-ttu-id="53363-235">Forzare l'avvio di un cluster WSFC senza un quorum</span><span class="sxs-lookup"><span data-stu-id="53363-235">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
    -   <span data-ttu-id="53363-236">**Se è stato eseguito il failover al di fuori del [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]:** è consigliabile modificare la modalità di disponibilità e la modalità di failover nella nuova replica primaria e nelle repliche secondarie rimanenti per riflettere la configurazione desiderata del failover automatico con commit sincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-236">**If you failed over outside of the [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]:** We recommend that you consider adjusting the availability mode and failover mode on the new primary replica and on remaining secondary replicas to reflect your desired synchronous-commit and automatic failover configuration.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="53363-237">Un [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)] esiste solo se la replica primaria corrente viene configurata per la modalità commit sincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-237">A [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)] exists only if the current primary replica is configured for synchronous-commit mode.</span></span>  
  
         <span data-ttu-id="53363-238">**Per modificare la modalità di disponibilità e failover**</span><span class="sxs-lookup"><span data-stu-id="53363-238">**To change the availability mode and failover mode**</span></span>  
  
        -   [<span data-ttu-id="53363-239">Modificare la modalità di disponibilità di una replica di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-239">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)  
  
        -   [<span data-ttu-id="53363-240">Modificare la modalità di failover di una replica di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-240">Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-failover-mode-of-an-availability-replica-sql-server.md)  
  
2.  <span data-ttu-id="53363-241">Dopo un failover forzato tutti i database secondari sono sospesi,</span><span class="sxs-lookup"><span data-stu-id="53363-241">After a forced failover, all secondary databases are suspended.</span></span> <span data-ttu-id="53363-242">compresi i database primari precedenti. Ciò avviene dopo che la replica primaria precedente torna online e viene ora individuata come replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="53363-242">This includes the former primary databases, after the former primary replica comes back online and discovers that it is now a secondary replica.</span></span> <span data-ttu-id="53363-243">È necessario riprendere manualmente ogni database sospeso singolarmente in ogni replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="53363-243">You must manually resume each suspended database individually on each secondary replica.</span></span>  
  
     <span data-ttu-id="53363-244">Quando un database secondario viene ripreso, inizia la sincronizzazione dei dati con il database primario corrispondente.</span><span class="sxs-lookup"><span data-stu-id="53363-244">When a secondary database is resumed, it initiates data synchronization with the corresponding primary database.</span></span> <span data-ttu-id="53363-245">Il database secondario esegue il rollback di qualsiasi record di log di cui non è mai stato eseguito il commit nel nuovo database primario. Se pertanto si desidera evitare possibili perdite di dati nei database primari dopo il failover, è consigliabile tentare di creare uno snapshot del database nei database sospesi in uno dei database secondari con commit sincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-245">The secondary database rolls back any log records that were never committed on the new primary database.Therefore, if you are concerned about possible data loss on the post-failover primary databases, you should attempt to create a database snapshot on the suspended databases on one of the synchronous-commit secondary databases.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="53363-246">Il troncamento del log delle transazioni viene ritardato nel database primario, mentre gli eventuali database secondari vengono sospesi.</span><span class="sxs-lookup"><span data-stu-id="53363-246">Transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="53363-247">Inoltre, l'integrità di sincronizzazione di una replica secondaria con commit sincrono non potrà passare allo stato HEALTHY finché un database locale qualsiasi rimane sospeso.</span><span class="sxs-lookup"><span data-stu-id="53363-247">Also the synchronization health of a synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>  
  
     <span data-ttu-id="53363-248">**Per creare uno snapshot del database**</span><span class="sxs-lookup"><span data-stu-id="53363-248">**To create a database snapshot**</span></span>  
  
    -   [<span data-ttu-id="53363-249">Creare uno snapshot del database &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-249">Create a Database Snapshot &#40;Transact-SQL&#41;</span></span>](../../../relational-databases/databases/create-a-database-snapshot-transact-sql.md)  
  
     <span data-ttu-id="53363-250">**Per riprendere un database di disponibilità**</span><span class="sxs-lookup"><span data-stu-id="53363-250">**To resume an availability database**</span></span>  
  
    -   [<span data-ttu-id="53363-251">Riprendere un database di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-251">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)  
  
    > [!CAUTION]  
    >  <span data-ttu-id="53363-252">Dopo la ripresa di tutti i database secondari, prima di tentare nuovamente il failover del gruppo, attendere che ogni database secondario nella destinazione del failover successivo entri nello stato SYNCHRONIZING.</span><span class="sxs-lookup"><span data-stu-id="53363-252">After resuming all the secondary databases, before attempting to fail over the group again, wait for every secondary database on the next failover target to enter the SYNCHRONIZING state.</span></span> <span data-ttu-id="53363-253">Se un database non è ancora nello stato SYNCHRONIZING, non potrà essere portato online come database primario e ristabilire la sincronizzazione dei dati per il database potrebbe richiedere il ripristino dei log delle transazioni, il ripristino di un backup di database completo o il failover alla replica primaria precedente.</span><span class="sxs-lookup"><span data-stu-id="53363-253">If any database is not yet SYNCHRONIZING, that database will be prevented from coming online as a primary database, and re-establishing data synchronization for the database might require restoring transaction logs, restoring a full database backup, or failing over back to the previous primary replica.</span></span>  
  
3.  <span data-ttu-id="53363-254">Se una replica di disponibilità non riuscita non viene restituita alla replica di disponibilità o viene restituita con un ritardo tale che il troncamento del log delle transazioni sul nuovo database primario non può essere ritardato, valutare di rimuovere la replica non riuscita dal gruppo di disponibilità per evitare l'esaurimento dello spazio disponibile sul disco per i file di log.</span><span class="sxs-lookup"><span data-stu-id="53363-254">If an availability replica that failed will not be returning to the availability replica or will return too late for you to delay transaction log truncation on the new primary database, consider removing the failed replica from the availability group to avoid running out of disk space for your log files.</span></span>  
  
     <span data-ttu-id="53363-255">**Per rimuovere una replica secondaria**</span><span class="sxs-lookup"><span data-stu-id="53363-255">**To remove a secondary replica**</span></span>  
  
    -   [<span data-ttu-id="53363-256">Rimuovere una replica secondaria da un gruppo di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-256">Remove a Secondary Replica from an Availability Group &#40;SQL Server&#41;</span></span>](remove-a-secondary-replica-from-an-availability-group-sql-server.md)  
  
4.  <span data-ttu-id="53363-257">Se si segue un failover forzato con uno o più failover forzati aggiuntivi, eseguire un backup del log dopo ogni failover forzato aggiuntivo nella serie.</span><span class="sxs-lookup"><span data-stu-id="53363-257">If you follow a forced failover with one or more additional forced failovers, perform a log backup after each additional forced failover in the series.</span></span> <span data-ttu-id="53363-258">Per informazioni sul motivo, vedere "Rischi correlati al failover forzato" nella sezione "Failover manuale forzato (con possibile perdita di dati)" di [Failover e modalità di failover &#40;gruppi di disponibilità AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="53363-258">For information about the reason for this, see "Risks of Forcing Failover" in the "Forced Manual Failover (with Possible Data Loss)" section of [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
     <span data-ttu-id="53363-259">**Per eseguire un backup del log**</span><span class="sxs-lookup"><span data-stu-id="53363-259">**To perform a log backup**</span></span>  
  
    -   [<span data-ttu-id="53363-260">Eseguire il backup di un log delle transazioni &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-260">Back Up a Transaction Log &#40;SQL Server&#41;</span></span>](../../../relational-databases/backup-restore/back-up-a-transaction-log-sql-server.md)  
  
##  <a name="example-scenario-using-a-forced-failover-to-recover-from-a-catastrophic-failure"></a><a name="ExampleRecoveryFromCatastrophy"></a> <span data-ttu-id="53363-261">Scenario di esempio: Uso di un failover forzato per il ripristino da un errore irreversibile</span><span class="sxs-lookup"><span data-stu-id="53363-261">Example Scenario: Using a Forced Failover to Recover from a Catastrophic Failure</span></span>  
 <span data-ttu-id="53363-262">In caso di errore della replica primaria e qualora non sia disponibile una replica secondaria sincronizzata, il failover forzato del gruppo di disponibilità potrebbe costituire una risposta appropriata.</span><span class="sxs-lookup"><span data-stu-id="53363-262">If the primary replica fails and no synchronized secondary replica is available, forcing the availability group to fail over might be an appropriate response.</span></span> <span data-ttu-id="53363-263">Un failover forzato può risultare appropriato: (1) se si prevede che la replica primaria rimanga offline più a lungo di quanto sia consentito dal contratto di servizio (SLA, Service Level Agreement) e (2) se si è disposti a rischiare una possibile perdita di dati per rendere rapidamente disponibili i database primari.</span><span class="sxs-lookup"><span data-stu-id="53363-263">The appropriateness of forcing a failover depends on: (1) whether you expect the primary replica to be offline for longer than your service level agreement (SLA) tolerates, and (2) whether you are willing to risk potential data loss in order to make primary databases available quickly.</span></span> <span data-ttu-id="53363-264">Se si stabilisce che un gruppo di disponibilità richiede un failover forzato, l'effettivo failover forzato sarà solo uno dei passaggi di un processo che comprende diversi passaggi.</span><span class="sxs-lookup"><span data-stu-id="53363-264">If you decide that an availability group requires a forced failover, the actual forced failover is but one step of a multi-step process.</span></span>  
  
 <span data-ttu-id="53363-265">Per illustrare i passaggi necessari per utilizzare un failover forzato per il ripristino da un errore irreversibile, in questo argomento viene presentato un possibile scenario di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="53363-265">To illustrate the steps that are required to use a forced failover to recover from a catastrophic failure, this topic presents one possible disaster recovery scenario.</span></span> <span data-ttu-id="53363-266">Nello scenario di esempio si considera un gruppo di disponibilità la cui topologia originale consiste in un data center principale che ospita tre repliche di disponibilità con commit sincrono, inclusa la replica primaria, e un data center remoto che ospita due repliche secondarie con commit asincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-266">The example scenario considers an availability group whose original topology consists of a main data center that hosts three synchronous-commit availability replicas, including the primary replica, and a remote data center that hosts two asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="53363-267">Nella figura seguente viene illustrata la topologia originale di questo gruppo di disponibilità di esempio.</span><span class="sxs-lookup"><span data-stu-id="53363-267">The following figure illustrates the original topology of this example availability group.</span></span> <span data-ttu-id="53363-268">Il gruppo di disponibilità è ospitato da un cluster WSFC su più subnet con tre nodi nel data center principale (**Nodo 01**, **Nodo 02**e **Nodo 03**) e due nodi nel data center remoto (**Nodo 04** e **Nodo 05**).</span><span class="sxs-lookup"><span data-stu-id="53363-268">The availability group is hosted by a multi-subnet WSFC cluster with three nodes in the main data center (**Node 01**, **Node 02**, and **Node 03**) and two nodes in a remote data center (**Node 04** and **Node 05**).</span></span>  
  
 <span data-ttu-id="53363-269">![Topologia originale del gruppo di disponibilità](../../media/aoag-failurerecovery-origtopology.gif "Topologia originale del gruppo di disponibilità")</span><span class="sxs-lookup"><span data-stu-id="53363-269">![Original topology of availability group](../../media/aoag-failurerecovery-origtopology.gif "Original topology of availability group")</span></span>  
  
 <span data-ttu-id="53363-270">Si verifica un arresto imprevisto del data center principale.</span><span class="sxs-lookup"><span data-stu-id="53363-270">The main data center shuts down unexpectedly.</span></span> <span data-ttu-id="53363-271">Le tre repliche di disponibilità passano alla modalità offline e i relativi database diventano non disponibili.</span><span class="sxs-lookup"><span data-stu-id="53363-271">Its three availability replicas to go offline, and their databases become unavailable.</span></span> <span data-ttu-id="53363-272">Nella figura seguente viene illustrato l'impatto di questo errore sulla topologia del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="53363-272">The following figure illustrates the impact of this failure on the topology of the availability group.</span></span>  
  
 <span data-ttu-id="53363-273">![Topologia dopo l'errore del data center principale](../../media/aoag-failurerecovery-catastrophy.gif "Topologia dopo l'errore del data center principale")</span><span class="sxs-lookup"><span data-stu-id="53363-273">![Topology after failure of main data center](../../media/aoag-failurerecovery-catastrophy.gif "Topology after failure of main data center")</span></span>  
  
 <span data-ttu-id="53363-274">L'amministratore del database (DBA) determina che la migliore risposta possibile consiste nel forzare il failover del gruppo di disponibilità su una delle repliche secondarie remote con commit asincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-274">The database administrator (DBA) determines that the best possible response is to force failover of the availability group to one of the remote, asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="53363-275">In questo esempio viene illustrata la procedura tipica eseguita per forzare il failover del gruppo di disponibilità su una replica remota e per ripristinare infine la topologia originale del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="53363-275">This example illustrates the typical steps involved when you force failover of the availability group to a remote replica and, eventually, return the availability group to its original topology.</span></span>  
  
  
###  <a name="responding-to-the-catastrophic-failure-of-the-main-data-center"></a><a name="FailureResponse"></a> <span data-ttu-id="53363-276">Responding to the Catastrophic Failure of the Main Data Center</span><span class="sxs-lookup"><span data-stu-id="53363-276">Responding to the Catastrophic Failure of the Main Data Center</span></span>  
 <span data-ttu-id="53363-277">Nella figura seguente viene illustrata la serie di azioni eseguite nel data center remoto in risposta a un errore irreversibile nel data center principale.</span><span class="sxs-lookup"><span data-stu-id="53363-277">The following figure illustrates the series of actions performed at the remote data center in response a catastrophic failure at the main data center.</span></span>  
  
 <span data-ttu-id="53363-278">![Passaggi per la risposta all'errore del data center principale](../../media/aoag-failurerecovery-actions-part1.gif "Passaggi per la risposta all'errore del data center principale")</span><span class="sxs-lookup"><span data-stu-id="53363-278">![Steps for responding to failure of main data cente](../../media/aoag-failurerecovery-actions-part1.gif "Steps for responding to failure of main data cente")</span></span>  
  
 <span data-ttu-id="53363-279">I passaggi riportati nella figura indicano quanto segue:</span><span class="sxs-lookup"><span data-stu-id="53363-279">The steps in this figure indicate the following steps:</span></span>  
  
|<span data-ttu-id="53363-280">Passaggio</span><span class="sxs-lookup"><span data-stu-id="53363-280">Step</span></span>|<span data-ttu-id="53363-281">Azione</span><span class="sxs-lookup"><span data-stu-id="53363-281">Action</span></span>|<span data-ttu-id="53363-282">Collegamenti</span><span class="sxs-lookup"><span data-stu-id="53363-282">Links</span></span>|  
|----------|------------|-----------|  
|<span data-ttu-id="53363-283">**1.**</span><span class="sxs-lookup"><span data-stu-id="53363-283">**1.**</span></span>|<span data-ttu-id="53363-284">Il DBA o l'amministratore di rete si accerta che il cluster WSFC disponga di un quorum integro.</span><span class="sxs-lookup"><span data-stu-id="53363-284">The DBA or network administrator ensures that the WSFC cluster has a healthy quorum.</span></span> <span data-ttu-id="53363-285">In questo esempio il quorum deve essere forzato.</span><span class="sxs-lookup"><span data-stu-id="53363-285">In this example, quorum needs to be forced.</span></span>|[<span data-ttu-id="53363-286">Modalità quorum WSFC e configurazione del voto &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-286">WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md)<br /><br /> [<span data-ttu-id="53363-287">Ripristino di emergenza WSFC tramite quorum forzato &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-287">WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md)|  
|<span data-ttu-id="53363-288">**2.**</span><span class="sxs-lookup"><span data-stu-id="53363-288">**2.**</span></span>|<span data-ttu-id="53363-289">Il DBA si connette all'istanza del server con la latenza minima (sul **Node 04**) ed esegue un failover manuale forzato.</span><span class="sxs-lookup"><span data-stu-id="53363-289">The DBA connects to the server instance with the least latency (on **Node 04**) and performs a forced manual failover.</span></span> <span data-ttu-id="53363-290">Con il failover forzato questa replica secondaria assume il ruolo primario e i database secondari nella replica secondaria rimanente (sul **Node 05**) vengono sospesi.</span><span class="sxs-lookup"><span data-stu-id="53363-290">The forced failover transitions this secondary replica to the primary role and suspends the secondary databases on the remaining secondary replica (on **Node 05**).</span></span>|<span data-ttu-id="53363-291">[sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) (query sulla colonna **end_of_log_lsn** .</span><span class="sxs-lookup"><span data-stu-id="53363-291">[sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) (Query the **end_of_log_lsn** column.</span></span> <span data-ttu-id="53363-292">Per altre informazioni, vedere [Indicazioni](#Recommendations)più indietro in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="53363-292">For more information, see [Recommendations](#Recommendations), earlier in this topic.)</span></span>|  
|<span data-ttu-id="53363-293">**3.**</span><span class="sxs-lookup"><span data-stu-id="53363-293">**3.**</span></span>|<span data-ttu-id="53363-294">Il DBA riprende manualmente ogni database secondario nella replica secondaria rimanente.</span><span class="sxs-lookup"><span data-stu-id="53363-294">The DBA manually resumes each of the secondary databases on the remaining secondary replica.</span></span>|[<span data-ttu-id="53363-295">Riprendere un database di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-295">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)|  
  
###  <a name="returning-the-availability-group-to-its-original-topology"></a><a name="ReturnToOrigTopology"></a> <span data-ttu-id="53363-296">Ripristino della topologia originale del gruppo di disponibilità</span><span class="sxs-lookup"><span data-stu-id="53363-296">Returning the Availability Group to its Original Topology</span></span>  
 <span data-ttu-id="53363-297">Nella figura seguente viene illustrata la serie di azioni eseguite per ripristinare la topologia originale del gruppo di disponibilità dopo che il data center principale sarà ritornato online e che sarà stata ristabilita la comunicazione dei nodi WSFC con il cluster WSFC.</span><span class="sxs-lookup"><span data-stu-id="53363-297">The following figure illustrates the series of actions that return the availability group to its original topology after the main data center comes back online and the WSFC nodes re-establish communication with the WSFC cluster.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="53363-298">Se il quorum del cluster WSFC è stato forzato, al riavvio dei nodi offline potrebbe essere formato un nuovo quorum in presenza di entrambe le seguenti condizioni: (a) tra i nodi del quorum forzato non è disponibile connettività di rete e (b) i nodi riavviati sono la maggioranza dei nodi del cluster.</span><span class="sxs-lookup"><span data-stu-id="53363-298">If the WSFC cluster quorum has been forced, as the offline nodes restart they could form a new quorum if the following conditions both exist: (a) there is no network connectivity between any of the nodes in the forced-quorum set, and (b) the restarting nodes are the majority of the cluster nodes.</span></span> <span data-ttu-id="53363-299">Questo porterebbe a una condizione "split brain" in cui il gruppo di disponibilità disporrebbe di due repliche primarie indipendenti, una in ogni data center.</span><span class="sxs-lookup"><span data-stu-id="53363-299">This would result in a "split brain" condition in which the availability group would possess two independent primary replicas, one at each data center.</span></span> <span data-ttu-id="53363-300">Prima di forzare il quorum per creare un set di quorum di minoranza, vedere [Ripristino di emergenza WSFC tramite quorum forzato &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="53363-300">Before forcing quorum to create a minority quorum set, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span>  
  
 <span data-ttu-id="53363-301">![Passaggi per il ripristino della topologia originale del gruppo](../../media/aoag-failurerecovery-actions-part2.gif "Passaggi per il ripristino della topologia originale del gruppo")</span><span class="sxs-lookup"><span data-stu-id="53363-301">![Steps to return the group to its original topology](../../media/aoag-failurerecovery-actions-part2.gif "Steps to return the group to its original topology")</span></span>  
  
 <span data-ttu-id="53363-302">I passaggi riportati nella figura indicano quanto segue:</span><span class="sxs-lookup"><span data-stu-id="53363-302">The steps in this figure indicate the following steps:</span></span>  
  
||<span data-ttu-id="53363-303">Passaggio</span><span class="sxs-lookup"><span data-stu-id="53363-303">Step</span></span>|<span data-ttu-id="53363-304">Collegamenti</span><span class="sxs-lookup"><span data-stu-id="53363-304">Links</span></span>|  
|-|----------|-----------|  
|<span data-ttu-id="53363-305">**1.**</span><span class="sxs-lookup"><span data-stu-id="53363-305">**1.**</span></span>|<span data-ttu-id="53363-306">I nodi nel data center principale ritornano online e ristabiliscono la comunicazione con il cluster WSFC.</span><span class="sxs-lookup"><span data-stu-id="53363-306">The nodes in the main data center come back online and re-establish communication with the WSFC cluster.</span></span> <span data-ttu-id="53363-307">Le relative repliche di disponibilità vengono riportate online come repliche secondarie con database sospesi e il DBA dovrà presto riprendere manualmente ogni database.</span><span class="sxs-lookup"><span data-stu-id="53363-307">Their availability replicas come online as secondary replicas with suspended databases, and the DBA will need to manually resume each of these databases soon.</span></span>|[<span data-ttu-id="53363-308">Riprendere un database di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-308">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)<br /><br /> <span data-ttu-id="53363-309">Suggerimento: per evitare possibili perdite di dati nei database primari dopo il failover, provare a creare uno snapshot del database sui database sospesi in uno dei database secondari con commit sincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-309">Tip: If you are concerned about possible data loss on the post-failover primary databases, you should attempt to create a database snapshot on the suspended databases on one the synchronous-commit secondary database.</span></span> <span data-ttu-id="53363-310">Si tenga presente che il troncamento del log delle transazioni viene ritardato sul database primario mentre i relativi database secondari sono sospesi.</span><span class="sxs-lookup"><span data-stu-id="53363-310">Keep in mind that the transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="53363-311">Inoltre, l'integrità di sincronizzazione della replica secondaria con commit sincrono non potrà passare allo stato HEALTHY finché un database locale qualsiasi rimane sospeso.</span><span class="sxs-lookup"><span data-stu-id="53363-311">Also the synchronization health of the synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>|  
|<span data-ttu-id="53363-312">**2.**</span><span class="sxs-lookup"><span data-stu-id="53363-312">**2.**</span></span>|<span data-ttu-id="53363-313">Una volta ripresi i database, il DBA modifica la nuova replica primaria impostandola temporaneamente sulla modalità commit sincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-313">Once the databases are resumed, the DBA changes the new primary replica to synchronous-commit mode temporarily.</span></span> <span data-ttu-id="53363-314">Questa operazione comporta due passaggi:</span><span class="sxs-lookup"><span data-stu-id="53363-314">This involves two steps:</span></span><br /><br /> <span data-ttu-id="53363-315">1) Modificare una replica di disponibilità offline impostandola sulla modalità commit asincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-315">1) Change one offline availability replica to asynchronous-commit mode.</span></span> <br /><span data-ttu-id="53363-316">2) Modificare la nuova replica primaria impostandola sulla modalità commit sincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-316">2) Change the new primary replica to synchronous-commit mode.</span></span><br /><span data-ttu-id="53363-317">Nota: questo passaggio consente ai database secondari con commit sincrono ripresi di passare allo stato SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="53363-317">Note: This step enables resumed synchronous-commit secondary databases to become SYNCHRONIZED.</span></span>|[<span data-ttu-id="53363-318">Modificare la modalità di disponibilità di una replica di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-318">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)|  
|<span data-ttu-id="53363-319">**3.**</span><span class="sxs-lookup"><span data-stu-id="53363-319">**3.**</span></span>|<span data-ttu-id="53363-320">Dopo che la replica secondaria con commit sincrono nel **Node 03** (la replica primaria originale) è passata allo stato di sincronizzazione HEALTHY, il DBA esegue un failover manuale pianificato su tale replica, perché diventi di nuovo replica primaria.</span><span class="sxs-lookup"><span data-stu-id="53363-320">Once the synchronous-commit secondary replica on **Node 03** (the original primary replica) enters the HEALTHY synchronization state, the DBA performs a planned manual failover to that replica, to make it the primary replica again.</span></span> <span data-ttu-id="53363-321">La replica nel **Nodo 04** tornerà a essere una replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="53363-321">The replica on **Node 04** returns to being a secondary replica.</span></span>|[<span data-ttu-id="53363-322">sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-322">sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql)<br /><br /> [<span data-ttu-id="53363-323">Utilizzare i criteri AlwaysOn per visualizzare l'integrità di un gruppo di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-323">Use AlwaysOn Policies to View the Health of an Availability Group &#40;SQL Server&#41;</span></span>](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md)<br /><br /> [<span data-ttu-id="53363-324">Eseguire un failover manuale pianificato di un gruppo di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-324">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)|  
|<span data-ttu-id="53363-325">**4.**</span><span class="sxs-lookup"><span data-stu-id="53363-325">**4.**</span></span>|<span data-ttu-id="53363-326">Il DBA si connette alla nuova replica primaria ed effettua le seguenti operazioni:</span><span class="sxs-lookup"><span data-stu-id="53363-326">The DBA connects to the new primary replica and:</span></span><br /><br /> <span data-ttu-id="53363-327">1) Modifica la replica primaria precedente nel data center remoto riportandola in modalità commit asincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-327">1) Changes the former primary replica (in the remote center) back to asynchronous-commit mode.</span></span><br /><span data-ttu-id="53363-328">2) Modifica la replica secondaria con commit asincrono nel data center principale riportandola in modalità commit sincrono.</span><span class="sxs-lookup"><span data-stu-id="53363-328">2) Changes the asynchronous-commit secondary replica in the main data center back to synchronous-commit mode.</span></span>|[<span data-ttu-id="53363-329">Modificare la modalità di disponibilità di una replica di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-329">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)|  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="53363-330">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="53363-330">Related Tasks</span></span>  
 <span data-ttu-id="53363-331">**Per modificare i voti del quorum**</span><span class="sxs-lookup"><span data-stu-id="53363-331">**To adjust quorum votes**</span></span>  
  
-   [<span data-ttu-id="53363-332">Visualizzare le impostazioni NodeWeight per il quorum del cluster</span><span class="sxs-lookup"><span data-stu-id="53363-332">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="53363-333">Configurare le impostazioni NodeWeight per il quorum del cluster</span><span class="sxs-lookup"><span data-stu-id="53363-333">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="53363-334">Forzare l'avvio di un cluster WSFC senza un quorum</span><span class="sxs-lookup"><span data-stu-id="53363-334">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
 <span data-ttu-id="53363-335">**Failover manuale pianificato:**</span><span class="sxs-lookup"><span data-stu-id="53363-335">**Planned manual failover:**</span></span>  
  
-   [<span data-ttu-id="53363-336">Eseguire un failover manuale pianificato di un gruppo di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-336">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="53363-337">Usare la Procedura guidata Failover del gruppo di disponibilità &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-337">Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md)  
  
 <span data-ttu-id="53363-338">**Per risolvere i problemi:**</span><span class="sxs-lookup"><span data-stu-id="53363-338">**To troubleshoot:**</span></span>  
  
-   [<span data-ttu-id="53363-339">Risolvere i problemi di Gruppi di disponibilità AlwaysOn &#40;di configurazione SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-339">Troubleshoot AlwaysOn Availability Groups Configuration &#40;SQL Server&#41;</span></span>](troubleshoot-always-on-availability-groups-configuration-sql-server.md) 
  
-   [<span data-ttu-id="53363-340">Risolvere i problemi relativi a un'operazione di aggiunta file non riuscita &#40;Gruppi di disponibilità AlwaysOn&#41;</span><span class="sxs-lookup"><span data-stu-id="53363-340">Troubleshoot a Failed Add-File Operation &#40;AlwaysOn Availability Groups&#41;</span></span>](troubleshoot-a-failed-add-file-operation-always-on-availability-groups.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="53363-341">Contenuto correlato</span><span class="sxs-lookup"><span data-stu-id="53363-341">Related Content</span></span>  
  
-   <span data-ttu-id="53363-342">**Blog:**</span><span class="sxs-lookup"><span data-stu-id="53363-342">**Blogs:**</span></span>  
  
     [<span data-ttu-id="53363-343">Blog del team di SQL Server AlwaysOn: Blog ufficiale del team di SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="53363-343">SQL Server AlwaysOn Team Blogs: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
     [<span data-ttu-id="53363-344">Pagina relativa ai blog del Servizio Supporto Tecnico Clienti per gli ingegneri di SQL Server</span><span class="sxs-lookup"><span data-stu-id="53363-344">CSS SQL Server Engineers Blogs</span></span>](https://blogs.msdn.com/b/psssql/)  
  
-   <span data-ttu-id="53363-345">**White paper:**</span><span class="sxs-lookup"><span data-stu-id="53363-345">**Whitepapers:**</span></span>  
  
     [<span data-ttu-id="53363-346">Pagina relativa alla guida alle soluzioni AlwaysOn di Microsoft SQL Server per la disponibilità elevata e il ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="53363-346">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
     [<span data-ttu-id="53363-347">Pagina relativa ai white paper Microsoft per SQL Server 2012</span><span class="sxs-lookup"><span data-stu-id="53363-347">Microsoft White Papers for SQL Server 2012</span></span>](https://msdn.microsoft.com/library/hh403491.aspx)  
  
     [<span data-ttu-id="53363-348">Pagina relativa ai white paper del team di consulenza clienti di SQL Server</span><span class="sxs-lookup"><span data-stu-id="53363-348">SQL Server Customer Advisory Team Whitepapers</span></span>](http://sqlcat.com/)  
  
## <a name="see-also"></a><span data-ttu-id="53363-349">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="53363-349">See Also</span></span>  
 <span data-ttu-id="53363-350">[Panoramica di Gruppi di disponibilità AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="53363-350">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="53363-351">[Modalità di disponibilità &#40;Gruppi di disponibilità AlwaysOn&#41;](availability-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="53363-351">[Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="53363-352">[Failover e modalità di failover &#40;Gruppi di disponibilità AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="53363-352">[Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="53363-353">[Informazioni sull'accesso alla connessione client per le repliche di disponibilità &#40;SQL Server&#41;](about-client-connection-access-to-availability-replicas-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="53363-353">[About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](about-client-connection-access-to-availability-replicas-sql-server.md) </span></span>  
 <span data-ttu-id="53363-354">[Monitoraggio di Gruppi di disponibilità &#40;SQL Server&#41;](monitoring-of-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="53363-354">[Monitoring of Availability Groups &#40;SQL Server&#41;](monitoring-of-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="53363-355">Windows Server Failover Clustering &#40;WSFC&#41; con SQL Server</span><span class="sxs-lookup"><span data-stu-id="53363-355">Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server</span></span>](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)  
  
  
