---
title: Possibili errori durante le sessioni tra repliche di disponibilità (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- troubleshooting [SQL Server, HADR]
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], troubleshooting
ms.assetid: cd613898-82d9-482f-a255-0230a6c7d6fe
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 4cfacb7f7c75875d4f5d0b0b435d282b3f537cc7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87718731"
---
# <a name="possible-failures-during-sessions-between-availability-replicas-sql-server"></a><span data-ttu-id="c5668-102">Possibili errori durante le sessioni tra repliche di disponibilità (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c5668-102">Possible Failures During Sessions Between Availability Replicas (SQL Server)</span></span>
  <span data-ttu-id="c5668-103">Gli errori in una sessione tra due repliche di disponibilità possono essere causati da problemi di tipo fisico, del sistema operativo o di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="c5668-103">Physical, operating system, or [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] problems can cause a failure in a session between two availability replicas.</span></span> <span data-ttu-id="c5668-104">Una replica di disponibilità non controlla regolarmente i componenti sui quali Sqlservr.exe si basa per verificare se stiano funzionando correttamente o abbiano generato un errore.</span><span class="sxs-lookup"><span data-stu-id="c5668-104">An availability replica does not regularly check the components on which Sqlservr.exe relies to verify whether they are functioning correctly or have failed.</span></span> <span data-ttu-id="c5668-105">In alcuni casi, tuttavia, il componente interessato invia una segnalazione di errore a Sqlservr.exe.</span><span class="sxs-lookup"><span data-stu-id="c5668-105">However, for some types of failures, the affected component reports an error to Sqlservr.exe.</span></span> <span data-ttu-id="c5668-106">Un errore segnalato da un altro componente è denominato *errore hardware*.</span><span class="sxs-lookup"><span data-stu-id="c5668-106">An error reported by another component is called a *hard error*.</span></span> <span data-ttu-id="c5668-107">Per rilevare altri errori che altrimenti non verrebbero rilevati, [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] implementa un proprio meccanismo di timeout della sessione.</span><span class="sxs-lookup"><span data-stu-id="c5668-107">To detect other failures that would otherwise go unnoticed, [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] implements its own session-timeout mechanism.</span></span> <span data-ttu-id="c5668-108">Specifica il periodo di timeout della sessione in secondi.</span><span class="sxs-lookup"><span data-stu-id="c5668-108">Specifies the session-timeout period in seconds.</span></span> <span data-ttu-id="c5668-109">Il periodo di timeout indica l'intervallo di attesa massimo rispettato dall'istanza del server per la ricezione di un messaggio PING da un'altra istanza, prima che l'altra istanza venga considerata disconnessa.</span><span class="sxs-lookup"><span data-stu-id="c5668-109">This time-out period is the maximum time that a server instance waits to receive a PING message from another instance before considering that other instance to be disconnected.</span></span> <span data-ttu-id="c5668-110">Quando si verifica un timeout della sessione tra due repliche di disponibilità, le repliche di disponibilità presuppongono che si sia verificato un errore e viene dichiarato un *errore software*.</span><span class="sxs-lookup"><span data-stu-id="c5668-110">When a session timeout occurs between two availability replicas, the availability replicas assume that a failure has occurred and declares a *soft error*.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="c5668-111">Non è possibile rilevare gli errori che si verificano nei database diversi da quello primario.</span><span class="sxs-lookup"><span data-stu-id="c5668-111">Failures in databases other than the primary database are not detectable.</span></span> <span data-ttu-id="c5668-112">È inoltre improbabile rilevare un errore di un disco dati, a meno che il database non venga riavviato a causa di un errore di un disco dati.</span><span class="sxs-lookup"><span data-stu-id="c5668-112">Moreover, a data disk failure is unlikely to be detected unless the database is restarted because of a data disk failure.</span></span>  
  
 <span data-ttu-id="c5668-113">La velocità di rilevamento degli errori, e quindi il tempo di reazione a un errore, varia a seconda che si tratti di un errore hardware o software.</span><span class="sxs-lookup"><span data-stu-id="c5668-113">The speed of error detection and, therefore, the reaction time to a failure, depends on whether the error is hard or soft.</span></span> <span data-ttu-id="c5668-114">Alcuni errori hardware, quali gli errori di rete, vengono segnalati immediatamente.</span><span class="sxs-lookup"><span data-stu-id="c5668-114">Some hard errors, such as network failures are reported immediately.</span></span> <span data-ttu-id="c5668-115">In alcuni casi, invece, i periodi di timeout specifici dei componenti possono ritardare la segnalazione di determinati errori hardware.</span><span class="sxs-lookup"><span data-stu-id="c5668-115">However, in some cases, component-specific time-out periods can delay the reporting of some hard errors.</span></span> <span data-ttu-id="c5668-116">Per gli errori software, la velocità di rilevamento degli errori dipende dalla durata del periodo di timeout della sessione.</span><span class="sxs-lookup"><span data-stu-id="c5668-116">For soft errors, the length of the session-timeout period determines the speed of error detection.</span></span> <span data-ttu-id="c5668-117">L'impostazione predefinita è 10 secondi.</span><span class="sxs-lookup"><span data-stu-id="c5668-117">By default, this period is 10 seconds.</span></span> <span data-ttu-id="c5668-118">Questo è il valore minimo consigliato.</span><span class="sxs-lookup"><span data-stu-id="c5668-118">This is the minimum recommended value.</span></span>  
  
## <a name="failures-due-to-hard-errors"></a><span data-ttu-id="c5668-119">Errori provocati da errori hardware</span><span class="sxs-lookup"><span data-stu-id="c5668-119">Failures Due to Hard Errors</span></span>  
 <span data-ttu-id="c5668-120">Di seguito vengono riportate alcune possibili cause di errori hardware:</span><span class="sxs-lookup"><span data-stu-id="c5668-120">Possible causes of hard errors include (but are not limited to) the following conditions:</span></span>  
  
-   <span data-ttu-id="c5668-121">Interruzione di una connessione o danneggiamento di un cavo</span><span class="sxs-lookup"><span data-stu-id="c5668-121">A broken connection or wire</span></span>  
  
-   <span data-ttu-id="c5668-122">Funzionamento non corretto di una scheda di rete</span><span class="sxs-lookup"><span data-stu-id="c5668-122">A bad network card</span></span>  
  
-   <span data-ttu-id="c5668-123">Modifica della configurazione di un router</span><span class="sxs-lookup"><span data-stu-id="c5668-123">A router change</span></span>  
  
-   <span data-ttu-id="c5668-124">Modifiche al firewall</span><span class="sxs-lookup"><span data-stu-id="c5668-124">Changes in the firewall</span></span>  
  
-   <span data-ttu-id="c5668-125">Riconfigurazione dell'endpoint</span><span class="sxs-lookup"><span data-stu-id="c5668-125">Endpoint reconfiguration</span></span>  
  
-   <span data-ttu-id="c5668-126">Guasto dell'unità contenente il log delle transazioni</span><span class="sxs-lookup"><span data-stu-id="c5668-126">Loss of the drive where the transaction log resides</span></span>  
  
-   <span data-ttu-id="c5668-127">Errori del sistema operativo o di processo</span><span class="sxs-lookup"><span data-stu-id="c5668-127">Operating system or process failure</span></span>  
  
 <span data-ttu-id="c5668-128">Se ad esempio l'unità dei log sul database primario smette di rispondere e genera un errore, il sistema operativo segnala a Sqlservr.exe che si è verificato un errore grave.</span><span class="sxs-lookup"><span data-stu-id="c5668-128">For example, when the log drive on the primary database becomes unresponsive and fails, the operating system informs Sqlservr.exe that a serious error has occurred.</span></span>  
  
 <span data-ttu-id="c5668-129">Alcuni componenti, ad esempio componenti di rete o alcuni sottosistemi IO, dispongono di specifici timeout per la determinazione degli errori.</span><span class="sxs-lookup"><span data-stu-id="c5668-129">Some components, such as network components and some IO subsystems, have their own time-outs to determine failures.</span></span> <span data-ttu-id="c5668-130">Tali timeout sono indipendenti da [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], che non è a conoscenza della loro esistenza né del loro funzionamento.</span><span class="sxs-lookup"><span data-stu-id="c5668-130">Such time-outs are independent of [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], which has no knowledge of them and is completely unaware of their behavior.</span></span> <span data-ttu-id="c5668-131">In questi casi, il ritardo di timeout aumenta il tempo che intercorre tra il verificarsi di un errore e la ricezione del corrispondente errore hardware da parte della replica di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c5668-131">In these cases, the time-out delay increases the time between a failure and when the availability replica receives the resulting hard error.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c5668-132">L'unico controllo degli errori attivo eseguito per le repliche di disponibilità si verifica per i casi di errori software.</span><span class="sxs-lookup"><span data-stu-id="c5668-132">The only active error checking performed for availability replicas occurs for soft error cases.</span></span> <span data-ttu-id="c5668-133">Per ulteriori informazioni, vedere "Errori provocati da errori software" di seguito in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="c5668-133">For more information, see "Failures Due to Soft Errors," later in this topic.</span></span>  
  
 <span data-ttu-id="c5668-134">Per interpretare correttamente le condizioni di errore che si verificano nella rete, richiedere a un tecnico della rete di indicare quali messaggi di errore vengono inviati a una porta quando si verificano gli eventi seguenti in una connessione TCP:</span><span class="sxs-lookup"><span data-stu-id="c5668-134">To help you interpret the error conditions that occur on the network, ask a network engineer what error messages are sent to a port when the following events occur on a TCP connection:</span></span>  
  
-   <span data-ttu-id="c5668-135">DNS non funziona correttamente.</span><span class="sxs-lookup"><span data-stu-id="c5668-135">DNS is not working.</span></span>  
  
-   <span data-ttu-id="c5668-136">I cavi sono scollegati.</span><span class="sxs-lookup"><span data-stu-id="c5668-136">Cables are unplugged.</span></span>  
  
-   [!INCLUDE[msCoName](../../../includes/msconame-md.md)] <span data-ttu-id="c5668-137">Windows blocca una porta specifica.</span><span class="sxs-lookup"><span data-stu-id="c5668-137">Windows has a firewall that blocks a specific port.</span></span>  
  
-   <span data-ttu-id="c5668-138">Si è verificato un errore nell'applicazione che esegue il monitoraggio di una porta.</span><span class="sxs-lookup"><span data-stu-id="c5668-138">The application that is monitoring a port fails.</span></span>  
  
-   <span data-ttu-id="c5668-139">Un server Windows è stato rinominato.</span><span class="sxs-lookup"><span data-stu-id="c5668-139">A Windows-based server is renamed.</span></span>  
  
-   <span data-ttu-id="c5668-140">Un server Windows è stato riavviato.</span><span class="sxs-lookup"><span data-stu-id="c5668-140">A Windows-based server is rebooted.</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssHADRc](../../../includes/sshadrc-md.md)] <span data-ttu-id="c5668-141">non fornisce protezione da problemi specifici dei client che accedono ai server.</span><span class="sxs-lookup"><span data-stu-id="c5668-141">does not protect against problems specific to client accessing the servers.</span></span> <span data-ttu-id="c5668-142">Si consideri, ad esempio, un caso in cui una scheda di rete pubblica gestisce le connessioni client alla replica primaria, mentre una scheda di interfaccia di rete privata gestisce il traffico tra le istanze del server che ospitano le repliche di un gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c5668-142">For example, consider a case in which a public network adapter handles client connections to the primary replica, while a private network interface card handles traffic among the server instances that are hosting the replicas of an availability group.</span></span> <span data-ttu-id="c5668-143">In questo caso, l'errore della scheda di rete pubblica impedirebbe l'accesso dei client al database.</span><span class="sxs-lookup"><span data-stu-id="c5668-143">In this case, failure of the public network adapter would prevent clients from accessing the databases.</span></span>  
  
## <a name="failures-due-to-soft-errors"></a><span data-ttu-id="c5668-144">Errori provocati da errori software</span><span class="sxs-lookup"><span data-stu-id="c5668-144">Failures Due to Soft Errors</span></span>  
 <span data-ttu-id="c5668-145">Di seguito vengono riportate alcune possibili cause dei timeout della sessione:</span><span class="sxs-lookup"><span data-stu-id="c5668-145">Conditions that might cause session timeouts include (but are not limited to) the following:</span></span>  
  
-   <span data-ttu-id="c5668-146">Errori di rete, ad esempio timeout di collegamenti TCP, pacchetti ignorati, danneggiati o in ordine errato.</span><span class="sxs-lookup"><span data-stu-id="c5668-146">Network errors such as TCP link time-outs, dropped or corrupted packets, or packets that are in an incorrect order.</span></span>  
  
-   <span data-ttu-id="c5668-147">Sistema operativo, server o database che non risponde.</span><span class="sxs-lookup"><span data-stu-id="c5668-147">An operating system, server, or database that is not responding.</span></span>  
  
-   <span data-ttu-id="c5668-148">Timeout di un server Windows.</span><span class="sxs-lookup"><span data-stu-id="c5668-148">A Windows server timing out.</span></span>  
  
-   <span data-ttu-id="c5668-149">Risorse di elaborazione insufficienti, ad esempio overload della CPU o del disco, esaurimento dello spazio del log delle transazioni o esaurimento della memoria o dei thread di sistema.</span><span class="sxs-lookup"><span data-stu-id="c5668-149">Insufficient computing resources, such as a CPU or disk overload, the transaction log filling up, or the system is running out of memory or threads.</span></span> <span data-ttu-id="c5668-150">In questi casi è necessario aumentare il periodo di timeout, ridurre il carico di lavoro o cambiare l'hardware per gestire il carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c5668-150">In these cases, you must increase the time-out period, reduce the workload, or change the hardware to handle the workload.</span></span>  
  
### <a name="the-session-timeout-mechanism"></a><span data-ttu-id="c5668-151">Meccanismo di timeout della sessione</span><span class="sxs-lookup"><span data-stu-id="c5668-151">The Session-Timeout Mechanism</span></span>  
 <span data-ttu-id="c5668-152">Poiché gli errori software non sono direttamente rilevabili da un'istanza del server, un errore software potrebbe potenzialmente causare che una replica di disponibilità attenda indefinitamente la risposta dell'altra replica di disponibilità in una sessione.</span><span class="sxs-lookup"><span data-stu-id="c5668-152">Because soft errors are not detectable directly by a server instance, a soft error could potentially cause an availability replica to wait indefinitely for a response from the other availability replica in a session.</span></span> <span data-ttu-id="c5668-153">Per evitare questo problema, [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] implementa un meccanismo di timeout della sessione in base alle repliche di disponibilità connesse che inviano un ping a ogni connessione aperta a intervalli fissi.</span><span class="sxs-lookup"><span data-stu-id="c5668-153">To prevent this, [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] implements a session time-out mechanism, based on the connected availability replicas sending out a ping on each open connection at a fixed interval.</span></span> <span data-ttu-id="c5668-154">La ricezione di un ping durante il periodo di timeout indica che la connessione è ancora aperta e che le istanze del server comunicano attraverso tale connessione.</span><span class="sxs-lookup"><span data-stu-id="c5668-154">Receiving a ping during the time-out period indicates that the connection is still open and that the server instances are communicating over it.</span></span> <span data-ttu-id="c5668-155">Quando riceve un ping, una replica reimposta il contatore del timeout su tale connessione.</span><span class="sxs-lookup"><span data-stu-id="c5668-155">On receiving a ping, a replica resets its time-out counter on that connection.</span></span> <span data-ttu-id="c5668-156">Per informazioni sulla relazione di timeout della modalità di disponibilità e della sessione, vedere [modalità di disponibilità (gruppi di disponibilità AlwaysOn)](availability-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="c5668-156">For information about the relationship of availability mode and session timeouts, see [Availability Modes (AlwaysOn Availability Groups)](availability-modes-always-on-availability-groups.md).</span></span>  
  
 <span data-ttu-id="c5668-157">Le repliche primarie e secondarie effettuano vicendevolmente il ping per segnalare che sono ancora attive e un limite di timeout della sessione impedisce che la replica attenda indefinitamente la ricezione di un ping dall'altra replica.</span><span class="sxs-lookup"><span data-stu-id="c5668-157">The primary and secondary replicas ping each other to signal that they are still active, and a session-timeout limit prevents either replica from waiting indefinitely to receive a ping from the other replica.</span></span> <span data-ttu-id="c5668-158">Il limite di timeout della sessione è una proprietà della replica configurabile dall'utente con un valore predefinito di 10 secondi.</span><span class="sxs-lookup"><span data-stu-id="c5668-158">The session-timeout limit is a user-configurable replica property with a default value of 10 seconds.</span></span> <span data-ttu-id="c5668-159">La ricezione di un ping durante il periodo di timeout indica che la connessione è ancora aperta e che le istanze del server comunicano attraverso tale connessione.</span><span class="sxs-lookup"><span data-stu-id="c5668-159">Receiving a ping during the time-out period indicates that the connection is still open and that the server instances are communicating over it.</span></span> <span data-ttu-id="c5668-160">Alla ricezione di un ping, la replica di disponibilità reimposta il contatore del timeout per quella connessione.</span><span class="sxs-lookup"><span data-stu-id="c5668-160">On receiving a ping, an availability replica resets its time-out counter on that connection.</span></span>  
  
 <span data-ttu-id="c5668-161">Se non viene ricevuto alcun ping dall'altra replica entro il periodo di timeout della sessione, si verifica il timeout della connessione. La connessione viene chiusa e la replica scaduta entra nello stato disconnesso.</span><span class="sxs-lookup"><span data-stu-id="c5668-161">If no ping is received from the other replica within the session-timeout period, the connection times out. The connection is closed, and the timed-out replica enters the DISCONNECTED state.</span></span> <span data-ttu-id="c5668-162">Anche se la replica disconnessa è configurata per la modalità con commit sincrono, le transazioni non attenderanno che quella replica venga riconnessa e risincronizzata.</span><span class="sxs-lookup"><span data-stu-id="c5668-162">Even if a disconnected replica is configured for synchronous-commit mode, transactions will not wait for that replica to reconnect and resynchronize.</span></span>  
  
## <a name="responding-to-an-error"></a><span data-ttu-id="c5668-163">Risposta a un errore</span><span class="sxs-lookup"><span data-stu-id="c5668-163">Responding to an Error</span></span>  
 <span data-ttu-id="c5668-164">Indipendentemente dal tipo di errore, un'istanza del server che rileva un errore esegue l'azione appropriata in base al proprio ruolo, alla modalità di disponibilità della sessione e allo stato delle altre connessioni della sessione.</span><span class="sxs-lookup"><span data-stu-id="c5668-164">Regardless of the type of error, a server instance that detects an error responds appropriately based on the role of the instance, the availability mode of the session, and the state of any other connection in the session.</span></span> <span data-ttu-id="c5668-165">Per informazioni su ciò che si verifica in caso di perdita di un partner, vedere [modalità di disponibilità (gruppi di disponibilità AlwaysOn)](availability-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="c5668-165">For information about what occurs on the loss of a partner, see [Availability Modes (AlwaysOn Availability Groups)](availability-modes-always-on-availability-groups.md).</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="c5668-166">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="c5668-166">Related Tasks</span></span>  
 <span data-ttu-id="c5668-167">**Per modificare il valore di timeout (solo modalità di disponibilità con commit sincrono)**</span><span class="sxs-lookup"><span data-stu-id="c5668-167">**To change the time-out value (synchronous-commit availability mode only)**</span></span>  
  
-   [<span data-ttu-id="c5668-168">Modificare il periodo di timeout della sessione per una replica di disponibilità &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="c5668-168">Change the Session-Timeout Period for an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-session-timeout-period-for-an-availability-replica-sql-server.md)  
  
 <span data-ttu-id="c5668-169">**Per visualizzare il valore di timeout corrente**</span><span class="sxs-lookup"><span data-stu-id="c5668-169">**To view the current time-out value**</span></span>  
  
-   <span data-ttu-id="c5668-170">Eseguire una query su **session_timeout** in [sys.availability_replicas &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c5668-170">Query **session_timeout** in [sys.availability_replicas &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c5668-171">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="c5668-171">See Also</span></span>  
 [<span data-ttu-id="c5668-172">Panoramica di Gruppi di disponibilità AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="c5668-172">Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](overview-of-always-on-availability-groups-sql-server.md)  
  
  
