---
title: Configurare il backup su repliche di disponibilità (SQL Server) | Microsoft Docs | Microsoft Docs
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- backup priority
- backup on secondary replicas
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], backup on secondary replicas
- active secondary replicas [SQL Server], backup on
- automated backup preference
- Availability Groups [SQL Server], active secondary replicas
ms.assetid: 74bc40bb-9f57-44e4-8988-1d69c0585eb6
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 91a781d957eb2f5a81d323fc3c65c93e34945c12
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87724988"
---
# <a name="configure-backup-on-availability-replicas-sql-server"></a><span data-ttu-id="c565d-102">Configurare il backup su repliche di disponibilità (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c565d-102">Configure Backup on Availability Replicas (SQL Server)</span></span>
  <span data-ttu-id="c565d-103">In questo argomento viene descritto come configurare il backup delle repliche secondarie per un gruppo di disponibilità AlwaysOn utilizzando [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)]o PowerShell in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c565d-103">This topic describes how to configure backup on secondary replicas for an AlwaysOn availability group by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or PowerShell in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c565d-104">Per un'introduzione al backup sulle repliche secondarie, vedere repliche secondarie [attive: backup in repliche secondarie (gruppi di disponibilità AlwaysOn)](active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="c565d-104">For an introduction to backup on secondary replicas, see [Active Secondaries: Backup on Secondary Replicas (AlwaysOn Availability Groups)](active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).</span></span>  
  
 
  

  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="c565d-105">Prima di iniziare</span><span class="sxs-lookup"><span data-stu-id="c565d-105">Before You Begin</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="c565d-106">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="c565d-106">Prerequisites</span></span>  
 <span data-ttu-id="c565d-107">È necessario essere connessi all'istanza del server che ospita la replica primaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-107">You must be connected to the server instance that hosts the primary replica.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="c565d-108">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="c565d-108">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="c565d-109">Autorizzazioni</span><span class="sxs-lookup"><span data-stu-id="c565d-109">Permissions</span></span>  
  
|<span data-ttu-id="c565d-110">Attività</span><span class="sxs-lookup"><span data-stu-id="c565d-110">Task</span></span>|<span data-ttu-id="c565d-111">Autorizzazioni</span><span class="sxs-lookup"><span data-stu-id="c565d-111">Permissions</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="c565d-112">Per configurare il backup delle repliche secondarie in caso di creazione di un gruppo di disponibilità</span><span class="sxs-lookup"><span data-stu-id="c565d-112">To configure backup on secondary replicas when creating an availability group</span></span>|<span data-ttu-id="c565d-113">Sono necessarie l'appartenenza al ruolo predefinito del server **sysadmin** e l'autorizzazione server CREATE AVAILABILITY GROUP oppure l'autorizzazione ALTER ANY AVAILABILITY GROUP o CONTROL SERVER.</span><span class="sxs-lookup"><span data-stu-id="c565d-113">Requires membership in the **sysadmin** fixed server role and either CREATE AVAILABILITY GROUP server permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>|  
|<span data-ttu-id="c565d-114">Per modificare un gruppo di disponibilità o una replica di disponibilità</span><span class="sxs-lookup"><span data-stu-id="c565d-114">To modify an availability group or availability replica</span></span>|<span data-ttu-id="c565d-115">È necessaria l'autorizzazione ALTER AVAILABILITY GROUP nel gruppo di disponibilità, l'autorizzazione CONTROL AVAILABILITY GROUP, l'autorizzazione ALTER ANY AVAILABILITY GROUP o l'autorizzazione CONTROL SERVER.</span><span class="sxs-lookup"><span data-stu-id="c565d-115">Requires ALTER AVAILABILITY GROUP permission on the availability group, CONTROL AVAILABILITY GROUP permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>|  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="c565d-116">Utilizzo di SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="c565d-116">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="c565d-117">**Per configurare il backup delle repliche secondarie**</span><span class="sxs-lookup"><span data-stu-id="c565d-117">**To configure backup on secondary replicas**</span></span>  
  
1.  <span data-ttu-id="c565d-118">In Esplora oggetti connettersi all'istanza del server in cui viene ospitata la replica primaria e fare clic sul nome del server per espandere il relativo albero.</span><span class="sxs-lookup"><span data-stu-id="c565d-118">In Object Explorer, connect to the server instance that hosts the primary replica, and click the server name to expand the server tree.</span></span>  
  
2.  <span data-ttu-id="c565d-119">Espandere il nodo **Disponibilità elevata AlwaysOn** e il nodo **Gruppi di disponibilità** .</span><span class="sxs-lookup"><span data-stu-id="c565d-119">Expand the **AlwaysOn High Availability** node and the **Availability Groups** node.</span></span>  
  
3.  <span data-ttu-id="c565d-120">Fare clic sul gruppo di disponibilità di cui si desidera configurare le preferenze di backup e scegliere il comando **Proprietà** .</span><span class="sxs-lookup"><span data-stu-id="c565d-120">Click the availability group whose backup preferences you want to configure, and select the **Properties** command.</span></span>  
  
4.  <span data-ttu-id="c565d-121">Nella finestra di dialogo **Proprietà gruppo di disponibilità** selezionare **Preferenze di backup** .</span><span class="sxs-lookup"><span data-stu-id="c565d-121">In the **Availability Group Properties** dialog box, select **Backup Preferences** page.</span></span>  
  
5.  <span data-ttu-id="c565d-122">Nel pannello **Specificare la destinazione dei backup** selezionare la preferenza di backup automatico per il gruppo di disponibilità, scegliendo una delle seguenti opzioni:</span><span class="sxs-lookup"><span data-stu-id="c565d-122">On the **Where should backups occur?** panel, select the automated backup preference for the availability group, one of:</span></span>  
  
     <span data-ttu-id="c565d-123">**Preferisco secondario**</span><span class="sxs-lookup"><span data-stu-id="c565d-123">**Prefer Secondary**</span></span>  
     <span data-ttu-id="c565d-124">Specifica che i backup devono essere eseguiti su una replica secondaria tranne quando la replica primaria è l'unica replica online.</span><span class="sxs-lookup"><span data-stu-id="c565d-124">Specifies that backups should occur on a secondary replica except when the primary replica is the only replica online.</span></span> <span data-ttu-id="c565d-125">In tal caso il backup deve essere eseguito sulla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-125">In that case, the backup should occur on the primary replica.</span></span> <span data-ttu-id="c565d-126">Questa è l'opzione predefinita.</span><span class="sxs-lookup"><span data-stu-id="c565d-126">This is the default option.</span></span>  
  
     <span data-ttu-id="c565d-127">**Solo secondaria**</span><span class="sxs-lookup"><span data-stu-id="c565d-127">**Secondary only**</span></span>  
     <span data-ttu-id="c565d-128">Specifica che i backup non devono mai essere eseguiti sulla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-128">Specifies that backups should never be performed on the primary replica.</span></span> <span data-ttu-id="c565d-129">Se la replica primaria è l'unica replica online, il backup non viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="c565d-129">If the primary replica is the only replica online, the backup should not occur.</span></span>  
  
     `Primary`  
     <span data-ttu-id="c565d-130">Specifica che i backup devono essere sempre eseguiti sulla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-130">Specifies that the backups should always occur on the primary replica.</span></span> <span data-ttu-id="c565d-131">Questa opzione è utile se sono necessarie funzionalità di backup, ad esempio la creazione di backup differenziali, che non sono supportate quando il backup viene eseguito su una replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-131">This option is useful if you need backup features, such as creating differential backups, that are not supported when backup is run on a secondary replica.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="c565d-132">Se si intende utilizzare il log shipping per preparare un qualsiasi database secondario per un gruppo di disponibilità, impostare la preferenza di backup automatico su `Primary` finché tutti i database secondari non saranno stati preparati e non ne sarà stato creato un join al gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c565d-132">If you plan to use log shipping to prepare any secondary databases for an availability group, set the automated backup preference to `Primary` until all the secondary databases have been prepared and joined to the availability group.</span></span>  
  
     <span data-ttu-id="c565d-133">**Qualsiasi replica**</span><span class="sxs-lookup"><span data-stu-id="c565d-133">**Any Replica**</span></span>  
     <span data-ttu-id="c565d-134">Specifica che si preferisce che i processi di backup ignorino il ruolo delle repliche di disponibilità nella scelta della replica per l'esecuzione dei backup.</span><span class="sxs-lookup"><span data-stu-id="c565d-134">Specifies that you prefer that backup jobs ignore the role of the availability replicas when choosing the replica to perform backups.</span></span> <span data-ttu-id="c565d-135">Si noti che i processi di backup potrebbero valutare altri fattori, ad esempio la priorità di backup di ogni replica di disponibilità in combinazione con lo stato operativo e lo stato connesso.</span><span class="sxs-lookup"><span data-stu-id="c565d-135">Note backup jobs might evaluate other factors such as backup priority of each availability replica in combination with its operational state and connected state.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="c565d-136">Non è prevista l'applicazione dell'impostazione relativa alle preferenze di backup automatico.</span><span class="sxs-lookup"><span data-stu-id="c565d-136">There is no enforcement of the automated backup preference setting.</span></span> <span data-ttu-id="c565d-137">L'interpretazione di questa preferenza dipende dall'eventuale logica su cui si basano gli script dei processi di backup per i database in un determinato gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c565d-137">The interpretation of this preference depends on the logic, if any, that you script into backup jobs for the databases in a given availability group.</span></span> <span data-ttu-id="c565d-138">L'impostazione relativa alle preferenze di backup automatico non incide sui backup ad hoc.</span><span class="sxs-lookup"><span data-stu-id="c565d-138">The automated backup preference setting has no impact on ad-hoc backups.</span></span> <span data-ttu-id="c565d-139">Per ulteriori informazioni, vedere [Completamento: Dopo avere configurato il backup su repliche secondarie](#FollowUp) più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="c565d-139">For more information, see [Follow Up: After Configuring Backup on Secondary Replicas](#FollowUp) later in this topic.</span></span>  
  
6.  <span data-ttu-id="c565d-140">Utilizzare la griglia **Priorità di backup replica** per modificare la priorità di backup delle repliche di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c565d-140">Use the **Replica backup priorities** grid to change the backup priority of the availability replicas.</span></span> <span data-ttu-id="c565d-141">In questa griglia è indicata la priorità di backup corrente di ogni istanza del server che ospita una replica per il gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c565d-141">This grid displays the current backup priority of each server instance that hosts a replica for the availability group.</span></span> <span data-ttu-id="c565d-142">Le colonne della griglia sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="c565d-142">The grid columns are as follows:</span></span>  
  
     <span data-ttu-id="c565d-143">**Istanza del server**</span><span class="sxs-lookup"><span data-stu-id="c565d-143">**Server Instance**</span></span>  
     <span data-ttu-id="c565d-144">Nome dell'istanza di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] che ospita la replica di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c565d-144">The name of the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that hosts the availability replica.</span></span>  
  
     <span data-ttu-id="c565d-145">**Priorità di backup (Più bassa=1, Più alta=100)**</span><span class="sxs-lookup"><span data-stu-id="c565d-145">**Backup Priority (Lowest=1, Highest=100)**</span></span>  
     <span data-ttu-id="c565d-146">Specifica la priorità di esecuzione dei backup nella replica rispetto alle altre repliche nello stesso gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c565d-146">Specifies your priority for performing backups on this replica relative to the other replicas in the same availability group.</span></span> <span data-ttu-id="c565d-147">Il valore è un numero intero compreso nell'intervallo 0-100.</span><span class="sxs-lookup"><span data-stu-id="c565d-147">The value is an integer in the range of 0..100.</span></span> <span data-ttu-id="c565d-148">1 indica la priorità più bassa e 100 indica la priorità più alta.</span><span class="sxs-lookup"><span data-stu-id="c565d-148">1 indicates the lowest priority, and 100 indicates the highest priority.</span></span> <span data-ttu-id="c565d-149">Se **Priorità di backup** = 1, la replica di disponibilità viene scelta per l'esecuzione dei backup solo se non sono disponibili repliche di disponibilità con priorità più alta.</span><span class="sxs-lookup"><span data-stu-id="c565d-149">If **Backup Priority** = 1, the availability replica would be chosen for performing backups only if no higher priority availability replicas are currently available.</span></span>  
  
     <span data-ttu-id="c565d-150">**Escludi replica**</span><span class="sxs-lookup"><span data-stu-id="c565d-150">**Exclude Replica**</span></span>  
     <span data-ttu-id="c565d-151">Selezionare questa opzione se si desidera che questa replica di disponibilità non venga mai scelta per l'esecuzione dei backup.</span><span class="sxs-lookup"><span data-stu-id="c565d-151">Select if you never want this availability replica to be chosen for performing backups.</span></span> <span data-ttu-id="c565d-152">Ciò si rivela utile, ad esempio, per una replica di disponibilità remota in cui non si desidera eseguire mai il failover dei backup.</span><span class="sxs-lookup"><span data-stu-id="c565d-152">This is useful, for example, for a remote availability replica to which you never want backups to fail over.</span></span>  
  
7.  <span data-ttu-id="c565d-153">Fare clic su **OK**per eseguire il commit delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="c565d-153">To commit your changes, click **OK**.</span></span>  
  
 <span data-ttu-id="c565d-154">**Modalità alternative da accedere alla pagina delle Preferenze di backup**</span><span class="sxs-lookup"><span data-stu-id="c565d-154">**Alternative ways to access the Backup Preferences page**</span></span>  
  
-   [<span data-ttu-id="c565d-155">Utilizzare la finestra di dialogo Nuovo gruppo di disponibilità &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="c565d-155">Use the New Availability Group Dialog Box &#40;SQL Server Management Studio&#41;</span></span>](use-the-new-availability-group-dialog-box-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="c565d-156">Usare la procedura guidata Aggiungi replica a gruppo di disponibilità &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="c565d-156">Use the Add Replica to Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-add-replica-to-availability-group-wizard-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="c565d-157">Utilizzare la finestra di dialogo Nuovo gruppo di disponibilità &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="c565d-157">Use the New Availability Group Dialog Box &#40;SQL Server Management Studio&#41;</span></span>](use-the-new-availability-group-dialog-box-sql-server-management-studio.md)  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="c565d-158">Uso di Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="c565d-158">Using Transact-SQL</span></span>  
 <span data-ttu-id="c565d-159">**Per configurare il backup delle repliche secondarie**</span><span class="sxs-lookup"><span data-stu-id="c565d-159">**To configure backup on secondary replicas**</span></span>  
  
1.  <span data-ttu-id="c565d-160">Connettersi all'istanza del server che ospita la replica primaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-160">Connect to the server instance that hosts the primary replica.</span></span>  
  
2.  <span data-ttu-id="c565d-161">Per un nuovo gruppo di disponibilità, usare l'istruzione [CREATE AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-availability-group-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c565d-161">For a new availability group, use the [CREATE AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-availability-group-transact-sql) statement.</span></span> <span data-ttu-id="c565d-162">Se si modifica un gruppo di disponibilità esistente, usare l'istruzione [ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-availability-group-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c565d-162">If you are modifying an existing availability group, use the [ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-availability-group-transact-sql) statement.</span></span>  
  
##  <a name="using-powershell"></a><a name="PowerShellProcedure"></a> <span data-ttu-id="c565d-163">Uso di PowerShell</span><span class="sxs-lookup"><span data-stu-id="c565d-163">Using PowerShell</span></span>  

### <a name="to-configure-backup-on-secondary-replicas"></a><span data-ttu-id="c565d-164">Per configurare il backup delle repliche secondarie</span><span class="sxs-lookup"><span data-stu-id="c565d-164">To configure backup on secondary replicas</span></span>
  
1.  <span data-ttu-id="c565d-165">Impostare il valore predefinito (`cd`) sull'istanza del server che ospita la replica primaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-165">Set default (`cd`) to the server instance that hosts the primary replica.</span></span>  
  
2.  <span data-ttu-id="c565d-166">Facoltativamente, configurare la priorità di backup di ogni replica di disponibilità aggiunta o modificata.</span><span class="sxs-lookup"><span data-stu-id="c565d-166">Optionally, configure the backup priority of each availability replica that you are adding or modifying.</span></span> <span data-ttu-id="c565d-167">Tale priorità viene utilizzata dall'istanza del server che ospita la replica primaria per stabilire quale replica deve soddisfare una richiesta di backup automatico in un database nel gruppo di disponibilità (viene scelta la replica con la priorità più alta).</span><span class="sxs-lookup"><span data-stu-id="c565d-167">This priority is used by the server instance that hosts the primary replica to decide which replica should service an automated backup request on a database in the availability group (the replica with highest priority is chosen).</span></span> <span data-ttu-id="c565d-168">La priorità può essere impostata su qualsiasi numero compreso tra 0 e 100 inclusi.</span><span class="sxs-lookup"><span data-stu-id="c565d-168">This priority can be any number between 0 and 100, inclusive.</span></span> <span data-ttu-id="c565d-169">0 indica che la replica non deve essere considerata per soddisfare le richieste di backup.</span><span class="sxs-lookup"><span data-stu-id="c565d-169">A priority of 0 indicates that the replica should not be considered as a candidate for servicing backup requests.</span></span>  <span data-ttu-id="c565d-170">L'impostazione predefinita è 50.</span><span class="sxs-lookup"><span data-stu-id="c565d-170">The default setting is 50.</span></span>  
  
     <span data-ttu-id="c565d-171">Quando si aggiunge una replica di disponibilità a un gruppo di disponibilità, utilizzare il cmdlet `New-SqlAvailabilityReplica`.</span><span class="sxs-lookup"><span data-stu-id="c565d-171">When adding an availability replica to an availability group, use the `New-SqlAvailabilityReplica` cmdlet.</span></span> <span data-ttu-id="c565d-172">Quando si modifica una replica di disponibilità esistente, utilizzare il cmdlet `Set-SqlAvailabilityReplica`.</span><span class="sxs-lookup"><span data-stu-id="c565d-172">When modifying an existing availability replica, use the `Set-SqlAvailabilityReplica` cmdlet.</span></span> <span data-ttu-id="c565d-173">In entrambi i casi, specificare il `BackupPriority` parametro *n* , dove *n* è un valore compreso tra 0 e 100.</span><span class="sxs-lookup"><span data-stu-id="c565d-173">In either case, specify the `BackupPriority`*n* parameter, where *n* is a value from 0 to 100.</span></span>  
  
     <span data-ttu-id="c565d-174">Ad esempio, nel comando seguente viene impostata la priorità di backup della replica di disponibilità `MyReplica` su `60`.</span><span class="sxs-lookup"><span data-stu-id="c565d-174">For example, the following command sets the backup priority of the availability replica `MyReplica` to `60`.</span></span>  
  
    ```powershell
    Set-SqlAvailabilityReplica -BackupPriority 60 -Path SQLSERVER:\Sql\Computer\Instance\AvailabilityGroups\MyAg\AvailabilityReplicas\MyReplica  
    ```  
  
3.  <span data-ttu-id="c565d-175">Configurare facoltativamente la preferenza di backup automatico per il gruppo di disponibilità in fase di creazione o modifica.</span><span class="sxs-lookup"><span data-stu-id="c565d-175">Optionally, configure the automated backup preference for the availability group that you are creating  or modifying.</span></span> <span data-ttu-id="c565d-176">Questa preferenza indica la modalità di valutazione della replica primaria da parte di un processo di backup nella scelta della posizione in cui eseguire i backup.</span><span class="sxs-lookup"><span data-stu-id="c565d-176">This preference indicates how a backup job should evaluate the primary replica when choosing where to perform backups.</span></span> <span data-ttu-id="c565d-177">L'impostazione predefinita è quella di preferire le repliche secondarie.</span><span class="sxs-lookup"><span data-stu-id="c565d-177">The default setting is to prefer secondary replicas.</span></span>  
  
     <span data-ttu-id="c565d-178">Quando si crea un gruppo di disponibilità, utilizzare il cmdlet `New-SqlAvailabilityGroup`.</span><span class="sxs-lookup"><span data-stu-id="c565d-178">When creating an availability group, use the `New-SqlAvailabilityGroup` cmdlet.</span></span> <span data-ttu-id="c565d-179">Quando si modifica un gruppo di disponibilità esistente, utilizzare il cmdlet `Set-SqlAvailabilityGroup`.</span><span class="sxs-lookup"><span data-stu-id="c565d-179">When modifying an existing availability group, use the `Set-SqlAvailabilityGroup` cmdlet.</span></span> <span data-ttu-id="c565d-180">In entrambi i casi, specificare il parametro `AutomatedBackupPreference`.</span><span class="sxs-lookup"><span data-stu-id="c565d-180">In either case, specify the `AutomatedBackupPreference` parameter.</span></span>  
  
     <span data-ttu-id="c565d-181">dove</span><span class="sxs-lookup"><span data-stu-id="c565d-181">where,</span></span>  
  
     `Primary`  
     <span data-ttu-id="c565d-182">Specifica che i backup devono essere sempre eseguiti sulla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-182">Specifies that the backups should always occur on the primary replica.</span></span> <span data-ttu-id="c565d-183">Questa opzione è utile se sono necessarie funzionalità di backup, ad esempio la creazione di backup differenziali, che non sono supportate quando il backup viene eseguito su una replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-183">This option is useful if you need backup features, such as creating differential backups, that are not supported when backup is run on a secondary replica.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="c565d-184">Se si intende utilizzare il log shipping per preparare un qualsiasi database secondario per un gruppo di disponibilità, impostare la preferenza di backup automatico su `Primary` finché tutti i database secondari non saranno stati preparati e non ne sarà stato creato un join al gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c565d-184">If you plan to use log shipping to prepare any secondary databases for an availability group, set the automated backup preference to `Primary` until all the secondary databases have been prepared and joined to the availability group.</span></span>  
  
     `SecondaryOnly`  
     <span data-ttu-id="c565d-185">Specifica che i backup non devono mai essere eseguiti sulla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-185">Specifies that backups should never be performed on the primary replica.</span></span> <span data-ttu-id="c565d-186">Se la replica primaria è l'unica replica online, il backup non viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="c565d-186">If the primary replica is the only replica online, the backup should not occur.</span></span>  
  
     `Secondary`  
     <span data-ttu-id="c565d-187">Specifica che i backup devono essere eseguiti su una replica secondaria tranne quando la replica primaria è l'unica replica online.</span><span class="sxs-lookup"><span data-stu-id="c565d-187">Specifies that backups should occur on a secondary replica except when the primary replica is the only replica online.</span></span> <span data-ttu-id="c565d-188">In tal caso il backup deve essere eseguito sulla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-188">In that case, the backup should occur on the primary replica.</span></span> <span data-ttu-id="c565d-189">Questo è il comportamento predefinito.</span><span class="sxs-lookup"><span data-stu-id="c565d-189">This is the default behavior.</span></span>  
  
     `None`  
     <span data-ttu-id="c565d-190">Specifica che si preferisce che i processi di backup ignorino il ruolo delle repliche di disponibilità nella scelta della replica per l'esecuzione dei backup.</span><span class="sxs-lookup"><span data-stu-id="c565d-190">Specifies that you prefer that backup jobs ignore the role of the availability replicas when choosing the replica to perform backups.</span></span> <span data-ttu-id="c565d-191">Si noti che i processi di backup potrebbero valutare altri fattori, ad esempio la priorità di backup di ogni replica di disponibilità in combinazione con lo stato operativo e lo stato connesso.</span><span class="sxs-lookup"><span data-stu-id="c565d-191">Note backup jobs might evaluate other factors such as backup priority of each availability replica in combination with its operational state and  connected state.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="c565d-192">Non è prevista l'applicazione di `AutomatedBackupPreference`.</span><span class="sxs-lookup"><span data-stu-id="c565d-192">There is no enforcement of `AutomatedBackupPreference`.</span></span> <span data-ttu-id="c565d-193">L'interpretazione di questa preferenza dipende dall'eventuale logica su cui si basano gli script dei processi di backup per i database in un determinato gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c565d-193">The interpretation of this preference depends on the logic, if any, that you script into backup jobs for the databases in a given availability group.</span></span> <span data-ttu-id="c565d-194">L'impostazione relativa alle preferenze di backup automatico non incide sui backup ad hoc.</span><span class="sxs-lookup"><span data-stu-id="c565d-194">The automated backup preference setting has no impact on ad-hoc backups.</span></span> <span data-ttu-id="c565d-195">Per ulteriori informazioni, vedere [Completamento: Dopo avere configurato il backup su repliche secondarie](#FollowUp) più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="c565d-195">For more information, see [Follow Up: After Configuring Backup on Secondary Replicas](#FollowUp) later in this topic.</span></span>  
  
     <span data-ttu-id="c565d-196">Ad esempio, nel comando seguente viene impostata la proprietà `AutomatedBackupPreference` del gruppo di disponibilità `MyAg` su `SecondaryOnly`.</span><span class="sxs-lookup"><span data-stu-id="c565d-196">For example, the following command sets the `AutomatedBackupPreference` property on the availability group `MyAg` to `SecondaryOnly`.</span></span> <span data-ttu-id="c565d-197">I backup automatici dei database in questo gruppo di disponibilità non verranno mai eseguiti nella replica primaria, ma verranno reindirizzati alla replica secondaria con l'impostazione della priorità di backup più elevata.</span><span class="sxs-lookup"><span data-stu-id="c565d-197">Automated backups of databases in this availability group will never occur on the primary replica, but will be redirected to the secondary replica with the highest backup priority setting.</span></span>  
  
    ```powershell
    Set-SqlAvailabilityGroup -Path SQLSERVER:\Sql\PrimaryServer\InstanceName\AvailabilityGroups\MyAg `  
     -AutomatedBackupPreference SecondaryOnly  
    ```  
  
> [!NOTE]  
>  <span data-ttu-id="c565d-198">Per visualizzare la sintassi di un cmdlet, utilizzare il cmdlet `Get-Help` nell'ambiente [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c565d-198">To view the syntax of a cmdlet, use the `Get-Help` cmdlet in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell environment.</span></span> <span data-ttu-id="c565d-199">Per altre informazioni, vedere [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="c565d-199">For more information, see [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span></span>  
  
<span data-ttu-id="c565d-200">Per configurare e usare il provider di SQL Server PowerShell, vedere [provider SQL Server PowerShell](../../../powershell/sql-server-powershell-provider.md) e [ottenere assistenza SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="c565d-200">To set up and use the SQL Server PowerShell provider, see [SQL Server PowerShell Provider](../../../powershell/sql-server-powershell-provider.md) and [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span></span>
  
##  <a name="follow-up-after-configuring-backup-on-secondary-replicas"></a><a name="FollowUp"></a><span data-ttu-id="c565d-201">Completamento: dopo la configurazione del backup su repliche secondarie</span><span class="sxs-lookup"><span data-stu-id="c565d-201">Follow Up: After Configuring Backup on Secondary Replicas</span></span>  
 <span data-ttu-id="c565d-202">Per prendere in considerazione le preferenze di backup automatico per un gruppo di disponibilità specifico, in ogni istanza del server in cui è ospitata una replica di disponibilità la cui priorità di backup è maggiore di zero (>0) è necessario generare script dei processi di backup per i database nel gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c565d-202">To take the automated backup preference into account for a given availability group, on each server instance that hosts an availability replica whose backup priority is greater than zero (>0), you need to script backup jobs for the databases in the availability group.</span></span> <span data-ttu-id="c565d-203">Per determinare se la replica corrente è la replica di backup preferita, usare la funzione [sys.fn_hadr_backup_is_preferred_replica](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql) nello script di backup.</span><span class="sxs-lookup"><span data-stu-id="c565d-203">To determine whether the current replica is the preferred backup replica, use the [sys.fn_hadr_backup_is_preferred_replica](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql) function in your backup script.</span></span> <span data-ttu-id="c565d-204">Se la replica di disponibilità ospitata dall'istanza del server corrente è la replica preferita per i backup, questa funzione restituisce 1.</span><span class="sxs-lookup"><span data-stu-id="c565d-204">If the availability replica that is hosted by the current server instance is the preferred replica for backups, this function returns 1.</span></span> <span data-ttu-id="c565d-205">In caso contrario, la funzione restituisce 0.</span><span class="sxs-lookup"><span data-stu-id="c565d-205">If not, the function returns 0.</span></span> <span data-ttu-id="c565d-206">Eseguendo uno script semplice in ogni replica di disponibilità tramite cui viene eseguita una query su questa funzione, è possibile determinare in quale replica deve essere eseguito un processo di backup specificato.</span><span class="sxs-lookup"><span data-stu-id="c565d-206">By running a simple script on each availability replica that queries this function, you can determine which replica should run a given backup job.</span></span> <span data-ttu-id="c565d-207">Di seguito è riportato un esempio di un tipico frammento di script per un processo di backup:</span><span class="sxs-lookup"><span data-stu-id="c565d-207">For example, a typical snippet of a backup-job script would look like:</span></span>  
  
```  
IF (NOT sys.fn_hadr_backup_is_preferred_replica(@DBNAME))  
BEGIN  
      Select 'This is not the preferred replica, exiting with success';  
      RETURN 0 - This is a normal, expected condition, so the script returns success  
END  
BACKUP DATABASE @DBNAME TO DISK=<disk>  
   WITH COPY_ONLY;  
```  
  
 <span data-ttu-id="c565d-208">Generando uno script per un processo di backup con questo tipo di logica è possibile pianificare il processo affinché venga eseguito in ogni replica di disponibilità presente nella stessa pianificazione.</span><span class="sxs-lookup"><span data-stu-id="c565d-208">Scripting a backup job with this logic enables you to schedule the job to run on every availability replica on the same schedule.</span></span> <span data-ttu-id="c565d-209">Ognuno di questi processi analizza gli stessi dati per determinare il processo da eseguire, pertanto solo uno dei processi pianificati procede effettivamente alla fase di backup.</span><span class="sxs-lookup"><span data-stu-id="c565d-209">Each of these jobs looks at the same data to determine which job should run, so only one of the scheduled job actually proceeds to the backup stage.</span></span>  <span data-ttu-id="c565d-210">In caso di failover, nessuno degli script o processi deve essere modificato.</span><span class="sxs-lookup"><span data-stu-id="c565d-210">In the event of a failover, none of the scripts or jobs needs to be modified.</span></span> <span data-ttu-id="c565d-211">Inoltre, se si riconfigura un gruppo di disponibilità per aggiungere una replica di disponibilità, la gestione del processo di backup richiede la copia o la pianificazione del processo di backup.</span><span class="sxs-lookup"><span data-stu-id="c565d-211">Also, if you reconfigure an availability group to add an availability replica, managing the backup job requires simply copying or scheduling the backup job.</span></span> <span data-ttu-id="c565d-212">Se si rimuove una replica di disponibilità, eliminare semplicemente il processo di backup dall'istanza del server che la ospitava.</span><span class="sxs-lookup"><span data-stu-id="c565d-212">If you remove an availability replica, simply delete the backup job from the server instance that hosted that replica.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="c565d-213">Se si usa la[Creazione guidata piano di manutenzione](../../../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md)per creare un processo di backup specifico, il processo includerà automaticamente la logica di scripting che chiama e controlla la funzione **sys.fn_hadr_backup_is_preferred_replica** .</span><span class="sxs-lookup"><span data-stu-id="c565d-213">If you use the[Maintenance Plan Wizard](../../../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md)to create a given backup job, the job will automatically include the scripting logic that calls and checks the **sys.fn_hadr_backup_is_preferred_replica** function.</span></span> <span data-ttu-id="c565d-214">Tuttavia, il processo di backup non restituirà il messaggio che indica che non si tratta della replica preferita. Assicurarsi di creare i processi per ogni database di disponibilità in ogni istanza del server che ospita una replica di disponibilità per il gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c565d-214">However, the backup job will not return the "This is not the preferred replica..." message.Be sure to create the job(s) for each availability database on every server instance that hosts an availability replica for the availability group.</span></span>  
  
##  <a name="to-obtain-information-about-backup-preference-settings"></a><a name="ForInfoAboutBuPref"></a><span data-ttu-id="c565d-215">Per ottenere informazioni sulle impostazioni delle preferenze di backup</span><span class="sxs-lookup"><span data-stu-id="c565d-215">To Obtain Information About Backup Preference Settings</span></span>  
 <span data-ttu-id="c565d-216">Gli elementi seguenti sono utili per ottenere informazioni pertinenti per il backup di una replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="c565d-216">The following are useful for obtaining information that is relevant for backup on secondary.</span></span>  
  
|<span data-ttu-id="c565d-217">Visualizza</span><span class="sxs-lookup"><span data-stu-id="c565d-217">View</span></span>|<span data-ttu-id="c565d-218">Informazioni</span><span class="sxs-lookup"><span data-stu-id="c565d-218">Information</span></span>|<span data-ttu-id="c565d-219">Colonne pertinenti</span><span class="sxs-lookup"><span data-stu-id="c565d-219">Relevant Columns</span></span>|  
|----------|-----------------|----------------------|  
|[<span data-ttu-id="c565d-220">sys.fn_hadr_backup_is_preferred_replica</span><span class="sxs-lookup"><span data-stu-id="c565d-220">sys.fn_hadr_backup_is_preferred_replica</span></span>](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql)|<span data-ttu-id="c565d-221">Indica se la replica corrente è la replica di backup preferita</span><span class="sxs-lookup"><span data-stu-id="c565d-221">Is the current replica the preferred backup replica?</span></span>|<span data-ttu-id="c565d-222">Non applicabile.</span><span class="sxs-lookup"><span data-stu-id="c565d-222">Not applicable.</span></span>|  
|[<span data-ttu-id="c565d-223">sys.availability_groups</span><span class="sxs-lookup"><span data-stu-id="c565d-223">sys.availability_groups</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-groups-transact-sql)|<span data-ttu-id="c565d-224">preferenza di backup automatico</span><span class="sxs-lookup"><span data-stu-id="c565d-224">Automated backup preference</span></span>|<span data-ttu-id="c565d-225">**automated_backup_preference**</span><span class="sxs-lookup"><span data-stu-id="c565d-225">**automated_backup_preference**</span></span><br /><br /> <span data-ttu-id="c565d-226">**automated_backup_preference_desc**</span><span class="sxs-lookup"><span data-stu-id="c565d-226">**automated_backup_preference_desc**</span></span>|  
|[<span data-ttu-id="c565d-227">sys.availability_replicas</span><span class="sxs-lookup"><span data-stu-id="c565d-227">sys.availability_replicas</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql)|<span data-ttu-id="c565d-228">Priorità di backup di una determinata replica di disponibilità</span><span class="sxs-lookup"><span data-stu-id="c565d-228">Backup priority of a given availability replica</span></span>|<span data-ttu-id="c565d-229">**backup_priority**</span><span class="sxs-lookup"><span data-stu-id="c565d-229">**backup_priority**</span></span>|  
|[<span data-ttu-id="c565d-230">sys.dm_hadr_availability_replica_states</span><span class="sxs-lookup"><span data-stu-id="c565d-230">sys.dm_hadr_availability_replica_states</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-replica-states-transact-sql)|<span data-ttu-id="c565d-231">Indica se la replica è locale all'istanza del server</span><span class="sxs-lookup"><span data-stu-id="c565d-231">Is replica local to the server instance?</span></span><br /><br /> <span data-ttu-id="c565d-232">Ruolo corrente</span><span class="sxs-lookup"><span data-stu-id="c565d-232">Current role</span></span><br /><br /> <span data-ttu-id="c565d-233">Stato operativo</span><span class="sxs-lookup"><span data-stu-id="c565d-233">Operational state</span></span><br /><br /> <span data-ttu-id="c565d-234">Stato Connesso</span><span class="sxs-lookup"><span data-stu-id="c565d-234">Connected state</span></span><br /><br /> <span data-ttu-id="c565d-235">Integrità della sincronizzazione di una replica di disponibilità</span><span class="sxs-lookup"><span data-stu-id="c565d-235">Synchronization health of an availability replica</span></span>|<span data-ttu-id="c565d-236">**is_local**</span><span class="sxs-lookup"><span data-stu-id="c565d-236">**is_local**</span></span><br /><br /> <span data-ttu-id="c565d-237">**role**, **role_desc**</span><span class="sxs-lookup"><span data-stu-id="c565d-237">**role**, **role_desc**</span></span><br /><br /> <span data-ttu-id="c565d-238">**operational_state**, **operational_state_desc**</span><span class="sxs-lookup"><span data-stu-id="c565d-238">**operational_state**, **operational_state_desc**</span></span><br /><br /> <span data-ttu-id="c565d-239">**connected_state**, **connected_state_desc**</span><span class="sxs-lookup"><span data-stu-id="c565d-239">**connected_state**, **connected_state_desc**</span></span><br /><br /> <span data-ttu-id="c565d-240">**synchronization_health**, **synchronization_health_desc**</span><span class="sxs-lookup"><span data-stu-id="c565d-240">**synchronization_health**, **synchronization_health_desc**</span></span>|  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="c565d-241">Contenuto correlato</span><span class="sxs-lookup"><span data-stu-id="c565d-241">Related Content</span></span>  
  
-   [<span data-ttu-id="c565d-242">Pagina relativa alla guida alle soluzioni AlwaysOn di Microsoft SQL Server per la disponibilità elevata e il ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="c565d-242">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   [<span data-ttu-id="c565d-243">Blog del team di SQL Server AlwaysOn: Blog del team ufficiale di SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="c565d-243">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="c565d-244">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="c565d-244">See Also</span></span>  
 <span data-ttu-id="c565d-245">[Panoramica di Gruppi di disponibilità AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="c565d-245">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="c565d-246">Repliche secondarie attive: Backup in repliche secondarie (Gruppi di disponibilità AlwaysOn)</span><span class="sxs-lookup"><span data-stu-id="c565d-246">Active Secondaries: Backup on Secondary Replicas (AlwaysOn Availability Groups)</span></span>](active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md) 
