---
title: Uso degli indici columnstore cluster | Microsoft Docs
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
ms.assetid: 5af6b91c-724f-45ac-aff1-7555014914f4
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: afc7da4e28ef7f32ca4a2b4ea762e5a5af442471
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87624296"
---
# <a name="using-clustered-columnstore-indexes"></a><span data-ttu-id="14a72-102">Utilizzo di indici columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-102">Using Clustered Columnstore Indexes</span></span>
  <span data-ttu-id="14a72-103">Attività per l'utilizzo di indici columnstore cluster in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="14a72-103">Tasks for using clustered columnstore indexes in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>

 <span data-ttu-id="14a72-104">Per una panoramica di indici columnstore, vedere [Columnstore Indexes Described](../relational-databases/indexes/columnstore-indexes-described.md).</span><span class="sxs-lookup"><span data-stu-id="14a72-104">For an overview of columnstore indexes, see [Columnstore Indexes Described](../relational-databases/indexes/columnstore-indexes-described.md).</span></span>

 <span data-ttu-id="14a72-105">Per informazioni sugli indici columnstore cluster, vedere [Using Clustered Columnstore Indexes](../relational-databases/indexes/indexes.md).</span><span class="sxs-lookup"><span data-stu-id="14a72-105">For information about clustered columnstore indexes, see [Using Clustered Columnstore Indexes](../relational-databases/indexes/indexes.md).</span></span>

## <a name="contents"></a><span data-ttu-id="14a72-106">Contenuto</span><span class="sxs-lookup"><span data-stu-id="14a72-106">Contents</span></span>

-   [<span data-ttu-id="14a72-107">Creare un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-107">Create a Clustered Columnstore Index</span></span>](#create)

-   [<span data-ttu-id="14a72-108">Eliminare un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-108">Drop a Clustered Columnstore Index</span></span>](#drop)

-   [<span data-ttu-id="14a72-109">Caricare dati in un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-109">Load Data into a Clustered Columnstore Index</span></span>](#load)

-   [<span data-ttu-id="14a72-110">Modificare i dati in un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-110">Change Data in a Clustered Columnstore Index</span></span>](#change)

-   [<span data-ttu-id="14a72-111">Ricompilare un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-111">Rebuild a Clustered Columnstore Index</span></span>](#rebuild)

-   [<span data-ttu-id="14a72-112">Riorganizzare un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-112">Reorganize a Clustered Columnstore Index</span></span>](#reorganize)

##  <a name="create-a-clustered-columnstore-index"></a><a name="create"></a><span data-ttu-id="14a72-113">Creare un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-113">Create a Clustered Columnstore Index</span></span>
 <span data-ttu-id="14a72-114">Per creare un indice columnstore cluster, creare innanzitutto una tabella rowstore come un heap o un indice cluster e quindi usare l'istruzione [Create Clustered columnstore index &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) per convertire la tabella in un indice columnstore cluster.</span><span class="sxs-lookup"><span data-stu-id="14a72-114">To create a clustered columnstore index, first create a rowstore table as a heap or clustered index, and then use the [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) statement to convert the table to a clustered columnstore index.</span></span> <span data-ttu-id="14a72-115">Se si desidera che l'indice columnstore cluster abbia lo stesso nome dell'indice cluster, utilizzare l'opzione DROP_EXISTING.</span><span class="sxs-lookup"><span data-stu-id="14a72-115">If you want the clustered columnstore index to have the same name as the clustered index, use the DROP_EXISTING option.</span></span>

 <span data-ttu-id="14a72-116">In questo esempio viene creata una tabella come heap, che viene poi convertita in un indice columnstore cluster denominato cci_Simple.</span><span class="sxs-lookup"><span data-stu-id="14a72-116">This example creates a table as a heap and then converts it to a clustered columnstore index named cci_Simple.</span></span> <span data-ttu-id="14a72-117">In questo modo viene modificata l'archiviazione dell'intera tabella da rowstore a columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-117">This changes the storage for the entire table from rowstore to columnstore.</span></span>

```
CREATE TABLE T1(
    ProductKey [int] NOT NULL, 
    OrderDateKey [int] NOT NULL, 
    DueDateKey [int] NOT NULL, 
    ShipDateKey [int] NOT NULL);
GO
CREATE CLUSTERED COLUMNSTORE INDEX cci_T1 ON T1;
GO
```

 <span data-ttu-id="14a72-118">Per altri esempi, vedere la sezione Esempi in [creare un indice columnstore cluster &#40;&#41;Transact-SQL ](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="14a72-118">For more examples, see the Examples section in [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span></span>

##  <a name="drop-a-clustered-columnstore-index"></a><a name="drop"></a><span data-ttu-id="14a72-119">Eliminare un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-119">Drop a Clustered Columnstore Index</span></span>
 <span data-ttu-id="14a72-120">Utilizzare l'istruzione [DROP INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-index-transact-sql) per eliminare un indice columnstore cluster.</span><span class="sxs-lookup"><span data-stu-id="14a72-120">Use the [DROP INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-index-transact-sql) statement to drop a clustered columnstore index.</span></span> <span data-ttu-id="14a72-121">Questa operazione consente di eliminare l'indice e convertire la tabella columnstore nell'heap di un rowstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-121">This operation will drop the index and convert the columnstore table to a rowstore heap.</span></span>

##  <a name="load-data-into-a-clustered-columnstore-index"></a><a name="load"></a><span data-ttu-id="14a72-122">Caricare i dati in un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-122">Load Data into a Clustered Columnstore Index</span></span>
 <span data-ttu-id="14a72-123">È possibile aggiungere dati a un indice columnstore cluster esistente utilizzando uno dei metodi di caricamento standard.</span><span class="sxs-lookup"><span data-stu-id="14a72-123">You can add data to an existing clustered columnstore index by using any of the standard loading methods.</span></span>  <span data-ttu-id="14a72-124">Ad esempio, lo strumento di caricamento bulk bcp, Integration Services e INSERT... SELECT consente di caricare tutti i dati in un indice columnstore cluster.</span><span class="sxs-lookup"><span data-stu-id="14a72-124">For example, the bcp bulk loading tool, Integration Services, and INSERT ... SELECT can all load data into a clustered columnstore index.</span></span>

 <span data-ttu-id="14a72-125">Gli indici columnstore cluster utilizzano il deltastore per impedire la frammentazione dei segmenti di colonna nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-125">Clustered columnstore indexes leverage the deltastore in order to prevent fragmentation of column segments in the columnstore.</span></span>

### <a name="loading-into-a-partitioned-table"></a><span data-ttu-id="14a72-126">Caricamento in una tabella partizionata</span><span class="sxs-lookup"><span data-stu-id="14a72-126">Loading into a partitioned table</span></span>
 <span data-ttu-id="14a72-127">Per i dati partizionati, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] assegna prima ogni riga a una partizione, quindi esegue operazioni columnstore sui dati nella partizione.</span><span class="sxs-lookup"><span data-stu-id="14a72-127">For partitioned data, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] first assigns each row to a partition, and then performs columnstore operations on the data within the partition.</span></span> <span data-ttu-id="14a72-128">Ogni partizione ha i propri rowgroup e almeno un deltastore.</span><span class="sxs-lookup"><span data-stu-id="14a72-128">Each partition has its own rowgroups and at least one deltastore.</span></span>

### <a name="deltastore-loading-scenarios"></a><span data-ttu-id="14a72-129">Scenari di caricamento deltastore</span><span class="sxs-lookup"><span data-stu-id="14a72-129">Deltastore loading scenarios</span></span>
 <span data-ttu-id="14a72-130">Le righe vengono accumulate nel deltastore finché non viene raggiunto il numero di righe massimo consentito per un rowgroup.</span><span class="sxs-lookup"><span data-stu-id="14a72-130">Rows accumulate in the deltastore until the number of rows is the maximum number of rows allowed for a rowgroup.</span></span> <span data-ttu-id="14a72-131">Quando deltastore contiene il numero massimo di righe per rowgroup, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] contrassegna il rowgroup come "closed".</span><span class="sxs-lookup"><span data-stu-id="14a72-131">When the deltastore contains the maximum number of rows per rowgroup, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the rowgroup as "CLOSED".</span></span> <span data-ttu-id="14a72-132">Un processo in background, denominato "tuple-Mover", trova il rowgroup chiuso e passa al columnstore, in cui il rowgroup viene compresso in segmenti di colonna e i segmenti di colonna vengono archiviati nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-132">A background process, called the "tuple-mover", finds the CLOSED rowgroup and moves into the columnstore, where the rowgroup is compressed into column segments and the column segments are stored in the columnstore.</span></span>

 <span data-ttu-id="14a72-133">Per ogni indice columnstore cluster possono essere presenti più deltastore.</span><span class="sxs-lookup"><span data-stu-id="14a72-133">For each clustered columnstore index there can be multiple deltastores.</span></span>

-   <span data-ttu-id="14a72-134">Se un deltastore è bloccato in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , si tenterà di ottenere un blocco su un deltastore diverso.</span><span class="sxs-lookup"><span data-stu-id="14a72-134">If a deltastore is locked, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] will try to obtain a lock on a different deltastore.</span></span> <span data-ttu-id="14a72-135">Se non esistono deltastore disponibili in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , verrà creato un nuovo deltastore.</span><span class="sxs-lookup"><span data-stu-id="14a72-135">If there are no deltastores available, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] will create a new deltastore.</span></span>

-   <span data-ttu-id="14a72-136">Per una tabella partizionata, possono essere presenti uno o più deltastore per ogni partizione.</span><span class="sxs-lookup"><span data-stu-id="14a72-136">For a partitioned table, there can be one or more deltastores for each partition.</span></span>

 <span data-ttu-id="14a72-137">Solo per gli indici columnstore cluster, gli scenari seguenti indicano quando le righe caricate vengono direttamente indirizzate al columnstore o passano per il deltastore.</span><span class="sxs-lookup"><span data-stu-id="14a72-137">For clustered columnstore indexes only, the following scenarios describe when loaded rows go directly to the columnstore or when they go to the deltastore.</span></span>

 <span data-ttu-id="14a72-138">Nell'esempio, ogni rowgroup può avere 102.400-1.048.576 righe per rowgroup.</span><span class="sxs-lookup"><span data-stu-id="14a72-138">In the example, each rowgroup can have 102,400-1,048,576 rows per rowgroup.</span></span>

|<span data-ttu-id="14a72-139">Righe per il caricamento bulk</span><span class="sxs-lookup"><span data-stu-id="14a72-139">Rows to Bulk Load</span></span>|<span data-ttu-id="14a72-140">Righe aggiunte al columnstore</span><span class="sxs-lookup"><span data-stu-id="14a72-140">Rows Added to the Columnstore</span></span>|<span data-ttu-id="14a72-141">Righe aggiunte al deltastore</span><span class="sxs-lookup"><span data-stu-id="14a72-141">Rows Added to the Deltastore</span></span>|
|-----------------------|-----------------------------------|----------------------------------|
|<span data-ttu-id="14a72-142">102.000</span><span class="sxs-lookup"><span data-stu-id="14a72-142">102,000</span></span>|<span data-ttu-id="14a72-143">0</span><span class="sxs-lookup"><span data-stu-id="14a72-143">0</span></span>|<span data-ttu-id="14a72-144">102.000</span><span class="sxs-lookup"><span data-stu-id="14a72-144">102,000</span></span>|
|<span data-ttu-id="14a72-145">145.000</span><span class="sxs-lookup"><span data-stu-id="14a72-145">145,000</span></span>|<span data-ttu-id="14a72-146">145.000</span><span class="sxs-lookup"><span data-stu-id="14a72-146">145,000</span></span><br /><br /> <span data-ttu-id="14a72-147">Dimensioni rowgroup: 145.000</span><span class="sxs-lookup"><span data-stu-id="14a72-147">Rowgroup size: 145,000</span></span>|<span data-ttu-id="14a72-148">0</span><span class="sxs-lookup"><span data-stu-id="14a72-148">0</span></span>|
|<span data-ttu-id="14a72-149">1\.048.577</span><span class="sxs-lookup"><span data-stu-id="14a72-149">1,048,577</span></span>|<span data-ttu-id="14a72-150">1,048,576</span><span class="sxs-lookup"><span data-stu-id="14a72-150">1,048,576</span></span><br /><br /> <span data-ttu-id="14a72-151">Dimensioni rowgroup: 1.048.576.</span><span class="sxs-lookup"><span data-stu-id="14a72-151">Rowgroup size: 1,048,576.</span></span>|<span data-ttu-id="14a72-152">1</span><span class="sxs-lookup"><span data-stu-id="14a72-152">1</span></span>|
|<span data-ttu-id="14a72-153">2\.252.152</span><span class="sxs-lookup"><span data-stu-id="14a72-153">2,252,152</span></span>|<span data-ttu-id="14a72-154">2\.252.152</span><span class="sxs-lookup"><span data-stu-id="14a72-154">2,252,152</span></span><br /><br /> <span data-ttu-id="14a72-155">Dimensioni rowgroup: 1.048.576, 1.048.576, 155.000.</span><span class="sxs-lookup"><span data-stu-id="14a72-155">Rowgroup sizes: 1,048,576, 1,048,576, 155,000.</span></span>|<span data-ttu-id="14a72-156">0</span><span class="sxs-lookup"><span data-stu-id="14a72-156">0</span></span>|

 <span data-ttu-id="14a72-157">Nell'esempio seguente vengono illustrati i risultati del caricamento di 1.048.577 righe in una partizione.</span><span class="sxs-lookup"><span data-stu-id="14a72-157">The following example shows the results of loading 1,048,577 rows into a partition.</span></span> <span data-ttu-id="14a72-158">I risultati mostrano che esiste un rowgroup COMPRESSED nel columnstore (come segmenti di colonna compressi) e 1 riga nel deltastore.</span><span class="sxs-lookup"><span data-stu-id="14a72-158">The results show that one COMPRESSED rowgroup in the columnstore (as compressed column segments), and 1 row in the deltastore.</span></span>

```sql
SELECT * FROM sys.column_store_row_groups;
```

 <span data-ttu-id="14a72-159">![Rowgroup e deltastore per un carico batch](../../2014/database-engine/media/sql-server-pdw-columnstore-batchload.gif "Rowgroup e deltastore per un carico batch")</span><span class="sxs-lookup"><span data-stu-id="14a72-159">![Rowgroup and deltastore for a batch load](../../2014/database-engine/media/sql-server-pdw-columnstore-batchload.gif "Rowgroup and deltastore for a batch load")</span></span>



##  <a name="change-data-in-a-clustered-columnstore-index"></a><a name="change"></a><span data-ttu-id="14a72-160">Modificare i dati in un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-160">Change Data in a Clustered Columnstore Index</span></span>
 <span data-ttu-id="14a72-161">Gli indici columnstore cluster supportano le operazione DML di inserimento, aggiornamento ed eliminazione.</span><span class="sxs-lookup"><span data-stu-id="14a72-161">Clustered columnstore indexes support insert, update, and delete DML operations.</span></span>

 <span data-ttu-id="14a72-162">Per inserire una riga, utilizzare [insert &#40;&#41;Transact-SQL](/sql/t-sql/statements/insert-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="14a72-162">Use [INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/insert-transact-sql) to insert a row.</span></span> <span data-ttu-id="14a72-163">La riga viene aggiunta al deltastore.</span><span class="sxs-lookup"><span data-stu-id="14a72-163">The row will be added to the deltastore.</span></span>

 <span data-ttu-id="14a72-164">Usare [DELETE &#40;Transact-SQL&#41;](/sql/t-sql/statements/delete-transact-sql) per eliminare una riga.</span><span class="sxs-lookup"><span data-stu-id="14a72-164">Use [DELETE &#40;Transact-SQL&#41;](/sql/t-sql/statements/delete-transact-sql) to delete a row.</span></span>

-   <span data-ttu-id="14a72-165">Se la riga è nel columnstore, viene contrassegnata in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] come eliminata logicamente, ma non viene reclamata l'archiviazione fisica della riga fino alla successiva ricompilazione dell'indice.</span><span class="sxs-lookup"><span data-stu-id="14a72-165">If the row is in the columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the row as logically deleted but does not reclaim the physical storage for the row until the index is rebuilt.</span></span>

-   <span data-ttu-id="14a72-166">Se la riga è nel deltastore, viene logicamente e fisicamente eliminata in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="14a72-166">If the row is in the deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] logically and physically deletes the row.</span></span>

 <span data-ttu-id="14a72-167">Usare [UPDATE &#40;Transact-SQL&#41;](/sql/t-sql/queries/update-transact-sql) per aggiornare una ruga.</span><span class="sxs-lookup"><span data-stu-id="14a72-167">Use [UPDATE &#40;Transact-SQL&#41;](/sql/t-sql/queries/update-transact-sql) to update a row.</span></span>

-   <span data-ttu-id="14a72-168">Se la riga è nel columnstore, viene contrassegnata in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] come eliminata logicamente e la riga aggiornata viene inserita nel deltastore.</span><span class="sxs-lookup"><span data-stu-id="14a72-168">If the row is in the columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the row as logically deleted, and then inserts the updated row into the deltastore.</span></span>

-   <span data-ttu-id="14a72-169">Se la riga è nel deltastore, viene aggiornata nel deltastore in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="14a72-169">If the row is in the deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] updates the row in the deltastore.</span></span>

##  <a name="rebuild-a-clustered-columnstore-index"></a><a name="rebuild"></a><span data-ttu-id="14a72-170">Ricompilare un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-170">Rebuild a Clustered Columnstore Index</span></span>
 <span data-ttu-id="14a72-171">Usare [Create Clustered columnstore index &#40;Transact-sql&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) o [alter index &#40;transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) per eseguire una ricompilazione completa di un indice columnstore cluster esistente.</span><span class="sxs-lookup"><span data-stu-id="14a72-171">Use [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) or [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) to perform a full rebuild of an existing clustered columnstore index.</span></span> <span data-ttu-id="14a72-172">Inoltre, è possibile utilizzare ALTER INDEX... RICOMPILA per ricompilare una partizione specifica.</span><span class="sxs-lookup"><span data-stu-id="14a72-172">Additionally, you can use ALTER INDEX ... REBUILD to rebuild a specific partition.</span></span>

### <a name="rebuild-process"></a><span data-ttu-id="14a72-173">Processo di ricompilazione</span><span class="sxs-lookup"><span data-stu-id="14a72-173">Rebuild Process</span></span>
 <span data-ttu-id="14a72-174">Per ricompilare un indice columnstore cluster, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="14a72-174">To rebuild a clustered columnstore index, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>

-   <span data-ttu-id="14a72-175">Acquisisce un blocco esclusivo sulla tabella o partizione durante la ricompilazione.</span><span class="sxs-lookup"><span data-stu-id="14a72-175">Acquires an exclusive lock on the table or partition while the rebuild occurs.</span></span>  <span data-ttu-id="14a72-176">I dati sono "offline" e non disponibili durante la ricompilazione.</span><span class="sxs-lookup"><span data-stu-id="14a72-176">The data is "offline" and unavailable during the rebuild.</span></span>

-   <span data-ttu-id="14a72-177">Deframmenta il columnstore eliminando fisicamente le righe eliminate in modo logico dalla tabella; i byte eliminati vengono recuperati sui supporti fisici.</span><span class="sxs-lookup"><span data-stu-id="14a72-177">Defragments the columnstore by physically deleting rows that have been logically deleted from the table; the deleted bytes are reclaimed on the physical media.</span></span>

-   <span data-ttu-id="14a72-178">Esegue l'unione dei dati del rowstore nel deltastore con i dati del columnstore prima che venga ricompilato l'indice.</span><span class="sxs-lookup"><span data-stu-id="14a72-178">Merges the rowstore data in the deltastore with the data in the columnstore before it rebuilds the index.</span></span> <span data-ttu-id="14a72-179">Al termine della ricompilazione, tutti i dati vengono archiviati nel formato columnstore e il deltastore è vuoto.</span><span class="sxs-lookup"><span data-stu-id="14a72-179">When the rebuild is finished, all data is stored in columnstore format, and the deltastore is empty.</span></span>

-   <span data-ttu-id="14a72-180">Ricomprime tutti i dati nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-180">Re-compresses all data into the columnstore.</span></span> <span data-ttu-id="14a72-181">Durante la ricompilazione esistono due copie dell'indice columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-181">Two copies of the columnstore index exist while the rebuild is taking place.</span></span> <span data-ttu-id="14a72-182">Al termine della ricompilazione, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] elimina l'indice columnstore originale.</span><span class="sxs-lookup"><span data-stu-id="14a72-182">When the rebuild is finished, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] deletes the original columnstore index.</span></span>

### <a name="recommendations-for-rebuilding-a-clustered-columnstore-index"></a><span data-ttu-id="14a72-183">Suggerimenti per la ricompilazione di un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-183">Recommendations for Rebuilding a Clustered Columnstore Index</span></span>
 <span data-ttu-id="14a72-184">La ricompilazione di un indice columnstore cluster è utile per rimuovere la frammentazione e spostare tutte le righe nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-184">Rebuilding a clustered columnstore index is useful for removing fragmentation, and for moving all rows into the columnstore.</span></span> <span data-ttu-id="14a72-185">Tenere presenti le seguenti indicazioni:</span><span class="sxs-lookup"><span data-stu-id="14a72-185">We have the following recommendations:</span></span>

-   <span data-ttu-id="14a72-186">Ricompilare una partizione anziché l'intera tabella.</span><span class="sxs-lookup"><span data-stu-id="14a72-186">Rebuild a partition instead of the entire table.</span></span>

    1.  <span data-ttu-id="14a72-187">La ricompilazione di un'intera tabella richiede molto tempo se l'indice è esteso ed è necessario sufficiente spazio su disco per archiviare una copia aggiuntiva dell'indice durante la ricompilazione.</span><span class="sxs-lookup"><span data-stu-id="14a72-187">Rebuilding the entire table takes a long time if the index is large, and it requires enough disk space to store an additional copy of the index during the rebuild.</span></span> <span data-ttu-id="14a72-188">In genere è necessario solo ricompilare la partizione utilizzata più di recente.</span><span class="sxs-lookup"><span data-stu-id="14a72-188">Usually it is only necessary to rebuild the most recently used partition.</span></span>

    2.  <span data-ttu-id="14a72-189">Per le tabelle partizionate, non è necessario ricompilare l'intero indice columnstore perché la frammentazione probabilmente avviene solo nelle partizioni modificate di recente.</span><span class="sxs-lookup"><span data-stu-id="14a72-189">For partitioned tables, you do not need to rebuild the entire columnstore index because fragmentation is likely to occur in only the partitions that have been modified recently.</span></span> <span data-ttu-id="14a72-190">Le tabelle dei fatti e le tabelle delle dimensioni grandi vengono in genere partizionate per eseguire operazioni di backup e di gestione dei blocchi della tabella.</span><span class="sxs-lookup"><span data-stu-id="14a72-190">Fact tables and large dimension tables are usually partitioned in order to perform backup and management operations on chunks of the table.</span></span>

-   <span data-ttu-id="14a72-191">Ricompilare una partizione dopo onerose operazioni DML</span><span class="sxs-lookup"><span data-stu-id="14a72-191">Rebuild a partition after heavy DML operations.</span></span>

     <span data-ttu-id="14a72-192">La ricompilazione di una partizione deframmenta la partizione e riduce lo spazio su disco.</span><span class="sxs-lookup"><span data-stu-id="14a72-192">Rebuilding a partition will defragment the partition and reduce disk storage.</span></span> <span data-ttu-id="14a72-193">La ricompilazione elimina dal columnstore tutte le righe contrassegnate per l'eliminazione e sposta tutte le righe dal deltastore nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-193">Rebuilding will delete all rows from the columnstore that are marked for deletion, and it will move all rows from the deltastore into the columnstore.</span></span>

-   <span data-ttu-id="14a72-194">Ricompilare una partizione dopo il caricamento dei dati.</span><span class="sxs-lookup"><span data-stu-id="14a72-194">Rebuild a partition after loading data.</span></span>

     <span data-ttu-id="14a72-195">In questo modo viene garantita l'archiviazione di tutti i dati nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-195">This ensures all data is stored in the columnstore.</span></span> <span data-ttu-id="14a72-196">Se si verificano più caricamenti contemporaneamente, ogni partizione potrebbe avere più deltastore.</span><span class="sxs-lookup"><span data-stu-id="14a72-196">If multiple loads occur at the same time, each partition could end up having multiple deltastores.</span></span> <span data-ttu-id="14a72-197">La ricompilazione sposterà tutte le righe del deltastore nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-197">Rebuilding will move all deltastore rows into the columnstore.</span></span>

##  <a name="reorganize-a-clustered-columnstore-index"></a><a name="reorganize"></a><span data-ttu-id="14a72-198">Riorganizzare un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="14a72-198">Reorganize a Clustered Columnstore Index</span></span>
 <span data-ttu-id="14a72-199">La riorganizzazione di un indice columnstore cluster sposta tutti i rowgroup CLOSED nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-199">Reorganizing a clustered columnstore index moves all CLOSED rowgroups into the columnstore.</span></span> <span data-ttu-id="14a72-200">Per eseguire un'operazione REORGANIZE, usare [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)con l'opzione REORGANIZE.</span><span class="sxs-lookup"><span data-stu-id="14a72-200">To perform a reorganize, use [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)with the REORGANIZE option.</span></span>

 <span data-ttu-id="14a72-201">La riorganizzazione non è necessaria per spostare i rowgroup CLOSED nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="14a72-201">Reorganizing is not required in order to move CLOSED rowgroups into the columnstore.</span></span> <span data-ttu-id="14a72-202">Tramite il processo tuple-mover verranno infine trovati e spostati tutti i rowgroup CLOSED.</span><span class="sxs-lookup"><span data-stu-id="14a72-202">The tuple-mover process will eventually find all CLOSED rowgroups and move them.</span></span> <span data-ttu-id="14a72-203">Tuple-mover è un processo a thread singolo e potrebbe non consentire uno spostamento sufficientemente rapido dei rowgroup per il carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="14a72-203">However, the tuple-mover is single-threaded and might not move rowgroups fast enough for your workload.</span></span>

### <a name="recommendations-for-reorganizing"></a><span data-ttu-id="14a72-204">Suggerimenti per la riorganizzazione</span><span class="sxs-lookup"><span data-stu-id="14a72-204">Recommendations for Reorganizing</span></span>
 <span data-ttu-id="14a72-205">Quando riorganizzare un indice columnstore cluster:</span><span class="sxs-lookup"><span data-stu-id="14a72-205">When to reorganize a clustered columnstore index:</span></span>

-   <span data-ttu-id="14a72-206">Riorganizzare un indice columnstore cluster dopo uno o più caricamenti di dati per migliorare rapidamente le prestazioni delle query.</span><span class="sxs-lookup"><span data-stu-id="14a72-206">Reorganize a clustered columnstore index after one or more data loads to achieve query performance benefits as quickly as possible.</span></span> <span data-ttu-id="14a72-207">La riorganizzazione inizialmente richiede risorse di CPU aggiuntive per comprimere i dati, il che potrebbe globalmente ridurre le prestazioni del sistema.</span><span class="sxs-lookup"><span data-stu-id="14a72-207">Reorganizing will initially require additional CPU resources to compress the data, which could slow overall system performance.</span></span> <span data-ttu-id="14a72-208">Tuttavia, non appena i dati sono compressi, le prestazioni delle query possono migliorare.</span><span class="sxs-lookup"><span data-stu-id="14a72-208">However, as soon as the data is compressed, query performance can improve.</span></span>


