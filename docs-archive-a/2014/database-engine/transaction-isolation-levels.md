---
title: Livelli di isolamento delle transazioni per le tabelle ottimizzate per la memoria | Microsoft Docs
ms.custom: seo-dt-2019
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 8a6a82bf-273c-40ab-a101-46bd3615db8a
author: stevestein
ms.author: sstein
ms.openlocfilehash: 5ee0ba17dc999c9076ca4622d47db28b8200b851
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87714536"
---
# <a name="transaction-isolation-levels-in-memory-optimized-tables"></a><span data-ttu-id="aa43f-102">Livelli di isolamento delle transazioni nelle tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="aa43f-102">Transaction Isolation Levels in memory-optimized tables</span></span>

  <span data-ttu-id="aa43f-103">Di seguito sono indicati i livelli di isolamento supportati per le transazioni che accedono a tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="aa43f-103">The following isolation levels are supported for transactions that access memory-optimized tables.</span></span>  
  
-   <span data-ttu-id="aa43f-104">SNAPSHOT</span><span class="sxs-lookup"><span data-stu-id="aa43f-104">SNAPSHOT</span></span>  
  
-   <span data-ttu-id="aa43f-105">REPEATABLE READ</span><span class="sxs-lookup"><span data-stu-id="aa43f-105">REPEATABLE READ</span></span>  
  
-   <span data-ttu-id="aa43f-106">SERIALIZABLE</span><span class="sxs-lookup"><span data-stu-id="aa43f-106">SERIALIZABLE</span></span>  
  
-   <span data-ttu-id="aa43f-107">READ COMMITTED</span><span class="sxs-lookup"><span data-stu-id="aa43f-107">READ COMMITTED</span></span>  
  
 <span data-ttu-id="aa43f-108">Il livello di isolamento della transazione può essere specificato come parte del blocco atomico di una stored procedure compilata in modo nativo.</span><span class="sxs-lookup"><span data-stu-id="aa43f-108">The transaction isolation level can be specified as part of the atomic block of a natively compiled stored procedure.</span></span> <span data-ttu-id="aa43f-109">Per altre informazioni, vedere [CREATE PROCEDURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-procedure-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="aa43f-109">For more information, see [CREATE PROCEDURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-procedure-transact-sql).</span></span> <span data-ttu-id="aa43f-110">Quando si accede a tabelle ottimizzate per la memoria da codice [!INCLUDE[tsql](../includes/tsql-md.md)] interpretato, è possibile specificare il livello di isolamento tramite hint a livello di tabella.</span><span class="sxs-lookup"><span data-stu-id="aa43f-110">When accessing memory-optimized tables from interpreted [!INCLUDE[tsql](../includes/tsql-md.md)], the isolation level can be specified using table-level hints.</span></span>  
  
 <span data-ttu-id="aa43f-111">È necessario specificare il livello di isolamento delle transazioni quando si definisce una stored procedure compilata in modo nativo.</span><span class="sxs-lookup"><span data-stu-id="aa43f-111">You must specify the transaction isolation level when you define a natively compiled stored procedure.</span></span> <span data-ttu-id="aa43f-112">È necessario specificare il livello di isolamento in hint di tabella quando si accede alle tabelle ottimizzate per la memoria da transazioni utente in codice [!INCLUDE[tsql](../includes/tsql-md.md)] interpretato.</span><span class="sxs-lookup"><span data-stu-id="aa43f-112">You must specify the isolation level in table hints when accessing memory-optimized tables from user transactions in interpreted [!INCLUDE[tsql](../includes/tsql-md.md)].</span></span> <span data-ttu-id="aa43f-113">Per ulteriori informazioni, vedere [linee guida per i livelli di isolamento delle transazioni con tabelle ottimizzate per la memoria](../relational-databases/in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="aa43f-113">For more information, see [Guidelines for Transaction Isolation Levels with Memory-Optimized Tables](../relational-databases/in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
 <span data-ttu-id="aa43f-114">Il livello di isolamento READ COMMITTED è supportato per le tabelle ottimizzate per la memoria con transazioni in modalità autocommit.</span><span class="sxs-lookup"><span data-stu-id="aa43f-114">The isolation level READ COMMITTED is supported for memory-optimized tables with autocommit transactions.</span></span> <span data-ttu-id="aa43f-115">READ COMMITTED non è valido nelle transazioni utente o in un blocco atomico.</span><span class="sxs-lookup"><span data-stu-id="aa43f-115">READ COMMITTED is not valid in user transactions or in an atomic block.</span></span> <span data-ttu-id="aa43f-116">READ COMMITTED non è invece supportato con le transazioni utente implicite o esplicite.</span><span class="sxs-lookup"><span data-stu-id="aa43f-116">READ COMMITTED is not supported with explicit or implicit user transactions.</span></span> <span data-ttu-id="aa43f-117">Il livello di isolamento READ_COMMITTED_SNAPSHOT è supportato per le tabelle ottimizzate per la memoria con transazioni in modalità autocommit e solo se la query non accede alle tabelle basate su disco.</span><span class="sxs-lookup"><span data-stu-id="aa43f-117">Isolation level READ_COMMITTED_SNAPSHOT is supported for memory-optimized tables with autocommit transactions and only if the query does not access any disk-based tables.</span></span> <span data-ttu-id="aa43f-118">Alle transazioni avviate tramite codice [!INCLUDE[tsql](../includes/tsql-md.md)] interpretato con isolamento SNAPSHOT non è inoltre consentito accedere alle tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="aa43f-118">In addition, transactions that are started using interpreted [!INCLUDE[tsql](../includes/tsql-md.md)] with SNAPSHOT isolation cannot access memory-optimized tables.</span></span> <span data-ttu-id="aa43f-119">Le transazioni che utilizzano codice [!INCLUDE[tsql](../includes/tsql-md.md)] interpretato con isolamento REPEATABLE READ o SERIALIZABLE devono accedere alle tabelle ottimizzate per la memoria utilizzando il livello di isolamento SNAPSHOT.</span><span class="sxs-lookup"><span data-stu-id="aa43f-119">Transactions that are use interpreted [!INCLUDE[tsql](../includes/tsql-md.md)] with either REPEATABLE READ or SERIALIZABLE isolation must access memory-optimized tables using SNAPSHOT isolation.</span></span> <span data-ttu-id="aa43f-120">Per altre informazioni su questo scenario, vedere [transazioni tra contenitori](cross-container-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="aa43f-120">For more information about this scenario, see [Cross-Container Transactions](cross-container-transactions.md).</span></span>  
  
 <span data-ttu-id="aa43f-121">READ COMMITTED è il livello di isolamento predefinito in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="aa43f-121">READ COMMITTED is the default isolation level in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="aa43f-122">Quando il livello di isolamento della sessione è READ COMMITTED o inferiore, è possibile effettuare una delle operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="aa43f-122">When the isolation level of the session is READ COMMITED (or lower), you can do one of the following:</span></span>  
  
-   <span data-ttu-id="aa43f-123">Utilizzare in modo esplicito un hint superiore del livello di isolamento per accedere alla tabella ottimizzata per la memoria, ad esempio WITH (SNAPSHOT).</span><span class="sxs-lookup"><span data-stu-id="aa43f-123">Explicitly use a higher isolation level hint for accessing the memory-optimized table (for example, WITH (SNAPSHOT)).</span></span>  
  
-   <span data-ttu-id="aa43f-124">Specificare l'opzione del set `MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT`, tramite cui verrà impostato il livello di isolamento per le tabelle ottimizzate per la memoria su SNAPSHOT (come se si includessero hint WITH(SNAPSHOT) in ogni tabella ottimizzata per la memoria).</span><span class="sxs-lookup"><span data-stu-id="aa43f-124">Specify the `MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT` set option, which will set the isolation level for memory-optimized tables to SNAPSHOT (as if you included WITH(SNAPSHOT) hints to every memory-optimized table).</span></span> <span data-ttu-id="aa43f-125">Per ulteriori informazioni su `MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT` , vedere [Opzioni ALTER DATABASE SET &#40;&#41;Transact-SQL ](/sql/t-sql/statements/alter-database-transact-sql-set-options).</span><span class="sxs-lookup"><span data-stu-id="aa43f-125">For more information about `MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT`, see [ALTER DATABASE SET Options &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options).</span></span>  
  
 <span data-ttu-id="aa43f-126">In alternativa, se il livello di isolamento della sessione è READ COMMITTED, è possibile utilizzare le transazioni in modalità autocommit.</span><span class="sxs-lookup"><span data-stu-id="aa43f-126">Alternatively, if the isolation level of the session is READ COMMITTED, you can use autocommit transactions.</span></span>  
  
 <span data-ttu-id="aa43f-127">Le transazioni SNAPSHOT avviate tramite codice [!INCLUDE[tsql](../includes/tsql-md.md)] interpretato non possono accedere alle tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="aa43f-127">SNAPSHOT transactions started in interpreted [!INCLUDE[tsql](../includes/tsql-md.md)] cannot access memory-optimized tables.</span></span>  
  
 <span data-ttu-id="aa43f-128">I livelli di isolamento delle transazioni supportati per le tabelle ottimizzate per la memoria forniscono le stesse garanzie logiche delle tabelle basate su disco.</span><span class="sxs-lookup"><span data-stu-id="aa43f-128">The transaction isolation levels supported for memory-optimized tables provide the same logical guarantees as disk-based tables.</span></span> <span data-ttu-id="aa43f-129">Il meccanismo utilizzato per fornire le garanzie del livello di isolamento è diverso.</span><span class="sxs-lookup"><span data-stu-id="aa43f-129">The mechanism used for providing isolation level guarantees is different.</span></span>  
  
 <span data-ttu-id="aa43f-130">Per le tabelle basate su disco la maggior parte delle garanzie del livello di isolamento vengono implementate mediante l'utilizzo dei blocchi, che impediscono l'insorgere di conflitti.</span><span class="sxs-lookup"><span data-stu-id="aa43f-130">For disk-based tables, most isolation level guarantees are implemented using locking, which prevent conflicts through blocking.</span></span> <span data-ttu-id="aa43f-131">Per le tabelle ottimizzate per la memoria le garanzie vengono applicate utilizzando un meccanismo di rilevamento dei conflitti, che consente di evitare l'utilizzo di blocchi.</span><span class="sxs-lookup"><span data-stu-id="aa43f-131">For memory-optimized tables, the guarantees are enforced using a conflict detection mechanism, which avoids the need to take locks.</span></span> <span data-ttu-id="aa43f-132">Fa eccezione l'isolamento SNAPSHOT per le tabelle basate su disco,</span><span class="sxs-lookup"><span data-stu-id="aa43f-132">The exception is SNAPSHOT isolation on disk-based tables.</span></span> <span data-ttu-id="aa43f-133">che viene implementato in modo analogo all'isolamento SNAPSHOT per le tabelle ottimizzate per la memoria tramite un meccanismo di rilevamento dei conflitti.</span><span class="sxs-lookup"><span data-stu-id="aa43f-133">This is implemented similarly to SNAPSHOT isolation on memory-optimized tables using a conflict detection mechanism.</span></span>  
  
 <span data-ttu-id="aa43f-134">SNAPSHOT</span><span class="sxs-lookup"><span data-stu-id="aa43f-134">SNAPSHOT</span></span>  
 <span data-ttu-id="aa43f-135">Questo livello di isolamento specifica che i dati letti da qualsiasi istruzione in una transazione rappresenteranno la versione coerente a livello di transazione dei dati presenti all'avvio della transazione stessa.</span><span class="sxs-lookup"><span data-stu-id="aa43f-135">This isolation level specifies that data read by any statement in a transaction will be the transactionally consistent version of the data that existed at the start of the transaction.</span></span> <span data-ttu-id="aa43f-136">La transazione può quindi accedere solo alle modifiche dei dati di cui è stato eseguito il commit prima dell'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="aa43f-136">The transaction can only recognize data modifications that were committed before the start of the transaction.</span></span> <span data-ttu-id="aa43f-137">Le modifiche ai dati apportate da altre transazioni dopo l'avvio della transazione corrente non sono visibili per le istruzioni eseguite nella transazione corrente.</span><span class="sxs-lookup"><span data-stu-id="aa43f-137">Data modifications made by other transactions after the start of the current transaction are not visible to statements executing in the current transaction.</span></span> <span data-ttu-id="aa43f-138">Le istruzioni di una transazione ottengono uno snapshot dei dati di cui è stato eseguito il commit corrispondente a quelli presenti all'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="aa43f-138">The statements in a transaction get a snapshot of the committed data as it existed at the start of the transaction.</span></span>  
  
 <span data-ttu-id="aa43f-139">Le operazioni di scrittura (aggiornamenti, inserimenti ed eliminazioni) vengono sempre isolate completamente da altre transazioni.</span><span class="sxs-lookup"><span data-stu-id="aa43f-139">Write operations (updates, inserts and deletes) are always fully isolated from other transactions.</span></span> <span data-ttu-id="aa43f-140">Le operazioni di scrittura in una transazione SNAPSHOT possono pertanto entrare in conflitto con quelle eseguite da altre transazioni.</span><span class="sxs-lookup"><span data-stu-id="aa43f-140">Therefore, the write operations in a SNAPSHOT transaction can conflict with write operations by other transactions.</span></span> <span data-ttu-id="aa43f-141">Quando la transazione corrente tenta di aggiornare o eliminare una riga aggiornata o eliminata da un'altra transazione che ha eseguito il commit dopo l'avvio della transazione corrente, quest'ultima viene terminata con un messaggio di errore analogo al seguente.</span><span class="sxs-lookup"><span data-stu-id="aa43f-141">When the current transaction attempts to update or delete a row that has been updated or deleted by another transaction that committed after the current transaction started, the transaction terminates with the following error message.</span></span>  
  
 <span data-ttu-id="aa43f-142">Errore 41302.</span><span class="sxs-lookup"><span data-stu-id="aa43f-142">Error 41302.</span></span> <span data-ttu-id="aa43f-143">Tentativo da parte della transazione corrente di aggiornare un record nella tabella X che è già stato aggiornato dopo l'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="aa43f-143">The current transaction attempted to update a record in table X that has been updated since this transaction started.</span></span> <span data-ttu-id="aa43f-144">La transazione è stata interrotta.</span><span class="sxs-lookup"><span data-stu-id="aa43f-144">The transaction was aborted.</span></span>  
  
 <span data-ttu-id="aa43f-145">Quando la transazione corrente tenta di inserire una riga con lo stesso valore di chiave primaria di una riga inserita da un'altra transazione che ha eseguito il commit prima della transazione corrente, si verificherà un errore di commit con un messaggio di errore analogo al seguente.</span><span class="sxs-lookup"><span data-stu-id="aa43f-145">When the current transaction attempts to insert a row with the same primary key value as a row that was inserted by another transaction that committed before the current transaction, there will be a failure to commit with the following error message.</span></span>  
  
 <span data-ttu-id="aa43f-146">Errore 41325.</span><span class="sxs-lookup"><span data-stu-id="aa43f-146">Error 41325.</span></span> <span data-ttu-id="aa43f-147">Impossibile eseguire il commit della transazione corrente a causa di un errore di convalida serializzabile.</span><span class="sxs-lookup"><span data-stu-id="aa43f-147">The current transaction failed to commit due to a serializable validation failure.</span></span>  
  
 <span data-ttu-id="aa43f-148">Se una transazione effettua la scrittura in una tabella eliminata prima del commit della transazione, la transazione viene terminata con un messaggio di errore analogo al seguente:</span><span class="sxs-lookup"><span data-stu-id="aa43f-148">If a transaction writes to a table that is dropped before the transaction commits, the transaction terminates with the following error message:</span></span>  
  
 <span data-ttu-id="aa43f-149">Errore 41305.</span><span class="sxs-lookup"><span data-stu-id="aa43f-149">Error 41305.</span></span> <span data-ttu-id="aa43f-150">Impossibile eseguire il commit della transazione corrente a causa di un errore di convalida di lettura ripetibile.</span><span class="sxs-lookup"><span data-stu-id="aa43f-150">The current transaction failed to commit due to a repeatable read validation failure.</span></span>  
  
 <span data-ttu-id="aa43f-151">REPEATABLE READ</span><span class="sxs-lookup"><span data-stu-id="aa43f-151">REPEATABLE READ</span></span>  
 <span data-ttu-id="aa43f-152">In questo livello di isolamento sono incluse le garanzie fornite dal livello di isolamento SNAPSHOT.</span><span class="sxs-lookup"><span data-stu-id="aa43f-152">This isolation level includes the guarantees given by SNAPSHOT isolation level.</span></span> <span data-ttu-id="aa43f-153">REPEATABLE READ garantisce inoltre che, per ogni riga letta dalla transazione, al momento dell'esecuzione del commit da parte della transazione la riga non sia stata modificata da un'altra transazione.</span><span class="sxs-lookup"><span data-stu-id="aa43f-153">In addition, REPEATABLE READ guarantees that for any row that is read by the transaction, at the time the transaction commits the row has not been changed by any other transaction.</span></span> <span data-ttu-id="aa43f-154">Ogni operazione di lettura nella transazione è ripetibile fino alla fine della transazione.</span><span class="sxs-lookup"><span data-stu-id="aa43f-154">Every read operation in the transaction is repeatable up to the end of the transaction.</span></span>  
  
 <span data-ttu-id="aa43f-155">Se nella transazione corrente viene letta una qualsiasi riga aggiornata da un'altra transazione che ha eseguito il commit prima della transazione corrente, il commit ha esito negativo con un messaggio di errore analogo al seguente.</span><span class="sxs-lookup"><span data-stu-id="aa43f-155">If the current transaction has read any row that has then been updated by another transaction that has committed before the current transaction, the commit fails with the following error message.</span></span>  
  
 <span data-ttu-id="aa43f-156">Errore 41305.</span><span class="sxs-lookup"><span data-stu-id="aa43f-156">Error 41305.</span></span> <span data-ttu-id="aa43f-157">Impossibile eseguire il commit della transazione corrente a causa di un errore di convalida di lettura ripetibile.</span><span class="sxs-lookup"><span data-stu-id="aa43f-157">The current transaction failed to commit due to a repeatable read validation failure.</span></span>  
  
 <span data-ttu-id="aa43f-158">SERIALIZABLE</span><span class="sxs-lookup"><span data-stu-id="aa43f-158">SERIALIZABLE</span></span>  
 <span data-ttu-id="aa43f-159">In questo livello di isolamento sono incluse le garanzie fornite dal livello di isolamento REPEATABLE READ.</span><span class="sxs-lookup"><span data-stu-id="aa43f-159">This isolation level includes the guarantees given by REPEATABLE READ.</span></span> <span data-ttu-id="aa43f-160">Nessuna riga fantasma è stata rilevata tra il momento dello snapshot e la fine della transazione.</span><span class="sxs-lookup"><span data-stu-id="aa43f-160">No phantom rows have appeared between the snapshot and the end of the transaction.</span></span> <span data-ttu-id="aa43f-161">Le righe fantasma corrispondono alla condizione di filtro di una selezione, un aggiornamento o un'eliminazione.</span><span class="sxs-lookup"><span data-stu-id="aa43f-161">Phantom rows match the filter condition of a select, update, or delete.</span></span>  
  
 <span data-ttu-id="aa43f-162">La transazione viene eseguita come se non fossero presenti transazioni simultanee.</span><span class="sxs-lookup"><span data-stu-id="aa43f-162">The transaction is executed as if there are no concurrent transactions.</span></span> <span data-ttu-id="aa43f-163">Tutte le azioni si verificano virtualmente in un singolo punto di serializzazione (ora di commit).</span><span class="sxs-lookup"><span data-stu-id="aa43f-163">All actions virtually occur at a single serialization point (commit time).</span></span>  
  
 <span data-ttu-id="aa43f-164">Se una di queste garanzie viene violata, il commit della transazione non viene eseguito con un messaggio di errore analogo al seguente:</span><span class="sxs-lookup"><span data-stu-id="aa43f-164">If any of these guarantees is violated, the transaction fails to commit with the following error message:</span></span>  
  
 <span data-ttu-id="aa43f-165">Errore 41325.</span><span class="sxs-lookup"><span data-stu-id="aa43f-165">Error 41325.</span></span> <span data-ttu-id="aa43f-166">Impossibile eseguire il commit della transazione corrente a causa di un errore di convalida serializzabile.</span><span class="sxs-lookup"><span data-stu-id="aa43f-166">The current transaction failed to commit due to a serializable validation failure.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="aa43f-167">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="aa43f-167">See Also</span></span>  
 <span data-ttu-id="aa43f-168">[Informazioni sulle transazioni nelle tabelle ottimizzate per la memoria](../../2014/database-engine/understanding-transactions-on-memory-optimized-tables.md) </span><span class="sxs-lookup"><span data-stu-id="aa43f-168">[Understanding Transactions on Memory-Optimized Tables](../../2014/database-engine/understanding-transactions-on-memory-optimized-tables.md) </span></span>  
 <span data-ttu-id="aa43f-169">[Linee guida per i livelli di isolamento delle transazioni con tabelle con ottimizzazione per la memoria](../relational-databases/in-memory-oltp/memory-optimized-tables.md) </span><span class="sxs-lookup"><span data-stu-id="aa43f-169">[Guidelines for Transaction Isolation Levels with Memory-Optimized Tables](../relational-databases/in-memory-oltp/memory-optimized-tables.md) </span></span>  
 [<span data-ttu-id="aa43f-170">Linee guida per la logica di riesecuzione per le transazioni in tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="aa43f-170">Guidelines for Retry Logic for Transactions on Memory-Optimized Tables</span></span>](../../2014/database-engine/guidelines-for-retry-logic-for-transactions-on-memory-optimized-tables.md)  
  
  
