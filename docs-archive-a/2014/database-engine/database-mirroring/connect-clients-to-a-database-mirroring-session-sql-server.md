---
title: Connessione di client a una sessione di mirroring del database (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- partners [SQL Server], connecting clients to
- database mirroring [SQL Server], connecting clients to
- client connections [SQL Server], database mirroring
- connections [SQL Server], database mirroring
ms.assetid: 0d5d2742-2614-43de-9ab9-864addb6299b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 16faa8d02a22fba3e4cfa4cbe0bd6558fc140fdd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87626282"
---
# <a name="connect-clients-to-a-database-mirroring-session-sql-server"></a><span data-ttu-id="9efc1-102">Connessione di client a una sessione di mirroring del database (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="9efc1-102">Connect Clients to a Database Mirroring Session (SQL Server)</span></span>
  <span data-ttu-id="9efc1-103">Per connettersi a una sessione di mirroring del database un client può utilizzare [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client o il provider di dati .NET Framework per [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9efc1-103">To connect to a database mirroring session, a client can use either [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client or .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="9efc1-104">Se configurati per un database [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] , questi provider di accesso ai dati supportano entrambi completamente il mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="9efc1-104">When configured for a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] database, these data access providers both fully support database mirroring.</span></span> <span data-ttu-id="9efc1-105">Per informazioni relative alle considerazioni di programmazione per l'utilizzo di un database con mirroring, vedere [Using Database Mirroring](../../relational-databases/native-client/features/using-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="9efc1-105">For information about programming considerations for using a mirrored database, see [Using Database Mirroring](../../relational-databases/native-client/features/using-database-mirroring.md).</span></span> <span data-ttu-id="9efc1-106">È inoltre necessario che l'istanza del server principale corrente sia disponibile e che l'account di accesso del client sia stato creato nell'istanza del server.</span><span class="sxs-lookup"><span data-stu-id="9efc1-106">In addition, the current principal server instance must be available and the login of the client must have been created on the server instance.</span></span> <span data-ttu-id="9efc1-107">Per altre informazioni, vedere [Risolvere i problemi relativi agli utenti isolati &#40;SQL Server&#41;](../../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="9efc1-107">For more information, see [Troubleshoot Orphaned Users &#40;SQL Server&#41;](../../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md).</span></span> <span data-ttu-id="9efc1-108">Le connessioni client a una sessione di mirroring del database non richiedono l'istanza del server di controllo del mirroring, se ne esiste una.</span><span class="sxs-lookup"><span data-stu-id="9efc1-108">Client connections to a database mirroring session do not involve the witness server instance, if one exists.</span></span>  
  
 ##  <a name="making-the-initial-connection-to-a-database-mirroring-session"></a><a name="InitialConnection"></a> <span data-ttu-id="9efc1-109">Creazione della connessione iniziale a una sessione di mirroring del database</span><span class="sxs-lookup"><span data-stu-id="9efc1-109">Making the Initial Connection to a Database Mirroring Session</span></span>  
 <span data-ttu-id="9efc1-110">Per la connessione iniziale a un database con mirroring, è necessario che un client renda disponibile una stringa di connessione che includa, come minimo, il nome di un'istanza del server.</span><span class="sxs-lookup"><span data-stu-id="9efc1-110">For the initial connection to a mirrored database, a client must supply a connection string that minimally supplies the name of a server instance.</span></span> <span data-ttu-id="9efc1-111">Tale nome del server obbligatorio identifica l'istanza del server principale corrente ed è noto come *nome partner iniziale*.</span><span class="sxs-lookup"><span data-stu-id="9efc1-111">This required server name should identify the current principal server instance and is known as the *initial partner name*.</span></span>  
  
 <span data-ttu-id="9efc1-112">Facoltativamente, la stringa di connessione può indicare inoltre il nome di un'altra istanza del server, che identifichi l'istanza del server mirror corrente, da utilizzare se il partner iniziale non sia disponibile durante il primo tentativo di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-112">Optionally, the connection string can also supply the name of another server instance, which should identify the current mirror server instance, for use if the initial partner is unavailable during the first connection attempt.</span></span> <span data-ttu-id="9efc1-113">Il secondo nome viene definito *nome partner di failover*.</span><span class="sxs-lookup"><span data-stu-id="9efc1-113">The second name is known as the *failover partner name*.</span></span>  
  
 <span data-ttu-id="9efc1-114">È inoltre necessario che la stringa di connessione includa un nome di database,</span><span class="sxs-lookup"><span data-stu-id="9efc1-114">The connection string must also supply a database name.</span></span> <span data-ttu-id="9efc1-115">al fine di consentire i tentativi di failover da parte del provider di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="9efc1-115">This is necessary to enable failover attempts by the data access provider.</span></span>  
  
 <span data-ttu-id="9efc1-116">Alla ricezione di una stringa di connessione, il provider di accesso ai dati archivia il nome partner iniziale e il nome partner di failover, se disponibile, in una cache nella memoria volatile del client (per il codice gestito, l'ambito della cache è il dominio applicazione).</span><span class="sxs-lookup"><span data-stu-id="9efc1-116">On receiving a connection string, the data access provider stores the initial partner name and the failover partner name, if supplied, in a cache in the client's volatile memory (for managed code, the cache is scoped to the application domain).</span></span> <span data-ttu-id="9efc1-117">Dopo essere stato memorizzato nella cache, il nome partner iniziale non viene mai aggiornato dal provider di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="9efc1-117">Once cached, the initial partner name is never updated by the data access provider.</span></span> <span data-ttu-id="9efc1-118">Quando il client rende disponibile il nome partner di failover, il provider di accesso ai dati memorizza inoltre il nome di questo partner di failover temporaneamente nel caso in cui il provider non possa connettersi utilizzando il nome partner iniziale.</span><span class="sxs-lookup"><span data-stu-id="9efc1-118">When the client supplies the failover partner name, the data access provider also stores this failover partner name temporarily in case the provider cannot connect using the initial partner name.</span></span>  
  
 <span data-ttu-id="9efc1-119">Una sessione di mirroring del database non costituisce protezione contro i problemi di accesso al server specifici dei client, ad esempio nel caso di problemi di comunicazione di un computer client con la rete.</span><span class="sxs-lookup"><span data-stu-id="9efc1-119">A database mirroring session does not protect against server-access problems that are specific to clients, such as when a client computer is having a problems communicating with the network.</span></span> <span data-ttu-id="9efc1-120">Un tentativo di connessione a un database con mirroring può non riuscire per varie ragioni, non correlate al provider di accesso ai dati, ad esempio un tentativo di connessione può non riuscire perché l'istanza del server principale è inattiva, perché si verifica durante il failover del database o a causa di un errore di rete.</span><span class="sxs-lookup"><span data-stu-id="9efc1-120">A connection attempt to a mirrored database can also fail for a variety of reasons that are unrelated to the data-access provider; for example, a connection attempt can fail because the principal server instance is inactive, as occurs when the database is failing over, or because of a network error.</span></span>  
  
 <span data-ttu-id="9efc1-121">Durante il tentativo di connessione, il provider di accesso ai dati inizia le operazioni utilizzando il proprio nome partner iniziale.</span><span class="sxs-lookup"><span data-stu-id="9efc1-121">When attempting to connect, the data access provider begins by using the initial partner name.</span></span> <span data-ttu-id="9efc1-122">Se l'istanza del server specificata è disponibile e corrisponde all'istanza del server principale corrente, il tentativo di connessione in genere riesce.</span><span class="sxs-lookup"><span data-stu-id="9efc1-122">If the specified server instance is available and is the current principal server instance, the connection attempt typically succeeds.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9efc1-123">Se la sessione di mirroring viene sospesa, il client in genere si connette al server principale e quindi scarica il nome partner.</span><span class="sxs-lookup"><span data-stu-id="9efc1-123">If the mirroring session is paused, the client typically connects to the principal server and the downloads the partner name.</span></span> <span data-ttu-id="9efc1-124">Il database non è tuttavia disponibile per il client fino alla ripresa del mirroring.</span><span class="sxs-lookup"><span data-stu-id="9efc1-124">However, the database is unavailable to the client until mirroring resumes.</span></span>  
  
 <span data-ttu-id="9efc1-125">Se il tentativo ha esito negativo, il provider di accesso ai dati tenta di stabilire la connessione utilizzando il nome partner di failover, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="9efc1-125">If that attempt does not work, the data access provider tries the failover partner name, if available.</span></span> <span data-ttu-id="9efc1-126">Se uno dei nomi partner disponibili consente di identificare correttamente il server principale corrente, il tentativo di stabilire la connessione iniziale da parte del provider di accesso ai dati in genere ha esito positivo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-126">If either partner name correctly identifies the current principal server, the data access provider normally succeeds in opening the initial connection.</span></span> <span data-ttu-id="9efc1-127">Al completamento della connessione, il provider di accesso ai dati scarica il nome dell'istanza del server mirror corrente.</span><span class="sxs-lookup"><span data-stu-id="9efc1-127">On completing this connection, the data access provider downloads the server instance name of the current mirror server.</span></span> <span data-ttu-id="9efc1-128">Questo nome viene memorizzato nella cache come nome partner di failover, sovrascrivendo l'eventuale nome partner di failover indicato dal client.</span><span class="sxs-lookup"><span data-stu-id="9efc1-128">This name is stored in the cache as the failover partner name, overwriting the client-supplied failover partner name, if any.</span></span> <span data-ttu-id="9efc1-129">Di conseguenza, il provider di dati .NET Framework per [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] non aggiorna il nome partner di failover.</span><span class="sxs-lookup"><span data-stu-id="9efc1-129">Thereafter, the .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] does not update the failover partner name.</span></span> <span data-ttu-id="9efc1-130">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client aggiorna invece la cache ogni volta che una connessione successiva o il ripristino di una connessione restituisce un diverso nome partner.</span><span class="sxs-lookup"><span data-stu-id="9efc1-130">In contrast, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client updates the cache whenever a subsequent connection or connection reset returns a different partner name.</span></span>  
  
 <span data-ttu-id="9efc1-131">Nella figura seguente viene illustrata una connessione client al partner iniziale, **Partner_A**, per un database con mirroring denominato **Db_1**.</span><span class="sxs-lookup"><span data-stu-id="9efc1-131">The following figure illustrates a client connection to the initial partner, **Partner_A**, for a mirrored database named **Db_1**.</span></span> <span data-ttu-id="9efc1-132">Nella figura viene illustrato un caso in cui il nome partner iniziale specificato dal client identifica correttamente il server principale corrente, **Partner_A**.</span><span class="sxs-lookup"><span data-stu-id="9efc1-132">This figure shows a case in which the initial partner name supplied by the client correctly identifies the current principal server, **Partner_A**.</span></span> <span data-ttu-id="9efc1-133">Il tentativo di connessione iniziale riesce e il provider di accesso ai dati archivia il nome del server mirror, attualmente **Partner_B**, come nome partner di failover nella cache locale.</span><span class="sxs-lookup"><span data-stu-id="9efc1-133">The initial connection attempt succeeds, and the data access provider stores the name of the mirror server (currently **Partner_B**) as the failover partner name in the local cache.</span></span> <span data-ttu-id="9efc1-134">Il client si connette infine alla copia principale del database **Db_1** .</span><span class="sxs-lookup"><span data-stu-id="9efc1-134">Finally, the client connects to the principal copy of the **Db_1** database.</span></span>  
  
 <span data-ttu-id="9efc1-135">![Connessione client quando il partner iniziale è il server principale](../media/dbm-initial-connection.gif "Connessione client quando il partner iniziale è il server principale")</span><span class="sxs-lookup"><span data-stu-id="9efc1-135">![Client connection if initial partner is principal](../media/dbm-initial-connection.gif "Client connection if initial partner is principal")</span></span>  
  
 <span data-ttu-id="9efc1-136">Il tentativo di connessione iniziale può non riuscire, ad esempio, a causa di un errore di rete o di un'istanza del server non attiva.</span><span class="sxs-lookup"><span data-stu-id="9efc1-136">The initial connection attempt may fail, for example, because of a network error or an inactive server instance.</span></span> <span data-ttu-id="9efc1-137">Poiché il partner iniziale non è disponibile, per consentire al provider di accesso ai dati di tentare la connessione al partner di failover, è necessario che il nome partner di failover sia stato specificato dal client nella stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-137">Because the initial partner is unavailable, for the data access provider to attempt to connect to the failover partner, the client must have supplied the failover partner name in the connection string.</span></span>  
  
 <span data-ttu-id="9efc1-138">In questo caso, se il nome partner di failover non è disponibile, il tentativo di connessione originale continua fino al timeout della connessione di rete o alla restituzione di un errore, analogamente a quanto avviene per un database senza mirroring.</span><span class="sxs-lookup"><span data-stu-id="9efc1-138">In that case, if the failover partner name is unavailable, the original connection attempt continues until the network connection timeout or an error is returned (just as for a non-mirrored database).</span></span>  
  
 <span data-ttu-id="9efc1-139">Quando il nome partner di failover viene specificato nella stringa di connessione, il comportamento del provider di accesso ai dati dipende dal protocollo di rete e dal sistema operativo del client, come segue:</span><span class="sxs-lookup"><span data-stu-id="9efc1-139">When the failover partner name is supplied in the connection string, the behavior of the data access provider depends on the network protocol and operating system of the client, as follows:</span></span>  
  
-   <span data-ttu-id="9efc1-140">Per il protocollo TCP/IP, i tentativi di connessione sono regolati da un algoritmo per la riesecuzione dei tentativi di connessione specifico del mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="9efc1-140">For TCP/IP, the connection attempts are regulated by a connection retry algorithm that is specific to database mirroring.</span></span> <span data-ttu-id="9efc1-141">L'algoritmo per i *nuovi tentativi di connessione* determina il tempo massimo ( *tempo per i nuovi tentativi*) stabilito per l'apertura di una connessione per un tentativo di connessione specifico.</span><span class="sxs-lookup"><span data-stu-id="9efc1-141">The *connection retry algorithm* determines the maximum time (the *retry time*) allotted for opening a connection in a given connection attempt.</span></span>  
  
-   <span data-ttu-id="9efc1-142">Per altri protocolli di rete</span><span class="sxs-lookup"><span data-stu-id="9efc1-142">For other network protocols</span></span>  
  
     <span data-ttu-id="9efc1-143">Se si verifica un errore o se il partner iniziale non è disponibile, il tentativo di connessione iniziale attende fino alla scadenza del periodo di timeout della connessione di rete o fino alla scadenza del periodo di timeout di accesso sul provider di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="9efc1-143">If an error occurs or if the initial partner is unavailable, the initial connection attempt waits until the network connection timeout period expires or the login timeout period expires on the data access provider.</span></span> <span data-ttu-id="9efc1-144">In genere, tale attesa dura dai 20 ai 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-144">Typically, this wait is on the order of 20 to 30 seconds.</span></span> <span data-ttu-id="9efc1-145">Successivamente, se non si è verificato il timeout del provider di accesso ai dati, esso tenta di connettersi al partner di failover.</span><span class="sxs-lookup"><span data-stu-id="9efc1-145">Thereafter, if the data access provider has not timed out, it attempts to connect to the failover partner.</span></span> <span data-ttu-id="9efc1-146">Se il periodo di timeout della connessione scade prima che la connessione venga stabilita o se il partner di failover diventa non disponibile, il tentativo di connessione non riesce.</span><span class="sxs-lookup"><span data-stu-id="9efc1-146">If the connection timeout period expires before the connection succeeds or the failover partner is unavailable, the connection attempt fails.</span></span> <span data-ttu-id="9efc1-147">Se il partner di failover è disponibile entro il periodo di timeout di accesso ed è ora il server principale, il tentativo di connessione in genere ha esito positivo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-147">If failover partner is available within the login timeout period and is now the principal server, the connection attempt normally succeeds.</span></span>  

  
### <a name="connection-strings-for-a-mirrored-database"></a><span data-ttu-id="9efc1-148">Stringhe di connessione per un database con mirroring</span><span class="sxs-lookup"><span data-stu-id="9efc1-148">Connection Strings for a Mirrored Database</span></span>  
 <span data-ttu-id="9efc1-149">La stringa di connessione fornita dal client include informazioni utilizzate dal provider di accesso ai dati per connettersi al database.</span><span class="sxs-lookup"><span data-stu-id="9efc1-149">The connection string supplied by the client contains information that the data access provider uses to connect to the database.</span></span> <span data-ttu-id="9efc1-150">In questa sessione vengono illustrate le parole chiave specificatamente rilevanti per la connessione a un database con mirroring utilizzando una connessione tramite driver ODBC di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client.</span><span class="sxs-lookup"><span data-stu-id="9efc1-150">This section discusses the keywords that are specifically relevant for connecting to a mirrored database using a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC Driver Connection.</span></span>  
  
#### <a name="network-attribute"></a><span data-ttu-id="9efc1-151">Attributo Network</span><span class="sxs-lookup"><span data-stu-id="9efc1-151">Network Attribute</span></span>  
 <span data-ttu-id="9efc1-152">La stringa di connessione deve includere l'attributo **Rete** per specificare il protocollo di rete.</span><span class="sxs-lookup"><span data-stu-id="9efc1-152">The connection string should contain the **Network** attribute to specify the network protocol.</span></span> <span data-ttu-id="9efc1-153">Questo assicura che il protocollo di rete specificato sia persistente tra le connessioni a partner diversi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-153">This ensures that the specified network protocol persists between connections to different partners.</span></span> <span data-ttu-id="9efc1-154">Il protocollo ottimale per la connessione a un database con mirroring è TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="9efc1-154">The best protocol for connecting to a mirrored database is TCP/IP.</span></span> <span data-ttu-id="9efc1-155">Per assicurare che il client richieda il TCP/IP per ogni connessione ai partner, una stringa di connessione include l'attributo seguente:</span><span class="sxs-lookup"><span data-stu-id="9efc1-155">To ensure that the client requests TCP/IP for every connection to the partners, a connection string supplies the following attribute:</span></span>  
  
```  
Network=dbmssocn;   
```  
  
> [!IMPORTANT]  
>  <span data-ttu-id="9efc1-156">È consigliabile mantenere TCP/IP all'inizio dell'elenco dei protocolli per un client.</span><span class="sxs-lookup"><span data-stu-id="9efc1-156">We recommend keeping TCP/IP at the top of a client's protocol list.</span></span> <span data-ttu-id="9efc1-157">Tuttavia, se la stringa di connessione specifica l'attributo **Rete** , questo ha la priorità sull'ordine dell'elenco.</span><span class="sxs-lookup"><span data-stu-id="9efc1-157">However, if the connection string specifies the **Network** attribute, this overrides the list order.</span></span>  
  
 <span data-ttu-id="9efc1-158">In alternativa, per assicurare che il client richieda il protocollo Named Pipes per ogni connessione ai partner, una stringa di connessione include l'attributo seguente:</span><span class="sxs-lookup"><span data-stu-id="9efc1-158">Alternatively, to ensure that the client requests named pipes for every connection to the partners, a connection string supplies the following attribute:</span></span>  
  
```  
Network=dbnmpntw;   
```  
  
> [!IMPORTANT]  
>  <span data-ttu-id="9efc1-159">Poiché il protocollo Named Pipes non utilizza l'algoritmo per la riesecuzione dei tentativi TCP/IP, in molti casi, per un tentativo di connessione con tale protocollo può verificarsi il timeout prima della connessione a un database con mirroring.</span><span class="sxs-lookup"><span data-stu-id="9efc1-159">Because named pipes does not use the TCP/IP retry algorithm, in many cases, a named pipes connection attempt may time out before connecting to a mirrored database.</span></span>  
  
#### <a name="server-attribute"></a><span data-ttu-id="9efc1-160">Attributo Server</span><span class="sxs-lookup"><span data-stu-id="9efc1-160">Server Attribute</span></span>  
 <span data-ttu-id="9efc1-161">La stringa di connessione deve includere un attributo `Server` indicante il nome partner iniziale, che dovrebbe identificare l'istanza del server principale corrente.</span><span class="sxs-lookup"><span data-stu-id="9efc1-161">The connection string must contain a `Server` attribute that supplies the initial partner name, which should identify the current principal server instance.</span></span>  
  
 <span data-ttu-id="9efc1-162">Il modo più semplice per identificare l'istanza del server è specificarne il nome, *<nome_server>* [ **\\** _<nome_istanza_SQL_Server>_ ].</span><span class="sxs-lookup"><span data-stu-id="9efc1-162">The simplest way to identify the server instance is by specifying its name , *<server_name>*[**\\**_<SQL_Server_instance_name>_].</span></span> <span data-ttu-id="9efc1-163">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="9efc1-163">For example:</span></span>  
  
 `Server=Partner_A;`  
  
 <span data-ttu-id="9efc1-164">o</span><span class="sxs-lookup"><span data-stu-id="9efc1-164">or</span></span>  
  
 `Server=Partner_A\Instance_2;`  
  
 <span data-ttu-id="9efc1-165">Quando viene utilizzato il nome di sistema, è tuttavia necessario che il client esegua una ricerca DNS per ottenere l'indirizzo IP del server e una query SQL Server Browser per ottenere il numero di porta del server sul quale si trova il partner.</span><span class="sxs-lookup"><span data-stu-id="9efc1-165">However, when the system name is used, the client must perform a DNS lookup to obtain the IP address of the server and a SQL Server Browser query to obtain the port number of the server on which the partner resides.</span></span> <span data-ttu-id="9efc1-166">Queste ricerche e query possono essere ignorate specificando l'indirizzo IP e il numero di porta del partner nell'attributo `Server`, anziché specificando il nome del server.</span><span class="sxs-lookup"><span data-stu-id="9efc1-166">Those lookups and queries can be bypassed by specifying the IP address and port number of the partner in the `Server` attribute, rather than specifying the server name.</span></span> <span data-ttu-id="9efc1-167">Questo è consigliabile per ridurre al minimo la possibilità di ritardi esterni durante la connessione al partner.</span><span class="sxs-lookup"><span data-stu-id="9efc1-167">This is recommended to minimize the possibility of external delays while connecting to that partner.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9efc1-168">Una query SQL Server Browser è necessaria se la stringa di connessione specifica il nome dell'istanza denominata e non la porta.</span><span class="sxs-lookup"><span data-stu-id="9efc1-168">A SQL Server Browser query is necessary if the connection string specifies the named instance name and not the port.</span></span>  
  
 <span data-ttu-id="9efc1-169">Per specificare l'indirizzo IP e la porta, l' `Server` attributo assume il formato seguente, `Server=` *<ip_address>* `,` *\<port>* , ad esempio:</span><span class="sxs-lookup"><span data-stu-id="9efc1-169">To specify the IP address and port, the `Server` attribute takes the following form, `Server=`*<ip_address>*`,`*\<port>*, for example:</span></span>  
  
```  
Server=123.34.45.56,4724;   
```  
  
> [!NOTE]  
>  <span data-ttu-id="9efc1-170">L'indirizzo IP può essere IP versione 4 (IPv4) o IP versione 6 (IPv6).</span><span class="sxs-lookup"><span data-stu-id="9efc1-170">The IP address can be IP Version 4 (IPv4) or IP Version 6 (IPv6).</span></span>  
  
#### <a name="database-attribute"></a><span data-ttu-id="9efc1-171">Attributo Database</span><span class="sxs-lookup"><span data-stu-id="9efc1-171">Database Attribute</span></span>  
 <span data-ttu-id="9efc1-172">È inoltre necessario che la stringa di connessione specifichi l'attributo `Database` per indicare il nome del database con mirroring.</span><span class="sxs-lookup"><span data-stu-id="9efc1-172">In addition, the connection string must specify the `Database` attribute to supply the name of the mirrored database.</span></span> <span data-ttu-id="9efc1-173">Se il database non è disponibile quando il client tenta di stabilire la connessione, viene generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-173">If the database is unavailable when the client attempts to connect, an exception is raised.</span></span>  
  
 <span data-ttu-id="9efc1-174">Ad esempio, per connettersi esplicitamente al database **AdventureWorks** nel server principale Partner_A, un client deve usare la stringa di connessione seguente:</span><span class="sxs-lookup"><span data-stu-id="9efc1-174">For example, to expressly connect to the **AdventureWorks** database on the principal server Partner_A, a client uses the following connection string:</span></span>  
  
 `" Server=Partner_A; Database=AdventureWorks "`  
  
> [!NOTE]  
>  <span data-ttu-id="9efc1-175">Le informazioni sull'autenticazione vengono omesse dalla stringa.</span><span class="sxs-lookup"><span data-stu-id="9efc1-175">This string omits authentication information.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="9efc1-176">La creazione di un bundle del prefisso del protocollo con l' `Server` attributo ( `Server=tcp:` *\<servername>* ) non è compatibile con l'attributo di **rete** e la specifica del protocollo in entrambe le posizioni genererà probabilmente un errore.</span><span class="sxs-lookup"><span data-stu-id="9efc1-176">Bundling the protocol prefix with the `Server` attribute (`Server=tcp:`*\<servername>*) is incompatible with the **Network** attribute, and specifying the protocol in both places will likely result in an error.</span></span> <span data-ttu-id="9efc1-177">Pertanto, è consigliabile che una stringa di connessione specifichi il protocollo usando l'attributo di **rete** e specifichi solo il nome del server nell' `Server` attributo ( `"Network=dbmssocn; Server=` *\<servername>* `"` ).</span><span class="sxs-lookup"><span data-stu-id="9efc1-177">Therefore, we recommend that a connection string specify the protocol using the **Network** attribute and specify only the server name in the `Server` attribute (`"Network=dbmssocn; Server=`*\<servername>*`"`).</span></span>  
  
#### <a name="failover-partner-attribute"></a><span data-ttu-id="9efc1-178">Attributo Failover Partner</span><span class="sxs-lookup"><span data-stu-id="9efc1-178">Failover Partner Attribute</span></span>  
 <span data-ttu-id="9efc1-179">Oltre al nome partner iniziale, il client può anche specificare il nome partner di failover, che identifica l'istanza del server mirror corrente.</span><span class="sxs-lookup"><span data-stu-id="9efc1-179">In addition to the initial partner name, the client can also specify failover partner name, which should identify the current mirror server instance.</span></span> <span data-ttu-id="9efc1-180">Il partner di failover viene specificato dalla parola chiave dell'attributo Failover Partner.</span><span class="sxs-lookup"><span data-stu-id="9efc1-180">The failover partner is specified by one of the keywords for the failover partner attribute.</span></span> <span data-ttu-id="9efc1-181">La parola chiave per questo attributo dipende dall'API utilizzata.</span><span class="sxs-lookup"><span data-stu-id="9efc1-181">The keyword for this attribute depends on the API that you are using.</span></span> <span data-ttu-id="9efc1-182">Nella seguente tabella vengono elencate le parole chiave:</span><span class="sxs-lookup"><span data-stu-id="9efc1-182">The following table lists these keywords:</span></span>  
  
|<span data-ttu-id="9efc1-183">API</span><span class="sxs-lookup"><span data-stu-id="9efc1-183">API</span></span>|<span data-ttu-id="9efc1-184">Parola chiave per l'attributo Failover Partner</span><span class="sxs-lookup"><span data-stu-id="9efc1-184">Keyword for failover partner attribute</span></span>|  
|---------|--------------------------------------------|  
|<span data-ttu-id="9efc1-185">Provider OLE DB</span><span class="sxs-lookup"><span data-stu-id="9efc1-185">OLE DB Provider</span></span>|`FailoverPartner`|  
|<span data-ttu-id="9efc1-186">Driver ODBC</span><span class="sxs-lookup"><span data-stu-id="9efc1-186">ODBC Driver</span></span>|`Failover_Partner`|  
|<span data-ttu-id="9efc1-187">ADO (ActiveX Data Objects)</span><span class="sxs-lookup"><span data-stu-id="9efc1-187">ActiveX Data Objects (ADO)</span></span>|`Failover Partner`|  
  
 <span data-ttu-id="9efc1-188">Il modo più semplice per identificare l'istanza del server è tramite il nome di sistema, *<nome_server>* [ **\\** _\<nome_istanza_SQL_Server>_ ].</span><span class="sxs-lookup"><span data-stu-id="9efc1-188">The simplest way to identify the server instance is by its system name, *<server_name>*[**\\**_<SQL_Server_instance_name>_].</span></span>  
  
 <span data-ttu-id="9efc1-189">In alternativa, è possibile specificare l'indirizzo IP e il numero di porta nell'attributo `Failover Partner`.</span><span class="sxs-lookup"><span data-stu-id="9efc1-189">Alternatively, the IP address and port number can be supplied in the `Failover Partner` attribute.</span></span> <span data-ttu-id="9efc1-190">Se il tentativo di connessione iniziale non riesce durante la prima connessione al database, il tentativo di connessione al partner di failover non dovrà più utilizzare necessariamente il DNS e SQL Server Browser.</span><span class="sxs-lookup"><span data-stu-id="9efc1-190">If the initial connection attempt fails during the first connection to the database, the attempt to connect to the failover partner will be freed from relying on DNS and SQL Server Browser.</span></span> <span data-ttu-id="9efc1-191">Una volta stabilita una connessione, il nome partner di failover sarà sovrascritto dal nome partner di failover. In questo modo, se si verifica un failover, le connessioni reindirizzate richiederanno il DNS e SQL Server Browser.</span><span class="sxs-lookup"><span data-stu-id="9efc1-191">Once a connection is established, the failover partner name will be overwritten with the failover partner name, so if a failover occurs, the redirected connections will require DNS and SQL Server Browser.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9efc1-192">Quando viene specificato solo il nome del partner iniziale, non è necessaria alcuna operazione o scrittura di codice da parte degli sviluppatori dell'applicazione, fatta eccezione per quello relativo alla modalità di riconnessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-192">When only the initial partner name is provided, application developers do not need to take any action or write any code except about how to reconnect.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9efc1-193">Gli sviluppatori di applicazioni con codice gestito forniscono il nome del partner di failover nella proprietà `ConnectionString` dell'oggetto `SqlConnection`.</span><span class="sxs-lookup"><span data-stu-id="9efc1-193">Managed code application developers supply the failover partner name in the `ConnectionString` of the `SqlConnection` object.</span></span> <span data-ttu-id="9efc1-194">Per informazioni sull'utilizzo di questa stringa di connessione, vedere la sezione relativa al supporto del mirroring del database nel Provider di dati .NET Framework per SQL Server nella documentazione di ADO.NET, che fa parte dell'SDK di [!INCLUDE[msCoName](../../includes/msconame-md.md)] .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="9efc1-194">For information on using this connection string, see "Database Mirroring Support in the .NET Framework Data Provider for SQL Server" in the ADO.NET documentation, which is part of the [!INCLUDE[msCoName](../../includes/msconame-md.md)] .NET Framework SDK.</span></span>  
  
#### <a name="example-connection-string"></a><span data-ttu-id="9efc1-195">Stringa di connessione di esempio</span><span class="sxs-lookup"><span data-stu-id="9efc1-195">Example Connection String</span></span>  
 <span data-ttu-id="9efc1-196">Ad esempio, per connettersi esplicitamente al database **AdventureWorks** tramite TCP/IP in Partner_A o Partner_B, è necessario che un'applicazione client che usa il driver ODBC includa la stringa di connessione seguente:</span><span class="sxs-lookup"><span data-stu-id="9efc1-196">For example, to explicitly connect using TCP/IP to the **AdventureWorks** database on either Partner_A or Partner_B, a client application that uses the ODBC Driver could supply the following connection string:</span></span>  
  
```  
"Server=Partner_A; Failover_Partner=Partner_B; Database=AdventureWorks; Network=dbmssocn"  
```  
  
 <span data-ttu-id="9efc1-197">In alternativa, il client può utilizzare l'indirizzo IP e il numero di porta per identificare il partner iniziale, Partner_A. Ad esempio, se l'indirizzo IP è 250.65.43.21 e il numero di porta è 4734, la stringa di connessione sarà la seguente:</span><span class="sxs-lookup"><span data-stu-id="9efc1-197">Alternatively, the client could use the IP address and port number to identify the initial partner, Partner_A; for example, if the IP address is 250.65.43.21 and the port number is 4734, the connection string would be:</span></span>  
  
```  
"Server=250.65.43.21,4734; Failover_Partner=Partner_B; Database=AdventureWorks; Network=dbmssocn"  
```  
  
##  <a name="connection-retry-algorithm-for-tcpip-connections"></a><a name="RetryAlgorithm"></a> <span data-ttu-id="9efc1-198">Algoritmo di riesecuzione dei tentativi di connessione (per connessioni TCP/IP)</span><span class="sxs-lookup"><span data-stu-id="9efc1-198">Connection Retry Algorithm (for TCP/IP Connections)</span></span>  
 <span data-ttu-id="9efc1-199">Per una connessione TCP/IP, quando entrambi i nomi partner si trovano nella cache, il provider di accesso ai dati applica un algoritmo di riesecuzione dei tentativi di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-199">For a TCP/IP connection, when both partner names are in the cache, the data access provider adheres to a connection retry algorithm.</span></span> <span data-ttu-id="9efc1-200">Questa operazione viene eseguita sia per eseguire la connessione iniziale alla sessione sia per eseguire la riconnessione dopo aver perso la connessione stabilita.</span><span class="sxs-lookup"><span data-stu-id="9efc1-200">This is true both for making the initial connection to the session and for reconnecting after losing an established connection.</span></span> <span data-ttu-id="9efc1-201">Dopo avere aperto una connessione, è necessario ulteriore tempo per il completamento dei passaggi di pre-accesso e di accesso.</span><span class="sxs-lookup"><span data-stu-id="9efc1-201">Once a connection has been opened, completing the pre-login and login steps takes additional time.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9efc1-202">Il tempo impiegato nell'apertura di una connessione può superare il tempo di riesecuzione dei tentativi a causa di fattori esterni, ad esempio ricerche DNS lente, lentezza del controller di dominio o del centro di distribuzione chiave (KDC) Kerberos, tempo impiegato per contattare SQL Server Browser, traffico di rete intenso e così via.</span><span class="sxs-lookup"><span data-stu-id="9efc1-202">The time spent in opening a connection can exceed the retry time because of external factors, such as slow DNS lookups, slow domain controller/Kerberos Key Distribution Center (KDC), time spent contacting SQL Server Browser, network congestion, and so forth.</span></span> <span data-ttu-id="9efc1-203">Tali fattori esterni possono impedire a un client di connettersi a un database con mirroring.</span><span class="sxs-lookup"><span data-stu-id="9efc1-203">Such external factors can prevent a client from connecting to a mirrored database.</span></span> <span data-ttu-id="9efc1-204">Inoltre, questi fattori esterni possono fare sì che una connessione richieda più tempo del tempo di riesecuzione dei tentativi stabilito.</span><span class="sxs-lookup"><span data-stu-id="9efc1-204">Also, external factors can cause a connection to take longer to open than the allotted retry time.</span></span> <span data-ttu-id="9efc1-205">Per informazioni su come ignorare DNS e SQL Server Browser per il tentativo di connessione al partner iniziale, vedere [Creazione della connessione iniziale a una sessione di mirroring del database](#InitialConnection), riportato in precedenza in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="9efc1-205">For information on bypassing DNS and SQL Server Browser for connection attempt to the initial partner, see [Making the Initial Connection to a Database Mirroring Session](#InitialConnection), earlier in this topic.</span></span>  
  
 <span data-ttu-id="9efc1-206">Se un tentativo di connessione ha esito negativo o il tempo di riesecuzione dei tentativi scade prima che abbia esito positivo, il provider di accesso ai dati tenterà la connessione all'altro partner.</span><span class="sxs-lookup"><span data-stu-id="9efc1-206">If a connection attempt fails or the retry time expires before it succeeds, the data access provider tries the other partner.</span></span> <span data-ttu-id="9efc1-207">Se a questo punto non è ancora stata aperta una connessione, il provider tenterà alternativamente i nomi partner iniziale e di failover finché non verrà aperta una connessione o fino al timeout del periodo di accesso. Il periodo di timeout di accesso predefinito è 15 secondi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-207">If a connection is not opened by this point, the provider alternately tries the initial and failover partner names, until a connection is opened or the login period times out. The default login time-out period is 15 seconds.</span></span> <span data-ttu-id="9efc1-208">È consigliabile utilizzare un periodo di timeout di accesso di almeno 5 secondi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-208">We recommend that the login time-out period be at least 5 seconds.</span></span> <span data-ttu-id="9efc1-209">L'utilizzo di un periodo di timeout più breve può impedire qualsiasi tentativo di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-209">Specifying a smaller time-out period might prevent any of the connection attempts from succeeding.</span></span>  
  
 <span data-ttu-id="9efc1-210">Il tempo di riesecuzione dei tentativi è una percentuale del periodo di accesso.</span><span class="sxs-lookup"><span data-stu-id="9efc1-210">The retry time is a percentage of the login period.</span></span> <span data-ttu-id="9efc1-211">Il tempo di riesecuzione dei tentativi di connessione è maggiore in ogni ciclo successivo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-211">The retry time for a connection attempt is larger in each successive round.</span></span> <span data-ttu-id="9efc1-212">Nel primo ciclo, il tempo di riesecuzione per ognuno dei due tentativi è l'8% del periodo di accesso totale.</span><span class="sxs-lookup"><span data-stu-id="9efc1-212">In the first round, the retry time for each of the two attempts is 8 percent of the total login period.</span></span> <span data-ttu-id="9efc1-213">In ogni ciclo successivo, l'algoritmo di riesecuzione dei tentativi aumenta dello stesso valore il tempo massimo di riesecuzione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-213">In each successive round, the retry algorithm increases the maximum retry time by the same amount.</span></span> <span data-ttu-id="9efc1-214">I tempi di riesecuzione dei primi otto tentativi di connessione sono pertanto i seguenti:</span><span class="sxs-lookup"><span data-stu-id="9efc1-214">Thus, the retry times for the first eight connection attempts is as follows:</span></span>  
  
 <span data-ttu-id="9efc1-215">8%, 8%, 16%, 16%, 24%, 24%, 32%, 32%</span><span class="sxs-lookup"><span data-stu-id="9efc1-215">8%, 8%, 16%, 16%, 24%, 24%, 32%, 32%</span></span>  
  
 <span data-ttu-id="9efc1-216">Il tempo di riesecuzione dei tentativi viene calcolato mediante la formula seguente:</span><span class="sxs-lookup"><span data-stu-id="9efc1-216">The retry time is calculated using the following formula:</span></span>  
  
 <span data-ttu-id="9efc1-217">_RetryTime_ **=** _PreviousRetryTime_ **+(** 0,08 **&#42;** _LoginTimeout_ **)**</span><span class="sxs-lookup"><span data-stu-id="9efc1-217">_RetryTime_ **=** _PreviousRetryTime_ **+(** 0.08 **&#42;**_LoginTimeout_**)**</span></span>  
  
 <span data-ttu-id="9efc1-218">Dove *PreviousRetryTime* è inizialmente pari a 0.</span><span class="sxs-lookup"><span data-stu-id="9efc1-218">Where *PreviousRetryTime* is initially 0.</span></span>  
  
 <span data-ttu-id="9efc1-219">Ad esempio, se per l'accesso si usa il periodo di timeout predefinito di 15 secondi, *LoginTimeout* *= 15*.</span><span class="sxs-lookup"><span data-stu-id="9efc1-219">For example, if using the default login time-out period of 15 seconds, *LoginTimeout* *= 15*.</span></span> <span data-ttu-id="9efc1-220">In questo caso, i tempi di riesecuzione dei tentativi stabiliti nei primi tre cicli sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="9efc1-220">In this case, the retry times allotted in the first three rounds are as follows:</span></span>  
  
|<span data-ttu-id="9efc1-221">Round</span><span class="sxs-lookup"><span data-stu-id="9efc1-221">Round</span></span>|<span data-ttu-id="9efc1-222">Calcolo*RetryTime*</span><span class="sxs-lookup"><span data-stu-id="9efc1-222">*RetryTime* calculation</span></span>|<span data-ttu-id="9efc1-223">Tempo di riesecuzione per tentativo</span><span class="sxs-lookup"><span data-stu-id="9efc1-223">Retry time per attempt</span></span>|  
|-----------|-----------------------------|----------------------------|  
|<span data-ttu-id="9efc1-224">1</span><span class="sxs-lookup"><span data-stu-id="9efc1-224">1</span></span>|<span data-ttu-id="9efc1-225">0 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="9efc1-225">0 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="9efc1-226">1,2 secondi</span><span class="sxs-lookup"><span data-stu-id="9efc1-226">1.2 seconds</span></span>|  
|<span data-ttu-id="9efc1-227">2</span><span class="sxs-lookup"><span data-stu-id="9efc1-227">2</span></span>|<span data-ttu-id="9efc1-228">1,2 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="9efc1-228">1.2 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="9efc1-229">2,4 secondi</span><span class="sxs-lookup"><span data-stu-id="9efc1-229">2.4 seconds</span></span>|  
|<span data-ttu-id="9efc1-230">3</span><span class="sxs-lookup"><span data-stu-id="9efc1-230">3</span></span>|<span data-ttu-id="9efc1-231">2,4 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="9efc1-231">2.4 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="9efc1-232">3,6 secondi</span><span class="sxs-lookup"><span data-stu-id="9efc1-232">3.6 seconds</span></span>|  
|<span data-ttu-id="9efc1-233">4</span><span class="sxs-lookup"><span data-stu-id="9efc1-233">4</span></span>|<span data-ttu-id="9efc1-234">3,6 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="9efc1-234">3.6 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="9efc1-235">4,8 secondi</span><span class="sxs-lookup"><span data-stu-id="9efc1-235">4.8 seconds</span></span>|   
  
 <span data-ttu-id="9efc1-236">Nella figura seguente vengono illustrati questi tempi di riesecuzione dei tentativi di connessione successivi, per ognuno dei quali si verifica il timeout.</span><span class="sxs-lookup"><span data-stu-id="9efc1-236">The following figure illustrates these retry times for successive connection attempts, each of which times out.</span></span>  
  
 <span data-ttu-id="9efc1-237">![Ritardo massimo tra i tentativi di riesecuzione per un timeout di accesso di 15 secondi](../media/dbm-retry-algorithm.gif "Ritardo massimo tra i tentativi di riesecuzione per un timeout di accesso di 15 secondi")</span><span class="sxs-lookup"><span data-stu-id="9efc1-237">![Maximum retry delays for 15 second login timeout](../media/dbm-retry-algorithm.gif "Maximum retry delays for 15 second login timeout")</span></span>  
  
 <span data-ttu-id="9efc1-238">Per il periodo di timeout di accesso predefinito, il tempo massimo stabilito per i primi tre cicli di tentativi di connessione è pari a 14,4 secondi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-238">For the default login time-out period, the maximum time allotted to the first three rounds of connection attempts is 14.4 seconds.</span></span> <span data-ttu-id="9efc1-239">Se ogni tentativo richiedesse tutto il tempo stabilito, rimarrebbero solo 0,6 secondi di tempo prima del timeout del periodo di accesso. In tal caso, il quarto ciclo verrebbe abbreviato consentendo solo un rapido tentativo finale di connessione mediante il nome partner iniziale.</span><span class="sxs-lookup"><span data-stu-id="9efc1-239">If every attempt were to use all of its allotted time, only 0.6 seconds of time would remain before the login period times out. In that case, the fourth round would be curtailed, allowing only a final quick attempt to connect using the initial partner name.</span></span> <span data-ttu-id="9efc1-240">Un tentativo di connessione può tuttavia dare esito negativo prima della scadenza del tempo di riesecuzione dei tentativi stabilito, in particolare negli ultimi cicli.</span><span class="sxs-lookup"><span data-stu-id="9efc1-240">However, a connection attempt may fail in less than its allotted retry time, particularly in later rounds.</span></span> <span data-ttu-id="9efc1-241">Ad esempio, se si riceve un errore di rete è possibile che un tentativo termini prima della scadenza del tempo di riesecuzione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-241">For example, receiving a network error can cause an attempt to end before the retry time expires.</span></span> <span data-ttu-id="9efc1-242">Se i primi tentativi hanno esito negativo a causa di un errore di rete, sarebbe disponibile ulteriore tempo per il quarto ciclo e forse per quelli successivi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-242">If earlier attempts fail due to a network error, additional time would be available for the fourth round and, perhaps, additional rounds.</span></span>  
  
 <span data-ttu-id="9efc1-243">Un'altra causa di esito negativo di un tentativo è un'istanza del server non attiva, come si verifica quando un'istanza del server è impegnata nel failover del relativo database.</span><span class="sxs-lookup"><span data-stu-id="9efc1-243">Another cause of a failed attempt is an inactive server instance, as occurs when a server instance is engaged in failing over its database.</span></span> <span data-ttu-id="9efc1-244">In questo caso, viene imposto un ritardo nella riesecuzione dei tentativi per impedire ai client di causare l'overload dei partner con una successione rapida di tentativi di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-244">In this case, a retry delay is imposed to prevent clients from overloading the partners with a rapid succession of connection attempts.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9efc1-245">Quando entrambi i nomi partner sono disponibili, se il periodo di timeout di accesso è infinito, il client tenta di riconnettersi ai server all'infinito, alternando tra il nome partner iniziale e il nome partner di failover.</span><span class="sxs-lookup"><span data-stu-id="9efc1-245">When both partner names are available, if the login time-out period is infinite, the client attempts to reconnect to the servers indefinitely, alternating between the initial partner name and the failover partner name.</span></span>  
<span data-ttu-id="9efc1-246">)</span><span class="sxs-lookup"><span data-stu-id="9efc1-246">)</span></span>  
  
### <a name="retry-delays-during-failover"></a><span data-ttu-id="9efc1-247">Ritardi di riesecuzione dei tentativi durante il failover</span><span class="sxs-lookup"><span data-stu-id="9efc1-247">Retry Delays During Failover</span></span>  
 <span data-ttu-id="9efc1-248">Se un client tenta di connettersi a un partner durante il failover, il partner risponde immediatamente che non è attivo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-248">If a client attempts to connect to a partner that is failing over, the partner immediately responds that it is inactive.</span></span> <span data-ttu-id="9efc1-249">In questo caso, ogni ciclo di tentativi di connessione è molto più breve del tempo di riesecuzione stabilito.</span><span class="sxs-lookup"><span data-stu-id="9efc1-249">In this case, each round of connection attempts are much briefer than the allotted retry time.</span></span> <span data-ttu-id="9efc1-250">Potranno pertanto essere eseguiti molti cicli di tentativi di connessione prima del timeout del periodo di accesso. Per evitare l'overload dei partner con una serie rapida di tentativi di connessione durante un failover, il provider di accesso ai dati aggiunge un breve ritardo dopo ogni ciclo di riesecuzione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-250">This means that many rounds of connection attempts could happen before the login period times out. To avoid overloading the partners with a rapid series of connection attempts during a failover, the data access provider adds a brief retry delay after each retry cycle.</span></span> <span data-ttu-id="9efc1-251">La durata di tale ritardo è determinata dall'algoritmo di ritardo dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-251">The length of a given retry delay is determined by the retry-delay algorithm.</span></span> <span data-ttu-id="9efc1-252">Dopo il primo ciclo, il ritardo è di 100 millisecondi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-252">After the first round, the delay is 100 milliseconds.</span></span> <span data-ttu-id="9efc1-253">Dopo ognuno dei tre cicli successivi, il ritardo raddoppia (200, 400 e 800).</span><span class="sxs-lookup"><span data-stu-id="9efc1-253">After each of the next three rounds, the retry delay doubles-to 200, 400, and 800.</span></span> <span data-ttu-id="9efc1-254">Per tutti i cicli successivi, il ritardo dei tentativi è di 1 secondo fino alla riuscita o al timeout del tentativo di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-254">For all later rounds, the retry delay is 1 second until the connection attempt succeeds or times out.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9efc1-255">Se l'istanza del server viene arrestata, la richiesta di connessione ha immediatamente esito negativo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-255">If the server instance is stopped, then the connection request fails immediately.</span></span>  
  
 <span data-ttu-id="9efc1-256">Nella figura seguente viene illustrato il modo in cui il ritardo dei tentativi influisca sui tentativi di connessione durante un failover manuale in cui i partner cambiano di ruolo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-256">The following figure illustrates how the retry delay affects connection attempts during a manual failover, in which the partners switch their roles.</span></span> <span data-ttu-id="9efc1-257">Il periodo di timeout di accesso è 15 secondi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-257">The login time-out period is 15 seconds.</span></span>  
  
 <span data-ttu-id="9efc1-258">![Algoritmo di ritardo dei tentativi di riesecuzione](../media/dbm-retry-delay-algorithm.gif "Algoritmo di ritardo dei tentativi di riesecuzione")</span><span class="sxs-lookup"><span data-stu-id="9efc1-258">![Retry-delay algorithm](../media/dbm-retry-delay-algorithm.gif "Retry-delay algorithm")</span></span>  
  
##  <a name="reconnecting-to-a-database-mirroring-session"></a><a name="Reconnecting"></a> <span data-ttu-id="9efc1-259">Riconnessione a una sessione di mirroring del database</span><span class="sxs-lookup"><span data-stu-id="9efc1-259">Reconnecting to a Database Mirroring Session</span></span>  
 <span data-ttu-id="9efc1-260">Se una connessione stabilita a una sessione di mirroring del database ha esito negativo per qualsiasi motivo, ad esempio a causa di un failover di mirroring del database, e l'applicazione tenta di riconnettersi al server iniziale, il provider di accesso ai dati può tentare di ristabilire la connessione utilizzando il nome del partner di failover memorizzato nella cache del client.</span><span class="sxs-lookup"><span data-stu-id="9efc1-260">If an established connection to a database mirroring session fails for any reason, for example, due to a database mirroring failover, and the application attempts to reconnect to the initial server, the data access provider can attempt to reconnect using the failover partner name stored in the client's cache.</span></span> <span data-ttu-id="9efc1-261">La riconnessione non è tuttavia automatica.</span><span class="sxs-lookup"><span data-stu-id="9efc1-261">Reconnecting is not automatic, however.</span></span> <span data-ttu-id="9efc1-262">È necessario che l'applicazione riconosca l'errore,</span><span class="sxs-lookup"><span data-stu-id="9efc1-262">The application must become aware of the error.</span></span> <span data-ttu-id="9efc1-263">chiuda la connessione non riuscita e ne apra una nuova utilizzando gli stessi attributi della stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-263">Then, the application needs to close the failed connection and open a new connection using the same connection string attributes.</span></span> <span data-ttu-id="9efc1-264">A questo punto, il provider di accesso ai dati reindirizzerà la connessione al partner di failover.</span><span class="sxs-lookup"><span data-stu-id="9efc1-264">At this point, the data access provider redirects the connection to the failover partner.</span></span> <span data-ttu-id="9efc1-265">Se l'istanza del server identificata da questo nome è attualmente il server principale, il tentativo di connessione ha in genere esito positivo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-265">If the server instance identified by this name is currently the principal server, the connection attempt usually succeeds.</span></span> <span data-ttu-id="9efc1-266">Se non è chiaro se è stato eseguito il commit o il rollback di una transazione, l'applicazione dovrà verificare lo stato della transazione, come durante la riconnessione a un'istanza del server autonoma.</span><span class="sxs-lookup"><span data-stu-id="9efc1-266">If it is unclear whether a transaction was committed or rolled back, the application must check on the state of the transaction, in the same way as when reconnecting to a stand-alone server instance.</span></span>  
  
 <span data-ttu-id="9efc1-267">La riconnessione è analoga a una connessione iniziale per la quale la stringa di connessione specifica un nome partner di failover.</span><span class="sxs-lookup"><span data-stu-id="9efc1-267">Reconnecting resembles an initial connection for which the connection string supplied a failover partner name.</span></span> <span data-ttu-id="9efc1-268">Se il primo tentativo di connessione ha esito negativo, si alternano tentativi di connessione tra il nome partner iniziale e il nome partner di failover finché il client non si connette al server principale oppure fino al timeout del provider di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="9efc1-268">If the first connection attempt fails, connection attempts alternate back and forth between the initial partner name and failover partner name until either the client connects to the  principal server or the data access provider times out.</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="9efc1-269">Native Client verifica che venga eseguita la connessione a un'istanza del server principale, ma non controlla se questa istanza sia partner dell'istanza del server specificata nel nome partner iniziale della stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-269">Native Client verifies that it connects to a principal server instance but not whether this instance is the partner of server instance specified in the initial partner name of the connection string.</span></span>  
  
 <span data-ttu-id="9efc1-270">Se per le connessioni viene utilizzato TCP/IP, l'algoritmo di riesecuzione dei tentativi di connessione determina la quantità di tempo stabilita per i tentativi di connessione in ogni ciclo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-270">If the connections use TCP/IP, the connection retry algorithm determines the amount of time allotted to the connection attempts in each round.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="9efc1-271">In caso di disconnessione del client dal database, il provider di accesso ai dati non tenterà di ristabilire la connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-271">If the client gets disconnected from the database, the data access provider does not attempt to reconnect.</span></span> <span data-ttu-id="9efc1-272">È necessario che il client generi una nuova richiesta di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-272">The client must issue a new connection request.</span></span> <span data-ttu-id="9efc1-273">Inoltre, se un'applicazione si arresta in seguito alla perdita della connessione, i nomi partner memorizzati nella cache andranno persi.</span><span class="sxs-lookup"><span data-stu-id="9efc1-273">Also, if an application shuts down on losing the connection, it will lose the cached partner names.</span></span> <span data-ttu-id="9efc1-274">Se la connessione è andata persa perché il server principale non era più disponibile, l'unico modo per ristabilire la connessione dell'applicazione al server mirror consiste nel fornire il nome partner di failover nella relativa stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-274">If the connection was lost because the principal server became unavailable, the only way that the application can reconnect to the mirror server is by supplying the failover partner name in its connection string.</span></span>  
  
  
### <a name="impact-of-redirection-on-a-client-application"></a><span data-ttu-id="9efc1-275">Impatto del reindirizzamento su un'applicazione client</span><span class="sxs-lookup"><span data-stu-id="9efc1-275">Impact of Redirection on a Client Application</span></span>  
 <span data-ttu-id="9efc1-276">Dopo un failover, il provider di accesso ai dati reindirizza la connessione all'istanza del server principale corrente.</span><span class="sxs-lookup"><span data-stu-id="9efc1-276">After a failover, the data access provider redirects the connection to the current principal server instance.</span></span> <span data-ttu-id="9efc1-277">Tuttavia, il reindirizzamento è trasparente per i client.</span><span class="sxs-lookup"><span data-stu-id="9efc1-277">However, the redirection is transparent to clients.</span></span> <span data-ttu-id="9efc1-278">A un client, una connessione reindirizzata appare come una connessione all'istanza del server identificata dal nome partner iniziale.</span><span class="sxs-lookup"><span data-stu-id="9efc1-278">To a client, a redirected connection appears to be a connection to the server instance identified by the initial partner name.</span></span> <span data-ttu-id="9efc1-279">Se il partner iniziale è attualmente il server mirror, il client può apparire come se fosse connesso al server mirror e aggiornasse il database mirror.</span><span class="sxs-lookup"><span data-stu-id="9efc1-279">When the initial partner is currently the mirror server, the client can appear to be connected to the mirror server and updating the mirror database.</span></span> <span data-ttu-id="9efc1-280">In realtà, tuttavia, il client è stato reindirizzato al partner di failover, ovvero il database principale corrente, e sta aggiornando il nuovo database principale.</span><span class="sxs-lookup"><span data-stu-id="9efc1-280">Actually, however, the client has been redirected to the failover partner, which is the current principal database, and the client is updating the new principal database.</span></span>  
  
 <span data-ttu-id="9efc1-281">Dopo essere stato reindirizzato al partner di failover, un client può riscontrare risultati imprevisti durante l'utilizzo di un'istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] USE per utilizzare un database diverso.</span><span class="sxs-lookup"><span data-stu-id="9efc1-281">After being redirected to the failover partner, a client can experience unexpected results when using a [!INCLUDE[tsql](../../includes/tsql-md.md)] USE statement to use a different database.</span></span> <span data-ttu-id="9efc1-282">Questa situazione può verificarsi se l'istanza del server principale corrente (il partner di failover) presenta un set diverso di database rispetto al server principale originale (il partner iniziale).</span><span class="sxs-lookup"><span data-stu-id="9efc1-282">This can happen if the current principal server instance (the failover partner) has a different set of databases than the original principal server (the initial partner).</span></span>  
  
##  <a name="the-impact-of-a-stale-failover-partner-name"></a><a name="StalePartnerName"></a> <span data-ttu-id="9efc1-283">Impatto di un nome partner di failover non aggiornato</span><span class="sxs-lookup"><span data-stu-id="9efc1-283">The Impact of a Stale Failover Partner Name</span></span>  
 <span data-ttu-id="9efc1-284">L'amministratore del database può modificare il partner di failover in qualunque momento.</span><span class="sxs-lookup"><span data-stu-id="9efc1-284">The database administrator can change the failover partner at any time.</span></span> <span data-ttu-id="9efc1-285">Pertanto, un nome partner di failover specificato dal client potrebbe essere scaduto o *non aggiornato*.</span><span class="sxs-lookup"><span data-stu-id="9efc1-285">Therefore, a client-supplied failover partner name might be out of date, or *stale*.</span></span> <span data-ttu-id="9efc1-286">Ad esempio, considerare un partner di failover denominato Partner_B che viene sostituito da un'altra istanza del server, Partner_C.</span><span class="sxs-lookup"><span data-stu-id="9efc1-286">For example, consider a failover partner named Partner_B that is replaced by another server instance, Partner_C.</span></span> <span data-ttu-id="9efc1-287">Ora, se un client fornisce Partner_B come nome del partner di failover, tale nome è non aggiornato.</span><span class="sxs-lookup"><span data-stu-id="9efc1-287">Now, if a client supplies Partner_B as the failover partner name, that name is stale.</span></span> <span data-ttu-id="9efc1-288">Se il nome partner di failover specificato dal client non è aggiornato, il provider di accesso ai dati si comporta come se il client non avesse fornito alcun nome partner di failover.</span><span class="sxs-lookup"><span data-stu-id="9efc1-288">When the client-supplied failover partner name is stale, the behavior of the data access provider equates to the case in which a failover partner name is not supplied by the client.</span></span>  
  
 <span data-ttu-id="9efc1-289">Si consideri ad esempio la situazione in cui un client utilizza una stringa di connessione per una serie di quattro tentativi di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-289">For example, consider situation in which a client uses one connection string for a series of four connection attempts.</span></span> <span data-ttu-id="9efc1-290">Nella stringa di connessione il nome partner iniziale è Partner_A e il nome partner di failover è Partner_B:</span><span class="sxs-lookup"><span data-stu-id="9efc1-290">In the connection string, the initial partner name is Partner_A, and the failover partner name is Partner_B:</span></span>  
  
```  
"Server=Partner_A; Failover Partner=Partner_B; Database=AdventureWorks"  
```  
  
 <span data-ttu-id="9efc1-291">Nella tabella seguente sono riportate quattro configurazioni partner, per ognuna delle quali viene indicato se la stringa di connessione specificata consente la connessione del client per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="9efc1-291">The following table shows four partner configurations and indicates for each whether this connection string works for connecting the client for the first time.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9efc1-292">Un'applicazione può tenere traccia delle modifiche alla configurazione e modificare di conseguenza la propria stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="9efc1-292">An application can track configuration changes and change its connection string accordingly.</span></span> <span data-ttu-id="9efc1-293">Questo richiede codice aggiuntivo ma riduce il carico amministrativo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-293">This requires extra code but reduces the administrative burden.</span></span>  
  
|<span data-ttu-id="9efc1-294">Configurazione</span><span class="sxs-lookup"><span data-stu-id="9efc1-294">Configuration</span></span>|<span data-ttu-id="9efc1-295">Server principale</span><span class="sxs-lookup"><span data-stu-id="9efc1-295">Principal server</span></span>|<span data-ttu-id="9efc1-296">Server mirror</span><span class="sxs-lookup"><span data-stu-id="9efc1-296">Mirror server</span></span>|<span data-ttu-id="9efc1-297">Comportamento al tentativo di connessione specificando Partner_A e Partner_B</span><span class="sxs-lookup"><span data-stu-id="9efc1-297">Behavior when attempting to connect specifying Partner_A and Partner_B</span></span>|  
|-------------------|----------------------|-------------------|------------------------------------------------------------------------------|  
|<span data-ttu-id="9efc1-298">Configurazione di mirroring originale.</span><span class="sxs-lookup"><span data-stu-id="9efc1-298">Original mirroring configuration.</span></span>|<span data-ttu-id="9efc1-299">Partner_A</span><span class="sxs-lookup"><span data-stu-id="9efc1-299">Partner_A</span></span>|<span data-ttu-id="9efc1-300">Partner_B</span><span class="sxs-lookup"><span data-stu-id="9efc1-300">Partner_B</span></span>|<span data-ttu-id="9efc1-301">Partner_A viene memorizzato nella cache come nome partner iniziale.</span><span class="sxs-lookup"><span data-stu-id="9efc1-301">Partner_A is cached as the initial partner name.</span></span> <span data-ttu-id="9efc1-302">Il client riesce a connettersi a Partner_A.</span><span class="sxs-lookup"><span data-stu-id="9efc1-302">The client succeeds in connecting to Partner_A.</span></span> <span data-ttu-id="9efc1-303">Il client scarica il nome del server mirror, Partner_B, e lo memorizza nella cache, ignorando il nome partner di failover specificato dal client.</span><span class="sxs-lookup"><span data-stu-id="9efc1-303">The client downloads the name of mirror server, Partner_B, and caches it, ignoring the client-supplied failover partner name.</span></span>|  
|<span data-ttu-id="9efc1-304">In Partner_A si verifica un errore hardware, che provoca il failover, disconnettendo i client.</span><span class="sxs-lookup"><span data-stu-id="9efc1-304">Partner_A experiences a hardware failure, and failover occurs (disconnecting clients).</span></span>|<span data-ttu-id="9efc1-305">Partner_B</span><span class="sxs-lookup"><span data-stu-id="9efc1-305">Partner_B</span></span>|<span data-ttu-id="9efc1-306">none</span><span class="sxs-lookup"><span data-stu-id="9efc1-306">none</span></span>|<span data-ttu-id="9efc1-307">Partner_A è ancora memorizzato nella cache come nome partner iniziale, ma il nome partner di failover specificato dal client, Partner_B, consente al client di connettersi al server principale corrente.</span><span class="sxs-lookup"><span data-stu-id="9efc1-307">The Partner_A is still cached as the initial partner name, but the client-supplied failover partner name, Partner_B, permits the client to connect to the current principal server.</span></span>|  
|<span data-ttu-id="9efc1-308">L'amministratore del database arresta il mirroring, disconnettendo i client, sostituisce Partner_A con Partner_C e riavvia il mirroring.</span><span class="sxs-lookup"><span data-stu-id="9efc1-308">The database administrator stops mirroring (disconnecting clients), replaces Partner_A with Partner_C, and restarts mirroring.</span></span>|<span data-ttu-id="9efc1-309">Partner_B</span><span class="sxs-lookup"><span data-stu-id="9efc1-309">Partner_B</span></span>|<span data-ttu-id="9efc1-310">Partner_C</span><span class="sxs-lookup"><span data-stu-id="9efc1-310">Partner_C</span></span>|<span data-ttu-id="9efc1-311">Il client tenta di connettersi senza successo a Partner_A. Il client tenta quindi di connettersi a Partner_B, ovvero il server principale corrente, e la connessione ha esito positivo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-311">The client attempts to connect to Partner_A and fails; then the client tries Partner_B (the current principal server) and succeeds.</span></span> <span data-ttu-id="9efc1-312">Il provider di accesso ai dati scarica il nome del server mirror corrente, Partner_C, e lo memorizza nella cache come nome partner di failover corrente.</span><span class="sxs-lookup"><span data-stu-id="9efc1-312">The data access provider downloads the name of the current mirror server, Partner_C, and caches it as the current failover partner name.</span></span>|  
|<span data-ttu-id="9efc1-313">Viene eseguito il failover manuale del servizio su Partner_C, disconnettendo i client.</span><span class="sxs-lookup"><span data-stu-id="9efc1-313">Service is manually failed over to Partner_C (disconnecting clients).</span></span>|<span data-ttu-id="9efc1-314">Partner_C</span><span class="sxs-lookup"><span data-stu-id="9efc1-314">Partner_C</span></span>|<span data-ttu-id="9efc1-315">Partner_B</span><span class="sxs-lookup"><span data-stu-id="9efc1-315">Partner_B</span></span>|<span data-ttu-id="9efc1-316">Il client tenta di connettersi inizialmente a Partner_A, quindi a Partner_B.</span><span class="sxs-lookup"><span data-stu-id="9efc1-316">Client attempts to connect to Partner_A initially, and then to Partner_B.</span></span> <span data-ttu-id="9efc1-317">Entrambi i nomi generano errori e infine si verifica il timeout della richiesta di connessione, la quale avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="9efc1-317">Both names fail, and eventually the connection request times out and fails.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="9efc1-318">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="9efc1-318">See Also</span></span>  
 <span data-ttu-id="9efc1-319">[Mirroring del database &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="9efc1-319">[Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="9efc1-320">Possibili errori durante il mirroring del database</span><span class="sxs-lookup"><span data-stu-id="9efc1-320">Possible Failures During Database Mirroring</span></span>](possible-failures-during-database-mirroring.md)  
  
  
