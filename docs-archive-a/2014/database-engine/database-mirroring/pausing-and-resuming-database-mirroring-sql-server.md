---
title: Sospensione e ripresa del mirroring del database (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- sessions [SQL Server], database mirroring
- resuming database mirroring
- database mirroring [SQL Server], pausing
- database mirroring [SQL Server], resuming
- pausing database mirroring
ms.assetid: c67802c6-ee8c-4cbd-a6d4-f7b80413a4ab
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 8c231876b11303992e0e3300c9cb73c0cf53b3af
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87716792"
---
# <a name="pausing-and-resuming-database-mirroring-sql-server"></a><span data-ttu-id="c0500-102">Sospensione e ripresa del mirroring del database (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c0500-102">Pausing and Resuming Database Mirroring (SQL Server)</span></span>
  <span data-ttu-id="c0500-103">Il proprietario del database può sospendere una sessione di mirroring del database, riprenderla in qualsiasi momento</span><span class="sxs-lookup"><span data-stu-id="c0500-103">The database owner can pause and later resume a database mirroring session at any time.</span></span> <span data-ttu-id="c0500-104">e preservare così lo stato della sessione durante la sospensione del mirroring.</span><span class="sxs-lookup"><span data-stu-id="c0500-104">Pausing preserves the session state while suspending mirroring.</span></span> <span data-ttu-id="c0500-105">In caso di colli di bottiglia, la sospensione può essere utile per migliorare le prestazioni del server principale.</span><span class="sxs-lookup"><span data-stu-id="c0500-105">During bottlenecks, pausing might be useful to improve performance on the principal server.</span></span>  
  
 <span data-ttu-id="c0500-106">Quando si sospende una sessione, il database principale resta disponibile.</span><span class="sxs-lookup"><span data-stu-id="c0500-106">When a session is paused, the principal database remains available.</span></span> <span data-ttu-id="c0500-107">In caso di sospensione, lo stato della sessione di mirroring viene impostato su SUSPENDED e il database mirror perde la sincronizzazione con il database principale, che viene quindi eseguito in una condizione nota come esposizione senza mirroring.</span><span class="sxs-lookup"><span data-stu-id="c0500-107">Pausing sets the state of the mirroring session to SUSPENDED, and the mirror database no longer keeps up with the principal database, causing the principal database to run exposed.</span></span>  
  
 <span data-ttu-id="c0500-108">È consigliabile riprendere una sessione sospesa il più rapidamente possibile poiché, fintanto che la sessione di mirroring del database rimane sospesa, non è possibile troncare il log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="c0500-108">We recommend that you resume a paused session quickly, because as long as a database mirroring session remains paused, the transaction log cannot be truncated.</span></span> <span data-ttu-id="c0500-109">Se la sessione di mirroring del database resta sospesa troppo a lungo, lo spazio del log delle transazioni può esaurirsi rendendo il database non disponibile.</span><span class="sxs-lookup"><span data-stu-id="c0500-109">Therefore, if a database mirroring session is paused for too long, the transaction log fills up, making the database unavailable.</span></span> <span data-ttu-id="c0500-110">Per una spiegazione di questo problema, vedere "Impatto della sospensione e ripresa sul troncamento del log" di seguito in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="c0500-110">For an explanation of why this happens, see "How Pausing and Resuming Affect Log Truncation," later in this topic.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="c0500-111">In un servizio forzato, quando il server principale originale esegue nuovamente la connessione il mirroring viene sospeso.</span><span class="sxs-lookup"><span data-stu-id="c0500-111">Following a forced service, when the original principal server reconnects mirroring is suspended.</span></span> <span data-ttu-id="c0500-112">Se si riprende il mirroring in questa situazione, è possibile che si verifichi una perdita di dati nel server principale originale.</span><span class="sxs-lookup"><span data-stu-id="c0500-112">Resuming mirroring in this situation could possibly cause data loss on the original principal server.</span></span> <span data-ttu-id="c0500-113">Per informazioni sulla gestione della potenziale perdita di dati, vedere [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="c0500-113">For information about managing the potential data loss, see [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span></span>  
  
 <span data-ttu-id="c0500-114">**Contenuto dell'argomento**</span><span class="sxs-lookup"><span data-stu-id="c0500-114">**In this Topic:**</span></span>  
  
-   [<span data-ttu-id="c0500-115">Impatto della sospensione e ripresa sul troncamento del log</span><span class="sxs-lookup"><span data-stu-id="c0500-115">How Pausing and Resuming Affect Log Truncation</span></span>](#EffectOnLogTrunc)  
  
-   [<span data-ttu-id="c0500-116">Evitare il riempimento del log delle transazioni</span><span class="sxs-lookup"><span data-stu-id="c0500-116">Avoid a Full Transaction Log</span></span>](#AvoidFullLog)  
  
-   [<span data-ttu-id="c0500-117">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="c0500-117">Related Tasks</span></span>](#RelatedTasks)  
  
##  <a name="how-pausing-and-resuming-affect-log-truncation"></a><a name="EffectOnLogTrunc"></a> <span data-ttu-id="c0500-118">Impatto della sospensione e ripresa sul troncamento del log</span><span class="sxs-lookup"><span data-stu-id="c0500-118">How Pausing and Resuming Affect Log Truncation</span></span>  
 <span data-ttu-id="c0500-119">In genere, quando su un database viene eseguito un checkpoint automatico, il relativo log delle transazioni viene troncato in corrispondenza di tale checkpoint dopo il successivo backup del log.</span><span class="sxs-lookup"><span data-stu-id="c0500-119">Normally, when an automatic checkpoint is performed on a database, its transaction log is truncated to that checkpoint after the next log backup.</span></span> <span data-ttu-id="c0500-120">Durante il periodo in cui una sessione di mirroring del database rimane sospesa, tutti i record del log corrente restano attivi poiché il server principale è in attesa di inviarli al server mirror.</span><span class="sxs-lookup"><span data-stu-id="c0500-120">While a database mirroring session remains paused, all of the current log records remain active because the principal server is waiting to send them to the mirror server.</span></span> <span data-ttu-id="c0500-121">I record del log non inviati si accumulano nel log delle transazioni del database principale fino alla ripresa della sessione e al momento dell'invio dei record del log dal server principale al server mirror.</span><span class="sxs-lookup"><span data-stu-id="c0500-121">The unsent log records accumulate in the transaction log of the principal database until the session resumes and the principal server has sent the log records to the mirror server.</span></span>  
  
 <span data-ttu-id="c0500-122">Quando la sessione viene ripresa, il server principale inizia immediatamente a inviare i record del log accumulati al server mirror.</span><span class="sxs-lookup"><span data-stu-id="c0500-122">When the session is resumed, the principal server immediately begins sending the accumulated log records to the mirror server.</span></span> <span data-ttu-id="c0500-123">Dopo la conferma da parte del server mirror che il record del log corrispondente al checkpoint automatico meno recente è stato accodato, il server principale tronca il log del database principale fino a tale checkpoint.</span><span class="sxs-lookup"><span data-stu-id="c0500-123">After the mirror server confirms that it has queued the log record corresponding to the oldest automatic checkpoint, the principal server truncates the log of the principal database to that checkpoint.</span></span> <span data-ttu-id="c0500-124">Il server mirror tronca la coda di rollforward in corrispondenza dello stesso record del log.</span><span class="sxs-lookup"><span data-stu-id="c0500-124">The mirror server truncates the redo queue at the same log record.</span></span> <span data-ttu-id="c0500-125">Poiché questo processo viene ripetuto per ogni checkpoint successivo, il log viene troncato in più fasi per i singoli checkpoint.</span><span class="sxs-lookup"><span data-stu-id="c0500-125">As this process is repeated for each successive checkpoint, the log is truncated in stages, checkpoint by checkpoint.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c0500-126">Per altre informazioni sui checkpoint e sul troncamento del log, vedere [Checkpoint di database &#40;SQL Server&#41;](../../relational-databases/logs/database-checkpoints-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c0500-126">For more information about the checkpoints and log truncation, see [Database Checkpoints &#40;SQL Server&#41;](../../relational-databases/logs/database-checkpoints-sql-server.md).</span></span>  
  
##  <a name="avoid-a-full-transaction-log"></a><a name="AvoidFullLog"></a> <span data-ttu-id="c0500-127">Evitare il riempimento del log delle transazioni</span><span class="sxs-lookup"><span data-stu-id="c0500-127">Avoid a Full Transaction Log</span></span>  
 <span data-ttu-id="c0500-128">Se il log si riempie, perché raggiunge le dimensioni massime o l'istanza del server esaurisce lo spazio, il database non può eseguire ulteriori aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="c0500-128">If the log fills up (either because it reaches its maximum size or the server instance runs out of space), the database cannot perform any more updates.</span></span> <span data-ttu-id="c0500-129">Per evitare questo problema, è possibile procedere in due modi:</span><span class="sxs-lookup"><span data-stu-id="c0500-129">To avoid this problem, you have two alternatives:</span></span>  
  
-   <span data-ttu-id="c0500-130">Riprendere la sessione di mirroring del database prima che il log esaurisca lo spazio, oppure aggiungere spazio di log.</span><span class="sxs-lookup"><span data-stu-id="c0500-130">Resume the database mirroring session before the log fills up, or add more log space.</span></span> <span data-ttu-id="c0500-131">Se si riprende il mirroring, il server principale invia il log cumulativo attivo al server mirror e il database mirror viene posto in stato SYNCHRONIZING.</span><span class="sxs-lookup"><span data-stu-id="c0500-131">Resuming database mirroring lets the principal server send its accumulated active log to the mirror server and puts the mirror database in the SYNCHRONIZING state.</span></span> <span data-ttu-id="c0500-132">Il server mirror può quindi salvare il log su disco e avviarne il rollforward.</span><span class="sxs-lookup"><span data-stu-id="c0500-132">The mirror server can then harden the log to disk and start to redo it.</span></span>  
  
-   <span data-ttu-id="c0500-133">Arrestare la sessione di mirroring del database rimuovendo il mirroring.</span><span class="sxs-lookup"><span data-stu-id="c0500-133">Stop the database mirroring session by removing mirroring.</span></span>  
  
     <span data-ttu-id="c0500-134">A differenza della sospensione di una sessione, la rimozione del mirroring provoca l'eliminazione di tutte le informazioni relative alla sessione di mirroring.</span><span class="sxs-lookup"><span data-stu-id="c0500-134">Unlike pausing a session, removing mirroring drops all information about the mirroring session.</span></span> <span data-ttu-id="c0500-135">Ogni istanza del server partner mantiene la sua copia del database.</span><span class="sxs-lookup"><span data-stu-id="c0500-135">Each partner server instance retains its own copy of the database.</span></span> <span data-ttu-id="c0500-136">Se recuperata, pertanto, la copia precedente del database mirror può risultare diversa dalla copia precedente del database principale e indicare un periodo di tempo inferiore rispetto a quello trascorso dalla sospensione della sessione.</span><span class="sxs-lookup"><span data-stu-id="c0500-136">If the former mirror copy is recovered, it will have diverged from the former principal copy and be behind by the amount of time that has elapsed since the session was paused.</span></span> <span data-ttu-id="c0500-137">Per altre informazioni, vedere [Rimozione del mirroring del database &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c0500-137">For more information, see [Removing Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="c0500-138">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="c0500-138">Related Tasks</span></span>  
 <span data-ttu-id="c0500-139">**Per sospendere o riprendere il mirroring del database**</span><span class="sxs-lookup"><span data-stu-id="c0500-139">**To pause or resume database mirroring**</span></span>  
  
-   [<span data-ttu-id="c0500-140">Sospendere o riprendere una sessione di mirroring del database &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="c0500-140">Pause or Resume a Database Mirroring Session &#40;SQL Server&#41;</span></span>](pause-or-resume-a-database-mirroring-session-sql-server.md)  
  
 <span data-ttu-id="c0500-141">**Per arrestare il mirroring del database**</span><span class="sxs-lookup"><span data-stu-id="c0500-141">**To stop database mirroring**</span></span>  
  
-   [<span data-ttu-id="c0500-142">Rimuovere il mirroring del database &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="c0500-142">Remove Database Mirroring &#40;SQL Server&#41;</span></span>](remove-database-mirroring-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="c0500-143">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="c0500-143">See Also</span></span>  
 <span data-ttu-id="c0500-144">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="c0500-144">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span></span>  
 <span data-ttu-id="c0500-145">[Mirroring del database &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="c0500-145">[Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="c0500-146">Rimozione del mirroring del database &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="c0500-146">Removing Database Mirroring &#40;SQL Server&#41;</span></span>](database-mirroring-sql-server.md)  
  
  
