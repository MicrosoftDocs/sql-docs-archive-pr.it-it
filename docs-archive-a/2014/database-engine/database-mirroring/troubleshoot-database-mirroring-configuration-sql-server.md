---
title: Risolvere i problemi relativi alla configurazione del mirroring del database (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], deployment
- endpoints [SQL Server], database mirroring
- database mirroring [SQL Server], troubleshooting
- troubleshooting [SQL Server], database mirroring
ms.assetid: 87d3801b-dc52-419e-9316-8b1f1490946c
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 0dafd98f721bfc2d2d0dd64a9f97689466529407
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87627393"
---
# <a name="troubleshoot-database-mirroring-configuration-sql-server"></a><span data-ttu-id="1c5b3-102">Risolvere i problemi relativi alla configurazione del mirroring del database (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="1c5b3-102">Troubleshoot Database Mirroring Configuration (SQL Server)</span></span>
  <span data-ttu-id="1c5b3-103">In questo argomento vengono fornite informazioni sulla risoluzione dei problemi relativi all'impostazione di una sessione di mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-103">This topic provides information to help you troubleshoot problems in setting up a database mirroring session.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1c5b3-104">Assicurarsi che vengano soddisfatti tutti i [prerequisiti per il mirroring del database](prerequisites-restrictions-and-recommendations-for-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-104">Ensure that you are meeting all the [prerequisites for database mirroring](prerequisites-restrictions-and-recommendations-for-database-mirroring.md).</span></span>  
  
|<span data-ttu-id="1c5b3-105">Problema</span><span class="sxs-lookup"><span data-stu-id="1c5b3-105">Issue</span></span>|<span data-ttu-id="1c5b3-106">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="1c5b3-106">Summary</span></span>|  
|-----------|-------------|  
|<span data-ttu-id="1c5b3-107">Messaggio di errore 1418</span><span class="sxs-lookup"><span data-stu-id="1c5b3-107">Error Message 1418</span></span>|<span data-ttu-id="1c5b3-108">Questo messaggio di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] indica che l'indirizzo di rete del server non è raggiungibile o non esiste, pertanto si consiglia di controllare il nome dell'indirizzo di rete e quindi eseguire nuovamente il comando.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-108">This [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] message indicates that the server network address cannot be reached or does not exist, and it suggests that you verify the network address name and reissue the command.</span></span> <span data-ttu-id="1c5b3-109">Per altre informazioni, vedere l'argomento [MSSQLSERVER_1418](../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md) .</span><span class="sxs-lookup"><span data-stu-id="1c5b3-109">For more information, see the [MSSQLSERVER_1418](../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md) topic.</span></span>|  
|[<span data-ttu-id="1c5b3-110">Accounts</span><span class="sxs-lookup"><span data-stu-id="1c5b3-110">Accounts</span></span>](#Accounts)|<span data-ttu-id="1c5b3-111">Illustra i requisiti per la corretta configurazione degli account in cui viene eseguito [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1c5b3-111">Discusses requirements for correctly configuring the accounts under which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running.</span></span>|  
|[<span data-ttu-id="1c5b3-112">Endpoints</span><span class="sxs-lookup"><span data-stu-id="1c5b3-112">Endpoints</span></span>](#Endpoints)|<span data-ttu-id="1c5b3-113">Illustra i requisiti per la corretta configurazione dell'endpoint di mirroring del database di ogni istanza del server.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-113">Discusses requirements for correctly configuring the database mirroring endpoint of each server instance.</span></span>|  
|[<span data-ttu-id="1c5b3-114">SystemAddress</span><span class="sxs-lookup"><span data-stu-id="1c5b3-114">SystemAddress</span></span>](#SystemAddress)|<span data-ttu-id="1c5b3-115">Riepiloga le alternative per la specifica del nome di sistema di un'istanza del server in una configurazione di mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-115">Summarizes the alternatives for specifying the system name of a server instance in a database mirroring configuration.</span></span>|  
|[<span data-ttu-id="1c5b3-116">Accesso alla rete</span><span class="sxs-lookup"><span data-stu-id="1c5b3-116">Network access</span></span>](#NetworkAccess)|<span data-ttu-id="1c5b3-117">Documenta il requisito in base a cui ogni istanza del server deve essere in grado di accedere alle porte dell'altra istanza o delle altre istanze tramite TCP.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-117">Documents the requirement that each the server instance be able to access the ports of the other server instance or instances over TCP.</span></span>|  
|[<span data-ttu-id="1c5b3-118">Preparazione del database mirror</span><span class="sxs-lookup"><span data-stu-id="1c5b3-118">Mirror database preparation</span></span>](#MirrorDbPrep)|<span data-ttu-id="1c5b3-119">Riepiloga i requisiti per la preparazione del database mirror per consentire l'avvio del mirroring.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-119">Summarizes the requirements for preparing the mirror database to enable mirroring to start.</span></span>|  
|[<span data-ttu-id="1c5b3-120">Operazione di creazione file non riuscita</span><span class="sxs-lookup"><span data-stu-id="1c5b3-120">Failed create-file operation</span></span>](#FailedCreateFileOp)|<span data-ttu-id="1c5b3-121">Descrive le attività da eseguire in seguito a un'operazione di creazione file non riuscita.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-121">Describes how to respond to a failed create-file operation.</span></span>|  
|[<span data-ttu-id="1c5b3-122">Avvio del mirroring mediante Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="1c5b3-122">Starting mirroring by Using Transact-SQL</span></span>](#StartDbm)|<span data-ttu-id="1c5b3-123">Descrive l'ordine richiesto per le istruzioni ALTER DATABASE *_database* SET PARTNER **='***_partner***'** .</span><span class="sxs-lookup"><span data-stu-id="1c5b3-123">Describes the required order for ALTER DATABASE *database_name* SET PARTNER **='***partner_server***'** statements.</span></span>|  
|[<span data-ttu-id="1c5b3-124">Transazioni tra database</span><span class="sxs-lookup"><span data-stu-id="1c5b3-124">Cross-Database Transactions</span></span>](#CrossDbTxns)|<span data-ttu-id="1c5b3-125">Un failover automatico può portare a una risoluzione automatica e talvolta errata delle transazioni in dubbio.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-125">An automatic failover could lead to automatic and possibly incorrect resolution of in-doubt transactions.</span></span> <span data-ttu-id="1c5b3-126">Per questo motivo, il mirroring del database non supporta transazioni tra database.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-126">For this reason database mirroring does not support cross-database transactions.</span></span>|  
  
##  <a name="accounts"></a><a name="Accounts"></a> <span data-ttu-id="1c5b3-127">Accounts</span><span class="sxs-lookup"><span data-stu-id="1c5b3-127">Accounts</span></span>  
 <span data-ttu-id="1c5b3-128">È necessario configurare correttamente gli account utilizzati per l'esecuzione di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1c5b3-128">The accounts under which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running must be correctly configured.</span></span>  
  
1.  <span data-ttu-id="1c5b3-129">Autorizzazioni corrette per gli account</span><span class="sxs-lookup"><span data-stu-id="1c5b3-129">Do the accounts have the correct permissions?</span></span>  
  
    1.  <span data-ttu-id="1c5b3-130">Per ridurre l'eventualità di una configurazione non corretta, utilizzare account eseguiti negli stessi account di dominio.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-130">If the accounts are running in the same domain accounts, the chances of misconfiguration are reduced.</span></span>  
  
    2.  <span data-ttu-id="1c5b3-131">Se gli account vengono eseguiti in domini diversi oppure non sono account di dominio, è necessario che un account di accesso sia creato nel database **master** dell'altro computer e disponga delle autorizzazioni CONNECT per l'endpoint.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-131">If the accounts are running in different domains or are not domain accounts, the login of one account must be created in **master** on the other computer, and that login must be granted CONNECT permissions on the endpoint.</span></span> <span data-ttu-id="1c5b3-132">Per altre informazioni, vedere [Gestione dei metadati quando si rende disponibile un database in un'altra istanza del server &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-132">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span></span> <span data-ttu-id="1c5b3-133">Queste informazioni si riferiscono anche all'account Servizio di rete.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-133">This includes the Network Service account.</span></span>  
  
2.  <span data-ttu-id="1c5b3-134">Se [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] viene eseguito come servizio con l'account di sistema locale, è necessario utilizzare i certificati per l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-134">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running as a service that is using the local system account, you must use certificates for authentication.</span></span> <span data-ttu-id="1c5b3-135">Per ulteriori informazioni, vedere [Utilizzare certificati per un endpoint del mirroring del database &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-135">For more information, see [Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span></span>  
  
##  <a name="endpoints"></a><a name="Endpoints"></a> <span data-ttu-id="1c5b3-136">Endpoints</span><span class="sxs-lookup"><span data-stu-id="1c5b3-136">Endpoints</span></span>  
 <span data-ttu-id="1c5b3-137">È necessario configurare correttamente gli endpoint.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-137">Endpoints must be correctly configured.</span></span>  
  
1.  <span data-ttu-id="1c5b3-138">Verificare che per ogni istanza del server (server principale, server mirror e server di controllo del mirroring, se presente) sia disponibile un endpoint di mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-138">Make sure that each server instance (the principal server, mirror server, and witness, if any) has a database mirroring endpoint.</span></span> <span data-ttu-id="1c5b3-139">Per altre informazioni, vedere [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) e, a seconda della forma di autenticazione, [Creare un endpoint del mirroring del database per l'autenticazione Windows &#40;Transact-SQL&#41;](create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md) oppure [Usare certificati per un endpoint del mirroring del database &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-139">For more information, see [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) and, depending on the form of authentication, either [Create a Database Mirroring Endpoint for Windows Authentication &#40;Transact-SQL&#41;](create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md) or [Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span></span>  
  
2.  <span data-ttu-id="1c5b3-140">Verificare che i numeri di porta siano corretti.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-140">Check that the port numbers are correct.</span></span>  
  
     <span data-ttu-id="1c5b3-141">Per trovare la porta attualmente associata all'endpoint del mirroring del database per un'istanza del server, usare le viste del catalogo [sys.database_mirroring_endpoints](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) e [sys.tcp_endpoints](/sql/relational-databases/system-catalog-views/sys-tcp-endpoints-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="1c5b3-141">To identify the port currently associated with database mirroring endpoint of a server instance, use the [sys.database_mirroring_endpoints](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) and [sys.tcp_endpoints](/sql/relational-databases/system-catalog-views/sys-tcp-endpoints-transact-sql) catalog views.</span></span>  
  
3.  <span data-ttu-id="1c5b3-142">Per i problemi di impostazione del mirroring del database che sono difficili diagnosticare, è consigliabile controllare ogni istanza del server per verificare che sia in attesa sulle porte corrette.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-142">For database mirroring setup issues that are difficult to explain, we recommend that you inspect each server instance to determine whether it is listening on the correct ports.</span></span> <span data-ttu-id="1c5b3-143">Per informazioni sulla verifica della disponibilità delle porte, vedere [MSSQLSERVER_1418](../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-143">For information about verifying port availability, see [MSSQLSERVER_1418](../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md).</span></span>  
  
4.  <span data-ttu-id="1c5b3-144">Verificare che gli endpoint siano stati avviati (STATE=STARTED).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-144">Make sure that the endpoints are started (STATE=STARTED).</span></span> <span data-ttu-id="1c5b3-145">A tale scopo, utilizzare l'istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] seguente su ogni istanza del server:</span><span class="sxs-lookup"><span data-stu-id="1c5b3-145">On each server instance, use the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span>  
  
    ```  
    SELECT state_desc FROM sys.database_mirroring_endpoints  
    ```  
  
     <span data-ttu-id="1c5b3-146">Per altre informazioni sulla colonna **state_desc**, vedere [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-146">For more information about the **state_desc** column, see [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span></span>  
  
     <span data-ttu-id="1c5b3-147">Per avviare un endpoint, utilizzare l'istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] seguente:</span><span class="sxs-lookup"><span data-stu-id="1c5b3-147">To start an endpoint, use the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span>  
  
    ```  
    ALTER ENDPOINT Endpoint_Mirroring   
    STATE = STARTED   
    AS TCP (LISTENER_PORT = <port_number>)  
    FOR database_mirroring (ROLE = ALL);  
    GO  
    ```  
  
     <span data-ttu-id="1c5b3-148">Per altre informazioni, vedere [ALTER ENDPOINT &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-endpoint-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-148">For more information, see [ALTER ENDPOINT &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-endpoint-transact-sql).</span></span>  
  
5.  <span data-ttu-id="1c5b3-149">Verificare che ROLE sia corretto.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-149">Check that the ROLE is correct.</span></span> <span data-ttu-id="1c5b3-150">A tale scopo, utilizzare l'istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] su ogni istanza del server.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-150">On each server instance use the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span>  
  
    ```  
    SELECT role FROM sys.database_mirroring_endpoints;  
    GO  
    ```  
  
     <span data-ttu-id="1c5b3-151">Per altre informazioni, vedere [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-151">For more information, see [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span></span>  
  
6.  <span data-ttu-id="1c5b3-152">Per l'account di accesso per l'account del servizio dell'altra istanza del server è richiesta l'autorizzazione CONNECT.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-152">The login for the service account from the other server instance requires CONNECT permission.</span></span> <span data-ttu-id="1c5b3-153">Verificare che l'account di accesso dell'altro server disponga dell'autorizzazione CONNECT.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-153">Make sure that the login from the other server has CONNECT permission.</span></span> <span data-ttu-id="1c5b3-154">Per individuare gli account che dispongono dell'autorizzazione CONNECT per un endpoint, utilizzare l'istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] seguente su ogni istanza del server:</span><span class="sxs-lookup"><span data-stu-id="1c5b3-154">To determine who has CONNECT permission for an endpoint, on each server instance use the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span>  
  
    ```  
    SELECT 'Metadata Check';  
    SELECT EP.name, SP.STATE,   
       CONVERT(nvarchar(38), suser_name(SP.grantor_principal_id))   
          AS GRANTOR,   
       SP.TYPE AS PERMISSION,  
       CONVERT(nvarchar(46),suser_name(SP.grantee_principal_id))   
          AS GRANTEE   
       FROM sys.server_permissions SP , sys.endpoints EP  
       WHERE SP.major_id = EP.endpoint_id  
       ORDER BY Permission,grantor, grantee;   
    GO  
  
    ```  
  
##  <a name="system-address"></a><a name="SystemAddress"></a> <span data-ttu-id="1c5b3-155">Indirizzo di sistema</span><span class="sxs-lookup"><span data-stu-id="1c5b3-155">System Address</span></span>  
 <span data-ttu-id="1c5b3-156">Quale nome di sistema di un'istanza del server in una configurazione di mirroring del database è possibile utilizzare qualsiasi nome che identifichi univocamente il sistema.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-156">For the system name of a server instance in a database mirroring configuration, you can use any name that unambiguously identifies the system.</span></span> <span data-ttu-id="1c5b3-157">L'indirizzo del server può essere un nome di sistema (se i sistemi si trovano nello stesso dominio), un nome di dominio completo o un indirizzo IP (preferibilmente un indirizzo IP statico).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-157">The server address can be a system name (if the systems are in the same domain), a fully qualified domain name, or an IP address (preferably, a static IP address).</span></span> <span data-ttu-id="1c5b3-158">L'utilizzo del nome di dominio completo è una soluzione efficace.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-158">Using the fully qualified domain name is guaranteed to work.</span></span> <span data-ttu-id="1c5b3-159">Per altre informazioni, vedere [Specificare un indirizzo di rete del server &#40;Mirroring del database&#41;](specify-a-server-network-address-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-159">For more information, see [Specify a Server Network Address &#40;Database Mirroring&#41;](specify-a-server-network-address-database-mirroring.md).</span></span>  
  
##  <a name="network-access"></a><a name="NetworkAccess"></a> <span data-ttu-id="1c5b3-160">Network Access</span><span class="sxs-lookup"><span data-stu-id="1c5b3-160">Network Access</span></span>  
 <span data-ttu-id="1c5b3-161">Ogni istanza del server deve essere in grado di accedere alle porte dell'altra istanza o delle altre istanze tramite TCP.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-161">Each server instance must be able to access the ports of the other server instance or instances over TCP.</span></span> <span data-ttu-id="1c5b3-162">Questo requisito è particolarmente importante quando le istanze del server appartengono a domini diversi non trusted.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-162">This is especially important if the server instances are in different domains that do not trust each other (untrusted domains).</span></span> <span data-ttu-id="1c5b3-163">il che limita buona parte delle comunicazioni tra le istanze del server.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-163">This restricts much of the communication between the server instances.</span></span>  
  
##  <a name="mirror-database-preparation"></a><a name="MirrorDbPrep"></a> <span data-ttu-id="1c5b3-164">Mirror Database Preparation</span><span class="sxs-lookup"><span data-stu-id="1c5b3-164">Mirror Database Preparation</span></span>  
 <span data-ttu-id="1c5b3-165">Sia che si avvii il mirroring per la prima volta o che lo si avvii nuovamente dopo averlo rimosso, verificare che il database mirror sia predisposto per il mirroring.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-165">Whether starting mirroring for the first time or starting it again after mirroring was removed, verify that the mirror database is prepared for mirroring.</span></span>  
  
 <span data-ttu-id="1c5b3-166">Quando si crea il database mirror sul server mirror, assicurarsi di ripristinare il backup del database principale specificando lo stesso nome di database con l'opzione WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-166">When you create the mirror database on the mirror server, make sure that you restore the backup of the principal database specifying the same database name WITH NORECOVERY.</span></span> <span data-ttu-id="1c5b3-167">È inoltre necessario applicare tutti i backup di log creati dopo l'esecuzione di tale backup, sempre tramite WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-167">Also, all log backups created after that backup was taken must also be applied, again WITH NORECOVERY.</span></span>  
  
 <span data-ttu-id="1c5b3-168">Se possibile, è inoltre consigliabile che il percorso del database mirror, inclusa la lettera di unità, sia identico a quello del database principale.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-168">Also, we recommend that, if it is possible, the file path (including the drive letter) of the mirror database be identical to the path of the principal database.</span></span> <span data-ttu-id="1c5b3-169">Se i percorsi dei file sono diversi, ad esempio il database principale è disponibile nell'unità F: e tale unità non è presente nel database mirror, è necessario includere l'opzione MOVE nell'istruzione RESTORE.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-169">If the file paths must differ, for example, if the principal database is on drive 'F:' but the mirror system lacks an F: drive, you must include the MOVE option in the RESTORE statement.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="1c5b3-170">Se durante la creazione del database mirror i file del database vengono spostati, potrebbe essere impossibile aggiungere successivamente file al database senza sospendere il mirroring.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-170">If you move the database files when you are creating the mirror database, you might be unable to add files to the database later without mirroring being suspended.</span></span>  
  
 <span data-ttu-id="1c5b3-171">Se il mirroring di database è stato arrestato, prima di poter riavviare il mirroring è necessario che tutti i backup di log successivi eseguiti sul database vengano applicati al database.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-171">If database mirroring has been stopped, all subsequent log backups taken on the principal database must be applied to the mirror database before mirroring can be restarted.</span></span>  
  
 <span data-ttu-id="1c5b3-172">Per altre informazioni, vedere [Preparazione di un database mirror per il mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-172">For more information, see [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span></span>  
  
##  <a name="failed-create-file-operation"></a><a name="FailedCreateFileOp"></a> <span data-ttu-id="1c5b3-173">Failed Create-File Operation</span><span class="sxs-lookup"><span data-stu-id="1c5b3-173">Failed Create-File Operation</span></span>  
 <span data-ttu-id="1c5b3-174">Per aggiungere un file senza conseguenze per la sessione di mirroring, è necessario che il percorso del file esista in entrambi i server.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-174">Adding a file without impacting a mirroring session requires that the path of the file exist on both servers.</span></span> <span data-ttu-id="1c5b3-175">Pertanto, se durante la creazione del database mirror i file del database vengono spostati, potrebbe essere impossibile aggiungere successivamente file al database mirror senza sospendere il mirroring.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-175">Therefore, if you move the database files when creating the mirror database, a later add-file operation might fail on the mirror database and cause mirroring to be suspended.</span></span>  
  
 <span data-ttu-id="1c5b3-176">Per risolvere il problema:</span><span class="sxs-lookup"><span data-stu-id="1c5b3-176">To fix the problem:</span></span>  
  
1.  <span data-ttu-id="1c5b3-177">Il proprietario del database deve rimuovere la sessione di mirroring e deve ripristinare un backup completo del filegroup contenente il file aggiunto.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-177">The database owner must remove the mirroring session and restore a full backup of the filegroup that contains the added file.</span></span>  
  
2.  <span data-ttu-id="1c5b3-178">Il proprietario deve quindi eseguire il backup del log contenente l'operazione di aggiunta file nel server principale e ripristinare manualmente il backup del log nel database mirror utilizzando le opzioni WITH NORECOVERY e WITH MOVE.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-178">The owner must then back up the log containing the add-file operation on the principal server and manually restore the log backup on the mirror database using the WITH NORECOVERY and WITH MOVE options.</span></span> <span data-ttu-id="1c5b3-179">L'esecuzione di questa operazione consente di creare il percorso del file specificato nel server mirror e di ripristinare il nuovo file in tale percorso.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-179">Doing this creates the specified file path on the mirror server and restores the new file to that location.</span></span>  
  
3.  <span data-ttu-id="1c5b3-180">Per preparare il database per una nuova sessione di mirroring, il proprietario deve inoltre ripristinare con l'opzione WITH NO RECOVERY tutti gli altri backup del log in sospeso dal server principale.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-180">To prepare the database for a new mirroring session, the owner must also restore WITH NO RECOVERY any other outstanding log backups from the principal server.</span></span>  
  
 <span data-ttu-id="1c5b3-181">Per altre informazioni, vedere [Rimozione del mirroring del database &#40;SQL Server&#41;](database-mirroring-sql-server.md), [Preparare un database mirror per il mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md), [Stabilire una sessione di mirroring del database tramite autenticazione di Windows &#40;Transact-SQL&#41;](database-mirroring-establish-session-windows-authentication.md), [Usare certificati per un endpoint del mirroring del database &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md) oppure [Stabilire una sessione di mirroring del database tramite autenticazione di Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-181">For more information, see [Removing Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md), [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md), [Establish a Database Mirroring Session Using Windows Authentication &#40;Transact-SQL&#41;](database-mirroring-establish-session-windows-authentication.md), [Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;](use-certificates-for-a-database-mirroring-endpoint-transact-sql.md), or [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span></span>  
  
##  <a name="starting-mirroring-by-using-transact-sql"></a><a name="StartDbm"></a><span data-ttu-id="1c5b3-182">Avvio del mirroring tramite Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="1c5b3-182">Starting mirroring by Using Transact-SQL</span></span>  
 <span data-ttu-id="1c5b3-183">L'ordine con cui vengono rilasciate le istruzioni ALTER DATABASE *_database* SET PARTNER **='***server_partner***'** è molto importante.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-183">The order in which the ALTER DATABASE *database_name* SET PARTNER **='***partner_server***'** statements are issued is very important.</span></span>  
  
1.  <span data-ttu-id="1c5b3-184">La prima istruzione deve essere eseguita sul server mirror.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-184">The first statement must be run on the mirror server.</span></span> <span data-ttu-id="1c5b3-185">Quando viene eseguita questa istruzione, il server mirror non tenta di contattare altre istanze del server</span><span class="sxs-lookup"><span data-stu-id="1c5b3-185">When this statement is issued, the mirror server does not try to contact any other server instance.</span></span> <span data-ttu-id="1c5b3-186">e indica invece al database di attendere che il server mirror venga contattato dal server principale.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-186">Instead, the mirror server instructs its database to wait until the mirror server has been contacted by the principal server.</span></span>  
  
2.  <span data-ttu-id="1c5b3-187">La seconda istruzione ALTER DATABASE deve essere eseguita sul server principale</span><span class="sxs-lookup"><span data-stu-id="1c5b3-187">The second ALTER DATABASE statement must be run on the principal server.</span></span> <span data-ttu-id="1c5b3-188">e fa in modo che il server principale tenti di connettersi al server mirror.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-188">This statement causes the principal server to try to connect to the mirror server.</span></span> <span data-ttu-id="1c5b3-189">Dopo che è stata creata la connessione, il server mirror tenta di connettersi al server principale tramite un'altra connessione.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-189">After that connection is created, the mirror then tries to connect to the principal server on another connection.</span></span>  
  
 <span data-ttu-id="1c5b3-190">Per altre informazioni, vedere [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-190">For more information, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1c5b3-191">Per altre informazioni sull'uso di [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], vedere [Stabilire una sessione di mirroring del database tramite autenticazione di Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-191">For information about using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] to start mirroring, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span></span>  
  
##  <a name="cross-database-transactions"></a><a name="CrossDbTxns"></a><span data-ttu-id="1c5b3-192">Transazioni tra database</span><span class="sxs-lookup"><span data-stu-id="1c5b3-192">Cross-Database Transactions</span></span>  
 <span data-ttu-id="1c5b3-193">Quando viene eseguito il mirroring di un database in modalità a protezione elevata con failover automatico, un failover automatico può portare a una risoluzione automatica e talvolta errata delle transazioni in dubbio.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-193">When a database is being mirrored in high-safety mode with automatic failover, an automatic failover could lead to automatic and possibly incorrect resolution of in-doubt transactions.</span></span> <span data-ttu-id="1c5b3-194">Se si verifica un failover automatico su uno dei database mentre è stato eseguito il commit di una transazione tra database, possono verificarsi inconsistenze logiche tra i database.</span><span class="sxs-lookup"><span data-stu-id="1c5b3-194">If an automatic failover occurs on either database while a cross-database transaction is being committed, logical inconsistencies can occur between the databases.</span></span>  
  
 <span data-ttu-id="1c5b3-195">I tipi di transazioni tra database che possono essere interessati da un failover automatico includono:</span><span class="sxs-lookup"><span data-stu-id="1c5b3-195">The types of cross-database transactions that can be affected by an automatic failover include the following:</span></span>  
  
-   <span data-ttu-id="1c5b3-196">Una transazione che aggiorna più database nella stessa istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1c5b3-196">A transaction that is updating multiple databases in the same instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="1c5b3-197">Le transazioni che utilizzano [!INCLUDE[msCoName](../../includes/msconame-md.md)] Distributed Transaction Coordinator (MS DTC).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-197">Transactions that use a [!INCLUDE[msCoName](../../includes/msconame-md.md)] Distributed Transaction Coordinator (MS DTC).</span></span>  
  
 <span data-ttu-id="1c5b3-198">Per altre informazioni, vedere [Transazioni tra database non supportate per il mirroring del database o i gruppi di disponibilità AlwaysOn &#40;SQL Server&#41;](../availability-groups/windows/transactions-always-on-availability-and-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="1c5b3-198">For more information, see [Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](../availability-groups/windows/transactions-always-on-availability-and-database-mirroring.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1c5b3-199">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="1c5b3-199">See Also</span></span>  
 <span data-ttu-id="1c5b3-200">[Impostazione del mirroring del database &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="1c5b3-200">[Setting Up Database Mirroring &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="1c5b3-201">Sicurezza del trasporto per il mirroring del database e Gruppi di disponibilità AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="1c5b3-201">Transport Security for Database Mirroring and AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](transport-security-database-mirroring-always-on-availability.md)  
  
  
