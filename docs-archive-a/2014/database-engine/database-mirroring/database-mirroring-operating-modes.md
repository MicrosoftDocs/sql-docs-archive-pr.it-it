---
title: Modalità di funzionamento del mirroring del database | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], operating modes
ms.assetid: f8a579c2-55d7-4278-8088-f1da1de5b2e6
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: c944b402b8b1ba9b78036d667ec728ccaf561a91
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87624929"
---
# <a name="database-mirroring-operating-modes"></a><span data-ttu-id="041de-102">Modalità di funzionamento del mirroring del database</span><span class="sxs-lookup"><span data-stu-id="041de-102">Database Mirroring Operating Modes</span></span>
  <span data-ttu-id="041de-103">In questo argomento vengono illustrate le modalità di funzionamento sincrona e asincrona per le sessioni di mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="041de-103">This topic describes the synchronous and asynchronous operating modes for database mirroring sessions.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="041de-104">Per un'introduzione al mirroring del database, vedere [Mirroring del database &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="041de-104">For an introduction to database mirroring, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
 
  
##  <a name="terms-and-definitions"></a><a name="TermsAndDefinitions"></a> <span data-ttu-id="041de-105">Termini e definizioni</span><span class="sxs-lookup"><span data-stu-id="041de-105">Terms and Definitions</span></span>  
 <span data-ttu-id="041de-106">In questa sezione vengono introdotti alcuni termini fondamentali ai fini della comprensione dell'argomento.</span><span class="sxs-lookup"><span data-stu-id="041de-106">This section introduces a few terms that are central to this topic.</span></span>  
  
 <span data-ttu-id="041de-107">Modalità a prestazioni elevate</span><span class="sxs-lookup"><span data-stu-id="041de-107">High-performance mode</span></span>  
 <span data-ttu-id="041de-108">La sessione di mirroring del database viene eseguita in modo asincrono e utilizza unicamente il server principale e il server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-108">The database mirroring session operates asynchronously and uses only the principal server and mirror server.</span></span> <span data-ttu-id="041de-109">L'unica forma di cambio di ruolo è il servizio forzato (con possibile perdita di dati).</span><span class="sxs-lookup"><span data-stu-id="041de-109">The only form of role switching is forced service (with possible data loss).</span></span>  
  
 <span data-ttu-id="041de-110">Modalità a sicurezza elevata</span><span class="sxs-lookup"><span data-stu-id="041de-110">High-safety mode</span></span>  
 <span data-ttu-id="041de-111">La sessione di mirroring del database viene eseguita in modo asincrono e facoltativamente utilizza un server di controllo, nonché il server principale e il server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-111">The database mirroring session operates synchronously and, optionally, uses a witness, as well as the principal server and mirror server.</span></span>  
  
 <span data-ttu-id="041de-112">Livello di sicurezza delle transazioni</span><span class="sxs-lookup"><span data-stu-id="041de-112">Transaction safety</span></span>  
 <span data-ttu-id="041de-113">Proprietà del database specifica del mirroring che determina l'esecuzione della sessione di mirroring del database in modalità sincrona o asincrona.</span><span class="sxs-lookup"><span data-stu-id="041de-113">A mirroring-specific database property that determines whether a database mirroring session operates synchronously or asynchronously.</span></span> <span data-ttu-id="041de-114">Esistono due livelli di sicurezza: FULL e OFF.</span><span class="sxs-lookup"><span data-stu-id="041de-114">There are two safety levels: FULL and OFF.</span></span>  
  
 <span data-ttu-id="041de-115">Controllo</span><span class="sxs-lookup"><span data-stu-id="041de-115">Witness</span></span>  
 <span data-ttu-id="041de-116">Per l'utilizzo nella sola modalità a sicurezza elevata. Istanza facoltativa di SQL Server che consente al server mirror di stabilire se avviare un failover automatico.</span><span class="sxs-lookup"><span data-stu-id="041de-116">For use only with high-safety mode, an optional instance of SQL Server that enables the mirror server to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="041de-117">A differenza dei due partner di failover, il server di controllo del mirroring non rende disponibile il database.</span><span class="sxs-lookup"><span data-stu-id="041de-117">Unlike the two failover partners, the witness does not serve the database.</span></span> <span data-ttu-id="041de-118">Il supporto del failover automatico è l'unico ruolo del server di controllo del mirroring.</span><span class="sxs-lookup"><span data-stu-id="041de-118">Supporting automatic failover is the only role of the witness.</span></span>  
  
##  <a name="asynchronous-database-mirroring-high-performance-mode"></a><a name="VisualElement"></a><span data-ttu-id="041de-119">Mirroring asincrono del database (modalità a prestazioni elevate)</span><span class="sxs-lookup"><span data-stu-id="041de-119">Asynchronous Database Mirroring (High-Performance Mode)</span></span>  
 <span data-ttu-id="041de-120">In questa sezione vengono descritti il funzionamento del mirroring del database asincrono, i casi in cui è consigliabile utilizzare la modalità a elevate prestazioni e le operazioni da effettuare in caso di errore del server principale.</span><span class="sxs-lookup"><span data-stu-id="041de-120">This section describes how asynchronous database mirroring works, when it is appropriate to use high-performance mode, and how to respond if the principal server fails.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="041de-121">La maggior parte delle edizioni di [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] supporta solo il mirroring del database sincrono ("solo sicurezza FULL").</span><span class="sxs-lookup"><span data-stu-id="041de-121">Most editions of [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] support only synchronous database mirroring ("Safety Full Only").</span></span> <span data-ttu-id="041de-122">Per informazioni sulle edizioni che supportano completamente il mirroring del database, vedere "disponibilità elevata (AlwaysOn)" in [funzionalità supportate dalle edizioni di SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span><span class="sxs-lookup"><span data-stu-id="041de-122">For information about editions that fully support database mirroring, see "High Availability (AlwaysOn)" in [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>  
  
 <span data-ttu-id="041de-123">Quando il livello di protezione delle transazioni viene impostato su OFF, la sessione di mirroring del database opera in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="041de-123">When transaction safety is set to OFF, the database mirroring session operates asynchronously.</span></span> <span data-ttu-id="041de-124">Le operazioni asincrone supportano solo una modalità operativa, ovvero la modalità a prestazioni elevate.</span><span class="sxs-lookup"><span data-stu-id="041de-124">Asynchronous operation supports only one operating mode-high-performance mode.</span></span> <span data-ttu-id="041de-125">Questa modalità migliora le prestazioni, ma comporta una riduzione della disponibilità.</span><span class="sxs-lookup"><span data-stu-id="041de-125">This mode enhances performance at the expense of high availability.</span></span> <span data-ttu-id="041de-126">La modalità a prestazioni elevate utilizza solo il server principale e il server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-126">High-performance mode uses just the principal server and the mirror server.</span></span> <span data-ttu-id="041de-127">I problemi relativi al server mirror non hanno mai alcun impatto sul server principale.</span><span class="sxs-lookup"><span data-stu-id="041de-127">Problems on the mirror server never impact the principal server.</span></span> <span data-ttu-id="041de-128">In caso di perdita del server principale, il database mirror viene contrassegnato come DISCONNECTED, ma rimane disponibile come standby a caldo (warm standby).</span><span class="sxs-lookup"><span data-stu-id="041de-128">On the loss of the principal server, the mirror database is marked DISCONNECTED but is available as a warm standby.</span></span>  
  
 <span data-ttu-id="041de-129">La modalità a prestazioni elevate supporta solo una forma di cambio di ruolo, ovvero il servizio forzato (con possibile perdita dei dati), che prevede l'utilizzo del server mirror come server warm standby.</span><span class="sxs-lookup"><span data-stu-id="041de-129">High-performance mode, supports only one form of role switching: forced service (with possible data loss), which uses the mirror server as a warm standby server.</span></span> <span data-ttu-id="041de-130">Il servizio forzato rappresenta una delle risposte possibili all'errore del server principale.</span><span class="sxs-lookup"><span data-stu-id="041de-130">Forced service is one of the possible responses to the failure of the principal server.</span></span> <span data-ttu-id="041de-131">Poiché può verificarsi una perdita di dati, è consigliabile valutare altre alternative prima di forzare il servizio nel server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-131">Because data loss is possible, you should consider other alternatives before forcing service to the mirror.</span></span> <span data-ttu-id="041de-132">Per ulteriori informazioni, vedere [Risposta agli errori del server principale](#WhenPrincipalFails)più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="041de-132">For more information, see [Responding to Failure of the Principal](#WhenPrincipalFails), later in this topic.</span></span>  
  
 <span data-ttu-id="041de-133">Nella figura seguente viene illustrata la configurazione di una sessione con l'utilizzo della modalità a prestazioni elevate.</span><span class="sxs-lookup"><span data-stu-id="041de-133">The following figure shows the configuration of a session using high-performance mode.</span></span>  
  
 <span data-ttu-id="041de-134">![Configurazione di una sessione per soli partner](../media/dbm-high-performance-mode.gif "Configurazione di una sessione per soli partner")</span><span class="sxs-lookup"><span data-stu-id="041de-134">![Partner-only configuration of a session](../media/dbm-high-performance-mode.gif "Partner-only configuration of a session")</span></span>  
  
 <span data-ttu-id="041de-135">In modalità a prestazioni elevate, non appena il server principale invia il log per una transazione al server mirror, il server principale invia una conferma al client, senza attendere un acknowledgement dal server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-135">In high-performance mode, as soon as the principal server sends the log for a transaction to the mirror server, the principal server sends a confirmation to the client, without waiting for an acknowledgement from the mirror server.</span></span> <span data-ttu-id="041de-136">Il commit delle transazioni viene eseguito senza attendere la scrittura su disco del log da parte del server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-136">Transactions commit without waiting for the mirror server to write the log to disk.</span></span> <span data-ttu-id="041de-137">L'operazione asincrona consente l'esecuzione del server principale con una latenza minima per le transazioni.</span><span class="sxs-lookup"><span data-stu-id="041de-137">Asynchronous operation permits the principal server to run with minimum transaction latency.</span></span>  
  
 <span data-ttu-id="041de-138">Il server mirror tenta di restare sincronizzato con i record del log inviati dal server principale.</span><span class="sxs-lookup"><span data-stu-id="041de-138">The mirror server attempts to keep up with the log records sent by the principal server.</span></span> <span data-ttu-id="041de-139">Il database mirror, tuttavia, è soggetto sempre a un certo ritardo rispetto al database principale. Il divario tra i database è in genere di entità ridotta,</span><span class="sxs-lookup"><span data-stu-id="041de-139">But the mirror database might lag somewhat behind the principal database, though typically the gap between the databases is small.</span></span> <span data-ttu-id="041de-140">ma può diventare significativo se il server principale è soggetto a un ingente carico di lavoro o se il sistema del server mirror è sottoposto a overload.</span><span class="sxs-lookup"><span data-stu-id="041de-140">However, the gap can become substantial if the principal server is under a heavy work load or the system of the mirror server is over loaded.</span></span>  
  
 
  
###  <a name="when-is-high-performance-mode-appropriate"></a><a name="WhenUseHighPerf"></a> <span data-ttu-id="041de-141">Casi in cui la modalità a prestazioni elevate rappresenta la soluzione più appropriata</span><span class="sxs-lookup"><span data-stu-id="041de-141">When Is High-Performance Mode Appropriate?</span></span>  
 <span data-ttu-id="041de-142">La modalità a prestazioni elevate può essere utile in uno scenario di ripristino di emergenza in cui i server principale e mirror sono separati da una distanza significativa e in cui non si desidera che piccoli errori abbiano un impatto sul server principale.</span><span class="sxs-lookup"><span data-stu-id="041de-142">High-performance mode can be useful in a disaster-recovery scenario in which the principal and mirror servers are separated by a significant distance and where you do not want small errors to impact the principal server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="041de-143">Il log shipping può fungere da integrazione al mirroring del database e offre un'alternativa utile al mirroring asincrono.</span><span class="sxs-lookup"><span data-stu-id="041de-143">Log shipping can be a supplement to database mirroring and is a favorable alternative to asynchronous database mirroring.</span></span> <span data-ttu-id="041de-144">Per informazioni sui vantaggi del log shipping, vedere [Soluzioni a disponibilità elevata &#40;SQL Server&#41;](../../sql-server/failover-clusters/high-availability-solutions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="041de-144">For information about the advantages of log shipping, see [High Availability Solutions &#40;SQL Server&#41;](../../sql-server/failover-clusters/high-availability-solutions-sql-server.md).</span></span> <span data-ttu-id="041de-145">Per informazioni sull'uso del log shipping con il mirroring del database, vedere [Mirroring del database e log shipping &#40;SQL Server&#41;](database-mirroring-and-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="041de-145">For information on using log shipping with database mirroring, see [Database Mirroring and Log Shipping &#40;SQL Server&#41;](database-mirroring-and-log-shipping-sql-server.md).</span></span>  
  
###  <a name="the-impact-of-a-witness-on-high-performance-mode"></a><a name="WitnessImpactOnHighPerf"></a> <span data-ttu-id="041de-146">Impatto di un server di controllo del mirroring in modalità a prestazioni elevate</span><span class="sxs-lookup"><span data-stu-id="041de-146">The Impact of a Witness on High-Performance Mode</span></span>  
 <span data-ttu-id="041de-147">Se si utilizza Transact-SQL per configurare la modalità a prestazioni elevate, quando la proprietà SAFETY è impostata su OFF è consigliabile impostare su OFF anche la proprietà WITNESS.</span><span class="sxs-lookup"><span data-stu-id="041de-147">If you use Transact-SQL to configure high-performance mode, whenever the SAFETY property is set to OFF, we strongly recommend that the WITNESS property also be set to OFF.</span></span> <span data-ttu-id="041de-148">Un server di controllo del mirroring può coesistere con la modalità a prestazioni elevate, ma non offre vantaggi e introduce un rischio.</span><span class="sxs-lookup"><span data-stu-id="041de-148">A witness can coexist with high-performance mode, but the witness provides no benefit and introduces risk.</span></span>  
  
 <span data-ttu-id="041de-149">Se il server di controllo del mirroring viene disconnesso dalla sessione quando uno dei partner si arresta, il database non sarà più disponibile.</span><span class="sxs-lookup"><span data-stu-id="041de-149">If the witness is disconnected from the session when either partner goes down, the database becomes unavailable.</span></span> <span data-ttu-id="041de-150">Questo funzionamento dipende dal fatto che, sebbene per la modalità a prestazioni elevate non sia necessario un server di controllo del mirroring, per la sessione è necessario un quorum costituito da due o più istanze del server.</span><span class="sxs-lookup"><span data-stu-id="041de-150">This is because, even though high-performance mode does not require a witness, if one is set, the session requires a quorum consisting of two or more server instances.</span></span> <span data-ttu-id="041de-151">Se la sessione perde il quorum, non può rendere disponibile il database.</span><span class="sxs-lookup"><span data-stu-id="041de-151">If the session losses quorum, it cannot serve the database.</span></span>  
  
 <span data-ttu-id="041de-152">Quando in una sessione in modalità a prestazioni elevate è impostato un server di controllo del mirroring, l'applicazione del quorum comporta quanto segue:</span><span class="sxs-lookup"><span data-stu-id="041de-152">When a witness is set in a high-performance mode session, the enforcement of quorum means that:</span></span>  
  
-   <span data-ttu-id="041de-153">Se il server mirror viene perduto, il server principale deve essere connesso al server di controllo del mirroring.</span><span class="sxs-lookup"><span data-stu-id="041de-153">If the mirror server is lost, the principal server must be connected to the witness.</span></span> <span data-ttu-id="041de-154">In caso contrario, il server principale porta il proprio database offline finché il server di controllo del mirroring o il server mirror non si unisce nuovamente alla sessione.</span><span class="sxs-lookup"><span data-stu-id="041de-154">Otherwise, the principal server takes its database offline until either the witness or mirror server rejoins the session.</span></span>  
  
-   <span data-ttu-id="041de-155">Se il server principale viene perduto, per forzare il servizio sul server mirror è necessario che il server mirror sia connesso al server di controllo del mirroring.</span><span class="sxs-lookup"><span data-stu-id="041de-155">If the principal server is lost, forcing service to the mirror server requires that the mirror server be connected to the witness.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="041de-156">Per informazioni sui tipi di quorum, vedere [Quorum: Impatto di un server di controllo del mirroring sulla disponibilità del database &#40;mirroring del database&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="041de-156">For information about the types of quorums, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
###  <a name="responding-to-failure-of-the-principal"></a><a name="WhenPrincipalFails"></a> <span data-ttu-id="041de-157">Risposta agli errori del server principale</span><span class="sxs-lookup"><span data-stu-id="041de-157">Responding to Failure of the Principal</span></span>  
 <span data-ttu-id="041de-158">Quando si verifica un errore nel server principale, il proprietario del database può scegliere tra le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="041de-158">When the principal fails, the database owner has several choices, as follows:</span></span>  
  
-   <span data-ttu-id="041de-159">Rendere il database non disponibile fino a quando il server principale non torna a essere nuovamente disponibile.</span><span class="sxs-lookup"><span data-stu-id="041de-159">Leave the database unavailable until the principal becomes available again.</span></span>  
  
     <span data-ttu-id="041de-160">Se il database principale e il relativo log delle transazioni sono intatti, questa scelta consente di mantenere tutte le transazioni di cui è stato eseguito il commit, a fronte di una riduzione della disponibilità.</span><span class="sxs-lookup"><span data-stu-id="041de-160">If the principal database and its transaction log are intact, this choice preserves all of the committed transactions at the expense of availability.</span></span>  
  
-   <span data-ttu-id="041de-161">Arrestare la sessione di mirroring del database, aggiornare manualmente il database e quindi avviare una nuova sessione di mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="041de-161">Stop the database mirroring session, manually update the database, and then begin a new database mirroring session.</span></span>  
  
     <span data-ttu-id="041de-162">Se il database principale viene perduto ma il server principale resta in esecuzione, tentare immediatamente di eseguire il backup della parte finale del log nel database principale.</span><span class="sxs-lookup"><span data-stu-id="041de-162">If the principal database is lost but the principal server is still running, immediately attempt to back up the tail of the log on the principal database.</span></span> <span data-ttu-id="041de-163">Se il backup della parte finale del log ha esito positivo, la rimozione del mirroring può rappresentare l'alternativa più efficace.</span><span class="sxs-lookup"><span data-stu-id="041de-163">If the tail-log backup succeeds, removing mirroring may be your best alternative.</span></span> <span data-ttu-id="041de-164">Dopo avere rimosso il mirroring, è possibile ripristinare il log nel database mirror precedente per mantenere tutti i dati.</span><span class="sxs-lookup"><span data-stu-id="041de-164">After removing mirroring, you can restore the log onto the former mirror database, which preserves all of the data.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="041de-165">Se il backup della parte finale del log ha esito negativo e non è possibile attendere il recupero del server principale, valutare la possibilità di forzare il servizio, operazione che consente di mantenere lo stato della sessione.</span><span class="sxs-lookup"><span data-stu-id="041de-165">If the tail-log backup failed and you cannot wait for the principal server to recover, consider forcing service, which has the advantage of maintaining the session state.</span></span>  
  
-   <span data-ttu-id="041de-166">Forzare il servizio (con possibile perdita dei dati) nel server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-166">Force service (with possible data loss) on the mirror server.</span></span>  
  
     <span data-ttu-id="041de-167">Il servizio forzato rappresenta esclusivamente un metodo di ripristino di emergenza e deve essere utilizzato solo se necessario.</span><span class="sxs-lookup"><span data-stu-id="041de-167">Forced service is strictly a disaster recovery method and should be used sparingly.</span></span> <span data-ttu-id="041de-168">È possibile forzare il servizio solo se il server principale non è attivo, la sessione è asincrona (la protezione delle transazioni è impostata su OFF) e non è attivo alcun server di controllo del mirroring (la proprietà WITNESS è impostata su OFF), oppure il server di controllo del mirroring è connesso al server mirror (ovvero è disponibile il quorum).</span><span class="sxs-lookup"><span data-stu-id="041de-168">Forcing service is possible only if the principal server is down, the session is asynchronous (transaction safety is set to OFF), and either the session does not have any witness (the WITNESS property is set to OFF) or the witness is connected to the mirror server (that is, they have quorum).</span></span>  
  
     <span data-ttu-id="041de-169">Forzando il servizio si consente al server mirror di assumere il ruolo di server principale e di rendere disponibile la propria copia del database ai client.</span><span class="sxs-lookup"><span data-stu-id="041de-169">Forcing service causes the mirror server to assume the role of principal and serve its copy of the database for clients.</span></span> <span data-ttu-id="041de-170">Quando il servizio viene forzato, tutti i log delle transazioni non ancora inviati dal server principale al server mirror vengono perduti.</span><span class="sxs-lookup"><span data-stu-id="041de-170">When service is forced, whatever transaction logs the principal has not yet sent to the mirror server are lost.</span></span> <span data-ttu-id="041de-171">È pertanto consigliabile limitare il servizio forzato alle situazioni in cui la perdita dei dati rappresenta un'opzione accettabile e la disponibilità immediata del database è un fattore critico.</span><span class="sxs-lookup"><span data-stu-id="041de-171">Therefore, you should limit forced service to situations where possible data loss is acceptable and immediate database availability is critical.</span></span> <span data-ttu-id="041de-172">Per informazioni sul funzionamento del servizio forzato e sulle procedure di utilizzo consigliate, vedere [Cambio di ruolo durante una sessione di mirroring del database &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="041de-172">For information on how forced service works and on best practices for using it, see [Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span></span>  
  
##  <a name="synchronous-database-mirroring-high-safety-mode"></a><a name="Sync"></a> <span data-ttu-id="041de-173">Mirroring sincrono del database (modalità a sicurezza elevata)</span><span class="sxs-lookup"><span data-stu-id="041de-173">Synchronous Database Mirroring (High-Safety Mode)</span></span>  
 <span data-ttu-id="041de-174">In questa sezione vengono descritti il funzionamento del mirroring del database sincrono e le modalità a protezione elevata alternative (con o senza failover automatico), incluse alcune informazioni sul ruolo del server di controllo del mirroring nel failover automatico.</span><span class="sxs-lookup"><span data-stu-id="041de-174">This section describes how synchronous database mirroring works, including the alternative high-safety modes (with automatic failover and without automatic failover), and contains information about the role of the witness in automatic failover.</span></span>  
  
 <span data-ttu-id="041de-175">Quando il livello di sicurezza delle transazioni viene impostato su FULL, la sessione di mirroring del database viene eseguita in modalità a sicurezza elevata ed opera in modo sincrono dopo una fase di sincronizzazione iniziale.</span><span class="sxs-lookup"><span data-stu-id="041de-175">When transaction safety is set to FULL, the database mirroring session runs in high-safety mode and operates synchronously after an initial synchronizing phase.</span></span> <span data-ttu-id="041de-176">In questa sezione vengono fornite informazioni dettagliate sulle sessioni di mirroring del database configurate per il funzionamento sincrono.</span><span class="sxs-lookup"><span data-stu-id="041de-176">This section describes the details of database mirroring sessions that are configured for synchronous operation.</span></span>  
  
 <span data-ttu-id="041de-177">Per ottenere il funzionamento sincrono per una sessione, è necessario che tramite il server mirror vengano sincronizzati il database mirror e il database principale.</span><span class="sxs-lookup"><span data-stu-id="041de-177">To achieve synchronous operation for a session, the mirror server must synchronize the mirror database with the principal database.</span></span> <span data-ttu-id="041de-178">All'avvio della sessione, il server principale inizia a inviare il proprio log attivo al server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-178">When the session begins, the principal server begins sending its active log to the mirror server.</span></span> <span data-ttu-id="041de-179">Appena possibile, il server mirror scrive sul disco tutti i record di log in ingresso.</span><span class="sxs-lookup"><span data-stu-id="041de-179">The mirror server writes all of the incoming log records to disk as quickly as possible.</span></span> <span data-ttu-id="041de-180">Non appena tutti i record di log ricevuti sono stati scritti su disco, i database vengono sincronizzati.</span><span class="sxs-lookup"><span data-stu-id="041de-180">As soon as all of the received log records have been written to disk, the databases are synchronized.</span></span> <span data-ttu-id="041de-181">I database rimangono sincronizzati fino a quando i partner restano in comunicazione.</span><span class="sxs-lookup"><span data-stu-id="041de-181">As long as the partners remain in communication, the databases remain synchronized.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="041de-182">Per monitorare le modifiche dello stato in una sessione di mirroring del database, utilizzare la classe di evento **Database Mirroring State Change** .</span><span class="sxs-lookup"><span data-stu-id="041de-182">To monitor state changes in a database mirroring session, use the **Database Mirroring State Change** event class.</span></span> <span data-ttu-id="041de-183">Per altre informazioni, vedere [Database Mirroring State Change Event Class](../../relational-databases/event-classes/database-mirroring-state-change-event-class.md).</span><span class="sxs-lookup"><span data-stu-id="041de-183">For more information, see [Database Mirroring State Change Event Class](../../relational-databases/event-classes/database-mirroring-state-change-event-class.md).</span></span>  
  
 <span data-ttu-id="041de-184">Al termine della sincronizzazione, per ogni transazione di cui viene eseguito il commit nel database principale viene eseguito il commit anche nel server mirror, a garanzia della protezione dei dati.</span><span class="sxs-lookup"><span data-stu-id="041de-184">After synchronization finishes, every transaction committed on the principal database is also committed on the mirror server, guaranteeing protection of the data.</span></span> <span data-ttu-id="041de-185">A tale scopo, per l'esecuzione del commit di una transazione nel database principale si attende fino a quando il server principale riceve un messaggio dal server mirror indicante il consolidamento del log della transazione nel disco.</span><span class="sxs-lookup"><span data-stu-id="041de-185">This is achieved by waiting to commit a transaction on the principal database, until the principal server receives a message from the mirror server stating that it has hardened the transaction's log to disk.</span></span> <span data-ttu-id="041de-186">Si noti che l'attesa di tale messaggio comporta un aumento della latenza della transazione.</span><span class="sxs-lookup"><span data-stu-id="041de-186">Note the wait for this message increases the latency of the transaction.</span></span>  
  
 <span data-ttu-id="041de-187">Il tempo necessario per la sincronizzazione dipende essenzialmente dal ritardo del database mirror rispetto al database principale al momento dell'avvio della sessione, misurato in base al numero di record di log ricevuti inizialmente dal server principale, dal carico di lavoro nel database principale e dalla velocità del sistema mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-187">The time required for synchronization depends essentially on how far the mirror database was behind the principal database at the start of the session (measured by the number of log records initially received from the principal server), the work load on the principal database, and the speed of the mirror system.</span></span> <span data-ttu-id="041de-188">Dopo la sincronizzazione di una sessione, il log consolidato del quale deve ancora essere eseguito il rollforward nel database mirror rimane nella coda di rollforward.</span><span class="sxs-lookup"><span data-stu-id="041de-188">After a session is synchronized, the hardened log that has yet to be redone on the mirror database remains in the redo queue.</span></span>  
  
 <span data-ttu-id="041de-189">Non appena il database mirror è sincronizzato, lo stato di entrambe le copie del database viene impostato come SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="041de-189">As soon as the mirror database becomes synchronized, the state of both the copies of the database changes to SYNCHRONIZED.</span></span>  
  
 <span data-ttu-id="041de-190">Il funzionamento sincrono viene mantenuto nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="041de-190">Synchronous operation is maintained in the following manner:</span></span>  
  
1.  <span data-ttu-id="041de-191">Quando riceve una transazione da un client, il server principale scrive il log per la transazione nel log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="041de-191">On receiving a transaction from a client, the principal server writes the log for the transaction to the transaction log.</span></span>  
  
2.  <span data-ttu-id="041de-192">Il server principale scrive la transazione nel database e, contemporaneamente, invia il record di log al server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-192">The principal server writes the transaction to the database and, concurrently, sends the log record to the mirror server.</span></span> <span data-ttu-id="041de-193">Il server principale attende un acknowledgement dal server mirror prima di confermare al client il commit o il rollback di una transazione.</span><span class="sxs-lookup"><span data-stu-id="041de-193">The principal server waits for an acknowledgement from the mirror server before confirming either of the following to the client: a transaction commit or a rollback.</span></span>  
  
3.  <span data-ttu-id="041de-194">Il server mirror consolida il log nel disco e restituisce un acknowledgement al server principale.</span><span class="sxs-lookup"><span data-stu-id="041de-194">The mirror server hardens the log to disk and returns an acknowledgement to the principal server.</span></span>  
  
4.  <span data-ttu-id="041de-195">Quando riceve l'acknowledgement dal server mirror, il server principale invia un messaggio di conferma al client.</span><span class="sxs-lookup"><span data-stu-id="041de-195">On receiving the acknowledgement from the mirror server, the principal server sends a confirmation message to the client.</span></span>  
  
 <span data-ttu-id="041de-196">La modalità a sicurezza elevata consente di proteggere i dati tramite la richiesta di sincronizzazione tra due posizioni.</span><span class="sxs-lookup"><span data-stu-id="041de-196">High-safety mode protects your data by requiring the data to be synchronized between two places.</span></span> <span data-ttu-id="041de-197">Tutte le transazioni di cui è stato eseguito il commit vengono scritte nel disco del server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-197">All the committed transactions are guaranteed to be written to disk on the mirror server.</span></span>  
  

  
###  <a name="high-safety-mode-without-automatic-failover"></a><a name="HighSafetyWithOutAutoFailover"></a> <span data-ttu-id="041de-198">Modalità a sicurezza elevata senza failover automatico</span><span class="sxs-lookup"><span data-stu-id="041de-198">High-Safety Mode Without Automatic Failover</span></span>  
 <span data-ttu-id="041de-199">Nella figura seguente viene illustrata la configurazione della modalità a sicurezza elevata senza failover automatico.</span><span class="sxs-lookup"><span data-stu-id="041de-199">The following figure shows the configuration of high-safety mode without automatic failover.</span></span> <span data-ttu-id="041de-200">La configurazione è composta solo dai due partner.</span><span class="sxs-lookup"><span data-stu-id="041de-200">The configuration consists of only the two partners.</span></span>  
  
 <span data-ttu-id="041de-201">![Comunicazioni tra i partner senza un server di controllo del mirroring](../media/dbm-high-protection-mode.gif "Comunicazioni tra i partner senza un server di controllo del mirroring")</span><span class="sxs-lookup"><span data-stu-id="041de-201">![Partners communicating without a witness](../media/dbm-high-protection-mode.gif "Partners communicating without a witness")</span></span>  
  
 <span data-ttu-id="041de-202">Se i partner sono connessi e il database è già sincronizzato, è supportato il failover manuale.</span><span class="sxs-lookup"><span data-stu-id="041de-202">When the partners are connected and the database is already synchronized, manual failover is supported.</span></span> <span data-ttu-id="041de-203">Se l'istanza del server mirror si arresta, l'istanza del server principale non ne risentirà e verrà eseguita esposta, ovvero senza mirroring dei dati.</span><span class="sxs-lookup"><span data-stu-id="041de-203">If the mirror server instance goes down, the principal server instance is unaffected and runs exposed (that is without mirroring the data).</span></span> <span data-ttu-id="041de-204">Se il server principale viene perso, il mirroring viene sospeso, ma è possibile forzare manualmente il servizio nel server mirror, con possibile perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="041de-204">If the principal server is lost, the mirror is suspended, but service can be forced to the mirror server (with possible data loss).</span></span> <span data-ttu-id="041de-205">Per altre informazioni, vedere [Cambio di ruolo durante una sessione di mirroring del database &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md)(Mirroring del database e log shipping).</span><span class="sxs-lookup"><span data-stu-id="041de-205">For more information, see [Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span></span>  
  
###  <a name="high-safety-mode-with-automatic-failover"></a><a name="HighSafetyWithAutoFailover"></a> <span data-ttu-id="041de-206">Modalità a sicurezza elevata con failover automatico</span><span class="sxs-lookup"><span data-stu-id="041de-206">High-Safety Mode with Automatic Failover</span></span>  
 <span data-ttu-id="041de-207">Il failover automatico garantisce disponibilità elevata assicurando il servizio al database anche nel caso di perdita di un server.</span><span class="sxs-lookup"><span data-stu-id="041de-207">Automatic failover provides high availability by ensuring that the database is still served after the loss of one server.</span></span> <span data-ttu-id="041de-208">Per il failover automatico è necessario che la sessione disponga di una terza istanza del server, il *server di controllo del mirroring*, che idealmente dovrebbe trovarsi in un terzo computer.</span><span class="sxs-lookup"><span data-stu-id="041de-208">Automatic failover requires that the session possess a third server instance, the *witness*, which ideally resides on a third computer.</span></span> <span data-ttu-id="041de-209">Nella figura seguente viene illustrata la configurazione di una sessione in modalità a sicurezza elevata che supporta il failover automatico.</span><span class="sxs-lookup"><span data-stu-id="041de-209">The following figure shows the configuration of a high-safety mode session that supports automatic failover.</span></span>  
  
 <span data-ttu-id="041de-210">![Server di controllo del mirroring e due partner di una sessione](../media/dbm-high-availability-mode.gif "Server di controllo del mirroring e due partner di una sessione")</span><span class="sxs-lookup"><span data-stu-id="041de-210">![The witness and two partners of a session](../media/dbm-high-availability-mode.gif "The witness and two partners of a session")</span></span>  
  
 <span data-ttu-id="041de-211">A differenza dei due partner, il server di controllo del mirroring non serve il database,</span><span class="sxs-lookup"><span data-stu-id="041de-211">Unlike the two partners, the witness does not serve the database.</span></span> <span data-ttu-id="041de-212">ma supporta semplicemente il failover automatico mediante la verifica dell'efficienza del server principale.</span><span class="sxs-lookup"><span data-stu-id="041de-212">The witness simply supports automatic failover by verifying whether the principal server is up and functioning.</span></span> <span data-ttu-id="041de-213">Il server mirror avvia il failover automatico solo se il server mirror e il server di controllo del mirroring rimangono connessi tra loro dopo la disconnessione di entrambi dal server principale.</span><span class="sxs-lookup"><span data-stu-id="041de-213">The mirror server initiates automatic failover only if the mirror and the witness remain connected to each other after both have been disconnected from the principal server.</span></span>  
  
 <span data-ttu-id="041de-214">Quando viene impostato un server di controllo del mirroring, la sessione richiede il *quorum*, una relazione tra un minimo di due istanze del server che consente di rendere disponibile il database.</span><span class="sxs-lookup"><span data-stu-id="041de-214">When a witness is set, the session requires *quorum*-a relationship between at least two server instances that allows the database to be made available.</span></span> <span data-ttu-id="041de-215">Per altre informazioni, vedere [Server di controllo del mirroring del database](database-mirroring-witness.md) e [Quorum: Impatto di un server di controllo del mirroring sulla disponibilità del database &#40;mirroring del database&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="041de-215">For more information, see [Database Mirroring Witness](database-mirroring-witness.md) and [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
 <span data-ttu-id="041de-216">Per l'esecuzione del failover automatico è necessario che si verifichino le condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="041de-216">Automatic failover requires the following conditions:</span></span>  
  
-   <span data-ttu-id="041de-217">Il database è già sincronizzato.</span><span class="sxs-lookup"><span data-stu-id="041de-217">The database is already synchronized.</span></span>  
  
-   <span data-ttu-id="041de-218">L'errore si verifica mentre tutte e tre le istanze del server sono connesse e il server di controllo del mirroring rimane connesso al server mirror.</span><span class="sxs-lookup"><span data-stu-id="041de-218">The failure occurs while all three server instances are connected, and the witness and mirror server remain connected.</span></span>  
  
 <span data-ttu-id="041de-219">La perdita di un partner produce l'effetto seguente:</span><span class="sxs-lookup"><span data-stu-id="041de-219">The loss of a partner has the following effect:</span></span>  
  
-   <span data-ttu-id="041de-220">Se il server principale non è più disponibile in base alle condizioni precedenti, si verifica il failover automatico.</span><span class="sxs-lookup"><span data-stu-id="041de-220">If the principal server becomes unavailable under the above conditions, automatic failover occurs.</span></span> <span data-ttu-id="041de-221">Il server mirror assume il ruolo di server principale e il relativo database diventa il database principale.</span><span class="sxs-lookup"><span data-stu-id="041de-221">The mirror server switches to the role of principal, and it offers its database as the principal database.</span></span>  
  
-   <span data-ttu-id="041de-222">Se il server principale diventa non disponibile quando queste condizioni non sono soddisfatte, si potrebbe riuscire a forzare il servizio, con una possibile perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="041de-222">If the principal server becomes unavailable when those conditions are not met, forcing service (with possible data loss) might be possible.</span></span> <span data-ttu-id="041de-223">Per altre informazioni, vedere [Cambio di ruolo durante una sessione di mirroring del database &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md)(Mirroring del database e log shipping).</span><span class="sxs-lookup"><span data-stu-id="041de-223">For more information, see [Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span></span>  
  
-   <span data-ttu-id="041de-224">Se solo il server mirror non è più disponibile, le attività nel server principale e nel server di controllo del mirroring continueranno.</span><span class="sxs-lookup"><span data-stu-id="041de-224">If the only mirror server becomes unavailable, the principal and witness continue.</span></span>  
  
 <span data-ttu-id="041de-225">Se la sessione perde il relativo server di controllo del mirroring, per il quorum sono necessari entrambi i partner.</span><span class="sxs-lookup"><span data-stu-id="041de-225">If the session loses its witness, quorum requires both partners.</span></span> <span data-ttu-id="041de-226">Se uno dei partner perde il quorum, entrambi lo perdono e il database diventa non disponibile finché il quorum non viene ristabilito.</span><span class="sxs-lookup"><span data-stu-id="041de-226">If either partner loses quorum, both partners lose quorum, and the database becomes unavailable until quorum is re-established.</span></span> <span data-ttu-id="041de-227">Questo requisito di quorum garantisce che in assenza un server di controllo del mirroring il database non venga mai eseguito *senza mirroring*.</span><span class="sxs-lookup"><span data-stu-id="041de-227">This quorum requirement makes sure that in the absence of a witness the database never runs *exposed*, that is without being mirrored.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="041de-228">Se si prevede che il server di controllo del mirroring resterà disconnesso per un periodo di tempo prolungato, è consigliabile rimuoverlo dalla sessione finché non diventa disponibile.</span><span class="sxs-lookup"><span data-stu-id="041de-228">If you expect the witness to remain disconnected for a significant amount of time, we recommend that you remove the witness from the session until it becomes available.</span></span>  
  
##  <a name="transact-sql-settings-and-database-mirroring-operating-modes"></a><a name="TsqlSettingsAndOpModes"></a> <span data-ttu-id="041de-229">Impostazioni di Transact-SQL e modalità operative del mirroring del database</span><span class="sxs-lookup"><span data-stu-id="041de-229">Transact-SQL Settings and Database Mirroring Operating Modes</span></span>  
 <span data-ttu-id="041de-230">In questa sezione viene descritta una sessione di mirroring del database in termini di impostazioni ALTER DATABASE e degli stati del database con mirroring e del server di controllo del mirroring, se presente.</span><span class="sxs-lookup"><span data-stu-id="041de-230">This section describes a database mirroring session in terms of the ALTER DATABASE settings and states of the mirrored database and witness, if any.</span></span> <span data-ttu-id="041de-231">Le informazioni di questa sezione sono rivolte agli utenti che gestiscono il mirroring del database utilizzando principalmente o esclusivamente [!INCLUDE[tsql](../../includes/tsql-md.md)]anziché [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="041de-231">The section is aimed at users who manage database mirroring primarily or exclusively using [!INCLUDE[tsql](../../includes/tsql-md.md)], rather than using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="041de-232">In alternativa a [!INCLUDE[tsql](../../includes/tsql-md.md)], è possibile controllare la modalità operativa di una sessione in Esplora oggetti mediante la pagina **Mirroring** della finestra di dialogo **Proprietà database** .</span><span class="sxs-lookup"><span data-stu-id="041de-232">As an alternative to using [!INCLUDE[tsql](../../includes/tsql-md.md)], you can control the operating mode of a session in Object Explorer using the **Mirroring** page of the **Database Properties** dialog box.</span></span> <span data-ttu-id="041de-233">Per altre informazioni, vedere [Stabilire una sessione di mirroring del database tramite autenticazione di Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="041de-233">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span></span>  
  

  
###  <a name="how-transaction-safety-and-witness-state-affect-the-operating-mode"></a><a name="TxnSafetyAndWitness"></a> <span data-ttu-id="041de-234">Effetti della sicurezza delle transazioni e dello stato del server di controllo del mirroring sulla modalità operativa</span><span class="sxs-lookup"><span data-stu-id="041de-234">How Transaction Safety and Witness State Affect the Operating Mode</span></span>  
 <span data-ttu-id="041de-235">La modalità operativa di una sessione è determinata dalla combinazione dell'impostazione del livello di protezione delle transazioni e dello stato del server di controllo del mirroring.</span><span class="sxs-lookup"><span data-stu-id="041de-235">The operating mode of a session is determined by the combination of its transaction safety setting and the state of the witness.</span></span> <span data-ttu-id="041de-236">In qualsiasi momento, il proprietario del database può modificare il livello di sicurezza delle transazioni e aggiungere o rimuovere il server di controllo del mirroring.</span><span class="sxs-lookup"><span data-stu-id="041de-236">At any time, the database owner can change the transaction safety level, and can add or remove the witness.</span></span>  
  

  
####  <a name="transaction-safety"></a><a name="TxnSafety"></a> <span data-ttu-id="041de-237">Transaction Safety</span><span class="sxs-lookup"><span data-stu-id="041de-237">Transaction Safety</span></span>  
 <span data-ttu-id="041de-238">Il livello di sicurezza delle transazioni è una proprietà del database specifica del mirroring che determina l'esecuzione della sessione di mirroring del database in modalità sincrona o asincrona.</span><span class="sxs-lookup"><span data-stu-id="041de-238">Transaction safety is a mirroring-specific database property that determines whether a database mirroring session operates synchronously or asynchronously.</span></span> <span data-ttu-id="041de-239">Esistono due livelli di sicurezza: FULL e OFF.</span><span class="sxs-lookup"><span data-stu-id="041de-239">There are two safety levels: FULL and OFF.</span></span>  
  
-   <span data-ttu-id="041de-240">SAFETY FULL</span><span class="sxs-lookup"><span data-stu-id="041de-240">SAFETY FULL</span></span>  
  
     <span data-ttu-id="041de-241">Il livello di sicurezza delle transazioni completo determina l'esecuzione della sessione in modo sincrono in modalità a sicurezza elevata.</span><span class="sxs-lookup"><span data-stu-id="041de-241">Full transaction safety causes the session to operate synchronously in high-safety mode.</span></span> <span data-ttu-id="041de-242">Se è presente un server di controllo del mirroring, una sessione supporta il failover automatico.</span><span class="sxs-lookup"><span data-stu-id="041de-242">If a witness is present, a session supports automatic failover.</span></span>  
  
     <span data-ttu-id="041de-243">Quando si stabilisce una sessione utilizzando le istruzioni ALTER DATABASE, tale sessione inizia con la proprietà SAFETY impostata su FULL, ovvero in modalità a sicurezza elevata.</span><span class="sxs-lookup"><span data-stu-id="041de-243">When you establish a session using ALTER DATABASE statements, the session begins with the SAFETY property set to FULL; that is, the session begins in high-safety mode.</span></span> <span data-ttu-id="041de-244">Dopo l'inizio della sessione, è possibile aggiungere un server di controllo del mirroring.</span><span class="sxs-lookup"><span data-stu-id="041de-244">After the session begins, you can add a witness.</span></span>  
  
     <span data-ttu-id="041de-245">Per altre informazioni, vedere [Mirroring sincrono del database (modalità a sicurezza elevata)](#Sync), più indietro in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="041de-245">For more information, see [Synchronous Database Mirroring (High-Safety Mode)](#Sync), earlier in this topic.</span></span>  
  
-   <span data-ttu-id="041de-246">SAFETY OFF</span><span class="sxs-lookup"><span data-stu-id="041de-246">SAFETY OFF</span></span>  
  
     <span data-ttu-id="041de-247">La disabilitazione della sicurezza delle transazioni determina l'esecuzione della sessione in modalità asincrona a prestazioni elevate.</span><span class="sxs-lookup"><span data-stu-id="041de-247">Turning off transaction safety causes the session to operate asynchronously, in high-performance mode.</span></span> <span data-ttu-id="041de-248">Se la proprietà SAFETY è impostata su OFF, è necessario impostare sul valore predefinito OFF anche la proprietà WITNESS.</span><span class="sxs-lookup"><span data-stu-id="041de-248">If the SAFETY property is set to OFF, the WITNESS property should also be set to OFF (the default).</span></span> <span data-ttu-id="041de-249">Per informazioni sull'effetto del server di controllo del mirroring in modalità a prestazioni elevate, vedere [Stato del server di controllo del mirroring](#WitnessState), più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="041de-249">For information about the impact of the witness in high-performance mode, see [The State of the Witness](#WitnessState), later in this topic.</span></span> <span data-ttu-id="041de-250">Per informazioni sull'esecuzione con la sicurezza delle transizioni disabilitata, vedere [Mirroring asincrono del database (modalità a prestazioni elevate)](#VisualElement), più indietro in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="041de-250">For more information about running with transaction safety turned off, see [Asynchronous Database Mirroring (High-Performance Mode)](#VisualElement), earlier in this topic.</span></span>  
  
 <span data-ttu-id="041de-251">L'impostazione della sicurezza delle transazioni per il database viene registrata per ogni partner nelle colonne **mirroring_safety_level** e **mirroring_safety_level_desc** della vista del catalogo **sys.database_mirroring**.</span><span class="sxs-lookup"><span data-stu-id="041de-251">The transaction safety setting of the database is recorded on each partner in the **sys.database_mirroring** catalog view in the **mirroring_safety_level** and **mirroring_safety_level_desc** columns.</span></span> <span data-ttu-id="041de-252">Per altre informazioni, vedere [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="041de-252">For more information, see [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
 <span data-ttu-id="041de-253">Il proprietario del database può modificare il livello di sicurezza delle transazioni in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="041de-253">The database owner can change the transaction safety level at any time.</span></span>  
  
####  <a name="the-state-of-the-witness"></a><a name="WitnessState"></a> <span data-ttu-id="041de-254">Stato del server di controllo del mirroring</span><span class="sxs-lookup"><span data-stu-id="041de-254">The State of the Witness</span></span>  
 <span data-ttu-id="041de-255">Se è stato impostato un server di controllo del mirroring, il quorum è necessario e pertanto lo stato di tale server è sempre significativo.</span><span class="sxs-lookup"><span data-stu-id="041de-255">If a witness has been set, quorum is required, so the state of the witness is always significant.</span></span>  
  
 <span data-ttu-id="041de-256">Se è disponibile, il server di controllo del mirroring dispone di due stati:</span><span class="sxs-lookup"><span data-stu-id="041de-256">If it exists, the witness has one of two states:</span></span>  
  
-   <span data-ttu-id="041de-257">Quando è connesso a un partner, il server di controllo del mirroring si trova nello stato CONNECTED in relazione a tale partner e dispone del quorum con quest'ultimo.</span><span class="sxs-lookup"><span data-stu-id="041de-257">When the witness is connected to a partner, the witness is in the CONNECTED state relative to that partner and has quorum with that partner.</span></span> <span data-ttu-id="041de-258">In questo caso, è possibile rendere disponibile il database, anche se uno dei partner non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="041de-258">In this case, the database can be made available, even if one of the partners is unavailable.</span></span>  
  
-   <span data-ttu-id="041de-259">Quando è disponibile ma non è connesso a un partner, il server di controllo del mirroring si trova nello stato UNKNOWN o DISCONNECTED in relazione a tale partner.</span><span class="sxs-lookup"><span data-stu-id="041de-259">When the witness exists but is not connected to a partner, the witness is in the UNKOWN or DISCONNECTED state relative to that partner.</span></span> <span data-ttu-id="041de-260">In questo caso, il server di controllo del mirroring non dispone del quorum con tale partner e, se i partner non sono connessi tra loro, il database non sarà più disponibile.</span><span class="sxs-lookup"><span data-stu-id="041de-260">In this case, the witness lacks quorum with that partner, and if the partners are not connected to each other, the database becomes unavailable.</span></span>  
  
 <span data-ttu-id="041de-261">Per altre informazioni sul quorum, vedere [Quorum: Impatto di un server di controllo del mirroring sulla disponibilità del database &#40;mirroring del database&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="041de-261">For information about quorum, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
 <span data-ttu-id="041de-262">Lo stato di ogni server di controllo del mirroring in un'istanza del server viene registrato nelle colonne **mirroring_witness_state** e **mirroring_witness_state_desc** della vista del catalogo **sys.database_mirroring**.</span><span class="sxs-lookup"><span data-stu-id="041de-262">The state of each witness on a server instance is recorded in the **sys.database_mirroring** catalog view in the **mirroring_witness_state** and **mirroring_witness_state_desc** columns.</span></span> <span data-ttu-id="041de-263">Per altre informazioni, vedere [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="041de-263">For more information, see [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
 <span data-ttu-id="041de-264">Nella tabella seguente sono riepilogati gli effetti dell'impostazione della protezione delle transazioni e dello stato del server di controllo del mirroring sulla modalità operativa di una sessione.</span><span class="sxs-lookup"><span data-stu-id="041de-264">The following table summarizes how the operating mode of a session depends upon its transaction safety setting and on state of the witness.</span></span>  
  
|<span data-ttu-id="041de-265">Modalità operativa</span><span class="sxs-lookup"><span data-stu-id="041de-265">Operating mode</span></span>|<span data-ttu-id="041de-266">Livello di sicurezza delle transazioni</span><span class="sxs-lookup"><span data-stu-id="041de-266">Transaction safety</span></span>|<span data-ttu-id="041de-267">Stato del server di controllo del mirroring</span><span class="sxs-lookup"><span data-stu-id="041de-267">Witness state</span></span>|  
|--------------------|------------------------|-------------------|  
|<span data-ttu-id="041de-268">Modalità a prestazioni elevate</span><span class="sxs-lookup"><span data-stu-id="041de-268">High-performance mode</span></span>|<span data-ttu-id="041de-269">OFF</span><span class="sxs-lookup"><span data-stu-id="041de-269">OFF</span></span>|<span data-ttu-id="041de-270">NULL (nessun server di controllo del mirroring)<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="041de-270">NULL (no witness)<sup>2</sup></span></span>|  
|<span data-ttu-id="041de-271">Modalità a sicurezza elevata senza failover automatico</span><span class="sxs-lookup"><span data-stu-id="041de-271">High-safety mode without automatic failover</span></span>|<span data-ttu-id="041de-272">FULL</span><span class="sxs-lookup"><span data-stu-id="041de-272">FULL</span></span>|<span data-ttu-id="041de-273">NULL (nessun server di controllo del mirroring)</span><span class="sxs-lookup"><span data-stu-id="041de-273">NULL (no witness)</span></span>|  
|<span data-ttu-id="041de-274">Modalità a sicurezza elevata con failover automatico<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="041de-274">High-safety mode with automatic failover<sup>1</sup></span></span>|<span data-ttu-id="041de-275">FULL</span><span class="sxs-lookup"><span data-stu-id="041de-275">FULL</span></span>|<span data-ttu-id="041de-276">CONNECTED</span><span class="sxs-lookup"><span data-stu-id="041de-276">CONNECTED</span></span>|  
  
 <span data-ttu-id="041de-277"><sup>1</sup> se il server di controllo del mirroring viene disconnesso, è consigliabile impostare Witness off finché l'istanza del server di controllo del mirroring non sarà disponibile.</span><span class="sxs-lookup"><span data-stu-id="041de-277"><sup>1</sup> If the witness becomes disconnected, we recommend that you set WITNESS OFF until the witness server instance becomes available.</span></span>  
  
 <span data-ttu-id="041de-278"><sup>2</sup> se un server di controllo del mirroring è presente in modalità a prestazioni elevate, il server di controllo del mirroring non partecipa alla sessione.</span><span class="sxs-lookup"><span data-stu-id="041de-278"><sup>2</sup> If a witness is present in high-performance mode, the witness does not participate in the session.</span></span> <span data-ttu-id="041de-279">Tuttavia, per rendere disponibile il database, è necessario che almeno due istanze del server rimangano connesse.</span><span class="sxs-lookup"><span data-stu-id="041de-279">However, to make the database available, at least two of the server instances must remain connected.</span></span> <span data-ttu-id="041de-280">È pertanto consigliabile mantenere la proprietà WITNESS impostata su OFF nelle sessioni in modalità a prestazioni elevate.</span><span class="sxs-lookup"><span data-stu-id="041de-280">Therefore, we recommend keeping the WITNESS property set to OFF in high-performance mode sessions.</span></span> <span data-ttu-id="041de-281">Per altre informazioni, vedere [Quorum: Impatto di un server di controllo del mirroring sulla disponibilità del database &#40;mirroring del database&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="041de-281">For more information, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
###  <a name="viewing-the-safety-setting-and-state-of-the-witness"></a><a name="ViewWitness"></a> <span data-ttu-id="041de-282">Visualizzazione dell'impostazione di sicurezza e dello stato del server di controllo del mirroring</span><span class="sxs-lookup"><span data-stu-id="041de-282">Viewing the Safety Setting and State of the Witness</span></span>  
 <span data-ttu-id="041de-283">Per visualizzare l'impostazione di sicurezza e lo stato del server di controllo del mirroring per un database, usare la vista del catalogo **sys.database_mirroring** .</span><span class="sxs-lookup"><span data-stu-id="041de-283">To view the safety setting and the state of the witness for a database, use the **sys.database_mirroring** catalog view.</span></span> <span data-ttu-id="041de-284">Le colonne rilevanti sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="041de-284">The relevant columns are as follows:</span></span>  
  
|<span data-ttu-id="041de-285">Fattore</span><span class="sxs-lookup"><span data-stu-id="041de-285">Factor</span></span>|<span data-ttu-id="041de-286">Colonne</span><span class="sxs-lookup"><span data-stu-id="041de-286">Columns</span></span>|<span data-ttu-id="041de-287">Descrizione</span><span class="sxs-lookup"><span data-stu-id="041de-287">Description</span></span>|  
|------------|-------------|-----------------|  
|<span data-ttu-id="041de-288">Livello di sicurezza delle transazioni</span><span class="sxs-lookup"><span data-stu-id="041de-288">Transaction safety</span></span>|<span data-ttu-id="041de-289">**mirroring_safety_level** o **mirroring_safety_level_desc**</span><span class="sxs-lookup"><span data-stu-id="041de-289">**mirroring_safety_level** or **mirroring_safety_level_desc**</span></span>|<span data-ttu-id="041de-290">Impostazione del livello di protezione delle transazioni per gli aggiornamenti nel database mirror, scelta tra le seguenti:</span><span class="sxs-lookup"><span data-stu-id="041de-290">Transaction safety setting for updates on the mirror database, one of:</span></span><br /><br /> <span data-ttu-id="041de-291">UNKNOWN</span><span class="sxs-lookup"><span data-stu-id="041de-291">UNKNOWN</span></span><br /><br /> <span data-ttu-id="041de-292">OFF</span><span class="sxs-lookup"><span data-stu-id="041de-292">OFF</span></span><br /><br /> <span data-ttu-id="041de-293">FULL</span><span class="sxs-lookup"><span data-stu-id="041de-293">FULL</span></span><br /><br /> <span data-ttu-id="041de-294">NULL = database non online</span><span class="sxs-lookup"><span data-stu-id="041de-294">NULL= database is not online.</span></span>|  
|<span data-ttu-id="041de-295">Disponibilità di un server di controllo del mirroring</span><span class="sxs-lookup"><span data-stu-id="041de-295">Does a witness exist?</span></span>|<span data-ttu-id="041de-296">**mirroring_witness_name**</span><span class="sxs-lookup"><span data-stu-id="041de-296">**mirroring_witness_name**</span></span>|<span data-ttu-id="041de-297">Nome del server di controllo del mirroring del database o valore NULL se tale server non esiste.</span><span class="sxs-lookup"><span data-stu-id="041de-297">Server name of the database mirroring witness or NULL, indicating that no witness exists.</span></span>|  
|<span data-ttu-id="041de-298">Stato del server di controllo del mirroring</span><span class="sxs-lookup"><span data-stu-id="041de-298">Witness state</span></span>|<span data-ttu-id="041de-299">**mirroring_witness_state** o **mirroring_witness_state_desc**</span><span class="sxs-lookup"><span data-stu-id="041de-299">**mirroring_witness_state** or **mirroring_witness_state_desc**</span></span>|<span data-ttu-id="041de-300">Stato del server di controllo del mirroring nel database di un determinato partner:</span><span class="sxs-lookup"><span data-stu-id="041de-300">State of the witness in the database on a given partner:</span></span><br /><br /> <span data-ttu-id="041de-301">UNKNOWN</span><span class="sxs-lookup"><span data-stu-id="041de-301">UNKNOWN</span></span><br /><br /> <span data-ttu-id="041de-302">CONNECTED</span><span class="sxs-lookup"><span data-stu-id="041de-302">CONNECTED</span></span><br /><br /> <span data-ttu-id="041de-303">DISCONNECTED</span><span class="sxs-lookup"><span data-stu-id="041de-303">DISCONNECTED</span></span><br /><br /> <span data-ttu-id="041de-304">NULL = server di controllo del mirroring non disponibile o database non online</span><span class="sxs-lookup"><span data-stu-id="041de-304">NULL = no witness exists or the database is not online.</span></span>|  
  
 <span data-ttu-id="041de-305">Nel server principale o nel server mirror, ad esempio, immettere:</span><span class="sxs-lookup"><span data-stu-id="041de-305">For example, on either the principal or mirror server, enter:</span></span>  
  
```  
SELECT mirroring_safety_level_desc, mirroring_witness_name, mirroring_witness_state_desc FROM sys.database_mirroring  
```  
  
 <span data-ttu-id="041de-306">Per altre informazioni su questa vista del catalogo, vedere [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="041de-306">For more information about this catalog view, see [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
###  <a name="factors-affecting-behavior-on-loss-of-the-principal-server"></a><a name="FactorsOnLossOfPrincipal"></a> <span data-ttu-id="041de-307">Fattori che influiscono sul funzionamento della sessione in caso di perdita del server principale</span><span class="sxs-lookup"><span data-stu-id="041de-307">Factors Affecting Behavior on Loss of the Principal Server</span></span>  
 <span data-ttu-id="041de-308">Nella tabella seguente sono riepilogati gli effetti combinati dell'impostazione del livello di protezione delle transazioni, dello stato del database e dello stato del server di controllo del mirroring sul funzionamento di una sessione di mirroring in caso di perdita del server principale.</span><span class="sxs-lookup"><span data-stu-id="041de-308">The following table summarizes the combined effect of the transaction safety setting, the state of the database, and the state of the witness on the behavior of a mirroring session on the loss of the principal server.</span></span>  
  
|<span data-ttu-id="041de-309">Livello di sicurezza delle transazioni</span><span class="sxs-lookup"><span data-stu-id="041de-309">Transaction safety</span></span>|<span data-ttu-id="041de-310">Stato di mirroring del database mirror</span><span class="sxs-lookup"><span data-stu-id="041de-310">Mirroring state of mirror database</span></span>|<span data-ttu-id="041de-311">Stato del server di controllo del mirroring</span><span class="sxs-lookup"><span data-stu-id="041de-311">Witness state</span></span>|<span data-ttu-id="041de-312">Funzionamento in caso di perdita del server principale</span><span class="sxs-lookup"><span data-stu-id="041de-312">Behavior when principal is lost</span></span>|  
|------------------------|----------------------------------------|-------------------|-------------------------------------|  
|<span data-ttu-id="041de-313">FULL</span><span class="sxs-lookup"><span data-stu-id="041de-313">FULL</span></span>|<span data-ttu-id="041de-314">SYNCHRONIZED</span><span class="sxs-lookup"><span data-stu-id="041de-314">SYNCHRONIZED</span></span>|<span data-ttu-id="041de-315">CONNECTED</span><span class="sxs-lookup"><span data-stu-id="041de-315">CONNECTED</span></span>|<span data-ttu-id="041de-316">Si verifica il failover automatico.</span><span class="sxs-lookup"><span data-stu-id="041de-316">Automatic failover occurs.</span></span>|  
|<span data-ttu-id="041de-317">FULL</span><span class="sxs-lookup"><span data-stu-id="041de-317">FULL</span></span>|<span data-ttu-id="041de-318">SYNCHRONIZED</span><span class="sxs-lookup"><span data-stu-id="041de-318">SYNCHRONIZED</span></span>|<span data-ttu-id="041de-319">DISCONNECTED</span><span class="sxs-lookup"><span data-stu-id="041de-319">DISCONNECTED</span></span>|<span data-ttu-id="041de-320">Il server mirror si arresta. Non è possibile eseguire il failover né rendere disponibile il database.</span><span class="sxs-lookup"><span data-stu-id="041de-320">Mirror server stops; failover is not possible, and the database cannot be made available.</span></span>|  
|<span data-ttu-id="041de-321">OFF</span><span class="sxs-lookup"><span data-stu-id="041de-321">OFF</span></span>|<span data-ttu-id="041de-322">SUSPENDED o DISCONNECTED</span><span class="sxs-lookup"><span data-stu-id="041de-322">SUSPENDED or DISCONNECTED</span></span>|<span data-ttu-id="041de-323">NULL (nessun server di controllo del mirroring)</span><span class="sxs-lookup"><span data-stu-id="041de-323">NULL (no witness)</span></span>|<span data-ttu-id="041de-324">È possibile forzare il servizio nel server mirror ma potrebbe verificarsi perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="041de-324">Service can be forced to the mirror server (with possible data loss).</span></span>|  
|<span data-ttu-id="041de-325">FULL</span><span class="sxs-lookup"><span data-stu-id="041de-325">FULL</span></span>|<span data-ttu-id="041de-326">SYNCHRONIZING o SUSPENDED</span><span class="sxs-lookup"><span data-stu-id="041de-326">SYNCHRONIZING or SUSPENDED</span></span>|<span data-ttu-id="041de-327">NULL (nessun server di controllo del mirroring)</span><span class="sxs-lookup"><span data-stu-id="041de-327">NULL (no witness)</span></span>|<span data-ttu-id="041de-328">È possibile forzare il servizio nel server mirror ma potrebbe verificarsi perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="041de-328">Service can be forced to the mirror server (with possible data loss).</span></span>|  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="041de-329">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="041de-329">Related Tasks</span></span>  
  
-   [<span data-ttu-id="041de-330">Aggiunta o sostituzione di un server di controllo del mirroring del database &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="041de-330">Add or Replace a Database Mirroring Witness &#40;SQL Server Management Studio&#41;</span></span>](../database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="041de-331">Stabilire una sessione di mirroring del database tramite autenticazione di Windows &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="041de-331">Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;</span></span>](establish-database-mirroring-session-windows-authentication.md)  
  
-   [<span data-ttu-id="041de-332">Aggiungere un server di controllo del mirroring del database tramite l'autenticazione di Windows &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="041de-332">Add a Database Mirroring Witness Using Windows Authentication &#40;Transact-SQL&#41;</span></span>](add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
-   [<span data-ttu-id="041de-333">Rimuovere il server di controllo del mirroring da una sessione di mirroring del database &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="041de-333">Remove the Witness from a Database Mirroring Session &#40;SQL Server&#41;</span></span>](remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
-   [<span data-ttu-id="041de-334">Modificare la sicurezza delle transazioni in una sessione di mirroring del database &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="041de-334">Change Transaction Safety in a Database Mirroring Session &#40;Transact-SQL&#41;</span></span>](change-transaction-safety-in-a-database-mirroring-session-transact-sql.md)  
  
## <a name="see-also"></a><span data-ttu-id="041de-335">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="041de-335">See Also</span></span>  
 <span data-ttu-id="041de-336">[Monitoraggio del mirroring del database &#40;SQL Server&#41;](monitoring-database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="041de-336">[Monitoring Database Mirroring &#40;SQL Server&#41;](monitoring-database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="041de-337">Server di controllo del mirroring del database</span><span class="sxs-lookup"><span data-stu-id="041de-337">Database Mirroring Witness</span></span>](database-mirroring-witness.md)  
