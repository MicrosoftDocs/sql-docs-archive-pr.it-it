---
title: Mirroring e replica del database (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- replication [SQL Server], database mirroring and
ms.assetid: 82796217-02e2-4bc5-9ab5-218bae11a2d6
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: b126aeb8ccd24932706b8798ebfe7088308918e2
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87721740"
---
# <a name="database-mirroring-and-replication-sql-server"></a><span data-ttu-id="048bd-102">Mirroring e replica del database (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="048bd-102">Database Mirroring and Replication (SQL Server)</span></span>
  <span data-ttu-id="048bd-103">Per migliorare la disponibilità del database di pubblicazione è possibile utilizzare il mirroring del database in combinazione con la replica.</span><span class="sxs-lookup"><span data-stu-id="048bd-103">Database mirroring can be used in conjunction with replication to improve availability for the publication database.</span></span> <span data-ttu-id="048bd-104">Il mirroring del database coinvolge due copie di un unico database che in genere risiedono in computer diversi.</span><span class="sxs-lookup"><span data-stu-id="048bd-104">Database mirroring involves two copies of a single database that typically reside on different computers.</span></span> <span data-ttu-id="048bd-105">In un momento dato solo una copia del database risulta disponibile per i client.</span><span class="sxs-lookup"><span data-stu-id="048bd-105">At any given time, only one copy of the database is currently available to clients.</span></span> <span data-ttu-id="048bd-106">Questa copia viene definita database principale.</span><span class="sxs-lookup"><span data-stu-id="048bd-106">This copy is known as the principal database.</span></span> <span data-ttu-id="048bd-107">Gli aggiornamenti apportati dai client al database principale vengono applicati all'altra copia del database, definita database mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-107">Updates made by clients to the principal database are applied on the other copy of the database, known as the mirror database.</span></span> <span data-ttu-id="048bd-108">Il processo di mirroring prevede l'applicazione nel database mirror del log delle transazioni relativo a ogni operazione di inserimento, aggiornamento o eliminazione eseguita sul database principale.</span><span class="sxs-lookup"><span data-stu-id="048bd-108">Mirroring involves applying the transaction log from every insertion, update, or deletion made on the principal database onto the mirror database.</span></span>  
  
 <span data-ttu-id="048bd-109">Il failover della replica su un server mirror è supportato completamente per i database di pubblicazione e parzialmente per i database di sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="048bd-109">Replication failover to a mirror is fully supported for publication databases, with limited support for subscription databases.</span></span> <span data-ttu-id="048bd-110">Non è supportato l'utilizzo del database di distribuzione con il mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="048bd-110">Database mirroring is not supported for the distribution database.</span></span> <span data-ttu-id="048bd-111">Per informazioni sul recupero di un database di distribuzione o di un database di sottoscrizione senza che sia necessario riconfigurare la replica, vedere [Backup e ripristino di database replicati](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span><span class="sxs-lookup"><span data-stu-id="048bd-111">For information about recovering a distribution database or subscription database without any need to reconfigure replication, see [Back Up and Restore Replicated Databases](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span></span> <span data-ttu-id="048bd-112">Per informazioni sul mirroring del database sottoscrittore, vedere</span><span class="sxs-lookup"><span data-stu-id="048bd-112">For information about mirroring the subscriber database, see the</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="048bd-113">Dopo un failover, il server mirror diventa il server principale.</span><span class="sxs-lookup"><span data-stu-id="048bd-113">After a failover, the mirror becomes the principal.</span></span> <span data-ttu-id="048bd-114">In questo argomento "principale" e "mirror" si riferiscono sempre al server principale originale e al server mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-114">In this topic, "principal" and "mirror" always refer to the original principal and mirror.</span></span>  
  
## <a name="requirements-and-considerations-for-using-replication-with-database-mirroring"></a><span data-ttu-id="048bd-115">Requisiti e considerazioni per l'utilizzo della replica con il mirroring del database</span><span class="sxs-lookup"><span data-stu-id="048bd-115">Requirements and Considerations for Using Replication with Database Mirroring</span></span>  
 <span data-ttu-id="048bd-116">Prendere in considerazione i requisiti e le considerazioni seguenti quando si utilizza la replica con il mirroring del database:</span><span class="sxs-lookup"><span data-stu-id="048bd-116">Be aware of the following requirements and considerations when using replication with database mirroring:</span></span>  
  
-   <span data-ttu-id="048bd-117">I server principale e mirror devono condividere un server di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="048bd-117">The principal and mirror must share a Distributor.</span></span> <span data-ttu-id="048bd-118">È consigliabile che quest'ultimo sia un server di distribuzione remoto, in quanto garantisce una maggiore tolleranza di errore nel caso si verifichi un failover non pianificato sul server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="048bd-118">We recommend that this be a remote Distributor, which provides greater fault tolerance if the Publisher has an unplanned failover.</span></span>  
  
-   <span data-ttu-id="048bd-119">Il mirroring del database di pubblicazione è supportato nella replica di tipo merge e nella replica transazionale con Sottoscrittori di sola lettura o Sottoscrittori ad aggiornamento in coda.</span><span class="sxs-lookup"><span data-stu-id="048bd-119">Replication supports mirroring the publication database for merge replication and for transactional replication with read-only Subscribers or queued updating Subscribers.</span></span> <span data-ttu-id="048bd-120">Non sono supportati Sottoscrittori ad aggiornamento immediato, server di pubblicazione Oracle, server di pubblicazione in una topologia peer-to-peer e ripubblicazione.</span><span class="sxs-lookup"><span data-stu-id="048bd-120">Immediate updating Subscribers, Oracle Publishers, Publishers in a peer-to-peer topology, and republishing are not supported.</span></span>  
  
-   <span data-ttu-id="048bd-121">I metadati e gli oggetti esterni al database, ad esempio account di accesso, processi, server collegati e così via, non vengono copiati nel database mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-121">Metadata and objects that exist outside the database are not copied to the mirror, including logins, jobs, linked servers, and so on.</span></span> <span data-ttu-id="048bd-122">Se i metadati e gli oggetti sono necessari nel database mirror, è necessario copiarli manualmente.</span><span class="sxs-lookup"><span data-stu-id="048bd-122">If you require the metadata and objects at the mirror, you must copy them manually.</span></span> <span data-ttu-id="048bd-123">Per altre informazioni, vedere [Gestione di account di accesso e di processi dopo un cambio di ruolo &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="048bd-123">For more information, see [Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span></span>  
  
## <a name="configuring-replication-with-database-mirroring"></a><span data-ttu-id="048bd-124">Configurazione della replica con il mirroring del database</span><span class="sxs-lookup"><span data-stu-id="048bd-124">Configuring Replication with Database Mirroring</span></span>  
 <span data-ttu-id="048bd-125">Per configurare la replica e il mirroring del database è necessario eseguire cinque operazioni.</span><span class="sxs-lookup"><span data-stu-id="048bd-125">Configuring replication and database mirroring involves five steps.</span></span> <span data-ttu-id="048bd-126">Ogni operazione è descritta in dettaglio nella sezione seguente.</span><span class="sxs-lookup"><span data-stu-id="048bd-126">Each step is described in more detail in the following section.</span></span>  
  
1.  <span data-ttu-id="048bd-127">Configurare il server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="048bd-127">Configure the Publisher.</span></span>  
  
2.  <span data-ttu-id="048bd-128">Configurare il mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="048bd-128">Configure database mirroring.</span></span>  
  
3.  <span data-ttu-id="048bd-129">Configurare il database mirror in modo che utilizzi lo stesso server di distribuzione del database principale.</span><span class="sxs-lookup"><span data-stu-id="048bd-129">Configure the mirror to use the same Distributor as the principal.</span></span>  
  
4.  <span data-ttu-id="048bd-130">Configurare gli agenti di replica per il failover.</span><span class="sxs-lookup"><span data-stu-id="048bd-130">Configure replication agents for failover.</span></span>  
  
5.  <span data-ttu-id="048bd-131">Aggiungere i database principale e mirror a Monitoraggio replica.</span><span class="sxs-lookup"><span data-stu-id="048bd-131">Add the principal and mirror to Replication Monitor.</span></span>  
  
 <span data-ttu-id="048bd-132">Le operazioni ai passaggi 1 e 2 possono anche essere eseguite in ordine inverso.</span><span class="sxs-lookup"><span data-stu-id="048bd-132">Steps 1 and 2 can also be performed in the opposite order.</span></span>  
  
#### <a name="to-configure-database-mirroring-for-a-publication-database"></a><span data-ttu-id="048bd-133">Per configurare il mirroring di un database di pubblicazione</span><span class="sxs-lookup"><span data-stu-id="048bd-133">To configure database mirroring for a publication database</span></span>  
  
1.  <span data-ttu-id="048bd-134">Configurare il server di pubblicazione:</span><span class="sxs-lookup"><span data-stu-id="048bd-134">Configure the Publisher:</span></span>  
  
    1.  <span data-ttu-id="048bd-135">È consigliabile utilizzare un server di distribuzione remoto.</span><span class="sxs-lookup"><span data-stu-id="048bd-135">We recommend using a remote Distributor.</span></span> <span data-ttu-id="048bd-136">Per altre informazioni sulla configurazione della distribuzione, vedere [Configurare la distribuzione](../../relational-databases/replication/configure-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="048bd-136">For more information about configuring distribution, see [Configure Distribution](../../relational-databases/replication/configure-distribution.md).</span></span>  
  
    2.  <span data-ttu-id="048bd-137">È possibile abilitare un database per pubblicazioni snapshot e transazionali e/o pubblicazioni di tipo merge.</span><span class="sxs-lookup"><span data-stu-id="048bd-137">You can enable a database for snapshot and transactional publications and/or merge publications.</span></span> <span data-ttu-id="048bd-138">Nel caso di database con mirroring che includono più tipi di pubblicazione, è necessario abilitare il database per entrambi i tipi in corrispondenza dello stesso nodo usando [sp_replicationdboption](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="048bd-138">For mirrored databases that will contain more than one type of publication, you must enable the database for both types at the same node using [sp_replicationdboption](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="048bd-139">È ad esempio possibile eseguire le chiamate di stored procedure seguenti nel server principale:</span><span class="sxs-lookup"><span data-stu-id="048bd-139">For example, you could execute the following stored procedure calls at the principal:</span></span>  
  
        ```  
        exec sp_replicationdboption @dbname='<PublicationDatabase>', @optname='publish', @value=true;  
        exec sp_replicationdboption @dbname='<PublicationDatabase>', @optname='mergepublish', @value=true;  
        ```  
  
         <span data-ttu-id="048bd-140">Per altre informazioni sulla creazione di pubblicazioni, vedere [Pubblicare dati e oggetti di database](../../relational-databases/replication/publish/publish-data-and-database-objects.md).</span><span class="sxs-lookup"><span data-stu-id="048bd-140">For more information about creating publications, see [Publish Data and Database Objects](../../relational-databases/replication/publish/publish-data-and-database-objects.md).</span></span>  
  
2.  <span data-ttu-id="048bd-141">Configurare il mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="048bd-141">Configure database mirroring.</span></span> <span data-ttu-id="048bd-142">Per altre informazioni, vedere [Stabilire una sessione di mirroring del database tramite autenticazione di Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) e [Impostazione del mirroring del database &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="048bd-142">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) and [Setting Up Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="048bd-143">Configurare la distribuzione per il server mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-143">Configure distribution for the mirror.</span></span> <span data-ttu-id="048bd-144">Assegnare al database mirror lo stesso nome del server di pubblicazione e specificare lo stesso server di distribuzione e la stessa cartella snapshot utilizzati dal database principale.</span><span class="sxs-lookup"><span data-stu-id="048bd-144">Specify the mirror name as the Publisher, and specify the same Distributor and snapshot folder that the principal uses.</span></span> <span data-ttu-id="048bd-145">Se ad esempio si configura la replica con stored procedure, eseguire [sp_adddistpublisher](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql) nel server di distribuzione e quindi [sp_adddistributor](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) nel mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-145">For example, if you are configuring replication with stored procedures, execute [sp_adddistpublisher](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql) at the Distributor; and then execute [sp_adddistributor](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the mirror.</span></span> <span data-ttu-id="048bd-146">Per **sp_adddistpublisher**:</span><span class="sxs-lookup"><span data-stu-id="048bd-146">For **sp_adddistpublisher**:</span></span>  
  
    -   <span data-ttu-id="048bd-147">Impostare il valore del **@publisher** parametro sul nome di rete del server mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-147">Set the value of the **@publisher** parameter to the network name of the mirror.</span></span>  
  
    -   <span data-ttu-id="048bd-148">Impostare il valore del **@working_directory** parametro sulla cartella snapshot usata dal server principale.</span><span class="sxs-lookup"><span data-stu-id="048bd-148">Set the value of the **@working_directory** parameter to the snapshot folder used by the principal.</span></span>  
  
4.  <span data-ttu-id="048bd-149">Specificare il nome del database mirror per il parametro dell'agente **-PublisherFailoverPartner**.</span><span class="sxs-lookup"><span data-stu-id="048bd-149">Specify the mirror name for the **-PublisherFailoverPartner** agent parameter.</span></span> <span data-ttu-id="048bd-150">Questo parametro è necessario per l'identificazione del database mirror dopo il failover da parte degli agenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="048bd-150">Agent This parameter is required for the following agents to identify the mirror after failover:</span></span>  
  
    -   <span data-ttu-id="048bd-151">Agente snapshot (per tutte le pubblicazioni)</span><span class="sxs-lookup"><span data-stu-id="048bd-151">Snapshot Agent (for all publications)</span></span>  
  
    -   <span data-ttu-id="048bd-152">Agente di lettura log (per tutte le pubblicazioni transazionali)</span><span class="sxs-lookup"><span data-stu-id="048bd-152">Log Reader Agent (for all transactional publications)</span></span>  
  
    -   <span data-ttu-id="048bd-153">Agente di lettura coda (per le pubblicazioni transazionali che supportano le sottoscrizioni ad aggiornamento in coda)</span><span class="sxs-lookup"><span data-stu-id="048bd-153">Queue Reader Agent (for transactional publications that support queued updating subscriptions)</span></span>  
  
    -   <span data-ttu-id="048bd-154">Agente di merge (per le sottoscrizioni di tipo merge)</span><span class="sxs-lookup"><span data-stu-id="048bd-154">Merge Agent (for merge subscriptions)</span></span>  
  
    -   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="048bd-155">Listener per la replica di (replisapi.dll: per le sottoscrizioni di tipo merge sincronizzate usando sincronizzazione Web)</span><span class="sxs-lookup"><span data-stu-id="048bd-155">replication listener (replisapi.dll: for merge subscriptions synchronized using Web synchronization)</span></span>  
  
    -   <span data-ttu-id="048bd-156">Controllo ActiveX merge SQL (per le sottoscrizioni di tipo merge sincronizzate tramite il controllo)</span><span class="sxs-lookup"><span data-stu-id="048bd-156">SQL Merge ActiveX Control (for merge subscriptions synchronized with the control)</span></span>  
  
     <span data-ttu-id="048bd-157">Questo parametro non è necessario per l'agente di distribuzione e il controllo ActiveX distribuzione SQL in quanto questi ultimi non si connettono al server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="048bd-157">The Distribution Agent and Distribution ActiveX Control do not have this parameter because they do not connect to the Publisher.</span></span>  
  
     <span data-ttu-id="048bd-158">Le modifiche apportate al parametro dell'agente verranno applicate al successivo avvio dell'agente.</span><span class="sxs-lookup"><span data-stu-id="048bd-158">Agent parameter changes take effect the next time the agent is started.</span></span> <span data-ttu-id="048bd-159">Se l'agente viene eseguito in modo continuo, è necessario arrestarlo e riavviarlo.</span><span class="sxs-lookup"><span data-stu-id="048bd-159">If the agent runs continuously, you must stop and restart the agent.</span></span> <span data-ttu-id="048bd-160">I parametri possono essere specificati nei profili agenti e al prompt dei comandi.</span><span class="sxs-lookup"><span data-stu-id="048bd-160">Parameters can be specified in agent profiles and from the command prompt.</span></span> <span data-ttu-id="048bd-161">Per altre informazioni, vedere:</span><span class="sxs-lookup"><span data-stu-id="048bd-161">For more information, see:</span></span>  
  
    -   [<span data-ttu-id="048bd-162">Visualizzare e modificare i parametri del prompt dei comandi dell'agente di replica &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="048bd-162">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../../relational-databases/replication/agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
    -   [<span data-ttu-id="048bd-163">Replication Agent Executables Concepts</span><span class="sxs-lookup"><span data-stu-id="048bd-163">Replication Agent Executables Concepts</span></span>](../../relational-databases/replication/concepts/replication-agent-executables-concepts.md)  
  
     <span data-ttu-id="048bd-164">È consigliabile aggiungere il parametro **-PublisherFailoverPartner** a un profilo agente e quindi specificare il nome del database mirror nel profilo.</span><span class="sxs-lookup"><span data-stu-id="048bd-164">We recommend adding the **-PublisherFailoverPartner** to an agent profile, and then specifying the mirror name in the profile.</span></span> <span data-ttu-id="048bd-165">Se ad esempio si sta configurando la replica con stored procedure:</span><span class="sxs-lookup"><span data-stu-id="048bd-165">For example, if you are configuring replication with stored procedures:</span></span>  
  
    ```  
    -- Execute sp_help_agent_profile in the context of the distribution database to get the list of profiles.  
    -- Select the profile id of the profile that needs to be updated from the result set.  
    -- In the agent_type column returned by sp_help_agent_profile:   
    -- 1 = Snapshot Agent; 2 = Log Reader Agent; 3 = Distribution Agent; 4 = Merge Agent; 9 = Queue Reader Agent.  
  
    exec sp_help_agent_profile;  
  
    -- Setting the -PublisherFailoverPartner parameter in the default Snapshot Agent profile (profile 1).  
    -- Execute sp_add_agent_parameter in the context of the distribution database.  
    exec sp_add_agent_parameter @profile_id = 1, @parameter_name = N'-PublisherFailoverPartner', @parameter_value = N'<Failover Partner Name>';  
  
    -- Setting the -PublisherFailoverPartner parameter in the default Merge Agent profile (profile 6).  
    -- Execute sp_add_agent_parameter in the context of the distribution database.  
    exec sp_add_agent_parameter @profile_id = 6, @parameter_name = N'-PublisherFailoverPartner', @parameter_value = N'<Failover Partner Name>';  
    ```  
  
5.  <span data-ttu-id="048bd-166">Aggiungere i database principale e mirror a Monitoraggio replica.</span><span class="sxs-lookup"><span data-stu-id="048bd-166">Add the principal and mirror to Replication Monitor.</span></span> <span data-ttu-id="048bd-167">Per altre informazioni, vedere [Aggiungere e rimuovere server di pubblicazione da Monitoraggio replica](../../relational-databases/replication/monitor/add-and-remove-publishers-from-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="048bd-167">For more information, see [Add and Remove Publishers from Replication Monitor](../../relational-databases/replication/monitor/add-and-remove-publishers-from-replication-monitor.md).</span></span>  
  
## <a name="maintaining-a-mirrored-publication-database"></a><span data-ttu-id="048bd-168">Gestione di un database di pubblicazione con mirroring</span><span class="sxs-lookup"><span data-stu-id="048bd-168">Maintaining a Mirrored Publication Database</span></span>  
 <span data-ttu-id="048bd-169">La gestione di un database di pubblicazione con mirroring è sostanzialmente analoga a quella di un database senza mirroring, con le considerazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="048bd-169">Maintaining a mirrored publication database is essentially the same as maintaining a non-mirrored database, with the following considerations:</span></span>  
  
-   <span data-ttu-id="048bd-170">L'amministrazione e il monitoraggio devono essere eseguiti sul server attivo.</span><span class="sxs-lookup"><span data-stu-id="048bd-170">Administration and monitoring must occur at the active server.</span></span> <span data-ttu-id="048bd-171">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]le pubblicazioni sono incluse nella cartella **Pubblicazioni locali** solo per il server attivo.</span><span class="sxs-lookup"><span data-stu-id="048bd-171">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], publications appear under the **Local Publications** folder only for the active server.</span></span> <span data-ttu-id="048bd-172">Se si esegue ad esempio il failover sul database mirror, le pubblicazioni vengono visualizzate nel database mirror e non più nel database principale.</span><span class="sxs-lookup"><span data-stu-id="048bd-172">For example, if you failover to the mirror, the publications are displayed at the mirror and are no longer displayed at the principal.</span></span> <span data-ttu-id="048bd-173">Se viene eseguito il failover del database sul database mirror, potrebbe essere necessario aggiornare manualmente [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] e Monitoraggio replica per applicare la modifica.</span><span class="sxs-lookup"><span data-stu-id="048bd-173">If the database fails over to the mirror, you might need to manually refresh [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] and Replication Monitor for the change to be reflected.</span></span>  
  
-   <span data-ttu-id="048bd-174">In Monitoraggio replica vengono visualizzati i nodi del server di pubblicazione nell'albero degli oggetti per il server principale e il server mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-174">Replication Monitor displays Publisher nodes in the object tree for both the principal and the mirror.</span></span> <span data-ttu-id="048bd-175">Se il server principale è il server attivo, le informazioni relative alla pubblicazione vengono visualizzate solo nel nodo principale in Monitoraggio replica.</span><span class="sxs-lookup"><span data-stu-id="048bd-175">If the principal is the active server, publication information is displayed only under the principal node in Replication Monitor.</span></span>  
  
     <span data-ttu-id="048bd-176">Se il server mirror è il server attivo:</span><span class="sxs-lookup"><span data-stu-id="048bd-176">If the mirror is the active server:</span></span>  
  
    -   <span data-ttu-id="048bd-177">Se si è verificato un errore nell'agente, l'errore è indicato solo nel nodo principale e non nel nodo mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-177">If an agent has an error, the error is indicated only on the principal node, not on the mirror node.</span></span>  
  
    -   <span data-ttu-id="048bd-178">Se il server principale non è disponibile, i nodi principale e mirror visualizzano elenchi di pubblicazioni identici.</span><span class="sxs-lookup"><span data-stu-id="048bd-178">If the principal is unavailable, the principal and mirror nodes display identical lists of publications.</span></span> <span data-ttu-id="048bd-179">È necessario eseguire il monitoraggio delle pubblicazioni nel nodo mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-179">Monitoring should be performed on the publications under the mirror node.</span></span>  
  
-   <span data-ttu-id="048bd-180">Se si amministra la replica sul database mirror mediante stored procedure o oggetti RMO (Replication Management Objects), per i casi in cui si specifica il nome del server di pubblicazione indicare il nome dell'istanza in cui il database è stato abilitato per la replica.</span><span class="sxs-lookup"><span data-stu-id="048bd-180">When using stored procedures or Replication Management Objects (RMO) to administer replication at the mirror, for cases in which you specify the Publisher name, you must specify the name of the instance on which the database was enabled for replication.</span></span> <span data-ttu-id="048bd-181">Per determinare il nome appropriato, usare la funzione [publishingnomeserver](/sql/t-sql/functions/replication-functions-publishingservername).</span><span class="sxs-lookup"><span data-stu-id="048bd-181">To determine the appropriate name, use the function [publishingservername](/sql/t-sql/functions/replication-functions-publishingservername).</span></span>  
  
     <span data-ttu-id="048bd-182">Quando si esegue il mirroring di un database di pubblicazione, i metadati della replica archiviati nel database con mirroring sono identici a quelli archiviati nel database principale.</span><span class="sxs-lookup"><span data-stu-id="048bd-182">When a publication database is mirrored, the replication metadata stored in the mirrored database is identical to the metadata stored in the principal database.</span></span> <span data-ttu-id="048bd-183">Ne consegue che, per i database di pubblicazione abilitati per la replica nel database principale, il nome dell'istanza del server di pubblicazione archiviato in tabelle di sistema nel database mirror equivale al nome del database principale e non a quello del database mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-183">Consequently, for publication databases enabled for replication at the principal, the Publisher instance name stored in system tables at the mirror is the name of the principal, not the mirror.</span></span> <span data-ttu-id="048bd-184">Ciò influisce sulla manutenzione e sulla configurazione della replica se viene eseguito il failover del database di pubblicazione sul server mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-184">This affects replication configuration and maintenance if the publication database fails over to the mirror.</span></span> <span data-ttu-id="048bd-185">Se, ad esempio, si configura la replica con stored procedure sul database mirror dopo un failover e si desidera aggiungere una sottoscrizione pull a un database di pubblicazione abilitato nel server principale, è necessario specificare il nome dell'entità anziché il nome del server mirror per il **@publisher** parametro di **sp_addpullsubscription** o **sp_addmergepullsubscription**.</span><span class="sxs-lookup"><span data-stu-id="048bd-185">For example, if you are configuring replication with stored procedures on the mirror after a failover, and you want to add a pull subscription to a publication database that was enabled at the principal, you must specify the principal name rather than the mirror name for the **@publisher** parameter of **sp_addpullsubscription** or **sp_addmergepullsubscription**.</span></span>  
  
     <span data-ttu-id="048bd-186">Se si Abilita un database di pubblicazione sul server mirror dopo il failover sul database mirror, il nome dell'istanza del server di pubblicazione archiviato nelle tabelle di sistema è il nome del server mirror. in questo caso, si utilizzerà il nome del server mirror per il **@publisher** parametro.</span><span class="sxs-lookup"><span data-stu-id="048bd-186">If you enable a publication database at the mirror after failover to the mirror, the Publisher instance name stored in system tables is the name of the mirror; in this case, you would use the name of the mirror for the **@publisher** parameter.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="048bd-187">In alcuni casi, ad esempio se si usa **sp_addpublication**, il parametro **@publisher** è supportato solo per server di pubblicazione non[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Non è quindi rilevante per il mirroring del database di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="048bd-187">In some cases, such as **sp_addpublication**, the **@publisher** parameter is supported only for non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Publishers; in these cases, it is not relevant for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database mirroring.</span></span>  
  
-   <span data-ttu-id="048bd-188">Per sincronizzare una sottoscrizione in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] dopo un failover, sincronizzare le sottoscrizioni pull dal Sottoscrittore e le sottoscrizioni push dal server di pubblicazione attivo.</span><span class="sxs-lookup"><span data-stu-id="048bd-188">To synchronize a subscription in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] after a failover: synchronize pull subscriptions from the Subscriber; and synchronize push subscriptions from the active Publisher.</span></span>  
  
### <a name="replication-behavior-if-mirroring-is-removed"></a><span data-ttu-id="048bd-189">Funzionamento della replica dopo l'eliminazione del mirroring</span><span class="sxs-lookup"><span data-stu-id="048bd-189">Replication Behavior if Mirroring is Removed</span></span>  
 <span data-ttu-id="048bd-190">Se si elimina il mirroring da un database pubblicato tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="048bd-190">Keep the following issues in mind if database mirroring is removed from a published database:</span></span>  
  
-   <span data-ttu-id="048bd-191">Se il database di pubblicazione nel server principale è senza mirroring, la replica continua senza alcuna variazione per il server principale originale.</span><span class="sxs-lookup"><span data-stu-id="048bd-191">If the publication database at the principal is no longer mirrored, replication continues to work unchanged against the original principal.</span></span>  
  
-   <span data-ttu-id="048bd-192">Se viene eseguito il failover del database di pubblicazione dal server principale sul server mirror e la relazione di mirroring viene disabilitata o eliminata, gli agenti di replica non funzioneranno sul database mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-192">If the publication database fails over from the principal to the mirror and the mirroring relationship is subsequently disabled or removed, replication agents will not function against the mirror.</span></span> <span data-ttu-id="048bd-193">Se il database principale è definitivamente perso, disabilitare e quindi riconfigurare la replica con il server mirror specificato come server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="048bd-193">If the principal is permanently lost, disable and then reconfigure replication with the mirror specified as the Publisher.</span></span>  
  
-   <span data-ttu-id="048bd-194">Se il mirroring del database viene eliminato completamente, il database mirror si trova in stato di recupero e deve essere ripristinato affinché funzioni.</span><span class="sxs-lookup"><span data-stu-id="048bd-194">If database mirroring is removed completely, the mirror database is in a recovery state and must be restored in order to become functional.</span></span> <span data-ttu-id="048bd-195">Il funzionamento del database recuperato in relazione alla replica dipende dall'impostazione dell'opzione KEEP_REPLICATION.</span><span class="sxs-lookup"><span data-stu-id="048bd-195">The behavior of the recovered database with respect to replication depends on whether the KEEP_REPLICATION option is specified.</span></span> <span data-ttu-id="048bd-196">Questa opzione indica che durante il ripristino di un database pubblicato in un server diverso da quello in cui è stato creato il backup le impostazioni di replica devono essere mantenute inalterate.</span><span class="sxs-lookup"><span data-stu-id="048bd-196">This option forces the restore operation to preserve replication settings when restoring a published database to a server other than that on which the backup was created.</span></span> <span data-ttu-id="048bd-197">Utilizzare l'opzione KEEP_REPLICATION solo quando l'altro database di pubblicazione non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="048bd-197">Use the KEEP_REPLICATION option only when the other publication database is unavailable.</span></span> <span data-ttu-id="048bd-198">L'opzione non è infatti supportata se l'altro database di pubblicazione non è ancora stato modificato ed è oggetto di replica.</span><span class="sxs-lookup"><span data-stu-id="048bd-198">The option is not supported if the other publication database is still intact and replicating.</span></span> <span data-ttu-id="048bd-199">Per altre informazioni sull'opzione KEEP_REPLICATION, vedere [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="048bd-199">For more information about KEEP_REPLICATION, see [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
## <a name="log-reader-agent-behavior"></a><span data-ttu-id="048bd-200">Funzionamento dell'agente di lettura log</span><span class="sxs-lookup"><span data-stu-id="048bd-200">Log Reader Agent Behavior</span></span>  
 <span data-ttu-id="048bd-201">Nella tabella seguente viene descritto il funzionamento dell'agente di lettura log per le diverse modalità operative del mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="048bd-201">The following table describes Log Reader Agent behavior for the various operating modes of database mirroring.</span></span>  
  
|<span data-ttu-id="048bd-202">Modalità operativa</span><span class="sxs-lookup"><span data-stu-id="048bd-202">Operating mode</span></span>|<span data-ttu-id="048bd-203">Funzionamento dell'agente di lettura log quando il database mirror non è disponibile</span><span class="sxs-lookup"><span data-stu-id="048bd-203">Log Reader Agent behavior if the mirror is unavailable</span></span>|  
|--------------------|------------------------------------------------------------|  
|<span data-ttu-id="048bd-204">Modalità a sicurezza elevata con failover automatico</span><span class="sxs-lookup"><span data-stu-id="048bd-204">High-safety mode with automatic failover</span></span>|<span data-ttu-id="048bd-205">Se il database mirror non è disponibile, l'agente di lettura log propaga i comandi al database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="048bd-205">If the mirror is unavailable, the Log Reader Agent propagates commands to the distribution database.</span></span> <span data-ttu-id="048bd-206">Non è possibile eseguire il failover del database principale sul database mirror finché il database mirror non è nuovamente online e include tutte le transazioni del database principale.</span><span class="sxs-lookup"><span data-stu-id="048bd-206">The principal cannot failover to the mirror until the mirror is back online and has all transactions from the principal.</span></span>|  
|<span data-ttu-id="048bd-207">Modalità a prestazioni elevate</span><span class="sxs-lookup"><span data-stu-id="048bd-207">High-performance mode</span></span>|<span data-ttu-id="048bd-208">Se il database mirror non è disponibile, il database principale è in esecuzione non protetta, ovvero è senza mirroring.</span><span class="sxs-lookup"><span data-stu-id="048bd-208">If the mirror is unavailable, the principal database is running exposed (that is, unmirrored).</span></span> <span data-ttu-id="048bd-209">Tuttavia, l'agente di lettura log replica solo le transazioni salvate nel database mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-209">However, the Log Reader Agent only replicates those transactions that are hardened on the mirror.</span></span> <span data-ttu-id="048bd-210">Se il servizio è forzato e il server mirror diventa server principale, l'agente di lettura log viene eseguito nel database mirror e recupera tutte le nuove transazioni.</span><span class="sxs-lookup"><span data-stu-id="048bd-210">If service is forced and the mirror server assumes the role of the principal, the Log Reader Agent will work against the mirror and start picking up the new transactions.</span></span><br /><br /> <span data-ttu-id="048bd-211">La latenza di replica aumenta se il server mirror non è sincronizzato con il server principale.</span><span class="sxs-lookup"><span data-stu-id="048bd-211">Be aware that replication latency will increase if the mirror falls behind the principal.</span></span>|  
|<span data-ttu-id="048bd-212">Modalità a sicurezza elevata senza failover automatico</span><span class="sxs-lookup"><span data-stu-id="048bd-212">High-safety mode without automatic failover</span></span>|<span data-ttu-id="048bd-213">Tutte le transazioni di cui è stato eseguito il commit vengono salvate su disco nel database mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-213">All committed transactions are guaranteed to be hardened to disk on the mirror.</span></span> <span data-ttu-id="048bd-214">L'agente di lettura log replica solo le transazioni salvate nel server mirror.</span><span class="sxs-lookup"><span data-stu-id="048bd-214">The Log Reader Agent replicates only those transactions that are hardened on the mirror.</span></span> <span data-ttu-id="048bd-215">Se il server mirror non è disponibile, il server principale non consente alcuna operazione nel database. L'agente di lettura log non può pertanto replicare alcuna transazione.</span><span class="sxs-lookup"><span data-stu-id="048bd-215">If the mirror is unavailable, the principal disallows further activity in the database; therefore the Log Reader Agent has no transactions to replicate.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="048bd-216">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="048bd-216">See Also</span></span>  
 <span data-ttu-id="048bd-217">[Replica di SQL Server](../../relational-databases/replication/sql-server-replication.md) </span><span class="sxs-lookup"><span data-stu-id="048bd-217">[SQL Server Replication](../../relational-databases/replication/sql-server-replication.md) </span></span>  
 [<span data-ttu-id="048bd-218">Log shipping e replica &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="048bd-218">Log Shipping and Replication &#40;SQL Server&#41;</span></span>](../log-shipping/log-shipping-and-replication-sql-server.md)  
  
  
