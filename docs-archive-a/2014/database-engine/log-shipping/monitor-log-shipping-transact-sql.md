---
title: Monitorare il log shipping (Transact-SQL) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- log shipping [SQL Server], status
- history tables [SQL Server]
- historical information [SQL Server], log shipping
- log shipping [SQL Server], monitoring
- alerts [SQL Server], log shipping
- status information [SQL Server], log shipping
- monitoring log shipping [SQL Server]
ms.assetid: acf3cd99-55f7-4287-8414-0892f830f423
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 0ab87d5d8aa08b7b2860fe52fd097f33af327a94
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87626240"
---
# <a name="monitor-log-shipping-transact-sql"></a><span data-ttu-id="b018a-102">Monitorare il log shipping (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="b018a-102">Monitor Log Shipping (Transact-SQL)</span></span>
  <span data-ttu-id="b018a-103">Dopo aver configurato il log shipping, è possibile monitorare le informazioni relative allo stato di tutti i server di log shipping.</span><span class="sxs-lookup"><span data-stu-id="b018a-103">After you have configured log shipping, you can monitor information about the status of all the log shipping servers.</span></span> <span data-ttu-id="b018a-104">La cronologia e lo stato delle operazioni di log shipping vengono salvati sempre in locale dai processi per il log shipping.</span><span class="sxs-lookup"><span data-stu-id="b018a-104">The history and status of log shipping operations are always saved locally by the log shipping jobs.</span></span> <span data-ttu-id="b018a-105">La cronologia e lo stato dell'operazione di backup vengono memorizzati sul server primario, mentre la cronologia e lo stato delle operazioni di copia e ripristino sono memorizzati sul server secondario.</span><span class="sxs-lookup"><span data-stu-id="b018a-105">The history and status of the backup operation are stored at the primary server, and the history and status of the copy and restore operations are stored at the secondary server.</span></span> <span data-ttu-id="b018a-106">Se è stato implementato un server di monitoraggio remoto, queste informazioni vengono memorizzate anche sul server di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="b018a-106">If you have implemented a remote monitor server, this information is also stored on the monitor server.</span></span>  
  
 <span data-ttu-id="b018a-107">È possibile configurare avvisi che verranno attivati se le operazioni di log shipping non avvengono secondo la pianificazione.</span><span class="sxs-lookup"><span data-stu-id="b018a-107">You can configure alerts that will fire if log shipping operations fail to occur as scheduled.</span></span> <span data-ttu-id="b018a-108">Gli errori sono generati da un processo per la gestione degli avvisi che controlla lo stato delle operazioni di backup e ripristino.</span><span class="sxs-lookup"><span data-stu-id="b018a-108">Errors are raised by an alert job that watches the status of the backup and restore operations.</span></span> <span data-ttu-id="b018a-109">È possibile definire avvisi che notifichino a un operatore quando si verificano questi errori.</span><span class="sxs-lookup"><span data-stu-id="b018a-109">You can define alerts that notify an operator when these errors are raised.</span></span> <span data-ttu-id="b018a-110">Se è configurato un server di monitoraggio, su di esso viene eseguito un processo per la gestione degli avvisi che genera errori per tutte le operazioni nella configurazione per il log shipping.</span><span class="sxs-lookup"><span data-stu-id="b018a-110">If a monitor server is configured, one alert job runs on the monitor server that raises errors for all operations in the log shipping configuration.</span></span> <span data-ttu-id="b018a-111">Se non è specificato alcun server di monitoraggio, viene eseguito un processo per la gestione degli avvisi sull'istanza del server primario, che monitora l'operazione di backup.</span><span class="sxs-lookup"><span data-stu-id="b018a-111">If a monitor server is not specified, an alert job runs on the primary server instance, which monitors the backup operation.</span></span> <span data-ttu-id="b018a-112">Se non è specificato alcun server di monitoraggio, su ogni istanza del server secondario viene eseguito un processo per la gestione degli avvisi per monitorare le operazioni di copia e ripristino locali.</span><span class="sxs-lookup"><span data-stu-id="b018a-112">If a monitor server is not specified, an alert job also runs on each secondary server instance to monitor the local copy and restore operations.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="b018a-113">Per eseguire il monitoraggio di una configurazione per il log shipping, è necessario aggiungere il server di monitoraggio quando si abilita il log shipping.</span><span class="sxs-lookup"><span data-stu-id="b018a-113">To monitor a log shipping configuration, you must add the monitor server when you enable log shipping.</span></span> <span data-ttu-id="b018a-114">Se un server di monitoraggio viene aggiunto in un momento successivo, sarà necessario rimuovere la configurazione per il log shipping e sostituirla con una configurazione nuova che includa un server di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="b018a-114">If you add a monitor server later, you must remove the log shipping configuration and then replace it with a new configuration that includes a monitor server.</span></span> <span data-ttu-id="b018a-115">Per altre informazioni, vedere [Configurare il log shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b018a-115">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span> <span data-ttu-id="b018a-116">Dopo avere configurato il server di monitoraggio, inoltre, non sarà possibile modificarlo senza prima rimuovere il log shipping.</span><span class="sxs-lookup"><span data-stu-id="b018a-116">Furthermore, after the monitor server has been configured, it cannot be changed without removing log shipping first.</span></span>  
  
## <a name="history-tables-containing-monitoring-information"></a><span data-ttu-id="b018a-117">Tabelle della cronologia contenenti informazioni di monitoraggio</span><span class="sxs-lookup"><span data-stu-id="b018a-117">History Tables Containing Monitoring Information</span></span>  
 <span data-ttu-id="b018a-118">Le tabelle della cronologia di monitoraggio includono i metadati memorizzati sul server di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="b018a-118">The monitoring history tables contain metadata that is stored on the monitor server.</span></span> <span data-ttu-id="b018a-119">Una copia delle informazioni specifiche relative a un determinato server primario o secondario vengono inoltre memorizzate in locale.</span><span class="sxs-lookup"><span data-stu-id="b018a-119">A copy of information specific to a given primary or secondary server is also stored locally.</span></span>  
  
 <span data-ttu-id="b018a-120">È possibile eseguire query su queste tabelle per monitorare lo stato di una sessione di log shipping.</span><span class="sxs-lookup"><span data-stu-id="b018a-120">You can query these tables to monitor the status of a log shipping session.</span></span> <span data-ttu-id="b018a-121">Ad esempio, per ottenere lo stato del log shipping, verificare lo stato e la cronologia dei processi di backup, di copia e di ripristino.</span><span class="sxs-lookup"><span data-stu-id="b018a-121">For example, to learn status of log shipping, check the status and history of the backup job, copy job, and restore job.</span></span> <span data-ttu-id="b018a-122">È possibile visualizzare i dettagli specifici relativi agli errori e alla cronologia del log shipping eseguendo query sulle tabelle di monitoraggio seguenti.</span><span class="sxs-lookup"><span data-stu-id="b018a-122">You can view specific log shipping history and error details by querying the following monitoring tables.</span></span>  
  
|<span data-ttu-id="b018a-123">Tabella</span><span class="sxs-lookup"><span data-stu-id="b018a-123">Table</span></span>|<span data-ttu-id="b018a-124">Descrizione</span><span class="sxs-lookup"><span data-stu-id="b018a-124">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="b018a-125">log_shipping_monitor_alert</span><span class="sxs-lookup"><span data-stu-id="b018a-125">log_shipping_monitor_alert</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-alert-transact-sql)|<span data-ttu-id="b018a-126">Memorizza l'ID del processo per la gestione degli avvisi.</span><span class="sxs-lookup"><span data-stu-id="b018a-126">Stores alert job ID.</span></span>|  
|[<span data-ttu-id="b018a-127">log_shipping_monitor_error_detail</span><span class="sxs-lookup"><span data-stu-id="b018a-127">log_shipping_monitor_error_detail</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-error-detail-transact-sql)|<span data-ttu-id="b018a-128">Memorizza i dettagli relativi agli errori per i processi di log shipping.</span><span class="sxs-lookup"><span data-stu-id="b018a-128">Stores error details for log shipping jobs.</span></span> <span data-ttu-id="b018a-129">È possibile eseguire query su questa tabella per visualizzare gli errori relativi a una sessione di agente.</span><span class="sxs-lookup"><span data-stu-id="b018a-129">You can query this table see the errors for an agent session.</span></span> <span data-ttu-id="b018a-130">Facoltativamente, è possibile ordinare gli errori in base alla data e all'ora di registrazione.</span><span class="sxs-lookup"><span data-stu-id="b018a-130">Optionally, you can sort the errors by the date and time at which each was logged.</span></span> <span data-ttu-id="b018a-131">Ogni errore viene registrato come una sequenza di eccezioni, mentre più errori (sequenze) possono essere ordinati per sessione di agente.</span><span class="sxs-lookup"><span data-stu-id="b018a-131">Each error is logged as a sequence of exceptions, and multiple errors (sequences) can per agent session.</span></span>|  
|[<span data-ttu-id="b018a-132">log_shipping_monitor_history_detail</span><span class="sxs-lookup"><span data-stu-id="b018a-132">log_shipping_monitor_history_detail</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-history-detail-transact-sql)|<span data-ttu-id="b018a-133">Include i dettagli della cronologia per gli agenti di log shipping.</span><span class="sxs-lookup"><span data-stu-id="b018a-133">Contains history details for log shipping agents.</span></span> <span data-ttu-id="b018a-134">È possibile eseguire query su questa tabella per visualizzare i dettagli della cronologia di una sessione di agente.</span><span class="sxs-lookup"><span data-stu-id="b018a-134">You can query this table to see the history detail for an agent session.</span></span>|  
|[<span data-ttu-id="b018a-135">log_shipping_monitor_primary</span><span class="sxs-lookup"><span data-stu-id="b018a-135">log_shipping_monitor_primary</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-primary-transact-sql)|<span data-ttu-id="b018a-136">Memorizza un record di monitoraggio per il database primario in ogni configurazione per il log shipping, incluse le informazioni relative all'ultimo file di backup e all'ultimo file ripristinato che siano utili per il monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="b018a-136">Stores one monitor record for the primary database in each log shipping configuration, including information about the last backup file and last restored file that is useful for monitoring.</span></span>|  
|[<span data-ttu-id="b018a-137">log_shipping_monitor_secondary</span><span class="sxs-lookup"><span data-stu-id="b018a-137">log_shipping_monitor_secondary</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-secondary-transact-sql)|<span data-ttu-id="b018a-138">Memorizza un record di monitoraggio per ogni database secondario, incluse le informazioni relative all'ultimo file di backup e all'ultimo file ripristinato che siano utili per il monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="b018a-138">Stores one monitor record for each secondary database, including information about the last backup file and last restored file that is useful for monitoring.</span></span>|  
  
## <a name="stored-procedures-for-monitoring-log-shipping"></a><span data-ttu-id="b018a-139">Stored procedure per il monitoraggio del log shipping</span><span class="sxs-lookup"><span data-stu-id="b018a-139">Stored Procedures for Monitoring Log Shipping</span></span>  
 <span data-ttu-id="b018a-140">Le informazioni relative al monitoraggio e alla cronologia vengono archiviate nelle tabelle di **msdb**, accessibili con le stored procedure di log shipping.</span><span class="sxs-lookup"><span data-stu-id="b018a-140">Monitoring and history information is stored in tables in **msdb**, which can be accessed using log shipping stored procedures.</span></span> <span data-ttu-id="b018a-141">Eseguire le stored procedure sui server specificati nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="b018a-141">Run these stored procedures on the servers indicated in the following table.</span></span>  
  
|<span data-ttu-id="b018a-142">Stored procedure</span><span class="sxs-lookup"><span data-stu-id="b018a-142">Stored procedure</span></span>|<span data-ttu-id="b018a-143">Descrizione</span><span class="sxs-lookup"><span data-stu-id="b018a-143">Description</span></span>|<span data-ttu-id="b018a-144">Eseguire la stored procedure su</span><span class="sxs-lookup"><span data-stu-id="b018a-144">Run this procedure on</span></span>|  
|----------------------|-----------------|---------------------------|  
|[<span data-ttu-id="b018a-145">sp_help_log_shipping_monitor_primary</span><span class="sxs-lookup"><span data-stu-id="b018a-145">sp_help_log_shipping_monitor_primary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-primary-transact-sql)|<span data-ttu-id="b018a-146">Restituisce i record di monitoraggio per il database primario specificato dalla tabella **log_shipping_monitor_primary** .</span><span class="sxs-lookup"><span data-stu-id="b018a-146">Returns monitor records for the specified primary database from the **log_shipping_monitor_primary** table.</span></span>|<span data-ttu-id="b018a-147">Server di monitoraggio o server primario</span><span class="sxs-lookup"><span data-stu-id="b018a-147">Monitor server or primary server</span></span>|  
|[<span data-ttu-id="b018a-148">sp_help_log_shipping_monitor_secondary</span><span class="sxs-lookup"><span data-stu-id="b018a-148">sp_help_log_shipping_monitor_secondary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-secondary-transact-sql)|<span data-ttu-id="b018a-149">Restituisce i record di monitoraggio per il database secondario specificato dalla tabella **log_shipping_monitor_secondary** .</span><span class="sxs-lookup"><span data-stu-id="b018a-149">Returns monitor records for the specified secondary database from the **log_shipping_monitor_secondary** table.</span></span>|<span data-ttu-id="b018a-150">Server di monitoraggio oppure server secondario</span><span class="sxs-lookup"><span data-stu-id="b018a-150">Monitor server or secondary server</span></span>|  
|[<span data-ttu-id="b018a-151">sp_help_log_shipping_alert_job</span><span class="sxs-lookup"><span data-stu-id="b018a-151">sp_help_log_shipping_alert_job</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-alert-job-transact-sql)|<span data-ttu-id="b018a-152">Restituisce l'ID processo del processo per la gestione degli avvisi.</span><span class="sxs-lookup"><span data-stu-id="b018a-152">Returns the job ID of the alert job.</span></span>|<span data-ttu-id="b018a-153">Server di monitoraggio, oppure server primario o secondario se non è definito alcun server di monitoraggio</span><span class="sxs-lookup"><span data-stu-id="b018a-153">Monitor server, or primary or secondary server if no monitor is defined</span></span>|  
|[<span data-ttu-id="b018a-154">sp_help_log_shipping_primary_database</span><span class="sxs-lookup"><span data-stu-id="b018a-154">sp_help_log_shipping_primary_database</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-primary-database-transact-sql)|<span data-ttu-id="b018a-155">Recupera le impostazioni del database primario e visualizza i valori dalle tabelle **log_shipping_primary_databases** e **log_shipping_monitor_primary** .</span><span class="sxs-lookup"><span data-stu-id="b018a-155">Retrieves primary database settings and displays the values from the **log_shipping_primary_databases** and **log_shipping_monitor_primary** tables.</span></span>|<span data-ttu-id="b018a-156">Server primario</span><span class="sxs-lookup"><span data-stu-id="b018a-156">Primary server</span></span>|  
|[<span data-ttu-id="b018a-157">sp_help_log_shipping_primary_secondary</span><span class="sxs-lookup"><span data-stu-id="b018a-157">sp_help_log_shipping_primary_secondary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-primary-secondary-transact-sql)|<span data-ttu-id="b018a-158">Recupera i nomi dei database secondari per un database primario.</span><span class="sxs-lookup"><span data-stu-id="b018a-158">Retrieves secondary database names for a primary database.</span></span>|<span data-ttu-id="b018a-159">Server primario</span><span class="sxs-lookup"><span data-stu-id="b018a-159">Primary server</span></span>|  
|[<span data-ttu-id="b018a-160">sp_help_log_shipping_secondary_database</span><span class="sxs-lookup"><span data-stu-id="b018a-160">sp_help_log_shipping_secondary_database</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-secondary-database-transact-sql)|<span data-ttu-id="b018a-161">Recupera le impostazioni del database secondario dalle tabelle **log_shipping_secondary**, **log_shipping_secondary_databases** e **log_shipping_monitor_secondary** .</span><span class="sxs-lookup"><span data-stu-id="b018a-161">Retrieves secondary-database settings from the **log_shipping_secondary**, **log_shipping_secondary_databases** and **log_shipping_monitor_secondary** tables.</span></span>|<span data-ttu-id="b018a-162">Server secondario</span><span class="sxs-lookup"><span data-stu-id="b018a-162">Secondary server</span></span>|  
|[<span data-ttu-id="b018a-163">sp_help_log_shipping_secondary_primary &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b018a-163">sp_help_log_shipping_secondary_primary &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-secondary-primary-transact-sql)|<span data-ttu-id="b018a-164">Tramite questa stored procedure vengono recuperate le impostazioni di un database primario specificato nel server secondario.</span><span class="sxs-lookup"><span data-stu-id="b018a-164">This stored procedure retrieves the settings for a given primary database on the secondary server.</span></span>|<span data-ttu-id="b018a-165">Server secondario</span><span class="sxs-lookup"><span data-stu-id="b018a-165">Secondary server</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="b018a-166">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="b018a-166">See Also</span></span>  
 <span data-ttu-id="b018a-167">[Visualizzare il report di log shipping &#40;SQL Server Management Studio&#41;](view-the-log-shipping-report-sql-server-management-studio.md) </span><span class="sxs-lookup"><span data-stu-id="b018a-167">[View the Log Shipping Report &#40;SQL Server Management Studio&#41;](view-the-log-shipping-report-sql-server-management-studio.md) </span></span>  
 [<span data-ttu-id="b018a-168">Stored procedure e tabelle per il log shipping</span><span class="sxs-lookup"><span data-stu-id="b018a-168">Log Shipping Stored Procedures and Tables</span></span>](log-shipping-tables-and-stored-procedures.md)  
  
  
