---
title: Opzione di configurazione del server affinity mask | Microsoft Docs
ms.custom: ''
ms.date: 10/20/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- default affinity mask option
- reloading processor cache
- processor cache [SQL Server]
- CPU [SQL Server], licensing
- deferred process call
- affinity mask option
- processor affinity [SQL Server]
- SMP
- DPC
ms.assetid: 5823ba29-a75d-4b3e-ba7b-421c07ab3ac1
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: dfebde8a9431026e8faedb2a1e76eb2f2d82e207
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87630058"
---
# <a name="affinity-mask-server-configuration-option"></a><span data-ttu-id="7651e-102">Opzione di configurazione del server affinity mask</span><span class="sxs-lookup"><span data-stu-id="7651e-102">affinity mask Server Configuration Option</span></span>
    
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureDontUse](../../includes/ssnotedepfuturedontuse-md.md)] <span data-ttu-id="7651e-103">Usare invece [ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-server-configuration-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7651e-103">Use [ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-server-configuration-transact-sql) instead.</span></span>  
  
 <span data-ttu-id="7651e-104">Per eseguire il multitasking, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows sposta talvolta thread tra processori diversi.</span><span class="sxs-lookup"><span data-stu-id="7651e-104">To carry out multitasking, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows sometimes move process threads among different processors.</span></span> <span data-ttu-id="7651e-105">Sebbene in questo modo venga garantita una maggiore efficienza del sistema operativo, questa attività può comportare una riduzione delle prestazioni di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] nel caso di carichi di lavoro elevati, poiché la cache di ogni processore viene ricaricata più volte con dati.</span><span class="sxs-lookup"><span data-stu-id="7651e-105">Although efficient from an operating system point of view, this activity can reduce [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] performance under heavy system loads, as each processor cache is repeatedly reloaded with data.</span></span> <span data-ttu-id="7651e-106">In tali casi, l'assegnazione dei processori a thread specifici consente di aumentare le prestazioni, in quanto le operazioni di ricaricamento dei processori vengono eliminate e si riduce la migrazione dei thread tra i processori, limitando lo scambio di contesto. Questo tipo di associazione tra un thread e un processore è definito "affinità processori".</span><span class="sxs-lookup"><span data-stu-id="7651e-106">Assigning processors to specific threads can improve performance under these conditions by eliminating processor reloads and reducing thread migration across processors (thereby reducing context switching); such an association between a thread and a processor is called processor affinity.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]<span data-ttu-id="7651e-107">supporta l'affinità processori per mezzo di due opzioni affinity mask: affinity mask (nota anche come **CPU affinity mask**) e affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="7651e-107">supports processor affinity by means of two affinity mask options: affinity mask (also known as **CPU affinity mask**) and affinity I/O mask.</span></span> <span data-ttu-id="7651e-108">Per altre informazioni sull'opzione Affinity I/O mask, vedere [Opzione di configurazione del server Affinity Input-Output](affinity-input-output-mask-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="7651e-108">For more information on the affinity I/O maskoption, see [affinity Input-Output mask Server Configuration Option](affinity-input-output-mask-server-configuration-option.md).</span></span> <span data-ttu-id="7651e-109">Il supporto di Affinity CPU e I/O per server con 33 fino a 64 processori richiede rispettivamente l'uso aggiuntivo dell'[opzione di configurazione del server affinity64 mask](affinity64-mask-server-configuration-option.md) e dell'[opzione di configurazione del server affinity64 Input-Output mask](affinity64-input-output-mask-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="7651e-109">CPU and I/O affinity support for servers with 33 to 64 processors requires the additional use of the [affinity64 mask Server Configuration Option](affinity64-mask-server-configuration-option.md) and [affinity64 Input-Output mask Server Configuration Option](affinity64-input-output-mask-server-configuration-option.md), respectively.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7651e-110">Il supporto dell'affinità nei server dotati di un numero di processori compreso tra 33 e 64 è disponibile solo su sistemi operativi a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="7651e-110">Affinity support for servers with 33 to 64 processors is only available on 64-bit operating systems.</span></span>  
  
 <span data-ttu-id="7651e-111">L'opzione affinity mask, disponibile nelle versioni precedenti di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], controlla in modo dinamico l'affinità di CPU.</span><span class="sxs-lookup"><span data-stu-id="7651e-111">The affinity mask option, which existed in earlier releases of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], dynamically controls CPU affinity.</span></span>  
  
 <span data-ttu-id="7651e-112">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] è possibile configurare l'opzione affinity mask senza che sia necessario riavviare l'istanza [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7651e-112">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the affinity mask option can be configured without requiring a restart of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7651e-113">Quando si utilizza sp_configure è necessario eseguire RECONFIGURE oppure RECONFIGURE WITH OVERRIDE dopo aver impostato un'opzione di configurazione.</span><span class="sxs-lookup"><span data-stu-id="7651e-113">When you are using sp_configure, you must run either RECONFIGURE or RECONFIGURE WITH OVERRIDE after setting a configuration option.</span></span> <span data-ttu-id="7651e-114">Se si utilizza [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], la modifica dell'opzione affinity mask non richiede il riavvio.</span><span class="sxs-lookup"><span data-stu-id="7651e-114">When you are using [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], changing the affinity mask option does require a restart.</span></span>  
  
 <span data-ttu-id="7651e-115">Le modifiche alle maschere di affinità vengono eseguite in modo dinamico, consentendo l'avvio e l'arresto a richiesta delle utilità di pianificazione della CPU che associano i thread dei processi all'interno di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7651e-115">Changes to the affinity masks occur dynamically, allowing for on-demand startup and shutdown of the CPU schedulers that bind process threads within [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7651e-116">Questa situazione si può verificare quando le condizioni nel server vengono modificate.</span><span class="sxs-lookup"><span data-stu-id="7651e-116">This can occur as conditions change on the server.</span></span> <span data-ttu-id="7651e-117">Ad esempio, se nel server viene aggiunta una nuova istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], potrebbe essere necessario modificare l'opzione affinity mask per ridistribuire il carico dei processori.</span><span class="sxs-lookup"><span data-stu-id="7651e-117">For example, if a new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is added to the server, it may be necessary to make adjustments to the affinity mask option to redistribute processor load.</span></span>  
  
 <span data-ttu-id="7651e-118">Per le modifiche alle maschere di bit di affinità, è necessario che [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] abiliti una nuova utilità di pianificazione della CPU e disabiliti quella esistente.</span><span class="sxs-lookup"><span data-stu-id="7651e-118">Modifications to the affinity bitmasks require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to enable a new CPU scheduler and disable the existing CPU scheduler.</span></span> <span data-ttu-id="7651e-119">È quindi possibile elaborare nuovi batch nelle nuove utilità di pianificazione o in quelle rimanenti.</span><span class="sxs-lookup"><span data-stu-id="7651e-119">New batches can then be processed on the new or remaining schedulers.</span></span>  
  
 <span data-ttu-id="7651e-120">Per avviare una nuova utilità di pianificazione della CPU, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] crea una nuova utilità di pianificazione e la aggiunge all'elenco di quelle standard.</span><span class="sxs-lookup"><span data-stu-id="7651e-120">To start a new CPU scheduler, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] creates a new scheduler and adds it to the list of its standard schedulers.</span></span> <span data-ttu-id="7651e-121">La nuova utilità di pianificazione viene presa in considerazione unicamente per i nuovi batch in entrata.</span><span class="sxs-lookup"><span data-stu-id="7651e-121">The new scheduler is considered only for the new incoming batches.</span></span> <span data-ttu-id="7651e-122">L'esecuzione dei batch correnti continua nella stessa utilità di pianificazione.</span><span class="sxs-lookup"><span data-stu-id="7651e-122">Current batches continue to run on the same scheduler.</span></span> <span data-ttu-id="7651e-123">I thread di lavoro migrano alla nuova utilità di pianificazione man mano che si liberano o che ne vengono creati di nuovi.</span><span class="sxs-lookup"><span data-stu-id="7651e-123">The workers migrate to the new scheduler as they free up, or as new workers are created.</span></span>  
  
 <span data-ttu-id="7651e-124">Per chiudere un'utilità di pianificazione, è necessario che tutti i batch nell'utilità abbiano completato le relative attività e interrompano l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="7651e-124">Shutting down a scheduler requires all batches on the scheduler to complete their activities and exit.</span></span> <span data-ttu-id="7651e-125">Un'utilità di pianificazione che è stata chiusa viene contrassegnata come offline, in modo che non venga pianificato alcun nuovo batch su di essa.</span><span class="sxs-lookup"><span data-stu-id="7651e-125">A scheduler that has been shut down is marked as offline so that no new batch is scheduled on it.</span></span>  
  
 <span data-ttu-id="7651e-126">Se viene aggiunta o rimossa una nuova utilità di pianificazione, le attività di sistema permanenti quali lockmonitor, checkpoint, i thread delle attività di sistema (elaborazione DTC) e signal process proseguono l'esecuzione mentre il server è operativo.</span><span class="sxs-lookup"><span data-stu-id="7651e-126">Whether a new scheduler is added or removed, the permanent system tasks such as lockmonitor, checkpoint, system task thread (processing DTC), and signal process continue to run on the scheduler while the server is operational.</span></span> <span data-ttu-id="7651e-127">Queste attività di sistema permanenti non eseguono la migrazione in modo dinamico.</span><span class="sxs-lookup"><span data-stu-id="7651e-127">These permanent system tasks do not dynamically migrate.</span></span> <span data-ttu-id="7651e-128">Per ridistribuire il carico del processore di queste attività nelle utilità di pianificazione, è necessario riavviare l'istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="7651e-128">To redistribute processor load for these system tasks across schedulers, it is necessary to restart the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="7651e-129">Se [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tenta di chiudere un'utilità di pianificazione associata a un'attività di sistema permanente, l'esecuzione dell'attività continua nell'utilità di pianificazione offline (nessuna migrazione).</span><span class="sxs-lookup"><span data-stu-id="7651e-129">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] attempts to shut down a scheduler associated with a permanent system task, the task continues to run on the offline scheduler (no migration).</span></span> <span data-ttu-id="7651e-130">L'utilità di pianificazione è associata ai processori nella maschera di affinità modificata e non dovrebbe applicare alcun carico al processore con il quale è stata creata l'affinità prima della modifica.</span><span class="sxs-lookup"><span data-stu-id="7651e-130">This scheduler is bound to the processors in the modified affinity mask and should not put any load on the processor it was affinitized with before the change.</span></span> <span data-ttu-id="7651e-131">La presenza di utilità di pianificazione offline aggiuntive non dovrebbe influire in modo significativo sul carico del sistema.</span><span class="sxs-lookup"><span data-stu-id="7651e-131">Having extra offline schedulers, should not significantly affect the load of the system.</span></span> <span data-ttu-id="7651e-132">In caso contrario, per riconfigurare queste attività è necessario riavviare il server di database.</span><span class="sxs-lookup"><span data-stu-id="7651e-132">If this is not the case, a database server reboot is required to reconfigure these tasks.</span></span>  
  
 <span data-ttu-id="7651e-133">La maschera di affinità di I/O influisce direttamente sui processi di affinità di I/O, ad esempio i processi Lazywriter e i thread per la scrittura nel log.</span><span class="sxs-lookup"><span data-stu-id="7651e-133">The I/O affinity tasks (such as lazywriter and logwriter) are directly affected by the I/O affinity mask.</span></span> <span data-ttu-id="7651e-134">Se per i processi Lazywriter e i thread per la scrittura nel log non viene creata un'affinità, essi seguono le stesse regole definite per le attività permanenti, ad esempio lockmonitor o checkpoint.</span><span class="sxs-lookup"><span data-stu-id="7651e-134">If the lazywriter and logwriter tasks are not affinitized, they follow the same rules defined for the other permanent tasks such as lockmonitor or checkpoint.</span></span>  
  
 <span data-ttu-id="7651e-135">Per garantire che la nuova maschera di affinità sia valida, il comando RECONFIGURE verifica che le affinità di CPU e I/O si escludano a vicenda.</span><span class="sxs-lookup"><span data-stu-id="7651e-135">To ensure that the new affinity mask is valid, the RECONFIGURE command verifies that the normal CPU and I/O affinities are mutually exclusive.</span></span> <span data-ttu-id="7651e-136">In caso contrario, nella sessione del client e nel log degli errori di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] viene visualizzato un messaggio di errore che indica che l'impostazione non è corretta.</span><span class="sxs-lookup"><span data-stu-id="7651e-136">If this is not the case, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, indicating that such a setting is not recommended.</span></span> <span data-ttu-id="7651e-137">Per consentire affinità di CPU e di I/O che non si escludono a vicenda, è possibile eseguire le opzioni RECONFIGURE WITH OVERRIDE.</span><span class="sxs-lookup"><span data-stu-id="7651e-137">Running RECONFIGURE WITH OVERRIDE options allows CPU and I/O affinities that are not mutually exclusive.</span></span>  
  
 <span data-ttu-id="7651e-138">Se si specifica una maschera di affinità che tenta di eseguire il mapping a una CPU non esistente, il comando RECONFIGURE visualizza un messaggio di errore nella sessione client e nel log degli errori di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7651e-138">If you specify an affinity mask that attempts to map to a nonexistent CPU, the RECONFIGURE command reports an error message to both the client session and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span> <span data-ttu-id="7651e-139">In questo caso, l'utilizzo dell'opzione RECONFIGURE WITH OVERRIDE non avrà alcun effetto e verrà visualizzato di nuovo lo stesso errore di configurazione.</span><span class="sxs-lookup"><span data-stu-id="7651e-139">Using the RECONFIGURE WITH OVERRIDE option has no effect in this case, and the same configuration error is reported again.</span></span>  
  
 <span data-ttu-id="7651e-140">È inoltre possibile escludere l'attività di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] da processori ai quali sono stati assegnati carichi di lavoro specifici nei sistemi operativi Windows 2000 o Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="7651e-140">You can also exclude [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] activity from processors assigned specific workload assignments by the Windows 2000 or Windows Server 2003 operating system.</span></span> <span data-ttu-id="7651e-141">Se si imposta su 1 un bit corrispondente a un processore, il processore viene selezionato dal Motore di database di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] per l'assegnazione di thread.</span><span class="sxs-lookup"><span data-stu-id="7651e-141">If you set a bit representing a processor to 1, that processor is selected by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Database Engine for thread assignment.</span></span> <span data-ttu-id="7651e-142">Quando si imposta `affinity mask` su 0 (impostazione predefinita), l'affinità del thread viene impostata dagli algoritmi di pianificazione di Microsoft windows 2000 o Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="7651e-142">When you set `affinity mask` to 0 (the default), the Microsoft Windows 2000 or Windows Server 2003 scheduling algorithms set the thread's affinity.</span></span> <span data-ttu-id="7651e-143">Se l'opzione `affinity mask` viene impostata su un valore diverso da zero, l'affinità di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] interpreta il valore come maschera di bit indicante i processori selezionabili.</span><span class="sxs-lookup"><span data-stu-id="7651e-143">When you set `affinity mask` to any nonzero value, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] affinity interprets the value as a bitmask that specifies those processors eligible for selection.</span></span>  
  
 <span data-ttu-id="7651e-144">L'esclusione dei thread [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] da processori specifici consente a Microsoft Windows 2000 o Windows Server 2003 di valutare adeguatamente la gestione dei processi specifici di Windows.</span><span class="sxs-lookup"><span data-stu-id="7651e-144">By segregating [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] threads from running on particular processors, Microsoft Windows 2000 or Windows Server 2003 can better evaluate the system's handling of processes specific to Windows.</span></span> <span data-ttu-id="7651e-145">Ad esempio, per un server con 8 CPU nel quale sono in esecuzione due istanze di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (istanza A e B), l'amministratore di sistema può utilizzare l'opzione affinity mask per assegnare il primo set di 4 CPU all'istanza A e il secondo set di 4 CPU all'istanza B. Per configurare più di 32 processori, impostare entrambe le opzioni affinity mask e affinity64 mask.</span><span class="sxs-lookup"><span data-stu-id="7651e-145">For example, on an 8-CPU server running two instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (instance A and B), the system administrator could use the affinity mask option to assign the first set of 4 CPUs to instance A and the second set of 4 to instance B. To configure more than 32 processors, set both the affinity mask and the affinity64 mask.</span></span> <span data-ttu-id="7651e-146">I valori per l'opzione `affinity mask` sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="7651e-146">The values for `affinity mask` are as follows:</span></span>  
  
-   <span data-ttu-id="7651e-147">Un valore `affinity mask` da 1 byte comprende fino a 8 CPU in un computer multiprocessore.</span><span class="sxs-lookup"><span data-stu-id="7651e-147">A one-byte `affinity mask` covers up to 8 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="7651e-148">Un valore `affinity mask` da 2 byte consente di coprire fino a 16 CPU in un computer multiprocessore.</span><span class="sxs-lookup"><span data-stu-id="7651e-148">A two-byte `affinity mask` covers up to 16 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="7651e-149">Un valore `affinity mask` da 3 byte consente di coprire fino a 24 CPU in un computer multiprocessore.</span><span class="sxs-lookup"><span data-stu-id="7651e-149">A three-byte `affinity mask` covers up to 24 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="7651e-150">Un valore `affinity mask` da 4 byte consente di coprire fino a 32 CPU in un computer multiprocessore.</span><span class="sxs-lookup"><span data-stu-id="7651e-150">A four-byte `affinity mask` covers up to 32 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="7651e-151">Per coprire più di 32 CPU, configurare un valore affinity mask da 4 byte per le prime 32 CPU e un valore affinity64 mask da 4 byte per le CPU rimanenti.</span><span class="sxs-lookup"><span data-stu-id="7651e-151">To cover more than 32 CPUs, configure a four-byte affinity mask for the first 32 CPUs and up to a four-byte affinity64 mask for the remaining CPUs.</span></span>  
  
 <span data-ttu-id="7651e-152">L'impostazione dell'affinità processori di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] è un'operazione estremamente complessa, pertanto è consigliabile eseguirla unicamente se è necessario.</span><span class="sxs-lookup"><span data-stu-id="7651e-152">Because setting [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] processor affinity is a specialized operation, it is recommended that it be used only when necessary.</span></span> <span data-ttu-id="7651e-153">Nella maggior parte dei casi, l'affinità predefinita di Microsoft Windows 2000 o Windows Server 2003 offre le migliori prestazioni.</span><span class="sxs-lookup"><span data-stu-id="7651e-153">In most cases, the Microsoft Windows 2000 or Windows Server 2003 default affinity provides the best performance.</span></span> <span data-ttu-id="7651e-154">Quando si impostano le maschere di affinità, è inoltre consigliabile tenere in considerazione i requisiti delle CPU delle altre applicazioni.</span><span class="sxs-lookup"><span data-stu-id="7651e-154">You should also consider the CPU requirements for other applications when setting the affinity masks.</span></span> <span data-ttu-id="7651e-155">Per ulteriori informazioni, consultare la documentazione di Windows.</span><span class="sxs-lookup"><span data-stu-id="7651e-155">For more information, see your Windows operating system documentation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7651e-156">Per visualizzare e analizzare l'utilizzo dei singoli processori, è possibile utilizzare Monitor di sistema di Windows.</span><span class="sxs-lookup"><span data-stu-id="7651e-156">You can use the Windows System Monitor to view and analyze individual processor usage.</span></span>  
  
 <span data-ttu-id="7651e-157">Quando si specifica l'opzione affinity I/O mask, essa deve essere utilizzata insieme all'opzione di configurazione affinity mask.</span><span class="sxs-lookup"><span data-stu-id="7651e-157">When specifying the affinity I/O mask option, you must use it in connection with the affinity mask configuration option.</span></span> <span data-ttu-id="7651e-158">Non abilitare la stessa CPU in entrambe le opzioni `affinity mask` e affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="7651e-158">Do not enable the same CPU in both the `affinity mask` switch and the affinity I/O mask option.</span></span> <span data-ttu-id="7651e-159">Lo stato dei bit corrispondenti a ogni CPU deve essere uno dei tre seguenti:</span><span class="sxs-lookup"><span data-stu-id="7651e-159">The bits corresponding to each CPU should be in one of these three states:</span></span>  
  
-   <span data-ttu-id="7651e-160">0 in entrambe le opzioni affinity mask e affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="7651e-160">0 in both the affinity mask option and the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="7651e-161">1 nell'opzione affinity mask e 0 nell'opzione affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="7651e-161">1 in the affinity mask option and 0 in the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="7651e-162">0 nell'opzione affinity mask e 1 nell'opzione affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="7651e-162">0 in the affinity mask option and 1 in the affinity I/O mask option.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="7651e-163">Non configurare l'affinità di CPU nel sistema operativo Windows e contemporaneamente l'opzione affinity mask in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7651e-163">Do not configure CPU affinity in the Windows operating system and also configure the affinity mask in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7651e-164">Le due impostazioni mirano a ottenere lo stesso risultato e, se le configurazioni sono incoerenti, potrebbero causare risultati imprevisti.</span><span class="sxs-lookup"><span data-stu-id="7651e-164">These settings are attempting to achieve the same result, and if the configurations are inconsistent, you may have unpredictable results.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7651e-165">La configurazione ottimale dell'affinità di CPU in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] può essere ottenuta usando l'opzione sp_configure.</span><span class="sxs-lookup"><span data-stu-id="7651e-165">CPU affinity is best configured using the sp_configure option in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="example"></a><span data-ttu-id="7651e-166">Esempio</span><span class="sxs-lookup"><span data-stu-id="7651e-166">Example</span></span>  
 <span data-ttu-id="7651e-167">Si supponga di configurare l'opzione affinity mask. Se, ad esempio, i processori 1, 2 e 5 sono selezionati come disponibili tramite l'impostazione dei bit 1, 2 e 5 su 1 e l'impostazione dei bit 0, 3, 4, 6 e 7 su 0, viene specificato il valore esadecimale 0x26 oppure l'equivalente decimale `38` .</span><span class="sxs-lookup"><span data-stu-id="7651e-167">As an example of setting the affinity mask option, if processors 1, 2, and 5 are selected as available with bits 1, 2, and 5 set to 1 and bits 0, 3, 4, 6, and 7 set to 0, a hexadecimal value of 0x26 or the decimal equivalent of `38` is specified.</span></span> <span data-ttu-id="7651e-168">Numerare i bit da destra a sinistra.</span><span class="sxs-lookup"><span data-stu-id="7651e-168">Number the bits from right to left.</span></span> <span data-ttu-id="7651e-169">L'opzione affinity mask inizia a contare i processori da 0 a 31. Nell'esempio seguente il contatore `1` rappresenta il secondo processore nel server.</span><span class="sxs-lookup"><span data-stu-id="7651e-169">The affinity mask option starts counting processors from 0 to 31, so that in the following example the counter `1` represents the second processor on the server.</span></span>  
  
```  
sp_configure 'show advanced options', 1;  
RECONFIGURE;  
GO  
sp_configure 'affinity mask', 38;  
RECONFIGURE;  
GO  
```  
  
 <span data-ttu-id="7651e-170">Di seguito sono riportati i valori `affinity mask` per un sistema con 8 CPU.</span><span class="sxs-lookup"><span data-stu-id="7651e-170">These are `affinity mask` values for an 8-CPU system.</span></span>  
  
|<span data-ttu-id="7651e-171">Valore decimale</span><span class="sxs-lookup"><span data-stu-id="7651e-171">Decimal value</span></span>|<span data-ttu-id="7651e-172">Maschera di bit binaria</span><span class="sxs-lookup"><span data-stu-id="7651e-172">Binary bit mask</span></span>|<span data-ttu-id="7651e-173">Numeri dei processori in cui vengono eseguiti i thread di SQL Server</span><span class="sxs-lookup"><span data-stu-id="7651e-173">Allow SQL Server threads on processors</span></span>|  
|-------------------|---------------------|--------------------------------------------|  
|<span data-ttu-id="7651e-174">1</span><span class="sxs-lookup"><span data-stu-id="7651e-174">1</span></span>|<span data-ttu-id="7651e-175">00000001</span><span class="sxs-lookup"><span data-stu-id="7651e-175">00000001</span></span>|<span data-ttu-id="7651e-176">0</span><span class="sxs-lookup"><span data-stu-id="7651e-176">0</span></span>|  
|<span data-ttu-id="7651e-177">3</span><span class="sxs-lookup"><span data-stu-id="7651e-177">3</span></span>|<span data-ttu-id="7651e-178">00000011</span><span class="sxs-lookup"><span data-stu-id="7651e-178">00000011</span></span>|<span data-ttu-id="7651e-179">0 e 1</span><span class="sxs-lookup"><span data-stu-id="7651e-179">0 and 1</span></span>|  
|<span data-ttu-id="7651e-180">7</span><span class="sxs-lookup"><span data-stu-id="7651e-180">7</span></span>|<span data-ttu-id="7651e-181">00000111</span><span class="sxs-lookup"><span data-stu-id="7651e-181">00000111</span></span>|<span data-ttu-id="7651e-182">0, 1 e 2</span><span class="sxs-lookup"><span data-stu-id="7651e-182">0, 1, and 2</span></span>|  
|<span data-ttu-id="7651e-183">15</span><span class="sxs-lookup"><span data-stu-id="7651e-183">15</span></span>|<span data-ttu-id="7651e-184">00001111</span><span class="sxs-lookup"><span data-stu-id="7651e-184">00001111</span></span>|<span data-ttu-id="7651e-185">0, 1, 2 e 3</span><span class="sxs-lookup"><span data-stu-id="7651e-185">0, 1, 2, and 3</span></span>|  
|<span data-ttu-id="7651e-186">31</span><span class="sxs-lookup"><span data-stu-id="7651e-186">31</span></span>|<span data-ttu-id="7651e-187">00011111</span><span class="sxs-lookup"><span data-stu-id="7651e-187">00011111</span></span>|<span data-ttu-id="7651e-188">0, 1, 2, 3 e 4</span><span class="sxs-lookup"><span data-stu-id="7651e-188">0, 1, 2, 3, and 4</span></span>|  
|<span data-ttu-id="7651e-189">63</span><span class="sxs-lookup"><span data-stu-id="7651e-189">63</span></span>|<span data-ttu-id="7651e-190">00111111</span><span class="sxs-lookup"><span data-stu-id="7651e-190">00111111</span></span>|<span data-ttu-id="7651e-191">0, 1, 2, 3, 4 e 5</span><span class="sxs-lookup"><span data-stu-id="7651e-191">0, 1, 2, 3, 4, and 5</span></span>|  
|<span data-ttu-id="7651e-192">127</span><span class="sxs-lookup"><span data-stu-id="7651e-192">127</span></span>|<span data-ttu-id="7651e-193">01111111</span><span class="sxs-lookup"><span data-stu-id="7651e-193">01111111</span></span>|<span data-ttu-id="7651e-194">0, 1, 2, 3, 4, 5 e 6</span><span class="sxs-lookup"><span data-stu-id="7651e-194">0, 1, 2, 3, 4, 5, and 6</span></span>|  
|<span data-ttu-id="7651e-195">255</span><span class="sxs-lookup"><span data-stu-id="7651e-195">255</span></span>|<span data-ttu-id="7651e-196">11111111</span><span class="sxs-lookup"><span data-stu-id="7651e-196">11111111</span></span>|<span data-ttu-id="7651e-197">0, 1, 2, 3, 4, 5, 6 e 7</span><span class="sxs-lookup"><span data-stu-id="7651e-197">0, 1, 2, 3, 4, 5, 6, and 7</span></span>|  
  
 <span data-ttu-id="7651e-198">affinity mask è un'opzione avanzata.</span><span class="sxs-lookup"><span data-stu-id="7651e-198">The affinity mask option is an advanced option.</span></span> <span data-ttu-id="7651e-199">Se si utilizza il sistema sp_configure stored procedure per modificare l'impostazione, è possibile modificare `affinity mask` solo quando il valore di **Show Advanced Options** è impostato su 1.</span><span class="sxs-lookup"><span data-stu-id="7651e-199">If you are using the sp_configure system stored procedure to change the setting, you can change `affinity mask` only when **show advanced options** is set to 1.</span></span> <span data-ttu-id="7651e-200">Dopo aver eseguito il comando [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE, la nuova impostazione viene applicata immediatamente senza che sia necessario riavviare l'istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="7651e-200">After executing the [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, the new setting takes effect immediately without requiring a restart of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
## <a name="non-uniform-memory-access-numa"></a><span data-ttu-id="7651e-201">Configurazione NUMA (Non-Uniform Memory Access)</span><span class="sxs-lookup"><span data-stu-id="7651e-201">Non-uniform Memory Access (NUMA)</span></span>  
 <span data-ttu-id="7651e-202">Quando si utilizza hardware basato sulla configurazione NUMA ed è impostata l'opzione affinity mask, verrà creata un'affinità fra tutte le utilità di pianificazione di un nodo e la rispettiva CPU.</span><span class="sxs-lookup"><span data-stu-id="7651e-202">When using hardware based non-uniform memory access (NUMA) and the affinity mask is set, every scheduler in a node will be affinitized to its own CPU.</span></span> <span data-ttu-id="7651e-203">Quando l'opzione affinity mask non è impostata, viene creata un'affinità tra le utilità di pianificazione e il gruppo di CPU contenute nel nodo NUMA. Un'utilità di pianificazione di cui viene eseguito il mapping al nodo NUMA N1 potrà pianificare operazioni in qualsiasi CPU del nodo, ma non nelle CPU associate a un altro nodo.</span><span class="sxs-lookup"><span data-stu-id="7651e-203">When the affinity mask is not set, each scheduler is affinitized to the group of CPUs within the NUMA node and a scheduler mapped to NUMA node N1 can schedule work on any CPU in the node, but not on CPUs associated with another node.</span></span>  
  
 <span data-ttu-id="7651e-204">Le operazioni eseguite in un solo nodo NUMA possono utilizzare solo pagine del buffer di tale nodo.</span><span class="sxs-lookup"><span data-stu-id="7651e-204">Any operation running on a single NUMA node can only use buffer pages from that node.</span></span> <span data-ttu-id="7651e-205">Quando un'operazione viene eseguita in parallelo sulle CPU di più nodi, è possibile utilizzare la memoria di tutti i nodi coinvolti.</span><span class="sxs-lookup"><span data-stu-id="7651e-205">When an operation is run in parallel on CPUs from multiple nodes, memory can be used from any node involved.</span></span>  
  
## <a name="licensing-issues"></a><span data-ttu-id="7651e-206">Problemi relativi alle licenze</span><span class="sxs-lookup"><span data-stu-id="7651e-206">Licensing Issues</span></span>  
 <span data-ttu-id="7651e-207">L'affinità dinamica è strettamente correlata alle licenze per le CPU.</span><span class="sxs-lookup"><span data-stu-id="7651e-207">Dynamic affinity is tightly constrained by CPU licensing.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7651e-208">non consente di configurare le opzioni affinity mask in modo da violare i criteri di licenza.</span><span class="sxs-lookup"><span data-stu-id="7651e-208">does not allow any configuration of affinity mask options that violates the licensing policy.</span></span>  
  
### <a name="startup"></a><span data-ttu-id="7651e-209">Avvio</span><span class="sxs-lookup"><span data-stu-id="7651e-209">Startup</span></span>  
 <span data-ttu-id="7651e-210">Se un'opzione affinity mask specificata viola i criteri di licenza durante l'avvio di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] o durante il collegamento di database, il livello del motore completerà il processo di avvio o l'operazione di collegamento o ripristino del database e successivamente reimposterà il valore di esecuzione di sp_configure per l'opzione affinity mask su zero, visualizzando un messaggio di errore nel log degli errori di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7651e-210">If a specified affinity mask violates the licensing policy during [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] startup or during database attach, the engine layer will complete the startup process or database attach/restore operation, and then it will reset the sp_configure run value for the affinity mask to zero, issuing an error message to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span>  
  
### <a name="reconfigure"></a><span data-ttu-id="7651e-211">Riconfigurare</span><span class="sxs-lookup"><span data-stu-id="7651e-211">Reconfigure</span></span>  
 <span data-ttu-id="7651e-212">Se un'opzione affinity mask specificata viola i criteri di licenza durante l'esecuzione del comando [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE, nella sessione client e nel log degli errori di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] verrà visualizzato un messaggio di errore che richiede all'amministratore del database di riconfigurare l'opzione.</span><span class="sxs-lookup"><span data-stu-id="7651e-212">If a specified affinity mask violates the licensing policy when running [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, requiring the database administrator to reconfigure the affinity mask.</span></span> <span data-ttu-id="7651e-213">In questo caso il comando RECONFIGURE WITH OVERRIDE non verrà accettato.</span><span class="sxs-lookup"><span data-stu-id="7651e-213">No RECONFIGURE WITH OVERRIDE command is accepted in this case.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7651e-214">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="7651e-214">See Also</span></span>  
 <span data-ttu-id="7651e-215">[Monitoraggio dell'utilizzo delle risorse &#40;Monitor di sistema&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span><span class="sxs-lookup"><span data-stu-id="7651e-215">[Monitor Resource Usage &#40;System Monitor&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span></span>  
 <span data-ttu-id="7651e-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="7651e-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span></span>  
 <span data-ttu-id="7651e-217">[Opzioni di configurazione del server &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="7651e-217">[Server Configuration Options &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span></span>  
 <span data-ttu-id="7651e-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="7651e-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span></span>  
 [<span data-ttu-id="7651e-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7651e-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-server-configuration-transact-sql)  
  
  
