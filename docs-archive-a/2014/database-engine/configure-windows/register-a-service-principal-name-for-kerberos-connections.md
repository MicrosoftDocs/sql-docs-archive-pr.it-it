---
title: Registrazione di un nome dell'entità servizio per le connessioni Kerberos | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- connections [SQL Server], SPNs
- network connections [SQL Server], SPNs
- registering SPNs
- Server Principal Names
- SPNs [SQL Server]
ms.assetid: e38d5ce4-e538-4ab9-be67-7046e0d9504e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: f4db1e8b86fca057acbce29491be9c2be91f0748
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87636388"
---
# <a name="register-a-service-principal-name-for-kerberos-connections"></a><span data-ttu-id="0200e-102">Registrazione di un nome dell'entità servizio per le connessioni Kerberos</span><span class="sxs-lookup"><span data-stu-id="0200e-102">Register a Service Principal Name for Kerberos Connections</span></span>
  <span data-ttu-id="0200e-103">Per utilizzare l'autenticazione Kerberos con [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] è necessario che si verifichino entrambe le seguenti condizioni:</span><span class="sxs-lookup"><span data-stu-id="0200e-103">To use Kerberos authentication with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] requires both the following conditions to be true:</span></span>  
  
-   <span data-ttu-id="0200e-104">I computer client e server devono fare parte dello stesso dominio Windows o di domini trusted.</span><span class="sxs-lookup"><span data-stu-id="0200e-104">The client and server computers must be part of the same Windows domain, or in trusted domains.</span></span>  
  
-   <span data-ttu-id="0200e-105">Un nome dell'entità servizio (SPN, Service Principal Name) deve essere stato registrato in Active Directory, che presuppone il ruolo del centro di distribuzione chiavi (KDC) in un dominio Windows.</span><span class="sxs-lookup"><span data-stu-id="0200e-105">A Service Principal Name (SPN) must be registered with Active Directory, which assumes the role of the Key Distribution Center in a Windows domain.</span></span> <span data-ttu-id="0200e-106">Una volta registrato, il nome SPN esegue il mapping all'account Windows che ha avviato il servizio dell'istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0200e-106">The SPN, after it is registered, maps to the Windows account that started the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance service.</span></span> <span data-ttu-id="0200e-107">Se la registrazione del nome SPN non è stata eseguita o ha avuto esito negativo, il livello di sicurezza di Windows non è in grado di determinare l'account associato al nome SPN e l'autenticazione Kerberos non verrà utilizzata.</span><span class="sxs-lookup"><span data-stu-id="0200e-107">If the SPN registration has not been performed or fails, the Windows security layer cannot determine the account associated with the SPN, and Kerberos authentication will not be used.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="0200e-108">Se il server non è in grado di eseguire la registrazione automatica del nome SPN, è necessario effettuare l'operazione manualmente.</span><span class="sxs-lookup"><span data-stu-id="0200e-108">If the server cannot automatically register the SPN, the SPN must be registered manually.</span></span> <span data-ttu-id="0200e-109">Vedere [Registrazione manuale del nome SPN](#Manual).</span><span class="sxs-lookup"><span data-stu-id="0200e-109">See [Manual SPN Registration](#Manual).</span></span>  
  
 <span data-ttu-id="0200e-110">È possibile verificare che una connessione utilizzi Kerberos eseguendo una query sulla vista a gestione dinamica sys.dm_exec_connections.</span><span class="sxs-lookup"><span data-stu-id="0200e-110">You can verify that a connection is using Kerberos by querying the sys.dm_exec_connections dynamic management view.</span></span> <span data-ttu-id="0200e-111">Eseguire la query seguente e controllare il valore della colonna auth_scheme. Se l'autenticazione Kerberos è abilitata, tale valore corrisponderà a "KERBEROS".</span><span class="sxs-lookup"><span data-stu-id="0200e-111">Run the following query and check the value of the auth_scheme column, which will be "KERBEROS" if Kerberos is enabled.</span></span>  
  
```  
SELECT auth_scheme FROM sys.dm_exec_connections WHERE session_id = @@spid ;  
```  
  
> [!TIP]  
>  <span data-ttu-id="0200e-112">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager per [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** è uno strumento di diagnostica che semplifica la risoluzione dei problemi di connettività correlati a Kerberos con [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0200e-112">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="0200e-113">Per altre informazioni, vedere [Microsoft Kerberos Configuration Manager per SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="0200e-113">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
##  <a name="the-role-of-the-spn-in-authentication"></a><a name="Role"></a> <span data-ttu-id="0200e-114">Ruolo del nome SPN nell'autenticazione</span><span class="sxs-lookup"><span data-stu-id="0200e-114">The Role of the SPN in Authentication</span></span>  
 <span data-ttu-id="0200e-115">Quando un'applicazione apre una connessione e utilizza l'autenticazione di Windows, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client passa il nome del computer di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , il nome dell'istanza ed eventualmente un nome SPN.</span><span class="sxs-lookup"><span data-stu-id="0200e-115">When an application opens a connection and uses Windows Authentication, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client passes the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] computer name, instance name and, optionally, an SPN.</span></span> <span data-ttu-id="0200e-116">Se passato dalla connessione, il nome SPN viene utilizzato senza alcuna modifica.</span><span class="sxs-lookup"><span data-stu-id="0200e-116">If the connection passes an SPN it is used without any changes.</span></span>  
  
 <span data-ttu-id="0200e-117">Se non viene passato un nome SPN, viene costruito un nome SPN predefinito in base al protocollo utilizzato, al nome del server e al nome di istanza.</span><span class="sxs-lookup"><span data-stu-id="0200e-117">If the connection does not pass an SPN, a default SPN is constructed based on the protocol used, server name, and the instance name.</span></span>  
  
 <span data-ttu-id="0200e-118">In entrambi gli scenari indicati in precedenza, il nome SPN viene inviato al centro di distribuzione chiavi per ottenere un token di sicurezza per l'autenticazione della connessione.</span><span class="sxs-lookup"><span data-stu-id="0200e-118">In both of the preceding scenarios, the SPN is sent to the Key Distribution Center to obtain a security token for authenticating the connection.</span></span> <span data-ttu-id="0200e-119">Se non è possibile ottenere un token di sicurezza, l'autenticazione utilizza NTLM.</span><span class="sxs-lookup"><span data-stu-id="0200e-119">If a security token cannot be obtained, authentication uses NTLM.</span></span>  
  
 <span data-ttu-id="0200e-120">Un nome dell'entità servizio (SPN) è il nome con cui un client identifica in modo univoco un'istanza di un servizio.</span><span class="sxs-lookup"><span data-stu-id="0200e-120">A service principal name (SPN) is the name by which a client uniquely identifies an instance of a service.</span></span> <span data-ttu-id="0200e-121">Questo nome può essere utilizzato dal servizio di autenticazione Kerberos per l'autenticazione di un servizio.</span><span class="sxs-lookup"><span data-stu-id="0200e-121">The Kerberos authentication service can use an SPN to authenticate a service.</span></span> <span data-ttu-id="0200e-122">Per connettersi a un servizio, un client individua un'istanza del servizio, compone un nome SPN per l'istanza, esegue la connessione al servizio e presenta il nome SPN al servizio per l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="0200e-122">When a client wants to connect to a service, it locates an instance of the service, composes an SPN for that instance, connects to the service, and presents the SPN for the service to authenticate.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0200e-123">Le informazioni incluse in questo argomento si applicano anche a configurazioni di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] che utilizzano il clustering.</span><span class="sxs-lookup"><span data-stu-id="0200e-123">The information that is provided in this topic also applies to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] configurations that use clustering.</span></span>  
  
 <span data-ttu-id="0200e-124">L'autenticazione di Windows è il metodo preferito per l'autenticazione in SQL Server da parte degli utenti.</span><span class="sxs-lookup"><span data-stu-id="0200e-124">Windows Authentication is the preferred method for users to authenticate to SQL Server.</span></span> <span data-ttu-id="0200e-125">I client che utilizzano l'autenticazione di Windows vengono autenticati tramite NTLM o Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0200e-125">Clients that use Windows Authentication are authenticated by either using NTLM or Kerberos.</span></span> <span data-ttu-id="0200e-126">In un ambiente Active Directory l'autenticazione Kerberos viene sempre tentata per prima.</span><span class="sxs-lookup"><span data-stu-id="0200e-126">In an Active Directory environment, Kerberos authentication is always attempted first.</span></span> <span data-ttu-id="0200e-127">L'autenticazione Kerberos non è disponibile per client [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] che utilizzano named pipe.</span><span class="sxs-lookup"><span data-stu-id="0200e-127">Kerberos authentication is not available for [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] clients using named pipes.</span></span>  
  
##  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="0200e-128">Autorizzazioni</span><span class="sxs-lookup"><span data-stu-id="0200e-128">Permissions</span></span>  
 <span data-ttu-id="0200e-129">Quando il servizio [!INCLUDE[ssDE](../../includes/ssde-md.md)] viene avviato, tenta di registrare il nome dell'entità servizio (SPN).</span><span class="sxs-lookup"><span data-stu-id="0200e-129">When the [!INCLUDE[ssDE](../../includes/ssde-md.md)] service starts, it attempts to register the Service Principal Name (SPN).</span></span> <span data-ttu-id="0200e-130">Se l'account che avvia SQL Server non ha l'autorizzazione necessaria per registrare un nome SPN in Servizi di dominio Active Directory, questa chiamata non riesce e viene registrato un messaggio di avviso nel registro eventi applicazioni nonché nel log degli errori di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0200e-130">If the account starting SQL Server doesn't have permission to register a SPN in Active Directory Domain Services, this call will fail and a warning message will be logged in the Application event log as well as the SQL Server error log.</span></span> <span data-ttu-id="0200e-131">Per registrare il nome SPN, è necessario che il [!INCLUDE[ssDE](../../includes/ssde-md.md)] venga eseguito con un account predefinito, ad esempio Sistema locale (non consigliato) o NETWORK SERVICE, oppure con un account che dispone dell'autorizzazione necessaria per registrare un nome SPN, ad esempio un account di amministratore di dominio.</span><span class="sxs-lookup"><span data-stu-id="0200e-131">To register the SPN, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] must be running under a built-in account, such as Local System (not recommended), or NETWORK SERVICE, or an account that has permission to register an SPN, such as a domain administrator account.</span></span> <span data-ttu-id="0200e-132">Quando [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] viene eseguito nel sistema operativo  [!INCLUDE[win7](../../includes/win7-md.md)] o  [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] , è possibile eseguire [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] utilizzando un account virtuale o un account dei servizi gestiti (MSA).</span><span class="sxs-lookup"><span data-stu-id="0200e-132">When [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running on the  [!INCLUDE[win7](../../includes/win7-md.md)] or  [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] operating system, you can run [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] using a virtual account or a managed service account (MSA).</span></span> <span data-ttu-id="0200e-133">Entrambi gli account virtuali e MSA possono registrare un SPN.</span><span class="sxs-lookup"><span data-stu-id="0200e-133">Both virtual accounts and MSA's can register an SPN.</span></span> <span data-ttu-id="0200e-134">Se [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] non viene eseguito con nessuno di questi account, il nome SPN non viene registrato all'avvio e l'amministratore di dominio lo dovrà registrare manualmente.</span><span class="sxs-lookup"><span data-stu-id="0200e-134">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is not running under one of these accounts, the SPN is not registered at startup and the domain administrator must register the SPN manually.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0200e-135">Quando il dominio di Windows è configurato per essere eseguito a un livello funzionale inferiore a quello di [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] Windows Server 2008 R2, l'Account dei servizi gestiti non disporrà delle autorizzazioni necessarie per registrare i nomi SPN per il servizio [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0200e-135">When the Windows domain is configured to run at less than the [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] Windows Server 2008 R2 functional level, then the Managed Service Account will not have the necessary permissions to register the SPNs for the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] service.</span></span> <span data-ttu-id="0200e-136">Se l'autenticazione Kerberos è richiesta, l'amministratore di dominio deve registrare manualmente i nomi SPN di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sull'Account dei servizi gestiti.</span><span class="sxs-lookup"><span data-stu-id="0200e-136">If Kerberos authentication is required, the Domain Administrator should manually register the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] SPNs on the Managed Service Account.</span></span>  
  
 <span data-ttu-id="0200e-137">Per altre informazioni su come concedere l'autorizzazione di lettura o scrittura per un nome SPN a un account diverso da quello di amministratore di dominio, vedere l'articolo della Knowledge Base [Utilizzo dell'autenticazione Kerberos in SQL Server](https://support.microsoft.com/kb/319723).</span><span class="sxs-lookup"><span data-stu-id="0200e-137">The KB article, [How to use Kerberos authentication in SQL Server](https://support.microsoft.com/kb/319723), contains information about how to grant read or write permission to an SPN for an account that is not a Domain Administrator.</span></span>  
  
 <span data-ttu-id="0200e-138">Maggiori informazioni sono disponibili nell'articolo [How to Implement Kerberos Constrained Delegation with SQL Server 2008](https://technet.microsoft.com/library/ee191523.aspx)(Come implementare la delega vincolata Kerberos con SQL Server 2008)</span><span class="sxs-lookup"><span data-stu-id="0200e-138">Additional information is available at [How to Implement Kerberos Constrained Delegation with SQL Server 2008](https://technet.microsoft.com/library/ee191523.aspx)</span></span>  
  
##  <a name="spn-formats"></a><a name="Formats"></a> <span data-ttu-id="0200e-139">Formati dei nomi SPN</span><span class="sxs-lookup"><span data-stu-id="0200e-139">SPN Formats</span></span>  
 <span data-ttu-id="0200e-140">A partire da [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], il formato dei nomi SPN è stato modificato per supportare l'autenticazione Kerberos con il protocollo TCP/IP, le named pipe e la memoria condivisa.</span><span class="sxs-lookup"><span data-stu-id="0200e-140">Beginning with [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], the SPN format is changed in order to support Kerberos authentication on TCP/IP, named pipes, and shared memory.</span></span> <span data-ttu-id="0200e-141">Di seguito sono riportati i formati del nome SPN supportati per le istanze denominate e predefinite.</span><span class="sxs-lookup"><span data-stu-id="0200e-141">The supported SPN formats for named and default instances are as follows.</span></span>  
  
 <span data-ttu-id="0200e-142">**Istanza denominata**</span><span class="sxs-lookup"><span data-stu-id="0200e-142">**Named instance**</span></span>  
  
-   <span data-ttu-id="0200e-143">*MSSQLSvc/FQDN*:[_porta_**|**_nomeistanza_], dove:</span><span class="sxs-lookup"><span data-stu-id="0200e-143">*MSSQLSvc/FQDN*:[_port_**|**_instancename_], where:</span></span>  
  
    -   <span data-ttu-id="0200e-144">*MSSQLSvc* è il servizio da registrare.</span><span class="sxs-lookup"><span data-stu-id="0200e-144">*MSSQLSvc* is the service that is being registered.</span></span>  
  
    -   <span data-ttu-id="0200e-145">*FQDN* è il nome di dominio completo del server.</span><span class="sxs-lookup"><span data-stu-id="0200e-145">*FQDN* is the fully qualified domain name of the server.</span></span>  
  
    -   <span data-ttu-id="0200e-146">*Port* è il numero di porta TCP.</span><span class="sxs-lookup"><span data-stu-id="0200e-146">*port* is the TCP port number.</span></span>  
  
    -   <span data-ttu-id="0200e-147">*NomeIstanza* è il nome dell' [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] istanza di.</span><span class="sxs-lookup"><span data-stu-id="0200e-147">*instancename* is the name of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
 <span data-ttu-id="0200e-148">**Istanza predefinita**</span><span class="sxs-lookup"><span data-stu-id="0200e-148">**Default instance**</span></span>  
  
-   <span data-ttu-id="0200e-149">*MSSQLSvc/FQDN*:_porta_ **|** _MSSQLSvc/FQDN_, dove:</span><span class="sxs-lookup"><span data-stu-id="0200e-149">*MSSQLSvc/FQDN*:_port_**|**_MSSQLSvc/FQDN_, where:</span></span>  
  
    -   <span data-ttu-id="0200e-150">*MSSQLSvc* è il servizio da registrare.</span><span class="sxs-lookup"><span data-stu-id="0200e-150">*MSSQLSvc* is the service that is being registered.</span></span>  
  
    -   <span data-ttu-id="0200e-151">*FQDN* è il nome di dominio completo del server.</span><span class="sxs-lookup"><span data-stu-id="0200e-151">*FQDN* is the fully qualified domain name of the server.</span></span>  
  
    -   <span data-ttu-id="0200e-152">*Port* è il numero di porta TCP.</span><span class="sxs-lookup"><span data-stu-id="0200e-152">*port* is the TCP port number.</span></span>  
  
 <span data-ttu-id="0200e-153">Per il nuovo formato del nome SPN non è necessario specificare un numero di porta.</span><span class="sxs-lookup"><span data-stu-id="0200e-153">The new SPN format does not require a port number.</span></span> <span data-ttu-id="0200e-154">Di conseguenza, un server con più porte o un protocollo che non utilizza numeri di porta può utilizzare l'autenticazione Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0200e-154">This means that a multiple-port server or a protocol that does not use port numbers can use Kerberos authentication.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0200e-155">Nel caso di una connessione TCP/IP, in cui la porta TCP è inclusa nel nome SPN, in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] è necessario abilitare il protocollo TCP perché un utente sia in grado di connettersi utilizzando l'autenticazione Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0200e-155">In the case of a TCP/IP connection, where the TCP port is included in the SPN, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must enable the TCP protocol for a user to connect by using Kerberos authentication.</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="0200e-156">MSSQLSvc/*FQDN: porta*</span><span class="sxs-lookup"><span data-stu-id="0200e-156">MSSQLSvc/*fqdn:port*</span></span>|<span data-ttu-id="0200e-157">Nome SPN predefinito generato dal provider quando si utilizza il protocollo TCP.</span><span class="sxs-lookup"><span data-stu-id="0200e-157">The provider-generated, default SPN when TCP is used.</span></span> <span data-ttu-id="0200e-158">*port* è un numero di porta TCP.</span><span class="sxs-lookup"><span data-stu-id="0200e-158">*port* is a TCP port number.</span></span>|  
|<span data-ttu-id="0200e-159">MSSQLSvc/*FQDN*</span><span class="sxs-lookup"><span data-stu-id="0200e-159">MSSQLSvc/*fqdn*</span></span>|<span data-ttu-id="0200e-160">Nome SPN predefinito generato dal provider per un'istanza predefinita quando si utilizza un protocollo diverso da TCP.</span><span class="sxs-lookup"><span data-stu-id="0200e-160">The provider-generated, default SPN for a default instance when a protocol other than TCP is used.</span></span> <span data-ttu-id="0200e-161">*FQDN* è un nome di dominio completo.</span><span class="sxs-lookup"><span data-stu-id="0200e-161">*fqdn* is a fully-qualified domain name.</span></span>|  
|<span data-ttu-id="0200e-162">MSSQLSvc/*FQDN: nomeistanza*</span><span class="sxs-lookup"><span data-stu-id="0200e-162">MSSQLSvc/*fqdn:InstanceName*</span></span>|<span data-ttu-id="0200e-163">Nome SPN predefinito generato dal provider per un'istanza denominata quando si usa un protocollo diverso da TCP.</span><span class="sxs-lookup"><span data-stu-id="0200e-163">The provider-generated, default SPN for a named instance when a protocol other than TCP is used.</span></span> <span data-ttu-id="0200e-164">*NomeIstanza* è il nome di un'istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0200e-164">*InstanceName* is the name of an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|  
  
##  <a name="automatic-spn-registration"></a><a name="Auto"></a> <span data-ttu-id="0200e-165">Registrazione automatica del nome SPN</span><span class="sxs-lookup"><span data-stu-id="0200e-165">Automatic SPN Registration</span></span>  
 <span data-ttu-id="0200e-166">Quando viene avviata un'istanza del [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] , [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tenta di registrare il nome SPN per il servizio [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0200e-166">When an instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] starts, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tries to register the SPN for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] service.</span></span> <span data-ttu-id="0200e-167">Quando l'istanza viene arrestata, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tenta di annullare la registrazione del nome SPN.</span><span class="sxs-lookup"><span data-stu-id="0200e-167">When the instance is stopped, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tries to unregister the SPN.</span></span> <span data-ttu-id="0200e-168">Per una connessione TCP/IP, il nome SPN viene registrato nel formato *MSSQLSvc/\<FQDN>* : *\<tcpport>* . Sia le istanze denominate che quella predefinita vengono registrate come *MSSQLSvc*, affidandosi al valore *\<tcpport>* per differenziare le istanze.</span><span class="sxs-lookup"><span data-stu-id="0200e-168">For a TCP/IP connection the SPN is registered in the format *MSSQLSvc/\<FQDN>*:*\<tcpport>*.Both named instances and the default instance are registered as *MSSQLSvc*, relying on the *\<tcpport>* value to differentiate the instances.</span></span>  
  
 <span data-ttu-id="0200e-169">Per altre connessioni che supportano l'autenticazione Kerberos, il nome SPN viene registrato nel formato \*MSSQLSvc/ \<FQDN> \*: *\<instancename>* per un'istanza denominata.</span><span class="sxs-lookup"><span data-stu-id="0200e-169">For other connections that support Kerberos the SPN is registered in the format *MSSQLSvc/\<FQDN>*:*\<instancename>* for a named instance.</span></span> <span data-ttu-id="0200e-170">e nel formato *MSSQLSvc/\<FQDN>* per l'istanza predefinita.</span><span class="sxs-lookup"><span data-stu-id="0200e-170">The format for registering the default instance is *MSSQLSvc/\<FQDN>*.</span></span>  
  
 <span data-ttu-id="0200e-171">Se l'account di servizio non dispone delle autorizzazioni richieste per eseguire queste azioni, potrebbe essere necessario intervenire manualmente per registrare o annullare la registrazione del nome SPN.</span><span class="sxs-lookup"><span data-stu-id="0200e-171">Manual intervention might be required to register or unregister the SPN if the service account lacks the permissions that are required for these actions.</span></span>  
  
##  <a name="manual-spn-registration"></a><a name="Manual"></a> <span data-ttu-id="0200e-172">Registrazione manuale del nome SPN</span><span class="sxs-lookup"><span data-stu-id="0200e-172">Manual SPN Registration</span></span>  
 <span data-ttu-id="0200e-173">Per registrare manualmente il nome SPN, l'amministratore deve utilizzare lo strumento Setspn.exe disponibile negli strumenti di supporto Microsoft di [!INCLUDE[winxpsvr](../../includes/winxpsvr-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0200e-173">To register the SPN manually, the administrator must use the Setspn.exe tool that is provided with the Microsoft [!INCLUDE[winxpsvr](../../includes/winxpsvr-md.md)] Support Tools.</span></span> <span data-ttu-id="0200e-174">Per altre informazioni, vedere l'articolo della Knowledge Base [Strumenti di supporto di Windows Server 2003 Service Pack 1](https://support.microsoft.com/kb/892777) .</span><span class="sxs-lookup"><span data-stu-id="0200e-174">For more information, see the [Windows Server 2003 Service Pack 1 Support Tools](https://support.microsoft.com/kb/892777) KB article.</span></span>  
  
 <span data-ttu-id="0200e-175">Setspn.exe è un'utilità della riga di comando che consente di leggere, modificare ed eliminare la proprietà della directory del nome dell'entità servizio (SPN).</span><span class="sxs-lookup"><span data-stu-id="0200e-175">Setspn.exe is a command line tool that enables you to read, modify, and delete the Service Principal Names (SPN) directory property.</span></span> <span data-ttu-id="0200e-176">Questo strumento consente inoltre di visualizzare i nomi SPN correnti, reimpostare i nomi SPN predefiniti dell'account e aggiungere o eliminare nomi SPN supplementari.</span><span class="sxs-lookup"><span data-stu-id="0200e-176">This tool also enables you to view the current SPNs, reset the account's default SPNs, and add or delete supplemental SPNs.</span></span>  
  
 <span data-ttu-id="0200e-177">Nell'esempio seguente viene illustrata la sintassi utilizzata per registrare manualmente un nome SPN per una connessione TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="0200e-177">The following example illustrates the syntax used to register manually register an SPN for a TCP/IP connection.</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com:1433 accountname  
```  
  
 <span data-ttu-id="0200e-178">**Nota** Se un nome SPN esiste già, è necessario eliminarlo prima che sia possibile registrarlo nuovamente.</span><span class="sxs-lookup"><span data-stu-id="0200e-178">**Note** If an SPN already exists, it must be deleted before it can be reregistered.</span></span> <span data-ttu-id="0200e-179">Per eseguire questa operazione, utilizzare il comando `setspn` con l'opzione `-D` .</span><span class="sxs-lookup"><span data-stu-id="0200e-179">You do this by using the `setspn` command together with the `-D` switch.</span></span> <span data-ttu-id="0200e-180">Negli esempi seguenti viene illustrato come registrare manualmente un nuovo nome SPN basato su un'istanza.</span><span class="sxs-lookup"><span data-stu-id="0200e-180">The following examples illustrate how to manually register a new instance-based SPN.</span></span> <span data-ttu-id="0200e-181">Per un'istanza predefinita, utilizzare il formato seguente:</span><span class="sxs-lookup"><span data-stu-id="0200e-181">For a default instance, use:</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com accountname  
```  
  
 <span data-ttu-id="0200e-182">Per un'istanza denominata, utilizzare il formato seguente:</span><span class="sxs-lookup"><span data-stu-id="0200e-182">For a named instance, use:</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com:instancename accountname  
```  
  
##  <a name="client-connections"></a><a name="Client"></a> <span data-ttu-id="0200e-183">Connessioni client</span><span class="sxs-lookup"><span data-stu-id="0200e-183">Client Connections</span></span>  
 <span data-ttu-id="0200e-184">I nomi SPN specificati dall'utente sono supportati nei driver client.</span><span class="sxs-lookup"><span data-stu-id="0200e-184">User-specified SPNs are supported in client drivers.</span></span> <span data-ttu-id="0200e-185">Se non viene specificato, tuttavia, il nome SPN verrà generato automaticamente in base al tipo di una connessione client.</span><span class="sxs-lookup"><span data-stu-id="0200e-185">However, if an SPN is not provided, it will be generated automatically based on the type of a client connection.</span></span> <span data-ttu-id="0200e-186">Per una connessione TCP, il formato del nome SPN è *MSSQLSvc*/*FQDN*:[*porta*] sia per le istanze denominate che per quella predefinita.</span><span class="sxs-lookup"><span data-stu-id="0200e-186">For a TCP connection, an SPN in the format *MSSQLSvc*/*FQDN*:[*port*] is used for both the named and default instances.</span></span>  
  
 <span data-ttu-id="0200e-187">Per le connessioni named pipe e Shared Memory, viene usato un nome SPN nel formato *MSSQLSvc* / *FQDN*:*NomeIstanza* per un'istanza denominata e *MSSQLSvc* / *FQDN* viene usato per l'istanza predefinita.</span><span class="sxs-lookup"><span data-stu-id="0200e-187">For named pipes and shared memory connections, an SPN in the format *MSSQLSvc*/*FQDN*:*instancename* is used for a named instance and *MSSQLSvc*/*FQDN* is used for the default instance.</span></span>  
  
 <span data-ttu-id="0200e-188">**Utilizzo di un account di servizio come nome SPN**</span><span class="sxs-lookup"><span data-stu-id="0200e-188">**Using a service account as an SPN**</span></span>  
  
 <span data-ttu-id="0200e-189">Come nome SPN è possibile utilizzare gli account di servizio,</span><span class="sxs-lookup"><span data-stu-id="0200e-189">Service accounts can be used as an SPN.</span></span> <span data-ttu-id="0200e-190">specificati mediante l'attributo di connessione per l'autenticazione Kerberos nei formati seguenti:</span><span class="sxs-lookup"><span data-stu-id="0200e-190">They are specified through the connection attribute for the Kerberos authentication and take the following formats:</span></span>  
  
-   <span data-ttu-id="0200e-191">**username@domain**o **DOMINIO\nomeutente** per un account utente di dominio</span><span class="sxs-lookup"><span data-stu-id="0200e-191">**username@domain** or **domain\username** for a domain user account</span></span>  
  
-   <span data-ttu-id="0200e-192">**computer$@domain** o **host\FQDN** per un account di dominio di computer, ad esempio Sistema locale o NETWORK SERVICES.</span><span class="sxs-lookup"><span data-stu-id="0200e-192">**machine$@domain** or **host\FQDN** for a computer domain account such as Local System or NETWORK SERVICES.</span></span>  
  
 <span data-ttu-id="0200e-193">Per determinare il metodo di autenticazione di una connessione, eseguire la query seguente.</span><span class="sxs-lookup"><span data-stu-id="0200e-193">To determine the authentication method of a connection, execute the following query.</span></span>  
  
```sql  
SELECT net_transport, auth_scheme   
FROM sys.dm_exec_connections   
WHERE session_id = @@SPID;  
```  
  
##  <a name="authentication-defaults"></a><a name="Defaults"></a> <span data-ttu-id="0200e-194">Impostazioni di autenticazione predefinite</span><span class="sxs-lookup"><span data-stu-id="0200e-194">Authentication Defaults</span></span>  
 <span data-ttu-id="0200e-195">Nella tabella seguente vengono descritte le impostazioni di autenticazione predefinite utilizzate in base agli scenari di registrazione del nome SPN.</span><span class="sxs-lookup"><span data-stu-id="0200e-195">The following table describes the authentication defaults that are used based on SPN registration scenarios.</span></span>  
  
|<span data-ttu-id="0200e-196">Scenario</span><span class="sxs-lookup"><span data-stu-id="0200e-196">Scenario</span></span>|<span data-ttu-id="0200e-197">Metodo di autenticazione</span><span class="sxs-lookup"><span data-stu-id="0200e-197">Authentication method</span></span>|  
|--------------|---------------------------|  
|<span data-ttu-id="0200e-198">Viene eseguito il mapping del nome SPN all'account di dominio, all'account virtuale, all'account dei servizi gestiti (MSA) o all'account predefinito corretto.</span><span class="sxs-lookup"><span data-stu-id="0200e-198">The SPN maps to the correct domain account, virtual account, MSA, or built-in account.</span></span> <span data-ttu-id="0200e-199">ad esempio sistema locale o NETWORK SERVICE.</span><span class="sxs-lookup"><span data-stu-id="0200e-199">For example, Local System or NETWORK SERVICE.</span></span><br /><br /> <span data-ttu-id="0200e-200">Nota: Correct indica che l'account mappato dal nome SPN registrato è l'account con cui viene eseguito il servizio SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0200e-200">Note: Correct means that the account mapped by the registered SPN is the account that the SQL Server service is running under.</span></span>|<span data-ttu-id="0200e-201">Le connessioni locali utilizzano l'autenticazione NTLM, mentre quelle remote utilizzano l'autenticazione Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0200e-201">Local connections use NTLM, remote connections use Kerberos.</span></span>|  
|<span data-ttu-id="0200e-202">Il nome SPN è l'account di dominio, l'account virtuale, l'account dei servizi gestiti (MSA) o l'account predefinito corretto.</span><span class="sxs-lookup"><span data-stu-id="0200e-202">The SPN is the correct domain account, virtual account, MSA, or built-in account.</span></span><br /><br /> <span data-ttu-id="0200e-203">Nota: Correct indica che l'account mappato dal nome SPN registrato è l'account con cui viene eseguito il servizio SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0200e-203">Note: Correct means that the account mapped by the registered SPN is the account that the SQL Server service is running under.</span></span>|<span data-ttu-id="0200e-204">Le connessioni locali utilizzano l'autenticazione NTLM, mentre quelle remote utilizzano l'autenticazione Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0200e-204">Local connections use NTLM, remote connections use Kerberos.</span></span>|  
|<span data-ttu-id="0200e-205">Viene eseguito il mapping del nome SPN a un account di dominio, a un account virtuale, a un account dei servizi gestiti (MSA) o a un account predefinito non corretto.</span><span class="sxs-lookup"><span data-stu-id="0200e-205">The SPN maps to an incorrect domain account, virtual account, MSA, or built-in account</span></span>|<span data-ttu-id="0200e-206">Errore di autenticazione</span><span class="sxs-lookup"><span data-stu-id="0200e-206">Authentication fails.</span></span>|  
|<span data-ttu-id="0200e-207">La ricerca del nome SPN ha esito negativo o non viene eseguito il mapping a un account di dominio, a un account virtuale, a un account dei servizi gestiti (MSA) o a un account predefinito non corretto, oppure non è un account di dominio, un account virtuale, un account dei servizi gestiti o un account predefinito corretto.</span><span class="sxs-lookup"><span data-stu-id="0200e-207">The SPN lookup fails or does not map to a correct domain account, virtual account, MSA, or built-in account, or is not a correct domain account, virtual account, MSA, or built-in account.</span></span>|<span data-ttu-id="0200e-208">Le connessioni locali e remote utilizzano l'autenticazione NTLM.</span><span class="sxs-lookup"><span data-stu-id="0200e-208">Local and remote connections use NTLM.</span></span>|  
  
##  <a name="comments"></a><a name="Comments"></a> <span data-ttu-id="0200e-209">Commenti</span><span class="sxs-lookup"><span data-stu-id="0200e-209">Comments</span></span>  
 <span data-ttu-id="0200e-210">La connessione amministrativa dedicata (DAC) utilizza un nome di istanza basato sul nome SPN.</span><span class="sxs-lookup"><span data-stu-id="0200e-210">The Dedicated Administrator Connection (DAC) uses an instance name based SPN.</span></span> <span data-ttu-id="0200e-211">Se tale nome è stato registrato in modo corretto, è possibile utilizzare l'autenticazione Kerberos con una connessione DAC.</span><span class="sxs-lookup"><span data-stu-id="0200e-211">Kerberos authentication can be used with a DAC if that SPN is registered successfully.</span></span> <span data-ttu-id="0200e-212">In alternativa, un utente può specificare il nome dell'account come nome SPN.</span><span class="sxs-lookup"><span data-stu-id="0200e-212">As an alternative a user can specify the account name as an SPN.</span></span>  
  
 <span data-ttu-id="0200e-213">Se la registrazione del nome SPN ha esito negativo in fase di avvio, l'errore viene registrato nel log degli errori di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] e la procedura di avvio continua.</span><span class="sxs-lookup"><span data-stu-id="0200e-213">If SPN registration fails during startup, this failure is recorded in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, and startup continues.</span></span>  
  
 <span data-ttu-id="0200e-214">Se l'annullamento del nome SPN non riesce in fase di arresto, l'errore viene registrato nel log degli errori di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] e la procedura di arresto continua.</span><span class="sxs-lookup"><span data-stu-id="0200e-214">If SPN de-registration fails during shutdown, this failure is recorded in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, and shutdown continues.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0200e-215">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="0200e-215">See Also</span></span>  
 <span data-ttu-id="0200e-216">[Supporto per nomi SPN nelle connessioni client](../../relational-databases/native-client/features/service-principal-name-spn-support-in-client-connections.md) </span><span class="sxs-lookup"><span data-stu-id="0200e-216">[Service Principal Name &#40;SPN&#41; Support in Client Connections](../../relational-databases/native-client/features/service-principal-name-spn-support-in-client-connections.md) </span></span>  
 <span data-ttu-id="0200e-217">[Nomi SPN &#40;Service Principal Name&#41; nelle connessioni client &#40;OLE DB&#41;](../../relational-databases/native-client/ole-db/service-principal-names-spns-in-client-connections-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="0200e-217">[Service Principal Names &#40;SPNs&#41; in Client Connections &#40;OLE DB&#41;](../../relational-databases/native-client/ole-db/service-principal-names-spns-in-client-connections-ole-db.md) </span></span>  
 <span data-ttu-id="0200e-218">[Nomi SPN &#40;Service Principal Name&#41; nelle connessioni client &#40;ODBC&#41;](../../relational-databases/native-client/odbc/service-principal-names-spns-in-client-connections-odbc.md) </span><span class="sxs-lookup"><span data-stu-id="0200e-218">[Service Principal Names &#40;SPNs&#41; in Client Connections &#40;ODBC&#41;](../../relational-databases/native-client/odbc/service-principal-names-spns-in-client-connections-odbc.md) </span></span>  
 <span data-ttu-id="0200e-219">[Funzionalità di SQL Server Native Client](../../relational-databases/native-client/features/sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="0200e-219">[SQL Server Native Client Features](../../relational-databases/native-client/features/sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="0200e-220">Gestire problemi di autenticazione Kerberos in un ambiente Reporting Services</span><span class="sxs-lookup"><span data-stu-id="0200e-220">Manage Kerberos Authentication Issues in a Reporting Services Environment</span></span>](https://technet.microsoft.com/library/ff679930.aspx)  
  
  
