---
title: Transazioni nelle tabelle con ottimizzazione per la memoria | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 2cd07d26-a1f1-4034-8d6f-f196eed1b763
author: stevestein
ms.author: sstein
ms.openlocfilehash: bc9109c7243e609e5ddd820b61386183761167bf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87726152"
---
# <a name="transactions-in-memory-optimized-tables"></a><span data-ttu-id="de19d-102">Transazioni in tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="de19d-102">Transactions in Memory-Optimized Tables</span></span>
  <span data-ttu-id="de19d-103">Il controllo delle versioni delle righe nelle tabelle basate su disco (tramite l'isolamento SNAPSHOT o READ_COMMITTED_SNAPSHOT) fornisce una forma di controllo della concorrenza ottimistica.</span><span class="sxs-lookup"><span data-stu-id="de19d-103">Row versioning on disk-based tables (using SNAPSHOT isolation or READ_COMMITTED_SNAPSHOT) provides a form of optimistic concurrency control.</span></span> <span data-ttu-id="de19d-104">Lettori e writer non si bloccano reciprocamente.</span><span class="sxs-lookup"><span data-stu-id="de19d-104">Readers and writers do not block each other.</span></span> <span data-ttu-id="de19d-105">Con le tabelle ottimizzate per la memoria i writer non bloccano writer.</span><span class="sxs-lookup"><span data-stu-id="de19d-105">With memory-optimized tables, writers do not block writers.</span></span> <span data-ttu-id="de19d-106">Nel caso di controllo delle versioni delle righe in tabelle basate su disco, una transazione blocca la riga e il tentativo di aggiornare la riga da parte di transazioni simultanee viene impedito.</span><span class="sxs-lookup"><span data-stu-id="de19d-106">With row versioning on disk-based tables, one transaction locks the row and concurrent transactions attempting to update the row are blocked.</span></span> <span data-ttu-id="de19d-107">Per le tabelle ottimizzate per la memoria non vengono attivati blocchi.</span><span class="sxs-lookup"><span data-stu-id="de19d-107">There is no locking with memory-optimized tables.</span></span> <span data-ttu-id="de19d-108">Al contrario, se due transazioni tentano di aggiornare la stessa riga, si verificherà un conflitto di scrittura/scrittura (errore 41302).</span><span class="sxs-lookup"><span data-stu-id="de19d-108">Instead, if two transactions attempt to update the same row, a write/write conflict (error 41302) will occur.</span></span>

 <span data-ttu-id="de19d-109">Diversamente dalle tabelle basate su disco, le tabelle ottimizzate per la memoria prevedono il controllo della concorrenza ottimistica con livelli di isolamento più elevati, REPEATABLE READ e SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="de19d-109">Unlike disk-based tables, memory-optimized tables allow optimistic concurrency control with the higher isolation levels, REPEATABLE READ and SERIALIZABLE.</span></span> <span data-ttu-id="de19d-110">Non vengono utilizzati blocchi per applicare i livelli di isolamento.</span><span class="sxs-lookup"><span data-stu-id="de19d-110">Locks are not taken to enforce the isolation levels.</span></span> <span data-ttu-id="de19d-111">Al contrario, alla fine della transazione una convalida garantisce i presupposti di REPEATABLE READ o SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="de19d-111">Instead, at the end of the transaction validation ensures the repeatable read or serializability assumptions.</span></span> <span data-ttu-id="de19d-112">Se i presupposti vengono violati, la transazione viene terminata.</span><span class="sxs-lookup"><span data-stu-id="de19d-112">If the assumptions are violated, the transaction is terminated.</span></span> <span data-ttu-id="de19d-113">Per altre informazioni, vedere [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md).</span><span class="sxs-lookup"><span data-stu-id="de19d-113">For more information, see [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md).</span></span>

 <span data-ttu-id="de19d-114">Di seguito è indicata la semantica delle transazioni importante per le tabelle ottimizzate per la memoria:</span><span class="sxs-lookup"><span data-stu-id="de19d-114">The important transaction semantics for memory-optimized tables are:</span></span>

-   <span data-ttu-id="de19d-115">Controllo di più versioni</span><span class="sxs-lookup"><span data-stu-id="de19d-115">Multi-versioning</span></span>

-   <span data-ttu-id="de19d-116">Isolamento di transazioni basato su snapshot</span><span class="sxs-lookup"><span data-stu-id="de19d-116">Snapshot-based transaction isolation</span></span>

-   <span data-ttu-id="de19d-117">Optimistic</span><span class="sxs-lookup"><span data-stu-id="de19d-117">Optimistic</span></span>

-   <span data-ttu-id="de19d-118">Rilevamento dei conflitti</span><span class="sxs-lookup"><span data-stu-id="de19d-118">Conflict detection</span></span>

 <span data-ttu-id="de19d-119">Nelle sezioni seguenti viene descritto ciascun aspetto di tale semantica.</span><span class="sxs-lookup"><span data-stu-id="de19d-119">Each of these semantics is explained in the following sections.</span></span>

## <a name="multi-versioning-in-memory-optimized-tables"></a><span data-ttu-id="de19d-120">Controllo di più versioni nelle tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="de19d-120">Multi-Versioning in Memory-Optimized Tables</span></span>
 <span data-ttu-id="de19d-121">Per le righe delle tabelle ottimizzate per la memoria possono essere presenti diverse versioni.</span><span class="sxs-lookup"><span data-stu-id="de19d-121">Rows in memory-optimized tables can have different versions.</span></span> <span data-ttu-id="de19d-122">Le transazioni simultanee accedono potenzialmente a diverse versioni della stessa riga.</span><span class="sxs-lookup"><span data-stu-id="de19d-122">Concurrent transactions access potentially different versions of the same row.</span></span>

 <span data-ttu-id="de19d-123">I dati delle tabelle con ottimizzazione per la memoria sono basati sulla versione.</span><span class="sxs-lookup"><span data-stu-id="de19d-123">Memory-optimized table data is version-based.</span></span> <span data-ttu-id="de19d-124">Possono essere presenti diverse versioni di una riga valide in date e ore specifiche.</span><span class="sxs-lookup"><span data-stu-id="de19d-124">For any row there may be different row versions that are valid at different points in time.</span></span> <span data-ttu-id="de19d-125">Le tabelle basate su disco mantengono diverse versioni di riga quando READ_COMMITTED_SNAPSHOT o ALLOW_SNAPSHOT_ISOLATION è impostato su ON.</span><span class="sxs-lookup"><span data-stu-id="de19d-125">Disk-based tables maintain different row versions when READ_COMMITTED_SNAPSHOT or ALLOW_SNAPSHOT_ISOLATION is ON.</span></span> <span data-ttu-id="de19d-126">Le tabelle con ottimizzazione per la memoria mantengono diverse versioni di riga, anche se READ_COMMITTED_SNAPSHOT e ALLOW_SNAPSHOT_ISOLATION sono impostati su OFF.</span><span class="sxs-lookup"><span data-stu-id="de19d-126">Memory-optimized tables maintain different row versions, even if READ_COMMITTED_SNAPSHOT and ALLOW_SNAPSHOT_ISOLATION are OFF.</span></span> <span data-ttu-id="de19d-127">Le versioni di riga delle tabelle ottimizzate per la memoria non vengono mantenute in tempdb,</span><span class="sxs-lookup"><span data-stu-id="de19d-127">The row versions of memory-optimized tables are not maintained in tempdb.</span></span> <span data-ttu-id="de19d-128">bensì inline, come parte delle strutture dei dati ottimizzate per la memoria in cui sono archiviate le righe.</span><span class="sxs-lookup"><span data-stu-id="de19d-128">Instead, the row versions are maintained in-line, as part of the memory-optimized data structures storing the rows in memory.</span></span>

## <a name="snapshot-based-transaction-isolation-for-memory-optimized-tables"></a><span data-ttu-id="de19d-129">Isolamento delle transazioni basato su snapshot per le tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="de19d-129">Snapshot-Based Transaction Isolation for Memory-Optimized Tables</span></span>
 <span data-ttu-id="de19d-130">Tutte le operazioni in una singola transazione utilizzano lo stesso snapshot coerente a livello di transazione delle tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="de19d-130">All operations in a single transaction use the same transactionally-consistent snapshot of the memory-optimized tables.</span></span> <span data-ttu-id="de19d-131">Tutto l'isolamento delle transazioni per le tabelle ottimizzate per la memoria è basato su snapshot.</span><span class="sxs-lookup"><span data-stu-id="de19d-131">All transaction isolation for memory-optimized tables is snapshot-based.</span></span> <span data-ttu-id="de19d-132">Per una transazione che, ad esempio, utilizza il livello di isolamento serializzabile per accedere alle tabelle ottimizzate per la memoria, tutte le operazioni verranno eseguite nello stesso snapshot coerente a livello di transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-132">For example, a transaction using the serializable isolation level to access memory-optimized tables will perform all operations on the same transactionally consistent snapshot.</span></span>

 <span data-ttu-id="de19d-133">Per le transazioni che accedono a tabelle ottimizzate per la memoria viene utilizzato questo controllo delle versioni delle righe per ottenere uno snapshot coerente a livello di transazione delle righe incluse nelle tabelle.</span><span class="sxs-lookup"><span data-stu-id="de19d-133">Transactions that access memory-optimized tables use this row versioning to obtain a transactionally consistent snapshot of the rows in the tables.</span></span> <span data-ttu-id="de19d-134">I dati letti da qualsiasi istruzione inclusa nella transazione rappresenteranno la versione coerente a livello di transazione dei dati esistenti al momento dell'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-134">The data read by any statement in the transaction will be the transactionally consistent version of the data that existed at the time the transaction started.</span></span> <span data-ttu-id="de19d-135">Di conseguenza, eventuali modifiche eseguite da transazioni in esecuzione simultanea non saranno visibili alle istruzioni nella transazione corrente.</span><span class="sxs-lookup"><span data-stu-id="de19d-135">Therefore, any modifications made by concurrently running transactions are not visible to statements in the current transaction.</span></span>

## <a name="optimistic-concurrency-control-for-memory-optimized-tables"></a><span data-ttu-id="de19d-136">Controllo della concorrenza ottimistica per le tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="de19d-136">Optimistic Concurrency Control for Memory-Optimized Tables</span></span>
 <span data-ttu-id="de19d-137">Conflitti ed errori sono rari. Nelle transazioni in tabelle ottimizzate per la memoria si presuppone che non siano presenti conflitti con le transazioni simultanee e che le operazioni abbiano esito positivo.</span><span class="sxs-lookup"><span data-stu-id="de19d-137">Conflicts and failures are rare and transactions on memory-optimized tables assume there are no conflicts with concurrent transactions and operations succeed.</span></span> <span data-ttu-id="de19d-138">Le transazioni non utilizzano blocchi o latch nella tabella ottimizzata per la memoria per garantire l'isolamento delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="de19d-138">Transactions do not take locks or latches on memory-optimized table to guarantee transaction isolation.</span></span> <span data-ttu-id="de19d-139">I lettori non vengono bloccati dai writer.</span><span class="sxs-lookup"><span data-stu-id="de19d-139">Writers do not block readers.</span></span> <span data-ttu-id="de19d-140">I writer non vengono bloccati dai writer.</span><span class="sxs-lookup"><span data-stu-id="de19d-140">Writers do not block writers.</span></span> <span data-ttu-id="de19d-141">Al contrario, l'esecuzione delle transazioni procede nel presupposto ottimistico che non saranno presenti conflitti con altre transazioni.</span><span class="sxs-lookup"><span data-stu-id="de19d-141">Instead, transactions proceed under the (optimistic) assumption that there will be no conflicts with other transactions.</span></span> <span data-ttu-id="de19d-142">Il fatto di non utilizzare blocchi e latch e di non attendere che venga completata l'elaborazione delle stesse righe da parte di altre transazioni migliora le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="de19d-142">Not using locks and latches and not waiting for other transactions to finish processing the same rows improves performance.</span></span>

 <span data-ttu-id="de19d-143">Se inoltre una transazione (TxA) legge righe che sono state inserito o modificate da un'altra transazione (TxB) che sono in fase di commit, verrà applicato il presupposto ottimistico che l'altra transazione sarà sottoposta a commit, anziché attendere l'esecuzione del commit.</span><span class="sxs-lookup"><span data-stu-id="de19d-143">In addition, if a transaction (TxA) reads rows that have been inserted or modified by another transaction (TxB) that is in the process of committing, it will optimistically assume the other transaction will commit rather than wait for the commit to occur.</span></span> <span data-ttu-id="de19d-144">In questo caso, la transazione TxA avrà una dipendenza di commit dalla transazione TxB.</span><span class="sxs-lookup"><span data-stu-id="de19d-144">In this case, transaction TxA will take a commit dependency on transaction TxB.</span></span>

## <a name="conflict-detection-validation-and-commit-dependency-checks"></a><span data-ttu-id="de19d-145">Controlli relativi a rilevamento di conflitti, convalida e dipendenza di commit</span><span class="sxs-lookup"><span data-stu-id="de19d-145">Conflict Detection, Validation, and Commit Dependency Checks</span></span>
 <span data-ttu-id="de19d-146">In [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] vengono rilevati i conflitti tra le transazioni simultanee, nonché le violazioni del livello di isolamento, e viene eliminata una delle transazioni in conflitto.</span><span class="sxs-lookup"><span data-stu-id="de19d-146">[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] detects conflicts between concurrent transactions, as well as isolation level violations, and will doom one of the conflicting transactions.</span></span> <span data-ttu-id="de19d-147">L'esecuzione di tale transazione dovrà essere tentata di nuovo.</span><span class="sxs-lookup"><span data-stu-id="de19d-147">This transaction will need to be retried.</span></span> <span data-ttu-id="de19d-148">Per ulteriori informazioni, vedere [linee guida per la logica di ripetizione dei tentativi per le transazioni nelle tabelle ottimizzate per la memoria](../relational-databases/in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="de19d-148">(For more information, see [Guidelines for Retry Logic for Transactions on Memory-Optimized Tables](../relational-databases/in-memory-oltp/memory-optimized-tables.md).)</span></span>

 <span data-ttu-id="de19d-149">Viene applicato automaticamente il presupposto ottimistico che non siano presenti conflitti né violazioni di isolamento delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="de19d-149">The system optimistically assumes there are no conflicts and no violations of transaction isolation.</span></span> <span data-ttu-id="de19d-150">Se si verificano conflitti che possono causare incoerenze nel database o violare l'isolamento delle transazioni, tali conflitti vengono rilevati e la transazione viene terminata.</span><span class="sxs-lookup"><span data-stu-id="de19d-150">If any conflicts occur that may cause inconsistencies in the database or that may violate transaction isolation, these conflicts are detected, and the transaction is terminated.</span></span>

 <span data-ttu-id="de19d-151">Se viene rilevato un conflitto, la transazione viene terminata e il client dovrà ripetere il tentativo.</span><span class="sxs-lookup"><span data-stu-id="de19d-151">If a conflict is detected, the transaction is terminated and the client needs to retry.</span></span>

 <span data-ttu-id="de19d-152">Nella tabella seguente vengono riepilogate le condizioni di errore per le transazioni che accedono a tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="de19d-152">The following table summarizes the error conditions for transactions that accesses memory-optimized tables.</span></span>

### <a name="error-conditions-for-transactions-accessing-memory-optimized-tables"></a><span data-ttu-id="de19d-153">Condizioni di errore per le transazioni che accedono a tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="de19d-153">Error conditions for transactions accessing memory-optimized tables.</span></span>

|<span data-ttu-id="de19d-154">Errore</span><span class="sxs-lookup"><span data-stu-id="de19d-154">Error</span></span>|<span data-ttu-id="de19d-155">Scenario</span><span class="sxs-lookup"><span data-stu-id="de19d-155">Scenario</span></span>|
|-----------|--------------|
|<span data-ttu-id="de19d-156">Conflitto di scrittura.</span><span class="sxs-lookup"><span data-stu-id="de19d-156">Write conflict.</span></span> <span data-ttu-id="de19d-157">Tentativo di aggiornare un record che è stato aggiornato dopo l'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-157">Attempting to update a record that has been updated since the transaction started.</span></span>|<span data-ttu-id="de19d-158">Istruzione UPDATE o DELETE per una riga che è stata aggiornata o eliminata da una transazione simultanea.</span><span class="sxs-lookup"><span data-stu-id="de19d-158">UPDATE or DELETE a row that has been updated or deleted by a concurrent transaction.</span></span>|
|<span data-ttu-id="de19d-159">Errore di convalida di lettura ripetibile.</span><span class="sxs-lookup"><span data-stu-id="de19d-159">Repeatable read validation failure.</span></span>|<span data-ttu-id="de19d-160">Una riga letta dalla transazione è stata modificata (aggiornata o eliminata) dopo l'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-160">A row that was read by the transaction has changed (updated or deleted) since the transaction started.</span></span> <span data-ttu-id="de19d-161">La convalida di lettura ripetibile si verifica in genere quando si utilizzano i livelli di isolamento delle transazioni REPEATABLE READ e SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="de19d-161">Repeatable read validation is typically occurs when using REPEATABLE READ and SERIALIZABLE transaction isolation levels.</span></span>|
|<span data-ttu-id="de19d-162">Errore di convalida serializzabile.</span><span class="sxs-lookup"><span data-stu-id="de19d-162">Serializable validation failure.</span></span>|<span data-ttu-id="de19d-163">Dall'avvio della transazione è stata inserita una nuova riga (fantasma) in uno degli intervalli di analisi nella transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-163">A new (phantom) row has been inserted in one of the scan ranges in the transaction, since the transaction started.</span></span> <span data-ttu-id="de19d-164">La riga sarebbe stata rilevata dalla transazione se ne fosse stato eseguito il commit nel database prima dell'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-164">The row would have been visible to the transaction if the row had been committed to the database before the transaction started.</span></span> <span data-ttu-id="de19d-165">La convalida SERIALIZABLE si verifica in genere quando si utilizza l'isolamento SERIALIZABLE e la convalida dei vincoli PRIMARY KEY.</span><span class="sxs-lookup"><span data-stu-id="de19d-165">SERIALIZABLE validation typically occurs when using SERIALIZABLE isolation and validating PRIMARY KEY constraints.</span></span>|
|<span data-ttu-id="de19d-166">Errore di dipendenza di commit.</span><span class="sxs-lookup"><span data-stu-id="de19d-166">Commit dependency failure.</span></span>|<span data-ttu-id="de19d-167">La transazione ha acquisito una dipendenza da un'altra transazione di cui non è stato eseguito il commit a causa di uno degli errori indicati in questa tabella, di una condizione di memoria insufficiente o dell'impossibilità di eseguire il commit nel log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="de19d-167">The transaction took a dependency on another transaction that failed to commit, either due to one of the failures in this table, an out-of-memory condition, or due to failure to commit to the transaction log.</span></span> <span data-ttu-id="de19d-168">Questo errore può verificarsi con transazioni di lettura/scrittura e di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="de19d-168">This failure can occur with both read/write and read-only transactions.</span></span>|

### <a name="transaction-lifetime"></a><span data-ttu-id="de19d-169">Durata della transazione</span><span class="sxs-lookup"><span data-stu-id="de19d-169">Transaction Lifetime</span></span>
 <span data-ttu-id="de19d-170">Gli errori indicati nella tabella precedente possono verificarsi in momenti diversi durante una transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-170">The failures mentioned in the previous table can occur at different points during a transaction.</span></span> <span data-ttu-id="de19d-171">Nella figura seguente vengono illustrate le fasi di una transazione che accede a tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="de19d-171">The following figure illustrates the phases of a transaction that accesses memory-optimized tables.</span></span>

 <span data-ttu-id="de19d-172">![Durata di una transazione.](../../2014/database-engine/media/hekaton-transactions.gif "Durata di una transazione.")</span><span class="sxs-lookup"><span data-stu-id="de19d-172">![Lifetime of a transaction.](../../2014/database-engine/media/hekaton-transactions.gif "Lifetime of a transaction.")</span></span>
<span data-ttu-id="de19d-173">Durata di una transazione che accede a tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="de19d-173">Lifetime of a transaction that accesses memory-optimized tables.</span></span>

#### <a name="regular-processing"></a><span data-ttu-id="de19d-174">Elaborazione regolare</span><span class="sxs-lookup"><span data-stu-id="de19d-174">Regular Processing</span></span>
 <span data-ttu-id="de19d-175">Durante questa fase vengono eseguite le istruzioni [!INCLUDE[tsql](../includes/tsql-md.md)] immesse dall'utente.</span><span class="sxs-lookup"><span data-stu-id="de19d-175">During this phase, the user-issued [!INCLUDE[tsql](../includes/tsql-md.md)] statements are executed.</span></span> <span data-ttu-id="de19d-176">Le righe vengono lette dalle tabelle e le nuove versioni di riga vengono scritte nel database.</span><span class="sxs-lookup"><span data-stu-id="de19d-176">Rows are read from the tables, and new row versions are written to the database.</span></span> <span data-ttu-id="de19d-177">La transazione è isolata da tutte le altre transazioni simultanee.</span><span class="sxs-lookup"><span data-stu-id="de19d-177">The transaction is isolated from all other concurrent transactions.</span></span> <span data-ttu-id="de19d-178">La transazione utilizza lo snapshot delle tabelle ottimizzate per la memoria presente all'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-178">The transaction uses the snapshot of the memory-optimized tables that exists at the start of the transaction.</span></span>

 <span data-ttu-id="de19d-179">Le scritture nelle tabelle in questa fase della transazione non sono ancora visibili ad altre transazioni, con un'eccezione: gli aggiornamenti e le eliminazioni di righe sono visibili alle operazioni di aggiornamento ed eliminazione in altre transazioni, allo scopo di rilevare i conflitti di scrittura.</span><span class="sxs-lookup"><span data-stu-id="de19d-179">Writes to the tables in this phase of the transaction are not yet visible to other transactions, with one exception: row updates and deletes are visible to update and delete operations in other transactions, in order to detect write conflicts.</span></span>

 <span data-ttu-id="de19d-180">Se in un'operazione di aggiornamento o eliminazione viene rilevato che una riga è stata aggiornata o eliminata dopo l'avvio logico della transazione, l'operazione avrà esito negativo con l'errore 41302.</span><span class="sxs-lookup"><span data-stu-id="de19d-180">If an update or delete operation sees that a row has been updated or deleted since the logical start of the transaction, the operation will fail with error 41302.</span></span> <span data-ttu-id="de19d-181">Il messaggio relativo all'errore 41302 è analogo al seguente: "Tentativo da parte della transazione corrente di aggiornare un record nella tabella X che è già stato aggiornato dopo l'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-181">The message for error 41302 is "The current transaction attempted to update a record in table X that has been updated since this transaction started.</span></span> <span data-ttu-id="de19d-182">La transazione è stata interrotta".</span><span class="sxs-lookup"><span data-stu-id="de19d-182">The transaction was aborted."</span></span>

 <span data-ttu-id="de19d-183">Questo errore elimina la transazione, anche se XACT_ABORT è impostata su OFF, pertanto verrà eseguito il rollback della transazione al termine della sessione utente.</span><span class="sxs-lookup"><span data-stu-id="de19d-183">This error dooms the transaction (even if XACT_ABORT is OFF), meaning that the transaction will be rolled back when the user session ends.</span></span> <span data-ttu-id="de19d-184">Non è possibile eseguire il commit delle transazioni eliminate e tali transazioni supportano solo le operazioni di lettura che non scrivono nel log e non accedono alle tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="de19d-184">Doomed transactions cannot be committed and only support read operations that do not write to the log and do not access memory-optimized tables.</span></span>

#####  <a name="commit-dependencies"></a><a name="cd"></a><span data-ttu-id="de19d-185">Dipendenze di commit</span><span class="sxs-lookup"><span data-stu-id="de19d-185">Commit Dependencies</span></span>
 <span data-ttu-id="de19d-186">Durante l'elaborazione regolare, una transazione è in grado di leggere le righe scritte da altre transazioni che si trovano nella fase di convalida o di commit, ma per le quali il commit non è ancora stato eseguito.</span><span class="sxs-lookup"><span data-stu-id="de19d-186">During regular processing, a transaction can read rows written by other transactions that are in the validation or commit phase, but have not yet committed.</span></span> <span data-ttu-id="de19d-187">Le righe sono visibili perché l'ora di fine logica delle transazioni è stata assegnata all'avvio della fase di convalida.</span><span class="sxs-lookup"><span data-stu-id="de19d-187">The rows are visible because the logical end time of the transactions has been assigned at the start of the validation phase.</span></span>

 <span data-ttu-id="de19d-188">Se una transazione legge tali righe di cui non è stato eseguito il commit, acquisirà una dipendenza di commit da tale transazione,</span><span class="sxs-lookup"><span data-stu-id="de19d-188">If a transaction reads such uncommitted rows, it will take a commit dependency on that transaction.</span></span> <span data-ttu-id="de19d-189">con due implicazioni principali:</span><span class="sxs-lookup"><span data-stu-id="de19d-189">This has two main implications:</span></span>

-   <span data-ttu-id="de19d-190">Una transazione non può eseguire il commit finché non viene eseguito il commit delle transazioni da cui dipende.</span><span class="sxs-lookup"><span data-stu-id="de19d-190">A transaction cannot commit until the transactions it depends on have committed.</span></span> <span data-ttu-id="de19d-191">In altre parole, non può avviare la fase di commit finché non saranno stato cancellate tutte le dipendenze.</span><span class="sxs-lookup"><span data-stu-id="de19d-191">In other words, it cannot enter the commit phase, until all dependencies have cleared.</span></span>

-   <span data-ttu-id="de19d-192">Inoltre, i set di risultati non vengono restituiti al client finché tutte le dipendenze non saranno cancellate.</span><span class="sxs-lookup"><span data-stu-id="de19d-192">In addition, result sets are not returned to the client until all dependencies have cleared.</span></span> <span data-ttu-id="de19d-193">In questo modo si impedisce al client di considerare dati di cui non è stato eseguito il commit.</span><span class="sxs-lookup"><span data-stu-id="de19d-193">This prevents the client from observing uncommitted data.</span></span>

 <span data-ttu-id="de19d-194">Se per una delle transazioni dipendenti non viene eseguito il commit, si verifica un errore di dipendenza di commit.</span><span class="sxs-lookup"><span data-stu-id="de19d-194">If any of the dependent transactions fails to commit, there is a commit dependency failure.</span></span> <span data-ttu-id="de19d-195">Ciò significa che non verrà eseguito il commit della transazione con l'errore 41301 ("Una transazione precedente da cui dipende la transazione corrente è stata interrotta. Impossibile eseguire il commit della transazione corrente").</span><span class="sxs-lookup"><span data-stu-id="de19d-195">This means the transaction will fail to commit with error 41301 ("A previous transaction that the current transaction took a dependency on has aborted, and the current transaction can no longer commit.").</span></span>

#### <a name="validation-phase"></a><span data-ttu-id="de19d-196">Fase di convalida</span><span class="sxs-lookup"><span data-stu-id="de19d-196">Validation Phase</span></span>
 <span data-ttu-id="de19d-197">Durante la fase di convalida viene verificato automaticamente che i presupposti necessari per il livello di isolamento della transazione richiesto siano soddisfatti per tutta la durata logica della transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-197">During the validation phase, the system validates that the assumptions necessary for the requested transaction isolation level were true between the logical start and logical end of the transaction.</span></span>

 <span data-ttu-id="de19d-198">All'inizio della fase di convalida, alla transazione viene assegnata un'ora di fine logica.</span><span class="sxs-lookup"><span data-stu-id="de19d-198">At the start of the validation phase, the transaction is assigned a logical end time.</span></span> <span data-ttu-id="de19d-199">Le versioni di riga scritte nel database diventano visibili ad altre transazioni all'ora di fine logica.</span><span class="sxs-lookup"><span data-stu-id="de19d-199">The row versions written in the database become visible to other transactions at the logical end time.</span></span> <span data-ttu-id="de19d-200">Per altre informazioni, vedere [dipendenze di commit](#cd).</span><span class="sxs-lookup"><span data-stu-id="de19d-200">For more information, see [Commit Dependencies](#cd).</span></span>

##### <a name="repeatable-read-validation"></a><span data-ttu-id="de19d-201">Convalida di lettura ripetibile</span><span class="sxs-lookup"><span data-stu-id="de19d-201">Repeatable Read Validation</span></span>
 <span data-ttu-id="de19d-202">Se il livello di isolamento della transazione è REPEATable READ o SERIALIZABLE o se le tabelle sono accessibili nell'isolamento REPEATable READ o SERIALIZABLE (per ulteriori informazioni, vedere la sezione sull'isolamento di singole operazioni nei [livelli di isolamento delle transazioni](../../2014/database-engine/transaction-isolation-levels.md)), il sistema convalida la ripetibilità delle letture.</span><span class="sxs-lookup"><span data-stu-id="de19d-202">If the isolation level of the transaction is REPEATABLE READ or SERIALIZABLE, or if tables are accessed under REPEATABLE READ or SERIALIZABLE isolation (for more information, see the section on Isolation of Individual Operations in [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md)), the system validates that the reads are repeatable.</span></span> <span data-ttu-id="de19d-203">Ciò significa che viene confermato che le versioni delle righe lette dalla transazione sono ancora valide al momento dell'ora di fine logica della transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-203">This means it validates that the versions of the rows read by the transaction are still valid row versions at the logical end time of the transaction.</span></span>

 <span data-ttu-id="de19d-204">Se una qualsiasi delle righe è stata aggiornata o modificata, il commit della transazione non viene eseguito con l'errore 41305 (analogo a "Impossibile eseguire il commit della transazione corrente a causa di un errore di convalida di lettura ripetibile").</span><span class="sxs-lookup"><span data-stu-id="de19d-204">If any of the rows have been updated or changed, the transaction fails to commit with error 41305 ("The current transaction failed to commit due to a repeatable read validation failure.").</span></span>

 <span data-ttu-id="de19d-205">Questo errore può verificarsi anche se una tabella viene eliminata dopo un'operazione di inserimento, aggiornamento o eliminazione e prima del commit della transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-205">This error can also occur if a table is dropped after an insert, update, or delete operation and before the transaction commits.</span></span> <span data-ttu-id="de19d-206">Si applica solo alle operazioni di inserimento, aggiornamento o eliminazione nelle stored procedure compilate in modo nativo.</span><span class="sxs-lookup"><span data-stu-id="de19d-206">This applies only to insert, update, or delete operations in natively compiled stored procedures.</span></span> <span data-ttu-id="de19d-207">Tali operazioni di scrittura eseguite tramite [!INCLUDE[tsql](../includes/tsql-md.md)] interpretato causano il blocco dell'istruzione DROP TABLE e l'attesa del completamento del commit della transazione.</span><span class="sxs-lookup"><span data-stu-id="de19d-207">Such write operations performed through interpreted [!INCLUDE[tsql](../includes/tsql-md.md)] cause the DROP TABLE statement to block and wait until the transaction commits.</span></span>

##### <a name="serializable-validation"></a><span data-ttu-id="de19d-208">Convalida serializzabile</span><span class="sxs-lookup"><span data-stu-id="de19d-208">Serializable Validation</span></span>
 <span data-ttu-id="de19d-209">La convalida serializzabile viene eseguita in due casi:</span><span class="sxs-lookup"><span data-stu-id="de19d-209">Serializable validation is performed in two cases:</span></span>

-   <span data-ttu-id="de19d-210">Se il livello di isolamento della transazione è SERIALIZABLE o le tabelle sono accessibili nel livello di isolamento SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="de19d-210">If the isolation level of the transaction is SERIALIZABLE or tables are accessed under SERIALIZABLE isolation.</span></span>

-   <span data-ttu-id="de19d-211">Se le righe vengono inserite in un indice univoco, ad esempio l'indice creato per un vincolo PRIMARY KEY.</span><span class="sxs-lookup"><span data-stu-id="de19d-211">If rows are inserted in a unique index, such as the index created for a PRIMARY KEY constraint.</span></span> <span data-ttu-id="de19d-212">Viene verificato automaticamente che non siano state inserite simultaneamente righe con la stessa chiave.</span><span class="sxs-lookup"><span data-stu-id="de19d-212">The system validates that no rows with the same key have been concurrently inserted.</span></span>

 <span data-ttu-id="de19d-213">Viene verificato automaticamente che nel database non siano state scritte righe fantasma.</span><span class="sxs-lookup"><span data-stu-id="de19d-213">The system validates that no phantom rows have been written to the database.</span></span> <span data-ttu-id="de19d-214">Le operazioni di lettura eseguite dalla transazione vengono valutate per determinare che negli intervalli di analisi di tali operazioni di lettura non siano state inserite nuove righe.</span><span class="sxs-lookup"><span data-stu-id="de19d-214">The read operations performed by the transaction are evaluated to determine that no new rows were inserted in the scan ranges of these read operations.</span></span>

 <span data-ttu-id="de19d-215">L'inserimento di una chiave in un indice univoco include un'operazione di lettura implicita, per determinare che la chiave non sia un duplicato.</span><span class="sxs-lookup"><span data-stu-id="de19d-215">Insertion of a key in a unique index includes an implicit read operation, to determine that the key is not a duplicate.</span></span> <span data-ttu-id="de19d-216">La convalida serializzabile per gli indici univoci assicura che tali indici non possano includere duplicati nel caso in cui due transazioni simultanee inseriscano la stessa chiave.</span><span class="sxs-lookup"><span data-stu-id="de19d-216">Serializable validation for unique indexes ensures these indexes cannot have duplicates in case two transactions concurrently insert the same key.</span></span>

 <span data-ttu-id="de19d-217">Se vengono rilevate righe fantasma, il commit della transazione non viene eseguito con l'errore 41325 (analogo a "Impossibile eseguire il commit della transazione corrente a causa di un errore di convalida serializzabile").</span><span class="sxs-lookup"><span data-stu-id="de19d-217">If phantom rows are detected, the transaction fails to commit with error 41325 ("The current transaction failed to commit due to a serializable validation failure.").</span></span>

#### <a name="commit-processing"></a><span data-ttu-id="de19d-218">Elaborazione del commit</span><span class="sxs-lookup"><span data-stu-id="de19d-218">Commit Processing</span></span>
 <span data-ttu-id="de19d-219">Se la convalida ha esito positivo e tutte le dipendenze della transazione sono state cancellate, la transazione passa nella fase di elaborazione del commit.</span><span class="sxs-lookup"><span data-stu-id="de19d-219">If validation succeeds and all transaction dependencies clear, the transaction enters the commit processing phase.</span></span> <span data-ttu-id="de19d-220">Durante questa fase le modifiche apportate alle tabelle durevoli vengono scritte nel log e questo viene scritto su disco per garantire la durabilità.</span><span class="sxs-lookup"><span data-stu-id="de19d-220">During this phase the changes to durable tables are written to the log, and the log is written to disk, to ensure durability.</span></span> <span data-ttu-id="de19d-221">Una volta effettuata la scrittura su disco del record del log per la transazione, il controllo viene restituito al client.</span><span class="sxs-lookup"><span data-stu-id="de19d-221">Once the log record for the transaction has been written to disk, control is returned to the client.</span></span>

 <span data-ttu-id="de19d-222">Tutte le dipendenze di commit della transazione vengono cancellate e tutte le transazioni in attesa del commit di tale transazione potranno continuare.</span><span class="sxs-lookup"><span data-stu-id="de19d-222">All commit dependencies on this transaction are cleared, and all transactions that had been waiting for this transaction to commit can proceed.</span></span>

## <a name="limitations"></a><span data-ttu-id="de19d-223">Limitazioni</span><span class="sxs-lookup"><span data-stu-id="de19d-223">Limitations</span></span>

-   <span data-ttu-id="de19d-224">Le transazioni tra database non sono supportate con le tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="de19d-224">Cross-database transactions are not supported with memory-optimized tables.</span></span> <span data-ttu-id="de19d-225">Ogni transazione che accede a tabelle ottimizzate per la memoria non può accedere a più di un database, ad eccezione dell'accesso in lettura/scrittura a tempdb e dell'accesso in sola lettura al master del database di sistema.</span><span class="sxs-lookup"><span data-stu-id="de19d-225">Every transaction that accesses memory-optimized tables cannot access more than one database, with the exception of read-write access to tempdb and read-only access to the system database master.</span></span>

-   <span data-ttu-id="de19d-226">Le transazioni distribuite non sono supportate con le tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="de19d-226">Distributed transactions are not supported with memory-optimized tables.</span></span> <span data-ttu-id="de19d-227">Le transazioni distribuite avviate con BEGIN DISTRIBUTED TRANSACTION non possono accedere alle tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="de19d-227">Distributed transactions started with BEGIN DISTRIBUTED TRANSACTION cannot access memory-optimized tables.</span></span>

-   <span data-ttu-id="de19d-228">Le tabelle con ottimizzazione per la memoria non supportano alcun blocco.</span><span class="sxs-lookup"><span data-stu-id="de19d-228">Memory-optimized tables do not support locking.</span></span> <span data-ttu-id="de19d-229">I blocchi espliciti tramite hint di blocco (ad esempio TABLOCK, XLOCK, ROWLOCK) non sono supportati con le tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="de19d-229">Explicit locks through locking hints (such as TABLOCK, XLOCK, ROWLOCK) are not supported with memory-optimized tables.</span></span>

## <a name="see-also"></a><span data-ttu-id="de19d-230">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="de19d-230">See Also</span></span>
 [<span data-ttu-id="de19d-231">Informazioni sulle transazioni in tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="de19d-231">Understanding Transactions on Memory-Optimized Tables</span></span>](../../2014/database-engine/understanding-transactions-on-memory-optimized-tables.md)


