---
title: Risoluzione dei problemi di SQL Server backup gestito in Azure | Microsoft Docs
description: Questo articolo descrive le attività e gli strumenti che è possibile usare per risolvere gli errori che possono verificarsi durante SQL Server backup gestito per Microsoft Azure operazioni.
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: a34d35b0-48eb-4ed1-9f19-ea14754650da
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: 9c7ed5dd25ed2b02445bfae5eb78ac03b2270552
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87716575"
---
# <a name="troubleshooting-sql-server-managed--backup-to-azure"></a><span data-ttu-id="b1f19-103">Risoluzione dei problemi relativi al backup gestito di SQL Server in Azure</span><span class="sxs-lookup"><span data-stu-id="b1f19-103">Troubleshooting SQL Server Managed  Backup to Azure</span></span>
  <span data-ttu-id="b1f19-104">In questo argomento vengono descritti gli strumenti e le attività utilizzabili per la risoluzione dei problemi relativi agli errori che si possono verificare durante le operazioni di [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b1f19-104">This topic describes the tasks and tools you can use to troubleshoot errors that may occur during [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] operations.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="b1f19-105">Panoramica</span><span class="sxs-lookup"><span data-stu-id="b1f19-105">Overview</span></span>  
 <span data-ttu-id="b1f19-106">In [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] sono inclusi controlli predefiniti e risoluzione dei problemi, pertanto in molti casi gli errori interni vengono risolti dal processo di [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] stesso.</span><span class="sxs-lookup"><span data-stu-id="b1f19-106">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] has built in checks and troubleshooting, so in many cases internal failures are taken care of by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] process itself.</span></span>  
  
 <span data-ttu-id="b1f19-107">Un esempio di questo caso è l'eliminazione di un file di backup, causando un'interruzioni della catena di log che interessano la recuperabilità [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] . identificherà l'interruzioni nella catena di log e pianifica un backup immediatamente.</span><span class="sxs-lookup"><span data-stu-id="b1f19-107">Example of one such case is a deletion of a backup file resulting in a break of the log chain affecting recoverability - [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will identify the break in log chain and schedule a backup to be taken immediately.</span></span> <span data-ttu-id="b1f19-108">Tuttavia si consiglia di monitorare lo stato e di risolvere tutti gli errori per cui è richiesto l'intervento manuale.</span><span class="sxs-lookup"><span data-stu-id="b1f19-108">However we recommend that you monitor the status and address any errors that require manual intervention.</span></span>  
  
 <span data-ttu-id="b1f19-109">Tramite [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] vengono registrati eventi e errori tramite stored procedure di sistema, viste di sistema ed eventi estesi.</span><span class="sxs-lookup"><span data-stu-id="b1f19-109">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] logs events and errors using system stored procedures, system views and extended events.</span></span> <span data-ttu-id="b1f19-110">Tramite le stored procedure e le viste di sistema vengono fornite le informazioni di configurazione di [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], lo stato dei backup pianificati, nonché gli errori acquisiti dagli eventi estesi.</span><span class="sxs-lookup"><span data-stu-id="b1f19-110">System views and stored procedures provide [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configuration information, status of backup scheduled backups, and also the errors captured by Extended Events.</span></span> <span data-ttu-id="b1f19-111">In [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] vengono utilizzati gli eventi estesi per acquisire gli errori da utilizzare per la risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="b1f19-111">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] uses Extended Events to capture the errors to use for troubleshooting.</span></span> <span data-ttu-id="b1f19-112">Oltre alla registrazione di eventi, tramite i criteri di amministrazione intelligente di SQL Server viene specificato lo stato di integrità utilizzato da un processo di notifica tramite posta elettronica per fornire la notifica o errori e problemi.</span><span class="sxs-lookup"><span data-stu-id="b1f19-112">In addition to logging events, SQL Server Smart Admin Policies provide a health status which is used by an email notification job to provide notification or errors and issues.</span></span> <span data-ttu-id="b1f19-113">Per altre informazioni, vedere [monitorare SQL Server backup gestito in Azure](../relational-databases/backup-restore/sql-server-managed-backup-to-microsoft-azure.md).</span><span class="sxs-lookup"><span data-stu-id="b1f19-113">For more information see [Monitor SQL Server Managed Backup to Azure](../relational-databases/backup-restore/sql-server-managed-backup-to-microsoft-azure.md).</span></span>  
  
 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]<span data-ttu-id="b1f19-114">USA anche la stessa registrazione usata quando si esegue manualmente il backup in archiviazione di Azure (SQL Server backup nell'URL).</span><span class="sxs-lookup"><span data-stu-id="b1f19-114">also uses the same logging that is used when manually backing up to Azure storage (SQL Server Backup to URL).</span></span> <span data-ttu-id="b1f19-115">Per ulteriori informazioni sui problemi relativi al backup in URL, vedere la sezione risoluzione dei problemi in [SQL Server procedure consigliate e risoluzione dei](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md) problemi di backup in URL</span><span class="sxs-lookup"><span data-stu-id="b1f19-115">For more information on Backup to URL related issues, see the troubleshooting section in [SQL Server Backup to URL Best Practices and Troubleshooting](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md)</span></span>  
  
### <a name="general-troubleshooting-steps"></a><span data-ttu-id="b1f19-116">Procedura generale per la risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="b1f19-116">General Troubleshooting Steps</span></span>  
  
1.  <span data-ttu-id="b1f19-117">Abilitare la notifica tramite posta elettronica per iniziare a ricevere messaggi di posta elettronica per errori e avvisi.</span><span class="sxs-lookup"><span data-stu-id="b1f19-117">Enable Email Notification to start to receive emails for error and warnings.</span></span>  
  
     <span data-ttu-id="b1f19-118">In alternativa, è anche possibile eseguire periodicamente `smart_admin.fn_get_health_status` per controllare gli errori e i conteggi aggregati.</span><span class="sxs-lookup"><span data-stu-id="b1f19-118">Alternatively, you can also periodically run `smart_admin.fn_get_health_status` to check the aggregated errors and counts.</span></span> <span data-ttu-id="b1f19-119">Ad esempio, `number_of_invalid_credential_errors` rappresenta il numero di volte in cui il backup intelligente ha tentato di eseguire un backup ma è stato restituito un errore di credenziali non valide.</span><span class="sxs-lookup"><span data-stu-id="b1f19-119">For example, `number_of_invalid_credential_errors` is the number of times smart backup attempted a backup but got invalid credential error.</span></span> <span data-ttu-id="b1f19-120">`Number_of_backup_loops` e `number_of_retention_loops` non sono errori; ma indicano il numero di volte in cui il thread di backup e il thread di memorizzazione hanno analizzato l'elenco di database.</span><span class="sxs-lookup"><span data-stu-id="b1f19-120">`Number_of_backup_loops` and `number_of_retention_loops` are not errors; but they indicate the number of times backup thread and retention thread scanned the list of databases.</span></span> <span data-ttu-id="b1f19-121">In genere, quando @begin_time e @end_time non vengono specificati, la funzione Visualizza le informazioni degli ultimi 30 minuti, quindi in genere è necessario visualizzare i valori diversi da zero per queste due colonne.</span><span class="sxs-lookup"><span data-stu-id="b1f19-121">Typically, when @begin_time and @end_time are not provided, the function is showing the information from last 30 minutes, then we should normally see non-zero values for these two columns.</span></span> <span data-ttu-id="b1f19-122">Se vengono visualizzati valori pari a zero, significa che si è verificato un overload del sistema o che il sistema non risponde.</span><span class="sxs-lookup"><span data-stu-id="b1f19-122">If they are zero then it implies system overloaded or even system not responding.</span></span> <span data-ttu-id="b1f19-123">Per ulteriori informazioni, vedere la sezione **risoluzione dei problemi di sistema** più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="b1f19-123">For more information, see **Troubleshooting System Issues** section later in this topic.</span></span>  
  
2.  <span data-ttu-id="b1f19-124">Esaminare i registri eventi estesi per ulteriori dettagli sugli errori e altri eventi associati.</span><span class="sxs-lookup"><span data-stu-id="b1f19-124">Review the Extended Event logs to learn more details on the errors and other associated events.</span></span>  
  
3.  <span data-ttu-id="b1f19-125">Utilizzare le informazioni nei registri per risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="b1f19-125">Use the information in the logs to resolve the issue.</span></span>  <span data-ttu-id="b1f19-126">In caso di un problema o di un errore del sistema, potrebbe essere necessario riavviare il servizio o SQL Server Agent.</span><span class="sxs-lookup"><span data-stu-id="b1f19-126">In case of a system issue or error, you may need to restart the service or SQL Server Agent.</span></span>  
  
### <a name="common-causes-of-errors"></a><span data-ttu-id="b1f19-127">Cause comuni degli errori</span><span class="sxs-lookup"><span data-stu-id="b1f19-127">Common Causes of Errors</span></span>  
 <span data-ttu-id="b1f19-128">Di seguito è riportato l'elenco delle cause comuni che provocano gli errori:</span><span class="sxs-lookup"><span data-stu-id="b1f19-128">Following is the list of common causes resulting in failures:</span></span>  
  
1.  <span data-ttu-id="b1f19-129">**Modifiche alle credenziali SQL:** Se il nome della credenziale utilizzata da [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] viene modificato o se viene eliminato, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] non sarà in grado di eseguire i backup.</span><span class="sxs-lookup"><span data-stu-id="b1f19-129">**Changes to SQL Credential:** If the name of the credential used by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is changed or if it is deleted, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will not be able to take backups.</span></span> <span data-ttu-id="b1f19-130">La modifica deve essere applicata alle impostazioni di configurazione di [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b1f19-130">The change should be applied to [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configuration settings.</span></span>  
  
2.  <span data-ttu-id="b1f19-131">**Modifiche ai valori della chiave di accesso all'archiviazione:** Se i valori della chiave di archiviazione vengono modificati per l'account Azure, ma le credenziali SQL non vengono aggiornate con i nuovi valori, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] avrà esito negativo quando si esegue l'autenticazione nella risorsa di archiviazione e non è possibile eseguire il backup dei database configurati per l'uso di questo account.</span><span class="sxs-lookup"><span data-stu-id="b1f19-131">**Changes to storage access key values:** If the storage key values are changed for the Azure account, but SQL Credential is not updated with the new values, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will fail when authenticating to the storage, and fails to backup databases configured to use this account.</span></span>  
  
3.  <span data-ttu-id="b1f19-132">**Modifiche all'account di archiviazione di Azure:** L'eliminazione o la ridenominazione dell'account di archiviazione senza modifiche corrispondenti alle credenziali SQL causerà [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] un errore e non verrà eseguito alcun backup.</span><span class="sxs-lookup"><span data-stu-id="b1f19-132">**Changes to Azure Storage Account:** Deleting or renaming storage account without corresponding changes to the SQL Credential will cause [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] to fail and no backups will be taken.</span></span> <span data-ttu-id="b1f19-133">Se si elimina un account di archiviazione, verificare che i database vengano riconfigurati con informazioni sull'account di archiviazione valide.</span><span class="sxs-lookup"><span data-stu-id="b1f19-133">If you delete a storage account, ensure that the databases are reconfigured with valid storage account information.</span></span> <span data-ttu-id="b1f19-134">Se un account di archiviazione viene ridenominato oppure i valori della chiave vengono modificati, verificare che queste modifiche vengano riflesse nelle credenziali SQL utilizzate da [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b1f19-134">If a storage account is renamed or the key values are changed, ensure that these changes are reflected in the SQL Credential used by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span>  
  
4.  <span data-ttu-id="b1f19-135">**Modifiche alle proprietà del database:** Le modifiche ai modelli di recupero o la modifica del nome possono causare errori di backup.</span><span class="sxs-lookup"><span data-stu-id="b1f19-135">**Changes to Database Properties:** Changes to recovery models or changing the name can cause backups to fail.</span></span>  
  
5.  <span data-ttu-id="b1f19-136">**Modifiche al modello di recupero:** Se il modello di recupero del database viene modificato in semplice da completo o con registrazione minima delle operazioni bulk, i backup verranno arrestati e i database verranno ignorati da [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b1f19-136">**Changes to Recovery Model:** If the recovery model of the database is changed to simple from full or bulk-logged, backups will stop, and the databases will be skipped by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="b1f19-137">Per altre informazioni, vedere [SQL Server backup gestito in Azure: interoperabilità e coesistenza](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-interoperability-and-coexistence.md)</span><span class="sxs-lookup"><span data-stu-id="b1f19-137">For more information, see [SQL Server Managed Backup to Azure: Interoperability and Coexistence](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-interoperability-and-coexistence.md)</span></span>  
  
### <a name="most-common-error-messages-and-solutions"></a><span data-ttu-id="b1f19-138">Messaggi di errori più comuni e soluzioni</span><span class="sxs-lookup"><span data-stu-id="b1f19-138">Most Common Error Messages and Solutions</span></span>  
  
1.  <span data-ttu-id="b1f19-139">**Errori durante l'abilitazione o la configurazione di [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] :**</span><span class="sxs-lookup"><span data-stu-id="b1f19-139">**Errors when enabling or configuring [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]:**</span></span>  
  
     <span data-ttu-id="b1f19-140">Errore: "non è stato possibile accedere all'URL di archiviazione... Specificare una credenziale SQL valida... ": è possibile che venga visualizzato questo e altri errori simili che fanno riferimento a credenziali SQL.</span><span class="sxs-lookup"><span data-stu-id="b1f19-140">Error: " Failed to access the storage URL.... Provide a valid SQL Credential..." : You may see this and other similar errors referring to SQL Credentials.</span></span>  <span data-ttu-id="b1f19-141">In questi casi, esaminare il nome delle credenziali SQL fornite, nonché le informazioni archiviate nelle credenziali SQL, ovvero il nome dell'account di archiviazione e la chiave di accesso alle archiviazioni e verificare che siano correnti e valide.</span><span class="sxs-lookup"><span data-stu-id="b1f19-141">In such cases, review the name of the SQL Credential you provided, and also the information stored in the SQL Credential - the storage account name, and the storage access key and make sure that they are current and valid.</span></span>  
  
     <span data-ttu-id="b1f19-142">Errore: "... Impossibile configurare il database... Poiché si tratta di un database di sistema, questo errore viene visualizzato se si tenta di abilitare [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] per un database di sistema.</span><span class="sxs-lookup"><span data-stu-id="b1f19-142">Error: "... cannot configure the database....because it is a system database": You will see this error if you try to enable [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for a system database.</span></span>  [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] <span data-ttu-id="b1f19-143">non supporta i backup per i database di sistema.</span><span class="sxs-lookup"><span data-stu-id="b1f19-143">does not support backups for system databases.</span></span>  <span data-ttu-id="b1f19-144">Per configurare il backup di un database di sistema, utilizzare altre tecnologie di backup di SQL Server, ad esempio i piani di manutenzione.</span><span class="sxs-lookup"><span data-stu-id="b1f19-144">To configure backup for a system database use other SQL Server Backup technologies such as maintenance plans.</span></span>  
  
     <span data-ttu-id="b1f19-145">Errore: "... Fornire un periodo di conservazione.... ": è possibile che vengano visualizzati errori relativi al periodo di conservazione se non è stato specificato un periodo di conservazione per il database o l'istanza quando si configurano questi valori per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="b1f19-145">Error:" ... Provide a retention period...." : You may see errors regarding the retention period if you either have not specified a retention period for the database or instance when you are configuring these values for the first time.</span></span> <span data-ttu-id="b1f19-146">È inoltre possibile visualizzare un errore se si immette un valore diverso da un numero compreso tra 1 e 30.</span><span class="sxs-lookup"><span data-stu-id="b1f19-146">You may also see an error if you provide a value other than a number between 1 and 30.</span></span> <span data-ttu-id="b1f19-147">Il valore consentito per il periodo di memorizzazione è un numero compreso tra 1 e 30.</span><span class="sxs-lookup"><span data-stu-id="b1f19-147">The allowed value for the retention period is a number between 1 and 30.</span></span>  
  
2.  <span data-ttu-id="b1f19-148">**Errori di notifica tramite posta elettronica:**</span><span class="sxs-lookup"><span data-stu-id="b1f19-148">**Email Notification Errors:**</span></span>  
  
     <span data-ttu-id="b1f19-149">Errore: "Posta elettronica database non è abilitato...". questo errore verrà visualizzato se si abilitano le notifiche tramite posta elettronica, ma Posta elettronica database non è configurato nell'istanza.</span><span class="sxs-lookup"><span data-stu-id="b1f19-149">Error: "Database Mail is not enabled..." - You will see this error if you enable e-mail notifications, but Database Mail is not configured on the instance.</span></span> <span data-ttu-id="b1f19-150">È necessario configurare Posta elettronica database nell'istanza per poter ricevere la notifica dello stato di integrità di [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b1f19-150">You must configure Database Mail on the instance to be able to receive notification of the health status of [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="b1f19-151">Per informazioni su come abilitare posta elettronica database, vedere [Configure posta elettronica database](../relational-databases/database-mail/configure-database-mail.md).</span><span class="sxs-lookup"><span data-stu-id="b1f19-151">For information about how to enable database mail, see [Configure Database Mail](../relational-databases/database-mail/configure-database-mail.md).</span></span> <span data-ttu-id="b1f19-152">È inoltre necessario abilitare SQL Server Agent per l'utilizzo di Posta elettronica database per le notifiche.</span><span class="sxs-lookup"><span data-stu-id="b1f19-152">You must also enable SQL Server Agent to use Database Mail for notifications.</span></span> <span data-ttu-id="b1f19-153">Per ulteriori informazioni, vedere [prima di iniziare](../relational-databases/database-mail/configure-sql-server-agent-mail-to-use-database-mail.md#BeforeYouBegin).</span><span class="sxs-lookup"><span data-stu-id="b1f19-153">For more information, see [Before You Begin](../relational-databases/database-mail/configure-sql-server-agent-mail-to-use-database-mail.md#BeforeYouBegin).</span></span>  
  
     <span data-ttu-id="b1f19-154">Di seguito è riportato un elenco di numeri di errore che potrebbero essere visualizzati, associati alle notifiche tramite posta elettronica:</span><span class="sxs-lookup"><span data-stu-id="b1f19-154">Following is a list of error numbers you might see that are associated with email notifications:</span></span>  
  
    -   <span data-ttu-id="b1f19-155">Numero errore: 45209</span><span class="sxs-lookup"><span data-stu-id="b1f19-155">ErrorNumber: 45209</span></span>  
  
    -   <span data-ttu-id="b1f19-156">Numero errore: 45210</span><span class="sxs-lookup"><span data-stu-id="b1f19-156">ErrorNumber: 45210</span></span>  
  
    -   <span data-ttu-id="b1f19-157">ErrorNumber: 45211</span><span class="sxs-lookup"><span data-stu-id="b1f19-157">ErrorNumber: 45211</span></span>  
  
3.  <span data-ttu-id="b1f19-158">**Errori di connettività:**</span><span class="sxs-lookup"><span data-stu-id="b1f19-158">**Connectivity Errors:**</span></span>  
  
    -   <span data-ttu-id="b1f19-159">**Errori relativi alla connettività SQL:** Questi errori si verificano quando si verificano problemi di connessione a SQL Server istanza.</span><span class="sxs-lookup"><span data-stu-id="b1f19-159">**Errors Related to SQL Connectivity:** These errors happen when there are issues connecting to SQL Server instance.</span></span> <span data-ttu-id="b1f19-160">Negli eventi estesi questi tipi di errori vengono esposti tramite il canale di amministrazione.</span><span class="sxs-lookup"><span data-stu-id="b1f19-160">The extended events expose these type of errors through the admin channel.</span></span> <span data-ttu-id="b1f19-161">Di seguito sono riportati i due eventi estesi per cui è possibile visualizzare gli errori relativi a questo tipo di problemi di connettività:</span><span class="sxs-lookup"><span data-stu-id="b1f19-161">Following are the two extended events that you might see for errors related to this type of connectivity issues:</span></span>  
  
         <span data-ttu-id="b1f19-162">FileRetentionAdminXEvent con event_type = SqlError.</span><span class="sxs-lookup"><span data-stu-id="b1f19-162">FileRetentionAdminXEvent with event_type = SqlError.</span></span> <span data-ttu-id="b1f19-163">Per i dettagli su questo errore, esaminare error_code, error_message e stack_trace dell'evento in questione.</span><span class="sxs-lookup"><span data-stu-id="b1f19-163">For details of this error, look at the error_code, error_message and stack_trace of that event.</span></span> <span data-ttu-id="b1f19-164">Il error_code è il numero di errore di SqlException.</span><span class="sxs-lookup"><span data-stu-id="b1f19-164">The error_code is the SqlException's error number.</span></span>  
  
         <span data-ttu-id="b1f19-165">SmartBackupAdminXevent con i messaggi/prefissi di messaggio seguenti:</span><span class="sxs-lookup"><span data-stu-id="b1f19-165">SmartBackupAdminXevent with the following messages/message prefixes:</span></span>  
  
         <span data-ttu-id="b1f19-166">*"Si è verificato un errore interno durante la configurazione di SQL Server backup gestito in impostazioni predefinite di Azure per l'istanza. L'errore potrebbe essere temporaneo ".*</span><span class="sxs-lookup"><span data-stu-id="b1f19-166">*"An internal error occurred while configuring SQL Server Managed Backup to Azure default settings for instance. Error might be transient."*</span></span>  
  
         <span data-ttu-id="b1f19-167">*"È probabile che si verifichino problemi di connettività con SQL Server. Il database verrà ignorato nell'iterazione corrente ".*</span><span class="sxs-lookup"><span data-stu-id="b1f19-167">*"Probably experiencing connectivity issues with SQL Server. Skipping database in the current iteration."*</span></span>  
  
         <span data-ttu-id="b1f19-168">*"Query sulle informazioni sull'utilizzo del log non riuscita. L'errore potrebbe essere temporaneo. Il database verrà ignorato nell'iterazione corrente ".*</span><span class="sxs-lookup"><span data-stu-id="b1f19-168">*"Querying log usage info failed. The failure might be transient. Skipping database in the current iteration."*</span></span>  
  
         <span data-ttu-id="b1f19-169">*"Eccezione SQL rilevata durante il caricamento dei metadati dell'agente SSMBackup2WA. L'errore potrebbe essere temporaneo. Verrà eseguito un nuovo tentativo di esecuzione dell'operazione.*</span><span class="sxs-lookup"><span data-stu-id="b1f19-169">*"SQL exception encountered while loading SSMBackup2WA agent metadata. The failure might be transient. Operation will be retried."*</span></span>  
  
         <span data-ttu-id="b1f19-170">*"SSMBackup2WA ha rilevato un'eccezione SQL... "*</span><span class="sxs-lookup"><span data-stu-id="b1f19-170">*"SSMBackup2WA encountered SQL exception while ... "*</span></span>  
  
    -   <span data-ttu-id="b1f19-171">**Errori di connessione all'account di archiviazione:**</span><span class="sxs-lookup"><span data-stu-id="b1f19-171">**Errors Connecting to the storage account:**</span></span>  
  
         <span data-ttu-id="b1f19-172">Le eccezioni di archiviazione vengono segnalate in FileRetentionAdminXEvent con event_type = XstoreError.</span><span class="sxs-lookup"><span data-stu-id="b1f19-172">Storage exceptions are reported in FileRetentionAdminXEvent with event_type = XstoreError.</span></span> <span data-ttu-id="b1f19-173">Per i dettagli sull'errore, esaminare error_message e stack_trace dell'evento in questione.</span><span class="sxs-lookup"><span data-stu-id="b1f19-173">For details of the error, look at the error_message and stack_trace of that event.</span></span>  
  
         <span data-ttu-id="b1f19-174">Dal momento che da parte di Backup gestito di SQL Server viene utilizzata la tecnologia sottostante Backup nell'URL, gli errori relativi alla connettività di archiviazione vengono applicati a entrambe le funzionalità.</span><span class="sxs-lookup"><span data-stu-id="b1f19-174">Since SQL Server Managed Backup uses the underlying Backup to URL technology, the errors related to storage connectivity apply to both the features.</span></span> <span data-ttu-id="b1f19-175">Per ulteriori informazioni sulle procedure per la risoluzione dei problemi, vedere la sezione relativa alla **risoluzione dei problemi** dell'articolo sulle [procedure consigliate e sulla risoluzione dei problemi di SQL Server backup su URL](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md) .</span><span class="sxs-lookup"><span data-stu-id="b1f19-175">For more information on troubleshooting steps, see **troubleshooting section** of the [SQL Server Backup to URL Best Practices and Troubleshooting](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md) article.</span></span>  
  
### <a name="troubleshooting-system-issues"></a><span data-ttu-id="b1f19-176">Risoluzione dei problemi relativi al sistema</span><span class="sxs-lookup"><span data-stu-id="b1f19-176">Troubleshooting System Issues</span></span>  
 <span data-ttu-id="b1f19-177">Di seguito vengono illustrati alcuni scenari quando si verifica un problema con il sistema (SQL Server, SQL Server Agent) e i relativi effetti su [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="b1f19-177">Following are some scenarios when there is an issue with the system (SQL Server, SQL Server Agent) and its effects on [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]:</span></span>  
  
-   <span data-ttu-id="b1f19-178">**Sqlservr.exe smette di rispondere o smette di funzionare quando [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] è in esecuzione:** se SQL Server smette di funzionare, SQL Agent si arresterà normalmente, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] inoltre si interrompe e gli eventi vengono registrati nel file SQL Agent. out.</span><span class="sxs-lookup"><span data-stu-id="b1f19-178">**Sqlservr.exe stops responding or stops working when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is running:** If SQL Server stops working, SQL Agent will gracefully shut down, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] also stops and the events are logged in SQL Agent.out file.</span></span>  
  
     <span data-ttu-id="b1f19-179">Se SQL Server non risponde, gli eventi vengono registrati nel canale di amministrazione.</span><span class="sxs-lookup"><span data-stu-id="b1f19-179">If SQL Server stops responding, events are logged in the admin channel.</span></span>  <span data-ttu-id="b1f19-180">Un esempio del registro eventi:</span><span class="sxs-lookup"><span data-stu-id="b1f19-180">An example of the event log:</span></span>  
  
     <span data-ttu-id="b1f19-181">*Errore SQL (il motore non risponde o Get sqlException: SqlException:* </span><span class="sxs-lookup"><span data-stu-id="b1f19-181">*Sql Error (engine not responding or get sqlException: SqlException:* </span></span>  
     <span data-ttu-id="b1f19-182">*il codice di errore, il messaggio e l'StackTrace verranno visualizzati in un canale di amministrazione XEvent, insieme ad alcune informazioni aggiuntive, ad esempio:* </span><span class="sxs-lookup"><span data-stu-id="b1f19-182">*error code, message and stacktrace will be displayed in an admin channel xevent, together with some extra information, such as :* </span></span>  
    <span data-ttu-id="b1f19-183">*"È probabile che si verifichino problemi di connettività con SQL Server. Il database verrà ignorato nell'iterazione corrente "*</span><span class="sxs-lookup"><span data-stu-id="b1f19-183">*"Probably experiencing connectivity issues with SQL Server. Skipping database in the current iteration"*</span></span>  
  
-   <span data-ttu-id="b1f19-184">**SQL Agent smette di rispondere o smette di funzionare quando [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] è in esecuzione:**</span><span class="sxs-lookup"><span data-stu-id="b1f19-184">**SQL Agent stops responding or stops working when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is running:**</span></span>  
  
     <span data-ttu-id="b1f19-185">Se SQL Agent si blocca, viene arrestato anche [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] e gli eventi vengono registrati nel canale di amministrazione.</span><span class="sxs-lookup"><span data-stu-id="b1f19-185">If SQL Agent stops working, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] also stops and events are logged in the admin channel.</span></span> <span data-ttu-id="b1f19-186">È simile agli scenari in cui SQL Server non risponde.</span><span class="sxs-lookup"><span data-stu-id="b1f19-186">This is similar to the scenarios when SQL Server stops responding.</span></span>  
  
     <span data-ttu-id="b1f19-187">Se SQL Agent non risponde, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] non sarà in grado di continuare con le operazioni di backup e gli eventi vengono registrati nel canale di amministrazione.</span><span class="sxs-lookup"><span data-stu-id="b1f19-187">If SQL Agent stops responding, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will be unable to continue with backup operations, and events are logged in the admin channel.</span></span> <span data-ttu-id="b1f19-188">Un esempio del registro eventi:</span><span class="sxs-lookup"><span data-stu-id="b1f19-188">An example of the event log:</span></span>  
  
     <span data-ttu-id="b1f19-189">*Il processo si blocca: vedere il canale di amministrazione XEvent* </span><span class="sxs-lookup"><span data-stu-id="b1f19-189">*Job hangs: see admin channel xevents* </span></span>  
    <span data-ttu-id="b1f19-190">*"Un aggiornamento dello stato di avanzamento non è stato ricevuto da SQL Server più di" + costanti. DBBackupInfoMsgMaxWaitTime + "ore per il backup del database.   Il backup cloud SSM continuerà ad attendere ".*</span><span class="sxs-lookup"><span data-stu-id="b1f19-190">*"A progress update hasn't been received from SQL Server in more than " + Constants.DBBackupInfoMsgMaxWaitTime  + " hours for database backup.   SSM Cloud Backup will continue to wait."*</span></span>  
  
 <span data-ttu-id="b1f19-191">Se è stata abilitata la notifica tramite posta elettronica, si riceverà una notifica che include il **numero di cicli di backup** e il **numero di cicli di conservazione**.</span><span class="sxs-lookup"><span data-stu-id="b1f19-191">If you have enabled email notification, you will receive a notification which includes **Number of Backup Loops** and **Number of Retention Loops**.</span></span> <span data-ttu-id="b1f19-192">Se il valore restituito nella notifica per una o entrambe queste due colonne è zero, potrebbe significare che il sistema non risponde.</span><span class="sxs-lookup"><span data-stu-id="b1f19-192">If the value returned in the notification for one or both of these two columns is zero, it could be an indication that the system is not responding.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="b1f19-193">Nei processi interni che generano i risultati per il report si presuppone che i log di diagnostica del motore si trovino nello stesso percorso del log degli errori di SQL Agent che, per impostazione predefinita, si trova nella stessa cartella dei log degli errori dell'istanza di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b1f19-193">The internal processes that generate the results for the report, assumes that the engine diagnostic logs are in the same location of SQL Agent error log, which by default is in the same folder as the error logs of the SQL Server instance.</span></span> <span data-ttu-id="b1f19-194">Se i log di diagnostica del motore vengono spostati in un percorso diverso da quello del log degli errori di SQL Agent, il sistema non sarà in grado di trovare i log di diagnostica di backup intelligenti e, di conseguenza, il report nella notifica tramite posta elettronica potrebbe non essere corretto.</span><span class="sxs-lookup"><span data-stu-id="b1f19-194">If the engine diagnostic logs are moved to a location other than SQL Agent error log location, the system is unable to find the smart backup diagnostic logs, and hence the report in the email notification may not be correct.</span></span> <span data-ttu-id="b1f19-195">Ad esempio, è possibile che venga visualizzato un valore pari a **0** in tutti i campi segnalati, inclusi il numero di cicli di backup e il numero di cicli di memorizzazione.</span><span class="sxs-lookup"><span data-stu-id="b1f19-195">For example, you might see a value of **0** in all the fields reported including the Number of Backup Loops and Number of Retention Loops.</span></span> <span data-ttu-id="b1f19-196">Nel caso dove i log di diagnostica vengono spostati in un percorso diverso, non vuol dire che il sistema non risponde, bensì non è in grado di trovare i log.</span><span class="sxs-lookup"><span data-stu-id="b1f19-196">In this case where the diagnostic logs are moved to a different location, it may not mean that the system is not responding, but that the system is unable to find the logs.</span></span> <span data-ttu-id="b1f19-197">Assicurarsi innanzitutto che il percorso dei log di diagnostica e quello dei log degli errori di SQL Agent sia lo stesso.</span><span class="sxs-lookup"><span data-stu-id="b1f19-197">Ensure that the location of the diagnostic logs and SQL Agent error logs are at the same location first.</span></span> <span data-ttu-id="b1f19-198">Per verificare il percorso corrente dei log di diagnostica, è possibile usare [sys. dm_os_server_diagnostics_log_configurations](/sql/relational-databases/system-dynamic-management-views/sys-dm-os-server-diagnostics-log-configurations).</span><span class="sxs-lookup"><span data-stu-id="b1f19-198">To verify the current location of the diagnostic logs, you can use [sys.dm_os_server_diagnostics_log_configurations](/sql/relational-databases/system-dynamic-management-views/sys-dm-os-server-diagnostics-log-configurations).</span></span> <span data-ttu-id="b1f19-199">La `path` colonna restituisce il percorso corrente dei log di diagnostica del motore.</span><span class="sxs-lookup"><span data-stu-id="b1f19-199">The `path` column returns the current location of the engine diagnostic logs.</span></span>  <span data-ttu-id="b1f19-200">Deve trovarsi nella stessa cartella dei log degli errori di SQL Agent.</span><span class="sxs-lookup"><span data-stu-id="b1f19-200">It should be in the same folder as the SQL Agent error logs.</span></span> <span data-ttu-id="b1f19-201">È possibile che si ottenga il percorso dei log degli errori di SQL Agent utilizzando la stored procedure `dbo.sp_get_sqlagent_properties`.</span><span class="sxs-lookup"><span data-stu-id="b1f19-201">You can get SQL Agent error log path using the `dbo.sp_get_sqlagent_properties` stored procedure.</span></span>  
  
 <span data-ttu-id="b1f19-202">Controllare i registri eventi estesi per visualizzare i dettagli degli errori.</span><span class="sxs-lookup"><span data-stu-id="b1f19-202">Check the extended event logs to see details of the errors.</span></span> <span data-ttu-id="b1f19-203">Correggere gli errori o riavviare SQL Server Agent per risolvere la situazione.</span><span class="sxs-lookup"><span data-stu-id="b1f19-203">fix the errors, or restart SQL Server Agent to correct the situation.</span></span>  
  
  
