---
title: Introduzione al caricamento bulk XML (SQLXML 4,0) | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: reference
helpviewer_keywords:
- nontransacted XML Bulk Load operations
- XML Bulk Load [SQLXML], about XML Bulk Load
- bulk load [SQLXML], about bulk load
- transacted XML Bulk Load operations
- streaming XML data
ms.assetid: 38bd3cbd-65ef-4c23-9ef3-e70ecf6bb88a
author: rothja
ms.author: jroth
ms.openlocfilehash: 4f3e0e78edd967e5fcb7377312c1811d34cb1ef8
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87711820"
---
# <a name="introduction-to-xml-bulk-load-sqlxml-40"></a><span data-ttu-id="94506-102">Introduzione al caricamento bulk XML (SQLXML 4.0)</span><span class="sxs-lookup"><span data-stu-id="94506-102">Introduction to XML Bulk Load (SQLXML 4.0)</span></span>
  <span data-ttu-id="94506-103">Il caricamento bulk XML è un oggetto COM autonomo che consente di caricare dati XML semistrutturati nelle tabelle di Microsoft [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="94506-103">XML Bulk Load is a stand-alone COM object that allows you to load semistructured XML data into Microsoft [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] tables.</span></span>  
  
 <span data-ttu-id="94506-104">È possibile inserire dati XML in un database [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] utilizzando un'istruzione INSERT e la funzione OPENXML. L'utilità di caricamento bulk fornisce tuttavia prestazioni migliori quando è necessario inserire grandi quantità di dati XML.</span><span class="sxs-lookup"><span data-stu-id="94506-104">You can insert XML data into a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database by using an INSERT statement and the OPENXML function; however, the Bulk Load utility provides better performance when you need to insert large amounts of XML data.</span></span>  
  
 <span data-ttu-id="94506-105">Il metodo Execute del modello a oggetti per il caricamento bulk XML accetta due parametri:</span><span class="sxs-lookup"><span data-stu-id="94506-105">The Execute method of the XML Bulk Load object model takes two parameters:</span></span>  
  
-   <span data-ttu-id="94506-106">Uno schema XSD (XML Schema Definition) o uno schema XDR (XML-Data Reduced) con annotazioni.</span><span class="sxs-lookup"><span data-stu-id="94506-106">An annotated XML Schema Definition (XSD) or XML-Data Reduced (XDR) schema.</span></span> <span data-ttu-id="94506-107">L'utilità di caricamento bulk XML interpreta questo schema di mapping e le annotazioni specificate nello schema per identificare le tabelle di SQL Server nelle quali devono essere inseriti i dati XML.</span><span class="sxs-lookup"><span data-stu-id="94506-107">The XML Bulk Load utility interprets this mapping schema and the annotations that are specified in the schema in identifying the SQL Server tables into which the XML data is to be inserted.</span></span>  
  
-   <span data-ttu-id="94506-108">Un documento o un frammento di documento XML (un frammento di documento è un documento privo di un singolo elemento di livello superiore).</span><span class="sxs-lookup"><span data-stu-id="94506-108">An XML document or document fragment (a document fragment is a document without a single top-level element).</span></span> <span data-ttu-id="94506-109">È possibile specificare un nome file o un flusso dal quale il caricamento bulk XML può leggere.</span><span class="sxs-lookup"><span data-stu-id="94506-109">A file name or a stream from which XML Bulk Load can read can be specified.</span></span>  
  
 <span data-ttu-id="94506-110">Il caricamento bulk XML interpreta lo schema di mapping e identifica le tabelle nelle quali devono essere inseriti i dati XML.</span><span class="sxs-lookup"><span data-stu-id="94506-110">XML Bulk Load interprets the mapping schema and identifies the table(s) into which the XML data is to be inserted.</span></span>  
  
 <span data-ttu-id="94506-111">Si presuppone che l'utente abbia familiarità con le caratteristiche [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] seguenti:</span><span class="sxs-lookup"><span data-stu-id="94506-111">It is assumed that you are familiar with the following [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] features:</span></span>  
  
-   <span data-ttu-id="94506-112">Schemi XSD e XDR annotati.</span><span class="sxs-lookup"><span data-stu-id="94506-112">Annotated XSD and XDR schemas.</span></span> <span data-ttu-id="94506-113">Per ulteriori informazioni sugli schemi XSD con annotazioni, vedere [Introduzione agli schemi XSD con Annotazioni &#40;SQLXML 4,0&#41;](../../sqlxml/annotated-xsd-schemas/introduction-to-annotated-xsd-schemas-sqlxml-4-0.md).</span><span class="sxs-lookup"><span data-stu-id="94506-113">For more information about annotated XSD schemas, see [Introduction to Annotated XSD Schemas &#40;SQLXML 4.0&#41;](../../sqlxml/annotated-xsd-schemas/introduction-to-annotated-xsd-schemas-sqlxml-4-0.md).</span></span> <span data-ttu-id="94506-114">Per informazioni sugli schemi XDR con annotazioni, vedere [schemi XDR con Annotazioni &#40;deprecati in SQLXML 4,0&#41;](../../sqlxml/annotated-xsd-schemas/annotated-xdr-schemas-deprecated-in-sqlxml-4-0.md).</span><span class="sxs-lookup"><span data-stu-id="94506-114">For information about annotated XDR schemas, see [Annotated XDR Schemas &#40;Deprecated in SQLXML 4.0&#41;](../../sqlxml/annotated-xsd-schemas/annotated-xdr-schemas-deprecated-in-sqlxml-4-0.md).</span></span>  
  
-   <span data-ttu-id="94506-115">Meccanismi di inserimento bulk [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], quali l'istruzione [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT e l'utilità bcp.</span><span class="sxs-lookup"><span data-stu-id="94506-115">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] bulk insert mechanisms, such as the [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT statement and the bcp utility.</span></span> <span data-ttu-id="94506-116">Per ulteriori informazioni, vedere [BULK INSERT &#40;&#41;Transact-SQL](/sql/t-sql/statements/bulk-insert-transact-sql) e [utilità bcp](../../../tools/bcp-utility.md).</span><span class="sxs-lookup"><span data-stu-id="94506-116">For more information, see [BULK INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/bulk-insert-transact-sql) and [bcp Utility](../../../tools/bcp-utility.md).</span></span>  
  
## <a name="streaming-of-xml-data"></a><span data-ttu-id="94506-117">Flusso dei dati XML</span><span class="sxs-lookup"><span data-stu-id="94506-117">Streaming of XML Data</span></span>  
 <span data-ttu-id="94506-118">Poiché le dimensioni del documento XML di origine possono essere elevate, l'intero documento non viene letto in memoria per l'elaborazione del caricamento bulk.</span><span class="sxs-lookup"><span data-stu-id="94506-118">Because the source XML document can be large, the entire document is not read into memory for bulk load processing.</span></span> <span data-ttu-id="94506-119">Il caricamento bulk XML interpreta invece i dati XML come un flusso e li legge.</span><span class="sxs-lookup"><span data-stu-id="94506-119">Instead, XML Bulk Load interprets the XML data as a stream and reads it.</span></span> <span data-ttu-id="94506-120">Durante la lettura dei dati, l'utilità identifica le tabelle di database, genera i record appropriati dall'origine dati XML, quindi invia i record a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] per l'inserimento.</span><span class="sxs-lookup"><span data-stu-id="94506-120">As the utility reads the data, it identifies the database table(s), generates the appropriate record(s) from the XML data source, and then sends the record(s) to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] for insertion.</span></span>  
  
 <span data-ttu-id="94506-121">Il documento XML di origine seguente, ad esempio, è costituito da **\<Customer>** elementi e **\<Order>** elementi figlio:</span><span class="sxs-lookup"><span data-stu-id="94506-121">For example, the following source XML document consists of **\<Customer>** elements and **\<Order>** child elements:</span></span>  
  
```  
<Customer ...>  
    <Order.../>  
    <Order .../>  
     ...  
</Customer>  
...  
```  
  
 <span data-ttu-id="94506-122">Durante la lettura dell'elemento, il caricamento bulk XML **\<Customer>** genera un record per customerTable.</span><span class="sxs-lookup"><span data-stu-id="94506-122">As XML Bulk Load reads the **\<Customer>** element, it generates a record for the Customertable.</span></span> <span data-ttu-id="94506-123">Quando legge il **\</Customer>** tag di fine, il caricamento bulk XML inserisce il record nella tabella in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="94506-123">When it reads the **\</Customer>** end tag, XML Bulk Load inserts that record into the table in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="94506-124">Allo stesso modo, quando legge l' **\<Order>** elemento, il caricamento bulk XML genera un record per orderTable, quindi inserisce il record nella [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] tabella durante la lettura del **\</Order>** tag di fine.</span><span class="sxs-lookup"><span data-stu-id="94506-124">In the same way, when it reads the **\<Order>** element, XML Bulk Load generates a record for the Ordertable, and then inserts that record into the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] table upon reading the **\</Order>** end tag.</span></span>  
  
## <a name="transacted-and-nontransacted-xml-bulk-load-operations"></a><span data-ttu-id="94506-125">Operazioni di caricamento bulk XML in transazioni e non in transazioni</span><span class="sxs-lookup"><span data-stu-id="94506-125">Transacted and Nontransacted XML Bulk Load Operations</span></span>  
 <span data-ttu-id="94506-126">Il caricamento bulk XML può funzionare in modalità transazionale e non transazionale.</span><span class="sxs-lookup"><span data-stu-id="94506-126">XML Bulk Load can operate in either a transacted or a nontransacted mode.</span></span> <span data-ttu-id="94506-127">Le prestazioni sono in genere ottimali se si esegue il caricamento bulk in modalità non transazionale, ovvero la proprietà Transaction è impostata su FALSE, e viene soddisfatta una delle condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="94506-127">Performance is usually optimal if you are bulk loading in a nontransacted mode: that is, the Transaction property is set to FALSE) and either of the following conditions is true:</span></span>  
  
-   <span data-ttu-id="94506-128">Le tabelle nelle quali si esegue il caricamento bulk dei dati sono vuote e senza indici.</span><span class="sxs-lookup"><span data-stu-id="94506-128">The tables into which the data is bulk loaded are empty with no indexes.</span></span>  
  
-   <span data-ttu-id="94506-129">Le tabelle includono dati e indici univoci.</span><span class="sxs-lookup"><span data-stu-id="94506-129">The tables have data and unique indexes.</span></span>  
  
 <span data-ttu-id="94506-130">L'approccio non transazionale non garantisce un rollback in caso di errore del processo di caricamento bulk, anche se possono verificarsi rollback parziali.</span><span class="sxs-lookup"><span data-stu-id="94506-130">The nontransacted approach does not guarantee a rollback if something goes wrong in the bulk load process (although partial rollbacks can happen).</span></span> <span data-ttu-id="94506-131">Il caricamento bulk non transazionale è consigliabile quando il database è vuoto.</span><span class="sxs-lookup"><span data-stu-id="94506-131">The nontransacted bulk load is appropriate when the database is empty.</span></span> <span data-ttu-id="94506-132">In caso di errore, pertanto, è possibile eseguire una pulizia del database e riavviare il caricamento bulk XML.</span><span class="sxs-lookup"><span data-stu-id="94506-132">Therefore, if something does go wrong, you can clean the database and start XML Bulk Load again.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="94506-133">In modalità non transazionale il caricamento bulk XML utilizza una transazione interna predefinita e ne esegue il commit.</span><span class="sxs-lookup"><span data-stu-id="94506-133">In nontransacted mode, XML Bulk Load uses a default internal transaction and commits it.</span></span> <span data-ttu-id="94506-134">Quando la proprietà Transaction è impostata su TRUE, il caricamento bulk XML non chiama commit per questa transazione.</span><span class="sxs-lookup"><span data-stu-id="94506-134">When the Transaction property is set to TRUE, XML Bulk Load does not call commit on this transaction.</span></span>  
  
 <span data-ttu-id="94506-135">Se la proprietà Transaction è impostata su TRUE, il caricamento bulk XML crea i file temporanei, uno per ogni tabella identificata nello schema di mapping.</span><span class="sxs-lookup"><span data-stu-id="94506-135">If the Transaction property is set to TRUE, XML Bulk Load creates temporary files, one for each table that is identified in the mapping schema.</span></span> <span data-ttu-id="94506-136">Il caricamento bulk XML archivia innanzitutto i record del documento XML di origine in questi file temporanei.</span><span class="sxs-lookup"><span data-stu-id="94506-136">XML Bulk Load first stores the records from the source XML document in these temporary files.</span></span> <span data-ttu-id="94506-137">Quindi, un'istruzione [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT recupera tali record dai file e li archivia nelle tabelle corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="94506-137">Then, a [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT statement retrieves these records from the files and stores them in the corresponding tables.</span></span> <span data-ttu-id="94506-138">È possibile specificare il percorso per questi file temporanei usando la proprietà TempFilePath.</span><span class="sxs-lookup"><span data-stu-id="94506-138">You can specify the location for these temporary files by using the TempFilePath property.</span></span> <span data-ttu-id="94506-139">In questo caso, è necessario assicurarsi che l'account di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] utilizzato con il caricamento bulk XML disponga di accesso a tale percorso.</span><span class="sxs-lookup"><span data-stu-id="94506-139">You must ensure that the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] account used with XML Bulk Load has access to this path.</span></span> <span data-ttu-id="94506-140">Se la proprietà TempFilePath non è specificata, per creare i file temporanei viene usato il percorso file predefinito specificato nella variabile di ambiente TEMP.</span><span class="sxs-lookup"><span data-stu-id="94506-140">If the TempFilePath property is not specified, the default file path that is specified in the TEMP environment variable is used to create the temporary files.</span></span>  
  
 <span data-ttu-id="94506-141">Se la proprietà Transaction è impostata su FALSE (impostazione predefinita), il caricamento bulk XML utilizza l'interfaccia OLE DB IRowsetFastLoad per eseguire il caricamento bulk dei dati.</span><span class="sxs-lookup"><span data-stu-id="94506-141">If the Transaction property is set to FALSE (the default setting), XML Bulk Load uses the OLE DB interface IRowsetFastLoad to bulk load the data.</span></span>  
  
 <span data-ttu-id="94506-142">Se la proprietà ConnectionString imposta la stringa di connessione e la proprietà Transaction è impostata su TRUE, il caricamento bulk XML opera nel proprio contesto di transazione.</span><span class="sxs-lookup"><span data-stu-id="94506-142">If the ConnectionString property sets the connection string, and the Transaction property is set to TRUE, XML Bulk Load operates in its own transaction context.</span></span> <span data-ttu-id="94506-143">ad esempio avvia la propria transazione ed esegue il commit o il rollback nel modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="94506-143">(For example, XML Bulk Load starts its own transaction, and commits or rolls back as appropriate.)</span></span>  
  
 <span data-ttu-id="94506-144">Se la proprietà ConnectionCommand imposta la connessione con un oggetto Connection esistente e la proprietà Transaction è impostata su TRUE, il caricamento bulk XML non esegue un'istruzione COMMIT o ROLLBACK in caso di esito positivo o negativo, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="94506-144">If the ConnectionCommand property sets the connection with an existing connection object and the Transaction property is set to TRUE, XML Bulk Load does not issue a COMMIT or ROLLBACK statement in the case of a success or a failure, respectively.</span></span> <span data-ttu-id="94506-145">In presenza di un errore, il caricamento bulk XML restituisce il messaggio di errore appropriato.</span><span class="sxs-lookup"><span data-stu-id="94506-145">If there is an error, XML Bulk Load returns the appropriate error message.</span></span> <span data-ttu-id="94506-146">La decisione di eseguire un'istruzione COMMIT o ROLLBACK è delegata al client che ha avviato il caricamento bulk.</span><span class="sxs-lookup"><span data-stu-id="94506-146">The decision to issue a COMMIT or ROLLBACK statement is left to the client that initiated the bulk load.</span></span> <span data-ttu-id="94506-147">L'oggetto Connection utilizzato per il caricamento bulk XML deve essere di tipo ICommand o essere un oggetto comando ADO.</span><span class="sxs-lookup"><span data-stu-id="94506-147">The connection object that is used for XML Bulk Load should be of type ICommand or be an ADO command object.</span></span>  
  
 <span data-ttu-id="94506-148">In SQLXML 4,0 non è possibile utilizzare ConnectionObject con la proprietà Transaction impostata su FALSE.</span><span class="sxs-lookup"><span data-stu-id="94506-148">In SQLXML 4.0, a ConnectionObject cannot be used with the Transaction property set to FALSE.</span></span> <span data-ttu-id="94506-149">La modalità non transazionale non è supportata con un ConnectionObject perché non è possibile aprire più di un'interfaccia IRowsetFastLoad in una sessione passata.</span><span class="sxs-lookup"><span data-stu-id="94506-149">The nontransacted mode is not supported with a ConnectionObject because it is impossible to open more than one IRowsetFastLoad interface on a passed-in session.</span></span>  
  
  
