---
title: Utilizzo dell'isolamento dello snapshot | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], snapshot isolation
- SQLNCLI, snapshot isolation
- isolation levels [SQL Server], snapshot
- DBPROPSET_SESSION property set
- DBDROPSET_DATASOURCEINFO property set
- snapshot isolation [SQL Server Native Client]
- SQL Server Native Client OLE DB provider, snapshot isolation
- SQL Server Native Client ODBC driver, snapshot isolation
- SQL Server Native Client, snapshot isolation
- SQLGetInfo function
- concurrency [SQL Server Native Client]
- SQLSetConnectAttr function
ms.assetid: 39e87eb1-677e-45dd-bc61-83a4025a7756
author: rothja
ms.author: jroth
ms.openlocfilehash: 242d054a5fd2ad12a8811bebc834d423f547a499
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87635516"
---
# <a name="working-with-snapshot-isolation"></a><span data-ttu-id="ea645-102">Utilizzo dell'isolamento dello snapshot</span><span class="sxs-lookup"><span data-stu-id="ea645-102">Working with Snapshot Isolation</span></span>
  <span data-ttu-id="ea645-103">In [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] è stato introdotto un nuovo livello di isolamento dello "snapshot" destinato a migliorare la concorrenza delle applicazioni per l'elaborazione delle transazioni online (OLTP).</span><span class="sxs-lookup"><span data-stu-id="ea645-103">[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] introduced a new "snapshot" isolation level that is intended to enhance concurrency for online transaction processing (OLTP) applications.</span></span> <span data-ttu-id="ea645-104">Nelle versioni precedenti di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] la concorrenza è basata esclusivamente sul blocco. Questa caratteristica può causare problemi di blocco e deadlock per alcune applicazioni.</span><span class="sxs-lookup"><span data-stu-id="ea645-104">In earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], concurrency was based solely on locking, which can cause blocking and deadlocking problems for some applications.</span></span> <span data-ttu-id="ea645-105">L'isolamento dello snapshot dipende dai miglioramenti apportati al controllo delle versioni delle righe e ha lo scopo di migliorare le prestazioni evitando scenari di blocco in lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="ea645-105">Snapshot isolation depends on enhancements to row versioning and is intended to improve performance by avoiding reader-writer blocking scenarios.</span></span>  
  
 <span data-ttu-id="ea645-106">Le transazioni avviate con l'isolamento dello snapshot leggono uno snapshot del database che risale all'avvio della transazione.</span><span class="sxs-lookup"><span data-stu-id="ea645-106">Transactions that start under snapshot isolation read a database snapshot as of the time when the transaction starts.</span></span> <span data-ttu-id="ea645-107">Uno dei possibili risultati è che, se aperti nel contesto di una transazione snapshot, i cursori server keyset statici e dinamici si comporteranno come cursori statici aperti in transazioni serializzabili.</span><span class="sxs-lookup"><span data-stu-id="ea645-107">One result of this is that keyset, dynamic and static server cursors, when opened within a snapshot transaction context, behave much like static cursors opened within serializable transactions.</span></span> <span data-ttu-id="ea645-108">Tuttavia, quando i cursori vengono aperti con il livello di isolamento dello snapshot, non vengono acquisiti blocchi. In questo modo viene ridotto il numero di blocchi nel server.</span><span class="sxs-lookup"><span data-stu-id="ea645-108">However, when the cursors are opened under the snapshot isolation level locks are not taken, which can reduce blocking on the server.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="ea645-109">Provider OLE DB di SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="ea645-109">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="ea645-110">Il [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provider di OLE DB di Native client include miglioramenti che sfruttano l'isolamento dello snapshot introdotto in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ea645-110">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider has enhancements that take advantage of the snapshot isolation introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="ea645-111">Tra questi miglioramenti figurano le modifiche ai set di proprietà DBPROPSET_DATASOURCEINFO e DBPROPSET_SESSION.</span><span class="sxs-lookup"><span data-stu-id="ea645-111">These enhancements include changes to the DBPROPSET_DATASOURCEINFO and DBPROPSET_SESSION property sets.</span></span>  
  
### <a name="dbpropset_datasourceinfo"></a><span data-ttu-id="ea645-112">DBPROPSET_DATASOURCEINFO</span><span class="sxs-lookup"><span data-stu-id="ea645-112">DBPROPSET_DATASOURCEINFO</span></span>  
 <span data-ttu-id="ea645-113">Il set di proprietà DBPROPSET_DATASOURCEINFO è stato modificato per indicare che il livello di isolamento dello snapshot è supportato dall'aggiunta del valore DBPROPVAL_TI_SNAPSHOT utilizzato nella proprietà DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="ea645-113">The DBPROPSET_DATASOURCEINFO property set has been changed to indicate that the snapshot isolation level is supported by the addition of the DBPROPVAL_TI_SNAPSHOT value that is used in the DBPROP_SUPPORTEDTXNISOLEVELS property.</span></span> <span data-ttu-id="ea645-114">Questo nuovo valore indica che il livello di isolamento dello snapshot è supportato indipendentemente dall'abilitazione del controllo delle versioni nel database.</span><span class="sxs-lookup"><span data-stu-id="ea645-114">This new value indicates that the snapshot isolation level is supported whether or not versioning has been enabled on the database.</span></span> <span data-ttu-id="ea645-115">Di seguito viene presentato un elenco dei valori DBPROP_SUPPORTEDTXNISOLEVELS:</span><span class="sxs-lookup"><span data-stu-id="ea645-115">The following is a list of the DBPROP_SUPPORTEDTXNISOLEVELS values:</span></span>  
  
|<span data-ttu-id="ea645-116">ID proprietà</span><span class="sxs-lookup"><span data-stu-id="ea645-116">Property ID</span></span>|<span data-ttu-id="ea645-117">Descrizione</span><span class="sxs-lookup"><span data-stu-id="ea645-117">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="ea645-118">DBPROP_SUPPORTEDTXNISOLEVELS</span><span class="sxs-lookup"><span data-stu-id="ea645-118">DBPROP_SUPPORTEDTXNISOLEVELS</span></span>|<span data-ttu-id="ea645-119">Tipo: VT_I4</span><span class="sxs-lookup"><span data-stu-id="ea645-119">Type: VT_I4</span></span><br /><br /> <span data-ttu-id="ea645-120">L/S: Sola lettura</span><span class="sxs-lookup"><span data-stu-id="ea645-120">R/W: Read only</span></span><br /><br /> <span data-ttu-id="ea645-121">Descrizione: maschera di bit che specifica i livelli di isolamento delle transazioni supportati.</span><span class="sxs-lookup"><span data-stu-id="ea645-121">Description: A bitmask specifying the supported transaction isolation levels.</span></span> <span data-ttu-id="ea645-122">Combinazione di zero o più dei valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="ea645-122">A combination of zero or more of the following:</span></span><br /><br /> <span data-ttu-id="ea645-123">-DBPROPVAL_TI_CHAOS</span><span class="sxs-lookup"><span data-stu-id="ea645-123">-   DBPROPVAL_TI_CHAOS</span></span><br /><span data-ttu-id="ea645-124">-DBPROPVAL_TI_READUNCOMMITTED</span><span class="sxs-lookup"><span data-stu-id="ea645-124">-   DBPROPVAL_TI_READUNCOMMITTED</span></span><br /><span data-ttu-id="ea645-125">-DBPROPVAL_TI_BROWSE</span><span class="sxs-lookup"><span data-stu-id="ea645-125">-   DBPROPVAL_TI_BROWSE</span></span><br /><span data-ttu-id="ea645-126">-DBPROPVAL_TI_CURSORSTABILITY</span><span class="sxs-lookup"><span data-stu-id="ea645-126">-   DBPROPVAL_TI_CURSORSTABILITY</span></span><br /><span data-ttu-id="ea645-127">-DBPROPVAL_TI_READCOMMITTED</span><span class="sxs-lookup"><span data-stu-id="ea645-127">-   DBPROPVAL_TI_READCOMMITTED</span></span><br /><span data-ttu-id="ea645-128">-DBPROPVAL_TI_REPEATABLEREAD</span><span class="sxs-lookup"><span data-stu-id="ea645-128">-   DBPROPVAL_TI_REPEATABLEREAD</span></span><br /><span data-ttu-id="ea645-129">-DBPROPVAL_TI_SERIALIZABLE</span><span class="sxs-lookup"><span data-stu-id="ea645-129">-   DBPROPVAL_TI_SERIALIZABLE</span></span><br /><span data-ttu-id="ea645-130">-DBPROPVAL_TI_ISOLATED</span><span class="sxs-lookup"><span data-stu-id="ea645-130">-   DBPROPVAL_TI_ISOLATED</span></span><br /><span data-ttu-id="ea645-131">-DBPROPVAL_TI_SNAPSHOT</span><span class="sxs-lookup"><span data-stu-id="ea645-131">-   DBPROPVAL_TI_SNAPSHOT</span></span>|  
  
### <a name="dbpropset_session"></a><span data-ttu-id="ea645-132">DBPROPSET_SESSION</span><span class="sxs-lookup"><span data-stu-id="ea645-132">DBPROPSET_SESSION</span></span>  
 <span data-ttu-id="ea645-133">Il set di proprietà DBPROPSET_SESSION è stato modificato per indicare che il livello di isolamento dello snapshot è supportato dall'aggiunta del valore DBPROPVAL_TI_SNAPSHOT utilizzato nella proprietà DBPROP_SESS_AUTOCOMMITISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="ea645-133">The DBPROPSET_SESSION property set has been changed to indicate that the snapshot isolation level is supported by the addition of the DBPROPVAL_TI_SNAPSHOT value that is used in the DBPROP_SESS_AUTOCOMMITISOLEVELS property.</span></span> <span data-ttu-id="ea645-134">Questo nuovo valore indica che il livello di isolamento dello snapshot è supportato indipendentemente dall'abilitazione del controllo delle versioni nel database.</span><span class="sxs-lookup"><span data-stu-id="ea645-134">This new value indicates that the snapshot isolation level is supported whether or not versioning has been enabled on the database.</span></span> <span data-ttu-id="ea645-135">Di seguito viene presentato un elenco dei valori DBPROP_SESS_AUTOCOMMITISOLEVELS:</span><span class="sxs-lookup"><span data-stu-id="ea645-135">The following is a list of the DBPROP_SESS_AUTOCOMMITISOLEVELS values:</span></span>  
  
|<span data-ttu-id="ea645-136">ID proprietà</span><span class="sxs-lookup"><span data-stu-id="ea645-136">Property ID</span></span>|<span data-ttu-id="ea645-137">Descrizione</span><span class="sxs-lookup"><span data-stu-id="ea645-137">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="ea645-138">DBPROP_SESS_AUTOCOMMITISOLEVELS</span><span class="sxs-lookup"><span data-stu-id="ea645-138">DBPROP_SESS_AUTOCOMMITISOLEVELS</span></span>|<span data-ttu-id="ea645-139">Tipo: VT_I4</span><span class="sxs-lookup"><span data-stu-id="ea645-139">Type: VT_I4</span></span><br /><br /> <span data-ttu-id="ea645-140">L/S: Sola lettura</span><span class="sxs-lookup"><span data-stu-id="ea645-140">R/W: Read only</span></span><br /><br /> <span data-ttu-id="ea645-141">Descrizione: specifica una maschera di bit che indica il livello di isolamento delle transazioni durante la modalità di autocommit.</span><span class="sxs-lookup"><span data-stu-id="ea645-141">Description: Specifies a bitmask that indicates the transaction isolation level while in auto-commit mode.</span></span> <span data-ttu-id="ea645-142">I valori che è possibile impostare in questa maschera di bit sono uguali a quelli che è possibile impostare per DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="ea645-142">The values that can be set in this bitmask are the same as those that can be set for DBPROP_SUPPORTEDTXNISOLEVELS.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="ea645-143">Si verifica l'errore DB_S_ERRORSOCCURRED o DB_E_ERRORSOCCURRED se DBPROPVAL_TI_SNAPSHOT viene impostato quando si utilizzano versioni di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] precedenti a [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ea645-143">The errors DB_S_ERRORSOCCURRED or DB_E_ERRORSOCCURRED will occur if DBPROPVAL_TI_SNAPSHOT is set when using versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] earlier than [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>  
  
 <span data-ttu-id="ea645-144">Per altre informazioni sul supporto dell'isolamento dello snapshot nelle transazioni, vedere [Supporto delle transazioni locali](../../native-client-ole-db-transactions/transactions.md).</span><span class="sxs-lookup"><span data-stu-id="ea645-144">For information about how snapshot isolation is supported in transactions, see [Supporting Local Transactions](../../native-client-ole-db-transactions/transactions.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="ea645-145">Driver ODBC di SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="ea645-145">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="ea645-146">Il [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC di Native Client fornisce supporto per l'isolamento dello snapshot, sebbene siano stati apportati miglioramenti alle funzioni [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) e [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="ea645-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver provides support for snapshot isolation though enhancements made to the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) functions.</span></span>  
  
### <a name="sqlsetconnectattr"></a><span data-ttu-id="ea645-147">SQLSetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="ea645-147">SQLSetConnectAttr</span></span>  
 <span data-ttu-id="ea645-148">La funzione **SQLSetConnectAttr** supporta ora l'utilizzo dell'attributo SQL_COPT_SS_TXN_ISOLATION.</span><span class="sxs-lookup"><span data-stu-id="ea645-148">The **SQLSetConnectAttr** function now supports the use of the SQL_COPT_SS_TXN_ISOLATION attribute.</span></span> <span data-ttu-id="ea645-149">Impostando SQL_COPT_SS_TXN_ISOLATION su SQL_TXN_SS_SNAPSHOT si indica che la transazione si verificherà con il livello di isolamento dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="ea645-149">Setting SQL_COPT_SS_TXN_ISOLATION to SQL_TXN_SS_SNAPSHOT indicates that the transaction will take place under the snapshot isolation level.</span></span>  
  
### <a name="sqlgetinfo"></a><span data-ttu-id="ea645-150">SQLGetInfo</span><span class="sxs-lookup"><span data-stu-id="ea645-150">SQLGetInfo</span></span>  
 <span data-ttu-id="ea645-151">La funzione [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) supporta ora il valore SQL_TXN_SS_SNAPSHOT aggiunto al tipo di informazioni di SQL_TXN_ISOLATION_OPTION.</span><span class="sxs-lookup"><span data-stu-id="ea645-151">The [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) function now supports the SQL_TXN_SS_SNAPSHOT value that has been added to the SQL_TXN_ISOLATION_OPTION info type.</span></span>  
  
 <span data-ttu-id="ea645-152">Per informazioni sul supporto dell'isolamento dello snapshot nelle transazioni, vedere [livello di isolamento delle transazioni del cursore](../../native-client-odbc-cursors/properties/cursor-transaction-isolation-level.md).</span><span class="sxs-lookup"><span data-stu-id="ea645-152">For information about how snapshot isolation is supported in transactions, see [Cursor Transaction Isolation Level](../../native-client-odbc-cursors/properties/cursor-transaction-isolation-level.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ea645-153">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="ea645-153">See Also</span></span>  
 <span data-ttu-id="ea645-154">[Funzionalità di SQL Server Native Client](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="ea645-154">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="ea645-155">Proprietà e comportamenti dei set di righe</span><span class="sxs-lookup"><span data-stu-id="ea645-155">Rowset Properties and Behaviors</span></span>](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md)  
  
  
