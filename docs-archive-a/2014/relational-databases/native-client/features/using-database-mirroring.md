---
title: Uso del mirroring del database | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- SQL Server Native Client, database mirroring
- data access [SQL Server Native Client], database mirroring
- database mirroring [SQL Server], connecting clients to
- SQLNCLI, database mirroring
- SQL Server Native Client ODBC driver, database mirroring
- SQL Server Native Client OLE DB provider, database mirroring
ms.assetid: 71b15712-7972-4465-9274-e0ddc271eedc
author: rothja
ms.author: jroth
ms.openlocfilehash: 389036322137abcc9a40e36c697e8d45e39a7de5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87625362"
---
# <a name="using-database-mirroring"></a><span data-ttu-id="a5f70-102">Utilizzo del mirroring del database</span><span class="sxs-lookup"><span data-stu-id="a5f70-102">Using Database Mirroring</span></span>
    
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../../includes/ssnotedepfutureavoid-md.md)] <span data-ttu-id="a5f70-103">In alternativa, usare [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a5f70-103">Use [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] instead.</span></span>  
  
 <span data-ttu-id="a5f70-104">Il mirroring del database, introdotto in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], è una soluzione per aumentare la disponibilità del database e la ridondanza dei dati.</span><span class="sxs-lookup"><span data-stu-id="a5f70-104">Database mirroring, introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], is a solution for increasing database availability and data redundancy.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="a5f70-105">Native Client fornisce supporto implicito per il mirroring del database, pertanto lo sviluppatore non deve scrivere codice né eseguire altre azioni dopo che è stato configurato per il database.</span><span class="sxs-lookup"><span data-stu-id="a5f70-105">Native Client provides implicit support for database mirroring, so the developer does not need to write any code or take any other action once it has been configured for the database.</span></span>  
  
 <span data-ttu-id="a5f70-106">Il mirroring del database, implementato per ogni database, consente di conservare una copia di un database di produzione [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] in un server di standby.</span><span class="sxs-lookup"><span data-stu-id="a5f70-106">Database mirroring, which is implemented on a per-database basis, keeps a copy of a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] production database on a standby server.</span></span> <span data-ttu-id="a5f70-107">Tale server può essere warm standby o hot standby, a seconda della configurazione e dello stato della sessione di mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="a5f70-107">This server is either a hot or warm standby server, depending on the configuration and state of the database mirroring session.</span></span> <span data-ttu-id="a5f70-108">Un server hot standby supporta il failover rapido senza perdita di transazioni di cui è stato eseguito il commit, mentre un server warm standby supporta la forzatura del servizio (con possibile perdita di dati).</span><span class="sxs-lookup"><span data-stu-id="a5f70-108">A hot standby server supports rapid failover with no loss of committed transactions, and a warm standby server supports forcing service (with possible data loss).</span></span>  
  
 <span data-ttu-id="a5f70-109">Il database di produzione è denominato *database principale*, mentre la copia di standby viene chiamata *database mirror*.</span><span class="sxs-lookup"><span data-stu-id="a5f70-109">The production database is called the *principal database*, and the standby copy is called the *mirror database*.</span></span> <span data-ttu-id="a5f70-110">Il database principale e il database mirror devono trovarsi in istanze separate di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (istanze server) e, se possibile, risiedere in computer separati.</span><span class="sxs-lookup"><span data-stu-id="a5f70-110">The principal database and mirror database must reside on separate instances of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (server instances), and they should reside on separate computers if possible.</span></span>  
  
 <span data-ttu-id="a5f70-111">L'istanza del server di produzione, chiamata *server principale*, comunica con l'istanza del server di standby, chiamata *server mirror*.</span><span class="sxs-lookup"><span data-stu-id="a5f70-111">The production server instance, called the *principal server*, communicates with the standby server instance, called the *mirror server*.</span></span> <span data-ttu-id="a5f70-112">I server principale e mirror fungono da partner all'interno di una *sessione*di mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="a5f70-112">The principal and mirror servers act as partners within a database mirroring *session*.</span></span> <span data-ttu-id="a5f70-113">Se si verifica un errore nel server principale, il server mirror è in grado di creare un database nel database principale tramite un processo chiamato *failover*.</span><span class="sxs-lookup"><span data-stu-id="a5f70-113">If the principal server fails, the mirror server can make its database into the principal database through a process called *failover*.</span></span> <span data-ttu-id="a5f70-114">Partner_A e Partner_B, ad esempio, sono due server partner, con il database principale inizialmente su Partner_A come server principale e il database mirror che risiede in Partner_B come server mirror.</span><span class="sxs-lookup"><span data-stu-id="a5f70-114">For example, Partner_A and Partner_B are two partner servers, with the principal database initially on Partner_A as principal server, and the mirror database residing on Partner_B as the mirror server.</span></span> <span data-ttu-id="a5f70-115">Se Partner_A passa alla modalità offline, il database su Partner_B può eseguire il failover per diventare il database principale corrente.</span><span class="sxs-lookup"><span data-stu-id="a5f70-115">If Partner_A goes offline, the database on Partner_B can fail over to become the current principal database.</span></span> <span data-ttu-id="a5f70-116">Quando Partner_A si unisce alla sessione di mirroring, diventa il server mirror e il database diventa il database mirror.</span><span class="sxs-lookup"><span data-stu-id="a5f70-116">When Partner_A rejoins the mirroring session, it becomes the mirror server and its database becomes the mirror database.</span></span>  
  
 <span data-ttu-id="a5f70-117">Le configurazioni del mirroring del database alternative offrono livelli diversi di prestazioni e sicurezza dei dati e supportano forme diverse di failover.</span><span class="sxs-lookup"><span data-stu-id="a5f70-117">Alternative database mirroring configurations offer different levels of performance and data safety, and support different forms of failover.</span></span> <span data-ttu-id="a5f70-118">Per altre informazioni, vedere [Mirroring del database &#40;SQL Server&#41;](../../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="a5f70-118">For more information, see [Database Mirroring &#40;SQL Server&#41;](../../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span></span>  
  
 <span data-ttu-id="a5f70-119">È possibile utilizzare un alias quando si specifica il nome del database mirror.</span><span class="sxs-lookup"><span data-stu-id="a5f70-119">It is possible to use an alias when specifying the mirror database name.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a5f70-120">Per informazioni sui tentativi di connessione iniziali e su quelli di riconnessione a un database con mirroring, vedere [Connettere client a una sessione di mirroring del database &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="a5f70-120">For information about initial connection attempts and reconnection attempts to a mirrored database, see [Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span></span>  
  
## <a name="programming-considerations"></a><span data-ttu-id="a5f70-121">Considerazioni sulla programmazione</span><span class="sxs-lookup"><span data-stu-id="a5f70-121">Programming Considerations</span></span>  
 <span data-ttu-id="a5f70-122">Quando si verifica un errore nel server di database principale, l'applicazione client riceve errori in risposta a chiamate API che indicano che la connessione al database è stata persa.</span><span class="sxs-lookup"><span data-stu-id="a5f70-122">When the principal database server fails, the client application receives errors in response to API calls, which indicate that the connection to the database has been lost.</span></span> <span data-ttu-id="a5f70-123">In questo caso qualsiasi modifica al database di cui non sia stato eseguito il commit viene persa e viene eseguito il rollback della transazione corrente.</span><span class="sxs-lookup"><span data-stu-id="a5f70-123">When this happens, any uncommitted changes to the database are lost and the current transaction is rolled back.</span></span> <span data-ttu-id="a5f70-124">In una situazione di questo tipo l'applicazione deve chiudere la connessione (o rilasciare l'oggetto origine dati) e stabilirla nuovamente.</span><span class="sxs-lookup"><span data-stu-id="a5f70-124">If this occurs, the application should close the connection (or release the data source object) and re-open it.</span></span> <span data-ttu-id="a5f70-125">La connessione viene reindirizzata in maniera trasparente al database mirror che ora viene utilizzato come server principale.</span><span class="sxs-lookup"><span data-stu-id="a5f70-125">The connection is transparently re-directed to the mirror database, which now acts as the principal server.</span></span>  
  
 <span data-ttu-id="a5f70-126">Quando viene stabilita una connessione, il server principale invia l'identità del proprio partner di failover al client da utilizzare quando si verifica il failover.</span><span class="sxs-lookup"><span data-stu-id="a5f70-126">When a connection is established, the principal server sends the identity of its failover partner to the client to be used when failover occurs.</span></span> <span data-ttu-id="a5f70-127">Nei casi in cui un'applicazione ha provato a stabilire una connessione dopo che si è verificato un errore nel server principale, il client non conosce l'identità del partner di failover.</span><span class="sxs-lookup"><span data-stu-id="a5f70-127">Where an application tried to establish a connection after the principal server failed, the client does not know the identity of the failover partner.</span></span> <span data-ttu-id="a5f70-128">Per consentire ai client di far fronte a questo scenario, una proprietà di inizializzazione e una parola chiave della stringa di connessione associata consentono al client di specificare l'identità del partner di failover.</span><span class="sxs-lookup"><span data-stu-id="a5f70-128">To allow clients the opportunity to cope with this scenario, an initialization property and an associated connection string keyword allow the client to specify the identity of the failover partner on its own.</span></span> <span data-ttu-id="a5f70-129">L'attributo client viene utilizzato solo in questo scenario. Se è disponibile, il server principale non viene utilizzato.</span><span class="sxs-lookup"><span data-stu-id="a5f70-129">The client attribute is used only in this scenario; if the principal server is available, it is not used.</span></span> <span data-ttu-id="a5f70-130">Se il server partner di failover fornito dal client non si riferisce a un server utilizzato come partner di failover, la connessione viene rifiutata dal server.</span><span class="sxs-lookup"><span data-stu-id="a5f70-130">If the failover partner server supplied by the client does not refer to a server acting as a failover partner, the connection is refused by the server.</span></span> <span data-ttu-id="a5f70-131">Per consentire alle applicazioni di adattarsi alle modifiche di configurazione, l'identità del partner di failover effettivo può essere determinata ispezionando l'attributo dopo che è stata stabilita la connessione.</span><span class="sxs-lookup"><span data-stu-id="a5f70-131">To allow applications to adapt to configuration changes, the identity of the actual failover partner can be determined by inspecting the attribute after the connection has been established.</span></span> <span data-ttu-id="a5f70-132">È consigliabile memorizzare nella cache le informazioni sul partner per aggiornare la stringa di connessione oppure escogitare una strategia per eseguire un nuovo tentativo nel caso in cui il primo tentativo di stabilire una connessione non riesca.</span><span class="sxs-lookup"><span data-stu-id="a5f70-132">You should consider caching the partner information to update the connection string or devise a retry strategy in the event that the first attempt at making a connection fails.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a5f70-133">È necessario specificare in modo esplicito il database che dovrà essere utilizzato da una connessione se si desidera utilizzare questa caratteristica in un DSN, una stringa di connessione oppure una proprietà o un attributo di connessione.</span><span class="sxs-lookup"><span data-stu-id="a5f70-133">You must explicitly specify the database to be used by a connection if you want to use this feature in a DSN, connection string, or connection property/attribute.</span></span> <span data-ttu-id="a5f70-134">Se non si esegue questa operazione, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client non proverà ad eseguire il failover nel database partner.</span><span class="sxs-lookup"><span data-stu-id="a5f70-134">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will not attempt to failover to the partner database if this is not done.</span></span>  
>   
>  <span data-ttu-id="a5f70-135">Il mirroring è una caratteristica del database.</span><span class="sxs-lookup"><span data-stu-id="a5f70-135">Mirroring is a feature of the database.</span></span> <span data-ttu-id="a5f70-136">Nelle applicazioni che utilizzano più database potrebbe non essere possibile sfruttare questa caratteristica.</span><span class="sxs-lookup"><span data-stu-id="a5f70-136">Applications that use multiple databases might not be able to exploit this feature.</span></span>  
>   
>  <span data-ttu-id="a5f70-137">Per i nomi di server, inoltre, non viene fatta distinzione tra maiuscole e minuscole, mentre tale distinzione viene fatta per i nomi di database.</span><span class="sxs-lookup"><span data-stu-id="a5f70-137">In addition, server names are case insensitive, but database names are case sensitive.</span></span> <span data-ttu-id="a5f70-138">È pertanto consigliabile assicurarsi di utilizzare la stessa combinazione tra maiuscole e minuscole nei DSN e nelle stringhe di connessione.</span><span class="sxs-lookup"><span data-stu-id="a5f70-138">You should therefore make sure that you use the same casing in DSNs and connection strings.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="a5f70-139">Provider OLE DB di SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="a5f70-139">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="a5f70-140">Il [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provider di OLE DB di Native Client supporta il mirroring del database tramite gli attributi della stringa di connessione e connessione.</span><span class="sxs-lookup"><span data-stu-id="a5f70-140">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports database mirroring through connection and connection string attributes.</span></span> <span data-ttu-id="a5f70-141">La proprietà SSPROP_INIT_FAILOVERPARTNER è stata aggiunta al set di proprietà DBPROPSET_SQLSERVERDBINIT e la parola chiave `FailoverPartner` è un nuovo attributo di stringa di connessione per DBPROP_INIT_PROVIDERSTRING.</span><span class="sxs-lookup"><span data-stu-id="a5f70-141">The SSPROP_INIT_FAILOVERPARTNER property has been added to the DBPROPSET_SQLSERVERDBINIT property set, and the `FailoverPartner` keyword is a new connection string attribute for DBPROP_INIT_PROVIDERSTRING.</span></span> <span data-ttu-id="a5f70-142">Per ulteriori informazioni, vedere [utilizzo delle parole chiave delle stringhe di connessione con SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span><span class="sxs-lookup"><span data-stu-id="a5f70-142">For more information, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="a5f70-143">La cache di failover viene mantenuta fino a quando il provider viene caricato, ovvero fino a quando non viene chiamato **CoUninitialize** o a condizione che l'applicazione disponga di un riferimento a un oggetto gestito da [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] native client OLE DB provider, ad esempio un oggetto origine dati.</span><span class="sxs-lookup"><span data-stu-id="a5f70-143">The failover cache is maintained as long as the provider is loaded, which is until **CoUninitialize** is called or as long as the application has a reference to some object managed by the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider such as a data source object.</span></span>  
  
 <span data-ttu-id="a5f70-144">Per informazioni dettagliate sul [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] supporto del provider OLE DB Native Client per il mirroring del database, vedere [proprietà di inizializzazione e autorizzazione](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span><span class="sxs-lookup"><span data-stu-id="a5f70-144">For details about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider support for database mirroring, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="a5f70-145">Driver ODBC di SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="a5f70-145">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="a5f70-146">Il [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC di Native Client supporta il mirroring del database tramite gli attributi della stringa di connessione e connessione.</span><span class="sxs-lookup"><span data-stu-id="a5f70-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports database mirroring through connection and connection string attributes.</span></span> <span data-ttu-id="a5f70-147">In particolare, l'attributo SQL_COPT_SS_FAILOVER_PARTNER è stato aggiunto per l'utilizzo con le funzioni [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) e [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) . e la `Failover_Partner` parola chiave è stata aggiunta come nuovo attributo della stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="a5f70-147">Specifically, the SQL_COPT_SS_FAILOVER_PARTNER attribute has been added for use with the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) functions; and the `Failover_Partner` keyword has been added as a new connection string attribute.</span></span>  
  
 <span data-ttu-id="a5f70-148">La cache di failover viene gestita finché nell'applicazione è allocato almeno un handle di ambiente.</span><span class="sxs-lookup"><span data-stu-id="a5f70-148">The failover cache is maintained as long as the application has at least one environment handle allocated.</span></span> <span data-ttu-id="a5f70-149">Viene invece persa quando l'ultimo handle di ambiente viene deallocato.</span><span class="sxs-lookup"><span data-stu-id="a5f70-149">Conversely, it is lost when the last environment handle is deallocated.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a5f70-150">Gestione driver ODBC è stato migliorato per supportare la specifica del nome del server di failover.</span><span class="sxs-lookup"><span data-stu-id="a5f70-150">The ODBC Driver Manager has been enhanced to support the specification of the failover server name.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a5f70-151">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="a5f70-151">See Also</span></span>  
 <span data-ttu-id="a5f70-152">[Funzionalità di SQL Server Native Client](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="a5f70-152">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 <span data-ttu-id="a5f70-153">[Connettere client a una sessione di mirroring del database &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="a5f70-153">[Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md) </span></span>  
 [<span data-ttu-id="a5f70-154">Mirroring del database &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="a5f70-154">Database Mirroring &#40;SQL Server&#41;</span></span>](../../../database-engine/database-mirroring/database-mirroring-sql-server.md)  
  
  
