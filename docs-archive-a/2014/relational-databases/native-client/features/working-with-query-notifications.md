---
title: Utilizzo delle notifiche delle query | Microsoft Docs
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], query notifications
- rowsets [SQL Server], notifications
- SQL Server Native Client, query notifications
- notifications [SQL Server Native Client]
- query notifications [SQL Server], SQL Server Native Client
- canceling rowset changes
- IRowsetNotify interface
- SQLNCLI, query notifications
- SQL Server Native Client OLE DB provider, query notifications
- consumer notification for rowset changes [SQL Server Native Client]
ms.assetid: 2f906fff-5ed9-4527-9fd3-9c0d27c3dff7
author: rothja
ms.author: jroth
ms.openlocfilehash: ba30bfc8df05a55e297ae8fcb8e2253de57e3ca6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87635520"
---
# <a name="working-with-query-notifications"></a><span data-ttu-id="cd103-102">Utilizzo delle notifiche delle query</span><span class="sxs-lookup"><span data-stu-id="cd103-102">Working with Query Notifications</span></span>
  <span data-ttu-id="cd103-103">Le notifiche delle query sono state introdotte in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] e in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span><span class="sxs-lookup"><span data-stu-id="cd103-103">Query notifications were introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span></span> <span data-ttu-id="cd103-104">Basate sull'infrastruttura di Service Broker introdotta in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], tali notifiche consentono di comunicare alle applicazioni che i dati sono stati modificati.</span><span class="sxs-lookup"><span data-stu-id="cd103-104">Built upon the Service Broker infrastructure introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], query notifications allow applications to be notified when data has changed.</span></span> <span data-ttu-id="cd103-105">Questa caratteristica è particolarmente utile per le applicazioni che forniscono una cache di informazioni provenienti da un database, ad esempio un'applicazione Web, e devono essere notificate quando i dati di origine vengono modificati.</span><span class="sxs-lookup"><span data-stu-id="cd103-105">This feature is particularly useful for applications that provide a cache of information from a database, such as a Web application, and need to be notified when the source data is changed.</span></span>  
  
 <span data-ttu-id="cd103-106">Le notifiche delle query consentono di richiedere una notifica entro un determinato periodo di timeout quando i dati sottostanti di una query cambiano.</span><span class="sxs-lookup"><span data-stu-id="cd103-106">Query notifications allow you to request notification within a specified time-out period when the underlying data of a query changes.</span></span> <span data-ttu-id="cd103-107">La richiesta di notifica specifica le opzioni di notifica che includono il nome del servizio, il testo del messaggio e il valore di timeout per il server.</span><span class="sxs-lookup"><span data-stu-id="cd103-107">The request for notification specifies the notification options, which include the service name, message text, and time-out value to the server.</span></span> <span data-ttu-id="cd103-108">Le notifiche vengono recapitate tramite una coda di Service Broker di cui le applicazioni possono eseguire il polling delle notifiche disponibili.</span><span class="sxs-lookup"><span data-stu-id="cd103-108">Notifications are delivered through a Service Broker queue that applications may poll for available notifications.</span></span>  
  
 <span data-ttu-id="cd103-109">La sintassi delle opzioni delle notifiche delle query è la seguente:</span><span class="sxs-lookup"><span data-stu-id="cd103-109">The syntax of the query notifications options string is:</span></span>  
  
 `service=<service-name>[;(local database=<database> | broker instance=<broker instance>)]`  
  
 <span data-ttu-id="cd103-110">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="cd103-110">For example:</span></span>  
  
 `service=mySSBService;local database=mydb`  
  
 <span data-ttu-id="cd103-111">Le sottoscrizioni di notifica sopravvivono al processo che le avvia, in quanto un'applicazione può creare una sottoscrizione di notifica e quindi terminare.</span><span class="sxs-lookup"><span data-stu-id="cd103-111">Notification subscriptions outlive the process that initiates them, as an application may create a notification subscription and then terminate.</span></span> <span data-ttu-id="cd103-112">La sottoscrizione rimane valida e la notifica verrà creata se i dati vengono modificati nel periodo di timeout specificato al momento della creazione della sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="cd103-112">The subscription remains valid, and the notification will occur if the data changes within the time-out period specified when the subscription was created.</span></span> <span data-ttu-id="cd103-113">Una notifica viene identificata dalla query eseguita, dalle opzioni di notifica e dal testo del messaggio e può essere annullata impostandone il valore di timeout su zero.</span><span class="sxs-lookup"><span data-stu-id="cd103-113">A notification is identified by the query executed, the notification options, and the message text, and may be cancelled by setting its time-out value to zero.</span></span>  
  
 <span data-ttu-id="cd103-114">Le notifiche vengono inviate una sola volta.</span><span class="sxs-lookup"><span data-stu-id="cd103-114">Notifications are sent only once.</span></span> <span data-ttu-id="cd103-115">Per la notifica continua delle modifiche dei dati, è necessario creare una nuova sottoscrizione rieseguendo la query al termine dell'elaborazione di ogni notifica.</span><span class="sxs-lookup"><span data-stu-id="cd103-115">For continuous notification of data change, a new subscription must be created by re-executing the query after each notification is processed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="cd103-116">Le applicazioni client native ricevono in genere notifiche tramite il [!INCLUDE[tsql](../../../includes/tsql-md.md)] comando [Receive](/sql/t-sql/statements/receive-transact-sql) per leggere le notifiche dalla coda associata al servizio specificato nelle opzioni di notifica.</span><span class="sxs-lookup"><span data-stu-id="cd103-116">Native Client applications typically receive notifications by using the [!INCLUDE[tsql](../../../includes/tsql-md.md)] [RECEIVE](/sql/t-sql/statements/receive-transact-sql) command to read notifications from the queue associated with the service specified in the notification options.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="cd103-117">I nomi di tabella devono essere qualificati nelle query per le quali è necessaria la notifica, ad esempio `dbo.myTable`,</span><span class="sxs-lookup"><span data-stu-id="cd103-117">Table names must be qualified in queries for which notification is required, for example, `dbo.myTable`.</span></span> <span data-ttu-id="cd103-118">e devono essere qualificati con nomi in due parti.</span><span class="sxs-lookup"><span data-stu-id="cd103-118">Table names must be qualified with two part names.</span></span> <span data-ttu-id="cd103-119">La sottoscrizione non è valida se vengono utilizzati nomi in tre o quattro parti.</span><span class="sxs-lookup"><span data-stu-id="cd103-119">Subscription is invalid if three- or four-part names are used.</span></span>  
  
 <span data-ttu-id="cd103-120">L'infrastruttura della notifica si basa su una caratteristica di accodamento introdotta in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="cd103-120">The notification infrastructure is built on top of a queuing feature introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="cd103-121">In genere, le notifiche generate sul server vengono inviate tramite queste code in modo da essere elaborate in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="cd103-121">In general, notifications generated at the server are sent through these queues to be processed later.</span></span>  
  
 <span data-ttu-id="cd103-122">Per utilizzare le notifiche delle query è necessario che sul server siano disponibili una coda e un servizio.</span><span class="sxs-lookup"><span data-stu-id="cd103-122">To use query notifications a queue and a service must exist on the server.</span></span> <span data-ttu-id="cd103-123">Tali elementi possono essere creati utilizzando [!INCLUDE[tsql](../../../includes/tsql-md.md)] come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="cd103-123">These can be created using [!INCLUDE[tsql](../../../includes/tsql-md.md)] similar to the following:</span></span>  
  
```  
CREATE QUEUE myQueue  
CREATE SERVICE myService ON QUEUE myQueue   
  
([https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification])  
```  
  
> [!NOTE]  
>  <span data-ttu-id="cd103-124">Come mostrato sopra, il servizio deve utilizzare il contratto predefinito `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification`.</span><span class="sxs-lookup"><span data-stu-id="cd103-124">The service must use the predefined contract `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification` as shown above.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="cd103-125">Provider OLE DB di SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="cd103-125">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="cd103-126">Il [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provider OLE DB di Native Client supporta la notifica del consumer per la modifica del set di righe</span><span class="sxs-lookup"><span data-stu-id="cd103-126">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports consumer notification on rowset modification.</span></span> <span data-ttu-id="cd103-127">Il consumer riceve una notifica a ogni fase di modifica dei set di righe e a ogni tentativo di modifica.</span><span class="sxs-lookup"><span data-stu-id="cd103-127">The consumer receives notification at every phase of rowset modification and on any attempted change.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="cd103-128">Il passaggio di una query di notifica al server con **ICommand:: Execute** è l'unico modo valido per sottoscrivere le notifiche delle query con il [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provider di OLE DB di Native Client.</span><span class="sxs-lookup"><span data-stu-id="cd103-128">Passing a notifications query to the server with **ICommand::Execute** is the only valid way to subscribe to query notifications with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider.</span></span>  
  
### <a name="the-dbpropset_sqlserverrowset-property-set"></a><span data-ttu-id="cd103-129">Set di proprietà DBPROPSET_SQLSERVERROWSET</span><span class="sxs-lookup"><span data-stu-id="cd103-129">The DBPROPSET_SQLSERVERROWSET Property Set</span></span>  
 <span data-ttu-id="cd103-130">Per supportare le notifiche di query tramite OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] native client aggiunge le nuove proprietà seguenti al set di proprietà DBPROPSET_SQLSERVERROWSET.</span><span class="sxs-lookup"><span data-stu-id="cd103-130">In order to support query notifications through OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client adds the following new properties to the DBPROPSET_SQLSERVERROWSET property set.</span></span>  
  
|<span data-ttu-id="cd103-131">Nome</span><span class="sxs-lookup"><span data-stu-id="cd103-131">Name</span></span>|<span data-ttu-id="cd103-132">Type</span><span class="sxs-lookup"><span data-stu-id="cd103-132">Type</span></span>|<span data-ttu-id="cd103-133">Descrizione</span><span class="sxs-lookup"><span data-stu-id="cd103-133">Description</span></span>|  
|----------|----------|-----------------|  
|<span data-ttu-id="cd103-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="cd103-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span></span>|<span data-ttu-id="cd103-135">VT_UI4</span><span class="sxs-lookup"><span data-stu-id="cd103-135">VT_UI4</span></span>|<span data-ttu-id="cd103-136">Numero di secondi durante i quali la notifica di query deve rimanere attiva.</span><span class="sxs-lookup"><span data-stu-id="cd103-136">The number of seconds that the query notification is to remain active.</span></span><br /><br /> <span data-ttu-id="cd103-137">Il valore predefinito è 432000 secondi (5 giorni).</span><span class="sxs-lookup"><span data-stu-id="cd103-137">The default is 432000 seconds (5 days).</span></span> <span data-ttu-id="cd103-138">Il valore minimo è 1 secondo e il valore massimo è 2^31-1 secondi.</span><span class="sxs-lookup"><span data-stu-id="cd103-138">The minimum value is 1 second, and the maximum value is 2^31-1 seconds.</span></span>|  
|<span data-ttu-id="cd103-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="cd103-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span></span>|<span data-ttu-id="cd103-140">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="cd103-140">VT_BSTR</span></span>|<span data-ttu-id="cd103-141">Testo del messaggio di notifica.</span><span class="sxs-lookup"><span data-stu-id="cd103-141">The message text of the notification.</span></span> <span data-ttu-id="cd103-142">Tale testo è definito dall'utente e non presenta un formato predefinito.</span><span class="sxs-lookup"><span data-stu-id="cd103-142">This is user defined, and has no predefined format.</span></span><br /><br /> <span data-ttu-id="cd103-143">Per impostazione predefinita, la stringa è vuota.</span><span class="sxs-lookup"><span data-stu-id="cd103-143">By default, the string is empty.</span></span> <span data-ttu-id="cd103-144">È possibile specificare un messaggio utilizzando da 1 a 2000 caratteri.</span><span class="sxs-lookup"><span data-stu-id="cd103-144">You can specify a message using 1-2000 characters.</span></span>|  
|<span data-ttu-id="cd103-145">SSPROP_QP_NOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="cd103-145">SSPROP_QP_NOTIFICATION_OPTIONS</span></span>|<span data-ttu-id="cd103-146">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="cd103-146">VT_BSTR</span></span>|<span data-ttu-id="cd103-147">Opzioni di notifica delle query.</span><span class="sxs-lookup"><span data-stu-id="cd103-147">The query notification options.</span></span> <span data-ttu-id="cd103-148">Queste vengono specificate in una stringa con sintassi del valore del *nome* = *value* .</span><span class="sxs-lookup"><span data-stu-id="cd103-148">These are specified in a string with *name*=*value* syntax.</span></span> <span data-ttu-id="cd103-149">L'utente è responsabile della creazione del servizio e della lettura delle notifiche all'esterno della coda.</span><span class="sxs-lookup"><span data-stu-id="cd103-149">The user is responsible for creating the service and reading notifications off of the queue.</span></span><br /><br /> <span data-ttu-id="cd103-150">Il valore predefinito è una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="cd103-150">The default is an empty string.</span></span>|  
  
 <span data-ttu-id="cd103-151">Il commit della sottoscrizione di notifica viene sempre eseguito, indipendentemente dall'esecuzione dell'istruzione in una transazione utente o in modalità di commit automatico o a prescindere se la transazione in cui è stata eseguita l'istruzione sia stata sottoposta a commit o a rollback.</span><span class="sxs-lookup"><span data-stu-id="cd103-151">The notification subscription is always committed, regardless of whether the statement ran in a user transaction or in auto commit or whether the transaction in which the statement ran committed or rolled back.</span></span> <span data-ttu-id="cd103-152">La notifica server viene generata in seguito a una delle condizioni di notifica non valide seguenti: modifica dello schema o dei dati sottostanti o raggiungimento del periodo di timeout, a seconda dell'evento che si verifica per primo.</span><span class="sxs-lookup"><span data-stu-id="cd103-152">The server notification fires upon any of the following invalid notification conditions: change of underlying data or schema, or when the timeout period is reached; whichever is first.</span></span> <span data-ttu-id="cd103-153">Le registrazioni della notifica vengono eliminate subito dopo essere state generate.</span><span class="sxs-lookup"><span data-stu-id="cd103-153">Notification registrations are deleted as soon as they are fired.</span></span> <span data-ttu-id="cd103-154">In seguito alla ricezione delle notifiche, è pertanto necessario che venga effettuata nuovamente la sottoscrizione se si desidera ottenere ulteriori aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="cd103-154">Hence upon receiving notifications, the application must subscribe again in case they want to get further updates.</span></span>  
  
 <span data-ttu-id="cd103-155">Un'altra connessione o un altro thread può verificare la presenza di notifiche nella coda di destinazione.</span><span class="sxs-lookup"><span data-stu-id="cd103-155">Another connection or thread can check the destination queue for notifications.</span></span> <span data-ttu-id="cd103-156">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="cd103-156">For example:</span></span>  
  
```  
WAITFOR (RECEIVE * FROM MyQueue);   // Where MyQueue is the queue name.   
```  
  
 <span data-ttu-id="cd103-157">Si noti che SELECT \* non elimina la voce dalla coda, diversamente da RECEIVE \* FROM.</span><span class="sxs-lookup"><span data-stu-id="cd103-157">Note that SELECT \* does not delete the entry from the Queue, however RECEIVE \* FROM does.</span></span> <span data-ttu-id="cd103-158">Di conseguenza un thread del server viene bloccato se la coda è vuota.</span><span class="sxs-lookup"><span data-stu-id="cd103-158">This stalls a server thread if the queue is empty.</span></span> <span data-ttu-id="cd103-159">Se al momento della chiamata sono presenti voci nella coda, vengono restituite immediatamente. In caso contrario, la chiamata resta in attesa finché non viene creata una voce della coda.</span><span class="sxs-lookup"><span data-stu-id="cd103-159">If there are queue entries at the time of the call, they are returned immediately; otherwise the call waits until a queue entry is made.</span></span>  
  
```  
RECEIVE * FROM MyQueue  
```  
  
 <span data-ttu-id="cd103-160">Questa istruzione restituisce immediatamente un set di risultati vuoto se la coda è vuota. In caso contrario, restituisce tutte le notifiche della coda.</span><span class="sxs-lookup"><span data-stu-id="cd103-160">This statement immediately returns an empty result set if the queue is empty; otherwise it returns all queue notifications.</span></span>  
  
 <span data-ttu-id="cd103-161">Se le proprietà SSPROP_QP_NOTIFICATION_MSGTEXT e SSPROP_QP_NOTIFICATION_OPTIONS sono diverse da Null e non vuote, l'intestazione TDS delle notifiche delle query contenente le tre proprietà definite sopra viene inviata al server a ogni esecuzione del comando.</span><span class="sxs-lookup"><span data-stu-id="cd103-161">If SSPROP_QP_NOTIFICATION_MSGTEXT and SSPROP_QP_NOTIFICATION_OPTIONS are non-NULL and non-empty, the query notifications TDS header containing the three properties defined above are sent to the server with each execution of the command.</span></span> <span data-ttu-id="cd103-162">Se una di esse è Null o vuota, l'intestazione non viene inviata e viene generato DB_E_ERRORSOCCURRED, o DB_S_ERRORSOCCURRED se le proprietà sono entrambe contrassegnate come facoltative, e il valore dello stato viene impostato su DBPROPSTATUS_BADVALUE.</span><span class="sxs-lookup"><span data-stu-id="cd103-162">If either of them is null (or empty), the header is not sent and DB_E_ERRORSOCCURRED is raised, (or DB_S_ERRORSOCCURRED if the properties are both marked as optional), and the status value is set to DBPROPSTATUS_BADVALUE.</span></span> <span data-ttu-id="cd103-163">La convalida viene effettuata in fase di esecuzione/preparazione.</span><span class="sxs-lookup"><span data-stu-id="cd103-163">The validation occurs on Execute/Prepare.</span></span> <span data-ttu-id="cd103-164">Analogamente, DB_S_ERRORSOCCURED viene generato quando le proprietà della notifica di query sono impostate per le connessioni alle versioni di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] precedenti a [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="cd103-164">Similarly, DB_S_ERRORSOCCURED is raised when the query notification properties are set for connections to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="cd103-165">Il valore dello stato in questo caso è DBPROPSTATUS_NOTSUPPORTED.</span><span class="sxs-lookup"><span data-stu-id="cd103-165">The status value in this case is DBPROPSTATUS_NOTSUPPORTED.</span></span>  
  
 <span data-ttu-id="cd103-166">L'avvio di una sottoscrizione non garantisce il corretto recapito dei messaggi successivi.</span><span class="sxs-lookup"><span data-stu-id="cd103-166">Initiating a subscription does not guarantee that subsequent messages will be successfully delivered.</span></span> <span data-ttu-id="cd103-167">Inoltre, non viene effettuato alcun controllo della validità del nome di servizio specificato.</span><span class="sxs-lookup"><span data-stu-id="cd103-167">In addition, no check is made as to the validity of the service name specified.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="cd103-168">La preparazione delle istruzioni non causerà mai l'avvio della sottoscrizione. Tale operazione verrà effettuata solo mediante l'esecuzione delle istruzioni. L'uso dei servizi OLE DB di base non influisce sulle notifiche delle query.</span><span class="sxs-lookup"><span data-stu-id="cd103-168">Preparing statements will never cause the subscription to be initiated; only statement execution will achieve this and query notifications are not impacted by the use of OLE DB core services.</span></span>  
  
 <span data-ttu-id="cd103-169">Per ulteriori informazioni sul set di proprietà DBPROPSET_SQLSERVERROWSET, vedere [proprietà e comportamenti dei set di righe](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md).</span><span class="sxs-lookup"><span data-stu-id="cd103-169">For more information about the DBPROPSET_SQLSERVERROWSET property set, see [Rowset Properties and Behaviors](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="cd103-170">Driver ODBC di SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="cd103-170">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="cd103-171">Il [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC di Native Client supporta le notifiche di query tramite l'aggiunta di tre nuovi attributi alle funzioni [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) e [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) :</span><span class="sxs-lookup"><span data-stu-id="cd103-171">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports query notifications through the addition of three new attributes to the [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) and [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) functions:</span></span>  
  
-   <span data-ttu-id="cd103-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="cd103-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span></span>  
  
-   <span data-ttu-id="cd103-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="cd103-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span></span>  
  
-   <span data-ttu-id="cd103-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="cd103-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span></span>  
  
 <span data-ttu-id="cd103-175">Se le proprietà SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT e SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS sono diverse da Null, l'intestazione TDS delle notifiche delle query contenente i tre attributi definiti sopra verrà inviata al server ogni volta che il comando viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="cd103-175">If SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT and SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS are not NULL, the query notifications TDS header containing the three attributes defined above will be sent to the server each time the command is executed.</span></span> <span data-ttu-id="cd103-176">Se una di esse è Null, l'intestazione non viene inviata e viene restituito SQL_SUCCESS_WITH_INFO.</span><span class="sxs-lookup"><span data-stu-id="cd103-176">If either of them is null, the header is not sent, and SQL_SUCCESS_WITH_INFO is returned.</span></span> <span data-ttu-id="cd103-177">La convalida si verifica sulla [funzione SQLPrepare](https://go.microsoft.com/fwlink/?LinkId=59360), **SQLExecDirect**e **SQLExecute**, che non hanno esito positivo se gli attributi non sono validi.</span><span class="sxs-lookup"><span data-stu-id="cd103-177">The validation occurs on [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360), **SqlExecDirect**, and **SqlExecute**, all of which fail if the attributes are not valid.</span></span> <span data-ttu-id="cd103-178">Analogamente, quando questi attributi di notifica delle query vengono impostati per le versioni [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] precedenti a [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], l'esecuzione non riesce e viene restituito SQL_SUCCESS_WITH_INFO.</span><span class="sxs-lookup"><span data-stu-id="cd103-178">Similarly, when these query notification attributes are set for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], the execution fails with SQL_SUCCESS_WITH_INFO.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="cd103-179">La preparazione delle istruzioni non causerà mai l'avvio della sottoscrizione. Tale operazione verrà effettuata solo mediante l'esecuzione delle istruzioni.</span><span class="sxs-lookup"><span data-stu-id="cd103-179">Prepare statements will never cause the subscription to be initiated; subscription can be initiated by statement execution.</span></span>  
  
## <a name="special-cases-and-restrictions"></a><span data-ttu-id="cd103-180">Casi e restrizioni speciali</span><span class="sxs-lookup"><span data-stu-id="cd103-180">Special Cases and Restrictions</span></span>  
 <span data-ttu-id="cd103-181">I tipi di dati seguenti non sono supportati per le notifiche:</span><span class="sxs-lookup"><span data-stu-id="cd103-181">The following data types are not supported for notifications:</span></span>  
  
-   `text`  
  
-   `ntext`  
  
-   `image`  
  
 <span data-ttu-id="cd103-182">Se viene effettuata una richiesta di notifica per una query che restituisce uno di questi tipi, la notifica viene generata immediatamente, indicando che la sottoscrizione di notifica non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="cd103-182">If a notification request is made for a query which returns any of these types, the notification fires immediately, specifying that notification subscription was not possible.</span></span>  
  
 <span data-ttu-id="cd103-183">Se una richiesta di sottoscrizione viene eseguita per un batch o una stored procedure, verrà eseguita una richiesta di sottoscrizione separata per ogni istruzione eseguita all'interno del batch o della stored procedure.</span><span class="sxs-lookup"><span data-stu-id="cd103-183">If a subscription request is made for a batch or stored procedure, a separate subscription request is made for each statement executed within the batch or stored procedure.</span></span> <span data-ttu-id="cd103-184">Le istruzioni EXECUTE non registreranno una notifica, ma invieranno la richiesta di notifica al comando eseguito.</span><span class="sxs-lookup"><span data-stu-id="cd103-184">EXECUTE statements will not register a notification, but will send the notification request to the executed command.</span></span> <span data-ttu-id="cd103-185">Nel caso di un batch, il contesto verrà applicato alle istruzioni eseguite e verranno applicate le stesse regole illustrate in precedenza.</span><span class="sxs-lookup"><span data-stu-id="cd103-185">If it is a batch, the context will be applied to the executed statements and the same rules described above apply.</span></span>  
  
 <span data-ttu-id="cd103-186">L'invio di una query per la notifica inviata dallo stesso utente nello stesso contesto di database e ha lo stesso modello, gli stessi valori dei parametri, lo stesso ID di notifica e lo stesso percorso di recapito di una sottoscrizione attiva esistente, rinnoverà la sottoscrizione esistente, reimpostando il nuovo timeout specificato. Ciò significa che se viene richiesta una notifica per query identiche, verrà inviata solo una notifica.</span><span class="sxs-lookup"><span data-stu-id="cd103-186">Submission of a query for notification that was submitted by the same user under the same database context and has the same template, same parameter values, same notification ID, and same delivery location of an existing active subscription, will renew the existing subscription, resetting the new specified time-out. This means that if notification is requested for identical queries, only one notification will be sent.</span></span> <span data-ttu-id="cd103-187">Questa restrizione è applicabile a una query duplicata in un batch o a una query in una stored procedure chiamata più volte.</span><span class="sxs-lookup"><span data-stu-id="cd103-187">This would apply to a query duplicated in a batch, or a query in a stored procedure that was called multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cd103-188">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="cd103-188">See Also</span></span>  
 [<span data-ttu-id="cd103-189">Funzionalità di SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="cd103-189">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
