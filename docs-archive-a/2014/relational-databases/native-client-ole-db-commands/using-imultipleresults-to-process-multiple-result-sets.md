---
title: Uso di IMultipleResults per elaborare più set di risultati | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- multiple rowsets
- rowsets [OLE DB], multiple
- IMultipleResults interface
- multiple-rowset results
ms.assetid: 754d3f30-7d94-4b67-8dac-baf2699ce9c6
author: rothja
ms.author: jroth
ms.openlocfilehash: c7acac7e6ce75189e522b503707e101c0a13c345
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87724564"
---
# <a name="using-imultipleresults-to-process-multiple-result-sets"></a><span data-ttu-id="e45d5-102">Utilizzo dell'interfaccia IMultipleResults per elaborare più set di risultati</span><span class="sxs-lookup"><span data-stu-id="e45d5-102">Using IMultipleResults to Process Multiple Result Sets</span></span>
  <span data-ttu-id="e45d5-103">I consumer utilizzano l'interfaccia **IMultipleResults** per elaborare i risultati restituiti da [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] native client OLE DB esecuzione del comando del provider.</span><span class="sxs-lookup"><span data-stu-id="e45d5-103">Consumers use the **IMultipleResults** interface to process results returned by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider command execution.</span></span> <span data-ttu-id="e45d5-104">Quando il [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provider di OLE DB di Native client invia un comando per l'esecuzione, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] esegue le istruzioni e restituisce tutti i risultati.</span><span class="sxs-lookup"><span data-stu-id="e45d5-104">When the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider submits a command for execution, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] executes the statements and returns any results.</span></span>  
  
 <span data-ttu-id="e45d5-105">Tutti i risultati ottenuti dall'esecuzione dei comandi devono essere elaborati da un client.</span><span class="sxs-lookup"><span data-stu-id="e45d5-105">A client must process all results from command execution.</span></span> <span data-ttu-id="e45d5-106">Poiché l' [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] esecuzione del comando del provider OLE DB di Native client può generare oggetti di più set di righe come risultati, utilizzare l'interfaccia **IMultipleResults** per garantire che il recupero dei dati dell'applicazione completi il round trip avviato dal client.</span><span class="sxs-lookup"><span data-stu-id="e45d5-106">Because the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider command execution can generate multiple-rowset objects as results, use the **IMultipleResults** interface to ensure that application data retrieval completes the client-initiated round trip.</span></span>  
  
 <span data-ttu-id="e45d5-107">L'istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] seguente genera più set di righe, alcuni dei quali contengono dati di riga della tabella **OrderDetails**, mentre altri contengono i risultati della clausola COMPUTE BY:</span><span class="sxs-lookup"><span data-stu-id="e45d5-107">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement generates multiple rowsets, some containing row data from the **OrderDetails** table and some containing results of the COMPUTE BY clause:</span></span>  
  
```  
SELECT OrderID, FullPrice = (UnitPrice * Quantity), Discount,  
    Discounted = UnitPrice * (1 - Discount) * Quantity  
FROM OrderDetails  
ORDER BY OrderID  
COMPUTE  
    SUM(UnitPrice * Quantity), SUM(UnitPrice * (1 - Discount) * Quantity)  
    BY OrderID  
```  
  
 <span data-ttu-id="e45d5-108">Se un consumer esegue un comando contenente questo testo e richiede un set di righe come interfaccia dei risultati restituiti, viene restituito solo il primo set di righe.</span><span class="sxs-lookup"><span data-stu-id="e45d5-108">If a consumer executes a command containing this text and requests a rowset as the returned results interface, only the first set of rows is returned.</span></span> <span data-ttu-id="e45d5-109">Il consumer può elaborare tutte le righe del set di righe restituito.</span><span class="sxs-lookup"><span data-stu-id="e45d5-109">The consumer may process all rows in the rowset returned.</span></span> <span data-ttu-id="e45d5-110">Tuttavia, se la proprietà DBPROP_MULTIPLECONNECTIONS origine dati è impostata su VARIANT_FALSE e MARS non è abilitato sulla connessione, non è possibile eseguire altri comandi sull'oggetto sessione (il [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provider di OLE DB Native client non creerà un'altra connessione) fino a quando il comando non viene annullato.</span><span class="sxs-lookup"><span data-stu-id="e45d5-110">But, if the DBPROP_MULTIPLECONNECTIONS data source property is set to VARIANT_FALSE, and MARS is not enabled on the connection, no other commands can be executed on the session object (the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider will not create another connection) until the command is canceled.</span></span> <span data-ttu-id="e45d5-111">Se MARS non è abilitato sulla connessione, il [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provider di OLE DB di Native Client restituisce un errore DB_E_OBJECTOPEN se DBPROP_MULTIPLECONNECTIONS è VARIANT_FALSE e restituisce E_FAIL se è presente una transazione attiva.</span><span class="sxs-lookup"><span data-stu-id="e45d5-111">If MARS is not enabled on the connection, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider returns a DB_E_OBJECTOPEN error if DBPROP_MULTIPLECONNECTIONS is VARIANT_FALSE and returns E_FAIL if there is an active transaction.</span></span>  
  
 <span data-ttu-id="e45d5-112">Il [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provider di OLE DB di Native Client restituirà anche DB_E_OBJECTOPEN quando si usano i parametri di output trasmessi e l'applicazione non ha utilizzato tutti i valori dei parametri di output restituiti prima di chiamare **IMultipleResults:: GetResults** per ottenere il set di risultati successivo.</span><span class="sxs-lookup"><span data-stu-id="e45d5-112">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider will also return DB_E_OBJECTOPEN when using streamed output parameters and the application has not consumed all the returned output parameter values before calling **IMultipleResults::GetResults** to get the next result set.</span></span> <span data-ttu-id="e45d5-113">Se MARS non è abilitato e la connessione è occupata eseguendo un comando che non produce un set di righe o che produce un set di righe che non è un cursore del server e la proprietà DBPROP_MULTIPLECONNECTIONS origine dati è impostata su VARIANT_TRUE, il [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provider OLE DB di Native client crea connessioni aggiuntive per supportare gli oggetti comando simultanei, a meno che non sia attiva una transazione, nel qual caso viene restituito un errore</span><span class="sxs-lookup"><span data-stu-id="e45d5-113">If MARS is not enabled and the connection is busy running a command that does not produce a rowset or that produces a rowset that is not a server cursor, and if the DBPROP_MULTIPLECONNECTIONS data source property is set to VARIANT_TRUE, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider creates additional connections to support concurrent command objects, unless a transaction is active, in which case it returns an error.</span></span> <span data-ttu-id="e45d5-114">Le transazioni e il blocco vengono gestiti da [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] per singola connessione.</span><span class="sxs-lookup"><span data-stu-id="e45d5-114">Transactions and locking are managed by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] on a per connection basis.</span></span> <span data-ttu-id="e45d5-115">Se viene generata una seconda connessione, il comando sulle connessioni separate non condivide i blocchi.</span><span class="sxs-lookup"><span data-stu-id="e45d5-115">If a second connection is generated, the command on the separate connections does not share locks.</span></span> <span data-ttu-id="e45d5-116">È necessario assicurarsi che un comando non blocchi un altro comando mantenendo attivi i blocchi sulle righe richieste da quest'ultimo.</span><span class="sxs-lookup"><span data-stu-id="e45d5-116">Care must be taken to ensure that one command does not block another by holding locks on rows requested by the other command.</span></span> <span data-ttu-id="e45d5-117">Se MARS è abilitato, è possibile disporre di più comandi attivi sulle connessioni e se vengono utilizzate transazioni esplicite tutti i comandi condividono una transazione comune.</span><span class="sxs-lookup"><span data-stu-id="e45d5-117">If MARS is enabled, multiple commands can be active on the connections and if explicit transactions are being used, the commands all share a common transaction.</span></span>  
  
 <span data-ttu-id="e45d5-118">Il consumer può annullare il comando usando [ISSAbort::Abort](../native-client-ole-db-interfaces/issabort-abort-ole-db.md) oppure rilasciando tutti i riferimenti mantenuti sull'oggetto comando e sul set di righe derivato.</span><span class="sxs-lookup"><span data-stu-id="e45d5-118">The consumer can cancel the command either by using [ISSAbort::Abort](../native-client-ole-db-interfaces/issabort-abort-ole-db.md) or by releasing all references held on the command object and the derived rowset.</span></span>  
  
 <span data-ttu-id="e45d5-119">Se **IMultipleResults** viene usato in tutte le istanze, il consumer può ottenere tutti i set di righe generati dall'esecuzione dei comandi e determinare in modo appropriato il momento in cui annullare l'esecuzione dei comandi e liberare un oggetto sessione per consentirne l'uso da parte di altri comandi.</span><span class="sxs-lookup"><span data-stu-id="e45d5-119">Using **IMultipleResults** in all instances allows the consumer to get all rowsets generated by command execution and allows consumers to appropriately determine when to cancel command execution and free a session object for use by other commands.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e45d5-120">Quando si utilizzano cursori [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], l'esecuzione di comandi crea il cursore.</span><span class="sxs-lookup"><span data-stu-id="e45d5-120">When you use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cursors, command execution creates the cursor.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="e45d5-121">restituisce l'esito positivo o negativo della creazione del cursore. Pertanto, il round trip all'istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] viene completato al momento della restituzione da parte dell'esecuzione di comandi.</span><span class="sxs-lookup"><span data-stu-id="e45d5-121">returns success or failure on the cursor creation; therefore, the round trip to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is complete upon the return from command execution.</span></span> <span data-ttu-id="e45d5-122">Ogni chiamata a **GetNextRows** diventa quindi un round trip.</span><span class="sxs-lookup"><span data-stu-id="e45d5-122">Each **GetNextRows** call then becomes a round trip.</span></span> <span data-ttu-id="e45d5-123">In questo modo, possono esistere più oggetti comando attivi, ognuno dei quali elabora un set di righe che rappresenta il risultato di un recupero dal cursore del server.</span><span class="sxs-lookup"><span data-stu-id="e45d5-123">In this way, multiple active command objects can exist, each processing a rowset that is the result of a fetch from the server cursor.</span></span> <span data-ttu-id="e45d5-124">Per altre informazioni, vedere [Set di righe e cursori SQL Server](../native-client-ole-db-rowsets/rowsets-and-sql-server-cursors.md).</span><span class="sxs-lookup"><span data-stu-id="e45d5-124">For more information, see [Rowsets and SQL Server Cursors](../native-client-ole-db-rowsets/rowsets-and-sql-server-cursors.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e45d5-125">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="e45d5-125">See Also</span></span>  
 [<span data-ttu-id="e45d5-126">Comandi</span><span class="sxs-lookup"><span data-stu-id="e45d5-126">Commands</span></span>](commands.md)  
  
  
