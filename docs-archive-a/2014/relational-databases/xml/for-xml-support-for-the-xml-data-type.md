---
title: Supporto del tipo di dati xml in FOR XML| Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- user-defined functions [SQL Server], XML
- xml data type [SQL Server], FOR XML clause
ms.assetid: 365de07d-694c-4c8b-b671-8825be27f87c
author: rothja
ms.author: jroth
ms.openlocfilehash: 16b03d5f10ded40bb284c409f772ee8986060515
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87726764"
---
# <a name="for-xml-support-for-the-xml-data-type"></a><span data-ttu-id="f89c9-102">Supporto del tipo di dati xml in FOR XML</span><span class="sxs-lookup"><span data-stu-id="f89c9-102">FOR XML Support for the xml Data Type</span></span>
  <span data-ttu-id="f89c9-103">Se nella clausola SELECT di una query FOR XML è specificata una colonna di tipo `xml`, viene eseguito il mapping dei valori della colonna come elementi nel codice XML risultante, indipendentemente dal fatto che sia stata specificata o meno la direttiva ELEMENTS.</span><span class="sxs-lookup"><span data-stu-id="f89c9-103">If a FOR XML query specifies a column of `xml` type in the SELECT clause, column values are mapped as elements in the returned XML, regardless of whether you specify the ELEMENTS directive.</span></span> <span data-ttu-id="f89c9-104">Le dichiarazioni XML nella colonna di tipo `xml` non sono serializzate.</span><span class="sxs-lookup"><span data-stu-id="f89c9-104">Any XML declaration in the `xml` type column is not serialized.</span></span>  
  
 <span data-ttu-id="f89c9-105">Ad esempio, la query seguente recupera le informazioni di contatto del cliente, ad esempio le `BusinessEntityID` `FirstName` colonne, e `LastName` , e i numeri `AdditionalContactInfo` di telefono della colonna di `xml` tipo.</span><span class="sxs-lookup"><span data-stu-id="f89c9-105">For example, the following query retrieves customer contact information such as the `BusinessEntityID`, `FirstName`, and `LastName` columns, and the telephone numbers from the `AdditionalContactInfo` column of `xml` type.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
SELECT BusinessEntityID, FirstName, LastName, AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
') AS PhoneNumber  
FROM Person.Person  
WHERE AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
')IS NOT NULL  
FOR XML AUTO, TYPE;  
```  
  
 <span data-ttu-id="f89c9-106">Nella query non è specificata la direttiva ELEMENTS e pertanto i valori di colonna vengono restituiti come attributi, ad eccezione delle informazioni aggiuntive sui contatti recuperate dalla colonna di tipo `xml`,</span><span class="sxs-lookup"><span data-stu-id="f89c9-106">Because the query does not specify the ELEMENTS directive, the column values are returned as attributes, except for the additional contact information values retrieved from the `xml` type column.</span></span> <span data-ttu-id="f89c9-107">che vengono restituite come elementi.</span><span class="sxs-lookup"><span data-stu-id="f89c9-107">These are returned as elements.</span></span>  
  
 <span data-ttu-id="f89c9-108">Risultato parziale:</span><span class="sxs-lookup"><span data-stu-id="f89c9-108">This is the partial result:</span></span>  
  
 `<Person.Person BusinessEntityID="291" FirstName="Gustavo" LastName="Achong">`  
  
 `<PhoneNumber>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1112</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1111</act:number>`  
  
 `</PhoneNumber>`  
  
 `</Person.Person>`  
  
 `<Person.Person BusinessEntityID="293" FirstName="Catherine" LastName="Abel">`  
  
 `<PhoneNumber>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-2222</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-1234</act:number>`  
  
 `</PhoneNumber>`  
  
```  
</Person.Person>  
...  
```  
  
 <span data-ttu-id="f89c9-109">Se si specifica un alias di colonna per la colonna XML generata da XQuery, tale alias consente di aggiungere un elemento wrapper intorno al codice XML generato da XQuery.</span><span class="sxs-lookup"><span data-stu-id="f89c9-109">If you specify a column alias for the XML column generated by the XQuery, that alias is used to add a wrapper element around the XML generated by the XQuery.</span></span> <span data-ttu-id="f89c9-110">Ad esempio, la query seguente specifica `MorePhoneNumbers` come alias di colonna:</span><span class="sxs-lookup"><span data-stu-id="f89c9-110">For example, the following query specifies `MorePhoneNumbers` as a column alias:</span></span>  
  
```  
SELECT BusinessEntityID, FirstName, LastName, AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
') AS PhoneNumber  
FROM Person.Person  
WHERE AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
')IS NOT NULL  
FOR XML AUTO, TYPE;  
```  
  
 <span data-ttu-id="f89c9-111">Il codice XML restituito da XQuery viene inserito nell'elemento <`MorePhoneNumbers`>, come illustrato nel risultato parziale seguente:</span><span class="sxs-lookup"><span data-stu-id="f89c9-111">The XML returned by the XQuery is wrapped in the <`MorePhoneNumbers`> element, as shown in the following partial result:</span></span>  
  
 `<Person.Person BusinessEntityID="291" FirstName="Gustavo" LastName="Achong">`  
  
 `<MorePhoneNumbers>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1112</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1111</act:number>`  
  
 `</MorePhoneNumbers>`  
  
 `</Person.Person>`  
  
 `<Person.Person BusinessEntityID="293" FirstName="Catherine" LastName="Abel">`  
  
 `<MorePhoneNumbers>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-2222</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-1234</act:number>`  
  
 `</MorePhoneNumbers>`  
  
```  
</Person.Person>  
...  
```  
  
 <span data-ttu-id="f89c9-112">Se si specifica la direttiva ELEMENTS nella query, BusinessEntityID, LastName e FirstName verranno restituiti come elementi nel codice XML risultante.</span><span class="sxs-lookup"><span data-stu-id="f89c9-112">If you specify the ELEMENTS directive in the query, the BusinessEntityID, LastName, and FirstName will be returned as elements in the resulting XML.</span></span>  
  
 <span data-ttu-id="f89c9-113">Nell'esempio seguente viene dimostrato che, in base alla logica di elaborazione di FOR XML, le dichiarazioni XML contenute nei dati XML di una colonna di tipo `xml` non vengono serializzate:</span><span class="sxs-lookup"><span data-stu-id="f89c9-113">The following example illustrates that the FOR XML processing logic does not serialize any XML declarations in the XML data from an `xml` type column:</span></span>  
  
```  
create table t(i int, x xml)  
go  
insert into t values(1, '<?xml version="1.0" encoding="UTF-8" ?>  
                             <Root SomeID="10" />')  
select i, x  
from   t  
for xml auto;  
```  
  
 <span data-ttu-id="f89c9-114">Di seguito è riportato il risultato.</span><span class="sxs-lookup"><span data-stu-id="f89c9-114">This is the result.</span></span> <span data-ttu-id="f89c9-115">Nel risultato la dichiarazione XML <`?xml version="1.0" encoding="UTF-8" ?`> non è serializzata.</span><span class="sxs-lookup"><span data-stu-id="f89c9-115">In the result, the XML declaration <`?xml version="1.0" encoding="UTF-8" ?`> is not serialized.</span></span>  
  
```  
<root>  
  <t i="1">  
    <x>  
      <Root SomeID="10" />  
    </x>  
  </t>  
</root>  
```  
  
## <a name="returning-xml-from-a-user-defined-function"></a><span data-ttu-id="f89c9-116">Restituzione di codice XML da una funzione definita dall'utente</span><span class="sxs-lookup"><span data-stu-id="f89c9-116">Returning XML from a User-defined Function</span></span>  
 <span data-ttu-id="f89c9-117">Le query FOR XML consentono di restituire codice XML da una funzione definita dall'utente che restituisce quanto segue:</span><span class="sxs-lookup"><span data-stu-id="f89c9-117">FOR XML queries can be used for returning XML from a user-defined function that returns either of the following:</span></span>  
  
-   <span data-ttu-id="f89c9-118">Una tabella con una singola colonna di tipo `xml`.</span><span class="sxs-lookup"><span data-stu-id="f89c9-118">A table with a single `xml` type column</span></span>  
  
-   <span data-ttu-id="f89c9-119">Un'istanza del tipo `xml`.</span><span class="sxs-lookup"><span data-stu-id="f89c9-119">An instance of the `xml` type</span></span>  
  
 <span data-ttu-id="f89c9-120">Ad esempio, la funzione definita dall'utente seguente restituisce una tabella con una singola colonna di tipo `xm`l:</span><span class="sxs-lookup"><span data-stu-id="f89c9-120">For example, the following user-defined function returns a table with a single column of `xm`l type:</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
CREATE FUNCTION dbo.MyUDF (@ProudctModelID int)  
RETURNS @T TABLE  
  (  
     ProductDescription xml  
  )  
AS  
BEGIN  
  INSERT @T  
     SELECT CatalogDescription.query('  
declare namespace PD="http://www.adventure-works.com/schemas/products/description";  
                    //PD:ProductDescription  ')  
     FROM Production.ProductModel  
     WHERE ProductModelID = @ProudctModelID  
  RETURN  
END;  
```  
  
 <span data-ttu-id="f89c9-121">È possibile eseguire la funzione definita dall'utente ed eseguire una query sulla tabella restituita dalla funzione.</span><span class="sxs-lookup"><span data-stu-id="f89c9-121">You can execute the user-defined function and query the table returned by it.</span></span> <span data-ttu-id="f89c9-122">In questo esempio, il codice XML restituito dalla query eseguita sulla tabella viene assegnato a una variabile di tipo `xml`.</span><span class="sxs-lookup"><span data-stu-id="f89c9-122">In this example, the XML returned by querying the table is assigned to an `xml` type variable.</span></span>  
  
```  
declare @x xml;  
set @x = (SELECT * FROM MyUDF(19));  
select @x;  
```  
  
 <span data-ttu-id="f89c9-123">Di seguito è riportato un altro esempio di una funzione definita dall'utente,</span><span class="sxs-lookup"><span data-stu-id="f89c9-123">This is another example of a user-defined function.</span></span> <span data-ttu-id="f89c9-124">che restituisce un'istanza del tipo `xml`.</span><span class="sxs-lookup"><span data-stu-id="f89c9-124">This user-defined function returns an instance of the `xml` type.</span></span> <span data-ttu-id="f89c9-125">Nell'esempio la funzione definita dall'utente restituisce un'istanza di tipo XML perché è specificato lo spazio dei nomi dello schema.</span><span class="sxs-lookup"><span data-stu-id="f89c9-125">In this example, the user-defined function returns a typed XML instance, because the schema namespace is specified.</span></span>  
  
```  
DROP FUNCTION dbo.MyUDF;  
GO  
CREATE FUNCTION MyUDF (@ProductModelID int)   
RETURNS xml ([Production].[ProductDescriptionSchemaCollection])  
AS  
BEGIN  
  declare @x xml  
  set @x =   ( SELECT CatalogDescription  
          FROM Production.ProductModel  
          WHERE ProductModelID = @ProductModelID )  
  return @x  
END;  
```  
  
 <span data-ttu-id="f89c9-126">Il codice XML restituito dalla funzione definita dall'utente può quindi essere assegnato a una variabile di tipo `xml`, come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="f89c9-126">The XML returned by the user-defined function can be assigned to an `xml` type variable as follows:</span></span>  
  
```  
declare @x xml;  
SELECT @x= dbo.MyUDF4 (19) ;  
select @x;  
```  
  
## <a name="see-also"></a><span data-ttu-id="f89c9-127">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="f89c9-127">See Also</span></span>  
 [<span data-ttu-id="f89c9-128">Supporto di FOR XML per vari tipi di dati di SQL Server</span><span class="sxs-lookup"><span data-stu-id="f89c9-128">FOR XML Support for Various SQL Server Data Types</span></span>](for-xml-support-for-various-sql-server-data-types.md)  
  
  
