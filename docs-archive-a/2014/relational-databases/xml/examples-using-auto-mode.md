---
title: 'Esempi: Utilizzo della modalità AUTO | Microsoft Docs'
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- AUTO FOR XML mode, examples
ms.assetid: 11e8d0e4-df8a-46f8-aa21-9602d4f26cad
author: rothja
ms.author: jroth
ms.openlocfilehash: b457bca6b7c25b9822e3dab2eba5f5cdb04b83e6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87623930"
---
# <a name="examples-using-auto-mode"></a><span data-ttu-id="cbf39-102">Esempi: Uso della modalità AUTO</span><span class="sxs-lookup"><span data-stu-id="cbf39-102">Examples: Using AUTO Mode</span></span>
  <span data-ttu-id="cbf39-103">Negli esempi seguenti viene illustrato l'utilizzo della modalità AUTO.</span><span class="sxs-lookup"><span data-stu-id="cbf39-103">The following examples illustrate the use of AUTO mode.</span></span> <span data-ttu-id="cbf39-104">Molte di queste query vengono eseguite sui documenti XML con istruzioni per la produzione di biciclette, archiviati nella colonna Instructions della tabella ProductModel del database di esempio [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="cbf39-104">Many of these queries are specified against bicycle manufacturing instructions XML documents that are stored in the Instructions column of the ProductModel table in the [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)] sample database.</span></span>  
  
## <a name="example-retrieving-customer-order-and-order-detail-information"></a><span data-ttu-id="cbf39-105">Esempio: Recupero di informazioni sul cliente, l'ordine e i dettagli dell'ordine</span><span class="sxs-lookup"><span data-stu-id="cbf39-105">Example: Retrieving customer, order, and order detail information</span></span>  
 <span data-ttu-id="cbf39-106">Questa query recupera informazioni sul cliente, sull'ordine e sui dettagli dell'ordine per un cliente specifico.</span><span class="sxs-lookup"><span data-stu-id="cbf39-106">This query retrieves customer, order, and order detail information for a specific customer.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
SELECT Cust.CustomerID,   
       OrderHeader.CustomerID,  
       OrderHeader.SalesOrderID,   
       Detail.SalesOrderID, Detail.LineTotal, Detail.ProductID,   
       Product.Name,  
       Detail.OrderQty  
FROM Sales.Customer AS Cust  
INNER JOIN Sales.SalesOrderHeader AS OrderHeader   
    ON Cust.CustomerID = OrderHeader.CustomerID  
INNER JOIN Sales.SalesOrderDetail AS Detail  
    ON OrderHeader.SalesOrderID = Detail.SalesOrderID  
INNER JOIN Production.Product AS Product  
    ON Product.ProductID = Detail.ProductID  
WHERE Cust.CustomerID IN (29672, 29734)  
ORDER BY OrderHeader.CustomerID,  
         OrderHeader.SalesOrderID  
FOR XML AUTO;  
```  
  
 <span data-ttu-id="cbf39-107">Poiché la query identifica gli alias di tabella `Cust`, `OrderHeader`, `Detail`e `Product` , la modalità `AUTO` genera gli elementi corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="cbf39-107">Because the query identifies, `Cust`, `OrderHeader`, `Detail`, and `Product` table aliases, corresponding elements are generated by the `AUTO` mode.</span></span> <span data-ttu-id="cbf39-108">Anche in questo caso, la gerarchia di tali elementi è determinata dall'ordine in cui le tabelle vengono identificate dalle colonne specificate nella clausola `SELECT` .</span><span class="sxs-lookup"><span data-stu-id="cbf39-108">Again, the order in which tables are identified by the columns specified in the `SELECT` clause determine the hierarchy of these elements.</span></span>  
  
 <span data-ttu-id="cbf39-109">Di seguito è riportato il risultato parziale.</span><span class="sxs-lookup"><span data-stu-id="cbf39-109">This is the partial result.</span></span>  
  
 `<Cust CustomerID="29672">`  
  
 `<OrderHeader CustomerID="29672" SalesOrderID="43660">`  
  
 `<Detail SalesOrderID="43660" LineTotal="874.794000" ProductID="758" OrderQty="1">`  
  
 `<Product Name="Road-450 Red, 52" />`  
  
 `</Detail>`  
  
 `<Detail SalesOrderID="43660" LineTotal="419.458900" ProductID="762" OrderQty="1">`  
  
 `<Product Name="Road-650 Red, 44" />`  
  
 `</Detail>`  
  
 `</OrderHeader>`  
  
 `<OrderHeader CustomerID="29672" SalesOrderID="47660">`  
  
 `<Detail SalesOrderID="47660" LineTotal="469.794000" ProductID="765" OrderQty="1">`  
  
 `<Product Name="Road-650 Black, 58" />`  
  
 `</Detail>`  
  
 `</OrderHeader>`  
  
 `<OrderHeader CustomerID="29672" SalesOrderID="49857">`  
  
 `<Detail SalesOrderID="49857" LineTotal="44.994000" ProductID="852" OrderQty="1">`  
  
 `<Product Name="Women's Tights, S" />`  
  
 `</Detail>`  
  
 `</OrderHeader>`  
  
 `...`  
  
 `</Cust>`  
  
## <a name="example-specifying-group-by-and-aggregate-functions"></a><span data-ttu-id="cbf39-110">Esempio: Specifica della clausola GROUP BY e di funzioni di aggregazione</span><span class="sxs-lookup"><span data-stu-id="cbf39-110">Example: Specifying GROUP BY and aggregate functions</span></span>  
 <span data-ttu-id="cbf39-111">La query seguente restituisce gli ID di singoli clienti e il numero degli ordini effettuati da tali clienti.</span><span class="sxs-lookup"><span data-stu-id="cbf39-111">The following query returns individual customer IDs and the number of orders that the customer has requested.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
SELECT C.CustomerID, COUNT(*) AS NoOfOrders  
FROM Sales.Customer AS C  
INNER JOIN Sales.SalesOrderHeader AS SOH  
On C.CustomerID = SOH.CustomerID  
GROUP BY C.CustomerID  
FOR XML AUTO;This is the partial result:  
```  
  
 `<I CustomerID="11000" NoOfOrders="3" />`  
  
 `<I CustomerID="11001" NoOfOrders="3" />`  
  
 `...`  
  
## <a name="example-specifying-computed-columns-in-auto-mode"></a><span data-ttu-id="cbf39-112">Esempio: Specifica di colonne calcolate in modalità AUTO</span><span class="sxs-lookup"><span data-stu-id="cbf39-112">Example: Specifying computed columns in AUTO mode</span></span>  
 <span data-ttu-id="cbf39-113">Questa query restituisce i nomi concatenati dei singoli clienti e le informazioni sugli ordini.</span><span class="sxs-lookup"><span data-stu-id="cbf39-113">This query returns concatenated individual customer names and the order information.</span></span> <span data-ttu-id="cbf39-114">Poiché la colonna calcolata viene assegnata al livello più interno rilevato fino a quel punto, che in questo esempio è l'elemento <`SOH`>,</span><span class="sxs-lookup"><span data-stu-id="cbf39-114">Because the computed column is assigned to the innermost level encountered at that point, the <`SOH`> element in this example.</span></span> <span data-ttu-id="cbf39-115">nel risultato i nomi concatenati dei clienti vengono aggiunti come attributi dell'elemento <`SOH`>.</span><span class="sxs-lookup"><span data-stu-id="cbf39-115">The concatenated customer names are added as attributes of the <`SOH`> element in the result.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
SELECT P.FirstName + ' ' + P.LastName AS Name,  
       SOH.SalesOrderID  
FROM Sales.Customer AS C  
INNER JOIN Sales.SalesOrderHeader AS SOH  
    ON  C.CustomerID = SOH.CustomerID  
INNER JOIN Person.Person AS P  
    ON P.BusinessEntityID = C.PersonID  
FOR XML AUTO;  
```  
  
 <span data-ttu-id="cbf39-116">Risultato parziale:</span><span class="sxs-lookup"><span data-stu-id="cbf39-116">This is the partial result:</span></span>  
  
```  
<SOH Name="Jon Yang" SalesOrderID="43793" />  
<SOH Name="Eugene Huang" SalesOrderID="43767" />  
```  
  
 <span data-ttu-id="cbf39-117">Per recuperare gli elementi <`IndividualCustomer`> che hanno come sottoelemento un attributo `Name` contenente le informazioni di intestazione di ogni ordine di vendita, la query viene riscritta utilizzando un'istruzione sub-SELECT.</span><span class="sxs-lookup"><span data-stu-id="cbf39-117">To retrieve the <`IndividualCustomer`> elements having the `Name` attribute that contains each sales order header information as a subelement, the query is rewritten using a sub select.</span></span> <span data-ttu-id="cbf39-118">L'istruzione SELECT interna crea una tabella `IndividualCustomer` temporanea con la colonna calcolata contenente i nomi dei singoli clienti.</span><span class="sxs-lookup"><span data-stu-id="cbf39-118">The inner select creates a temporary `IndividualCustomer` table with the computed column that contains the names of the individual customers.</span></span> <span data-ttu-id="cbf39-119">Tale tabella viene quindi unita in join alla tabella `SalesOrderHeader` per ottenere il risultato.</span><span class="sxs-lookup"><span data-stu-id="cbf39-119">This table is then joined to the `SalesOrderHeader` table to obtain the result.</span></span>  
  
 <span data-ttu-id="cbf39-120">Nella tabella `Sales.Customer` sono archiviate informazioni sui singoli clienti, incluso il valore `PersonID` di ogni cliente.</span><span class="sxs-lookup"><span data-stu-id="cbf39-120">Note that the `Sales.Customer` table stores individual customer information, including the `PersonID` value for that customer.</span></span> <span data-ttu-id="cbf39-121">Tale valore `PersonID` viene quindi utilizzato per recuperare il nome del contatto dalla tabella `Person.Person` .</span><span class="sxs-lookup"><span data-stu-id="cbf39-121">This `PersonID` is then used to find the contact name from the `Person.Person` table.</span></span>  
  
```  
SELECT IndividualCustomer.Name, SOH.SalesOrderID  
FROM (SELECT FirstName+ ' '+LastName AS Name, C.PersonID, C.CustomerID  
      FROM Sales.Customer AS C, Person.Person AS P  
      WHERE C.PersonID = P.BusinessEntityID) AS IndividualCustomer  
LEFT OUTER JOIN  Sales.SalesOrderHeader AS SOH  
   ON IndividualCustomer.CustomerID = SOH.CustomerID  
ORDER BY IndividualCustomer.CustomerID, SOH.CustomerIDFOR XML AUTO;  
```  
  
 <span data-ttu-id="cbf39-122">Risultato parziale:</span><span class="sxs-lookup"><span data-stu-id="cbf39-122">This is the partial result:</span></span>  
  
 `<IndividualCustomer Name="Jon Yang">`  
  
 `<SOH SalesOrderID="43793" />`  
  
 `<SOH SalesOrderID="51522" />`  
  
 `<SOH SalesOrderID="57418" />`  
  
 `</IndividualCustomer>`  
  
 `...`  
  
 `...`  
  
## <a name="example-returning-binary-data"></a><span data-ttu-id="cbf39-123">Esempio: Recupero di dati binari</span><span class="sxs-lookup"><span data-stu-id="cbf39-123">Example: Returning binary data</span></span>  
 <span data-ttu-id="cbf39-124">Questa query restituisce una foto del prodotto dalla tabella `ProductPhoto` .</span><span class="sxs-lookup"><span data-stu-id="cbf39-124">This query returns a product photo from the `ProductPhoto` table.</span></span> <span data-ttu-id="cbf39-125">`ThumbNailPhoto` è una colonna `varbinary(max)` nella tabella `ProductPhoto`.</span><span class="sxs-lookup"><span data-stu-id="cbf39-125">`ThumbNailPhoto` is an `varbinary(max)` column in the `ProductPhoto` table.</span></span> <span data-ttu-id="cbf39-126">Per impostazione predefinita, la modalità `AUTO` restituisce ai dati binari un riferimento costituito da un URL relativo alla radice virtuale del database in cui viene eseguita la query.</span><span class="sxs-lookup"><span data-stu-id="cbf39-126">By default, `AUTO` mode returns to the binary data a reference that is a relative URL to the virtual root of the database where the query is executed.</span></span> <span data-ttu-id="cbf39-127">Per identificare l'immagine, è necessario specificare l'attributo chiave `ProductPhotoID` .</span><span class="sxs-lookup"><span data-stu-id="cbf39-127">The `ProductPhotoID` key attribute must be specified to identify the image.</span></span> <span data-ttu-id="cbf39-128">Per recuperare un riferimento a un'immagine come illustrato nell'esempio seguente, è inoltre necessario specificare la chiave primaria della tabella nella clausola `SELECT` , per identificare una riga in modo univoco.</span><span class="sxs-lookup"><span data-stu-id="cbf39-128">In retrieving an image reference as illustrated in this example, the primary key of the table must also be specified in the `SELECT` clause to uniquely identify a row.</span></span>  
  
```  
SELECT ProductPhotoID, ThumbNailPhoto  
FROM   Production.ProductPhoto   
WHERE ProductPhotoID=70  
FOR XML AUTO;  
```  
  
 <span data-ttu-id="cbf39-129">Risultato:</span><span class="sxs-lookup"><span data-stu-id="cbf39-129">This is the result:</span></span>  
  
 `-- result`  
  
 `<Production.ProductPhoto`  
  
 `ProductPhotoID="70"`  
  
 `ThumbNailPhoto= "dbobject/Production.ProductPhoto[@ProductPhotoID='70']/@ThumbNailPhoto" />`  
  
 <span data-ttu-id="cbf39-130">Se si esegue la stessa query specificando l'opzione `BINARY BASE64` ,</span><span class="sxs-lookup"><span data-stu-id="cbf39-130">The same query is executed with the `BINARY BASE64` option.</span></span> <span data-ttu-id="cbf39-131">i dati binari verranno restituiti in formato con codifica Base64.</span><span class="sxs-lookup"><span data-stu-id="cbf39-131">The query returns the binary data in base64-encoded format.</span></span>  
  
```  
SELECT ProductPhotoID, ThumbNailPhoto  
FROM   Production.ProductPhoto   
WHERE ProductPhotoID=70  
FOR XML AUTO, BINARY BASE64;  
```  
  
 <span data-ttu-id="cbf39-132">Risultato:</span><span class="sxs-lookup"><span data-stu-id="cbf39-132">This is the result:</span></span>  
  
 `-- result`  
  
 `<Production.ProductPhoto ProductPhotoID="70" ThumbNailPhoto="Base64 encoded photo" />`  
  
 <span data-ttu-id="cbf39-133">Per impostazione predefinita, quando si utilizza la modalità AUTO per recuperare dati binari, al posto dei dati binari viene restituito un riferimento a un URL relativo alla radice virtuale del database in cui è stata eseguita la query.</span><span class="sxs-lookup"><span data-stu-id="cbf39-133">By default, when you use AUTO mode to retrieve binary data, a reference to a relative URL to the virtual root of the database where the query was executed will be returned instead of the binary data.</span></span> <span data-ttu-id="cbf39-134">Questa situazione si presenta se non è specificata l'opzione BINARY BASE64.</span><span class="sxs-lookup"><span data-stu-id="cbf39-134">This will occur if the BINARY BASE64 option is not specified.</span></span>  
  
 <span data-ttu-id="cbf39-135">Quando la modalità AUTO restituisce un riferimento URL a dati binari in database senza distinzione tra maiuscole e minuscole, in cui un nome di tabella o colonna specificato nella query non corrisponde al nome della tabella o della colonna nel database, la query viene eseguita,</span><span class="sxs-lookup"><span data-stu-id="cbf39-135">When AUTO mode returns a URL reference to the binary data in case-insensitive databases where a table or column name specified in the query does not match the table or column name in the database, the query executes.</span></span> <span data-ttu-id="cbf39-136">ma la combinazione di maiuscole e minuscole nel riferimento non sarà consistente.</span><span class="sxs-lookup"><span data-stu-id="cbf39-136">However, the case returned in the reference will not be consistent.</span></span> <span data-ttu-id="cbf39-137">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="cbf39-137">For example:</span></span>  
  
```  
SELECT ProductPhotoID, ThumbnailPhoto  
FROM   Production.ProductPhoto   
WHERE  ProductPhotoID=70  
FOR XML AUTO;  
```  
  
 <span data-ttu-id="cbf39-138">Risultato:</span><span class="sxs-lookup"><span data-stu-id="cbf39-138">This is the result:</span></span>  
  
 `<Production.PRODUCTPHOTO`  
  
 `PRODUCTPHOTOID="70"`  
  
 `THUMBNAILPHOTO= "dbobject/Production.PRODUCTPHOTO[@ProductPhotoID='70']/@ThumbNailPhoto" />`  
  
 <span data-ttu-id="cbf39-139">Questo costituisce un problema soprattutto quando si eseguono query dbobject su un database con distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="cbf39-139">This can be a problem particularly when dbobject queries are executed against a case sensitive database.</span></span> <span data-ttu-id="cbf39-140">Per evitarlo, è necessario che la combinazione di maiuscole e minuscole nel nome di tabella o colonna specificato nelle query corrisponda a quella del nome della tabella o colonna nel database.</span><span class="sxs-lookup"><span data-stu-id="cbf39-140">To avoid this, the case of the table or column name that is specified in the queries should match the case of the table or column name in the database.</span></span>  
  
## <a name="example-understanding-the-encoding"></a><span data-ttu-id="cbf39-141">Esempio: Informazioni sulla codifica</span><span class="sxs-lookup"><span data-stu-id="cbf39-141">Example: Understanding the encoding</span></span>  
 <span data-ttu-id="cbf39-142">In questo esempio vengono illustrate le varie operazioni di codifica eseguite sul risultato.</span><span class="sxs-lookup"><span data-stu-id="cbf39-142">This example shows the various encoding that occurs in the result.</span></span>  
  
 <span data-ttu-id="cbf39-143">Creare la tabella seguente:</span><span class="sxs-lookup"><span data-stu-id="cbf39-143">Create this table:</span></span>  
  
```  
CREATE TABLE [Special Chars] (Col1 char(1) primary key, [Col#&2] varbinary(50));  
```  
  
 <span data-ttu-id="cbf39-144">Aggiungere i dati seguenti alla tabella:</span><span class="sxs-lookup"><span data-stu-id="cbf39-144">Add the following data to the table:</span></span>  
  
```  
INSERT INTO [Special Chars] VALUES ('&', 0x20), ('#', 0x20);  
```  
  
 <span data-ttu-id="cbf39-145">La query restituisce i dati dalla tabella.</span><span class="sxs-lookup"><span data-stu-id="cbf39-145">This query returns the data from the table.</span></span> <span data-ttu-id="cbf39-146">È specificata la modalità AUTO della clausola FOR XML.</span><span class="sxs-lookup"><span data-stu-id="cbf39-146">The FOR XML AUTO mode is specified.</span></span> <span data-ttu-id="cbf39-147">I dati binari vengono restituiti come riferimento.</span><span class="sxs-lookup"><span data-stu-id="cbf39-147">Binary data is returned as a reference.</span></span>  
  
```  
SELECT * FROM [Special Chars] FOR XML AUTO;  
```  
  
 <span data-ttu-id="cbf39-148">Risultato:</span><span class="sxs-lookup"><span data-stu-id="cbf39-148">This is the result:</span></span>  
  
 `<Special_x0020_Chars`  
  
 `Col1="#"`  
  
 `Col_x0023__x0026_2="dbobject/Special_x0020_Chars[@Col1='#']/@Col_x0023__x0026_2"`  
  
 `/>`  
  
 `<Special_x0020_Chars`  
  
 `Col1="&"`  
  
 `Col_x0023__x0026_2="dbobject/Special_x0020_Chars[@Col1='&']/@Col_x0023__x0026_2"`  
  
 `/>`  
  
 <span data-ttu-id="cbf39-149">Di seguito viene descritto il processo di codifica dei caratteri speciali nel risultato:</span><span class="sxs-lookup"><span data-stu-id="cbf39-149">This is the process for encoding special characters in the result:</span></span>  
  
-   <span data-ttu-id="cbf39-150">I caratteri speciali XML e URL inclusi nei nomi degli elementi e degli attributi restituiti nel risultato della query vengono codificati utilizzando il valore esadecimale del carattere Unicode corrispondente.</span><span class="sxs-lookup"><span data-stu-id="cbf39-150">In the query result, the special XML and URL characters in the element and attribute names that are returned are encoded by using the hexadecimal value of the corresponding Unicode character.</span></span> <span data-ttu-id="cbf39-151">Nell'esempio precedente il nome di elemento <`Special Chars`> viene restituito come <`Special_x0020_Chars`>.</span><span class="sxs-lookup"><span data-stu-id="cbf39-151">In the previous result, the element name <`Special Chars`> is returned as <`Special_x0020_Chars`>.</span></span> <span data-ttu-id="cbf39-152">Il nome di attributo <`Col#&2`> viene restituito come <`Col_x0023__x0026_2`>.</span><span class="sxs-lookup"><span data-stu-id="cbf39-152">The attribute name <`Col#&2`> is returned as <`Col_x0023__x0026_2`>.</span></span> <span data-ttu-id="cbf39-153">Vengono codificati sia i caratteri XML speciali che i caratteri URL speciali.</span><span class="sxs-lookup"><span data-stu-id="cbf39-153">Both XML and URL special characters are encoded.</span></span>  
  
-   <span data-ttu-id="cbf39-154">Se i valori degli elementi o degli attributi includono una delle cinque entità carattere XML standard (', "", \<, > e &), tali caratteri XML speciali verranno sempre codificati tramite la codifica dei caratteri XML.</span><span class="sxs-lookup"><span data-stu-id="cbf39-154">If the values of the elements or attribute contain any of the five standard XML character entities (', "", \<, >, and &), these special XML characters are always encoded using XML character encoding.</span></span> <span data-ttu-id="cbf39-155">Nel risultato precedente il valore `&` nel valore dell'attributo <`Col1`> viene codificato come `&`.</span><span class="sxs-lookup"><span data-stu-id="cbf39-155">In the previous result, the value `&` in the value of attribute <`Col1`> is encoded as `&`.</span></span> <span data-ttu-id="cbf39-156">Il carattere #, tuttavia, rimane invariato perché è un carattere XML valido e non un carattere XML speciale.</span><span class="sxs-lookup"><span data-stu-id="cbf39-156">However, the # character remains #, because it is a valid XML character and not a special XML character.</span></span>  
  
-   <span data-ttu-id="cbf39-157">Se i valori degli elementi o degli attributi contengono eventuali caratteri URL speciali che hanno un significato particolare negli URL, tali caratteri verranno codificati solo nel valore URL DBOBJECT e unicamente se il carattere speciale fa parte del nome di una tabella o di una colonna.</span><span class="sxs-lookup"><span data-stu-id="cbf39-157">If the values of the elements or attributes contain any special URL characters that have special meaning in the URL, they are encoded only in the DBOBJECT URL value and are encoded only when the special character is part of a table or column name.</span></span> <span data-ttu-id="cbf39-158">Nel risultato carattere `#` , che fa parte del nome di tabella `Col#&2` , viene codificato come `_x0023_ in the DBOJBECT URL`.</span><span class="sxs-lookup"><span data-stu-id="cbf39-158">In the result, the character `#` that is part of table name `Col#&2` is encoded as `_x0023_ in the DBOJBECT URL`.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cbf39-159">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="cbf39-159">See Also</span></span>  
 [<span data-ttu-id="cbf39-160">Usare la modalità AUTO con FOR XML</span><span class="sxs-lookup"><span data-stu-id="cbf39-160">Use AUTO Mode with FOR XML</span></span>](use-auto-mode-with-for-xml.md)  
  
  
