---
title: FOR XML (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- FOR XML clause, about FOR XML clause
- PATH FOR XML mode, construction
- EXPLICIT FOR XML mode
- RAW FOR XML mode
- retrieving XML data
- XML [SQL Server], FOR XML clause
- AUTO FOR XML mode
- XML [SQL Server], construction
ms.assetid: 2b6b5c61-c5bd-49d2-8c0c-b7cf15857906
author: rothja
ms.author: jroth
ms.openlocfilehash: 6fe55186e89020f57ae1eb078625d1cdce262864
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87726779"
---
# <a name="for-xml-sql-server"></a><span data-ttu-id="5f38c-102">FOR XML (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="5f38c-102">FOR XML (SQL Server)</span></span>
  <span data-ttu-id="5f38c-103">Una query SELECT restituisce i risultati sotto forma di set di righe.</span><span class="sxs-lookup"><span data-stu-id="5f38c-103">A SELECT query returns results as a rowset.</span></span> <span data-ttu-id="5f38c-104">È possibile recuperare facoltativamente i risultati di una query SQL come codice XML specificando la clausola FOR XML nella query.</span><span class="sxs-lookup"><span data-stu-id="5f38c-104">You can optionally retrieve formal results of a SQL query as XML by specifying the FOR XML clause in the query.</span></span> <span data-ttu-id="5f38c-105">È possibile utilizzare la clausola FOR XML nelle query di livello principale e nelle sottoquery.</span><span class="sxs-lookup"><span data-stu-id="5f38c-105">The FOR XML clause can be used in top-level queries and in sub queries.</span></span> <span data-ttu-id="5f38c-106">La clausola FOR XML di livello principale può essere utilizzata solo nell'istruzione SELECT.</span><span class="sxs-lookup"><span data-stu-id="5f38c-106">The top-level FOR XML clause can be used only in the SELECT statement.</span></span> <span data-ttu-id="5f38c-107">Nelle sottoquery, è possibile utilizzare FOR XML nelle istruzioni INSERT, UPDATE e DELETE.</span><span class="sxs-lookup"><span data-stu-id="5f38c-107">In sub queries, FOR XML can be used in the INSERT, UPDATE, and DELETE statements.</span></span> <span data-ttu-id="5f38c-108">La clausola può inoltre essere utilizzata nelle istruzioni di assegnazione.</span><span class="sxs-lookup"><span data-stu-id="5f38c-108">It can also be used in assignment statements.</span></span>  
  
 <span data-ttu-id="5f38c-109">In una clausola FOR XML, è necessario specificare una delle modalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="5f38c-109">In a FOR XML clause, you specify one of these modes:</span></span>  
  
-   <span data-ttu-id="5f38c-110">RAW</span><span class="sxs-lookup"><span data-stu-id="5f38c-110">RAW</span></span>  
  
-   <span data-ttu-id="5f38c-111">AUTO</span><span class="sxs-lookup"><span data-stu-id="5f38c-111">AUTO</span></span>  
  
-   <span data-ttu-id="5f38c-112">EXPLICIT</span><span class="sxs-lookup"><span data-stu-id="5f38c-112">EXPLICIT</span></span>  
  
-   <span data-ttu-id="5f38c-113">PATH</span><span class="sxs-lookup"><span data-stu-id="5f38c-113">PATH</span></span>  
  
 <span data-ttu-id="5f38c-114">Nella modalità RAW viene generato un singolo elemento \<row> per ogni riga del set di righe restituito dall'istruzione SELECT.</span><span class="sxs-lookup"><span data-stu-id="5f38c-114">The RAW mode generates a single \<row> element per row in the rowset that is returned by the SELECT statement.</span></span> <span data-ttu-id="5f38c-115">È possibile generare la gerarchia XML tramite la formulazione di query FOR XML nidificate.</span><span class="sxs-lookup"><span data-stu-id="5f38c-115">You can generate XML hierarchy by writing nested FOR XML queries.</span></span>  
  
 <span data-ttu-id="5f38c-116">Nella modalità AUTO, il codice XML risultante è nidificato tramite l'approccio euristico determinato dalla modalità con cui viene specificata l'istruzione SELECT.</span><span class="sxs-lookup"><span data-stu-id="5f38c-116">The AUTO mode generates nesting in the resulting XML by using heuristics based on the way the SELECT statement is specified.</span></span> <span data-ttu-id="5f38c-117">Il controllo sulla forma del codice XML generato è minimo.</span><span class="sxs-lookup"><span data-stu-id="5f38c-117">You have minimal control over the shape of the XML generated.</span></span> <span data-ttu-id="5f38c-118">È possibile formulare query FOR XML nidificate che generano una gerarchia XML che esula dalla forma XML generata dall'approccio euristico della modalità AUTO.</span><span class="sxs-lookup"><span data-stu-id="5f38c-118">The nested FOR XML queries can be written to generate XML hierarchy beyond the XML shape that is generated by AUTO mode heuristics.</span></span>  
  
 <span data-ttu-id="5f38c-119">La modalità EXPLICIT consente un maggiore controllo sulla forma del codice XML,</span><span class="sxs-lookup"><span data-stu-id="5f38c-119">The EXPLICIT mode allows more control over the shape of the XML.</span></span> <span data-ttu-id="5f38c-120">grazie alla possibilità di combinare gli attributi e gli elementi che definiscono tale forma.</span><span class="sxs-lookup"><span data-stu-id="5f38c-120">You can mix attributes and elements at will in deciding the shape of the XML.</span></span> <span data-ttu-id="5f38c-121">È richiesto un formato specifico per il set di righe generato in seguito all'esecuzione della query,</span><span class="sxs-lookup"><span data-stu-id="5f38c-121">It requires a specific format for the resulting rowset that is generated because of query execution.</span></span> <span data-ttu-id="5f38c-122">del quale viene quindi eseguito il mapping alla forma del codice XML.</span><span class="sxs-lookup"><span data-stu-id="5f38c-122">This rowset format is then mapped into XML shape.</span></span> <span data-ttu-id="5f38c-123">La modalità EXPLICIT consente di combinare elementi e attributi, di creare wrapper e proprietà complesse nidificate, di creare valori separati da spazi (ad esempio, l'attributo OrderID può includere un elenco di ID di ordine) e contenuti misti.</span><span class="sxs-lookup"><span data-stu-id="5f38c-123">The power of EXPLICIT mode is to mix attributes and elements at will, create wrappers and nested complex properties, create space-separated values (for example, OrderID attribute may have a list of order ID values), and mixed contents.</span></span>  
  
 <span data-ttu-id="5f38c-124">La formulazione di query nella modalità EXPLICIT può tuttavia essere complessa.</span><span class="sxs-lookup"><span data-stu-id="5f38c-124">However, writing EXPLICIT mode queries can be cumbersome.</span></span> <span data-ttu-id="5f38c-125">Per generare le gerarchie, anziché utilizzare la modalità EXPLICIT è possibile utilizzare le nuove funzionalità di FOR XML, ad esempio la formulazione di query FOR XML nidificate in modalità RAW/AUTO/PATH e la direttiva TYPE.</span><span class="sxs-lookup"><span data-stu-id="5f38c-125">You can use some of the new FOR XML capabilities, such as writing nested FOR XML RAW/AUTO/PATH mode queries and the TYPE directive, instead of using EXPLICIT mode to generate the hierarchies.</span></span> <span data-ttu-id="5f38c-126">Le query FOR XML nidificate consentono di generare qualsiasi codice XML generabile tramite la modalità EXPLICIT.</span><span class="sxs-lookup"><span data-stu-id="5f38c-126">The nested FOR XML queries can produce any XML that you can generate by using the EXPLICIT mode.</span></span> <span data-ttu-id="5f38c-127">Per altre informazioni, vedere [Utilizzo di query FOR XML nidificate](use-nested-for-xml-queries.md) e [Direttiva TYPE nelle query FOR XML](type-directive-in-for-xml-queries.md).</span><span class="sxs-lookup"><span data-stu-id="5f38c-127">For more information, see [Use Nested FOR XML Queries](use-nested-for-xml-queries.md) and [TYPE Directive in FOR XML Queries](type-directive-in-for-xml-queries.md).</span></span>  
  
 <span data-ttu-id="5f38c-128">L'utilizzo congiunto della modalità PATH e delle funzionalità per le query FOR XML nidificate consente di ottenere lo stesso livello di versatilità della modalità EXPLICIT, ma in un modo più semplice.</span><span class="sxs-lookup"><span data-stu-id="5f38c-128">The PATH mode together with the nested FOR XML query capability provides the flexibility of the EXPLICIT mode in a simpler manner.</span></span>  
  
 <span data-ttu-id="5f38c-129">Queste modalità sono valide solo per l'esecuzione della query per la quale sono state impostate</span><span class="sxs-lookup"><span data-stu-id="5f38c-129">These modes are in effect only for the execution of the query for which they are set.</span></span> <span data-ttu-id="5f38c-130">e non influiscono sui risultati di eventuali query successive.</span><span class="sxs-lookup"><span data-stu-id="5f38c-130">They do not affect the results of any subsequent queries.</span></span>  
  
 <span data-ttu-id="5f38c-131">FOR XML non è valida per qualsiasi selezione utilizzata con una clausola FOR BROWSE.</span><span class="sxs-lookup"><span data-stu-id="5f38c-131">FOR XML is not valid for any selection that is used with a FOR BROWSE clause.</span></span>  
  
## <a name="example"></a><span data-ttu-id="5f38c-132">Esempio</span><span class="sxs-lookup"><span data-stu-id="5f38c-132">Example</span></span>  
 <span data-ttu-id="5f38c-133">L'istruzione `SELECT` seguente recupera informazioni dalle tabelle `Sales.Customer` e `Sales.SalesOrderHeader` del database `AdventureWorks2012` .</span><span class="sxs-lookup"><span data-stu-id="5f38c-133">The following `SELECT` statement retrieves information from the `Sales.Customer` and `Sales.SalesOrderHeader` tables in the `AdventureWorks2012` database.</span></span> <span data-ttu-id="5f38c-134">La query seguente specifica la modalità `AUTO` nella clausola `FOR XML` :</span><span class="sxs-lookup"><span data-stu-id="5f38c-134">This query specifies the `AUTO` mode in the `FOR XML` clause:</span></span>  
  
```  
USE AdventureWorks2012  
GO  
SELECT Cust.CustomerID,   
       OrderHeader.CustomerID,  
       OrderHeader.SalesOrderID,   
       OrderHeader.Status  
FROM Sales.Customer Cust   
INNER JOIN Sales.SalesOrderHeader OrderHeader  
ON Cust.CustomerID = OrderHeader.CustomerID  
FOR XML AUTO  
```  
  
## <a name="the-for-xml-clause-and-server-names"></a><span data-ttu-id="5f38c-135">Clausola FOR XML e nomi di server</span><span class="sxs-lookup"><span data-stu-id="5f38c-135">The FOR XML Clause and Server Names</span></span>  
 <span data-ttu-id="5f38c-136">Se un'istruzione SELECT con una clausola FOR XML specifica un nome in quattro parti nella query, il nome del server non viene restituito nel documento XML risultante quando la query viene eseguita nel computer locale.</span><span class="sxs-lookup"><span data-stu-id="5f38c-136">When a SELECT statement with a FOR XML clause specifies a four-part name in the query, the server name is not returned in the resulting XML document when the query is executed on the local computer.</span></span> <span data-ttu-id="5f38c-137">Viene tuttavia restituito come nome in quattro parti se la query viene eseguita in un server di rete.</span><span class="sxs-lookup"><span data-stu-id="5f38c-137">However, the server name is returned as the four-part name when the query is executed on a network server.</span></span>  
  
 <span data-ttu-id="5f38c-138">Ad esempio, si consideri la query seguente:</span><span class="sxs-lookup"><span data-stu-id="5f38c-138">For example, consider this query:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person  
FOR XML AUTO  
```  
  
 <span data-ttu-id="5f38c-139">Se `ServerName` è un server locale, il risultato restituito dalla query è il seguente:</span><span class="sxs-lookup"><span data-stu-id="5f38c-139">When `ServerName` is a local server, the query returns the following:</span></span>  
  
```  
<AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="5f38c-140">Se `ServerName` è un server di rete, il risultato restituito dalla query è il seguente:</span><span class="sxs-lookup"><span data-stu-id="5f38c-140">When `ServerName` is a network server, the query returns the following:</span></span>  
  
```  
<ServerName.AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="5f38c-141">È possibile evitare questa ambiguità specificando l'alias seguente:</span><span class="sxs-lookup"><span data-stu-id="5f38c-141">This potential ambiguity can be avoided by specifying this alias:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person x  
FOR XML AUTO   
```  
  
 <span data-ttu-id="5f38c-142">Di seguito è riportato il risultato della query:</span><span class="sxs-lookup"><span data-stu-id="5f38c-142">This query returns the following:</span></span>  
  
```  
<x LastName="Achong"/>  
```  
  
## <a name="see-also"></a><span data-ttu-id="5f38c-143">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="5f38c-143">See Also</span></span>  
 <span data-ttu-id="5f38c-144">[Sintassi di base della clausola FOR XML](basic-syntax-of-the-for-xml-clause.md) </span><span class="sxs-lookup"><span data-stu-id="5f38c-144">[Basic Syntax of the FOR XML Clause](basic-syntax-of-the-for-xml-clause.md) </span></span>  
 <span data-ttu-id="5f38c-145">[Utilizzo della modalità RAW con FOR XML](use-raw-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="5f38c-145">[Use RAW Mode with FOR XML](use-raw-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="5f38c-146">[Utilizzo della modalità AUTO con FOR XML](use-auto-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="5f38c-146">[Use AUTO Mode with FOR XML](use-auto-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="5f38c-147">[Utilizzo della modalità EXPLICIT con FOR XML](use-explicit-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="5f38c-147">[Use EXPLICIT Mode with FOR XML](use-explicit-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="5f38c-148">[Utilizzare la modalità PATH con FOR XML](use-path-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="5f38c-148">[Use PATH Mode with FOR XML](use-path-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="5f38c-149">[OPENXML &#40;SQL Server&#41;](openxml-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="5f38c-149">[OPENXML &#40;SQL Server&#41;](openxml-sql-server.md) </span></span>  
 [<span data-ttu-id="5f38c-150">Aggiungere spazi dei nomi alle query con WITH XMLNAMESPACES</span><span class="sxs-lookup"><span data-stu-id="5f38c-150">Add Namespaces to Queries with WITH XMLNAMESPACES</span></span>](add-namespaces-to-queries-with-with-xmlnamespaces.md)  
  
  
