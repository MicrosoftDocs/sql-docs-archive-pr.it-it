---
title: Possibili errori relativi ai supporti durante il backup e il ripristino (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- media errors [SQL Server]
- CONTINUE_AFTER_ERROR option
- errors [SQL Server], backups
- backups [SQL Server], errors
- RESTORE VERIFYONLY statement
- backup media [SQL Server], error management
- page checksums [SQL Server]
- backup checksums [SQL Server]
- backing up [SQL Server], media errors
- RESTORE statement, media errors
- NO_CHECKSUM option
- checksums [SQL Server]
ms.assetid: 83a27b29-1191-4f8d-9648-6e6be73a9b7c
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 15691c513aad6027be1063ef566ebdf245ebcc8c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87721524"
---
# <a name="possible-media-errors-during-backup-and-restore-sql-server"></a><span data-ttu-id="093cd-102">Possibili errori relativi ai supporti durante il backup e il ripristino (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="093cd-102">Possible Media Errors During Backup and Restore (SQL Server)</span></span>
  [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] <span data-ttu-id="093cd-103">includono un'opzione che permette di recuperare un database anche in presenza di errori.</span><span class="sxs-lookup"><span data-stu-id="093cd-103">gives you the option of recovering a database despite detected errors.</span></span> <span data-ttu-id="093cd-104">Un importante e nuovo meccanismo di rilevazione degli errori prevede l'utilizzo facoltativo di un checksum del backup, creato durante un'operazione di backup e convalidato durante un'operazione di ripristino.</span><span class="sxs-lookup"><span data-stu-id="093cd-104">An important new error-detection mechanism is the optional creation of a backup checksum that can be created by a backup operation and validated by a restore operation.</span></span> <span data-ttu-id="093cd-105">È quindi possibile controllare se un'operazione verifica la presenza di errori e se ne deve essere o meno arrestata l'esecuzione quando viene rilevato un errore.</span><span class="sxs-lookup"><span data-stu-id="093cd-105">You can control whether an operation checks for errors and whether the operation stops or continues on encountering an error.</span></span> <span data-ttu-id="093cd-106">Se un backup contiene un checksum, le istruzioni RESTORE e RESTORE VERIFYONLY verificano la presenza di errori.</span><span class="sxs-lookup"><span data-stu-id="093cd-106">If a backup contains a backup checksum, RESTORE and RESTORE VERIFYONLY statements can check for errors.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="093cd-107">I backup con mirroring consentono di disporre di un massimo di quattro copie (mirror) di set di supporti, offrendo copie alternative per il recupero in caso di errori che dipendono da supporti danneggiati.</span><span class="sxs-lookup"><span data-stu-id="093cd-107">Mirrored backups provide up to four copies (mirrors) of a media set, providing alternative copies for recovering from errors caused by damaged media.</span></span> <span data-ttu-id="093cd-108">Per altre informazioni, vedere [Set di supporti di backup con mirroring &#40;SQL Server&#41;](mirrored-backup-media-sets-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="093cd-108">For more information, see [Mirrored Backup Media Sets &#40;SQL Server&#41;](mirrored-backup-media-sets-sql-server.md).</span></span>  
  
  
  
##  <a name="backup-checksums"></a><a name="BckChecksums"></a> <span data-ttu-id="093cd-109">Checksum di backup</span><span class="sxs-lookup"><span data-stu-id="093cd-109">Backup Checksums</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="093cd-110">sono supportati tre tipi di checksum: della pagine, dei blocchi dei log e del backup.</span><span class="sxs-lookup"><span data-stu-id="093cd-110">supports three types of checksums: a checksum on pages, a checksum in log blocks, and a backup checksum.</span></span> <span data-ttu-id="093cd-111">Durante la generazione di un checksum del backup, l'istruzione BACKUP verifica che i dati letti dal database siano consistenti con l'eventuale indicazione di checksum o di pagina incompleta presente nel database.</span><span class="sxs-lookup"><span data-stu-id="093cd-111">When generating a backup checksum, BACKUP verifies that the data read from the database is consistent with any checksum or torn-page indication that is present in the database.</span></span>  
  
 <span data-ttu-id="093cd-112">L'istruzione BACKUP consente di eseguire il calcolo facoltativo di un checksum del backup nel flusso del backup stesso. Se in una pagina specifica sono presenti informazioni relative al checksum della pagina o a una pagina incompleta, durante il backup della pagina verrà inoltre verificato lo stato del checksum e della pagina incompleta, nonché l'ID della pagina.</span><span class="sxs-lookup"><span data-stu-id="093cd-112">The BACKUP statement optionally computes a backup checksum on the backup stream; if page-checksum or torn-page information is present on a given page, when backing up the page, BACKUP also verifies the checksum and torn-page status and the page ID, of the page.</span></span> <span data-ttu-id="093cd-113">Non verranno aggiunti checksum alle pagine durante la creazione di un checksum del backup.</span><span class="sxs-lookup"><span data-stu-id="093cd-113">When creating a backup checksum, a backup operation does not add any checksums to pages.</span></span> <span data-ttu-id="093cd-114">Il backup delle pagine viene eseguito solo se queste esistono nel database e non implica la modifica delle pagine stesse.</span><span class="sxs-lookup"><span data-stu-id="093cd-114">Pages are backed up as they exist in the database, and the pages are unmodified by backup.</span></span>  
  
 <span data-ttu-id="093cd-115">Le procedure di verifica e creazione dei checksum del backup comportano un certo overhead, pertanto l'utilizzo di questo tipo di checksum può influire negativamente sulle prestazioni,</span><span class="sxs-lookup"><span data-stu-id="093cd-115">Due to the overhead verifying and generating backup checksums, using backup checksums poses a potential performance impact.</span></span> <span data-ttu-id="093cd-116">interessando sia il carico di lavoro che la velocità effettiva del backup.</span><span class="sxs-lookup"><span data-stu-id="093cd-116">Both the workload and the backup throughput may be affected.</span></span> <span data-ttu-id="093cd-117">I checksum del backup sono pertanto facoltativi.</span><span class="sxs-lookup"><span data-stu-id="093cd-117">Therefore, using backup checksums is optional.</span></span> <span data-ttu-id="093cd-118">Quando si decide di generare checksum durante un backup, eseguire un attento monitoraggio dell'overhead della CPU nonché dell'impatto di eventuali carichi di lavoro eseguiti simultaneamente nel sistema.</span><span class="sxs-lookup"><span data-stu-id="093cd-118">When deciding to generate checksums during a backup, carefully monitor the CPU overhead incurred as well as the impact on any concurrent workload on the system.</span></span>  
  
 <span data-ttu-id="093cd-119">L'istruzione BACKUP non modifica mai la pagina di origine sul disco né il contenuto di una pagina.</span><span class="sxs-lookup"><span data-stu-id="093cd-119">BACKUP never modifies the source page on disk nor the contents of a page.</span></span>  
  
 <span data-ttu-id="093cd-120">Quando i checksum di backup sono abilitati, l'operazione di backup esegue i passaggi descritti di seguito:</span><span class="sxs-lookup"><span data-stu-id="093cd-120">When backup checksums are enabled, a backup operation performs the following steps:</span></span>  
  
1.  <span data-ttu-id="093cd-121">Prima di scrivere una pagina sui supporti di backup, l'operazione di backup verifica le eventuali informazioni esistenti a livello di pagina, ovvero esegue il rilevamento dei checksum della pagina o delle pagine incomplete.</span><span class="sxs-lookup"><span data-stu-id="093cd-121">Before writing a page to the backup media, the backup operation verifies the page-level information (page checksum or torn page detection), if either exists.</span></span> <span data-ttu-id="093cd-122">Se non esiste alcun tipo di checksum, il backup non può verificare la pagina.</span><span class="sxs-lookup"><span data-stu-id="093cd-122">If neither exists, backup cannot verify the page.</span></span> <span data-ttu-id="093cd-123">Le pagine non verificate vengono incluse nello stato in cui si trovano, e il relativo contenuto viene aggiunto al checksum complessivo del backup.</span><span class="sxs-lookup"><span data-stu-id="093cd-123">Unverified the pages are included as is, and their contents are added to the overall backup checksum.</span></span>  
  
     <span data-ttu-id="093cd-124">Se durante la verifica dell'operazione di backup viene rilevato un errore di pagina, il backup non riesce.</span><span class="sxs-lookup"><span data-stu-id="093cd-124">If the backup operation encounters a page error during verification, the backup fails.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="093cd-125">Per ulteriori informazioni sui checksum delle pagine e sul rilevamento delle pagine incomplete, vedere l'opzione PAGE_VERIFY dell'istruzione ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="093cd-125">For more information about page checksums and torn page detection, see the PAGE_VERIFY option of the ALTER DATABASE statement.</span></span> <span data-ttu-id="093cd-126">Per altre informazioni, vedere [Opzioni ALTER DATABASE SET &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options).</span><span class="sxs-lookup"><span data-stu-id="093cd-126">For more information, see [ALTER DATABASE SET Options &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options).</span></span>  
  
2.  <span data-ttu-id="093cd-127">Indipendentemente dalla presenza di valori di checksum per la pagina, viene generato un checksum di backup separato per i flussi di backup.</span><span class="sxs-lookup"><span data-stu-id="093cd-127">Regardless of whether page checksums are present, BACKUP generates a separate backup checksum for the backup streams.</span></span> <span data-ttu-id="093cd-128">Le operazioni di ripristino possono utilizzare facoltativamente il checksum del backup per verificare che il backup non sia danneggiato.</span><span class="sxs-lookup"><span data-stu-id="093cd-128">Restore operations can optionally use the backup checksum to validate that the backup is not corrupted.</span></span> <span data-ttu-id="093cd-129">Il checksum del backup viene archiviato nei supporti di backup e non nelle pagine del database.</span><span class="sxs-lookup"><span data-stu-id="093cd-129">The backup checksum is stored on the backup media, not on the database pages.</span></span> <span data-ttu-id="093cd-130">È possibile utilizzare facoltativamente il checksum del backup in fase di ripristino.</span><span class="sxs-lookup"><span data-stu-id="093cd-130">The backup checksum can optionally be used at restore time.</span></span>  
  
3.  <span data-ttu-id="093cd-131">Il set di backup viene contrassegnato come contenente checksum di backup (nella colonna **has_backup_checksums** di **msdb..backupset)** .</span><span class="sxs-lookup"><span data-stu-id="093cd-131">The backup set is flagged as containing backup checksums (in the **has_backup_checksums** column of **msdb..backupset)**.</span></span> <span data-ttu-id="093cd-132">Per altre informazioni, vedere [backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="093cd-132">For more information, see [backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql).</span></span>  
  
 <span data-ttu-id="093cd-133">Durante un'operazione di ripristino, se nel supporto di backup sono presenti checksum di backup, per impostazione predefinita le istruzioni RESTORE e RESTORE VERIFYONLY verificheranno solo i checksum di backup e delle pagine.</span><span class="sxs-lookup"><span data-stu-id="093cd-133">During a restore operation, if backup checksums are present on the backup media, by default, both the RESTORE and RESTORE VERIFYONLY statements verify the backup checksums and page checksums.</span></span> <span data-ttu-id="093cd-134">In assenza di un checksum di backup, l'operazione di backup proseguirà senza verifica, in quanto, in tal caso, l'operazione di ripristino non è in grado di verificare in modo affidabile i checksum delle pagine.</span><span class="sxs-lookup"><span data-stu-id="093cd-134">If there is no backup checksum, either restore operation proceeds without any verification; this is because without a backup checksum, restore cannot reliably verify page checksums.</span></span>  
  
## <a name="response-to-page-checksum-errors-during-a-backup-or-restore-operation"></a><span data-ttu-id="093cd-135">Risposta a errori di checksum di pagina durante un'operazione di backup o ripristino</span><span class="sxs-lookup"><span data-stu-id="093cd-135">Response to Page Checksum Errors During a Backup or Restore Operation</span></span>  
 <span data-ttu-id="093cd-136">Per impostazione predefinita, dopo avere rilevato un errore di checksum della pagina, l'operazione BACKUP o RESTORE non riesce e l'operazione RESTORE VERIFYONLY continua.</span><span class="sxs-lookup"><span data-stu-id="093cd-136">By default, after encountering a page checksum error, a BACKUP or RESTORE operation fails and a RESTORE VERIFYONLY operation continues.</span></span> <span data-ttu-id="093cd-137">Tuttavia, è possibile controllare se un'operazione specificata non riesce sul rilevamento di un errore o continua nel migliore dei modi.</span><span class="sxs-lookup"><span data-stu-id="093cd-137">However, you can control whether a given operation fails on encountering an error or continues as best it can.</span></span>  
  
 <span data-ttu-id="093cd-138">Se un'operazione BACKUP continua dopo aver rilevato errori, l'operazione esegue i passaggi indicati di seguito:</span><span class="sxs-lookup"><span data-stu-id="093cd-138">If a BACKUP operation continues after encountering errors, the operation performs the following steps:</span></span>  
  
1.  <span data-ttu-id="093cd-139">Contrassegna il set di backup sul supporto come contenente errori e tiene traccia della pagina nella tabella **suspect_pages** del database **msdb** .</span><span class="sxs-lookup"><span data-stu-id="093cd-139">Flags the backup set on the backup media as containing errors and tracks the page in the **suspect_pages** table in the **msdb** database.</span></span> <span data-ttu-id="093cd-140">Per altre informazioni, vedere [suspect_pages &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/suspect-pages-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="093cd-140">For more information, see [suspect_pages &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/suspect-pages-transact-sql).</span></span>  
  
2.  <span data-ttu-id="093cd-141">Registra l'errore nel log degli errori di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="093cd-141">Logs the error in the SQL Server error log.</span></span>  
  
3.  <span data-ttu-id="093cd-142">Contrassegna il set di backup come contenente questo tipo di errore nella colonna **is_damaged** di **msdb.backupset**.</span><span class="sxs-lookup"><span data-stu-id="093cd-142">Marks the backup set as containing this type of error (in the **is_damaged** column of **msdb.backupset)**.</span></span> <span data-ttu-id="093cd-143">Per altre informazioni, vedere [backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="093cd-143">For more information, see [backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql).</span></span>  
  
4.  <span data-ttu-id="093cd-144">Visualizza un messaggio per indicare che il backup è stato generato correttamente, ma contiene errori di pagina.</span><span class="sxs-lookup"><span data-stu-id="093cd-144">Issues a message that the backup was successfully generated, but contains page errors.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="093cd-145">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="093cd-145">Related Tasks</span></span>  
 <span data-ttu-id="093cd-146">**Per abilitare o disabilitare i checksum per i backup**</span><span class="sxs-lookup"><span data-stu-id="093cd-146">**To enable or disable backup checksums**</span></span>  
  
-   [<span data-ttu-id="093cd-147">Abilitare o disabilitare il checksum di backup durante il backup o il ripristino &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="093cd-147">Enable or Disable Backup Checksums During Backup or Restore &#40;SQL Server&#41;</span></span>](enable-or-disable-backup-checksums-during-backup-or-restore-sql-server.md)  
  
 <span data-ttu-id="093cd-148">**Per controllare la risposta a un errore durante un'operazione di backup**</span><span class="sxs-lookup"><span data-stu-id="093cd-148">**To control the response to a error during a backup operation**</span></span>  
  
-   [<span data-ttu-id="093cd-149">Specifica se un'operazione di backup o ripristino viene arrestata o prosegue in seguito a un errore &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="093cd-149">Specify Whether a Backup or Restore Operation Continues or Stops After Encountering an Error &#40;SQL Server&#41;</span></span>](specify-if-backup-or-restore-continues-or-stops-after-error.md)  
  
## <a name="see-also"></a><span data-ttu-id="093cd-150">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="093cd-150">See Also</span></span>  
 <span data-ttu-id="093cd-151">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="093cd-151">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span></span>  
 <span data-ttu-id="093cd-152">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="093cd-152">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 <span data-ttu-id="093cd-153">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="093cd-153">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span></span>  
 <span data-ttu-id="093cd-154">[Set di supporti di backup con mirroring &#40;SQL Server&#41;](mirrored-backup-media-sets-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="093cd-154">[Mirrored Backup Media Sets &#40;SQL Server&#41;](mirrored-backup-media-sets-sql-server.md) </span></span>  
 <span data-ttu-id="093cd-155">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="093cd-155">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 [<span data-ttu-id="093cd-156">RESTORE VERIFYONLY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="093cd-156">RESTORE VERIFYONLY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-verifyonly-transact-sql)  
  
  
