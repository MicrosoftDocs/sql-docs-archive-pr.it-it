---
title: Ripristino da backup archiviati in Azure | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: 6ae358b2-6f6f-46e0-a7c8-f9ac6ce79a0e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 68b270f18cb4dbc2724c5a062afae54fa711acec
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87635663"
---
# <a name="restoring-from-backups-stored-in-azure"></a><span data-ttu-id="8e5f4-102">Ripristino da backup archiviati in Azure</span><span class="sxs-lookup"><span data-stu-id="8e5f4-102">Restoring From Backups Stored in Azure</span></span>
  <span data-ttu-id="8e5f4-103">Questo argomento illustra le considerazioni relative al ripristino di un database tramite un backup archiviato nel servizio Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-103">This topic outlines the considerations when restoring a database using a backup stored in the Azure Blob storage service.</span></span> <span data-ttu-id="8e5f4-104">Ciò si applica ai backup creati tramite il backup di SQL Server nell'URL o tramite [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8e5f4-104">This applies to backups created either by using SQL Server Backup to URL backup or by [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)].</span></span>  
  
 <span data-ttu-id="8e5f4-105">È consigliabile esaminare questo argomento se si dispone di backup archiviati nel servizio Archiviazione BLOB di Azure che si vogliono ripristinare, nonché di rivedere gli argomenti in cui vengono descritti i passaggi per ripristinare un database che sono uguali sia per i backup in locale sia per quelli di Azure.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-105">We recommend reviewing this topic if you have backups stored in the Azure Blob storage service that you plan to restore, and then review the topics that describe the steps on how to restore a database which is the same for both on-premises and azure backups.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="8e5f4-106">Panoramica</span><span class="sxs-lookup"><span data-stu-id="8e5f4-106">Overview</span></span>  
 <span data-ttu-id="8e5f4-107">Gli strumenti e i metodi utilizzati per ripristinare un database da un backup in locale si applicano al ripristino di un database da un backup nel cloud.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-107">The tools and methods that are used to restore a database from an on-premises backup apply to restoring a database from a cloud backup.</span></span>  <span data-ttu-id="8e5f4-108">Nelle sezioni seguenti vengono descritte queste considerazioni e tutte le differenze di cui essere a conoscenza relativamente ai casi in cui si usano backup archiviati nel servizio Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-108">The following sections describe these considerations and any differences you should know about when you use backups stored in the Azure Blob storage service.</span></span>  
  
### <a name="using-transact-sql"></a><span data-ttu-id="8e5f4-109">Uso di Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="8e5f4-109">Using Transact-SQL</span></span>  
  
-   <span data-ttu-id="8e5f4-110">Poiché SQL Server deve essere connesso a un'origine esterna per il recupero dei file di backup, vengono utilizzate le credenziali SQL per autenticare l'account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-110">Since SQL Server must connect to an external source to retrieve the backup files, SQL Credential is used to authenticate to the storage account.</span></span> <span data-ttu-id="8e5f4-111">Di conseguenza, per l'istruzione RESTORE è richiesta l'opzione WITH CREDENTIAL.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-111">Consequently, the RESTORE statement requires WITH CREDENTIAL option.</span></span> <span data-ttu-id="8e5f4-112">Per altre informazioni, vedere [Backup e ripristino di SQL Server con il servizio di archiviazione BLOB di Azure](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).</span><span class="sxs-lookup"><span data-stu-id="8e5f4-112">For more information, see [SQL Server Backup and Restore with Azure Blob Storage Service](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).</span></span>  
  
-   <span data-ttu-id="8e5f4-113">Se si usa [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)] per gestire i backup nel cloud, è possibile verificare tutti i backup disponibili nell'archiviazione usando la funzione di sistema **smart_admin.fn_available_backups** .</span><span class="sxs-lookup"><span data-stu-id="8e5f4-113">If you are using the [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)] to manage your backups to the cloud, you can review all the available backups in the storage, by using the **smart_admin.fn_available_backups** system function.</span></span> <span data-ttu-id="8e5f4-114">Tramite questa funzione di sistema vengono restituiti tutti i backup disponibili per un database in una tabella.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-114">This system function returns all the available backups for a database in a table.</span></span> <span data-ttu-id="8e5f4-115">Poiché i risultati vengono restituiti in una tabella, è possibile filtrarli oppure ordinarli.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-115">As the results are returned in a table, you can filter or sort the results.</span></span> <span data-ttu-id="8e5f4-116">Per ulteriori informazioni, vedere [smart_admin. fn_available_backups &#40;Transact-SQL&#41;](/sql/relational-databases/system-functions/managed-backup-fn-available-backups-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="8e5f4-116">For more information, see [smart_admin.fn_available_backups &#40;Transact-SQL&#41;](/sql/relational-databases/system-functions/managed-backup-fn-available-backups-transact-sql).</span></span>  
  
### <a name="using-sql-server-management-studio"></a><span data-ttu-id="8e5f4-117">Utilizzare SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="8e5f4-117">Using SQL Server Management Studio</span></span>  
  
-   <span data-ttu-id="8e5f4-118">L'attività di ripristino viene utilizzata per ripristinare un database tramite SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-118">The restore task is used to restore a database using the SQL Server Management Studio.</span></span> <span data-ttu-id="8e5f4-119">Nella pagina dei supporti di backup è ora disponibile l'opzione **URL** per visualizzare i file di backup archiviati nel servizio Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-119">The backup media page now includes the **URL** option to show backup files stored in the Azure Blob storage service.</span></span> <span data-ttu-id="8e5f4-120">Inoltre, è necessario fornire le credenziali SQL utilizzate per autenticare l'account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-120">You also must provide the SQL Credential that is used to authenticate to the storage account.</span></span> <span data-ttu-id="8e5f4-121">La griglia **Set di backup da ripristinare** viene popolata successivamente con i backup disponibili nell'archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-121">The **Backup sets to restore** grid is then populated with the available backups in the Azure Blob storage.</span></span> <span data-ttu-id="8e5f4-122">Per altre informazioni, vedere [Ripristino dal servizio Archiviazione di Azure tramite SQL Server Management Studio](sql-server-backup-to-url.md#RestoreSSMS).</span><span class="sxs-lookup"><span data-stu-id="8e5f4-122">For more information, see [Restoring from Azure storage Using SQL Server Management Studio](sql-server-backup-to-url.md#RestoreSSMS).</span></span>  
  
### <a name="optimizing-restores"></a><span data-ttu-id="8e5f4-123">Ottimizzazione dei ripristini</span><span class="sxs-lookup"><span data-stu-id="8e5f4-123">Optimizing Restores</span></span>  
 <span data-ttu-id="8e5f4-124">Per ridurre il tempo di scrittura di un'operazione di ripristino, aggiungere il diritto utente **Esecuzione attività di manutenzione volume** all'account utente di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-124">To reduce restore write time, Add **perform volume maintenance tasks** user right to the SQL Server user account.</span></span> <span data-ttu-id="8e5f4-125">Per altre informazioni, vedere [Inizializzazione di file di database](https://go.microsoft.com/fwlink/?LinkId=271622).</span><span class="sxs-lookup"><span data-stu-id="8e5f4-125">For more information, see [Database File Initialization](https://go.microsoft.com/fwlink/?LinkId=271622).</span></span> <span data-ttu-id="8e5f4-126">Se l'operazione di ripristino è ancora lenta con l'inizializzazione immediata dei file abilitata, esaminare le dimensioni del file di log nell'istanza in cui è stato eseguito il backup del database.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-126">If restore is still slow with instant file initialization turned on, look at the size of the log file on the instance where the database was backed up.</span></span> <span data-ttu-id="8e5f4-127">Se le dimensioni del log sono molto grandi (più GB), si prevede un ripristino lento.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-127">If the log is very large in size (multiple GBs), it would be expected that restore would be slow.</span></span> <span data-ttu-id="8e5f4-128">Durante l'operazione di ripristino il file di log deve essere azzerato; questa operazione richiede una quantità di tempo significativa.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-128">During restore the log file must be zeroed which takes a significant amount of time.</span></span>  
  
 <span data-ttu-id="8e5f4-129">Per ridurre i tempi di ripristino è consigliabile usare backup compressi.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-129">To reduce restore times it is recommended that you use compressed backups.</span></span>  <span data-ttu-id="8e5f4-130">Per i backup con dimensioni superiori ai 25 GB, usare l' [utilità AzCopy](https://docs.microsoft.com/archive/blogs/windowsazurestorage/azcopy-uploadingdownloading-files-for-windows-azure-blobs) per eseguire il download nell'unità locale e quindi eseguire il ripristino.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-130">For backup sizes exceeding 25 GB, use [AzCopy utility](https://docs.microsoft.com/archive/blogs/windowsazurestorage/azcopy-uploadingdownloading-files-for-windows-azure-blobs) to download to the local drive and then perform the restore.</span></span> <span data-ttu-id="8e5f4-131">Per altri suggerimenti e procedure consigliate sui backup, vedere [SQL Server Backup to URL Best Practices and Troubleshooting](sql-server-backup-to-url-best-practices-and-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="8e5f4-131">For other backup best practices and recommendations, see [SQL Server Backup to URL Best Practices and Troubleshooting](sql-server-backup-to-url-best-practices-and-troubleshooting.md).</span></span>  
  
 <span data-ttu-id="8e5f4-132">È inoltre possibile abilitare il flag di traccia 3051 quando si esegue il ripristino per generare un log dettagliato.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-132">You can also turn on Trace Flag 3051 when doing the restore to generate a detailed log.</span></span> <span data-ttu-id="8e5f4-133">Questo file di log viene inserito nella directory dei log e viene denominato usando il formato: BackupToUrl-\<instancename>-\<dbname>-action-\<PID>.log.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-133">This log file is placed in the log directory, and is named using the format: BackupToUrl-\<instancename>-\<dbname>-action-\<PID>.log.</span></span> <span data-ttu-id="8e5f4-134">Nel file di log sono incluse informazioni su ogni round trip ad Archiviazione di Azure, incluso l'intervallo che può essere utile per individuare il problema.</span><span class="sxs-lookup"><span data-stu-id="8e5f4-134">The log file includes information about each round trip to Azure Storage including timing that can be helpful in diagnosing the issue.</span></span>  
  
### <a name="topics-on-performing-restore-operations"></a><span data-ttu-id="8e5f4-135">Argomenti sull'esecuzione delle operazioni di ripristino</span><span class="sxs-lookup"><span data-stu-id="8e5f4-135">Topics on Performing Restore Operations</span></span>  
  
-   [<span data-ttu-id="8e5f4-136">Ripristini di database completi &#40;modello di recupero con registrazione minima&#41;</span><span class="sxs-lookup"><span data-stu-id="8e5f4-136">Complete Database Restores &#40;Simple Recovery Model&#41;</span></span>](complete-database-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="8e5f4-137">RESTORE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="8e5f4-137">RESTORE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-transact-sql)  
  
-   [<span data-ttu-id="8e5f4-138">Ripristini di database completi &#40;modello di recupero con registrazione completa&#41;</span><span class="sxs-lookup"><span data-stu-id="8e5f4-138">Complete Database Restores &#40;Full Recovery Model&#41;</span></span>](complete-database-restores-full-recovery-model.md)  
  
-   [<span data-ttu-id="8e5f4-139">Ripristini di file &#40;modello di recupero con registrazione minima&#41;</span><span class="sxs-lookup"><span data-stu-id="8e5f4-139">File Restores &#40;Simple Recovery Model&#41;</span></span>](file-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="8e5f4-140">Ripristini di file &#40;modello di recupero con registrazione completa&#41;</span><span class="sxs-lookup"><span data-stu-id="8e5f4-140">File Restores &#40;Full Recovery Model&#41;</span></span>](file-restores-full-recovery-model.md)  
  
-   [<span data-ttu-id="8e5f4-141">Ripristini a fasi &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8e5f4-141">Piecemeal Restores &#40;SQL Server&#41;</span></span>](piecemeal-restores-sql-server.md)  
  
  
