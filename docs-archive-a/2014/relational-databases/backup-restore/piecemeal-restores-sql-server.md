---
title: Ripristini a fasi (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- partial updates [SQL Server]
- staged restores [SQL Server]
- piecemeal restores [SQL Server]
- restoring [SQL Server], piecemeal restore scenario
ms.assetid: 208f55e0-0762-4cfb-85c4-d36a76ea0f5b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: ebc4ea11780908f847946a01338571211b57678a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87715431"
---
# <a name="piecemeal-restores-sql-server"></a><span data-ttu-id="90cab-102">Ripristini a fasi (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="90cab-102">Piecemeal Restores (SQL Server)</span></span>
  <span data-ttu-id="90cab-103">Le informazioni contenute in questo argomento sono rilevanti solo per i database di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise Edition in cui sono contenuti più file o filegroup e, nel modello di recupero con registrazione minima, solo per i filegroup di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="90cab-103">This topic is relevant only for databases in the Enterprise edition of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that contain multiple files or filegroups; and, under the simple model, only for read-only filegroups.</span></span>  
  
 <span data-ttu-id="90cab-104">Per informazioni sui ripristini a fasi e tabelle ottimizzate per la memoria, vedere [Backup e ripristino a fasi di database con tabelle ottimizzate per la memoria](../in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="90cab-104">For information about piecemeal restore and memory-optimized tables, see [Piecemeal Restore of Databases With Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
 <span data-ttu-id="90cab-105">Il*ripristino a fasi* consente di ripristinare e recuperare a fasi i database in cui sono inclusi più filegroup.</span><span class="sxs-lookup"><span data-stu-id="90cab-105">*Piecemeal restore* allows databases that contain multiple filegroups to be restored and recovered in stages.</span></span> <span data-ttu-id="90cab-106">e comprende una serie di sequenze di ripristino, a partire dal filegroup primario e, in alcuni casi, da uno o più filegroup secondari.</span><span class="sxs-lookup"><span data-stu-id="90cab-106">Piecemeal restore involves a series of restore sequences, starting with the primary filegroup and, in some cases, one or more secondary filegroups.</span></span> <span data-ttu-id="90cab-107">Permette inoltre di gestire i controlli per assicurarsi che il database sia sempre coerente.</span><span class="sxs-lookup"><span data-stu-id="90cab-107">Piecemeal restore maintains checks to ensure that the database will be consistent in the end.</span></span> <span data-ttu-id="90cab-108">Dopo il completamento della sequenza di ripristino, i file recuperati, se validi e coerenti con il database, possono essere portati online direttamente.</span><span class="sxs-lookup"><span data-stu-id="90cab-108">After the restore sequence is completed, recovered files, if they are valid and consistent with the database, can be brought online directly.</span></span>  
  
 <span data-ttu-id="90cab-109">Il ripristino a fasi può essere utilizzato con tutti i modelli di recupero, tuttavia la massima flessibilità si ottiene con i modelli di recupero con registrazione completa o con registrazione minima delle operazioni bulk, piuttosto che con il modello di recupero con registrazione minima.</span><span class="sxs-lookup"><span data-stu-id="90cab-109">Piecemeal restore works with all recovery models, but is more flexible for the full and bulk-logged models than for the simple model.</span></span>  
  
 <span data-ttu-id="90cab-110">Ogni ripristino a fasi inizia con una sequenza di ripristino iniziale detta *sequenza di ripristino parziale*.</span><span class="sxs-lookup"><span data-stu-id="90cab-110">Every piecemeal restore starts with an initial restore sequence called the *partial-restore sequence*.</span></span> <span data-ttu-id="90cab-111">Come minimo, la sequenza di ripristino parziale ripristina e recupera il filegroup primario e, nel modello di recupero con registrazione minima, tutti i filegroup di lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="90cab-111">Minimally, the partial-restore sequence restores and recovers the primary filegroup and, under the simple recovery model, all read/write filegroups.</span></span> <span data-ttu-id="90cab-112">Durante la sequenza di ripristino a fasi, è necessario che l'intero database venga portato offline.</span><span class="sxs-lookup"><span data-stu-id="90cab-112">During the piecemeal-restore sequence, the whole database must go offline.</span></span> <span data-ttu-id="90cab-113">Quindi, il database è online e i filegroup ripristinati sono disponibili.</span><span class="sxs-lookup"><span data-stu-id="90cab-113">Thereafter, the database is online and restored filegroups are available.</span></span> <span data-ttu-id="90cab-114">Tuttavia, tutti i filegroup non ripristinati rimangono offline e non sono accessibili.</span><span class="sxs-lookup"><span data-stu-id="90cab-114">However, any unrestored filegroups remain offline and are not accessible.</span></span> <span data-ttu-id="90cab-115">I filegroup offline possono comunque essere ripristinati e portati online successivamente tramite un ripristino di file.</span><span class="sxs-lookup"><span data-stu-id="90cab-115">Any offline filegroups, however, can be restored and brought online later by a file restore.</span></span>  
  
 <span data-ttu-id="90cab-116">Indipendentemente dal modello di recupero utilizzato dal database, la sequenza di ripristino parziale inizia con un'istruzione RESTORE DATABASE che consente di ripristinare un backup completo e di specificare l'opzione PARTIAL.</span><span class="sxs-lookup"><span data-stu-id="90cab-116">Regardless of the recovery model that is used by the database, the partial-restore sequence starts with a RESTORE DATABASE statement that restores a full backup and specifies the PARTIAL option.</span></span> <span data-ttu-id="90cab-117">L'opzione PARTIAL avvia sempre un nuovo ripristino a fasi. Pertanto, è necessario specificare PARTIAL solo una volta nell'istruzione iniziale della sequenza di ripristino parziale.</span><span class="sxs-lookup"><span data-stu-id="90cab-117">The PARTIAL option always starts a new piecemeal restore; therefore, you must specify PARTIAL only one time in the initial statement of the partial-restore sequence.</span></span> <span data-ttu-id="90cab-118">Quando la sequenza di ripristino parziale termina e il database viene portato online, lo stato dei file rimanenti diventa "recupero in sospeso" in quanto il loro recupero è stato posticipato.</span><span class="sxs-lookup"><span data-stu-id="90cab-118">When the partial restore sequence finishes and the database is brought online, the state of the remaining files becomes "recovery pending" because their recovery has been postponed.</span></span>  
  
 <span data-ttu-id="90cab-119">Successivamente, un ripristino a fasi include in genere una o più sequenze di ripristino, dette *sequenze di ripristino dei filegroup*.</span><span class="sxs-lookup"><span data-stu-id="90cab-119">Subsequently, a piecemeal restore typically includes one or more restore sequences, which are called *filegroup-restore sequences*.</span></span> <span data-ttu-id="90cab-120">È possibile attendere il periodo di tempo desiderato prima di eseguire una sequenza di ripristino dei filegroup specifica.</span><span class="sxs-lookup"><span data-stu-id="90cab-120">You can wait to perform a specific filegroup-restore sequence for as long as you want.</span></span> <span data-ttu-id="90cab-121">Ogni sequenza di ripristino dei filegroup ripristina e recupera uno o più filegroup offline rispetto a un punto coerente con il database.</span><span class="sxs-lookup"><span data-stu-id="90cab-121">Each filegroup-restore sequence restores and recovers one or more offline filegroups to a point consistent with the database.</span></span> <span data-ttu-id="90cab-122">Momento di esecuzione e numero delle sequenze di ripristino dei filegroup dipendono dall'obiettivo del recupero, dal numero di filegroup offline che si desidera ripristinare e dal numero di tali filegroup ripristinati per ogni sequenza di ripristino dei filegroup.</span><span class="sxs-lookup"><span data-stu-id="90cab-122">The timing and number of filegroup-restore sequences depends on your recovery goal, the number of offline filegroups you want to restore, and on how many of them you restore per filegroup-restore sequence.</span></span>  
  
 <span data-ttu-id="90cab-123">I requisiti esatti per l'esecuzione di un ripristino a fasi dipendono dal modello di recupero del database.</span><span class="sxs-lookup"><span data-stu-id="90cab-123">The exact requirements for performing a piecemeal restore depend on the recovery model of the database.</span></span> <span data-ttu-id="90cab-124">Per ulteriori informazioni, vedere "Ripristino a fasi nel modello di recupero con registrazione minima" e "Ripristino a fasi nel modello di recupero con registrazione completa" di seguito in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="90cab-124">For more information, see "Piecemeal Restore Under the Simple Recovery Model" and "Piecemeal Restore Under the Full Recovery Model," later in this topic.</span></span>  
  
## <a name="piecemeal-restore-scenarios"></a><span data-ttu-id="90cab-125">Scenari di ripristino a fasi</span><span class="sxs-lookup"><span data-stu-id="90cab-125">Piecemeal Restore Scenarios</span></span>  
 <span data-ttu-id="90cab-126">Tutte le edizioni di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] supportano il ripristino a fasi offline.</span><span class="sxs-lookup"><span data-stu-id="90cab-126">All editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] support offline piecemeal restores.</span></span> <span data-ttu-id="90cab-127">In Enterprise Edition, un ripristino a fasi può essere online oppure offline.</span><span class="sxs-lookup"><span data-stu-id="90cab-127">In the Enterprise edition, a piecemeal restore can be either online or offline.</span></span> <span data-ttu-id="90cab-128">Le implicazioni del ripristino a fasi offline e online sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="90cab-128">The implications of offline and online piecemeal restores are as follows:</span></span>  
  
-   <span data-ttu-id="90cab-129">Scenari di ripristino a fasi offline</span><span class="sxs-lookup"><span data-stu-id="90cab-129">Offline piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="90cab-130">In un ripristino a fasi offline, il database è online dopo la sequenza di ripristino parziale.</span><span class="sxs-lookup"><span data-stu-id="90cab-130">In an offline piecemeal restore, the database is online after the partial-restore sequence.</span></span> <span data-ttu-id="90cab-131">I filegroup non ancora ripristinati rimangono offline, ma possono essere ripristinati secondo le esigenze dopo aver portato il database offline.</span><span class="sxs-lookup"><span data-stu-id="90cab-131">Filegroups that have not yet been restored remain offline, but they can be restored as you need them after taking the database offline.</span></span>  
  
-   <span data-ttu-id="90cab-132">Scenari di ripristino a fasi online</span><span class="sxs-lookup"><span data-stu-id="90cab-132">Online piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="90cab-133">In un ripristino a fasi online, dopo la sequenza di ripristino parziale, il database è online e il filegroup primario è disponibile insieme ad eventuali filegroup secondari recuperati.</span><span class="sxs-lookup"><span data-stu-id="90cab-133">In an online piecemeal restore, after the partial-restore sequence, the database is online, and the primary filegroup and any recovered secondary filegroups are available.</span></span> <span data-ttu-id="90cab-134">I filegroup non ancora ripristinati rimangono offline, ma è possibile ripristinarli in base alle necessità mentre il database rimane online.</span><span class="sxs-lookup"><span data-stu-id="90cab-134">Filegroups that have not yet been restored remain offline, but they can be restored as needed while the database remains online.</span></span>  
  
     <span data-ttu-id="90cab-135">Il ripristino a fasi online può coinvolgere le transazioni posticipate.</span><span class="sxs-lookup"><span data-stu-id="90cab-135">Online piecemeal restores can involve deferred transactions.</span></span> <span data-ttu-id="90cab-136">Quando è stato ripristinato un solo subset di filegroup, le transazioni nel database che dipendono dai filegroup online possono diventare posticipate.</span><span class="sxs-lookup"><span data-stu-id="90cab-136">When only a subset of filegroups has been restored, transactions in the database that depend on online filegroups might become deferred.</span></span> <span data-ttu-id="90cab-137">Si tratta di una situazione comune, in quanto l'intero database deve essere coerente.</span><span class="sxs-lookup"><span data-stu-id="90cab-137">This is typical, because the whole database must be consistent.</span></span> <span data-ttu-id="90cab-138">Per altre informazioni, vedere [Transazioni posticipate &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="90cab-138">For more information, see [Deferred Transactions &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span></span>  
  
-   [!INCLUDE[hek_1](../../includes/hek-1-md.md)] <span data-ttu-id="90cab-139">scenario di ripristino a fasi</span><span class="sxs-lookup"><span data-stu-id="90cab-139">piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="90cab-140">Per informazioni sui ripristini a fasi di database OLTP in memoria, vedere [Backup e ripristino a fasi di database con tabelle con ottimizzazione per la memoria](../in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="90cab-140">For information on Piecemeal Restores of In-Memory OLTP databases see [Piecemeal Backup and Restore of Databases With Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
## <a name="restrictions"></a><span data-ttu-id="90cab-141">Restrizioni</span><span class="sxs-lookup"><span data-stu-id="90cab-141">Restrictions</span></span>  
 <span data-ttu-id="90cab-142">Se una sequenza di ripristino parziale esclude qualsiasi filegroup [FILESTREAM](../blob/filestream-sql-server.md) , il ripristino temporizzato non è supportato.</span><span class="sxs-lookup"><span data-stu-id="90cab-142">If a partial restore sequence excludes any [FILESTREAM](../blob/filestream-sql-server.md) filegroup, point-in-time restore is not supported.</span></span> <span data-ttu-id="90cab-143">È possibile forzare la continuazione della sequenza di ripristino.</span><span class="sxs-lookup"><span data-stu-id="90cab-143">You can force the restore sequence to continue.</span></span> <span data-ttu-id="90cab-144">Tuttavia i filegroup FILESTREAM omessi dall'istruzione RESTORE non potranno mai più essere ripristinati.</span><span class="sxs-lookup"><span data-stu-id="90cab-144">However the FILESTREAM filegroups that are omitted from your RESTORE statement can never be restored.</span></span> <span data-ttu-id="90cab-145">Per forzare un ripristino temporizzato, specificare l'opzione CONTINUE_AFTER_ERROR insieme all'opzione STOPAT, STOPATMARK o STOPBEFOREMARK che è necessario specificare anche nelle istruzioni RESTORE LOG successive.</span><span class="sxs-lookup"><span data-stu-id="90cab-145">To force a point-in-time restore, specify the CONTINUE_AFTER_ERROR option together with the STOPAT, STOPATMARK, or STOPBEFOREMARK option, which you must also specify in your subsequent RESTORE LOG statements.</span></span> <span data-ttu-id="90cab-146">Se si specifica CONTINUE_AFTER_ERROR, la sequenza di ripristino parziale ha esito positivo e il filegroup FILESTREAM non può più essere recuperato.</span><span class="sxs-lookup"><span data-stu-id="90cab-146">If you specify CONTINUE_AFTER_ERROR, the partial restore sequence succeeds and the FILESTREAM filegroup becomes unrecoverable.</span></span>  
  
## <a name="piecemeal-restore-under-the-simple-recovery-model"></a><span data-ttu-id="90cab-147">Ripristino a fasi nel modello di recupero con registrazione minima</span><span class="sxs-lookup"><span data-stu-id="90cab-147">Piecemeal Restore Under the Simple Recovery Model</span></span>  
 <span data-ttu-id="90cab-148">Nel modello di recupero con registrazione minima la sequenza del ripristino a fasi deve iniziare con un backup completo o parziale del database.</span><span class="sxs-lookup"><span data-stu-id="90cab-148">Under the simple recovery model, the piecemeal restore sequence must start with a full database or partial backup.</span></span> <span data-ttu-id="90cab-149">Quindi, se il backup ripristinato è una base differenziale, ripristinare il backup differenziale più recente.</span><span class="sxs-lookup"><span data-stu-id="90cab-149">Then, if the restored backup is a differential base, restore the latest differential backup next.</span></span>  
  
 <span data-ttu-id="90cab-150">Durante la prima sequenza di ripristino parziale, se si ripristina solo un subset di filegroup di lettura/scrittura, qualsiasi filegroup non ripristinato diventa non attivo quando si recupera il database parzialmente ripristinato.</span><span class="sxs-lookup"><span data-stu-id="90cab-150">During the first partial restore sequence, if you restore only a subset of read/write filegroups, any unrestored filegroups become defunct when you recover the partially restored database.</span></span> <span data-ttu-id="90cab-151">L'omissione di un filegroup di lettura/scrittura dalla sequenza di ripristino parziale è adeguata solo nei casi seguenti:</span><span class="sxs-lookup"><span data-stu-id="90cab-151">Omitting a read/write filegroup from the partial-restore sequence is appropriate only in the following cases:</span></span>  
  
-   <span data-ttu-id="90cab-152">Si desidera che i filegroup non ripristinati diventino inattivi.</span><span class="sxs-lookup"><span data-stu-id="90cab-152">You intend for the unrestored filegroups to become defunct.</span></span>  
  
-   <span data-ttu-id="90cab-153">La sequenza di ripristino arriverà a un punto di recupero in corrispondenza del quale ogni filegroup non ripristinato è diventato di sola lettura, è stato eliminato o è inattivo (durante un ripristino precedente nella sequenza di ripristino parziale).</span><span class="sxs-lookup"><span data-stu-id="90cab-153">The restore sequence will arrive at a recovery point at which each unrestored filegroup has become read-only, dropped, or defunct (during a previous restore in the partial-restore sequence).</span></span>  
  
-   <span data-ttu-id="90cab-154">Il backup completo è stato eseguito mentre il database utilizzava il modello di recupero con registrazione minima, ma il punto di recupero si trova in corrispondenza di un punto nel tempo in cui il database utilizza il modello di recupero con registrazione completa.</span><span class="sxs-lookup"><span data-stu-id="90cab-154">The full backup was taken while the database was using the simple recovery model, but the recovery point is at a time when the database is using the full recovery model.</span></span> <span data-ttu-id="90cab-155">Per ulteriori informazioni, vedere "Esecuzione di un ripristino a fasi di un database il cui modello di recupero è passato da semplice a completo" di seguito in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="90cab-155">For more information, see "Performing a Piecemeal Restore of a Database Whose Recovery Model Has Been Switched from Simple to Full," later in this topic.</span></span>  
  
### <a name="requirements-for-piecemeal-restore-under-the-simple-recovery-model"></a><span data-ttu-id="90cab-156">Requisiti per il ripristino a fasi nel modello di recupero con registrazione minima</span><span class="sxs-lookup"><span data-stu-id="90cab-156">Requirements for Piecemeal Restore Under the Simple Recovery Model</span></span>  
 <span data-ttu-id="90cab-157">Nel modello di recupero con registrazione minima, la fase iniziale ripristina e recupera il filegroup primario e tutti i filegroup secondari di lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="90cab-157">Under the simple recovery model, the initial stage restores and recovers the primary filegroup and all read/write secondary filegroups.</span></span> <span data-ttu-id="90cab-158">Dopo il completamento della fase iniziale, i file recuperati, se validi e consistenti con il database, possono essere portati online direttamente.</span><span class="sxs-lookup"><span data-stu-id="90cab-158">After the initial stage is completed, recovered files, if they are valid and consistent with the database, can be brought online directly.</span></span>  
  
 <span data-ttu-id="90cab-159">Quindi, è possibile ripristinare i filegroup di sola lettura in una o più fasi aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="90cab-159">Thereafter, read-only filegroups can be restored in one or more additional stages.</span></span>  
  
 <span data-ttu-id="90cab-160">Il ripristino a fasi è disponibile per un filegroup secondario di sola lettura solo se sono vere le condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="90cab-160">Piecemeal restore is available for a read-only secondary filegroup only if the following are true:</span></span>  
  
-   <span data-ttu-id="90cab-161">Il filegroup era di sola lettura quando ne è stato eseguito il backup.</span><span class="sxs-lookup"><span data-stu-id="90cab-161">Was read-only when backed up.</span></span>  
  
-   <span data-ttu-id="90cab-162">Il filegroup è rimasto di sola lettura (mantenendolo coerente dal punto di vista logico con il filegroup primario).</span><span class="sxs-lookup"><span data-stu-id="90cab-162">Has remained read-only (keeping it logically consistent with the primary filegroup).</span></span>  
  
 <span data-ttu-id="90cab-163">Per eseguire un ripristino a fasi, è necessario seguire le linee guida seguenti:</span><span class="sxs-lookup"><span data-stu-id="90cab-163">To perform a piecemeal restore, the following guidelines must be followed:</span></span>  
  
-   <span data-ttu-id="90cab-164">Un set completo di backup per il ripristino a fasi di un database con modello di recupero con registrazione minima deve contenere gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="90cab-164">A complete set of backups for the piecemeal restore of a simple recovery model database must contain the following:</span></span>  
  
    -   <span data-ttu-id="90cab-165">Un backup del database parziale o completo che contiene il filegroup primario e tutti i filegroup che erano di lettura/scrittura al momento del backup.</span><span class="sxs-lookup"><span data-stu-id="90cab-165">A partial or full database backup that contains the primary filegroup and all filegroups that were read/write at the time of the backup.</span></span>  
  
    -   <span data-ttu-id="90cab-166">Un backup di ogni file di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="90cab-166">A backup of each read-only file.</span></span>  
  
-   <span data-ttu-id="90cab-167">Perché il backup di un file di sola lettura sia coerente con il filegroup primario, è necessario che il filegroup secondario sia stato di sola lettura dal momento dell'esecuzione del backup fino al completamento del backup che contiene il filegroup primario.</span><span class="sxs-lookup"><span data-stu-id="90cab-167">For the backup of a read-only file to be consistent with the primary filegroup, the secondary filegroup must have been read-only from when it was backed up until the backup that contains the primary filegroup was completed.</span></span> <span data-ttu-id="90cab-168">È possibile utilizzare backup differenziali dei file, a condizione che siano stati creati dopo che il filegroup è diventato di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="90cab-168">You can use differential file backups, if they were taken after the filegroup became read-only.</span></span>  
  
### <a name="piecemeal-restore-stages-simple-recovery-model"></a><span data-ttu-id="90cab-169">Fasi del ripristino a fasi (modello di recupero con registrazione minima</span><span class="sxs-lookup"><span data-stu-id="90cab-169">Piecemeal Restore Stages (Simple Recovery Model)</span></span>  
 <span data-ttu-id="90cab-170">Lo scenario del ripristino a fasi include le fasi seguenti:</span><span class="sxs-lookup"><span data-stu-id="90cab-170">The piecemeal restore scenario involves the following stages:</span></span>  
  
-   <span data-ttu-id="90cab-171">Fase iniziale (ripristino e recupero del filegroup primario e di tutti i filegroup di lettura/scrittura)</span><span class="sxs-lookup"><span data-stu-id="90cab-171">Initial stage (restore and recover the primary filegroup and all read/write filegroups)</span></span>  
  
     <span data-ttu-id="90cab-172">Nella fase iniziale viene eseguito un ripristino parziale,</span><span class="sxs-lookup"><span data-stu-id="90cab-172">The initial stage performs a partial restore.</span></span> <span data-ttu-id="90cab-173">ovvero la sequenza di ripristino parziale ripristina il filegroup primario, tutti i filegroup secondari di lettura/scrittura e (facoltativamente) alcuni dei filegroup di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="90cab-173">The partial restore sequence restores the primary filegroup, all read/write secondary filegroups, and (optionally) some of the read-only filegroups.</span></span> <span data-ttu-id="90cab-174">Durante la fase iniziale, è necessario che l'intero database venga portato offline.</span><span class="sxs-lookup"><span data-stu-id="90cab-174">During the initial stage, the whole database must go offline.</span></span> <span data-ttu-id="90cab-175">Dopo la fase iniziale, il database è online e i filegroup ripristinati sono disponibili.</span><span class="sxs-lookup"><span data-stu-id="90cab-175">After the initial stage, the database is online, and restored filegroups are available.</span></span> <span data-ttu-id="90cab-176">Tuttavia, eventuali filegroup di sola lettura non ancora ripristinati rimangono offline.</span><span class="sxs-lookup"><span data-stu-id="90cab-176">However, any read-only filegroups that have not yet been restored, remain offline.</span></span>  
  
     <span data-ttu-id="90cab-177">La prima istruzione RESTORE nella fase iniziale deve eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="90cab-177">The first RESTORE statement in the initial stage must do the following:</span></span>  
  
    -   <span data-ttu-id="90cab-178">Utilizzare un backup parziale o completo del database che contiene il filegroup primario e tutti i filegroup che erano di lettura/scrittura al momento del backup.</span><span class="sxs-lookup"><span data-stu-id="90cab-178">Use a partial or full database backup that contains the primary filegroup and all filegroups that were read/write at the time of the backup.</span></span> <span data-ttu-id="90cab-179">In genere una sequenza di ripristino parziale viene avviata tramite il ripristino di un backup parziale.</span><span class="sxs-lookup"><span data-stu-id="90cab-179">It is common to start a partial restore sequence by restoring a partial backup.</span></span>  
  
    -   <span data-ttu-id="90cab-180">Specificare l'opzione PARTIAL che indica l'inizio di un ripristino a fasi.</span><span class="sxs-lookup"><span data-stu-id="90cab-180">Specify the PARTIAL option, which indicates the start of a piecemeal restore.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="90cab-181">L'opzione PARTIAL consente di eseguire i controlli di sicurezza tramite cui viene assicurato che il database risultante è adatto per essere utilizzato come database di produzione.</span><span class="sxs-lookup"><span data-stu-id="90cab-181">The PARTIAL option performs safety checks that ensure that the resulting database is suited for use as a production database.</span></span>  
  
    -   <span data-ttu-id="90cab-182">Specificare l'opzione READ_WRITE_FILEGROUPS nel caso di un backup completo del database.</span><span class="sxs-lookup"><span data-stu-id="90cab-182">Specify the READ_WRITE_FILEGROUPS option if the backup is a full database backup.</span></span>  
  
-   <span data-ttu-id="90cab-183">Mentre il database è online, è possibile utilizzare uno o più ripristini dei file online per ripristinare e recuperare i file di sola lettura offline che erano di sola lettura al momento del backup.</span><span class="sxs-lookup"><span data-stu-id="90cab-183">While the database is online, you can use one or more online file restores to restore and recover offline read-only files that were read-only at the time of backup.</span></span> <span data-ttu-id="90cab-184">Il momento in cui eseguire i ripristini dei file online dipende da quando si desidera che i dati siano online.</span><span class="sxs-lookup"><span data-stu-id="90cab-184">The timing of the online file restores depends on when you want to have the data online.</span></span>  
  
     <span data-ttu-id="90cab-185">La necessità di ripristinare i dati in un file dipende dagli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="90cab-185">Whether you must restore data to a file depends on the following:</span></span>  
  
    -   <span data-ttu-id="90cab-186">I file di sola lettura validi consistenti con il database possono essere portati online direttamente recuperandoli senza ripristinare alcun dato.</span><span class="sxs-lookup"><span data-stu-id="90cab-186">Valid read-only files that are consistent with the database can be brought online directly by recovering them without restoring any data.</span></span>  
  
    -   <span data-ttu-id="90cab-187">I file danneggiati o inconsistenti con il database devono essere ripristinati prima che siano recuperati.</span><span class="sxs-lookup"><span data-stu-id="90cab-187">Files that are damaged or inconsistent with the database must be restored before they are recovered.</span></span>  
  
### <a name="examples"></a><span data-ttu-id="90cab-188">Esempi</span><span class="sxs-lookup"><span data-stu-id="90cab-188">Examples</span></span>  
  
-   [<span data-ttu-id="90cab-189">Esempio: Ripristino a fasi di un database &#40;Modello di recupero con registrazione minima&#41;</span><span class="sxs-lookup"><span data-stu-id="90cab-189">Example: Piecemeal Restore of Database &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-simple-recovery-model.md)  
  
-   [<span data-ttu-id="90cab-190">Esempio: Ripristino a fasi di alcuni filegroup &#40;Modello di recupero con registrazione minima&#41;</span><span class="sxs-lookup"><span data-stu-id="90cab-190">Example: Piecemeal Restore of Only Some Filegroups &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-simple-recovery-model.md)  
  
## <a name="piecemeal-restore-under-the-full-recovery-model"></a><span data-ttu-id="90cab-191">Ripristino a fasi nel modello di recupero con registrazione completa</span><span class="sxs-lookup"><span data-stu-id="90cab-191">Piecemeal Restore Under the Full Recovery Model</span></span>  
 <span data-ttu-id="90cab-192">Nel modello di recupero con registrazione completa o nel modello di recupero con registrazione minima delle operazioni bulk, il ripristino a fasi è disponibile per qualsiasi database che contiene più filegroup, ed è possibile ripristinare un database rispetto a qualsiasi punto nel tempo.</span><span class="sxs-lookup"><span data-stu-id="90cab-192">Under the full recovery model or bulk-logged recovery model, piecemeal restore is available for any database that contains multiple filegroups and you can restore a database to any point in time.</span></span> <span data-ttu-id="90cab-193">Le sequenze di ripristino di un ripristino a fasi funzionano nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="90cab-193">The restore sequences of a piecemeal restore behave as follows:</span></span>  
  
-   <span data-ttu-id="90cab-194">sequenza di ripristino parziale</span><span class="sxs-lookup"><span data-stu-id="90cab-194">Partial-restore sequence</span></span>  
  
     <span data-ttu-id="90cab-195">La sequenza di ripristino parziale ripristina il filegroup primario e, facoltativamente, alcuni dei filegroup secondari.</span><span class="sxs-lookup"><span data-stu-id="90cab-195">The partial restore sequence restores the primary filegroup and, optionally, some of the secondary filegroups.</span></span>  
  
     <span data-ttu-id="90cab-196">La prima istruzione RESTORE DATABASE deve eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="90cab-196">The first RESTORE DATABASE statement must do the following:</span></span>  
  
    -   <span data-ttu-id="90cab-197">Specificare l'opzione PARTIAL.</span><span class="sxs-lookup"><span data-stu-id="90cab-197">Specify the PARTIAL option.</span></span> <span data-ttu-id="90cab-198">Questo indica l'avvio di un ripristino a fasi.</span><span class="sxs-lookup"><span data-stu-id="90cab-198">This indicates the start of a piecemeal restore.</span></span>  
  
    -   <span data-ttu-id="90cab-199">Utilizzare un backup completo del database che contiene il filegroup primario.</span><span class="sxs-lookup"><span data-stu-id="90cab-199">Use any full database backup that contains the primary filegroup.</span></span> <span data-ttu-id="90cab-200">In genere una sequenza di ripristino parziale viene avviata tramite il ripristino di un backup parziale.</span><span class="sxs-lookup"><span data-stu-id="90cab-200">The common practice is to start a partial restore sequence by restoring a partial backup.</span></span>  
  
    -   <span data-ttu-id="90cab-201">Per eseguire il ripristino rispetto a un punto nel tempo specifico, è necessario impostare il tempo nella sequenza di ripristino parziale.</span><span class="sxs-lookup"><span data-stu-id="90cab-201">To restore to a specific point in time, you must specify the time in the partial restore sequence.</span></span> <span data-ttu-id="90cab-202">Ogni passaggio successivo della sequenza di ripristino deve specificare lo stesso punto nel tempo.</span><span class="sxs-lookup"><span data-stu-id="90cab-202">Every successive step of the restore sequence must specify the same point in time.</span></span>  
  
-   <span data-ttu-id="90cab-203">Le sequenze di ripristino dei filegroup portano online filegroup aggiuntivi rispetto a un punto coerente con il database.</span><span class="sxs-lookup"><span data-stu-id="90cab-203">Filegroup-restore sequences bring additional filegroups online to a point consistent with the database.</span></span>  
  
     <span data-ttu-id="90cab-204">In Enterprise Edition, qualsiasi filegroup secondario offline può essere ripristinato e recuperato mentre il database rimane online.</span><span class="sxs-lookup"><span data-stu-id="90cab-204">In the Enterprise edition, any offline secondary filegroup can be restored and recovered while the database remains online.</span></span> <span data-ttu-id="90cab-205">Se un file di sola lettura specifico è coerente con il database e non è danneggiato, non è necessario ripristinarlo.</span><span class="sxs-lookup"><span data-stu-id="90cab-205">If a specific read-only file is undamaged and consistent with the database, the file does not have to be restored.</span></span> <span data-ttu-id="90cab-206">Per altre informazioni, vedere [Recupero di un database senza ripristino dei dati &#40;Transact-SQL&#41;](recover-a-database-without-restoring-data-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="90cab-206">For more information, see [Recover a Database Without Restoring Data &#40;Transact-SQL&#41;](recover-a-database-without-restoring-data-transact-sql.md).</span></span>  
  
### <a name="applying-log-backups"></a><span data-ttu-id="90cab-207">Applicazione dei backup del log</span><span class="sxs-lookup"><span data-stu-id="90cab-207">Applying Log Backups</span></span>  
 <span data-ttu-id="90cab-208">Se un filegroup di sola lettura è stato tale fin da prima della creazione del backup del file, l'applicazione dei backup del log al filegroup non è necessaria e non viene eseguita dal ripristino del file.</span><span class="sxs-lookup"><span data-stu-id="90cab-208">If a read-only filegroup has been read-only since before the file backup was created, applying log backups to the filegroup is unnecessary and is skipped by file restore.</span></span> <span data-ttu-id="90cab-209">Se il filegroup è di lettura/scrittura, per aggiornare il filegroup rispetto al file di log attuale è necessario che venga applicata una catena ininterrotta di backup del log all'ultimo ripristino completo o differenziale.</span><span class="sxs-lookup"><span data-stu-id="90cab-209">If the filegroup is read/write, an unbroken chain of log backups must be applied to the last full or differential restore to bring the filegroup forward to the current log file.</span></span>  
  
### <a name="examples"></a><span data-ttu-id="90cab-210">Esempi</span><span class="sxs-lookup"><span data-stu-id="90cab-210">Examples</span></span>  
  
-   [<span data-ttu-id="90cab-211">Esempio: Ripristino a fasi di un database &#40;Modello di recupero con registrazione completa&#41;</span><span class="sxs-lookup"><span data-stu-id="90cab-211">Example: Piecemeal Restore of Database &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-full-recovery-model.md)  
  
-   [<span data-ttu-id="90cab-212">Esempio: Ripristino a fasi di alcuni filegroup &#40;Modello di recupero con registrazione completa&#41;</span><span class="sxs-lookup"><span data-stu-id="90cab-212">Example: Piecemeal Restore of Only Some Filegroups &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-full-recovery-model.md)  
  
## <a name="performing-a-piecemeal-restore-of-a-database-whose-recovery-model-has-been-switched-from-simple-to-full"></a><span data-ttu-id="90cab-213">Esecuzione di un ripristino a fasi di un database il cui modello di recupero è passato da semplice a completo</span><span class="sxs-lookup"><span data-stu-id="90cab-213">Performing a Piecemeal Restore of a Database Whose Recovery Model Has Been Switched from Simple to Full</span></span>  
 <span data-ttu-id="90cab-214">È possibile eseguire un ripristino a fasi di un database che è passato dal modello di recupero con registrazione minima al modello di recupero con registrazione completa a partire dal momento del backup completo o parziale del database.</span><span class="sxs-lookup"><span data-stu-id="90cab-214">You can perform a piecemeal restore of a database that has been switched from the simple recovery model to the full recovery model since the full partial or database backup.</span></span> <span data-ttu-id="90cab-215">Ad esempio, si prenda in considerazione un database per cui vengono eseguiti i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="90cab-215">For example, consider a database for which you take the following steps:</span></span>  
  
1.  <span data-ttu-id="90cab-216">Creare un backup parziale (backup_1) di un database con modello di recupero con registrazione minima.</span><span class="sxs-lookup"><span data-stu-id="90cab-216">Create a partial backup (backup_1) of a simple-model database.</span></span>  
  
2.  <span data-ttu-id="90cab-217">Dopo un determinato intervallo di tempo, passare al modello di recupero con registrazione completa.</span><span class="sxs-lookup"><span data-stu-id="90cab-217">After some time, change the recovery model to full.</span></span>  
  
3.  <span data-ttu-id="90cab-218">Creare un backup differenziale.</span><span class="sxs-lookup"><span data-stu-id="90cab-218">Create a differential backup.</span></span>  
  
4.  <span data-ttu-id="90cab-219">Avviare l'esecuzione dei backup del log.</span><span class="sxs-lookup"><span data-stu-id="90cab-219">Start taking log backups.</span></span>  
  
 <span data-ttu-id="90cab-220">La sequenza seguente è pertanto valida:</span><span class="sxs-lookup"><span data-stu-id="90cab-220">Thereafter, the following sequence is valid:</span></span>  
  
1.  <span data-ttu-id="90cab-221">Un ripristino parziale che omette alcuni filegroup secondari.</span><span class="sxs-lookup"><span data-stu-id="90cab-221">A partial restore that omits some secondary filegroups.</span></span>  
  
2.  <span data-ttu-id="90cab-222">Un ripristino differenziale, seguito da eventuali altri ripristini necessari.</span><span class="sxs-lookup"><span data-stu-id="90cab-222">A differential restore followed by any other needed restores.</span></span>  
  
3.  <span data-ttu-id="90cab-223">Successivamente, un ripristino del file di un filegroup secondario di lettura/scrittura WITH NORECOVERY dal backup parziale backup_1</span><span class="sxs-lookup"><span data-stu-id="90cab-223">Later, a file restore of a read/write secondary filegroup WITH NORECOVERY from the backup_1 partial backup</span></span>  
  
4.  <span data-ttu-id="90cab-224">Il backup differenziale seguito da tutti i backup ripristinati durante la sequenza del ripristino a fasi originale per ripristinare i dati fino al punto di recupero originale.</span><span class="sxs-lookup"><span data-stu-id="90cab-224">The differential backup followed by any other backups that were restored in the original piecemeal restore sequence to restore the data up to the original recovery point.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="90cab-225">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="90cab-225">See Also</span></span>  
 <span data-ttu-id="90cab-226">[Applicare backup del log delle transazioni &#40;SQL Server&#41;](transaction-log-backups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="90cab-226">[Apply Transaction Log Backups &#40;SQL Server&#41;](transaction-log-backups-sql-server.md) </span></span>  
 <span data-ttu-id="90cab-227">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="90cab-227">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 <span data-ttu-id="90cab-228">[Ripristinare un database di SQL Server fino a un punto specifico &#40;Modello di recupero con registrazione completa&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="90cab-228">[Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) </span></span>  
 <span data-ttu-id="90cab-229">[Panoramica del ripristino e del recupero &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="90cab-229">[Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span></span>  
 [<span data-ttu-id="90cab-230">Pianificare ed eseguire sequenze di ripristino &#40;Modello di recupero con registrazione completa&#41;</span><span class="sxs-lookup"><span data-stu-id="90cab-230">Plan and Perform Restore Sequences &#40;Full Recovery Model&#41;</span></span>](plan-and-perform-restore-sequences-full-recovery-model.md)  
  
  
