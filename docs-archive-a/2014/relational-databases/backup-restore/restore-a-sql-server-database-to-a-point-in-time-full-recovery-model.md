---
title: Ripristinare un database di SQL Server fino a un punto specifico (modello di recupero con registrazione completa) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- STOPAT clause [RESTORE LOG statement]
- point in time recovery [SQL Server]
- restoring databases [SQL Server], point in time
ms.assetid: 3a5daefd-08a8-4565-b54f-28ad01a47d32
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 0c71ff6e75cbbf27042c1eac70b1f97076290865
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87635674"
---
# <a name="restore-a-sql-server-database-to-a-point-in-time-full-recovery-model"></a><span data-ttu-id="d8e0d-102">Ripristino di un database di SQL Server fino a un punto specifico all'interno di un backup (modello di recupero con registrazione completa)</span><span class="sxs-lookup"><span data-stu-id="d8e0d-102">Restore a SQL Server Database to a Point in Time (Full Recovery Model)</span></span>
  <span data-ttu-id="d8e0d-103">In questo argomento viene descritto il ripristino temporizzato di un database [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] mediante l'utilizzo di [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] o [!INCLUDE[tsql](../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d8e0d-103">This topic describes how to restore a database to a point in time in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../includes/tsql-md.md)].</span></span> <span data-ttu-id="d8e0d-104">Le informazioni contenute in questo argomento sono rilevanti solo per i database [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] in cui viene utilizzato il modello di recupero con registrazione completa o con registrazione minima delle operazioni bulk.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-104">This topic is relevant only for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases that use the full or bulk-logged recovery models.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d8e0d-105">Nel modello di recupero con registrazione minima delle operazioni bulk se un backup del log contiene modifiche con registrazione minima delle operazioni bulk, il recupero temporizzato non è possibile rispetto a un punto all'interno di tale backup.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-105">Under the bulk-logged recovery model, if a log backup contains bulk-logged changes, point-in-time recovery is not possible to a point within that backup.</span></span> <span data-ttu-id="d8e0d-106">È necessario recuperare il database fino alla fine del backup del log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-106">The database must be recovered to the end of the transaction log backup.</span></span>  
  
-   <span data-ttu-id="d8e0d-107">**Prima di iniziare:**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-107">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="d8e0d-108">Indicazioni</span><span class="sxs-lookup"><span data-stu-id="d8e0d-108">Recommendations</span></span>](#Recommendations)  
  
     [<span data-ttu-id="d8e0d-109">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="d8e0d-109">Security</span></span>](#Security)  
  
-   <span data-ttu-id="d8e0d-110">**Per ripristinare un database di SQL Server in un punto nel tempo mediante:**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-110">**To restore a SQL Server database to a point in time, using:**</span></span>  
  
     [<span data-ttu-id="d8e0d-111">SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d8e0d-111">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="d8e0d-112">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d8e0d-112">Transact-SQL</span></span>](#TsqlProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="d8e0d-113">Prima di iniziare</span><span class="sxs-lookup"><span data-stu-id="d8e0d-113">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="d8e0d-114">Raccomandazioni</span><span class="sxs-lookup"><span data-stu-id="d8e0d-114">Recommendations</span></span>  
  
-   <span data-ttu-id="d8e0d-115">Utilizzo dell'opzione STANDBY per la ricerca di un punto sconosciuto nel tempo</span><span class="sxs-lookup"><span data-stu-id="d8e0d-115">Use STANDBY to find unknown point in time.</span></span>  
  
-   <span data-ttu-id="d8e0d-116">Impostazione del punto nel tempo all'inizio di una sequenza di ripristino</span><span class="sxs-lookup"><span data-stu-id="d8e0d-116">Specify the point in time early in a restore sequence</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="d8e0d-117">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="d8e0d-117">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="d8e0d-118">Autorizzazioni</span><span class="sxs-lookup"><span data-stu-id="d8e0d-118">Permissions</span></span>  
 <span data-ttu-id="d8e0d-119">Se il database da ripristinare non esiste, per eseguire un'operazione RESTORE l'utente deve disporre delle autorizzazioni CREATE DATABASE.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-119">If the database being restored does not exist, the user must have CREATE DATABASE permissions to be able to execute RESTORE.</span></span> <span data-ttu-id="d8e0d-120">Se il database esiste, le autorizzazioni per l'istruzione RESTORE vengono assegnate per impostazione predefinita ai membri dei ruoli predefiniti del server **sysadmin** e **dbcreator** e al proprietario (**dbo**) del database. Per l'opzione FROM DATABASE_SNAPSHOT, il database esiste sempre.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-120">If the database exists, RESTORE permissions default to members of the **sysadmin** and **dbcreator** fixed server roles and the owner (**dbo**) of the database (for the FROM DATABASE_SNAPSHOT option, the database always exists).</span></span>  
  
 <span data-ttu-id="d8e0d-121">Le autorizzazioni per l'istruzione RESTORE vengono assegnate ai ruoli in cui le informazioni sull'appartenenza sono sempre disponibili per il server.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-121">RESTORE permissions are given to roles in which membership information is always readily available to the server.</span></span> <span data-ttu-id="d8e0d-122">Poiché è possibile controllare l'appartenenza ai ruoli predefiniti del database solo quando il database è accessibile e non è danneggiato, condizioni che non risultano sempre vere quando si esegue un'operazione RESTORE, i membri del ruolo predefinito del database **db_owner** non dispongono delle autorizzazioni per l'istruzione RESTORE.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-122">Because fixed database role membership can be checked only when the database is accessible and undamaged, which is not always the case when RESTORE is executed, members of the **db_owner** fixed database role do not have RESTORE permissions.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="d8e0d-123">Con SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d8e0d-123">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="d8e0d-124">**Per ripristinare un database fino a un punto nel tempo**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-124">**To restore a database to a point in time**</span></span>  
  
1.  <span data-ttu-id="d8e0d-125">Stabilire una connessione all'istanza appropriata di [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)], quindi espandere l'albero di server in Esplora oggetti.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-125">In Object Explorer, connect to the appropriate instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)], and expand the server tree.</span></span>  
  
2.  <span data-ttu-id="d8e0d-126">Espandere **Database**.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-126">Expand **Databases**.</span></span> <span data-ttu-id="d8e0d-127">A seconda del database, selezionare un database utente oppure espandere **Database di sistema**e selezionare un database di sistema.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-127">Depending on the database, either select a user database or expand **System Databases**, and then select a system database.</span></span>  
  
3.  <span data-ttu-id="d8e0d-128">Fare clic con il pulsante destro del mouse sul database, scegliere **Attività**, selezionare **Ripristina**, quindi fare clic su **Database**.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-128">Right-click the database, point to **Tasks**, point to **Restore**, and then click **Database**.</span></span>  
  
4.  <span data-ttu-id="d8e0d-129">Per specificare l'origine e il percorso dei set di backup da ripristinare, nella pagina **Generale** , utilizzare la sezione **Origine** .</span><span class="sxs-lookup"><span data-stu-id="d8e0d-129">On the **General** page, use the **Source** section to specify the source and location of the backup sets to restore.</span></span> <span data-ttu-id="d8e0d-130">Selezionare una delle opzioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="d8e0d-130">Select one of the following options:</span></span>  
  
    -   <span data-ttu-id="d8e0d-131">**Database**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-131">**Database**</span></span>  
  
         <span data-ttu-id="d8e0d-132">Selezionare il database da ripristinare dall'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-132">Select the database to restore from the drop-down list.</span></span> <span data-ttu-id="d8e0d-133">Nell'elenco sono inclusi solo i database di cui è stato eseguito il backup in base alla cronologia dei backup di **msdb** .</span><span class="sxs-lookup"><span data-stu-id="d8e0d-133">The list contains only databases that have been backed up according to the **msdb** backup history.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d8e0d-134">Se il backup viene eseguito da un server diverso, il server di destinazione non disporrà delle informazioni della cronologia di backup per il database specificato.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-134">If the backup is taken from a different server, the destination server will not have the backup history information for the specified database.</span></span> <span data-ttu-id="d8e0d-135">In questo caso, selezionare **Dispositivo** per specificare manualmente il file o il dispositivo da ripristinare.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-135">In this case, select **Device** to manually specify the file or device to restore.</span></span>  
  
    -   <span data-ttu-id="d8e0d-136">**Dispositivo**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-136">**Device**</span></span>  
  
         <span data-ttu-id="d8e0d-137">Fare clic sul pulsante Sfoglia ( **...** ) per aprire la finestra di dialogo **Seleziona dispositivi di backup** .</span><span class="sxs-lookup"><span data-stu-id="d8e0d-137">Click the browse (**...**) button to open the **Select backup devices** dialog box.</span></span> <span data-ttu-id="d8e0d-138">Nella casella **Tipi di supporti di backup** selezionare uno dei tipi di dispositivi elencati.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-138">In the **Backup media type** box, select one of the listed device types.</span></span> <span data-ttu-id="d8e0d-139">Per selezionare uno o più dispositivi per la casella **Supporti di backup** , fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-139">To select one or more devices for the **Backup media** box, click **Add**.</span></span>  
  
         <span data-ttu-id="d8e0d-140">Dopo avere aggiunto i dispositivi desiderati nella casella di riepilogo **Dispositivi di backup** , fare clic su **OK** per tornare alla pagina **Generale** .</span><span class="sxs-lookup"><span data-stu-id="d8e0d-140">After you add the devices you want to the **Backup media** list box, click **OK** to return to the **General** page.</span></span>  
  
         <span data-ttu-id="d8e0d-141">Nella casella di riepilogo **Origine: Dispositivo: Database** selezionare il nome del database da ripristinare.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-141">In the **Source: Device: Database** list box, select the name of the database which should be restored.</span></span>  
  
         <span data-ttu-id="d8e0d-142">**Nota** Questo elenco è disponibile solo se si seleziona **Dispositivo** .</span><span class="sxs-lookup"><span data-stu-id="d8e0d-142">**Note** This list is only available when **Device** is selected.</span></span> <span data-ttu-id="d8e0d-143">Saranno disponibili solo i database che dispongono di backup sul dispositivo selezionato.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-143">Only databases that have backups on the selected device will be available.</span></span>  
  
5.  <span data-ttu-id="d8e0d-144">Nella sezione **Destinazione** , la casella **Database** viene popolata automaticamente con il nome del database da ripristinare.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-144">In the **Destination** section, the **Database** box is automatically populated with the name of the database to be restored.</span></span> <span data-ttu-id="d8e0d-145">Per modificare il nome del database, immettere il nome nuovo nella casella **Database** .</span><span class="sxs-lookup"><span data-stu-id="d8e0d-145">To change the name of the database, enter the new name in the **Database** box.</span></span>  
  
6.  <span data-ttu-id="d8e0d-146">Fare clic su **Sequenza temporale** per accedere alla finestra di dialogo **Sequenza temporale backup** .</span><span class="sxs-lookup"><span data-stu-id="d8e0d-146">Click **Timeline** to access the **Backup Timeline** dialog box.</span></span>  
  
7.  <span data-ttu-id="d8e0d-147">Nella sezione **Ripristina fino a** fare clic su **Data e ora specifiche**.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-147">In the **Restore to** section, click **Specific date and time**.</span></span>  
  
8.  <span data-ttu-id="d8e0d-148">Utilizzare le caselle **Data** e **Ora** o la barra del dispositivo di scorrimento per specificare una data e ora specifiche per l'arresto del ripristino.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-148">Use either the **Date** and **Time** boxes or the slider bar to specify a specific date and time to where the restore should stop.</span></span> [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
    > [!NOTE]  
    >  <span data-ttu-id="d8e0d-149">Usare la casella **Intervallo sequenza temporale** per modificare la quantità di tempo visualizzata nella sequenza temporale.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-149">Use the **Timeline Interval** box to change the amount of time displayed on the timeline.</span></span>  
  
9. <span data-ttu-id="d8e0d-150">Dopo aver specificato una determinata temporizzazione, tramite Database Recovery Advisor viene assicurato che nella colonna **Ripristina** della griglia **Set di backup da ripristinare** vengano selezionati solo i backup necessari per il ripristino fino a quella temporizzazione.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-150">After you have specified a specific point in time, the Database Recovery Advisor ensures that only backups that are required for restoring to that point in time are selected in the **Restore** column of the **Backup sets to restore** grid.</span></span> <span data-ttu-id="d8e0d-151">Questi backup selezionati costituiscono il piano di ripristino consigliato per il ripristino temporizzato.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-151">These selected backups make up the recommended restore plan for your point-in-time restore.</span></span> <span data-ttu-id="d8e0d-152">Per l'operazione di ripristino temporizzato è consigliabile utilizzare solo i backup selezionati.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-152">You should use only the selected backups for your point-in-time restore operation.</span></span>  
  
     <span data-ttu-id="d8e0d-153">Per informazioni sulle colonne nella griglia **Selezionare i set di backup da ripristinare** , vedere [Ripristina database &#40;pagina Generale&#41;](../../integration-services/general-page-of-integration-services-designers-options.md).</span><span class="sxs-lookup"><span data-stu-id="d8e0d-153">For information about the columns in the **Backup sets to restore** grid, see [Restore Database &#40;General Page&#41;](../../integration-services/general-page-of-integration-services-designers-options.md).</span></span> <span data-ttu-id="d8e0d-154">Per informazioni su Database Recovery Advisor, vedere [Panoramica del ripristino e del recupero &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d8e0d-154">For information about the Database Recovery Advisor, see [Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span></span>  
  
10. <span data-ttu-id="d8e0d-155">Nella pagina **Opzioni** del pannello **Opzioni di ripristino** è possibile selezionare una qualsiasi delle opzioni seguenti, in base alla situazione:</span><span class="sxs-lookup"><span data-stu-id="d8e0d-155">On the **Options** page, in the **Restore options** panel, you can select any of the following options, if appropriate for your situation:</span></span>  
  
    -   <span data-ttu-id="d8e0d-156">**Sovrascrivi il database esistente (WITH REPLACE)**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-156">**Overwrite the existing database (WITH REPLACE)**</span></span>  
  
    -   <span data-ttu-id="d8e0d-157">**Mantieni le impostazioni di replica (WITH KEEP_REPLICATION)**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-157">**Preserve the replication settings (WITH KEEP_REPLICATION)**</span></span>  
  
    -   <span data-ttu-id="d8e0d-158">**Limita accesso al database ripristinato (WITH RESTRICTED_USER)**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-158">**Restrict access to the restored database (WITH RESTRICTED_USER)**</span></span>  
  
     <span data-ttu-id="d8e0d-159">Per altre informazioni su queste opzioni, vedere [Ripristina database &#40;(pagina Opzioni)&#41;](restore-database-options-page.md).</span><span class="sxs-lookup"><span data-stu-id="d8e0d-159">For more information about these options, see [Restore Database &#40;Options Page&#41;](restore-database-options-page.md).</span></span>  
  
11. <span data-ttu-id="d8e0d-160">Selezionare un'opzione per la casella **Stato di recupero** .</span><span class="sxs-lookup"><span data-stu-id="d8e0d-160">Select an option for the **Recovery state** box.</span></span> <span data-ttu-id="d8e0d-161">Questa casella determina lo stato del database al termine dell'operazione di ripristino.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-161">This box determines the state of the database after the restore operation.</span></span>  
  
    -   <span data-ttu-id="d8e0d-162">**RESTORE WITH RECOVERY** è il comportamento predefinito che lascia il database pronto per l'utilizzo mediante il rollback delle transazioni di cui non è stato eseguito il commit.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-162">**RESTORE WITH RECOVERY** is the default behavior which leaves the database ready for use by rolling back the uncommitted transactions.</span></span> <span data-ttu-id="d8e0d-163">I log delle transazioni aggiuntivi non possono essere ripristinati.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-163">Additional transaction logs cannot be restored.</span></span> <span data-ttu-id="d8e0d-164">Selezionare questa opzione se si desidera ripristinare subito tutti i backup necessari.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-164">Select this option if you are restoring all of the necessary backups now.</span></span>  
  
    -   <span data-ttu-id="d8e0d-165">**RESTORE WITH NORECOVERY** lascia il database non operativo e non esegue il rollback delle transazioni di cui non è stato eseguito il commit.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-165">**RESTORE WITH NORECOVERY** which leaves the database non-operational, and does not roll back the uncommitted transactions.</span></span> <span data-ttu-id="d8e0d-166">I log delle transazioni aggiuntivi possono essere ripristinati.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-166">Additional transaction logs can be restored.</span></span> <span data-ttu-id="d8e0d-167">Non è possibile utilizzare il database fino al completamento del recupero.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-167">The database cannot be used until it is recovered.</span></span>  
  
    -   <span data-ttu-id="d8e0d-168">**RESTORE WITH STANDBY** lascia il database in modalità di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-168">**RESTORE WITH STANDBY** which leaves the database in read-only mode.</span></span> <span data-ttu-id="d8e0d-169">Annulla le transazioni di cui non è stato eseguito il commit, ma salva le azioni di rollback in un file standby in modo che gli effetti del recupero possano essere annullati.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-169">It undoes uncommitted transactions, but saves the undo actions in a standby file so that recovery effects can be reverted.</span></span>  
  
     <span data-ttu-id="d8e0d-170">Per una descrizione delle opzioni, vedere [Ripristina database &#40;pagina Opzioni&#41;](restore-database-options-page.md).</span><span class="sxs-lookup"><span data-stu-id="d8e0d-170">For descriptions of the options, see [Restore Database &#40;Options Page&#41;](restore-database-options-page.md).</span></span>  
  
12. <span data-ttu-id="d8e0d-171">**Esegui il backup della parte finale del log prima del ripristino** verrà selezionato se necessario per il punto nel tempo selezionato.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-171">**Take tail-log backup before restore** will be selected if it is necessary for the point in time that you have selected.</span></span> <span data-ttu-id="d8e0d-172">Non è necessario modificare questa impostazione, ma è possibile scegliere di eseguire il backup della parte finale del log, anche se non è richiesto.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-172">You do not need to modify this setting, but you can choose to backup the tail of the log even if it is not required.</span></span>  
  
13. <span data-ttu-id="d8e0d-173">Le operazioni di ripristino potrebbero non riuscire in presenza di connessioni attive al database.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-173">Restore operations may fail if there are active connections to the database.</span></span> <span data-ttu-id="d8e0d-174">Selezionare l'opzione **Chiudi connessioni esistenti** per garantire che tutte le connessioni attive tra [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] e il database vengano chiuse.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-174">Check the **Close existing connections option** to ensure that all active connections between [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] and the database are closed.</span></span> <span data-ttu-id="d8e0d-175">Questa casella di controllo imposta il database sulla modalità utente singolo prima di effettuare qualsiasi operazione di ripristino e imposta il database sulla modalità multiutente al termine.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-175">This check box sets the database to single user mode before performing the restore operations, and sets the database to multi-user mode when complete.</span></span>  
  
14. <span data-ttu-id="d8e0d-176">Selezionare **Chiedi conferma prima del ripristino di ogni backup** se si desidera ricevere una richiesta di conferma prima di ciascuna operazione di ripristino.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-176">Select **Prompt before restoring each backup** if you wish to be prompted between each restore operation.</span></span> <span data-ttu-id="d8e0d-177">L'operazione non è normalmente necessaria, a meno che le dimensioni del database siano elevate e si desideri monitorare lo stato dell'operazione di ripristino.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-177">This is not usually necessary unless the database is large and you wish to monitor the status of the restore operation.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="d8e0d-178">Con Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d8e0d-178">Using Transact-SQL</span></span>  
 <span data-ttu-id="d8e0d-179">**Prima di iniziare**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-179">**Before you begin**</span></span>  
  
 <span data-ttu-id="d8e0d-180">Un momento specifico viene sempre ripristinato da un backup del log.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-180">A specified time is always restored from a log backup.</span></span> <span data-ttu-id="d8e0d-181">In ogni istruzione RESTORE LOG della sequenza di ripristino, è necessario specificare l'ora o la transazione di destinazione in una clausola STOPAT identica.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-181">In every RESTORE LOG statement of the restore sequence, you must specify your target time or transaction in an identical STOPAT clause.</span></span> <span data-ttu-id="d8e0d-182">Come prerequisito per un ripristino temporizzato, è necessario innanzitutto ripristinare un backup completo del database il cui endpoint sia precedente rispetto al momento di ripristino di destinazione.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-182">As a prerequisite to a point-in-time restore, you must first restore a full database backup whose end point is earlier than your target restore time.</span></span> <span data-ttu-id="d8e0d-183">Il backup completo del database può essere precedente rispetto al backup completo del database più recente purché vengano ripristinati tutti i backup del log successivi, fino al backup del log contenente la data e ora specifica di destinazione compreso.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-183">That full database backup can be older than the most recent full database backup as long as you then restore every subsequent log backup, up to and including the log backup that contains your target point in time.</span></span>  
  
 <span data-ttu-id="d8e0d-184">Per consentire l'identificazione del backup del database da ripristinare, è possibile specificare la clausola WITH STOPAT nell'istruzione RESTORE DATABASE per generare un errore se un backup dei dati è troppo recente rispetto alla data e ora specifica di destinazione.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-184">To help you identify which database backup to restore, you can optionally specify your WITH STOPAT clause in your RESTORE DATABASE statement to raise an error if a data backup is too recent for the specified target time.</span></span> <span data-ttu-id="d8e0d-185">Il backup completo dei dati viene sempre ripristinato, anche se contiene la data e ora specifica di destinazione.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-185">The complete data backup is always restored, even if it contains the target time.</span></span>  
  
 <span data-ttu-id="d8e0d-186">**Sintassi [!INCLUDE[tsql](../../includes/tsql-md.md)] di base**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-186">**Basic [!INCLUDE[tsql](../../includes/tsql-md.md)] syntax**</span></span>  
  
 <span data-ttu-id="d8e0d-187">Ripristinare *database_name* di log da <backup_device> con STOPAT \*\* = *`time`* ,\*\* ripristino...</span><span class="sxs-lookup"><span data-stu-id="d8e0d-187">RESTORE LOG *database_name* FROM <backup_device> WITH STOPAT **=*`time`*,** RECOVERY...</span></span>  
  
 <span data-ttu-id="d8e0d-188">Il punto di recupero è l'ultimo commit della transazione che si è verificato in corrispondenza o prima del `datetime` valore specificato da *Time*.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-188">The recovery point is the latest transaction commit that occurred at or before the `datetime` value that is specified by *time*.</span></span>  
  
 <span data-ttu-id="d8e0d-189">Per ripristinare solo le modifiche apportate prima di determinato momento, specificare WITH STOPAT **=** *ora* per ogni backup da ripristinare.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-189">To restore only the modifications that were made before a specific point in time, specify WITH STOPAT **=** *time* for each backup you restore.</span></span> <span data-ttu-id="d8e0d-190">Questo garantisce che il momento nel tempo desiderato non venga superato.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-190">This makes sure that you do not go past the target time.</span></span>  
  
 <span data-ttu-id="d8e0d-191">**Per ripristinare un database fino a un punto nel tempo**</span><span class="sxs-lookup"><span data-stu-id="d8e0d-191">**To restore a database to a point in time**</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d8e0d-192">Per un esempio di questa procedura, vedere [Esempio (Transact-SQL)](#TsqlExample)più avanti in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-192">For an example of this procedure, see [Example (Transact-SQL)](#TsqlExample), later in this section.</span></span>  
  
1.  <span data-ttu-id="d8e0d-193">Connettersi all'istanza del server in cui si desidera ripristinare il database.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-193">Connect to server instance on which you want to restore the database.</span></span>  
  
2.  <span data-ttu-id="d8e0d-194">Eseguire l'istruzione RESTORE DATABASE utilizzando l'opzione NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-194">Execute the RESTORE DATABASE statement using the NORECOVERY option.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d8e0d-195">Se una sequenza di ripristino parziale esclude qualsiasi filegroup [FILESTREAM](../blob/filestream-sql-server.md) , il ripristino temporizzato non è supportato.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-195">If a partial restore sequence excludes any [FILESTREAM](../blob/filestream-sql-server.md) filegroup, point-in-time restore is not supported.</span></span> <span data-ttu-id="d8e0d-196">È possibile forzare la continuazione della sequenza di ripristino.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-196">You can force the restore sequence to continue.</span></span> <span data-ttu-id="d8e0d-197">Tuttavia i filegroup FILESTREAM omessi dall'istruzione RESTORE non potranno mai più essere ripristinati.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-197">However the FILESTREAM filegroups that are omitted from your RESTORE statement can never be restored.</span></span> <span data-ttu-id="d8e0d-198">Per forzare un ripristino temporizzato, specificare l'opzione CONTINUE_AFTER_ERROR insieme all'opzione STOPAT, STOPATMARK o STOPBEFOREMARK che è necessario specificare anche nelle istruzioni RESTORE LOG successive.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-198">To force a point-in-time restore, specify the CONTINUE_AFTER_ERROR option together with the STOPAT, STOPATMARK, or STOPBEFOREMARK option, which you must also specify in your subsequent RESTORE LOG statements.</span></span> <span data-ttu-id="d8e0d-199">Se si specifica CONTINUE_AFTER_ERROR, la sequenza di ripristino parziale ha esito positivo e il filegroup FILESTREAM non può più essere recuperato.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-199">If you specify CONTINUE_AFTER_ERROR, the partial restore sequence succeeds and the FILESTREAM filegroup becomes unrecoverable.</span></span>  
  
3.  <span data-ttu-id="d8e0d-200">Ripristinare l'ultimo backup del database differenziale, se presente, senza recuperare il database (RESTORE DATABASE *database_name* FROM *backup_device* WITH NORECOVERY).</span><span class="sxs-lookup"><span data-stu-id="d8e0d-200">Restore the last differential database backup, if any,  without recovering the database (RESTORE DATABASE *database_name* FROM *backup_device* WITH NORECOVERY).</span></span>  
  
4.  <span data-ttu-id="d8e0d-201">Applicare ogni backup del log delle transazioni nella stessa sequenza in cui sono stati creati, specificando l'ora in cui si intende arrestare il ripristino del log (Restore database *database_name* da <backup_device> con STOPAT\*\* = *`time`* ,\*\* Recovery).</span><span class="sxs-lookup"><span data-stu-id="d8e0d-201">Apply each transaction log backup in the same sequence in which they were created, specifying the time at which you intend to stop restoring log (RESTORE DATABASE *database_name* FROM <backup_device> WITH STOPAT**=*`time`*,** RECOVERY).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d8e0d-202">Le opzioni RECOVERY e STOPAT.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-202">The RECOVERY and STOPAT options.</span></span> <span data-ttu-id="d8e0d-203">Se il backup del log delle transazioni non contiene i dati corrispondenti all'ora richiesta, ad esempio se l'ora specificata è successiva al periodo di tempo gestito dal log delle transazioni, viene generato un messaggio di avviso e il database non viene recuperato.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-203">If the transaction log backup does not contain the requested time (for example, if the time specified is beyond the end of the time covered by the transaction log), a warning is generated and the database remains unrecovered.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="d8e0d-204">Esempio (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="d8e0d-204">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="d8e0d-205">Nell'esempio seguente viene ripristinato lo stato del database corrispondente alle ore `12:00 AM` del giorno `April 15, 2020` e viene illustrata un'operazione di ripristino di più backup del log.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-205">The following example restores a database to its state as of `12:00 AM` on `April 15, 2020` and shows a restore operation that involves multiple log backups.</span></span> <span data-ttu-id="d8e0d-206">Nel dispositivo di backup, `AdventureWorksBackups`, il backup completo del database da ripristinare è il terzo set di backup (`FILE = 3`), il primo backup del log è il quarto set di backup (`FILE = 4`) e il secondo backup del log è il quinto set di backup (`FILE = 5`).</span><span class="sxs-lookup"><span data-stu-id="d8e0d-206">On the backup device, `AdventureWorksBackups`, the full database backup to be restored is the third backup set on the device (`FILE = 3`), the first log backup is the fourth backup set (`FILE = 4`), and the second log backup is the fifth backup set (`FILE = 5`).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d8e0d-207">Il database [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] utilizza il modello di recupero con registrazione minima.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-207">The [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database uses the simple recovery model.</span></span> <span data-ttu-id="d8e0d-208">Per consentire i backup del log, prima di eseguire un backup completo del database, il database viene impostato per l'utilizzo del modello di recupero con registrazione completa tramite `ALTER DATABASE AdventureWorks SET RECOVERY FULL`.</span><span class="sxs-lookup"><span data-stu-id="d8e0d-208">To permit log backups, before taking a full database backup, the database was set to use the full recovery model, using `ALTER DATABASE AdventureWorks SET RECOVERY FULL`.</span></span>  
  
```  
RESTORE DATABASE AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=3, NORECOVERY;  
  
RESTORE LOG AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=4, NORECOVERY, STOPAT = 'Apr 15, 2020 12:00 AM';  
  
RESTORE LOG AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=5, NORECOVERY, STOPAT = 'Apr 15, 2020 12:00 AM';  
RESTORE DATABASE AdventureWorks WITH RECOVERY;   
GO  
  
```  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="d8e0d-209">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="d8e0d-209">Related Tasks</span></span>  
  
-   [<span data-ttu-id="d8e0d-210">Ripristinare un backup del database &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="d8e0d-210">Restore a Database Backup &#40;SQL Server Management Studio&#41;</span></span>](restore-a-database-backup-using-ssms.md)  
  
-   [<span data-ttu-id="d8e0d-211">Eseguire il backup di un log delle transazioni &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d8e0d-211">Back Up a Transaction Log &#40;SQL Server&#41;</span></span>](back-up-a-transaction-log-sql-server.md)  
  
-   [<span data-ttu-id="d8e0d-212">Ripristinare un database fino al punto di errore nel modello di recupero con registrazione completa &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d8e0d-212">Restore a Database to the Point of Failure Under the Full Recovery Model &#40;Transact-SQL&#41;</span></span>](restore-database-to-point-of-failure-full-recovery.md)  
  
-   [<span data-ttu-id="d8e0d-213">Ripristinare un database fino a una transazione contrassegnata &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="d8e0d-213">Restore a Database to a Marked Transaction &#40;SQL Server Management Studio&#41;</span></span>](restore-a-database-to-a-marked-transaction-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="d8e0d-214">Recupero fino a un numero di sequenza del file di log &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d8e0d-214">Recover to a Log Sequence Number &#40;SQL Server&#41;</span></span>](recover-to-a-log-sequence-number-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="d8e0d-215">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="d8e0d-215">See Also</span></span>  
 <span data-ttu-id="d8e0d-216">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d8e0d-216">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span></span>  
 <span data-ttu-id="d8e0d-217">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d8e0d-217">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 [<span data-ttu-id="d8e0d-218">RESTORE HEADERONLY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d8e0d-218">RESTORE HEADERONLY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-headeronly-transact-sql)  
  
  
