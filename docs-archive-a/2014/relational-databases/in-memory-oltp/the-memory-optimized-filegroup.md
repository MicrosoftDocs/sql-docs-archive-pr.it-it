---
title: Filegroup con ottimizzazione per la memoria | Microsoft Docs
ms.custom: ''
ms.date: 11/19/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 14106cc9-816b-493a-bcb9-fe66a1cd4630
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: a4ab6423159d0ba5a27af152cc5578905f57eec6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87637317"
---
# <a name="the-memory-optimized-filegroup"></a><span data-ttu-id="e8bc9-102">Filegroup con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="e8bc9-102">The Memory Optimized Filegroup</span></span>
  <span data-ttu-id="e8bc9-103">Per creare tabelle ottimizzate per la memoria, è necessario creare prima un filegroup ottimizzato per la memoria.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-103">To create memory-optimized tables, you must first create a memory-optimized filegroup.</span></span> <span data-ttu-id="e8bc9-104">Nel filegroup ottimizzato per la memoria è presente uno o più contenitori.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-104">The memory-optimized filegroup holds one or more containers.</span></span> <span data-ttu-id="e8bc9-105">Ogni contenitore include file di dati o file differenziali o entrambi.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-105">Each container contains data files or delta files or both.</span></span>  
  
 <span data-ttu-id="e8bc9-106">Anche se le righe di dati delle tabelle `SCHEMA_ONLY` non sono persistenti e i metadati per le tabelle ottimizzate per la memoria e le stored procedure compilate a livello nativo vengono archiviati nei cataloghi tradizionali, il motore [!INCLUDE[hek_2](../../includes/hek-2-md.md)] richiede comunque un filegroup ottimizzato per la memoria per le tabelle ottimizzate per la memoria `SCHEMA_ONLY` per fornire un'esperienza uniforme per i database con tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-106">Even though data rows from `SCHEMA_ONLY` tables are not persisted and the metadata for memory-optimized tables and natively compiled stored procedures is stored in the traditional catalogs, the [!INCLUDE[hek_2](../../includes/hek-2-md.md)] engine still requires a memory-optimized filegroup for `SCHEMA_ONLY` memory-optimized tables to provide a uniform experience for databases with memory-optimized tables.</span></span>  
  
 <span data-ttu-id="e8bc9-107">Il filegroup ottimizzato per la memoria è basato sul filegroup filestream, con le differenze seguenti:</span><span class="sxs-lookup"><span data-stu-id="e8bc9-107">The memory-optimized filegroup is based on filestream filegroup, with the following differences:</span></span>  
  
-   <span data-ttu-id="e8bc9-108">È possibile creare un solo filegroup ottimizzato per la memoria per database.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-108">You can only create one memory-optimized filegroup per database.</span></span> <span data-ttu-id="e8bc9-109">È necessario contrassegnare in modo esplicito il filegroup come contenente memory_optimized_data.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-109">You need to explicitly mark the filegroup as containing memory_optimized_data.</span></span> <span data-ttu-id="e8bc9-110">È possibile creare il filegroup durante la creazione del database o è possibile aggiungerlo successivamente:</span><span class="sxs-lookup"><span data-stu-id="e8bc9-110">You can create the filegroup when you create the database or you can add it later:</span></span>  
  
    ```sql  
    ALTER DATABASE imoltp ADD FILEGROUP imoltp_mod CONTAINS MEMORY_OPTIMIZED_DATA  
    ```  
  
-   <span data-ttu-id="e8bc9-111">È necessario aggiungere uno o più contenitori al filegroup MEMORY_OPTIMIZED_DATA.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-111">You need to add one or more containers to the MEMORY_OPTIMIZED_DATA filegroup.</span></span> <span data-ttu-id="e8bc9-112">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="e8bc9-112">For example:</span></span>  
  
    ```sql  
    ALTER DATABASE imoltp ADD FILE (name='imoltp_mod1', filename='c:\data\imoltp_mod1') TO FILEGROUP imoltp_mod  
    ```  
  
-   <span data-ttu-id="e8bc9-113">Non è necessario abilitare il filestream ([Abilitare e configurare FILESTREAM](../blob/enable-and-configure-filestream.md)) per creare un filegroup ottimizzato per la memoria.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-113">You do not need to enable filestream ([Enable and Configure FILESTREAM](../blob/enable-and-configure-filestream.md)) to create a memory-optimized filegroup.</span></span> <span data-ttu-id="e8bc9-114">Il mapping al filestream viene eseguito dal motore [!INCLUDE[hek_2](../../includes/hek-2-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e8bc9-114">The mapping to filestream is done by the [!INCLUDE[hek_2](../../includes/hek-2-md.md)] engine.</span></span>  
  
-   <span data-ttu-id="e8bc9-115">È possibile aggiungere nuovi contenitori a un filegroup ottimizzato per la memoria.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-115">You can add new containers to a memory-optimized filegroup.</span></span> <span data-ttu-id="e8bc9-116">Potrebbe essere necessario un nuovo contenitore per espandere lo spazio di archiviazione necessario per la tabella ottimizzata per la memoria durevole e anche per distribuire I/O tra più contenitori.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-116">You may need a new container to expand the storage needed for durable memory-optimized table and also to distribute I/O across multiple containers.</span></span>  
  
-   <span data-ttu-id="e8bc9-117">Lo spostamento di dati a un filegroup ottimizzato per la memoria è ottimizzato in una configurazione del gruppo di disponibilità AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-117">Data movement with a memory-optimized filegroup is optimized in an AlwaysOn Availability Group configuration.</span></span> <span data-ttu-id="e8bc9-118">Diversamente dai file filestream inviati alle repliche secondarie, i file del checkpoint (dati e differenziali) nel filegroup ottimizzato per la memoria non vengono inviati alle repliche secondarie.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-118">Unlike filestream files that are sent to secondary replicas, the checkpoint files (both data and delta) within the memory-optimized filegroup are not sent to secondary replicas.</span></span> <span data-ttu-id="e8bc9-119">I file di dati e differenziali vengono costruiti utilizzando il log delle transazioni sulla replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-119">The data and delta files are constructed using the transaction log on the secondary replica.</span></span>  
  
<span data-ttu-id="e8bc9-120">Di seguito sono riportate le limitazioni del filegroup ottimizzato per la memoria.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-120">The following limitations of memory-optimized filegroup,</span></span>  
  
-   <span data-ttu-id="e8bc9-121">Dopo aver creato un filegroup ottimizzato per la memoria è possibile rimuoverlo solo eliminando il database.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-121">Once you create a memory-optimized filegroup, you can only remove it by dropping the database.</span></span> <span data-ttu-id="e8bc9-122">In un ambiente di produzione, è improbabile che si renda necessario rimuovere il filegroup ottimizzato per la memoria.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-122">In a production environment, it is unlikely that you will need to remove the memory-optimized filegroup.</span></span>  
  
-   <span data-ttu-id="e8bc9-123">Non è possibile eliminare un contenitore non vuoto o spostare le coppie di file di dati e differenziali in un altro contenitore del filegroup ottimizzato per la memoria.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-123">You cannot drop a non-empty container or move data and delta file pairs to another container in the memory-optimized filegroup.</span></span>  
  
## <a name="configuring-a-memory-optimized-filegroup"></a><span data-ttu-id="e8bc9-124">Configurazione di un filegroup con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="e8bc9-124">Configuring a Memory-Optimized Filegroup</span></span>  
<span data-ttu-id="e8bc9-125">Creare più contenitori nel filegroup ottimizzato per la memoria e distribuirli in unità differenti per ottenere più larghezza di banda per trasmettere i dati in memoria.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-125">Consider creating multiple containers in the memory-optimized filegroup and distribute them on different drives to achieve more bandwidth to stream the data into memory.</span></span>  
  
<span data-ttu-id="e8bc9-126">Nel configurare l'archiviazione, è necessario fornire uno spazio libero su disco quattro volte superiore alla dimensione delle tabelle ottimizzate per la memoria durevoli.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-126">When configuring storage, you must provide free disk space that is four times the size of durable memory-optimized tables.</span></span> <span data-ttu-id="e8bc9-127">Verificare che il sottosistema di I/O supporti le operazioni di IOPS necessarie per il carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-127">Ensure that your I/O subsystem supports the required IOPS for your workload.</span></span> <span data-ttu-id="e8bc9-128">Se le coppie di file di dati e differenziali vengono popolati in un'operazione di IOPS specifica, tale IOPS è necessaria tre volte per le operazioni di merge e archiviazione.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-128">If data and delta file pairs are populated at a given IOPS, you need three times that IOPS to account for storing and merge operations.</span></span> <span data-ttu-id="e8bc9-129">È possibile aggiungere capacità di archiviazione e IOPS aggiungendo uno o più contenitori al filegroup ottimizzato per la memoria.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-129">You can add storage capacity and IOPS by adding one or more containers to the memory-optimized filegroup.</span></span>  
  
<span data-ttu-id="e8bc9-130">In uno scenario con più contenitori e più unità, i file di dati e differenziali vengono allocati in contenitori con un meccanismo round robin.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-130">In a multiple container, multiple drive scenario, data and delta files are allocated in a round-robin fashion into containers.</span></span> <span data-ttu-id="e8bc9-131">Il primo file di dati viene allocato dal primo contenitore e il file differenziale viene allocato dal contenitore successivo e questo modello di allocazione si ripete.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-131">The first data file is allocated from the first container and the delta file is allocated from the next container and this allocation pattern repeats.</span></span> <span data-ttu-id="e8bc9-132">Questo schema di allocazione distribuisce i file di dati e differenziali uniformemente nei contenitori se si dispone di un numero dispari di unità, ciascuna con il mapping a un solo contenitore.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-132">This allocation scheme distributes data and delta files evenly across containers if you have an odd number of drives, each mapped to one container.</span></span> <span data-ttu-id="e8bc9-133">Tuttavia, se si dispone di un numero pari di unità, ciascuna con il mapping a un contenitore, è possibile che si verifichi un'archiviazione sbilanciata con i file di dati per cui è stato eseguito il mapping alle unità dispari e i file differenziali per cui è stato eseguito il mapping alle unità pari.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-133">However, if you have an even number of drives, each mapped to a container, it can result in imbalanced storage with data files mapped to odd drives and delta files mapped to even drives.</span></span> <span data-ttu-id="e8bc9-134">Per ottenere un flusso di I/O bilanciato durante il ripristino, provare a inserire coppie di file di dati e differenziali sullo stesso mandrino/archiviazione come descritto nell'esempio riportato di seguito.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-134">To obtain a balanced stream of I/O on recovery, consider placing pairs of data and delta files on the same spindles/storage as described in the example below.</span></span>  

> [!CAUTION]
> <span data-ttu-id="e8bc9-135">Se per il filegroup con ottimizzazione per la memoria è impostato un valore `MAXSIZE` e i file del checkpoint superano le dimensioni massime del contenitore, il database verrà contrassegnato come sospetto.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-135">If a `MAXSIZE` value is set for the memory-optimized filegroup, and checkpoint files exceed the max size of the container, then the database will become SUSPECT.</span></span>   
> <span data-ttu-id="e8bc9-136">In questo caso, non provare a impostare il database come OFFLINE o ONLINE, perché il database rimarrebbe nello stato RECOVERY_PENDING.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-136">In this case do not attempt to set the database OFFLINE and ONLINE, causing the database to stay in RECOVERY_PENDING state.</span></span>
  
### <a name="example"></a><span data-ttu-id="e8bc9-137">Esempio</span><span class="sxs-lookup"><span data-stu-id="e8bc9-137">Example</span></span> 
<span data-ttu-id="e8bc9-138">Si consideri un filegroup ottimizzato per la memoria con due contenitori: il contenitore 1 sull'unità X e il contenitore 2 sulle unità Y.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-138">Consider a memory-optimized filegroup with two containers: container 1 on drive X and container 2 on drives Y.</span></span>  
<span data-ttu-id="e8bc9-139">Dal momento che l'allocazione dei file di dati e differenziali viene eseguita in modo round robin, il contenitore 1 includerà solo file di dati e il contenitore 2 avrà solo file differenziali, generando una persistenza sbilanciata per l'archiviazione e le operazioni di input/output al secondo, in quanto i file di dati sono molto più grandi dei file differenziali.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-139">Since the allocation of data and delta files is done in round-robin fashion, container 1 will only have data files and container 2 will only have delta files, which leads to imbalanced persistence for storage as well as input/output operations per second, as data files are significantly larger than the delta files.</span></span>    
<span data-ttu-id="e8bc9-140">Per distribuire i file di dati e differenziali in modo uniforme tra le unità X e Y, creare quattro contenitori anziché due ed eseguire il mapping dei primi due contenitori all'unità X e dei due contenitori successivi per l'unità Y.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-140">To distribute data and delta files uniformly across drives X and Y, create four containers instead of two, and map the first two containers to drive X and the next two containers to drive Y.</span></span>  
<span data-ttu-id="e8bc9-141">Con l'allocazione round robin, i primi dati e il primo file differenziale verranno allocati rispettivamente dal contenitore-1 e dal contenitore-2, mappati all'unità X.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-141">With round-robin allocation, the first data and first delta file will be allocated from container-1 and container-2 respectively, which are mapped to drive X.</span></span>   
<span data-ttu-id="e8bc9-142">Analogamente, il file di dati e differenziali successivi verrà allocato da container-3 e container-4, mappati all'unità Y. In questo modo è possibile distribuire uniformemente i file di dati e differenziali in due unità.</span><span class="sxs-lookup"><span data-stu-id="e8bc9-142">Similarly, the next data and delta file will be allocated from container-3 and container-4 which are mapped to drive Y. This allows distributing data and delta files across two drives uniformly.</span></span>  
 
  
## <a name="see-also"></a><span data-ttu-id="e8bc9-143">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="e8bc9-143">See Also</span></span>  
<span data-ttu-id="e8bc9-144">[Creazione e gestione dell'archiviazione per gli oggetti con ottimizzazione per la memoria](creating-and-managing-storage-for-memory-optimized-objects.md)   </span><span class="sxs-lookup"><span data-stu-id="e8bc9-144">[Creating and Managing Storage for Memory-Optimized Objects](creating-and-managing-storage-for-memory-optimized-objects.md)   </span></span>  
[<span data-ttu-id="e8bc9-145">Filegroup e file di database</span><span class="sxs-lookup"><span data-stu-id="e8bc9-145">Database Files and Filegroups</span></span>](../../relational-databases/databases/database-files-and-filegroups.md)    
  
