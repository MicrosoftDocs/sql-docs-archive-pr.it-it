---
title: Backup di un database con tabelle con ottimizzazione per la memoria | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 83d47694-e56d-4dae-b54e-14945bf8ba31
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 176448aa9d4bab4101ab2db12ffc9a8a7fd1a5b5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87624710"
---
# <a name="backing-up-a-database-with-memory-optimized-tables"></a><span data-ttu-id="34eab-102">Backup di un database con tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="34eab-102">Backing Up a Database with Memory-Optimized Tables</span></span>
  <span data-ttu-id="34eab-103">Il backup delle tabelle con ottimizzazione per la memoria viene eseguito durante i normali backup di database.</span><span class="sxs-lookup"><span data-stu-id="34eab-103">Memory-optimized tables are backed up as part of regular database backups.</span></span> <span data-ttu-id="34eab-104">Per le tabelle basate su disco, il CHECKSUM di coppie di file di dati e file differenziali viene convalidato durante il backup del database per rilevare eventuali danneggiamenti di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="34eab-104">As for disk-based tables, the CHECKSUM of data and delta file pairs is validated as part of the database backup to detect storage corruption.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="34eab-105">Durante il backup, se viene rilevato un errore di CHECKSUM in uno o più file in un filegroup ottimizzato per la memoria, non sarà possibile ripristinare e riavviare il database.</span><span class="sxs-lookup"><span data-stu-id="34eab-105">During a backup, if you detect a CHECKSUM error in one or more files in a memory-optimized filegroup, you will not be able to restore and restart the database.</span></span> <span data-ttu-id="34eab-106">In tal caso, è necessario ripristinare il database dall'ultima copia di backup valida nota.</span><span class="sxs-lookup"><span data-stu-id="34eab-106">In that situation, you must, restore your database with the last known good backup.</span></span> <span data-ttu-id="34eab-107">Se non è disponibile un backup, è possibile esportare i dati dalle tabelle ottimizzate per la memoria e dalle tabelle basate su disco e ricaricarli dopo aver eliminato e ricreato il database.</span><span class="sxs-lookup"><span data-stu-id="34eab-107">If you don't have a backup, you can export the data from memory-optimized tables and disk-based tables and reload after you drop and recreate the database.</span></span>  
  
 <span data-ttu-id="34eab-108">Un backup completo di un database con una o più tabelle ottimizzate per la memoria è costituito dall'archiviazione allocata per le tabelle basate su disco (se presente), dal log delle transazioni attivo e dalle coppie di file di dati e file differenziali (anche note come coppie di file di checkpoint) per le tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="34eab-108">A full backup of a database with one or more memory-optimized tables consists of the allocated storage for disk-based tables (if any), the active transaction log, and the data and delta file pairs (also known as checkpoint file pairs) for memory-optimized tables.</span></span> <span data-ttu-id="34eab-109">Tuttavia, come illustrato in [Durabilità per tabelle ottimizzate per la memoria](memory-optimized-tables.md), le dimensioni di archiviazione usate per le tabelle ottimizzate per la memoria possono essere di gran lunga superiori rispetto alle relative dimensioni in memoria e influiscono sulle dimensioni del backup del database.</span><span class="sxs-lookup"><span data-stu-id="34eab-109">However, as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md), the storage used by memory-optimized tables can be much larger than its size in memory, and it affects the size of the database backup.</span></span>  
  
## <a name="full-database-backup"></a><span data-ttu-id="34eab-110">Backup completo del database</span><span class="sxs-lookup"><span data-stu-id="34eab-110">Full Database Backup</span></span>  
 <span data-ttu-id="34eab-111">L'attenzione di questa discussione verrà posta sui backup di database per i database con solo tabelle ottimizzate per la memoria durevoli, dal momento che il backup per le tabelle basate su disco è lo stesso.</span><span class="sxs-lookup"><span data-stu-id="34eab-111">This discussion will focus on database backups for databases with just durable memory-optimized tables, because the backup for disk-based tables is the same.</span></span> <span data-ttu-id="34eab-112">Le coppie di file di checkpoint nel filegroup ottimizzato per la memoria possono trovarsi in vari stati.</span><span class="sxs-lookup"><span data-stu-id="34eab-112">The checkpoint file pairs in the memory-optimized filegroup could be in various states.</span></span> <span data-ttu-id="34eab-113">Nella tabella seguente vengono descritte le parti dei file di cui viene eseguito il backup.</span><span class="sxs-lookup"><span data-stu-id="34eab-113">The table below describes what part of the files is backed.</span></span>  
  
|<span data-ttu-id="34eab-114">Stato della coppia di file di checkpoint</span><span class="sxs-lookup"><span data-stu-id="34eab-114">Checkpoint File Pair State</span></span>|<span data-ttu-id="34eab-115">Backup</span><span class="sxs-lookup"><span data-stu-id="34eab-115">Backup</span></span>|  
|--------------------------------|------------|  
|<span data-ttu-id="34eab-116">PRECREATED</span><span class="sxs-lookup"><span data-stu-id="34eab-116">PRECREATED</span></span>|<span data-ttu-id="34eab-117">Solo metadati del file</span><span class="sxs-lookup"><span data-stu-id="34eab-117">File metadata only</span></span>|  
|<span data-ttu-id="34eab-118">UNDER CONSTRUCTION</span><span class="sxs-lookup"><span data-stu-id="34eab-118">UNDER CONSTRUCTION</span></span>|<span data-ttu-id="34eab-119">Solo metadati del file</span><span class="sxs-lookup"><span data-stu-id="34eab-119">File metadata only</span></span>|  
|<span data-ttu-id="34eab-120">Attivo</span><span class="sxs-lookup"><span data-stu-id="34eab-120">Active</span></span>|<span data-ttu-id="34eab-121">Metadati del file più i byte utilizzati</span><span class="sxs-lookup"><span data-stu-id="34eab-121">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="34eab-122">MERGE SOURCE</span><span class="sxs-lookup"><span data-stu-id="34eab-122">Merge source</span></span>|<span data-ttu-id="34eab-123">Metadati del file più i byte utilizzati</span><span class="sxs-lookup"><span data-stu-id="34eab-123">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="34eab-124">MERGE TARGET</span><span class="sxs-lookup"><span data-stu-id="34eab-124">Merge target</span></span>|<span data-ttu-id="34eab-125">Solo metadati del file</span><span class="sxs-lookup"><span data-stu-id="34eab-125">File metadata only</span></span>|  
|<span data-ttu-id="34eab-126">REQUIRED FOR BACKUP/HA</span><span class="sxs-lookup"><span data-stu-id="34eab-126">REQUIRED FOR BACKUP/HA</span></span>|<span data-ttu-id="34eab-127">Metadati del file più i byte utilizzati</span><span class="sxs-lookup"><span data-stu-id="34eab-127">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="34eab-128">IN TRANSITION TO TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="34eab-128">IN TRANSITION TO TOMBSTONE</span></span>|<span data-ttu-id="34eab-129">Solo metadati del file</span><span class="sxs-lookup"><span data-stu-id="34eab-129">File metadata only</span></span>|  
|<span data-ttu-id="34eab-130">TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="34eab-130">TOMBSTONE</span></span>|<span data-ttu-id="34eab-131">Solo metadati del file</span><span class="sxs-lookup"><span data-stu-id="34eab-131">File metadata only</span></span>|  
  
 <span data-ttu-id="34eab-132">Le dimensioni dei backup del database con una o più tabelle ottimizzate per la memoria sono in genere maggiori delle relative dimensioni in memoria ma inferiori all'archiviazione su disco.</span><span class="sxs-lookup"><span data-stu-id="34eab-132">The size of database backups with one or more memory-optimized tables is typically larger than its size in memory but smaller than the on-disk storage.</span></span> <span data-ttu-id="34eab-133">Le dimensioni aggiuntive dipendono dal numero di righe eliminate e dal numero di coppie di file di checkpoint negli stati MERGE SOURCE e REQUIRED FOR BACKUP/HA che dipendono indirettamente dal carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="34eab-133">The extra size will depend upon the number of deleted rows and the number of checkpoint file pairs in the states Merge source and REQUIRED FOR BACKUP/HA which indirectly depends upon the workload.</span></span> <span data-ttu-id="34eab-134">Per le descrizioni degli Stati delle coppie di file di checkpoint, vedere [sys. dm_db_xtp_checkpoint_files &#40;&#41;Transact-SQL ](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="34eab-134">For descriptions of the states for checkpoint file pairs, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>  
  
### <a name="estimating-size-of-full-database-backup"></a><span data-ttu-id="34eab-135">Stima delle dimensioni di un backup completo del database</span><span class="sxs-lookup"><span data-stu-id="34eab-135">Estimating Size of Full Database Backup</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="34eab-136">Si consiglia di non usare il valore BackupSizeInBytes per stimare la dimensione del backup per OLTP in memoria.</span><span class="sxs-lookup"><span data-stu-id="34eab-136">It's recommended that you not use the BackupSizeInBytes value to estimate the backup size for In-Memory OLTP.</span></span>  
  
 <span data-ttu-id="34eab-137">Il primo scenario di carico di lavoro è relativo (principalmente) all'operazione di inserimento.</span><span class="sxs-lookup"><span data-stu-id="34eab-137">The first workload scenario is for (mostly) insert.</span></span> <span data-ttu-id="34eab-138">In questo scenario, la maggior parte dei file di dati si trova nello stato Attivo, è completamente caricata e con pochissime righe eliminate.</span><span class="sxs-lookup"><span data-stu-id="34eab-138">In this scenario, most data files will be in the Active state, fully loaded, and with very few deleted rows.</span></span> <span data-ttu-id="34eab-139">Le dimensioni del backup del database si avvicineranno a quelle dei dati in memoria.</span><span class="sxs-lookup"><span data-stu-id="34eab-139">The size of database backup up will be close to the size of data in memory.</span></span>  
  
 <span data-ttu-id="34eab-140">Il secondo scenario di carico di lavoro è relativo a operazioni di inserimento, eliminazione e aggiornamento frequenti: nel peggiore dei casi, il carico di ognuna delle coppie di file di checkpoint è pari al 50%, dopo aver considerato le righe eliminate.</span><span class="sxs-lookup"><span data-stu-id="34eab-140">The second workload scenario is for frequent insert, delete, and update operations: In the worst case, each of the checkpoint file pairs are 50% loaded, after accounting for the deleted rows.</span></span> <span data-ttu-id="34eab-141">Pertanto, le dimensioni del backup del database saranno di almeno 2 volte quelle dei dati in memoria.</span><span class="sxs-lookup"><span data-stu-id="34eab-141">So the size of the database backup will at least be 2 times the size of data in memory.</span></span> <span data-ttu-id="34eab-142">Inoltre, saranno poche le coppie di file di checkpoint negli stati MERGE SOURCE e Required for backup/high availability che verranno aggiunte alle dimensioni del backup del database.</span><span class="sxs-lookup"><span data-stu-id="34eab-142">Additionally, there will few checkpoint file pairs in states Merge source and Required for backup/high availability that will add to the size of database backup.</span></span>  
  
## <a name="differential-backups-of-databases-with-memory-optimized-tables"></a><span data-ttu-id="34eab-143">Backup differenziali di database con tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="34eab-143">Differential Backups of Databases with Memory-Optimized Tables</span></span>  
 <span data-ttu-id="34eab-144">Lo spazio di archiviazione per le tabelle ottimizzate per la memoria è costituito da file di dati e differenziali come descritto in [Durabilità per tabelle ottimizzate per la memoria](memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="34eab-144">The storage for memory-optimized tables consists of data and delta files as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md).</span></span> <span data-ttu-id="34eab-145">Il backup differenziale di un database con tabelle ottimizzate per la memoria contiene i dati seguenti:</span><span class="sxs-lookup"><span data-stu-id="34eab-145">The differential backup of a database with memory-optimized tables contains the following data:</span></span>  
  
-   <span data-ttu-id="34eab-146">Il backup differenziale per i filegroup che archiviano le tabelle basate su disco non è interessato dalla presenza di tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="34eab-146">Differential backup for filegroups storing disk-based tables is not affected by the presence of memory-optimized tables.</span></span>  
  
-   <span data-ttu-id="34eab-147">Il log delle transazioni attivo è uguale a quello di un backup completo del database.</span><span class="sxs-lookup"><span data-stu-id="34eab-147">The active transaction log is the same as in a full database backup.</span></span>  
  
-   <span data-ttu-id="34eab-148">Per un filegroup di dati ottimizzato per la memoria, il backup differenziale utilizza lo stesso algoritmo di un backup completo del database per identificare i file di dati e differenziali per il backup, ma filtra quindi il subset di file nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="34eab-148">For a memory-optimized data filegroup, the differential backup uses the same algorithm as full database backup to identify the data and delta files for backup but it then filters out the subset of files as follows:</span></span>  
  
    -   <span data-ttu-id="34eab-149">Un file di dati contiene le righe appena inserite e, quando è pieno, viene chiuso e contrassegnato in sola lettura.</span><span class="sxs-lookup"><span data-stu-id="34eab-149">A data file contains newly inserted rows and when it is full, it is closed and marked read-only.</span></span> <span data-ttu-id="34eab-150">Il backup di un file di dati viene eseguito solo il file è stato chiuso dopo l'ultimo backup completo del database.</span><span class="sxs-lookup"><span data-stu-id="34eab-150">A data file is backed up only if it was closed after the last full database backup.</span></span> <span data-ttu-id="34eab-151">Con i backup differenziali viene eseguito solo il backup dei file di dati contenenti le righe inserite dopo l'ultimo backup completo del database ad eccezione di uno scenario di aggiornamento ed eliminazione in cui è possibile che alcune righe inserite siano già state contrassegnate per il processo di Garbage Collection o sottoposte a Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="34eab-151">The differential backup only backups up data files containing the inserted rows since the last full database backup with the exception of an update and delete scenario where it is possible that some of the inserted rows may have already been either marked for garbage collection or already garbage collected.</span></span>  
  
    -   <span data-ttu-id="34eab-152">In un file differenziale sono archiviati i riferimenti alle righe di dati eliminate.</span><span class="sxs-lookup"><span data-stu-id="34eab-152">A delta file stores references to the deleted data rows.</span></span> <span data-ttu-id="34eab-153">Poiché qualsiasi futura transazione può eliminare una riga, è possibile modificare un file differenziale in qualsiasi momento nell'arco della sua durata, non viene mai chiuso.</span><span class="sxs-lookup"><span data-stu-id="34eab-153">Since any future transaction can delete a row, a delta file can be modified anytime in its life time, it is never closed.</span></span> <span data-ttu-id="34eab-154">Viene sempre eseguito il backup di un file differenziale.</span><span class="sxs-lookup"><span data-stu-id="34eab-154">A delta file is always backed up.</span></span> <span data-ttu-id="34eab-155">I file differenziali in genere utilizzano meno del 10% dello spazio di archiviazione, pertanto tali file hanno un impatto minimo sulle dimensioni del backup differenziale.</span><span class="sxs-lookup"><span data-stu-id="34eab-155">Delta files typically use less than 10% of the storage, so delta files have a minimal impact on the size of differential backup.</span></span>  
  
 <span data-ttu-id="34eab-156">Se le tabelle ottimizzate per la memoria costituiscono una parte significativa delle dimensioni del database, il backup differenziale può ridurre notevolmente le dimensioni del backup del database.</span><span class="sxs-lookup"><span data-stu-id="34eab-156">If memory-optimized tables are a significant portion of your database size, the differential backup can significantly reduce the size of your database backup.</span></span>  
  
 <span data-ttu-id="34eab-157">Per i carichi di lavoro tipici OLTP, i backup differenziali saranno molto più piccoli dei backup completi del database.</span><span class="sxs-lookup"><span data-stu-id="34eab-157">For typical OLTP workloads, the differential backups will be considerably smaller than the full database backups.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="34eab-158">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="34eab-158">See Also</span></span>  
 [<span data-ttu-id="34eab-159">Eseguire il backup, ripristinare e recuperare tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="34eab-159">Backup, Restore, and Recovery of Memory-Optimized Tables</span></span>](restore-and-recovery-of-memory-optimized-tables.md)  
  
  
