---
title: Durabilità per tabelle con ottimizzazione per la memoria | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: d304c94d-3ab4-47b0-905d-3c8c2aba9db6
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 1d48d671b23d7b7b17557e7829d6f2522c375acd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87722832"
---
# <a name="durability-for-memory-optimized-tables"></a><span data-ttu-id="27892-102">Durabilità per tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="27892-102">Durability for Memory-Optimized Tables</span></span>
  [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] <span data-ttu-id="27892-103">fornisce durabilità completa per le tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-103">provides full durability for memory-optimized tables.</span></span> <span data-ttu-id="27892-104">Quando viene eseguito il commit di una transazione che ha modificato una tabella ottimizzata per la memoria, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], come avviene per le tabelle basate su disco, garantisce che le modifiche vengano rese permanenti, ovvero che saranno mantenute in seguito a un riavvio del database, a condizione che lo spazio di archiviazione sottostante sia disponibile.</span><span class="sxs-lookup"><span data-stu-id="27892-104">When a transaction that changed a memory-optimized table commits, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (as it does for disk-based tables), guarantees that the changes are permanent (will survive a database restart), provided the underlying storage is available.</span></span> <span data-ttu-id="27892-105">I componenti chiave della durabilità sono due: registrazione delle transazioni e salvataggio in modo permanente delle modifiche ai dati nell'archiviazione su disco.</span><span class="sxs-lookup"><span data-stu-id="27892-105">There are two key components of durability: transaction logging and persisting data changes to on-disk storage.</span></span>

## <a name="transaction-log"></a><span data-ttu-id="27892-106">Log delle transazioni</span><span class="sxs-lookup"><span data-stu-id="27892-106">Transaction Log</span></span>
 <span data-ttu-id="27892-107">Tutte le modifiche apportate alle tabelle basate su disco o alle tabelle ottimizzate per la memoria durevoli vengono acquisite in uno o più record di log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="27892-107">All changes made to disk-based tables or durable memory-optimized tables are captured in one or more transaction log records.</span></span> <span data-ttu-id="27892-108">In corrispondenza del commit di una transazione, tramite [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] vengono scritti sul disco i record di log associati alla transazione prima di comunicare all'applicazione o alla sessione utente che è stato eseguito il commit della transazione.</span><span class="sxs-lookup"><span data-stu-id="27892-108">When a transaction commits, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] writes the log records associated with the transaction to disk before communicating to the application or user session that the transaction has committed.</span></span> <span data-ttu-id="27892-109">In questo modo viene garantita la durabilità delle modifiche apportate dalla transazione.</span><span class="sxs-lookup"><span data-stu-id="27892-109">This guarantees that changes made by the transaction are durable.</span></span> <span data-ttu-id="27892-110">Il log delle transazioni per le tabelle ottimizzate per la memoria è completamente integrato con lo stesso flusso del log utilizzato dalle tabelle basate su disco.</span><span class="sxs-lookup"><span data-stu-id="27892-110">The transaction log for memory-optimized tables is fully integrated with the same log stream used by disk-based tables.</span></span> <span data-ttu-id="27892-111">Grazie a questa integrazione è possibile far continuare le operazioni di backup, recupero e ripristino del log delle transazioni esistente senza la necessità di altri passaggi aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="27892-111">This integration allows existing transaction log backup, recover, and restore operations to continue to work without requiring any additional steps.</span></span> <span data-ttu-id="27892-112">Tuttavia, poiché tramite [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] è possibile aumentare notevolmente la velocità effettiva delle transazioni del carico di lavoro, è necessario assicurarsi che l'archiviazione del log delle transazioni sia configurata in modo appropriato per gestire l'aumento dei requisiti di I/O.</span><span class="sxs-lookup"><span data-stu-id="27892-112">However, since [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] can increase transaction throughput of your workload significantly, you need to make sure that transaction log storage is configured appropriately to handle the increased IO requirements.</span></span>

## <a name="data-and-delta-files"></a><span data-ttu-id="27892-113">File di dati e differenziali</span><span class="sxs-lookup"><span data-stu-id="27892-113">Data and Delta Files</span></span>
 <span data-ttu-id="27892-114">I dati nelle tabelle ottimizzate per la memoria vengono archiviati come righe di dati in formato libero collegate tramite uno o più indici in memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-114">The data in memory-optimized tables is stored as free-form data rows that are linked through one or more in-memory indexes, in memory.</span></span> <span data-ttu-id="27892-115">Non esistono strutture per le righe di dati, quali quelle utilizzate per le tabelle basate su disco.</span><span class="sxs-lookup"><span data-stu-id="27892-115">There are no page structures for data rows, such as those used for disk-based tables.</span></span> <span data-ttu-id="27892-116">Quando l'applicazione è pronta ad eseguire il commit della transazione, [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] genera i record di log per la transazione.</span><span class="sxs-lookup"><span data-stu-id="27892-116">When the application is ready to commit the transaction, the [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] generates the log records for the transaction.</span></span> <span data-ttu-id="27892-117">Per la persistenza delle tabelle ottimizzate per la memoria viene utilizzato un set di file di dati e differenziali mediante un thread in background.</span><span class="sxs-lookup"><span data-stu-id="27892-117">The persistence of memory-optimized tables is done with a set of data and delta files using a background thread.</span></span> <span data-ttu-id="27892-118">I file di dati e differenziali si trovano in uno o più contenitori, che utilizzano lo stesso meccanismo utilizzato per i dati FILESTREAM.</span><span class="sxs-lookup"><span data-stu-id="27892-118">The data and delta files are located in one or more containers (using the same mechanism used for FILESTREAM data).</span></span> <span data-ttu-id="27892-119">Viene eseguito il mapping di questi contenitori a un nuovo tipo di filegroup, denominato filegroup ottimizzato per la memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-119">These containers are mapped to a new type of filegroup, called a memory-optimized filegroup.</span></span>

 <span data-ttu-id="27892-120">I dati vengono scritti in tali file in un modo strettamente sequenziale riducendo la latenza del disco per la rotazione dei supporti.</span><span class="sxs-lookup"><span data-stu-id="27892-120">Data is written to these files in a strictly sequential fashion, which minimizes disk latency for spinning media.</span></span> <span data-ttu-id="27892-121">È possibile utilizzare più contenitori in dischi diversi per distribuire l'attività di I/O.</span><span class="sxs-lookup"><span data-stu-id="27892-121">You can use multiple containers on different disks to distribute the I/O activity.</span></span> <span data-ttu-id="27892-122">I file di dati e differenziali in più contenitori su dischi diversi migliorano le prestazioni di recupero, quando i dati vengono letti dai file di dati e differenziali su disco in memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-122">Data and delta files in multiple containers on different disks will increase recovery performance when data is read from the data and delta files on disk, into memory.</span></span>

 <span data-ttu-id="27892-123">Un'applicazione non accede direttamente ai file di dati e differenziali.</span><span class="sxs-lookup"><span data-stu-id="27892-123">An application does not directly access data and delta files.</span></span> <span data-ttu-id="27892-124">Tutte le letture e scritture di dati utilizzano i dati in memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-124">All data reads and writes use in-memory data.</span></span>

### <a name="the-data-file"></a><span data-ttu-id="27892-125">File di dati</span><span class="sxs-lookup"><span data-stu-id="27892-125">The Data File</span></span>
 <span data-ttu-id="27892-126">Un file di dati contiene righe di una o più tabelle ottimizzate per la memoria inserite da più transazioni come parte di operazioni INSERT o UPDATE.</span><span class="sxs-lookup"><span data-stu-id="27892-126">A data file contains rows from one or more memory-optimized tables that were inserted by multiple transactions as part of INSERT or UPDATE operations.</span></span> <span data-ttu-id="27892-127">Ad esempio, una riga può provenire dalla tabella ottimizzata per la memoria T1 e la riga successiva può provenire dalla tabella ottimizzata per la memoria T2.</span><span class="sxs-lookup"><span data-stu-id="27892-127">For example, one row can be from memory-optimized table T1 and the next row can be from memory-optimized table T2.</span></span> <span data-ttu-id="27892-128">Le righe vengono accodate al file di dati nell'ordine delle transazioni nel log delle transazioni, in modo da rendere sequenziale l'accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="27892-128">The rows are appended to the data file in the order of transactions in the transaction log, making data access sequential.</span></span> <span data-ttu-id="27892-129">Ciò consente una velocità effettiva delle operazioni di I/O decisamente maggiore rispetto alle operazioni di I/O casuali.</span><span class="sxs-lookup"><span data-stu-id="27892-129">This enables an order of magnitude better I/O throughput compared to random I/O.</span></span> <span data-ttu-id="27892-130">Ogni file di dati viene ridimensionato approssimativamente su 128 MB per i computer con memoria superiore a 16 GB e a 16 MB per i computer con memoria minore o uguale a 16 GB.</span><span class="sxs-lookup"><span data-stu-id="27892-130">Each data file is sized approximately to 128MB for computers with memory greater than 16GB, and 16MB for computers with less than or equal to 16GB.</span></span> <span data-ttu-id="27892-131">Quando il file di dati è pieno, le righe inserite dalle nuove transazioni vengono archiviate in un altro file di dati.</span><span class="sxs-lookup"><span data-stu-id="27892-131">Once the data file is full, the rows inserted by new transactions are stored in another data file.</span></span> <span data-ttu-id="27892-132">Nel corso del tempo, le righe delle tabelle durevoli ottimizzate per la memoria vengono archiviate in uno o più file di dati, ciascuno dei quali contiene le righe da un intervallo di transazioni disgiunto, ma contiguo.</span><span class="sxs-lookup"><span data-stu-id="27892-132">Over time, the rows from durable memory-optimized tables are stored in one of more data files and each data file containing rows from a disjoint but contiguous range of transactions.</span></span> <span data-ttu-id="27892-133">Ad esempio un file di dati con un timestamp di commit della transazione nell'intervallo (100, 200) include tutte le righe inserite dalle transazioni con un timestamp di commit maggiore di 100 e minore di o uguale a 200.</span><span class="sxs-lookup"><span data-stu-id="27892-133">For example a data file with transaction commit timestamp in the range of (100, 200) has all the rows inserted by transactions that have commit timestamp greater than 100 and less than or equal to 200.</span></span> <span data-ttu-id="27892-134">Il timestamp di commit è un contatore a incremento progressivo costante assegnato a una transazione quando è pronta per il commit.</span><span class="sxs-lookup"><span data-stu-id="27892-134">The commit timestamp is a monotonically increasing number assigned to a transaction when it is ready to commit.</span></span> <span data-ttu-id="27892-135">Ogni transazione ha un timestamp di commit univoco.</span><span class="sxs-lookup"><span data-stu-id="27892-135">Each transaction has a unique commit timestamp.</span></span>

 <span data-ttu-id="27892-136">Quando una riga viene eliminata o aggiornata, non viene rimossa o modificata sul posto nel file di dati, ma le righe eliminate vengono rilevate in un altro tipo di file: il file differenziale.</span><span class="sxs-lookup"><span data-stu-id="27892-136">When a row is deleted or updated, the row is not removed or changed in-place in the data file but the deleted rows are tracked in another type of file: the delta file.</span></span> <span data-ttu-id="27892-137">Le operazioni di aggiornamento sono elaborate come una tupla di operazioni di eliminazione e inserimento per ogni riga.</span><span class="sxs-lookup"><span data-stu-id="27892-137">Update operations are processed as a tuple of delete and insert operations for each row.</span></span> <span data-ttu-id="27892-138">Ciò consente di eliminare le operazioni di I/O casuali nel file di dati.</span><span class="sxs-lookup"><span data-stu-id="27892-138">This eliminates random IO on the data file.</span></span>

### <a name="the-delta-file"></a><span data-ttu-id="27892-139">File differenziale</span><span class="sxs-lookup"><span data-stu-id="27892-139">The Delta File</span></span>
 <span data-ttu-id="27892-140">Ogni file di dati è associato a un file differenziale con lo stesso intervallo di transazione che tiene traccia delle righe eliminate inserite dalle transazioni nell'intervallo di transazione.</span><span class="sxs-lookup"><span data-stu-id="27892-140">Each data file is paired with a delta file that has the same transaction range and tracks the deleted rows inserted by transactions in the transaction range.</span></span> <span data-ttu-id="27892-141">Questo file di dati e differenziale è spesso indicato come coppia di file di checkpoint (CFP, Checkpoint File Pair) e corrisponde all'unità di allocazione e deallocazione, oltre che all'unità per le operazioni di unione.</span><span class="sxs-lookup"><span data-stu-id="27892-141">This data and delta file is referred to as a Checkpoint File Pair (CFP) and it is the unit of allocation and deallocation as well as the unit for Merge operations.</span></span> <span data-ttu-id="27892-142">Ad esempio, in un file differenziale che corrisponde all'intervallo di transazione (100, 200) verranno archiviate le righe eliminate inserite dalle transazioni nell'intervallo (100, 200).</span><span class="sxs-lookup"><span data-stu-id="27892-142">For example, a delta file corresponding to transaction range (100, 200) will store deleted rows that were inserted by transactions in the range (100, 200).</span></span> <span data-ttu-id="27892-143">Come per i file di dati, l'accesso al file differenziale avviene in ordine sequenziale.</span><span class="sxs-lookup"><span data-stu-id="27892-143">Like data files, the delta file is accessed sequentially.</span></span>

 <span data-ttu-id="27892-144">Quando una riga viene eliminata, la riga non viene rimossa dal file di dati ma viene aggiunto un riferimento alla riga nel file differenziale associato all'intervallo di transazione in cui è stata inserita la riga di dati.</span><span class="sxs-lookup"><span data-stu-id="27892-144">When a row is deleted, the row is not removed from the data file but a reference to the row is appended to the delta file associated with the transaction range where this data row was inserted.</span></span> <span data-ttu-id="27892-145">Poiché la riga da eliminare esiste già nel file di dati, nel file differenziale sono archiviate solo le informazioni di riferimento `{inserting_tx_id, row_id, deleting_tx_id }` seguendo l'ordine del log delle transazioni delle operazioni originali di eliminazione o aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="27892-145">Since the row to be deleted already exists in the data file, the delta file only stores the reference information `{inserting_tx_id, row_id, deleting_tx_id }` and it follows the transactional log order of the originating delete or update operations.</span></span>

## <a name="populating-data-and-delta-files"></a><span data-ttu-id="27892-146">Popolamento dei file di dati e differenziali</span><span class="sxs-lookup"><span data-stu-id="27892-146">Populating Data and Delta Files</span></span>
 <span data-ttu-id="27892-147">I file di dati e differenziali vengono popolati da un thread in background definito checkpoint offline.</span><span class="sxs-lookup"><span data-stu-id="27892-147">Data and delta file are populated by a background thread called offline checkpoint.</span></span> <span data-ttu-id="27892-148">Questo thread legge i record del log delle transazioni generati dalle transazioni di cui è stato eseguito il commit nelle tabelle ottimizzate per la memoria e aggiunge le informazioni relative alle righe inserite o eliminate nei file di dati e differenziali appropriati.</span><span class="sxs-lookup"><span data-stu-id="27892-148">This thread reads the transaction log records generated by committed transactions on memory-optimized tables and appends information about the inserted and deleted rows into appropriate data and delta files.</span></span> <span data-ttu-id="27892-149">A differenza delle tabelle basate su disco in cui le pagine di dati e indice vengono scaricate con I/O casuale al completamento del checkpoint, la persistenza della tabella ottimizzata per la memoria è un'operazione in background continua.</span><span class="sxs-lookup"><span data-stu-id="27892-149">Unlike disk-based tables where data/index pages are flushed with random I/O when checkpoint is done, the persistence of memory-optimized table is continuous background operation.</span></span> <span data-ttu-id="27892-150">Si accede a più file differenziali poiché una transazione può eliminare o aggiornare qualsiasi riga inserita da una transazione precedente.</span><span class="sxs-lookup"><span data-stu-id="27892-150">Multiple delta files are accessed because a transaction can delete or update any row that was inserted by any previous transaction.</span></span> <span data-ttu-id="27892-151">Le informazioni di eliminazione vengono sempre aggiunte alla fine del file differenziale.</span><span class="sxs-lookup"><span data-stu-id="27892-151">Deletion information is always appended at the end of the delta file.</span></span> <span data-ttu-id="27892-152">Ad esempio, una transazione con un timestamp del commit pari a 600 inserisce una nuova riga ed elimina le righe inserite dalle transazioni con un timestamp del commit pari a 150, 250 e 450, come illustrato nell'immagine seguente.</span><span class="sxs-lookup"><span data-stu-id="27892-152">For example, a transaction with a commit timestamp of 600 inserts one new row and deletes rows inserted by transactions with a commit timestamp of 150, 250 and 450 as shown in the picture below.</span></span> <span data-ttu-id="27892-153">Tutte e quattro le operazioni di I/O dei file (tre per le righe eliminate e una per le righe appena inserite) sono operazioni solo di accodamento ai corrispondenti file di dati e differenziali.</span><span class="sxs-lookup"><span data-stu-id="27892-153">All 4 file I/O operations (three for deleted rows and 1 for the newly inserted rows), are append-only operations to the corresponding delta and data files.</span></span>

 <span data-ttu-id="27892-154">![Lettura dei record di log per le tabelle ottimizzate per la memoria.](../../database-engine/media/read-logs-hekaton.gif "Lettura dei record di log per le tabelle ottimizzate per la memoria.")</span><span class="sxs-lookup"><span data-stu-id="27892-154">![Read log records for memory-optimized tables.](../../database-engine/media/read-logs-hekaton.gif "Read log records for memory-optimized tables.")</span></span>

## <a name="accessing-data-and-delta-files"></a><span data-ttu-id="27892-155">Accesso ai file di dati e differenziali</span><span class="sxs-lookup"><span data-stu-id="27892-155">Accessing Data and Delta Files</span></span>
 <span data-ttu-id="27892-156">L'accesso alle coppie di file di dati e differenziali viene effettuato nei casi seguenti.</span><span class="sxs-lookup"><span data-stu-id="27892-156">Data and delta file pairs are accessed when the following occurs.</span></span>

 <span data-ttu-id="27892-157">Thread del checkpoint offline questo thread Accoda inserimenti ed eliminazioni alle righe di dati ottimizzate per la memoria, nelle coppie di file di dati e differenziali corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="27892-157">Offline checkpoint thread This thread appends inserts and deletes to memory-optimized data rows, to the corresponding data and delta file pairs.</span></span>

 <span data-ttu-id="27892-158">Operazione Merge l'operazione unisce una o più coppie di file di dati e differenziali e crea una nuova coppia di file di dati e differenziali.</span><span class="sxs-lookup"><span data-stu-id="27892-158">Merge operation The operation merges one or more data and delta file pairs and creates a new data and delta file pair.</span></span>

 <span data-ttu-id="27892-159">Durante il ripristino dell'arresto anomalo del sistema quando [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] viene riavviato o il database viene riportato online, i dati ottimizzati per la memoria vengono popolati utilizzando le coppie di file di dati e differenziali.</span><span class="sxs-lookup"><span data-stu-id="27892-159">During crash recovery When [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is restarted or the database is brought back online, the memory-optimized data is populated using the data and delta file pairs.</span></span> <span data-ttu-id="27892-160">Il file differenziale svolge la funzione di filtro per le righe eliminate durante la lettura delle righe dal file di dati corrispondente.</span><span class="sxs-lookup"><span data-stu-id="27892-160">The delta file acts as a filter for the deleted rows when reading the rows from the corresponding data file.</span></span> <span data-ttu-id="27892-161">Poiché ogni coppia di file di dati e differenziale è indipendente, questi file vengono caricati in parallelo per ridurre il tempo necessario per popolare i dati in memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-161">Because each data and delta file pair is independent, these files are loaded in parallel to reduce the time taken to populate data into memory.</span></span> <span data-ttu-id="27892-162">Una volta che i dati sono stati caricati in memoria, il motore di OLTP in memoria applica i record del log delle transazioni attivi non ancora coperti dai file di checkpoint in modo da completare i dati ottimizzati per la memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-162">Once the data has been loaded into memory, the In-Memory OLTP engine applies the active transaction log records not yet covered by the checkpoint files so that the memory-optimized data is complete.</span></span>

 <span data-ttu-id="27892-163">Durante l'operazione di ripristino i file del checkpoint di OLTP in memoria vengono creati dal backup del database, quindi vengono applicati uno o più backup del log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="27892-163">During restore operation The In-Memory OLTP checkpoint files are created from the database backup, and then one or more transaction log backups are applied.</span></span> <span data-ttu-id="27892-164">Analogamente al recupero a seguito dell'arresto anomalo del sistema, il motore di OLTP in memoria carica i dati in memoria in parallelo, per ridurre al minimo l'impatto sul tempo di recupero.</span><span class="sxs-lookup"><span data-stu-id="27892-164">As with crash recovery, the In-Memory OLTP engine loads data into memory in parallel, to minimize the impact on recovery time.</span></span>

## <a name="merging-data-and-delta-files"></a><span data-ttu-id="27892-165">Unione dei file di dati e differenziali</span><span class="sxs-lookup"><span data-stu-id="27892-165">Merging Data and Delta Files</span></span>
 <span data-ttu-id="27892-166">I dati per le tabelle con ottimizzazione per la memoria vengono archiviati in uno o più coppie di file di dati e differenziali, anche dette coppie di file di checkpoint o CFP.</span><span class="sxs-lookup"><span data-stu-id="27892-166">The data for memory optimized tables is stored in one or more data and delta file pairs (also called a checkpoint file pair, or CFP).</span></span> <span data-ttu-id="27892-167">I file di dati archiviano le righe inserite e i file differenziali fanno riferimento alle righe eliminate.</span><span class="sxs-lookup"><span data-stu-id="27892-167">Data files store inserted rows and delta files reference deleted rows.</span></span> <span data-ttu-id="27892-168">Durante l'esecuzione di un carico di lavoro OLTP, mentre le righe vengono aggiornate, inserite ed eliminate dalle operazioni DML, vengono create nuove coppie di file di checkpoint per rendere persistenti le nuove righe e il riferimento alle righe eliminate viene aggiunto ai file differenziali.</span><span class="sxs-lookup"><span data-stu-id="27892-168">During the execution of an OLTP workload, as the DML operations update, insert, and delete rows, new CFPs are created to persist the new rows, and the reference to the deleted rows is appended to delta files.</span></span>

 <span data-ttu-id="27892-169">I metadati di tutte le coppie di file di checkpoint precedentemente chiuse e attualmente attive vengono archiviati in una struttura di matrice interna indicata come matrice di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="27892-169">The metadata of all previously-closed and currently active CFPs is stored in an internal array structure referred to as the storage array.</span></span> <span data-ttu-id="27892-170">Si tratta di una matrice con dimensioni limitate (8192 voci) di coppie di file di checkpoint.</span><span class="sxs-lookup"><span data-stu-id="27892-170">It is a finitely sized (8,192 entries) array of CFPs.</span></span> <span data-ttu-id="27892-171">Le voci nella matrice di archiviazione sono ordinate in base all'intervallo di transazioni.</span><span class="sxs-lookup"><span data-stu-id="27892-171">The entries in the storage array are ordered by transaction range.</span></span> <span data-ttu-id="27892-172">Le coppie di file di checkpoint nella matrice di archiviazione, insieme alla parte finale del log, rappresentano lo stato su disco richiesto per recuperare un database con tabelle ottimizzate per la memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-172">The CFPs in the storage array (along with the tail of the log) represent all the on-disk state required to recover a database with memory-optimized tables.</span></span>

 <span data-ttu-id="27892-173">Nel corso del tempo, con le operazioni DML, il numero di coppie di file di checkpoint aumenta determinando il raggiungimento della capacità da parte della matrice di archiviazione, con i conseguenti problemi:</span><span class="sxs-lookup"><span data-stu-id="27892-173">Over time, with DML operations, the number of CFPs grow causing the storage array to reach capacity, which introduces the following challenges:</span></span>

-   <span data-ttu-id="27892-174">Righe eliminate.</span><span class="sxs-lookup"><span data-stu-id="27892-174">Deleted rows.</span></span>  <span data-ttu-id="27892-175">Le righe eliminate rimangono nel file di dati, ma sono contrassegnate come eliminate nel file differenziale corrispondente.</span><span class="sxs-lookup"><span data-stu-id="27892-175">Deleted rows remain in the data file but are marked as deleted in the corresponding delta file.</span></span> <span data-ttu-id="27892-176">Queste righe non sono più necessarie e verranno rimosse dall'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="27892-176">These rows are no longer needed and will be removed from the storage.</span></span> <span data-ttu-id="27892-177">Se le righe eliminate non venissero rimosse dalle coppie di file di checkpoint, utilizzerebbero spazio inutilmente e rallenterebbero il recupero.</span><span class="sxs-lookup"><span data-stu-id="27892-177">If deleted rows were not removed from CFPs, they would use space unnecessarily and make recovery time slower.</span></span>

-   <span data-ttu-id="27892-178">Matrice di archiviazione piena.</span><span class="sxs-lookup"><span data-stu-id="27892-178">Storage array full.</span></span> <span data-ttu-id="27892-179">Quando vengono allocate 8.000 voci nella matrice di archiviazione (192 voci nella matrice sono riservate alle operazioni di merge esistenti per la concorrenza o il permesso di eseguire operazioni di merge manuali), non è possibile eseguire nuove transazioni DML su tabelle ottimizzate per la memoria durevoli.</span><span class="sxs-lookup"><span data-stu-id="27892-179">When there 8,000 entries in the storage array are allocated (192 entries in the array are reserved for existing merges to compete or to allow you to do manual merges), no new DML transactions can be executed on durable memory-optimized tables.</span></span> <span data-ttu-id="27892-180">Le voci rimanenti possono essere utilizzate solo da operazioni di checkpoint e unione.</span><span class="sxs-lookup"><span data-stu-id="27892-180">Only checkpoint and merge operations are allowed to consume the remaining entries.</span></span> <span data-ttu-id="27892-181">Ciò garantisce che le transazioni DML non riempiano la matrice e che alcune voci nella matrice siano riservate per l'unione di file esistenti e per recuperare spazio nella matrice.</span><span class="sxs-lookup"><span data-stu-id="27892-181">This ensures that DML transactions do not fill the array and that some entries in the array are reserved to merge existing files and to reclaim space in the array.</span></span>

-   <span data-ttu-id="27892-182">Overhead di modifica della matrice di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="27892-182">Storage array manipulation overhead.</span></span> <span data-ttu-id="27892-183">I processi interni eseguono ricerche nella matrice di archiviazione per operazioni quali la ricerca del file differenziale in cui aggiungere informazioni su una riga eliminata.</span><span class="sxs-lookup"><span data-stu-id="27892-183">Internal processes search the storage array for operations such as finding the delta file to append information about a deleted row.</span></span> <span data-ttu-id="27892-184">Il costo delle operazioni aumenta con il numero di voci.</span><span class="sxs-lookup"><span data-stu-id="27892-184">The cost of these operations increases with the number of entries.</span></span>

 <span data-ttu-id="27892-185">Per evitare queste inefficienze, le coppie di file di checkpoint chiuse meno recenti vengono unite, in base ai criteri di unione illustrati di seguito, in modo da comprimere la matrice di archiviazione per rappresentare lo stesso set di dati, con un numero ridotto di coppie di file di checkpoint.</span><span class="sxs-lookup"><span data-stu-id="27892-185">To help prevent these inefficiencies, the older closed CFPs are merged, based on a merge policy described below, so the storage array is compacted to represent the same set of data, with a reduced number of CFPs.</span></span>

 <span data-ttu-id="27892-186">Le dimensioni totali in memoria di tutte le tabelle durevoli di un database non devono superare i 250 GB.</span><span class="sxs-lookup"><span data-stu-id="27892-186">The total in-memory size of all durable tables in a database should not exceed 250 GB.</span></span> <span data-ttu-id="27892-187">Le tabelle durevoli che utilizzano fino a 250 GB di memoria, in caso di operazioni di inserimento, eliminazione e aggiornamento, richiederanno in media 500 GB di spazio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="27892-187">Durable tables that use up to 250 GB of memory will, assuming insert, delete, and update operations, require on average 500 GB of storage space.</span></span> <span data-ttu-id="27892-188">Le 4.000 coppie di file di dati e file differenziali nel filegroup ottimizzato per la memoria sono necessarie per supportare i 500 GB di spazio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="27892-188">4,000 data and delta file pairs in the memory-optimized file group are required to support the 500 GB of storage space.</span></span>

 <span data-ttu-id="27892-189">I picchi di breve durata dell'attività del database possono provocare un ritardo delle operazioni di checkpoint e unione, determinando un aumento del numero di coppie di file di dati e file differenziali necessario.</span><span class="sxs-lookup"><span data-stu-id="27892-189">Short-term surges in database activity may cause checkpoint and merge operations lag, which will increase the number of required data and delta file pairs.</span></span> <span data-ttu-id="27892-190">Per gestire i picchi di breve durata dell'attività del database, il sistema di archiviazione può allocare fino a 8.000 coppie di file di dati e file differenziali per a un massimo di 1 TB di spazio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="27892-190">To accommodate short-term surges spikes in database activity, the storage system can allocate up to 8,000 data and delta file pairs up to a total of 1TB of storage.</span></span> <span data-ttu-id="27892-191">Una volta raggiunto il limite, non saranno consentite nuove transazioni nel database fino a quando le operazioni di checkpoint non vengono aggiornate.</span><span class="sxs-lookup"><span data-stu-id="27892-191">When that limit is reached, there will be no new transactions allowed on the database until checkpoint operations catch up.</span></span> <span data-ttu-id="27892-192">Se le dimensioni delle tabelle durevoli in memoria superano per un periodo di tempo prolungato i 250 GB, esiste la possibilità di raggiungere il limite di 8.000 coppie di file.</span><span class="sxs-lookup"><span data-stu-id="27892-192">If the size of durable tables in memory exceeds 250GB for long periods of time, there is a chance of reaching the 8,000 file pair limit.</span></span>

 <span data-ttu-id="27892-193">L'operazione di unione utilizza come input una o più coppie di file di checkpoint chiuse adiacenti, denominate origine dell'unione, in base a criteri di unione definiti internamente e produce una coppia di file di checkpoint risultante, denominata destinazione dell'unione.</span><span class="sxs-lookup"><span data-stu-id="27892-193">The merge operation takes as input one or more adjacent closed CFPs (called merge source) based on an internally defined merge policy, and produces one resultant CFP, called the merge target.</span></span> <span data-ttu-id="27892-194">Le voci di ogni file differenziale delle coppie di file di checkpoint di origine vengono utilizzate per filtrare le righe dal file di dati corrispondente per rimuovere le righe di dati non necessari.</span><span class="sxs-lookup"><span data-stu-id="27892-194">The entries in each delta file of the source CFPs are used to filter rows from the corresponding data file to remove the data rows that are not needed.</span></span> <span data-ttu-id="27892-195">Le righe rimanenti nelle coppie di file di checkpoint di origine vengono consolidate in una coppia di file di checkpoint di destinazione.</span><span class="sxs-lookup"><span data-stu-id="27892-195">The remaining rows in the source CFPs are consolidated into one target CFP.</span></span> <span data-ttu-id="27892-196">Al completamento dell'unione, la coppia di file di checkpoint di destinazione risultante dall'unione sostituisce quelle di origine (origini dell'unione).</span><span class="sxs-lookup"><span data-stu-id="27892-196">After the merge is complete, the resultant merge-target CFP replaces the source CFPs (merge sources).</span></span> <span data-ttu-id="27892-197">Le coppie di file di checkpoint di origine dell'unione attraversano una fase di transizione prima di essere rimosse dall'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="27892-197">The merge-source CFPs go through a transition phase before they are removed from storage.</span></span>

 <span data-ttu-id="27892-198">Nell'esempio seguente il filegroup della tabella ottimizzata per la memoria dispone di quattro coppie di file di dati e differenziali in corrispondenza del timestamp 500, che contengono i dati delle transazioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="27892-198">In the example below, the memory-optimized table file group has four data and delta file pairs at timestamp 500 containing data from previous transactions.</span></span> <span data-ttu-id="27892-199">Ad esempio, le righe del primo file di dati corrispondono alle transazioni con timestamp maggiore di 100 e minore di o uguale a 200; in alternativa sono rappresentate come (100, 200].</span><span class="sxs-lookup"><span data-stu-id="27892-199">For example, the rows in the first data file correspond to transactions with timestamp greater than 100 and less than or equal to 200; alternatively represented as (100, 200].</span></span> <span data-ttu-id="27892-200">La percentuale di completamento del secondo e terzo file di dati è inferiore al 50% dopo aver considerato le righe contrassegnate come eliminate.</span><span class="sxs-lookup"><span data-stu-id="27892-200">The second and third data files are shown to be less than 50 percent full after accounting for the rows marked as deleted.</span></span> <span data-ttu-id="27892-201">L'operazione di unione combina le due coppie di file di checkpoint e crea una nuova coppia di file di checkpoint contenente le transazioni con timestamp maggiore di 200 e minore o uguale a 400, ovvero l'intervallo combinato di queste due coppie di file di checkpoint.</span><span class="sxs-lookup"><span data-stu-id="27892-201">The merge operation combines these two CFPs and creates a new CFP containing transactions with timestamp greater than 200 and less than or equal to 400, which is the combined range of these two CFPs.</span></span> <span data-ttu-id="27892-202">È presente un'altra coppia di file di checkpoint con intervallo (500, 600] e il file differenziale non vuoto per l'intervallo della transazione (200, 400] indica che l'operazione di unione può essere eseguita contemporaneamente all'attività transazionale, inclusa l'eliminazione di più righe dalle coppie di file di checkpoint di origine.</span><span class="sxs-lookup"><span data-stu-id="27892-202">You see another CFP with range (500, 600] and non-empty delta file for transaction range (200, 400] shows that merge operation can be done concurrently with transactional activity including deleting more rows from the source CFPs.</span></span>

 <span data-ttu-id="27892-203">![Il diagramma mostra il gruppo di file della tabella con ottimizzazione per la memoria](../../database-engine/media/storagediagram-hekaton.png "Il diagramma mostra il gruppo di file della tabella con ottimizzazione per la memoria")</span><span class="sxs-lookup"><span data-stu-id="27892-203">![Diagram shows memory optimized table file group](../../database-engine/media/storagediagram-hekaton.png "Diagram shows memory optimized table file group")</span></span>

 <span data-ttu-id="27892-204">Un thread in background valuta tutte le coppie di file di checkpoint chiuse utilizzando un criterio di unione, quindi avvia una o più richieste di unione per le coppie di file di checkpoint qualificate.</span><span class="sxs-lookup"><span data-stu-id="27892-204">A background thread evaluates all closed CFPs using a merge policy and then initiates one or more merge requests for the qualifying CFPs.</span></span> <span data-ttu-id="27892-205">Queste richieste di unione vengono elaborate dal thread del checkpoint offline.</span><span class="sxs-lookup"><span data-stu-id="27892-205">These merge requests are processed by the offline checkpoint thread.</span></span> <span data-ttu-id="27892-206">La valutazione dei criteri di unione viene eseguita periodicamente, anche quando un checkpoint viene chiuso.</span><span class="sxs-lookup"><span data-stu-id="27892-206">The evaluation of merge policy is done periodically and also when a checkpoint is closed.</span></span>

### <a name="sssql14-merge-policy"></a>[!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] <span data-ttu-id="27892-207">Criteri di unione</span><span class="sxs-lookup"><span data-stu-id="27892-207">Merge Policy</span></span>
 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] <span data-ttu-id="27892-208">implementa i criteri di unione seguenti:</span><span class="sxs-lookup"><span data-stu-id="27892-208">implements the following merge policy:</span></span>

-   <span data-ttu-id="27892-209">Un'unione è pianificata se 2 o più coppie di file di checkpoint consecutive possono essere consolidate, dopo aver tenuto conto delle righe eliminate, in modo che le righe risultanti rientrino in una coppia di file di checkpoint di dimensioni ideali.</span><span class="sxs-lookup"><span data-stu-id="27892-209">A merge is scheduled if 2 or more consecutive CFPs can be consolidated, after accounting for deleted rows, such that the resultant rows can fit into 1 CFP of ideal size.</span></span> <span data-ttu-id="27892-210">Le dimensioni ideali di una coppia di file di checkpoint vengono determinate come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="27892-210">The ideal size of CFP is determined as follows:</span></span>

    -   <span data-ttu-id="27892-211">Se la memoria di un computer è minore o uguale a 16 GB, il file di dati è 16 MB e il file differenziale è 1 MB.</span><span class="sxs-lookup"><span data-stu-id="27892-211">If a computer has less than or equal to 16GB of memory, the data file is 16MB and delta file is 1MB.</span></span>

    -   <span data-ttu-id="27892-212">Se la memoria di un computer è maggiore di 16 GB, il file di dati è 128 MB e il file differenziale è 16 MB.</span><span class="sxs-lookup"><span data-stu-id="27892-212">If a computer has greater than 16GB of memory, the data file is 128MB and delta file is 16MB.</span></span>

-   <span data-ttu-id="27892-213">Un singola coppia di file di checkpoint può essere unita automaticamente se il file di dati supera i 256 MB ed è maggiore della metà delle righe eliminate.</span><span class="sxs-lookup"><span data-stu-id="27892-213">A single CFP can be self-merged if the data file exceeds 256 MB and more than half of the rows are deleted.</span></span> <span data-ttu-id="27892-214">Le dimensioni di un file di dati possono aumentare di più di 128 MB se, ad esempio, tramite una singola transazione o più transazioni simultanee viene inserita o aggiornata una grande quantità di dati, forzando la crescita del file di dati oltre le relative dimensioni ideali poiché tramite una transazione non è possibile estendere più coppie di file di checkpoint.</span><span class="sxs-lookup"><span data-stu-id="27892-214">A data file can grow larger than 128MB if, for example, a single transaction or multiple concurrent transactions inserts or updates large amount of data, forcing the data file to grow beyond its ideal size because a transaction cannot span multiple CFPs.</span></span>

 <span data-ttu-id="27892-215">Di seguito sono riportati alcuni esempi che illustrano le coppie di file di checkpoint che vengono unite in base ai criteri di unione:</span><span class="sxs-lookup"><span data-stu-id="27892-215">Here are some examples that show the CFPs that will be merged under the merge policy:</span></span>

|<span data-ttu-id="27892-216">File di origine di coppie di file di checkpoint adiacenti (percentuale di completamento)</span><span class="sxs-lookup"><span data-stu-id="27892-216">Adjacent CFPs Source Files (% full)</span></span>|<span data-ttu-id="27892-217">Selezione del tipo di unione</span><span class="sxs-lookup"><span data-stu-id="27892-217">Merge Selection</span></span>|
|-------------------------------------------|---------------------|
|<span data-ttu-id="27892-218">CFP0 (30%), CFP1 (50%), CFP2 (50%), CFP3 (90%)</span><span class="sxs-lookup"><span data-stu-id="27892-218">CFP0 (30%), CFP1 (50%), CFP2 (50%), CFP3 (90%)</span></span>|<span data-ttu-id="27892-219">(CFP0, CFP1)</span><span class="sxs-lookup"><span data-stu-id="27892-219">(CFP0, CFP1)</span></span><br /><br /> <span data-ttu-id="27892-220">La coppia CFP2 non viene scelta in quanto il file di dati risultante sarà maggiore del 100% delle dimensioni ideali.</span><span class="sxs-lookup"><span data-stu-id="27892-220">CFP2 is not chosen as it will make resultant data file greater than 100% of the ideal size.</span></span>|
|<span data-ttu-id="27892-221">CFP0 (30%), CFP1 (20%), CFP2 (50%), CFP3 (10%)</span><span class="sxs-lookup"><span data-stu-id="27892-221">CFP0 (30%), CFP1 (20%), CFP2 (50%), CFP3 (10%)</span></span>|<span data-ttu-id="27892-222">(CFP0, CFP1, CFP2).</span><span class="sxs-lookup"><span data-stu-id="27892-222">(CFP0, CFP1, CFP2).</span></span> <span data-ttu-id="27892-223">I file vengono scelti a partire da sinistra.</span><span class="sxs-lookup"><span data-stu-id="27892-223">Files are chosen starting from left.</span></span><br /><br /> <span data-ttu-id="27892-224">La coppia CFP3 non viene scelta in quanto il file di dati risultante sarà maggiore del 100% delle dimensioni ideali.</span><span class="sxs-lookup"><span data-stu-id="27892-224">CTP3 is not chosen as it will make resultant data file greater than 100% of the ideal size.</span></span>|
|<span data-ttu-id="27892-225">CFP0 (80%), CFP1 (30%), CFP2 (10%), CFP3 (40%)</span><span class="sxs-lookup"><span data-stu-id="27892-225">CFP0 (80%), CFP1 (30%), CFP2 (10%), CFP3 (40%)</span></span>|<span data-ttu-id="27892-226">(CFP1, CFP2, CFP3).</span><span class="sxs-lookup"><span data-stu-id="27892-226">(CFP1, CFP2, CFP3).</span></span> <span data-ttu-id="27892-227">I file vengono scelti a partire da sinistra.</span><span class="sxs-lookup"><span data-stu-id="27892-227">Files are chosen starting from left.</span></span><br /><br /> <span data-ttu-id="27892-228">CFP0 viene ignorato perché se in combinazione con CFP1, il file di dati risultante sarà maggiore del 100% delle dimensioni ideali.</span><span class="sxs-lookup"><span data-stu-id="27892-228">CFP0 is skipped because if combined with CFP1, the resultant data file will be greater than 100% of the ideal size.</span></span>|

 <span data-ttu-id="27892-229">Non tutte le coppie di file di checkpoint con spazio disponibile sono qualificate per l'unione.</span><span class="sxs-lookup"><span data-stu-id="27892-229">Not all CFPs with available space qualify for merge.</span></span> <span data-ttu-id="27892-230">Ad esempio, se due coppie di file di checkpoint adiacenti sono piene al 60%, non si qualificano per l'unione e ciascuna coppia di file di checkpoint rimane con il 40% dello spazio di archiviazione inutilizzato.</span><span class="sxs-lookup"><span data-stu-id="27892-230">For example, if two adjacent CFPs are 60% full, they will not qualify for merge and each of these CFPs will have 40% storage unused.</span></span> <span data-ttu-id="27892-231">Nel peggiore dei casi, tutte le coppie di file di checkpoint saranno piene al 50%, con un utilizzo dello spazio di archiviazione solo del 50%.</span><span class="sxs-lookup"><span data-stu-id="27892-231">In the worst case, all CFPs will be 50% full, a storage utilization of only 50%.</span></span> <span data-ttu-id="27892-232">Mentre le righe eliminate possono essere presenti nello spazio di archiviazione perché le coppie di file di checkpoint non si qualificano per l'unione, è possibile che le righe eliminate siano già state rimosse dalla memoria dal processo di Garbage Collection in memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-232">While the deleted rows may exist in storage because the CFPs don't qualify for merge, the deleted rows may have already been removed from memory by in-memory garbage collection.</span></span> <span data-ttu-id="27892-233">La gestione dello spazio di archiviazione e della memoria è indipendente da Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="27892-233">The management of storage and the memory is independent from garbage collection.</span></span> <span data-ttu-id="27892-234">Lo spazio di archiviazione utilizzato da coppie di file di checkpoint attive (non tutte le coppie di file di checkpoint vengono aggiornate) può essere fino a due volte maggiore delle dimensioni delle tabelle durevoli in memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-234">Storage taken by active CFPs (not all CFPs are being updated) can be up to 2 times larger than the size of durable tables in memory.</span></span>

 <span data-ttu-id="27892-235">Se necessario, un'Unione manuale può essere eseguita in modo esplicito chiamando [sys. sp_xtp_merge_checkpoint_files &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sys-sp-xtp-merge-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="27892-235">If needed, a manual merge can be explicitly performed by calling [sys.sp_xtp_merge_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-xtp-merge-checkpoint-files-transact-sql).</span></span>

### <a name="life-cycle-of-a-cfp"></a><span data-ttu-id="27892-236">Ciclo di vita di una coppia di file di checkpoint</span><span class="sxs-lookup"><span data-stu-id="27892-236">Life Cycle of a CFP</span></span>
 <span data-ttu-id="27892-237">Le coppie di file di checkpoint attraversano sette stati prima di poter essere deallocate.</span><span class="sxs-lookup"><span data-stu-id="27892-237">CPFs transition through several states before they can be deallocated.</span></span> <span data-ttu-id="27892-238">In qualsiasi momento, le coppie di file di checkpoint si trovano in una delle fasi seguenti: PRECREATED, UNDER CONSTRUCTION, ACTIVE, MERGE TARGET, MERGED SOURCE, REQUIRED FOR BACKUP/HA, IN TRANSITION TO TOMBSTONE e TOMBSTONE.</span><span class="sxs-lookup"><span data-stu-id="27892-238">At any given time, the CFPs are in one of the following phases: PRECREATED, UNDER CONSTRUCTION, ACTIVE, MERGE TARGET, MERGED SOURCE, REQUIRED FOR BACKUP/HA, IN TRANSITION TO TOMBSTONE, and TOMBSTONE.</span></span> <span data-ttu-id="27892-239">Per una descrizione di queste fasi, vedere [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="27892-239">For a description of these phases, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>

 <span data-ttu-id="27892-240">Dopo aver tenuto conto dello spazio di archiviazione utilizzato dalle coppie di file di checkpoint nei vari stati, lo spazio di archiviazione complessivo utilizzato dalle tabelle ottimizzate per la memoria durevoli può essere di oltre due volte maggiore delle dimensioni delle tabelle in memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-240">After accounting for the storage taken by CFPs in various states, the overall storage taken by durable memory-optimized tables can be much larger than 2 times the size of the tables in memory.</span></span> <span data-ttu-id="27892-241">È possibile eseguire una query sulla DMV [sys. dm_db_xtp_checkpoint_files &#40;&#41;Transact-SQL](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql) per elencare tutti gli CFPS nel filegroup ottimizzato per la memoria, inclusa la fase.</span><span class="sxs-lookup"><span data-stu-id="27892-241">The DMV [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql) can be queried to list all the CFPs in the memory-optimized filegroup, including their phase.</span></span> <span data-ttu-id="27892-242">La transizione delle coppie di file di checkpoint dallo stato MERGE SOURCE a TOMBSTONE e infine a Garbage Collection può richiedere fino a cinque checkpoint, con ogni checkpoint seguito da un backup del log delle transazioni, se il database è configurato per il modello di recupero con registrazione completa o con registrazione minima delle operazioni bulk.</span><span class="sxs-lookup"><span data-stu-id="27892-242">Transitioning CFPs from MERGE SOURCE state to TOMBSTONE and ultimately garbage collection can take up five checkpoints, with each checkpoint followed by a transaction log backup, if the database is configured for full or bulk-logged recovery model.</span></span>

 <span data-ttu-id="27892-243">È possibile forzare manualmente il checkpoint seguito dal backup del log per velocizzare il processo di Garbage Collection, ma questa operazione aggiungerà 5 coppie di file di checkpoint vuoti (5 coppie di file di dati/differenziali con un file di dati di 128 MB ciascuno).</span><span class="sxs-lookup"><span data-stu-id="27892-243">You can manually force the checkpoint followed by log backup to expedite the garbage collection but then this will add 5 empty CFPs (5 data/delta file pairs with data file of size 128MB each).</span></span> <span data-ttu-id="27892-244">Negli scenari di produzione, i checkpoint e i backup del log automatici eseguiti come parte della strategia di backup effettuano la transazione delle coppie di file di checkpoint attraverso queste fasi senza richiedere alcun intervento manuale.</span><span class="sxs-lookup"><span data-stu-id="27892-244">In production scenarios, the automatic checkpoints and log backups taken as part of backup strategy will seamlessly transition CFPs through these phases without requiring any manual intervention.</span></span> <span data-ttu-id="27892-245">La conseguenza del processo di Garbage Collection è il fatto che i database con tabelle ottimizzate per la memoria possono avere dimensioni di archiviazione maggiori rispetto alle dimensioni in memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-245">The impact of the garbage collection process is that databases with memory-optimized tables may have a larger storage size compared to its size in memory.</span></span> <span data-ttu-id="27892-246">Non è inusuale che le coppie di file di checkpoint abbiano dimensioni quattro volte maggiori di quelle delle tabelle ottimizzate per la memoria durevoli in memoria.</span><span class="sxs-lookup"><span data-stu-id="27892-246">It is not uncommon for CFPs to be up to four times the size of the durable memory-optimized tables in memory.</span></span>

## <a name="see-also"></a><span data-ttu-id="27892-247">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="27892-247">See Also</span></span>
 [<span data-ttu-id="27892-248">Creazione e gestione dell'archiviazione per gli oggetti ottimizzati per la memoria</span><span class="sxs-lookup"><span data-stu-id="27892-248">Creating and Managing Storage for Memory-Optimized Objects</span></span>](creating-and-managing-storage-for-memory-optimized-objects.md)


