---
title: Misurare la latenza e convalidare le connessioni per la replica transazionale | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Replication Monitor, performance
- tracer tokens [SQL Server replication]
- latency [SQL Server replication]
- transactional replication, tracer tokens
- monitoring performance [SQL Server replication], tracer tokens
ms.assetid: 4addd426-7523-4067-8d7d-ca6bae4c9e34
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 3ba1e5eddfdcffa5fbefdea323f110ba9d15ca8c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87626645"
---
# <a name="measure-latency-and-validate-connections-for-transactional-replication"></a><span data-ttu-id="f9ad6-102">Misurazione della latenza e convalida delle connessioni per la replica transazionale</span><span class="sxs-lookup"><span data-stu-id="f9ad6-102">Measure Latency and Validate Connections for Transactional Replication</span></span>
  <span data-ttu-id="f9ad6-103">In questo argomento viene descritto come misurare le connessione di convalida e latenza per la replica transazionale in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] tramite Monitoraggio replica, [!INCLUDE[tsql](../../../includes/tsql-md.md)]o RMO (Replication Management Objects).</span><span class="sxs-lookup"><span data-stu-id="f9ad6-103">This topic describes how to measure latency and validate connections for transactional replication in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using Replication Monitor, [!INCLUDE[tsql](../../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="f9ad6-104">La replica transazionale offre la funzionalità token di traccia, che rappresenta una modalità pratica di misurazione della latenza nelle topologie di replica transazionale e di convalida delle connessioni tra server di pubblicazione, database di distribuzione e Sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-104">Transactional replication provides the tracer token feature, which provides a convenient way to measure latency in transactional replication topologies and to validate the connections between the Publisher, Distributor and Subscribers.</span></span> <span data-ttu-id="f9ad6-105">Un token, ovvero una piccola quantità di dati, viene scritto nel log delle transazioni del database di pubblicazione, contrassegnato come se fosse una comune transazione replicata e inviato tramite il sistema in modo da consentire:</span><span class="sxs-lookup"><span data-stu-id="f9ad6-105">A token (a small amount of data) is written to the transaction log of the publication database, marked as though it were a typical replicated transaction, and sent through the system, allowing a calculation of:</span></span>  
  
-   <span data-ttu-id="f9ad6-106">Il calcolo del tempo che trascorre tra l'esecuzione del commit di una transazione nel server di pubblicazione e l'inserimento del comando corrispondente nel database di distribuzione del server di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-106">How much time elapses between a transaction being committed at the Publisher and the corresponding command being inserted in the distribution database at the Distributor.</span></span>  
  
-   <span data-ttu-id="f9ad6-107">Il calcolo del tempo che trascorre tra l'inserimento di un comando nel database di distribuzione e l'esecuzione del commit della transazione corrispondente nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-107">How much time elapses between a command being inserted in the distribution database and the corresponding transaction being committed at a Subscriber.</span></span>  
  
 <span data-ttu-id="f9ad6-108">I risultati ottenuti da questi calcoli consentono all'utente di rispondere a una serie di domande, incluse le seguenti:</span><span class="sxs-lookup"><span data-stu-id="f9ad6-108">From these calculations, you can answer a number of questions, including:</span></span>  
  
-   <span data-ttu-id="f9ad6-109">Quali Sottoscrittori hanno richiesto più tempo per ricevere una modifica dal server di pubblicazione?</span><span class="sxs-lookup"><span data-stu-id="f9ad6-109">Which Subscribers take the longest to receive a change from the Publisher?</span></span>  
  
-   <span data-ttu-id="f9ad6-110">Tra i Sottoscrittori destinati a ricevere il token di traccia, quali non lo hanno eventualmente ricevuto?</span><span class="sxs-lookup"><span data-stu-id="f9ad6-110">Of the Subscribers expected to receive the tracer token, which, if any, have not received it?</span></span>  
  
 <span data-ttu-id="f9ad6-111">**Contenuto dell'articolo**</span><span class="sxs-lookup"><span data-stu-id="f9ad6-111">**In This Topic**</span></span>  
  
-   <span data-ttu-id="f9ad6-112">**Prima di iniziare:**</span><span class="sxs-lookup"><span data-stu-id="f9ad6-112">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="f9ad6-113">Limitazioni e restrizioni</span><span class="sxs-lookup"><span data-stu-id="f9ad6-113">Limitations and Restrictions</span></span>](#Restrictions)  
  
-   <span data-ttu-id="f9ad6-114">**Per misurare la latenza e convalidare le connessioni, utilizzando:**</span><span class="sxs-lookup"><span data-stu-id="f9ad6-114">**To measure latency and validate connections, using:**</span></span>  
  
     [<span data-ttu-id="f9ad6-115">Monitoraggio replica per SQL Server</span><span class="sxs-lookup"><span data-stu-id="f9ad6-115">SQL Server Replication Monitor</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="f9ad6-116">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="f9ad6-116">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="f9ad6-117">oggetti RMO (Replication Management Objects)</span><span class="sxs-lookup"><span data-stu-id="f9ad6-117">Replication Management Objects</span></span>](#RMOProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="f9ad6-118">Prima di iniziare</span><span class="sxs-lookup"><span data-stu-id="f9ad6-118">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="f9ad6-119">Limitazioni e restrizioni</span><span class="sxs-lookup"><span data-stu-id="f9ad6-119">Limitations and Restrictions</span></span>  
 <span data-ttu-id="f9ad6-120">I token di traccia possono inoltre essere utili quando si mette un sistema in stato di inattività, il che richiede l'arresto di tutte le attività e la verifica dell'avvenuta ricezione di tutte le modifiche in attesa da parte di tutti i nodi.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-120">Tracer tokens can also be useful when quiescing a system, which involves stopping all activity and verifying that all nodes have received all outstanding changes.</span></span> <span data-ttu-id="f9ad6-121">Per altre informazioni, vedere [Come mettere una topologia di replica in stato di inattività &#40;programmazione Transact-SQL della replica&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span><span class="sxs-lookup"><span data-stu-id="f9ad6-121">For more information, see [Quiesce a Replication Topology &#40;Replication Transact-SQL Programming&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span></span>  
  
 <span data-ttu-id="f9ad6-122">Per utilizzare i token di traccia, è necessario utilizzare determinate versioni di [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="f9ad6-122">To use tracer tokens, you must use certain versions of [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>  
  
-   <span data-ttu-id="f9ad6-123">Il server di distribuzione deve essere [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-123">The Distributor must be [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span>  
  
-   <span data-ttu-id="f9ad6-124">Il server di pubblicazione deve essere [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] o versione successiva, oppure deve essere un server di pubblicazione Oracle.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-124">The Publisher must be [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later or be an Oracle Publisher.</span></span>  
  
-   <span data-ttu-id="f9ad6-125">Per le sottoscrizioni push, le statistiche dei token di traccia vengono raccolte dal server di pubblicazione, dal server di distribuzione e dai Sottoscrittori se il Sottoscrittore è [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7,0.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-125">For push subscriptions, tracer token statistics are gathered from the Publisher, Distributor, and Subscribers if the Subscriber is [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7.0 or later.</span></span>  
  
-   <span data-ttu-id="f9ad6-126">Per le sottoscrizioni pull, le statistiche dei token di traccia vengono raccolte dai soli Sottoscrittori se il Sottoscrittore è [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-126">For pull subscriptions, tracer token statistics are gathered from Subscribers only if the Subscriber is [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span> <span data-ttu-id="f9ad6-127">Se il Sottoscrittore è [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7,0 o [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2000](../../../includes/ssversion2000-md.md)] , le statistiche vengono raccolte solo dal server di pubblicazione e dal server di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-127">If the Subscriber is [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7.0 or [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2000](../../../includes/ssversion2000-md.md)], statistics are gathered only from the Publisher and Distributor.</span></span>  
  
 <span data-ttu-id="f9ad6-128">È inoltre necessario considerare altre problematiche e limitazioni, ovvero:</span><span class="sxs-lookup"><span data-stu-id="f9ad6-128">There are also a number of other issues and restrictions to be aware of:</span></span>  
  
-   <span data-ttu-id="f9ad6-129">Per poter ricevere un token di traccia, le sottoscrizioni devono essere attive.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-129">Subscriptions must be active to receive a tracer token.</span></span> <span data-ttu-id="f9ad6-130">Una sottoscrizione è attiva se è stata inizializzata.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-130">A subscription is active if it has been initialized.</span></span>  
  
-   <span data-ttu-id="f9ad6-131">La reinizializzazione elimina i token di traccia in sospeso per le relative sottoscrizioni.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-131">Reinitialization removes any pending tracer tokens for the relevant subscriptions.</span></span>  
  
-   <span data-ttu-id="f9ad6-132">I Sottoscrittori ricevono solo i token di traccia creati dopo la sincronizzazione iniziale.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-132">Subscribers only receive tracer tokens that were created after their initial synchronization.</span></span>  
  
-   <span data-ttu-id="f9ad6-133">I token di traccia non vengono inoltrati dai Sottoscrittori di ripubblicazione.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-133">Tracer tokens are not forwarded by republishing Subscribers.</span></span>  
  
-   <span data-ttu-id="f9ad6-134">Dopo il failover a un database secondario, Monitoraggio replica non è in grado di regolare il nome dell'istanza di pubblicazione di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] e continuerà a visualizzare informazioni sulla replica con il nome dell'istanza primaria originale di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f9ad6-134">After failover to a secondary, Replication Monitor is unable to adjust the name of the publishing instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and will continue to display replication information under the name of the original primary instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f9ad6-135">Dopo il failover, non è possibile immettere un token di traccia tramite Monitoraggio replica, nondimeno un token di traccia immesso nel nuovo server di pubblicazione tramite [!INCLUDE[tsql](../../../includes/tsql-md.md)]è visibile in Monitoraggio replica.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-135">After failover, a tracer token cannot be entered by using the Replication Monitor, however a tracer token entered on the new publisher by using [!INCLUDE[tsql](../../../includes/tsql-md.md)], is visible in Replication Monitor.</span></span>  
  
##  <a name="using-sql-server-replication-monitor"></a><a name="SSMSProcedure"></a><span data-ttu-id="f9ad6-136">Utilizzo di replica di SQL Server Monitor</span><span class="sxs-lookup"><span data-stu-id="f9ad6-136">Using SQL Server Replication Monitor</span></span>  
 <span data-ttu-id="f9ad6-137">Per informazioni sull'avvio di Monitoraggio replica, vedere [Avviare Monitoraggio replica](start-the-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="f9ad6-137">For information about starting Replication Monitor, see [Start the Replication Monitor](start-the-replication-monitor.md).</span></span>  
  
#### <a name="to-insert-a-tracer-token-and-view-information-on-the-token"></a><span data-ttu-id="f9ad6-138">Per inserire un token di traccia e visualizzarne le informazioni</span><span class="sxs-lookup"><span data-stu-id="f9ad6-138">To insert a tracer token and view information on the token</span></span>  
  
1.  <span data-ttu-id="f9ad6-139">Espandere un gruppo di server di pubblicazione nel riquadro sinistro, espandere un server di pubblicazione e quindi fare clic su una pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-139">Expand a Publisher group in the left pane, expand a Publisher, and then click a publication.</span></span>  
  
2.  <span data-ttu-id="f9ad6-140">Fare clic sulla scheda **Token di traccia** .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-140">Click the **Tracer Tokens** tab.</span></span>  
  
3.  <span data-ttu-id="f9ad6-141">Fare clic su **Inserisci utilità di traccia**.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-141">Click **Insert Tracer**.</span></span>  
  
4.  <span data-ttu-id="f9ad6-142">Visualizzare il tempo trascorso per il token di traccia nelle colonne **Dal server di pubblicazione al server di distribuzione**, **Dal server di distribuzione al Sottoscrittore**e **Latenza totale**.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-142">View elapsed time for the tracer token in the following columns: **Publisher to Distributor**, **Distributor to Subscriber**, **Total Latency**.</span></span> <span data-ttu-id="f9ad6-143">Il valore **in sospeso** indica che il token non ha raggiunto un determinato punto.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-143">A value of **Pending** indicates that the token has not reached a given point.</span></span>  
  
#### <a name="to-view-information-on-a-tracer-token-inserted-previously"></a><span data-ttu-id="f9ad6-144">Per visualizzare informazioni su un token di traccia inserito in precedenza</span><span class="sxs-lookup"><span data-stu-id="f9ad6-144">To view information on a tracer token inserted previously</span></span>  
  
1.  <span data-ttu-id="f9ad6-145">Espandere un gruppo di server di pubblicazione nel riquadro sinistro, espandere un server di pubblicazione e quindi fare clic su una pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-145">Expand a Publisher group in the left pane, expand a Publisher, and then click a publication.</span></span>  
  
2.  <span data-ttu-id="f9ad6-146">Fare clic sulla scheda **Token di traccia** .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-146">Click the **Tracer Tokens** tab.</span></span>  
  
3.  <span data-ttu-id="f9ad6-147">Selezionare un'ora dall'elenco a discesa **Ora di inserimento** .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-147">Select a time from the **Time inserted** drop-down list.</span></span>  
  
4.  <span data-ttu-id="f9ad6-148">Visualizzare il tempo trascorso per il token di traccia nelle colonne **Dal server di pubblicazione al server di distribuzione**, **Dal server di distribuzione al Sottoscrittore**e **Latenza totale**.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-148">View elapsed time for the tracer token in the following columns: **Publisher to Distributor**, **Distributor to Subscriber**, **Total Latency**.</span></span> <span data-ttu-id="f9ad6-149">Il valore **in sospeso** indica che il token non ha raggiunto un determinato punto.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-149">A value of **Pending** indicates that the token has not reached a given point.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="f9ad6-150">Le informazioni sul token di traccia vengono mantenute per lo stesso periodo di tempo degli altri dati cronologici, ovvero in base all'impostazione del periodo di memorizzazione della cronologia del database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-150">Tracer token information is retained for the same time period as other historical data, which is governed by the history retention period of the distribution database.</span></span> <span data-ttu-id="f9ad6-151">Per informazioni sulla modifica delle proprietà del database di distribuzione, vedere [Visualizzare e modificare le proprietà del server di pubblicazione e del database di distribuzione](../view-and-modify-distributor-and-publisher-properties.md).</span><span class="sxs-lookup"><span data-stu-id="f9ad6-151">For information about changing distribution database properties, see [View and Modify Distributor and Publisher Properties](../view-and-modify-distributor-and-publisher-properties.md).</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="f9ad6-152">Uso di Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="f9ad6-152">Using Transact-SQL</span></span>  
  
#### <a name="to-post-a-tracer-token-to-a-transactional-publication"></a><span data-ttu-id="f9ad6-153">Per inviare un token di traccia a una pubblicazione transazionale</span><span class="sxs-lookup"><span data-stu-id="f9ad6-153">To post a tracer token to a transactional publication</span></span>  
  
1.  <span data-ttu-id="f9ad6-154">(Facoltativo) Nel database di pubblicazione del server di pubblicazione eseguire [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f9ad6-154">(Optional) At the Publisher on the publication database, execute [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span> <span data-ttu-id="f9ad6-155">Verificare che la pubblicazione esista e che lo stato sia attivo.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-155">Verify that the publication exists and that the status is active.</span></span>  
  
2.  <span data-ttu-id="f9ad6-156">(Facoltativo) Nel database di pubblicazione del server di pubblicazione eseguire [sp_helpsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f9ad6-156">(Optional) At the Publisher on the publication database, execute [sp_helpsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpsubscription-transact-sql).</span></span> <span data-ttu-id="f9ad6-157">Verificare che la sottoscrizione esista e che lo stato sia attivo.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-157">Verify that the subscription exists and that the status is active.</span></span>  
  
3.  <span data-ttu-id="f9ad6-158">Nel database di pubblicazione del server di pubblicazione eseguire [sp_posttracertoken &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-posttracertoken-transact-sql) specificando **@publication**.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-158">At the Publisher on the publication database, execute [sp_posttracertoken &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-posttracertoken-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="f9ad6-159">Prendere nota del valore del **@tracer_token_id** parametro di output.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-159">Note the value of the **@tracer_token_id** output parameter.</span></span>  
  
#### <a name="to-determine-latency-and-validate-connections-for-a-transactional-publication"></a><span data-ttu-id="f9ad6-160">Per determinare la latenza e convalidare le connessioni per una pubblicazione transazionale</span><span class="sxs-lookup"><span data-stu-id="f9ad6-160">To determine latency and validate connections for a transactional publication</span></span>  
  
1.  <span data-ttu-id="f9ad6-161">Inviare un token di traccia alla pubblicazione utilizzando la procedura precedente.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-161">Post a tracer token to the publication using the previous procedure.</span></span>  
  
2.  <span data-ttu-id="f9ad6-162">Nel database di pubblicazione del server di pubblicazione eseguire [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql) specificando **@publication**.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-162">At the Publisher on the publication database, execute [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="f9ad6-163">Viene restituito un elenco di tutti i token di traccia inviati alla pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-163">This returns a list of all tracer tokens posted to the publication.</span></span> <span data-ttu-id="f9ad6-164">Tenere presente il valore di **tracer_id** desiderato nel set di risultati.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-164">Note the desired **tracer_id** in the result set.</span></span>  
  
3.  <span data-ttu-id="f9ad6-165">Nel database di pubblicazione del server di pubblicazione eseguire [sp_helptracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokenhistory-transact-sql) specificando **@publication** e l'ID del token di traccia indicato nel passaggio 2 per **@tracer_id**.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-165">At the Publisher on the publication database, execute [sp_helptracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokenhistory-transact-sql), specifying **@publication** and the tracer token ID from step 2 for **@tracer_id**.</span></span> <span data-ttu-id="f9ad6-166">Vengono restituite le informazioni sulla latenza per il token di traccia selezionato.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-166">This returns latency information for the selected tracer token.</span></span>  
  
#### <a name="to-remove-tracer-tokens"></a><span data-ttu-id="f9ad6-167">Per rimuovere token di traccia</span><span class="sxs-lookup"><span data-stu-id="f9ad6-167">To remove tracer tokens</span></span>  
  
1.  <span data-ttu-id="f9ad6-168">Nel database di pubblicazione del server di pubblicazione eseguire [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql) specificando **@publication**.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-168">At the Publisher on the publication database, execute [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="f9ad6-169">Viene restituito un elenco di tutti i token di traccia inviati alla pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-169">This returns a list of all tracer tokens posted to the publication.</span></span> <span data-ttu-id="f9ad6-170">Tenere presente il valore di **tracer_id** del token di traccia da eliminare nel set di risultati.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-170">Note the **tracer_id** for the tracer token to delete in the result set.</span></span>  
  
2.  <span data-ttu-id="f9ad6-171">Nel database di pubblicazione del server di pubblicazione eseguire [sp_deletetracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-deletetracertokenhistory-transact-sql) specificando **@publication** e l'ID del token di traccia da eliminare indicato nel passaggio 2 per **@tracer_id**.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-171">At the Publisher on the publication database, execute [sp_deletetracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-deletetracertokenhistory-transact-sql), specifying **@publication** and the ID of the tracer to delete from step 2 for **@tracer_id**.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="f9ad6-172">Esempio (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f9ad6-172">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="f9ad6-173">In questo esempio viene inserito un record di token di traccia e viene utilizzato l'ID restituito del token di traccia inviato per visualizzare le informazioni sulla latenza.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-173">This example posts a tracer token record and uses the returned ID of the posted tracer token to view latency information.</span></span>  
  
 [!code-sql[HowTo#sp_tracertokens](../../../snippets/tsql/SQL15/replication/howto/tsql/createtracertokens.sql#sp_tracertokens)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="f9ad6-174">Utilizzo di RMO (Replication Management Objects)</span><span class="sxs-lookup"><span data-stu-id="f9ad6-174">Using Replication Management Objects (RMO)</span></span>  
  
#### <a name="to-post-a-tracer-token-to-a-transactional-publication"></a><span data-ttu-id="f9ad6-175">Per inviare un token di traccia a una pubblicazione transazionale</span><span class="sxs-lookup"><span data-stu-id="f9ad6-175">To post a tracer token to a transactional publication</span></span>  
  
1.  <span data-ttu-id="f9ad6-176">Creare una connessione al server di pubblicazione tramite la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-176">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="f9ad6-177">Creare un'istanza della classe <xref:Microsoft.SqlServer.Replication.TransPublication>.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-177">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class.</span></span>  
  
3.  <span data-ttu-id="f9ad6-178">Impostare le proprietà <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> e <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> per la pubblicazione, quindi impostare la proprietà <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> sulla connessione creata nel passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-178">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="f9ad6-179">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> per recuperare le proprietà dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-179">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="f9ad6-180">Se questo metodo restituisce `false`, le proprietà della pubblicazione sono state definite in modo non corretto nel passaggio 3 oppure la pubblicazione non esiste.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-180">If this method returns `false`, either the publication properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="f9ad6-181">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.TransPublication.PostTracerToken%2A> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-181">Call the <xref:Microsoft.SqlServer.Replication.TransPublication.PostTracerToken%2A> method.</span></span> <span data-ttu-id="f9ad6-182">Questo metodo inserisce un token di traccia nel log delle transazioni della pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-182">This method inserts a tracer token into the publication's transaction log.</span></span>  
  
#### <a name="to-determine-latency-and-validate-connections-for-a-transactional-publication"></a><span data-ttu-id="f9ad6-183">Per determinare la latenza e convalidare le connessioni per una pubblicazione transazionale</span><span class="sxs-lookup"><span data-stu-id="f9ad6-183">To determine latency and validate connections for a transactional publication</span></span>  
  
1.  <span data-ttu-id="f9ad6-184">Creare una connessione al server di distribuzione tramite la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-184">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="f9ad6-185">Creare un'istanza della classe <xref:Microsoft.SqlServer.Replication.PublicationMonitor>.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-185">Create an instance of the <xref:Microsoft.SqlServer.Replication.PublicationMonitor> class.</span></span>  
  
3.  <span data-ttu-id="f9ad6-186">Impostare le proprietà <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>e <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> , quindi impostare la proprietà <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> sulla connessione creata nel passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-186">Set the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>, and <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> properties, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="f9ad6-187">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> per recuperare le proprietà dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-187">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="f9ad6-188">Se questo metodo restituisce `false`, le proprietà di monitoraggio della pubblicazione sono state definite in modo non corretto nel passaggio 3 oppure la pubblicazione non esiste.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-188">If this method returns `false`, either the publication monitor properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="f9ad6-189">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-189">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> method.</span></span> <span data-ttu-id="f9ad6-190">Eseguire il cast dell'oggetto <xref:System.Collections.ArrayList> restituito in una matrice di oggetti <xref:Microsoft.SqlServer.Replication.TracerToken> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-190">Cast the returned <xref:System.Collections.ArrayList> object to an array of <xref:Microsoft.SqlServer.Replication.TracerToken> objects.</span></span>  
  
6.  <span data-ttu-id="f9ad6-191">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokenHistory%2A> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-191">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokenHistory%2A> method.</span></span> <span data-ttu-id="f9ad6-192">Passare un valore di <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> per un token di traccia indicato nel passaggio 5.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-192">Pass a value of <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> for a tracer token from step 5.</span></span> <span data-ttu-id="f9ad6-193">Le informazioni sulla latenza per il token di traccia selezionato vengono restituite come oggetto <xref:System.Data.DataSet> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-193">This returns latency information for the selected tracer token as a <xref:System.Data.DataSet> object.</span></span> <span data-ttu-id="f9ad6-194">Se vengono restituite tutte le informazioni sul token di traccia, la connessione tra server di pubblicazione e server di distribuzione e la connessione tra server di distribuzione e Sottoscrittore esistono e la topologia di replica funziona correttamente.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-194">If all tracer token information is returned, the connection between the Publisher and Distributor and the connection between the Distributor and the Subscriber both exist and the replication topology is functioning.</span></span>  
  
#### <a name="to-remove-tracer-tokens"></a><span data-ttu-id="f9ad6-195">Per rimuovere token di traccia</span><span class="sxs-lookup"><span data-stu-id="f9ad6-195">To remove tracer tokens</span></span>  
  
1.  <span data-ttu-id="f9ad6-196">Creare una connessione al server di distribuzione tramite la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-196">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="f9ad6-197">Creare un'istanza della classe <xref:Microsoft.SqlServer.Replication.PublicationMonitor>.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-197">Create an instance of the <xref:Microsoft.SqlServer.Replication.PublicationMonitor> class.</span></span>  
  
3.  <span data-ttu-id="f9ad6-198">Impostare le proprietà <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>e <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> , quindi impostare la proprietà <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> sulla connessione creata nel passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-198">Set the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>, and <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> properties, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="f9ad6-199">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> per recuperare le proprietà dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-199">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="f9ad6-200">Se questo metodo restituisce `false`, le proprietà di monitoraggio della pubblicazione sono state definite in modo non corretto nel passaggio 3 oppure la pubblicazione non esiste.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-200">If this method returns `false`, either the publication monitor properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="f9ad6-201">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-201">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> method.</span></span> <span data-ttu-id="f9ad6-202">Eseguire il cast dell'oggetto <xref:System.Collections.ArrayList> restituito in una matrice di oggetti <xref:Microsoft.SqlServer.Replication.TracerToken> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-202">Cast the returned <xref:System.Collections.ArrayList> object to an array of <xref:Microsoft.SqlServer.Replication.TracerToken> objects.</span></span>  
  
6.  <span data-ttu-id="f9ad6-203">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.PublicationMonitor.CleanUpTracerTokenHistory%2A> .</span><span class="sxs-lookup"><span data-stu-id="f9ad6-203">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.CleanUpTracerTokenHistory%2A> method.</span></span> <span data-ttu-id="f9ad6-204">Passare uno dei valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="f9ad6-204">Pass one of the following values:</span></span>  
  
    -   <span data-ttu-id="f9ad6-205">La proprietà <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> per un token di traccia indicato al passaggio 5.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-205">The <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> for a tracer token from step 5.</span></span> <span data-ttu-id="f9ad6-206">Vengono eliminate le informazioni per un token selezionato.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-206">This deletes information for a selected token.</span></span>  
  
    -   <span data-ttu-id="f9ad6-207">Un oggetto <xref:System.DateTime>.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-207">A <xref:System.DateTime> object.</span></span> <span data-ttu-id="f9ad6-208">Vengono eliminate le informazioni per tutti i token con data e ora precedenti a quelle specificate.</span><span class="sxs-lookup"><span data-stu-id="f9ad6-208">This deletes information for all tokens older than the specified date and time.</span></span>  
  
###  <a name="PShellExample"></a>  
