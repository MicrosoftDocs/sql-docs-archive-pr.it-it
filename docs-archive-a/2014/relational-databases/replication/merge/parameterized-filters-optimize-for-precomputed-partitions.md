---
title: Ottimizzare le prestazioni dei filtri con parametri con le partizioni pre-calcolate | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- precomputed partitions [SQL Server replication]
- merge replication precomputed partitions [SQL Server replication]
- merge replication precomputed partitions [SQL Server replication], about precomputed partitions
ms.assetid: 85654bf4-e25f-4f04-8e34-bbbd738d60fa
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 4ad0a33f0a5951256ff94bc78e7f09a88c05f227
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87724519"
---
# <a name="optimize-parameterized-filter-performance-with-precomputed-partitions"></a><span data-ttu-id="d1775-102">Ottimizzazione delle prestazioni dei filtri con parametri con le partizioni pre-calcolate</span><span class="sxs-lookup"><span data-stu-id="d1775-102">Optimize Parameterized Filter Performance with Precomputed Partitions</span></span>
  <span data-ttu-id="d1775-103">Le partizioni pre-calcolate consentono di ottimizzare le prestazioni e possono essere utilizzate con le pubblicazioni di tipo merge filtrate.</span><span class="sxs-lookup"><span data-stu-id="d1775-103">Precomputed partitions is a performance optimization that can be used with filtered merge publications.</span></span> <span data-ttu-id="d1775-104">Rappresentano inoltre un requisito per l'utilizzo dei record logici sulle pubblicazioni filtrate.</span><span class="sxs-lookup"><span data-stu-id="d1775-104">Precomputed partitions is also a requirement for using logical records on filtered publications.</span></span> <span data-ttu-id="d1775-105">Per altre informazioni sui record logici, vedere [Raggruppare modifiche alle righe correlate con record logici](group-changes-to-related-rows-with-logical-records.md).</span><span class="sxs-lookup"><span data-stu-id="d1775-105">For more information about logical records, see [Group Changes to Related Rows with Logical Records](group-changes-to-related-rows-with-logical-records.md).</span></span>  
  
 <span data-ttu-id="d1775-106">Quando viene eseguita la sincronizzazione tra un Sottoscrittore e un server di pubblicazione, quest'ultimo deve valutare i filtri del Sottoscrittore per stabilire quali righe appartengono alla partizione o al set di dati di tale Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="d1775-106">When a Subscriber synchronizes with a Publisher, the Publisher must evaluate the Subscriber's filters to determine which rows belong to that Subscriber's partition, or data set.</span></span> <span data-ttu-id="d1775-107">Questo processo di determinazione dell'appartenenza alla partizione delle modifiche del server di pubblicazione per ogni Sottoscrittore che riceve un set di dati filtrato viene definita *valutazione della partizione*.</span><span class="sxs-lookup"><span data-stu-id="d1775-107">This process of determining partition membership of changes at the Publisher for each Subscriber receiving a filtered dataset is referred to as *partition evaluation*.</span></span> <span data-ttu-id="d1775-108">In assenza di partizioni pre-calcolate, la valutazione della partizione deve essere eseguita per ogni modifica apportata a una colonna filtrata nel server di pubblicazione dall'ultima esecuzione dell'agente di merge per uno specifico Sottoscrittore e questo processo deve essere ripetuto per ogni Sottoscrittore sincronizzato con il server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="d1775-108">Without precomputed partitions, partition evaluation must be performed for each change made to a filtered column at the Publisher since the last time the Merge Agent ran for a specific Subscriber, and this process has to be repeated for every Subscriber that synchronizes with the Publisher.</span></span>  
  
 <span data-ttu-id="d1775-109">Tuttavia, se il server di pubblicazione e il Sottoscrittore sono in esecuzione in [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] o versione successiva e si utilizzano partizioni pre-calcolate, l'appartenenza alla partizione per tutte le modifiche nel server di pubblicazione viene pre-calcolata e resa permanente nel momento in cui vengono apportate le modifiche.</span><span class="sxs-lookup"><span data-stu-id="d1775-109">However, if the Publisher and Subscriber are running on [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version and you use precomputed partitions, partition membership for all changes at the Publisher is precomputed and persisted at the time that the changes are made.</span></span> <span data-ttu-id="d1775-110">Di conseguenza, quando un Sottoscrittore viene sincronizzato con il server di pubblicazione, può iniziare immediatamente a scaricare le modifiche relative alla propria partizione senza essere sottoposto al processo di valutazione della partizione.</span><span class="sxs-lookup"><span data-stu-id="d1775-110">As a result, when a Subscriber synchronizes with the Publisher, it can immediately start to download changes relevant to its partition without having to go through the partition evaluation process.</span></span> <span data-ttu-id="d1775-111">In questo modo è possibile ottenere significativi miglioramenti delle prestazioni quando una pubblicazione presenta un numero elevato di modifiche, Sottoscrittori o articoli.</span><span class="sxs-lookup"><span data-stu-id="d1775-111">This can lead to significant performance gains when a publication has a large number of changes, Subscribers, or articles in the publication.</span></span>  
  
 <span data-ttu-id="d1775-112">Oltre a utilizzare partizioni pre-calcolate, creare snapshot preliminari e/o consentire ai Sottoscrittori di richiedere la generazione e l'applicazione di snapshot alla prima sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="d1775-112">In addition to using precomputed partitions, pre-generate snapshots and/or allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span> <span data-ttu-id="d1775-113">Utilizzare una o entrambe le opzioni per generare snapshot per le pubblicazioni che utilizzando filtri con parametri.</span><span class="sxs-lookup"><span data-stu-id="d1775-113">Use one or both of these options to provide snapshots for publications that use parameterized filters.</span></span> <span data-ttu-id="d1775-114">Se non si specifica alcuna opzione, le sottoscrizioni vengono inizializzate tramite una serie di istruzioni SELECT e INSERT, anziché tramite l'utilità **bcp** . Questo processo risulta decisamente più lento.</span><span class="sxs-lookup"><span data-stu-id="d1775-114">If you do not specify one of these options, subscriptions are initialized using a series of SELECT and INSERT statements, rather than using the **bcp** utility; this process is much slower.</span></span> <span data-ttu-id="d1775-115">Per altre informazioni, vedere [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="d1775-115">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
 <span data-ttu-id="d1775-116">**Per utilizzare le partizioni pre-calcolate**</span><span class="sxs-lookup"><span data-stu-id="d1775-116">**To use precomputed partitions**</span></span>  
  
 <span data-ttu-id="d1775-117">Per impostazione predefinita, le partizioni pre-calcolate sono abilitate su tutte le pubblicazioni nuove ed esistenti che rispettano le indicazioni descritte sopra.</span><span class="sxs-lookup"><span data-stu-id="d1775-117">Precomputed partitions are enabled by default on all new and existing publications that adhere to the guidelines described above.</span></span> <span data-ttu-id="d1775-118">È possibile modificare l'impostazione mediante [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] o a livello di programmazione.</span><span class="sxs-lookup"><span data-stu-id="d1775-118">The setting can be changed through [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or programmatically.</span></span> <span data-ttu-id="d1775-119">Per altre informazioni, vedere [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="d1775-119">For more information, see [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span></span>  
  
## <a name="requirements-for-using-precomputed-partitions"></a><span data-ttu-id="d1775-120">Requisiti per l'utilizzo delle partizioni pre-calcolate</span><span class="sxs-lookup"><span data-stu-id="d1775-120">Requirements for Using Precomputed Partitions</span></span>  
 <span data-ttu-id="d1775-121">Se vengono soddisfatti i requisiti riportati di seguito, per impostazione predefinita le nuove pubblicazioni di tipo merge vengono create con le partizioni pre-calcolate abilitate e quelle esistenti vengono automaticamente aggiornate per l'utilizzo di tale funzionalità.</span><span class="sxs-lookup"><span data-stu-id="d1775-121">If the following requirements are met, new merge publications are, by default, created with precomputed partitions enabled, and existing publications are automatically upgraded to use the feature.</span></span> <span data-ttu-id="d1775-122">Se una pubblicazione non soddisfa i requisiti, è possibile modificarla e quindi procedere all'abilitazione delle partizioni pre-calcolate.</span><span class="sxs-lookup"><span data-stu-id="d1775-122">If a publication does not meet the requirements, it can be changed, and then precomputed partitions can be enabled.</span></span> <span data-ttu-id="d1775-123">Se solo alcuni articoli soddisfano questi requisiti, provare a creare due pubblicazioni, abilitandone solo una per le partizioni pre-calcolate.</span><span class="sxs-lookup"><span data-stu-id="d1775-123">If some articles meet these requirements and some do not, consider creating two publications, with one enabled for precomputed partitions.</span></span>  
  
### <a name="requirements-for-filter-clauses"></a><span data-ttu-id="d1775-124">Requisiti per le clausole di filtro</span><span class="sxs-lookup"><span data-stu-id="d1775-124">Requirements for Filter Clauses</span></span>  
  
-   <span data-ttu-id="d1775-125">Le funzioni utilizzate nei filtri di riga con parametri, quali HOST_NAME() e SUSER_SNAME(), devono essere visualizzate direttamente nella clausola di filtro con parametri e non devono essere nidificate all'interno di una vista o di una funzione dinamica.</span><span class="sxs-lookup"><span data-stu-id="d1775-125">Any functions used in parameterized row filters, such as HOST_NAME() and SUSER_SNAME(), should appear directly in the parameterized filter clause and not be nested inside of a view or dynamic function.</span></span> <span data-ttu-id="d1775-126">Per altre informazioni su queste funzioni, vedere [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql), [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) e [Filtri di riga con parametri](parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="d1775-126">For more information about these functions, see [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql), [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), and [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="d1775-127">I valori restituiti per ogni Sottoscrittore non devono essere modificati in seguito alla creazione della partizione.</span><span class="sxs-lookup"><span data-stu-id="d1775-127">The values returned for each Subscriber should not change after the partition is created.</span></span> <span data-ttu-id="d1775-128">Se, ad esempio, si utilizza HOST_NAME() in un filtro, senza sovrascrivere il valore HOST_NAME(), non modificare il nome del computer nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="d1775-128">For example, if you use HOST_NAME() in a filter (and do not override the HOST_NAME() value) do not change the computer name at the Subscriber.</span></span>  
  
-   <span data-ttu-id="d1775-129">I filtri join non devono contenere funzioni dinamiche, ovvero funzioni come HOST_NAME() e SUSER_SNAME() che restituiscono un valore diverso a seconda del Sottoscrittore in fase di sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="d1775-129">Join filters should not contain dynamic functions (functions such as HOST_NAME() and SUSER_SNAME() that evaluate to a different value depending upon the Subscriber that is synchronizing).</span></span> <span data-ttu-id="d1775-130">Solo i filtri di riga con parametri devono contenere funzioni dinamiche.</span><span class="sxs-lookup"><span data-stu-id="d1775-130">Only parameterized row filters should contain dynamic functions.</span></span>  
  
-   <span data-ttu-id="d1775-131">Non è possibile utilizzare funzioni non deterministiche in una clausola di filtro.</span><span class="sxs-lookup"><span data-stu-id="d1775-131">Nondeterministic functions cannot be used in a filter clause.</span></span> <span data-ttu-id="d1775-132">Per altre informazioni sulle funzioni non deterministiche, vedere [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span><span class="sxs-lookup"><span data-stu-id="d1775-132">For more information about nondeterministic functions, see [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span></span>  
  
-   <span data-ttu-id="d1775-133">Le viste a cui viene fatto riferimento nelle clausole relative ai filtri join o ai filtri con parametri non devono contenere funzioni dinamiche.</span><span class="sxs-lookup"><span data-stu-id="d1775-133">Views referenced in join filter clauses or parameterized filter clauses should not contain dynamic functions.</span></span>  
  
-   <span data-ttu-id="d1775-134">Nella pubblicazione non devono essere presenti relazioni circolari tra filtri join.</span><span class="sxs-lookup"><span data-stu-id="d1775-134">There should be no circular join filter relationships in the publication.</span></span>  
  
### <a name="database-collation"></a><span data-ttu-id="d1775-135">Regole di confronto del database</span><span class="sxs-lookup"><span data-stu-id="d1775-135">Database Collation</span></span>  
  
-   <span data-ttu-id="d1775-136">Quando si utilizzano partizioni pre-calcolate, per effettuare confronti vengono sempre utilizzate le regole di confronto del database anziché quelle della tabella o della colonna.</span><span class="sxs-lookup"><span data-stu-id="d1775-136">When precomputed partitions are used, the collation of the database is always used when making comparisons, rather than the collation of the table or column.</span></span> <span data-ttu-id="d1775-137">Si consideri lo scenario seguente:</span><span class="sxs-lookup"><span data-stu-id="d1775-137">Consider the following scenario:</span></span>  
  
    -   <span data-ttu-id="d1775-138">Un database con regole di confronto con distinzione tra maiuscole e minuscole contiene una tabella con regole di confronto per le quali non viene applicata tale distinzione.</span><span class="sxs-lookup"><span data-stu-id="d1775-138">A database with a case-sensitive collation contains a table with a case-insensitive collation.</span></span>  
  
    -   <span data-ttu-id="d1775-139">La tabella contiene la colonna **ComputerName**, che viene confrontata con il nome host del Sottoscrittore in un filtro con parametri.</span><span class="sxs-lookup"><span data-stu-id="d1775-139">The table contains a column **ComputerName**, which is compared against the host name of the Subscriber in a parameterized filter.</span></span>  
  
    -   <span data-ttu-id="d1775-140">La tabella contiene una riga con il valore "MYCOMPUTER" e una riga con il valore "mycomputer" in questa colonna.</span><span class="sxs-lookup"><span data-stu-id="d1775-140">The table contains one row with the value "MYCOMPUTER" and one row with the value "mycomputer" in this column.</span></span>  
  
     <span data-ttu-id="d1775-141">Se il Sottoscrittore viene sincronizzato con il nome host "mycomputer", riceverà solo una riga in quanto il confronto supporta la distinzione tra maiuscole e minuscole (le regole di confronto del database).</span><span class="sxs-lookup"><span data-stu-id="d1775-141">If the Subscriber synchronizes with a host name of "mycomputer", the Subscriber receives only one row because the comparison is case-sensitive (the collation of the database).</span></span> <span data-ttu-id="d1775-142">Se le partizioni pre-calcolate non vengono utilizzate, il Sottoscrittore riceverà entrambe le righe, in quanto le regole di confronto della tabella non supportano la distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="d1775-142">If precomputed partitions are not used, the Subscriber receives both rows, because the table has a case-insensitive collation.</span></span>  
  
## <a name="performance-of-precomputed-partitions"></a><span data-ttu-id="d1775-143">Prestazioni delle partizioni pre-calcolate</span><span class="sxs-lookup"><span data-stu-id="d1775-143">Performance of Precomputed Partitions</span></span>  
 <span data-ttu-id="d1775-144">Il calo delle prestazioni delle partizioni pre-calcolate è ridotto quando le modifiche vengono caricate dal Sottoscrittore nel server di pubblicazione, ma il tempo per l'elaborazione dei processi merge viene impiegato per la valutazione delle partizioni e il download delle modifiche dal server di pubblicazione al Sottoscrittore e pertanto il guadagno netto può risultare ancora significativo.</span><span class="sxs-lookup"><span data-stu-id="d1775-144">There is a small performance cost with precomputed partitions when changes are uploaded from the Subscriber to the Publisher, but the bulk of merge processing time is spent evaluating partitions and downloading changes from the Publisher to the Subscriber, so the net gain can still be significant.</span></span> <span data-ttu-id="d1775-145">I vantaggi in termini di prestazioni varieranno a seconda del numero di Sottoscrittori che eseguono contemporaneamente la sincronizzazione e del numero di aggiornamenti per sincronizzazione che comportano lo spostamento delle righe da una partizione all'altra.</span><span class="sxs-lookup"><span data-stu-id="d1775-145">The performance benefit will vary, depending on the number of Subscribers synchronizing concurrently and the number of updates per synchronization that move rows from one partition to another.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d1775-146">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="d1775-146">See Also</span></span>  
 [<span data-ttu-id="d1775-147">Filtri di riga con parametri</span><span class="sxs-lookup"><span data-stu-id="d1775-147">Parameterized Row Filters</span></span>](parameterized-filters-parameterized-row-filters.md)  
  
  
