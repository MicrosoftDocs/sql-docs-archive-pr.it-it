---
title: Procedure consigliate per i filtri di riga basati sul tempo
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- best practices
ms.assetid: 773c5c62-fd44-44ab-9c6b-4257dbf8ffdb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: ccaafe71d4137fd4b31eec412c1e35595861bdd0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87623208"
---
# <a name="best-practices-for-time-based-row-filters"></a><span data-ttu-id="16754-102">Procedure consigliate per i filtri di riga basati sul tempo</span><span class="sxs-lookup"><span data-stu-id="16754-102">Best Practices for Time-Based Row Filters</span></span>
  <span data-ttu-id="16754-103">Gli utenti delle applicazioni hanno spesso la necessità di recuperare da diverse tabelle determinati subset di dati basati sul tempo.</span><span class="sxs-lookup"><span data-stu-id="16754-103">Users of applications often require a time-based subset of data from a table.</span></span> <span data-ttu-id="16754-104">Un venditore potrebbe ad esempio richiedere i dati relativi agli ordini dell'ultima settimana, così come un responsabile della pianificazione di eventi potrebbe aver bisogno di recuperare i dati relativi agli eventi della settimana in arrivo.</span><span class="sxs-lookup"><span data-stu-id="16754-104">For instance, a salesperson might require data for orders in the last week, or an event planner might require data for events in the upcoming week.</span></span> <span data-ttu-id="16754-105">Per soddisfare queste richieste, le applicazioni utilizzano, in numerosi casi, query contenenti la funzione `GETDATE()`.</span><span class="sxs-lookup"><span data-stu-id="16754-105">In many cases, applications use queries containing the `GETDATE()` function to accomplish this.</span></span> <span data-ttu-id="16754-106">Si consideri l'istruzione di filtro di riga seguente:</span><span class="sxs-lookup"><span data-stu-id="16754-106">Consider the following row filter statement:</span></span>  
  
```  
WHERE SalesPersonID = CONVERT(INT,HOST_NAME()) AND OrderDate >= (GETDATE()-6)  
```  
  
 <span data-ttu-id="16754-107">Con un filtro di questo tipo, l'esecuzione dell'agente di merge ha in genere due risultati: le righe che soddisfano il filtro vengono replicate nei Sottoscrittori, mentre le righe che non soddisfano più il filtro vengono rimosse dai Sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="16754-107">With a filter of this type, it is usually assumed that two things always occur when the Merge Agent runs: rows that satisfy this filter are replicated to Subscribers; and rows that no longer satisfy this filter are cleaned up at Subscribers.</span></span> <span data-ttu-id="16754-108">Per ulteriori informazioni sul filtro con `HOST_NAME()` , vedere [filtri di riga con parametri](parameterized-filters-parameterized-row-filters.md). Tuttavia, la replica di tipo merge replica e pulisce solo i dati che sono stati modificati dopo l'ultima sincronizzazione, indipendentemente dalla modalità di definizione di un filtro di riga per tali dati.</span><span class="sxs-lookup"><span data-stu-id="16754-108">(For more information about filtering with `HOST_NAME()`, see [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).) However, merge replication only replicates and cleans up data that has changed since the last synchronization, regardless of how you define a row filter for that data.</span></span>  
  
 <span data-ttu-id="16754-109">Affinché la replica di tipo merge elabori una riga, è necessario che i dati contenuti in tale riga soddisfino il filtro di riga e che siano stati modificati dopo l'ultima sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="16754-109">For merge replication to process a row, the data in the row must satisfy the row filter, and it must have changed since the last synchronization.</span></span> <span data-ttu-id="16754-110">Nel caso della tabella **SalesOrderHeader** , **OrderDate** viene immesso quando si inserisce una riga.</span><span class="sxs-lookup"><span data-stu-id="16754-110">In the case of the **SalesOrderHeader** table, **OrderDate** is entered when a row is inserted.</span></span> <span data-ttu-id="16754-111">Le righe vengono quindi replicate nel Sottoscrittore come previsto poiché l'inserimento rappresenta una modifica ai dati.</span><span class="sxs-lookup"><span data-stu-id="16754-111">Rows are replicated to the Subscriber as expected because the insert is a data change.</span></span> <span data-ttu-id="16754-112">Se tuttavia nel Sottoscrittore sono presenti righe che non soddisfano più il filtro, ovvero sono relative a ordini immessi da più di sette giorni, queste verranno rimosse dal Sottoscrittore a meno che non siano state aggiornate per altri motivi.</span><span class="sxs-lookup"><span data-stu-id="16754-112">However, if there are rows at the Subscriber that no longer satisfy the filter (they are for orders older than seven days), they are not removed from the Subscriber unless they were updated for some other reason.</span></span>  
  
 <span data-ttu-id="16754-113">L'esempio del responsabile della pianificazione di eventi evidenzia ulteriormente il problema legato a questo tipo di filtro.</span><span class="sxs-lookup"><span data-stu-id="16754-113">The case of the event planner further highlights the issue with this type of filtering.</span></span> <span data-ttu-id="16754-114">Si consideri di utilizzare il filtro seguente per una tabella **Events** :</span><span class="sxs-lookup"><span data-stu-id="16754-114">Consider the following filter for an **Events** table:</span></span>  
  
```  
WHERE EventCoordID = CONVERT(INT,HOST_NAME()) AND EventDate <= (GETDATE()+6)  
```  
  
 <span data-ttu-id="16754-115">Per una tabella contenente eventi, gli inserimenti potrebbero essere eseguiti molto prima della data dell'evento.</span><span class="sxs-lookup"><span data-stu-id="16754-115">For a table that contains events, inserts might be made well ahead of the event date.</span></span> <span data-ttu-id="16754-116">Se un mese prima è stato eseguito un inserimento per un evento della settimana successiva a quella corrente, senza che sia stata aggiornata la riga, quest'ultima non verrà replicata nel Sottoscrittore, anche se soddisfa il filtro di riga.</span><span class="sxs-lookup"><span data-stu-id="16754-116">If the insert for an event in the coming week was made a month ago and the row was not updated for another reason, the row is not replicated to the Subscriber even if it satisfies the row filter.</span></span>  
  
 <span data-ttu-id="16754-117">A seconda inoltre della configurazione della pubblicazione, la replica di tipo merge valuta i filtri in momenti diversi:</span><span class="sxs-lookup"><span data-stu-id="16754-117">In addition, depending on how the publication is configured, merge replication evaluates filters at different times:</span></span>  
  
-   <span data-ttu-id="16754-118">Se una pubblicazione utilizza partizioni pre-calcolate, in base all'impostazione predefinita, i filtri vengono valutati ad ogni inserimento o aggiornamento di una riga.</span><span class="sxs-lookup"><span data-stu-id="16754-118">If a publication uses precomputed partitions (the default), filters are evaluated when a row is inserted or updated.</span></span>  
  
-   <span data-ttu-id="16754-119">Se la pubblicazione non utilizza partizioni pre-calcolate, i filtri vengono valutati durante l'esecuzione dell'agente di merge.</span><span class="sxs-lookup"><span data-stu-id="16754-119">If the publication does not use precomputed partitions, filters are evaluated when the Merge Agent runs.</span></span>  
  
 <span data-ttu-id="16754-120">Per altre informazioni sulle partizioni pre-calcolate, vedere [Ottimizzare le prestazioni dei filtri con parametri con le partizioni pre-calcolate](parameterized-filters-optimize-for-precomputed-partitions.md).</span><span class="sxs-lookup"><span data-stu-id="16754-120">For more information about precomputed partitions, see [Optimize Parameterized Filter Performance with Precomputed Partitions](parameterized-filters-optimize-for-precomputed-partitions.md).</span></span> <span data-ttu-id="16754-121">A seconda del momento in cui viene valutato il filtro, il tipo di dati che lo soddisfa sarà diverso.</span><span class="sxs-lookup"><span data-stu-id="16754-121">The time at which the filter is evaluated affects what data satisfies the filter.</span></span> <span data-ttu-id="16754-122">Se ad esempio una pubblicazione utilizza partizioni pre-calcolate e i dati vengono sincronizzati ogni due giorni, il subset di dati per il venditore potrebbe includere righe che risalgono fino a due giorni prima del previsto.</span><span class="sxs-lookup"><span data-stu-id="16754-122">For example, if a publication uses precomputed partitions, and you synchronize data every two days, the subset of data for the salesperson could include rows up to two days older than expected.</span></span>  
  
## <a name="recommendations-for-using-time-based-row-filters"></a><span data-ttu-id="16754-123">Indicazioni sull'utilizzo dei filtri di riga basati sul tempo</span><span class="sxs-lookup"><span data-stu-id="16754-123">Recommendations for Using Time-Based Row Filters</span></span>  
 <span data-ttu-id="16754-124">Il metodo seguente offre un approccio semplice ed efficace per il filtraggio basato sul tempo:</span><span class="sxs-lookup"><span data-stu-id="16754-124">The following method provides a robust and straightforward approach to filtering based on time:</span></span>  
  
-   <span data-ttu-id="16754-125">Aggiungere alla tabella una colonna del tipo di dati `bit`.</span><span class="sxs-lookup"><span data-stu-id="16754-125">Add a column to the table of data type `bit`.</span></span> <span data-ttu-id="16754-126">Questa colonna indica se è necessario replicare una riga.</span><span class="sxs-lookup"><span data-stu-id="16754-126">This column is used to indicate whether a row should be replicated.</span></span>  
  
-   <span data-ttu-id="16754-127">Utilizzare un filtro di riga che fa riferimento alla nuova colonna, anziché a una colonna basata sul tempo.</span><span class="sxs-lookup"><span data-stu-id="16754-127">Use a row filter that references the new column rather than a time-based column.</span></span>  
  
-   <span data-ttu-id="16754-128">Creare un processo di SQL Server Agent, o un processo pianificato tramite un altro meccanismo, per aggiornare la colonna prima dell'avvio pianificato dell'agente di merge.</span><span class="sxs-lookup"><span data-stu-id="16754-128">Create a SQL Server Agent job (or a job scheduled through another mechanism) that updates the column before the Merge Agent is scheduled to run.</span></span>  
  
 <span data-ttu-id="16754-129">Questo approccio consente di superare i limiti del metodo `GETDATE()` o di altri metodi basati sul tempo e di evitare il problema di determinare il momento della valutazione dei filtri per le partizioni.</span><span class="sxs-lookup"><span data-stu-id="16754-129">This approach addresses the shortcomings of using `GETDATE()` or another time-based method and avoids the problem of having to determine when filters are evaluated for partitions.</span></span> <span data-ttu-id="16754-130">Si consideri la tabella **Events** seguente:</span><span class="sxs-lookup"><span data-stu-id="16754-130">Consider the following example of an **Events** table:</span></span>  
  
|<span data-ttu-id="16754-131">**EventID**</span><span class="sxs-lookup"><span data-stu-id="16754-131">**EventID**</span></span>|<span data-ttu-id="16754-132">**EventName**</span><span class="sxs-lookup"><span data-stu-id="16754-132">**EventName**</span></span>|<span data-ttu-id="16754-133">**EventCoordID**</span><span class="sxs-lookup"><span data-stu-id="16754-133">**EventCoordID**</span></span>|<span data-ttu-id="16754-134">**EventDate**</span><span class="sxs-lookup"><span data-stu-id="16754-134">**EventDate**</span></span>|<span data-ttu-id="16754-135">**Replica**</span><span class="sxs-lookup"><span data-stu-id="16754-135">**Replicate**</span></span>|  
|-----------------|-------------------|----------------------|-------------------|-------------------|  
|<span data-ttu-id="16754-136">1</span><span class="sxs-lookup"><span data-stu-id="16754-136">1</span></span>|<span data-ttu-id="16754-137">Reception</span><span class="sxs-lookup"><span data-stu-id="16754-137">Reception</span></span>|<span data-ttu-id="16754-138">112</span><span class="sxs-lookup"><span data-stu-id="16754-138">112</span></span>|<span data-ttu-id="16754-139">2006-10-04</span><span class="sxs-lookup"><span data-stu-id="16754-139">2006-10-04</span></span>|<span data-ttu-id="16754-140">1</span><span class="sxs-lookup"><span data-stu-id="16754-140">1</span></span>|  
|<span data-ttu-id="16754-141">2</span><span class="sxs-lookup"><span data-stu-id="16754-141">2</span></span>|<span data-ttu-id="16754-142">Pasto principale</span><span class="sxs-lookup"><span data-stu-id="16754-142">Dinner</span></span>|<span data-ttu-id="16754-143">112</span><span class="sxs-lookup"><span data-stu-id="16754-143">112</span></span>|<span data-ttu-id="16754-144">2006-10-10</span><span class="sxs-lookup"><span data-stu-id="16754-144">2006-10-10</span></span>|<span data-ttu-id="16754-145">0</span><span class="sxs-lookup"><span data-stu-id="16754-145">0</span></span>|  
|<span data-ttu-id="16754-146">3</span><span class="sxs-lookup"><span data-stu-id="16754-146">3</span></span>|<span data-ttu-id="16754-147">Party</span><span class="sxs-lookup"><span data-stu-id="16754-147">Party</span></span>|<span data-ttu-id="16754-148">112</span><span class="sxs-lookup"><span data-stu-id="16754-148">112</span></span>|<span data-ttu-id="16754-149">2006-10-11</span><span class="sxs-lookup"><span data-stu-id="16754-149">2006-10-11</span></span>|<span data-ttu-id="16754-150">0</span><span class="sxs-lookup"><span data-stu-id="16754-150">0</span></span>|  
|<span data-ttu-id="16754-151">4</span><span class="sxs-lookup"><span data-stu-id="16754-151">4</span></span>|<span data-ttu-id="16754-152">Matrimonio</span><span class="sxs-lookup"><span data-stu-id="16754-152">Wedding</span></span>|<span data-ttu-id="16754-153">112</span><span class="sxs-lookup"><span data-stu-id="16754-153">112</span></span>|<span data-ttu-id="16754-154">2006-10-12</span><span class="sxs-lookup"><span data-stu-id="16754-154">2006-10-12</span></span>|<span data-ttu-id="16754-155">0</span><span class="sxs-lookup"><span data-stu-id="16754-155">0</span></span>|  
  
 <span data-ttu-id="16754-156">Il filtro di riga di questa tabella avrebbe quindi l'aspetto seguente:</span><span class="sxs-lookup"><span data-stu-id="16754-156">The row filter for this table would then look like this:</span></span>  
  
```  
WHERE EventCoordID = CONVERT(INT,HOST_NAME()) AND Replicate = 1  
```  
  
 <span data-ttu-id="16754-157">Il processo di SQL Server Agent può eseguire istruzioni [!INCLUDE[tsql](../../../includes/tsql-md.md)] simili alle seguenti prima dell'esecuzione di ogni agente di merge:</span><span class="sxs-lookup"><span data-stu-id="16754-157">The SQL Server Agent job could execute [!INCLUDE[tsql](../../../includes/tsql-md.md)] statements similar to the following before each Merge Agent run:</span></span>  
  
```  
UPDATE Events SET Replicate = 0 WHERE Replicate = 1  
GO  
UPDATE Events SET Replicate = 1 WHERE EventDate <= GETDATE()+6  
GO  
```  
  
 <span data-ttu-id="16754-158">La prima riga reimposta la colonna **Replicate** su **0**, mentre la seconda riga imposta la colonna su **1** per gli eventi che avranno luogo nei sette giorni successivi.</span><span class="sxs-lookup"><span data-stu-id="16754-158">The first line resets the **Replicate** column to **0**, and the second line sets the column to **1** for events that occur in the next seven days.</span></span> <span data-ttu-id="16754-159">Se questa istruzione [!INCLUDE[tsql](../../../includes/tsql-md.md)] viene eseguita il 07/10/2006, la tabella verrà aggiornata nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="16754-159">If this [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement runs on 10/07/2006, the table is updated to:</span></span>  
  
|<span data-ttu-id="16754-160">**EventID**</span><span class="sxs-lookup"><span data-stu-id="16754-160">**EventID**</span></span>|<span data-ttu-id="16754-161">**EventName**</span><span class="sxs-lookup"><span data-stu-id="16754-161">**EventName**</span></span>|<span data-ttu-id="16754-162">**EventCoordID**</span><span class="sxs-lookup"><span data-stu-id="16754-162">**EventCoordID**</span></span>|<span data-ttu-id="16754-163">**EventDate**</span><span class="sxs-lookup"><span data-stu-id="16754-163">**EventDate**</span></span>|<span data-ttu-id="16754-164">**Replica**</span><span class="sxs-lookup"><span data-stu-id="16754-164">**Replicate**</span></span>|  
|-----------------|-------------------|----------------------|-------------------|-------------------|  
|<span data-ttu-id="16754-165">1</span><span class="sxs-lookup"><span data-stu-id="16754-165">1</span></span>|<span data-ttu-id="16754-166">Reception</span><span class="sxs-lookup"><span data-stu-id="16754-166">Reception</span></span>|<span data-ttu-id="16754-167">112</span><span class="sxs-lookup"><span data-stu-id="16754-167">112</span></span>|<span data-ttu-id="16754-168">2006-10-04</span><span class="sxs-lookup"><span data-stu-id="16754-168">2006-10-04</span></span>|<span data-ttu-id="16754-169">0</span><span class="sxs-lookup"><span data-stu-id="16754-169">0</span></span>|  
|<span data-ttu-id="16754-170">2</span><span class="sxs-lookup"><span data-stu-id="16754-170">2</span></span>|<span data-ttu-id="16754-171">Pasto principale</span><span class="sxs-lookup"><span data-stu-id="16754-171">Dinner</span></span>|<span data-ttu-id="16754-172">112</span><span class="sxs-lookup"><span data-stu-id="16754-172">112</span></span>|<span data-ttu-id="16754-173">2006-10-10</span><span class="sxs-lookup"><span data-stu-id="16754-173">2006-10-10</span></span>|<span data-ttu-id="16754-174">1</span><span class="sxs-lookup"><span data-stu-id="16754-174">1</span></span>|  
|<span data-ttu-id="16754-175">3</span><span class="sxs-lookup"><span data-stu-id="16754-175">3</span></span>|<span data-ttu-id="16754-176">Party</span><span class="sxs-lookup"><span data-stu-id="16754-176">Party</span></span>|<span data-ttu-id="16754-177">112</span><span class="sxs-lookup"><span data-stu-id="16754-177">112</span></span>|<span data-ttu-id="16754-178">2006-10-11</span><span class="sxs-lookup"><span data-stu-id="16754-178">2006-10-11</span></span>|<span data-ttu-id="16754-179">1</span><span class="sxs-lookup"><span data-stu-id="16754-179">1</span></span>|  
|<span data-ttu-id="16754-180">4</span><span class="sxs-lookup"><span data-stu-id="16754-180">4</span></span>|<span data-ttu-id="16754-181">Matrimonio</span><span class="sxs-lookup"><span data-stu-id="16754-181">Wedding</span></span>|<span data-ttu-id="16754-182">112</span><span class="sxs-lookup"><span data-stu-id="16754-182">112</span></span>|<span data-ttu-id="16754-183">2006-10-12</span><span class="sxs-lookup"><span data-stu-id="16754-183">2006-10-12</span></span>|<span data-ttu-id="16754-184">1</span><span class="sxs-lookup"><span data-stu-id="16754-184">1</span></span>|  
  
 <span data-ttu-id="16754-185">Gli eventi della settimana successiva sono ora contrassegnati come pronti per la replica.</span><span class="sxs-lookup"><span data-stu-id="16754-185">The events for the next week are now flagged as being ready to replicate.</span></span> <span data-ttu-id="16754-186">Alla successiva esecuzione dell'agente di merge per la sottoscrizione utilizzata dal coordinatore di eventi 112, le righe 2, 3 e 4 verranno scaricate nel Sottoscrittore e la riga 1 verrà rimossa dal Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="16754-186">The next time the Merge Agent runs for the subscription that event coordinator 112 uses, rows 2, 3, and 4 will be downloaded to the Subscriber and row 1 will be removed from the Subscriber.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="16754-187">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="16754-187">See Also</span></span>  
 <span data-ttu-id="16754-188">[GETDATE &#40;Transact-SQL&#41;](/sql/t-sql/functions/getdate-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="16754-188">[GETDATE &#40;Transact-SQL&#41;](/sql/t-sql/functions/getdate-transact-sql) </span></span>  
 <span data-ttu-id="16754-189">[Implementazione di processi](../../../ssms/agent/implement-jobs.md) </span><span class="sxs-lookup"><span data-stu-id="16754-189">[Implement Jobs](../../../ssms/agent/implement-jobs.md) </span></span>  
 [<span data-ttu-id="16754-190">Filtri di riga con parametri</span><span class="sxs-lookup"><span data-stu-id="16754-190">Parameterized Row Filters</span></span>](parameterized-filters-parameterized-row-filters.md)  
  
  
