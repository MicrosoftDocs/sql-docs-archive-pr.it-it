---
title: Replica snapshot | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshot replication [SQL Server], about snapshot replication
- snapshot replication [SQL Server]
ms.assetid: 5d745f22-9c6b-4e11-8c62-bc50e9a8bf38
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6192c196e31c4c5772099074c79b3c6c4ca7aeed
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87726904"
---
# <a name="snapshot-replication"></a><span data-ttu-id="acb69-102">Replica snapshot</span><span class="sxs-lookup"><span data-stu-id="acb69-102">Snapshot Replication</span></span>
  <span data-ttu-id="acb69-103">La replica snapshot distribuisce i dati così come appaiono in uno determinato momento e non prevede il monitoraggio degli aggiornamenti ai dati.</span><span class="sxs-lookup"><span data-stu-id="acb69-103">Snapshot replication distributes data exactly as it appears at a specific moment in time and does not monitor for updates to the data.</span></span> <span data-ttu-id="acb69-104">Quando viene eseguita la sincronizzazione, viene generato e inviato ai Sottoscrittori l'intero snapshot.</span><span class="sxs-lookup"><span data-stu-id="acb69-104">When synchronization occurs, the entire snapshot is generated and sent to Subscribers.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="acb69-105">È possibile utilizzare la replica snapshot autonomamente, ma il processo di snapshot (che crea una copia di tutti gli oggetti e dati specificati da una pubblicazione) viene anche comunemente utilizzato per fornire il set iniziale di dati e oggetti di database per le pubblicazioni transazionali e di tipo merge.</span><span class="sxs-lookup"><span data-stu-id="acb69-105">Snapshot replication can be used by itself, but the snapshot process (which creates a copy of all of the objects and data specified by a publication) is also commonly used to provide the initial set of data and database objects for transactional and merge publications.</span></span>  
  
 <span data-ttu-id="acb69-106">L'utilizzo della replica snapshot in modo autonomo si rivela maggiormente appropriato in presenza di una o più delle condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="acb69-106">Using snapshot replication by itself is most appropriate when one or more of the following is true:</span></span>  
  
-   <span data-ttu-id="acb69-107">I dati vengono modificati raramente.</span><span class="sxs-lookup"><span data-stu-id="acb69-107">Data changes infrequently.</span></span>  
  
-   <span data-ttu-id="acb69-108">L'utilizzo temporaneo di copie di dati non aggiornate rispetto al server di pubblicazione è accettabile.</span><span class="sxs-lookup"><span data-stu-id="acb69-108">It is acceptable to have copies of data that are out of date with respect to the Publisher for a period of time.</span></span>  
  
-   <span data-ttu-id="acb69-109">Vengono replicati volumi ridotti di dati.</span><span class="sxs-lookup"><span data-stu-id="acb69-109">Replicating small volumes of data.</span></span>  
  
-   <span data-ttu-id="acb69-110">Viene apportato un ingente volume di modifiche in un breve periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="acb69-110">A large volume of changes occurs over a short period of time.</span></span>  
  
 <span data-ttu-id="acb69-111">La replica snapshot è maggiormente appropriata in caso di modifiche di dati sostanziali ma non frequenti.</span><span class="sxs-lookup"><span data-stu-id="acb69-111">Snapshot replication is most appropriate when data changes are substantial but infrequent.</span></span> <span data-ttu-id="acb69-112">Se, ad esempio, un'organizzazione addetta alle vendite gestisce un listino prezzi dei prodotti e i prezzi vengono aggiornati contemporaneamente una o due volte all'anno, è consigliabile eseguire la replica dell'intero snapshot di dati dopo che è stato modificato.</span><span class="sxs-lookup"><span data-stu-id="acb69-112">For example, if a sales organization maintains a product price list and the prices are all updated at the same time once or twice each year, replicating the entire snapshot of data after it has changed is recommended.</span></span> <span data-ttu-id="acb69-113">Data la natura di determinati tipi di dati, può essere consigliabile eseguire snapshot più frequenti.</span><span class="sxs-lookup"><span data-stu-id="acb69-113">Given certain types of data, more frequent snapshots may also be appropriate.</span></span> <span data-ttu-id="acb69-114">Se, ad esempio, una tabella relativamente piccola viene aggiornata sul server di pubblicazione nel corso della giornata ma un minimo di latenza è tollerata, le modifiche possono essere recapitate durante la notte sotto forma di snapshot.</span><span class="sxs-lookup"><span data-stu-id="acb69-114">For example, if a relatively small table is updated at the Publisher during the day, but some latency is acceptable, changes can be delivered nightly as a snapshot.</span></span>  
  
 <span data-ttu-id="acb69-115">La replica snapshot presenta un overhead continuo più basso sul server di pubblicazione rispetto alla replica transazionale, in quanto le modifiche incrementali non vengono rilevate.</span><span class="sxs-lookup"><span data-stu-id="acb69-115">Snapshot replication has a lower continuous overhead on the Publisher than transactional replication, because incremental changes are not tracked.</span></span> <span data-ttu-id="acb69-116">Se, tuttavia, il set di dati replicato è molto ampio, sarà necessario un numero significativo di risorse per generare e applicare lo snapshot.</span><span class="sxs-lookup"><span data-stu-id="acb69-116">However, if the dataset set being replicated is very large, it will require substantial resources to generate and apply the snapshot.</span></span> <span data-ttu-id="acb69-117">Per valutare l'opportunità o meno di utilizzare la replica snapshot, considerare la dimensione dell'intero set di dati e la frequenza delle modifiche ai dati.</span><span class="sxs-lookup"><span data-stu-id="acb69-117">Consider the size of the entire data set and the frequency of changes to the data when evaluating whether to utilize snapshot replication.</span></span>  
  
 <span data-ttu-id="acb69-118">**Contenuto dell'argomento**</span><span class="sxs-lookup"><span data-stu-id="acb69-118">**In this topic**</span></span>  
  
 [<span data-ttu-id="acb69-119">Funzionamento della replica snapshot</span><span class="sxs-lookup"><span data-stu-id="acb69-119">How Snapshot Replication Works</span></span>](#HowWorks)  
  
 [<span data-ttu-id="acb69-120">Agente snapshot</span><span class="sxs-lookup"><span data-stu-id="acb69-120">Snapshot Agent</span></span>](#SnapshotAgent)  
  
 [<span data-ttu-id="acb69-121">Agenti di distribuzione e di merge</span><span class="sxs-lookup"><span data-stu-id="acb69-121">Distribution and Merge Agents</span></span>](#DistAgent)  
  
##  <a name="how-snapshot-replication-works"></a><a name="HowWorks"></a> <span data-ttu-id="acb69-122">Funzionamento della replica snapshot</span><span class="sxs-lookup"><span data-stu-id="acb69-122">How Snapshot Replication Works</span></span>  
 <span data-ttu-id="acb69-123">Per impostazione predefinita, tutti e tre i tipi di replica utilizzano uno snapshot per inizializzare i Sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="acb69-123">By default, all three types of replication use a snapshot to initialize Subscribers.</span></span> <span data-ttu-id="acb69-124">L'agente snapshot di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] genera sempre file di snapshot ma l'agente che recapita i file varia a seconda del tipo di replica in uso.</span><span class="sxs-lookup"><span data-stu-id="acb69-124">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Snapshot Agent always generates the snapshot files, but the agent that delivers the files differs depending on the type of replication being used.</span></span> <span data-ttu-id="acb69-125">La replica snapshot e la replica transazionale utilizzano l'agente di distribuzione per recapitare i file, mentre la replica di tipo merge utilizza l'agente di merge di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="acb69-125">Snapshot replication and transactional replication use the Distribution Agent to deliver the files, whereas merge replication uses the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Merge Agent.</span></span> <span data-ttu-id="acb69-126">L'agente snapshot viene eseguito nel server di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="acb69-126">The Snapshot Agent runs at the Distributor.</span></span> <span data-ttu-id="acb69-127">L'agente di distribuzione e l'agente di merge vengono eseguiti nel database di distribuzione per le sottoscrizioni push o nei Sottoscrittori per le sottoscrizioni pull.</span><span class="sxs-lookup"><span data-stu-id="acb69-127">The Distribution Agent and Merge Agent run at the Distributor for push subscriptions, or at Subscribers for pull subscriptions.</span></span>  
  
 <span data-ttu-id="acb69-128">Gli snapshot possono essere generati e applicati immediatamente dopo la creazione della sottoscrizione oppure in base a un set di pianificazioni durante la creazione della pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="acb69-128">Snapshots can be generated and applied either immediately after the subscription is created or according to a schedule set at the time the publication is created.</span></span> <span data-ttu-id="acb69-129">L'agente snapshot prepara i file di snapshot contenenti lo schema e i dati delle tabelle pubblicate e degli oggetti di database, archivia i file nella cartella snapshot del server di pubblicazione e registra le informazioni di rilevamento nel database di distribuzione del server di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="acb69-129">The Snapshot Agent prepares snapshot files containing the schema and data of published tables and database objects, stores the files in the snapshot folder for the Publisher, and records tracking information in the distribution database on the Distributor.</span></span> <span data-ttu-id="acb69-130">Durante la configurazione di un database di distribuzione viene specificata una cartella snapshot predefinita, ma è anche possibile indicare una posizione alternativa per una pubblicazione in aggiunta a quella predefinita o al posto di questa.</span><span class="sxs-lookup"><span data-stu-id="acb69-130">You specify a default snapshot folder when you configure a Distributor, but you can specify an alternate location for a publication instead of or in addition to the default.</span></span>  
  
 <span data-ttu-id="acb69-131">Oltre al processo di snapshot standard descritto in questo argomento, viene utilizzato un processo di snapshot a due parti per le pubblicazioni di tipo merge che utilizzano filtri con parametri.</span><span class="sxs-lookup"><span data-stu-id="acb69-131">In addition to the standard snapshot process described in this topic, a two-part snapshot process is used for merge publications with parameterized filters.</span></span>  
  
 <span data-ttu-id="acb69-132">Nella figura seguente vengono illustrati i componenti principali della replica snapshot.</span><span class="sxs-lookup"><span data-stu-id="acb69-132">The following illustration shows the principal components of snapshot replication.</span></span>  
  
 <span data-ttu-id="acb69-133">![Componenti e flusso di dati per la replica snapshot](media/snapshot.gif "Componenti e flusso di dati per la replica snapshot")</span><span class="sxs-lookup"><span data-stu-id="acb69-133">![Snapshot replication components and data flow](media/snapshot.gif "Snapshot replication components and data flow")</span></span>  
  
##  <a name="snapshot-agent"></a><a name="SnapshotAgent"></a> <span data-ttu-id="acb69-134">agente snapshot</span><span class="sxs-lookup"><span data-stu-id="acb69-134">Snapshot Agent</span></span>  
 <span data-ttu-id="acb69-135">Per la replica di tipo merge, viene generato uno snapshot a ogni esecuzione dell'agente snapshot.</span><span class="sxs-lookup"><span data-stu-id="acb69-135">For merge replication, a snapshot is generated every time the Snapshot Agent runs.</span></span> <span data-ttu-id="acb69-136">Per la replica transazionale, la generazione dello snapshot dipende dall'impostazione della proprietà di pubblicazione **immediate_sync**.</span><span class="sxs-lookup"><span data-stu-id="acb69-136">For transactional replication, snapshot generation depends on the setting of the publication property **immediate_sync**.</span></span> <span data-ttu-id="acb69-137">Se tale proprietà è impostata su TRUE, ovvero il valore predefinito quando si utilizza la Creazione guidata nuova pubblicazione, viene generato uno snapshot ogni volta che viene eseguito l'agente snapshot, che può essere applicato a un Sottoscrittore in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="acb69-137">If the property is set to TRUE (the default when using the New Publication Wizard), a snapshot is generated every time the Snapshot Agent runs, and it can be applied to a Subscriber at any time.</span></span> <span data-ttu-id="acb69-138">Se invece è impostata su FALSE, ovvero il valore predefinito quando si utilizza **sp_addpublication**, lo snapshot viene generato solo se è stata aggiunta una nuova sottoscrizione dopo l'ultima esecuzione dell'agente snapshot. Per poter eseguire la sincronizzazione, è necessario che i sottoscrittori attendano il completamento dell'agente snapshot.</span><span class="sxs-lookup"><span data-stu-id="acb69-138">If the property is set to FALSE (the default when using **sp_addpublication**), the snapshot is generated only if a new subscription has been added since the last Snapshot Agent run; Subscribers must wait for the Snapshot Agent to complete before they can synchronize.</span></span>  
  
 <span data-ttu-id="acb69-139">L'agente snapshot esegue la procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="acb69-139">The Snapshot Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="acb69-140">Stabilisce una connessione dal server di distribuzione al server di pubblicazione, quindi imposta dei blocchi sulle tabelle pubblicate, se necessario:</span><span class="sxs-lookup"><span data-stu-id="acb69-140">Establishes a connection from the Distributor to the Publisher, and then takes locks on published tables if necessary:</span></span>  
  
    -   <span data-ttu-id="acb69-141">Per le pubblicazioni di tipo merge, l'agente snapshot non imposta alcun blocco.</span><span class="sxs-lookup"><span data-stu-id="acb69-141">For merge publications, the Snapshot Agent does not take any locks.</span></span>  
  
    -   <span data-ttu-id="acb69-142">Per le pubblicazioni transazionali, per impostazione predefinita l'agente snapshot imposta dei blocchi solo durante la fase iniziale della generazione degli snapshot.</span><span class="sxs-lookup"><span data-stu-id="acb69-142">For transactional publications, by default the Snapshot Agent take locks only during the initial phase of snapshot generation.</span></span>  
  
    -   <span data-ttu-id="acb69-143">Per le pubblicazioni snapshot, i blocchi vengono mantenuti durante l'intero processo di generazione degli snapshot.</span><span class="sxs-lookup"><span data-stu-id="acb69-143">For snapshot publications, locks are held during the entire snapshot generation process.</span></span>  
  
2.  <span data-ttu-id="acb69-144">Scrive in un file con estensione sch una copia dello schema della tabella.</span><span class="sxs-lookup"><span data-stu-id="acb69-144">Writes a copy of the table schema for each article to a .sch file.</span></span> <span data-ttu-id="acb69-145">Se vengono pubblicati altri oggetti di database, ad esempio indici, vincoli, stored procedure, viste, funzioni definite dall'utente e così via, verranno generati file script aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="acb69-145">If other database objects are published, such as indexes, constraints, stored procedures, views, user-defined functions, and so on, additional script files are generated.</span></span>  
  
3.  <span data-ttu-id="acb69-146">Copia i dati dalla tabella pubblicata nel server di pubblicazione e scrive i dati nella cartella snapshot.</span><span class="sxs-lookup"><span data-stu-id="acb69-146">Copies the data from the published table at the Publisher and writes the data to the snapshot folder.</span></span> <span data-ttu-id="acb69-147">Lo snapshot viene generato come set di file di programma per la copia bulk (BCP).</span><span class="sxs-lookup"><span data-stu-id="acb69-147">The snapshot is generated as a set of bulk copy program (BCP) files.</span></span>  
  
4.  <span data-ttu-id="acb69-148">Per le pubblicazioni snapshot e transazionali, l'agente snapshot aggiunge righe alle tabelle **MSrepl_commands** e **MSrepl_transactions** nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="acb69-148">For snapshot and transactional publications, the Snapshot Agent appends rows to the **MSrepl_commands** and **MSrepl_transactions** tables in the distribution database.</span></span> <span data-ttu-id="acb69-149">Le voci della tabella **MSrepl_commands** sono comandi che indicano la posizione dei file con estensione sch e bcp, di qualsiasi altro file di snapshot e dei riferimenti a qualsiasi script pre-snapshot o post-snapshot.</span><span class="sxs-lookup"><span data-stu-id="acb69-149">The entries in the **MSrepl_commands** table are commands indicating the location of .sch and .bcp files, any other snapshot files, and references to any pre- or post-snapshot scripts.</span></span> <span data-ttu-id="acb69-150">Le voci della tabella **MSrepl_transactions** sono comandi rilevanti per la sincronizzazione del Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="acb69-150">The entries in the **MSrepl_transactions** table are commands relevant to synchronizing the Subscriber.</span></span>  
  
     <span data-ttu-id="acb69-151">Per le pubblicazioni di tipo merge, l'agente snapshot esegue operazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="acb69-151">For merge publications, the Snapshot Agent performs additional steps.</span></span>  
  
5.  <span data-ttu-id="acb69-152">Rilascia gli eventuali blocchi sulle tabelle pubblicate.</span><span class="sxs-lookup"><span data-stu-id="acb69-152">Releases any locks on published tables.</span></span>  
  
 <span data-ttu-id="acb69-153">Durante la generazione degli snapshot, non è possibile apportare modifiche di schema nelle tabelle pubblicate.</span><span class="sxs-lookup"><span data-stu-id="acb69-153">During snapshot generation, you cannot make schema changes on published tables.</span></span> <span data-ttu-id="acb69-154">Dopo avere generato i file di snapshot, è possibile visualizzarli nella cartella snapshot tramite Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="acb69-154">After the snapshot files are generated, you can view them in the snapshot folder using Windows Explorer.</span></span>  
  
##  <a name="distribution-agent-and-merge-agent"></a><a name="DistAgent"></a> <span data-ttu-id="acb69-155">Agente di distribuzione e di merge</span><span class="sxs-lookup"><span data-stu-id="acb69-155">Distribution Agent and Merge Agent</span></span>  
 <span data-ttu-id="acb69-156">Per le applicazioni snapshot, ogni volta che l'agente di distribuzione viene eseguito per la pubblicazione, un nuovo snapshot viene spostato in ogni Sottoscrittore che non è stato ancora sincronizzato, è stato contrassegnato per la reinizializzazione o include nuovi articoli.</span><span class="sxs-lookup"><span data-stu-id="acb69-156">For snapshot publications, each time the Distribution Agent runs for the publication, it moves a new snapshot to each Subscriber that has not yet been synchronized, has been marked for reinitialization, or includes new articles.</span></span>  
  
 <span data-ttu-id="acb69-157">Per la replica snapshot e transazionale, l'agente di distribuzione esegue la procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="acb69-157">For snapshot and transactional replication, the Distribution Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="acb69-158">Stabilisce una connessione con il server di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="acb69-158">Establishes a connection to the Distributor.</span></span>  
  
2.  <span data-ttu-id="acb69-159">Esamina le tabelle **MSrepl_commands** e **MSrepl_transactions** nel database di distribuzione del server di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="acb69-159">Examines the **MSrepl_commands** and **MSrepl_transactions** tables in the distribution database on the Distributor.</span></span> <span data-ttu-id="acb69-160">L'agente legge nella prima tabella la posizione dei file di snapshot e in entrambe le tabelle i comandi di sincronizzazione del Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="acb69-160">The agent reads the location of the snapshot files from the first table and Subscriber synchronization commands from both tables.</span></span>  
  
3.  <span data-ttu-id="acb69-161">Applica lo schema e i comandi al database di sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="acb69-161">Applies the schema and commands to the subscription database.</span></span>  
  
 <span data-ttu-id="acb69-162">Per una pubblicazione per la replica di tipo merge non filtrata, l'agente di merge esegue la procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="acb69-162">For an unfiltered merge replication publication, the Merge Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="acb69-163">Stabilisce una connessione con il server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="acb69-163">Establishes a connection to the Publisher.</span></span>  
  
2.  <span data-ttu-id="acb69-164">Esamina la tabella **sysmergeschemachange** sul server di pubblicazione e stabilisce se è presente un nuovo snapshot da applicare al Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="acb69-164">Examines the **sysmergeschemachange** table on the Publisher and determines whether there is a new snapshot that should be applied at the Subscriber.</span></span>  
  
3.  <span data-ttu-id="acb69-165">In caso affermativo, l'agente di merge applica al database di sottoscrizione i file di snapshot dalla posizione specificata in **sysmergeschemachange**.</span><span class="sxs-lookup"><span data-stu-id="acb69-165">If a new snapshot is available, the Merge Agent applies to the subscription database the snapshot files from the location specified in **sysmergeschemachange**.</span></span>  
  
  
