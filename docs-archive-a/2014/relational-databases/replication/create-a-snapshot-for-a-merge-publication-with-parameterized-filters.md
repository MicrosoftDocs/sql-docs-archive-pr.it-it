---
title: Creare uno snapshot per una pubblicazione di tipo merge con filtri con parametri | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- parameterized filters [SQL Server replication], snapshots
- snapshots [SQL Server replication], parameterized filters and
- filters [SQL Server replication], parameterized
ms.assetid: 00dfb229-f1de-4d33-90b0-d7c99ab52dcb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: dad6f1648cba44b38e37720f7e395687f769d91e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87714207"
---
# <a name="create-a-snapshot-for-a-merge-publication-with-parameterized-filters"></a><span data-ttu-id="79508-102">Creazione di uno snapshot per una pubblicazione di tipo merge con filtri con parametri</span><span class="sxs-lookup"><span data-stu-id="79508-102">Create a Snapshot for a Merge Publication with Parameterized Filters</span></span>
  <span data-ttu-id="79508-103">In questo argomento viene descritto come creare un snapshot per una pubblicazione di tipo merge con i filtri con parametri in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] tramite [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)]o Replication Management Objects (RMO).</span><span class="sxs-lookup"><span data-stu-id="79508-103">This topic describes how to create a snapshot for a merge publication with parameterized filters in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="79508-104">Prima di iniziare</span><span class="sxs-lookup"><span data-stu-id="79508-104">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="79508-105">Indicazioni</span><span class="sxs-lookup"><span data-stu-id="79508-105">Recommendations</span></span>  
  
-   <span data-ttu-id="79508-106">Quando si genera uno snapshot per una pubblicazione di tipo merge utilizzando filtri con parametri, è necessario innanzitutto generare uno snapshot (schema) standard che contiene tutti i dati pubblicati e i metadati del Sottoscrittore per la sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="79508-106">When generating a snapshot for a merge publication using parameterized filters, you must first generate a standard (schema) snapshot that contains all of the published data and Subscriber metadata for the subscription.</span></span> <span data-ttu-id="79508-107">Per altre informazioni, vedere [Creazione e applicazione dello snapshot iniziale](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="79508-107">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span> <span data-ttu-id="79508-108">Dopo aver creato lo snapshot dello schema, è possibile generare lo snapshot che contiene la partizione dei dati pubblicati specifica del Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="79508-108">After you have created the schema snapshot, you can generate the snapshot that contains the Subscriber-specific partition of the published data.</span></span>  
  
-   <span data-ttu-id="79508-109">Se il filtro di uno o più articoli nella pubblicazione restituisce partizioni non sovrapposte univoche per ogni sottoscrizione, i metadati vengono eliminati a ogni esecuzione dell'agente di merge.</span><span class="sxs-lookup"><span data-stu-id="79508-109">If the filtering for one or more articles in the publication yields non-overlapping partitions that are unique for each subscription, metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="79508-110">Lo snapshot partizionato scade quindi più rapidamente.</span><span class="sxs-lookup"><span data-stu-id="79508-110">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="79508-111">Quando si utilizza questa opzione, è consigliabile consentire ai Sottoscrittori di inizializzare la generazione e il recapito dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="79508-111">When using this option, you should consider allowing Subscribers to initiate snapshot generation and delivery.</span></span> <span data-ttu-id="79508-112">Per altre informazioni sulle opzioni di filtro, vedere la sezione "Impostazione di 'partition options'" in [Snapshot per pubblicazioni di tipo merge con filtri con parametri](snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="79508-112">For more information about filtering options, see the "Setting 'partition options'" section of [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="79508-113">Utilizzo di SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="79508-113">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="79508-114">Generare snapshot per le partizioni nella pagina **Partizioni dati** della finestra di dialogo **Proprietà pubblicazione - \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="79508-114">Generate snapshots for partitions on the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="79508-115">Per ulteriori informazioni sull'accesso a questa finestra di dialogo, vedere [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="79508-115">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span> <span data-ttu-id="79508-116">È possibile consentire ai Sottoscrittori di avviare la generazione e il recapito degli snapshot e/o di generare snapshot.</span><span class="sxs-lookup"><span data-stu-id="79508-116">You can allow Subscribers to initiate snapshot generation and delivery and/or generate snapshots.</span></span>  
  
 <span data-ttu-id="79508-117">Prima di generare gli snapshot per una o più partizioni, è necessario:</span><span class="sxs-lookup"><span data-stu-id="79508-117">Before generating snapshots for one or more partitions, you must:</span></span>  
  
1.  <span data-ttu-id="79508-118">Creare una pubblicazione di tipo merge mediante Creazione guidata nuova pubblicazione e specificare uno o più filtri di righe con parametri nella pagina **Aggiungi filtro** della procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="79508-118">Create a merge publication with the New Publication Wizard, and specify one or more parameterized row filters on the **Add Filter** page of the wizard.</span></span> <span data-ttu-id="79508-119">Per altre informazioni, vedere [Definizione e modifica di un filtro di riga con parametri per un articolo di merge](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="79508-119">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
2.  <span data-ttu-id="79508-120">Generare uno snapshot dello schema per la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-120">Generate a schema snapshot for the publication.</span></span> <span data-ttu-id="79508-121">Per impostazione predefinita, lo snapshot dello schema viene generato quando si completa la Creazione guidata nuova pubblicazione, ma è possibile generarne uno anche mediante [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="79508-121">By default, a schema snapshot is generated when you complete the New Publication Wizard; you can also generate a schema snapshot from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
#### <a name="to-generate-a-schema-snapshot"></a><span data-ttu-id="79508-122">Per generare uno snapshot dello schema</span><span class="sxs-lookup"><span data-stu-id="79508-122">To generate a schema snapshot</span></span>  
  
1.  <span data-ttu-id="79508-123">Connettersi al server di pubblicazione in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]e quindi espandere il nodo del server.</span><span class="sxs-lookup"><span data-stu-id="79508-123">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="79508-124">Espandere la cartella **Replica** e quindi la cartella **Pubblicazioni** .</span><span class="sxs-lookup"><span data-stu-id="79508-124">Expand the **Replication** folder, and then expand the **Publications** folder.</span></span>  
  
3.  <span data-ttu-id="79508-125">Fare clic con il pulsante destro del mouse sulla pubblicazione per la quale si desidera creare uno snapshot, quindi scegliere **Visualizza stato agente snapshot**.</span><span class="sxs-lookup"><span data-stu-id="79508-125">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="79508-126">Nella finestra di dialogo **Visualizza stato agente snapshot - \<Publication>** fare clic su **Avvia**.</span><span class="sxs-lookup"><span data-stu-id="79508-126">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
     <span data-ttu-id="79508-127">Al termine della generazione dello snapshot, verrà visualizzato un messaggio del tipo "[100%] Generato uno snapshot di 17 articoli."</span><span class="sxs-lookup"><span data-stu-id="79508-127">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-allow-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="79508-128">Per consentire ai Sottoscrittori di avviare la generazione e il recapito di snapshot</span><span class="sxs-lookup"><span data-stu-id="79508-128">To allow Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="79508-129">Nella pagina **Partizioni dati** della finestra di dialogo **Proprietà pubblicazione - \<Publication>** selezionare **Definisci automaticamente una partizione e genera uno snapshot, se necessario, quando un nuovo Sottoscrittore cerca di eseguire la sincronizzazione**.</span><span class="sxs-lookup"><span data-stu-id="79508-129">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, select **Automatically define a partition and generate a snapshot if needed when a new Subscriber tries to synchronize**.</span></span>  
  
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
#### <a name="to-generate-and-refresh-snapshots"></a><span data-ttu-id="79508-130">Per generare e aggiornare gli snapshot</span><span class="sxs-lookup"><span data-stu-id="79508-130">To generate and refresh snapshots</span></span>  
  
1.  <span data-ttu-id="79508-131">Nella pagina **Partizioni dati** della finestra di dialogo **Proprietà pubblicazione - \<Publication>** fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="79508-131">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, click **Add**.</span></span>  
  
2.  <span data-ttu-id="79508-132">Immettere un valore per le funzioni **HOST_NAME()** e/o **SUSER_SNAME()** associate alla partizione per cui si desidera creare uno snapshot.</span><span class="sxs-lookup"><span data-stu-id="79508-132">Enter a value for the **HOST_NAME()** and/or **SUSER_SNAME()** value associated with the partition for which you want to create a snapshot.</span></span>  
  
3.  <span data-ttu-id="79508-133">Facoltativamente, specificare una pianificazione per l'aggiornamento degli snapshot:</span><span class="sxs-lookup"><span data-stu-id="79508-133">Optionally specify a schedule for refreshing snapshots:</span></span>  
  
    1.  <span data-ttu-id="79508-134">Selezionare **Usa la pianificazione seguente per l'esecuzione dell'agente snapshot per questa partizione**.</span><span class="sxs-lookup"><span data-stu-id="79508-134">Select **Schedule the Snapshot Agent for this partition to run at the following time(s)**</span></span>  
  
    2.  <span data-ttu-id="79508-135">Accettare la pianificazione predefinita per l'aggiornamento degli snapshot oppure fare clic su **Cambia** per specificare una pianificazione diversa.</span><span class="sxs-lookup"><span data-stu-id="79508-135">Accept the default schedule for refreshing snapshots, or click **Change** to specify a different schedule.</span></span>  
  
4.  <span data-ttu-id="79508-136">Facendo clic su **OK** si torna nella finestra di dialogo **Proprietà pubblicazione - \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="79508-136">Click **OK**, which returns you to the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
5.  <span data-ttu-id="79508-137">Selezionare la partizione nella griglia delle proprietà e quindi fare clic su **Genera gli snapshot selezionati adesso**.</span><span class="sxs-lookup"><span data-stu-id="79508-137">Select the partition in the property grid, and then click **Generate the selected snapshots now**.</span></span>  
  
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="79508-138">Uso di Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="79508-138">Using Transact-SQL</span></span>  
 <span data-ttu-id="79508-139">L'utilizzo di stored procedure e dell'agente snapshot consente di eseguire le attività indicate di seguito:</span><span class="sxs-lookup"><span data-stu-id="79508-139">Using stored procedures and the Snapshot Agent, you can perform the following:</span></span>  
  
-   <span data-ttu-id="79508-140">Consentire ai Sottoscrittori di richiedere la generazione e l'applicazione dello snapshot alla prima sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="79508-140">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="79508-141">Pregenerare uno snapshot per ogni partizione.</span><span class="sxs-lookup"><span data-stu-id="79508-141">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="79508-142">Generare manualmente uno snapshot per ciascun Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="79508-142">Manually generate a snapshot for each Subscriber.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="79508-143">Se possibile, richiedere agli utenti di immettere le credenziali di sicurezza in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="79508-143">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="79508-144">Se è necessario archiviare le credenziali in un file script, è fondamentale proteggere il file per evitare accessi non autorizzati.</span><span class="sxs-lookup"><span data-stu-id="79508-144">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="79508-145">Per creare una pubblicazione che consente ai Sottoscrittori di avviare la generazione e il recapito di snapshot</span><span class="sxs-lookup"><span data-stu-id="79508-145">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="79508-146">Nel database di pubblicazione del server di pubblicazione eseguire [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-146">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="79508-147">Specificare i parametri seguenti:</span><span class="sxs-lookup"><span data-stu-id="79508-147">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="79508-148">Il nome della pubblicazione per **\@publication**.</span><span class="sxs-lookup"><span data-stu-id="79508-148">The name of the publication for **\@publication**.</span></span>  
  
    -   <span data-ttu-id="79508-149">Valore di `true` per \*\* \@ allow_subscriber_initiated_snapshot\*\*, che consente ai sottoscrittori di avviare il processo di snapshot.</span><span class="sxs-lookup"><span data-stu-id="79508-149">A value of `true` for **\@allow_subscriber_initiated_snapshot**, which enables Subscribers to initiate the snapshot process.</span></span>  
  
    -   <span data-ttu-id="79508-150">(Facoltativo) Il numero di processi di snapshot dinamici che è possibile eseguire simultaneamente per **\@max_concurrent_dynamic_snapshots**.</span><span class="sxs-lookup"><span data-stu-id="79508-150">(Optional) The number of dynamic snapshot processes that can run concurrently for **\@max_concurrent_dynamic_snapshots**.</span></span> <span data-ttu-id="79508-151">Se è in esecuzione il numero massimo di processi e un Sottoscrittore tenta di generare uno snapshot, il processo verrà inserito in una coda.</span><span class="sxs-lookup"><span data-stu-id="79508-151">If the maximum number of processes is running and a Subscriber attempts to generate a snapshot, the process is placed in a queue.</span></span> <span data-ttu-id="79508-152">Per impostazione predefinita, non esiste nessun limite per il numero di processi simultanei.</span><span class="sxs-lookup"><span data-stu-id="79508-152">By default there is no limit to the number of concurrent processes.</span></span>  
  
2.  <span data-ttu-id="79508-153">Nel server di pubblicazione eseguire [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-153">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="79508-154">Specificare il nome della pubblicazione utilizzato al passaggio 1 per la \*\* \@ pubblicazione\*\* e le [!INCLUDE[msCoName](../../includes/msconame-md.md)] credenziali di Windows utilizzate per l'autenticazione della [replica agente di snapshot](agents/replication-snapshot-agent.md) durante la connessione al server di pubblicazione, è necessario specificare anche il valore **0** per \*\* \@ publisher_security_mode\*\* e le [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] informazioni sull'account di accesso per \*\* \@ publisher_login\*\* e \*\* \@ publisher_password\*\*.</span><span class="sxs-lookup"><span data-stu-id="79508-154">Specify the publication name used in step 1 for **\@publication** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="79508-155">Verrà creato un processo dell'agente snapshot per la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-155">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="79508-156">Per ulteriori informazioni sulla generazione di uno snapshot iniziale e sulla definizione di una pianificazione personalizzata per l'agente snapshot, vedere [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="79508-156">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="79508-157">Quando si configura un server di pubblicazione con un server di distribuzione remoto, i valori specificati per tutti i parametri, inclusi *job_login* e *job_password*, vengono inviati al server di distribuzione come testo normale.</span><span class="sxs-lookup"><span data-stu-id="79508-157">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="79508-158">È consigliabile crittografare la connessione tra il server di pubblicazione e il server di distribuzione remoto prima di eseguire questa stored procedure.</span><span class="sxs-lookup"><span data-stu-id="79508-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="79508-159">Per altre informazioni, vedere [Abilitare le connessioni crittografate al motore di database &#40;Gestione configurazione SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="79508-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="79508-160">Per aggiungere articoli alla pubblicazione, eseguire [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-160">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="79508-161">Questa stored procedure deve essere eseguita una sola volta per ogni articolo della pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-161">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="79508-162">Quando si usano filtri con parametri, è necessario specificare un filtro di riga con parametri per uno o più articoli usando il parametro **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="79508-162">When using parameterized filters, you must specify a parameterized row filter for one or more articles using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="79508-163">Per altre informazioni, vedere [Definizione e modifica di un filtro di riga con parametri per un articolo di merge](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="79508-163">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="79508-164">Se il filtro di riga con parametri verrà usato per filtrare altri articoli, eseguire [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) per definire le relazioni di join o tra record logici tra gli articoli.</span><span class="sxs-lookup"><span data-stu-id="79508-164">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="79508-165">Questa stored procedure deve essere eseguita una sola volta per ogni relazione da definire.</span><span class="sxs-lookup"><span data-stu-id="79508-165">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="79508-166">Per altre informazioni, vedere [Definizione e modifica di un filtro di join tra articoli di merge](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="79508-166">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="79508-167">Quando l'agente di merge richiede che il Sottoscrittore venga inizializzato dallo snapshot, lo snapshot relativo alla partizione della sottoscrizione che ha eseguito la richiesta viene generato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="79508-167">When the Merge Agent requests the snapshot to initialize the Subscriber, the snapshot for the requesting subscription's partition is automatically generated.</span></span>  
  
#### <a name="to-create-a-publication-and-pre-generate-or-automatically-refresh-snapshots"></a><span data-ttu-id="79508-168">Per creare una pubblicazione e pregenerare o aggiornare automaticamente gli snapshot</span><span class="sxs-lookup"><span data-stu-id="79508-168">To create a publication and pre-generate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="79508-169">Eseguire [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) per creare la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-169">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="79508-170">Per altre informazioni, vedere [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="79508-170">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="79508-171">Nel server di pubblicazione eseguire [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-171">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="79508-172">Specificare il nome della pubblicazione usato nel passaggio 1 per **\@publication** e le credenziali di Windows usate per l'agente di snapshot per **\@job_login** e **\@password**.</span><span class="sxs-lookup"><span data-stu-id="79508-172">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="79508-173">Se l'agente userà l'autenticazione di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] per la connessione al server di pubblicazione, è necessario specificare anche il valore **0** per **\@publisher_security_mode** e le informazioni di accesso di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] per **\@publisher_login** e **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="79508-173">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="79508-174">Verrà creato un processo dell'agente snapshot per la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-174">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="79508-175">Per ulteriori informazioni sulla generazione di uno snapshot iniziale e sulla definizione di una pianificazione personalizzata per l'agente snapshot, vedere [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="79508-175">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="79508-176">Quando si configura un server di pubblicazione con un server di distribuzione remoto, i valori specificati per tutti i parametri, inclusi *job_login* e *job_password*, vengono inviati al server di distribuzione come testo normale.</span><span class="sxs-lookup"><span data-stu-id="79508-176">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="79508-177">È consigliabile crittografare la connessione tra il server di pubblicazione e il server di distribuzione remoto prima di eseguire questa stored procedure.</span><span class="sxs-lookup"><span data-stu-id="79508-177">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="79508-178">Per altre informazioni, vedere [Abilitare le connessioni crittografate al motore di database &#40;Gestione configurazione SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="79508-178">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="79508-179">Per aggiungere articoli alla pubblicazione, eseguire [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-179">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="79508-180">Questa stored procedure deve essere eseguita una sola volta per ogni articolo della pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-180">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="79508-181">Quando si usano filtri con parametri, è necessario specificare un filtro di riga con parametri per un articolo usando il parametro **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="79508-181">When using parameterized filters, you must specify a parameterized row filter for one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="79508-182">Per altre informazioni, vedere [Definizione e modifica di un filtro di riga con parametri per un articolo di merge](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="79508-182">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="79508-183">Se il filtro di riga con parametri verrà usato per filtrare altri articoli, eseguire [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) per definire le relazioni di join o tra record logici tra gli articoli.</span><span class="sxs-lookup"><span data-stu-id="79508-183">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="79508-184">Questa stored procedure deve essere eseguita una sola volta per ogni relazione da definire.</span><span class="sxs-lookup"><span data-stu-id="79508-184">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="79508-185">Per altre informazioni, vedere [Definizione e modifica di un filtro di join tra articoli di merge](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="79508-185">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="79508-186">Nel database di pubblicazione del server di pubblicazione eseguire [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specificando il valore **\@publication** dal passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="79508-186">At the Publisher on the publication database, execute [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specifying the value of **\@publication** from step 1.</span></span> <span data-ttu-id="79508-187">Si noti il valore di **snapshot_jobid** nel set di risultati.</span><span class="sxs-lookup"><span data-stu-id="79508-187">Note the value of the **snapshot_jobid** in the result set.</span></span>  
  
6.  <span data-ttu-id="79508-188">Convertire il valore di **snapshot_jobid** ottenuto al passaggio 5 in **uniqueidentifier**.</span><span class="sxs-lookup"><span data-stu-id="79508-188">Convert the value of the **snapshot_jobid** obtained in step 5 to **uniqueidentifier**.</span></span>  
  
7.  <span data-ttu-id="79508-189">Nel database **msdb** del server di pubblicazione eseguire [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql) specificando il valore convertito ottenuto nel passaggio 6 per **\@job_id**.</span><span class="sxs-lookup"><span data-stu-id="79508-189">At the Publisher on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the converted value obtained in step 6 for **\@job_id**.</span></span>  
  
8.  <span data-ttu-id="79508-190">Nel database di pubblicazione del server di pubblicazione eseguire [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-190">At the Publisher on the publication database, execute [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span></span> <span data-ttu-id="79508-191">Specificare il nome della pubblicazione ottenuto nel passaggio 1 per **\@publication** e il valore usato per definire la partizione per **\@suser_sname** se si usa [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) nella clausola di filtro oppure per **\@host_name** se si usa [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) nella clausola di filtro.</span><span class="sxs-lookup"><span data-stu-id="79508-191">Specify the name of the publication from step 1 for **\@publication** and the value used to define the partition for **\@suser_sname** if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used in the filter clause or for **\@host_name** if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used in the filter clause.</span></span>  
  
9. <span data-ttu-id="79508-192">Nel database di pubblicazione del server di pubblicazione eseguire [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-192">At the publisher on the publication database, execute [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span></span> <span data-ttu-id="79508-193">Specificare il nome della pubblicazione ottenuto nel passaggio 1 per **\@publication**, il valore di **\@suser_sname** o **\@host_name** dal passaggio 8 e una pianificazione per il processo.</span><span class="sxs-lookup"><span data-stu-id="79508-193">Specify the name of the publication from step 1 for **\@publication**, the value of **\@suser_sname** or **\@host_name** from step 8, and a schedule for the job.</span></span> <span data-ttu-id="79508-194">In tal modo verrà creato il processo che genera lo snapshot con parametri per la partizione specificata.</span><span class="sxs-lookup"><span data-stu-id="79508-194">This creates the job that generates the parameterized snapshot for the specified partition.</span></span> <span data-ttu-id="79508-195">Per altre informazioni, vedere [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="79508-195">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="79508-196">Per l'esecuzione di questo processo viene utilizzato lo stesso account di Windows del processo snapshot iniziale definito al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="79508-196">This job runs using the same Windows account as the initial snapshot job defined in step 2.</span></span> <span data-ttu-id="79508-197">Per rimuovere il processo snapshot con parametri e la partizione dati correlata, eseguire [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-197">To remove the parameterized snapshot job and its related data partition, execute [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span></span>  
  
10. <span data-ttu-id="79508-198">Nel database di pubblicazione del server di pubblicazione eseguire [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql), specificando il valore di **\@publication** ottenuto nel passaggio 1 e il valore di **\@suser_sname** o **\@host_name** dal passaggio 8.</span><span class="sxs-lookup"><span data-stu-id="79508-198">At the Publisher on the publication database, execute [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql), specifying the value of **\@publication** from step 1 and the value of **\@suser_sname** or **\@host_name** from step 8.</span></span> <span data-ttu-id="79508-199">Si noti il valore di **snapshot job** nel set di risultati.</span><span class="sxs-lookup"><span data-stu-id="79508-199">Note the value of the **dynamic_snapshot_jobid** in the result set.</span></span>  
  
11. <span data-ttu-id="79508-200">Nel database **msdb** del server di distribuzione eseguire [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql) specificando il valore ottenuto nel passaggio 9 per **\@job_id**.</span><span class="sxs-lookup"><span data-stu-id="79508-200">At the Distributor on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the value obtained in step 9 for **\@job_id**.</span></span> <span data-ttu-id="79508-201">In tal modo verrà avviato il processo snapshot con parametri per la partizione.</span><span class="sxs-lookup"><span data-stu-id="79508-201">This starts the parameterized snapshot job for the partition.</span></span>  
  
12. <span data-ttu-id="79508-202">Ripetere i passaggi da 8 a 11 per generare uno snapshot partizionato per ogni sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="79508-202">Repeat steps 8-11 to generate a partitioned snapshot for each subscription.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="79508-203">Per creare una pubblicazione e creare manualmente gli snapshot per ogni partizione</span><span class="sxs-lookup"><span data-stu-id="79508-203">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="79508-204">Eseguire [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) per creare la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-204">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="79508-205">Per altre informazioni, vedere [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="79508-205">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="79508-206">Nel server di pubblicazione eseguire [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-206">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="79508-207">Specificare il nome della pubblicazione usato nel passaggio 1 per **\@publication** e le credenziali di Windows usate per l'agente di snapshot per **\@job_login** e **\@password**.</span><span class="sxs-lookup"><span data-stu-id="79508-207">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="79508-208">Se l'agente userà l'autenticazione di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] per la connessione al server di pubblicazione, è necessario specificare anche il valore **0** per **\@publisher_security_mode** e le informazioni di accesso di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] per **\@publisher_login** e **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="79508-208">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="79508-209">Verrà creato un processo dell'agente snapshot per la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-209">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="79508-210">Per ulteriori informazioni sulla generazione di uno snapshot iniziale e sulla definizione di una pianificazione personalizzata per l'agente snapshot, vedere [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="79508-210">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="79508-211">Quando si configura un server di pubblicazione con un server di distribuzione remoto, i valori specificati per tutti i parametri, inclusi *job_login* e *job_password*, vengono inviati al server di distribuzione come testo normale.</span><span class="sxs-lookup"><span data-stu-id="79508-211">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="79508-212">È consigliabile crittografare la connessione tra il server di pubblicazione e il server di distribuzione remoto prima di eseguire questa stored procedure.</span><span class="sxs-lookup"><span data-stu-id="79508-212">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="79508-213">Per altre informazioni, vedere [Abilitare le connessioni crittografate al motore di database &#40;Gestione configurazione SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="79508-213">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="79508-214">Per aggiungere articoli alla pubblicazione, eseguire [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-214">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="79508-215">Questa stored procedure deve essere eseguita una sola volta per ogni articolo della pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-215">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="79508-216">Quando si usano filtri con parametri, è necessario specificare un filtro di riga con parametri per almeno un articolo usando il parametro **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="79508-216">When using parameterized filters, you must specify a parameterized row filter for at least one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="79508-217">Per altre informazioni, vedere [Definizione e modifica di un filtro di riga con parametri per un articolo di merge](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="79508-217">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="79508-218">Se il filtro di riga con parametri verrà usato per filtrare altri articoli, eseguire [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) per definire le relazioni di join o tra record logici tra gli articoli.</span><span class="sxs-lookup"><span data-stu-id="79508-218">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="79508-219">Questa stored procedure deve essere eseguita una sola volta per ogni relazione da definire.</span><span class="sxs-lookup"><span data-stu-id="79508-219">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="79508-220">Per altre informazioni, vedere [Definizione e modifica di un filtro di join tra articoli di merge](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="79508-220">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="79508-221">Avviare il processo snapshot o eseguire Agente snapshot repliche dal prompt dei comandi per generare lo schema standard dello snapshot standard e gli altri file.</span><span class="sxs-lookup"><span data-stu-id="79508-221">Start the snapshot job or run the Replication Snapshot Agent from the command prompt to generate the standard snapshot schema and other files.</span></span> <span data-ttu-id="79508-222">Per altre informazioni, vedere [Creazione e applicazione dello snapshot iniziale](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="79508-222">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
6.  <span data-ttu-id="79508-223">Eseguire nuovamente Agente snapshot repliche dal prompt dei comandi per generare file della copia bulk (estensione bcp), specificando il percorso dello snapshot partizionato per **- DynamicSnapshotLocation** e una o entrambe le proprietà seguenti che definiscono la partizione:</span><span class="sxs-lookup"><span data-stu-id="79508-223">Run the Replication Snapshot Agent again from the command prompt to generate bulk copy (.bcp) files, specifying the location of the partitioned snapshot for **-DynamicSnapshotLocation** and one or both of the following properties that defines the partition:</span></span>  
  
    -   <span data-ttu-id="79508-224">**-DynamicFilterHostName** - valore se viene usato [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-224">**-DynamicFilterHostName** - the value if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used.</span></span>  
  
    -   <span data-ttu-id="79508-225">**-DynamicFilterLogin** - valore se viene usato [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="79508-225">**-DynamicFilterLogin** - the value if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used.</span></span>  
  
7.  <span data-ttu-id="79508-226">Ripetere il passaggio 6 per generare uno snapshot partizionato per ogni sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="79508-226">Repeat step 6 to generate a partitioned snapshot for each subscription.</span></span>  
  
8.  <span data-ttu-id="79508-227">Eseguire l'agente di merge per consentire a ogni sottoscrizione di applicare lo snapshot partizionato iniziale ai Sottoscrittori, specificando le proprietà seguenti:</span><span class="sxs-lookup"><span data-stu-id="79508-227">Run the Merge Agent for each subscription to apply the initial partitioned snapshot at the Subscribers, specifying the following properties:</span></span>  
  
    -   <span data-ttu-id="79508-228">**-Hostname** : valore utilizzato per definire la partizione se viene eseguito l'override del valore effettivo di HOST_NAME.</span><span class="sxs-lookup"><span data-stu-id="79508-228">**-Hostname** - the value used to define the partition if the actual value of HOST_NAME is being overridden.</span></span>  
  
    -   <span data-ttu-id="79508-229">**-DynamicSnapshotLocation** : percorso dello snapshot dinamico per questa partizione.</span><span class="sxs-lookup"><span data-stu-id="79508-229">**-DynamicSnapshotLocation** - the location of the dynamic snapshot for this partition.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="79508-230">Per altre informazioni sulla programmazione degli agenti di replica, vedere [Concetti di base relativi ai file eseguibili dell'agente di replica](concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="79508-230">For more information about programming replication agents, see [Replication Agent Executables Concepts](concepts/replication-agent-executables-concepts.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="79508-231">Esempi (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="79508-231">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="79508-232">In questo esempio viene creata una pubblicazione di tipo merge con filtri con parametri in cui i Sottoscrittori avviano il processo di generazione dello snapshot.</span><span class="sxs-lookup"><span data-stu-id="79508-232">This example creates a merge publication with parameterized filters where Subscribers initiate the snapshot generation process.</span></span> <span data-ttu-id="79508-233">I valori per **\@job_login** e **\@job_password** vengono passati tramite variabili di scripting.</span><span class="sxs-lookup"><span data-stu-id="79508-233">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic1.sql#sp_mergedynamicpub1)]  
  
 <span data-ttu-id="79508-234">In questo esempio viene creata una pubblicazione utilizzando un filtro con parametri in cui la partizione di ogni Sottoscrittore viene definita eseguendo [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) e il processo snapshot con filtro viene creato eseguendo [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) passando le informazioni sul partizionamento.</span><span class="sxs-lookup"><span data-stu-id="79508-234">This example creates a publication using a parameterized filter where each Subscriber has its partition defined by executing [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) and the filtered snapshot job created by executing [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) passing the partitioning information.</span></span> <span data-ttu-id="79508-235">I valori per **\@job_login** e **\@job_password** vengono passati tramite variabili di scripting.</span><span class="sxs-lookup"><span data-stu-id="79508-235">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPlusPartition](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic2.sql#sp_mergedynamicpubpluspartition)]  
  
 <span data-ttu-id="79508-236">In questo esempio viene creata una pubblicazione utilizzando un filtro con parametri in cui il Sottoscrittore deve disporre di una propria partizione dati e il processo snapshot con filtro viene creato fornendo le informazioni sul partizionamento.</span><span class="sxs-lookup"><span data-stu-id="79508-236">This example creates a publication using a parameterized filter where each Subscriber must have its data partition and filtered snapshot job created by supplying the partitioning information.</span></span> <span data-ttu-id="79508-237">Un Sottoscrittore fornisce le informazioni sul partizionamento utilizzando i parametri della riga di comando durante l'esecuzione manuale degli agenti di replica.</span><span class="sxs-lookup"><span data-stu-id="79508-237">A Subscriber supplies partitioning information using command-line parameters when manually running the replication agents.</span></span> <span data-ttu-id="79508-238">In questo esempio si presuppone che sia stata creata anche una sottoscrizione della pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-238">This example assumes that a subscription to the publication has also been created.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPartitionManual](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic3.sql#sp_mergedynamicpubpartitionmanual)]  
  
 
```
REM Line breaks are added to improve readability.   
REM In a batch file, commands must be made in a single line.  
REM Run the Snapshot agent from the command line to generate the standard snapshot   
REM schema and other files.   
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub% -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  
  
PAUSE  
```

```
REM Run the Snapshot agent from the command line, this time to generate   
REM the bulk copy (.bcp) data for each Subscriber partition.    
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
MD %SnapshotDir%  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub%  -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  -DynamicFilterHostName "adventure-works\Fernando"    
-DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE  
```

```
REM Run the Merge Agent for each subscription to apply the partitioned   
REM snapshot for each Subscriber.    
SET Publisher = %computername%  
SET Subscriber = %computername%  
SET PubDB = AdventureWorks2012   
SET SubDB = AdventureWorks2012Replica   
SET PubName = AdvWorksSalesPersonMerge   
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
"C:\Program Files\Microsoft SQL Server\120\COM\REPLMERG.EXE" -Publisher  %Publisher%    
-Subscriber  %Subscriber%  -Distributor %Publisher%  -PublisherDB %PubDB%    
-SubscriberDB %SubDB% -Publication %PubName%  -PublisherSecurityMode 1  -OutputVerboseLevel 3    
-Output -SubscriberSecurityMode 1  -SubscriptionType 3 -DistributorSecurityMode 1    
-Hostname "adventure-works\Fernando"  -DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE
```
  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="79508-239">Utilizzo di RMO (Replication Management Objects)</span><span class="sxs-lookup"><span data-stu-id="79508-239">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="79508-240">È possibile utilizzare oggetti RMO (Replication Management Objects) per generare snapshot partizionati a livello di programmazione nelle modalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="79508-240">You can use Replication Management Objects (RMO) to generate partitioned snapshots programmatically in the following ways:</span></span>  
  
-   <span data-ttu-id="79508-241">Consentire ai Sottoscrittori di richiedere la generazione e l'applicazione dello snapshot alla prima sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="79508-241">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="79508-242">Pregenerare uno snapshot per ogni partizione.</span><span class="sxs-lookup"><span data-stu-id="79508-242">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="79508-243">Generare manualmente uno snapshot per ogni Sottoscrittore eseguendo l'agente snapshot.</span><span class="sxs-lookup"><span data-stu-id="79508-243">Manually generate a snapshot for each Subscriber by running the Snapshot Agent.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="79508-244">Quando il filtro di un articolo produce partizioni non sovrapposte univoche per ogni sottoscrizione (specificando un valore <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> per <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> nel caso della creazione di un articolo di tipo merge), i metadati vengono puliti ogni volta che viene eseguito l'agente di merge.</span><span class="sxs-lookup"><span data-stu-id="79508-244">When filtering for an article yields non-overlapping partitions that are unique for each subscription (by specifying a value of <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> for <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> when creating a merge article), metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="79508-245">Lo snapshot partizionato scade quindi più rapidamente.</span><span class="sxs-lookup"><span data-stu-id="79508-245">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="79508-246">Quando si utilizza questa opzione, è consigliabile consentire ai Sottoscrittori di richiedere la generazione degli snapshot.</span><span class="sxs-lookup"><span data-stu-id="79508-246">When you use this option, you should consider allowing Subscribers to request snapshot generation.</span></span> <span data-ttu-id="79508-247">Per ulteriori informazioni, vedere la sezione relativa all'utilizzo delle opzioni di filtro appropriate nell'argomento [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="79508-247">For more information, see the section Using the Appropriate Filtering Options in the topic [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="79508-248">Se possibile, richiedere agli utenti di immettere le credenziali di sicurezza in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="79508-248">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="79508-249">Se è necessario archiviare le credenziali, utilizzare i [servizi di crittografia](https://go.microsoft.com/fwlink/?LinkId=34733) offerti da [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="79508-249">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="79508-250">Per creare una pubblicazione che consente ai Sottoscrittori di avviare la generazione e il recapito di snapshot</span><span class="sxs-lookup"><span data-stu-id="79508-250">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="79508-251">Creare una connessione al server di pubblicazione tramite la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="79508-251">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="79508-252">Creare un'istanza della classe <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> per il database di pubblicazione, impostare la proprietà <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> sull'istanza di <xref:Microsoft.SqlServer.Management.Common.ServerConnection> del passaggio 1, quindi chiamare il metodo <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="79508-252">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="79508-253">Se <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> restituisce `false`, verificare che il database esista.</span><span class="sxs-lookup"><span data-stu-id="79508-253">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, confirm that the database exists.</span></span>  
  
3.  <span data-ttu-id="79508-254">Se la proprietà <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> è `false`, impostarla su `true` e chiamare <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-254">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> property is `false`, set it to `true` and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="79508-255">Creare un'istanza della classe <xref:Microsoft.SqlServer.Replication.MergePublication> e impostare le proprietà seguenti per questo oggetto:</span><span class="sxs-lookup"><span data-stu-id="79508-255">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="79508-256">Oggetto <xref:Microsoft.SqlServer.Management.Common.ServerConnection> indicato nel passaggio 1 per <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-256">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="79508-257">Nome del database pubblicato per <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-257">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="79508-258">Nome per la pubblicazione per <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-258">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="79508-259">Numero massimo di processi di snapshot dinamici da eseguire per <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-259">The maximum number of dynamic snapshot jobs to run for <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span></span> <span data-ttu-id="79508-260">Poiché le richieste di snapshot avviate dal Sottoscrittore possono verificarsi in qualsiasi momento, questa proprietà limita il numero di processi dell'agente snapshot che possono essere eseguiti simultaneamente quando più Sottoscrittori richiedono il rispettivo snapshot partizionato contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="79508-260">Because Subscriber initiated snapshot requests can occur at any time, this property limits the number of Snapshot Agent jobs that can run simultaneously when multiple Subscribers request their partitioned snapshot at the same time.</span></span> <span data-ttu-id="79508-261">Quando è in esecuzione il numero massimo di processi, le richieste aggiuntive di snapshot partizionati vengono inserite nella coda fino al completamento di uno dei processi.</span><span class="sxs-lookup"><span data-stu-id="79508-261">When the maximum number of jobs are running, additional partitioned snapshot requests are queued until one of the running jobs is completed.</span></span>  
  
    -   <span data-ttu-id="79508-262">Utilizzare l'operatore logico OR bit per bit (`|` in Visual C# e `Or` in Visual Basic) per aggiungere il valore <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> a <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-262">Use the bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) operator to add the value <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> to <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span></span>  
  
    -   <span data-ttu-id="79508-263">Campi <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> e <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> di <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> per fornire le credenziali per l'account di [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows con cui verrà eseguito il processo dell'agente snapshot.</span><span class="sxs-lookup"><span data-stu-id="79508-263">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Snapshot Agent job runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="79508-264">È consigliabile impostare <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> quando la pubblicazione viene creata da un membro del ruolo predefinito del server `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="79508-264">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is recommended when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="79508-265">Per altre informazioni, vedere [Modello di sicurezza dell'agente di replica](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="79508-265">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
5.  <span data-ttu-id="79508-266">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> per creare la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-266">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="79508-267">Quando si configura un server di pubblicazione con un server di distribuzione remoto, i valori specificati per tutte le proprietà, inclusa <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, vengono inviati al server di distribuzione come testo normale.</span><span class="sxs-lookup"><span data-stu-id="79508-267">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="79508-268">È consigliabile crittografare la connessione tra il server di pubblicazione e il server di distribuzione remoto prima di chiamare il metodo <xref:Microsoft.SqlServer.Replication.Publication.Create%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-268">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="79508-269">Per altre informazioni, vedere [Abilitare le connessioni crittografate al motore di database &#40;Gestione configurazione SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="79508-269">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="79508-270">Utilizzare la proprietà <xref:Microsoft.SqlServer.Replication.MergeArticle> per aggiungere articoli alla pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-270">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="79508-271">Specificare la proprietà <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> per almeno un articolo che definisce il filtro con parametri.</span><span class="sxs-lookup"><span data-stu-id="79508-271">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter.</span></span> <span data-ttu-id="79508-272">(Facoltativo) Creare oggetti <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> che definiscono i filtri join tra gli articoli.</span><span class="sxs-lookup"><span data-stu-id="79508-272">(Optional) Create <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="79508-273">Per altre informazioni, vedere [definire un articolo](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="79508-273">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
7.  <span data-ttu-id="79508-274">Se il valore di <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> è `false`, chiamare <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> per creare il processo dell'agente snapshot iniziale per questa pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-274">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the initial Snapshot Agent job for this publication.</span></span>  
  
8.  <span data-ttu-id="79508-275">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> dell'oggetto <xref:Microsoft.SqlServer.Replication.MergePublication> creato nel passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="79508-275">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 4.</span></span> <span data-ttu-id="79508-276">In questo modo viene avviato il processo dell'agente che genera lo snapshot iniziale.</span><span class="sxs-lookup"><span data-stu-id="79508-276">This starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="79508-277">Per ulteriori informazioni sulla generazione di uno snapshot iniziale e sulla definizione di una pianificazione personalizzata per l'agente snapshot, vedere [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="79508-277">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
9. <span data-ttu-id="79508-278">(Facoltativo) Verificare la presenza di un valore `true` per la proprietà <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> per determinare quando lo snapshot iniziale è pronto per l'utilizzo.</span><span class="sxs-lookup"><span data-stu-id="79508-278">(Optional) Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
10. <span data-ttu-id="79508-279">La prima volta che l'agente di merge per un Sottoscrittore si connette, verrà generato automaticamente uno snapshot partizionato.</span><span class="sxs-lookup"><span data-stu-id="79508-279">When the Merge Agent for a Subscriber connects for the first time, a partitioned snapshot is generated automatically.</span></span>  
  
#### <a name="to-create-a-publication-and-pregenerate-or-automatically-refresh-snapshots"></a><span data-ttu-id="79508-280">Per creare una pubblicazione e pregenerare o aggiornare automaticamente gli snapshot</span><span class="sxs-lookup"><span data-stu-id="79508-280">To create a publication and pregenerate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="79508-281">Utilizzare un'istanza della classe <xref:Microsoft.SqlServer.Replication.MergePublication> per definire una pubblicazione di tipo merge.</span><span class="sxs-lookup"><span data-stu-id="79508-281">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="79508-282">Per altre informazioni, vedere [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="79508-282">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="79508-283">Utilizzare la proprietà <xref:Microsoft.SqlServer.Replication.MergeArticle> per aggiungere articoli alla pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-283">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="79508-284">Specificare la proprietà <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> per almeno un articolo che definisce il filtro con parametri, quindi creare eventuali oggetti <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> che definiscono filtri join tra gli articoli.</span><span class="sxs-lookup"><span data-stu-id="79508-284">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="79508-285">Per altre informazioni, vedere [definire un articolo](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="79508-285">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="79508-286">Se il valore di <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> è `false`, chiamare <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> per creare il processo dell'agente snapshot per questa pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="79508-286">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
4.  <span data-ttu-id="79508-287">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> dell'oggetto <xref:Microsoft.SqlServer.Replication.MergePublication> creato nel passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="79508-287">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 1.</span></span> <span data-ttu-id="79508-288">Questo metodo avvia il processo dell'agente che genera lo snapshot iniziale.</span><span class="sxs-lookup"><span data-stu-id="79508-288">This method starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="79508-289">Per ulteriori informazioni sulla generazione di uno snapshot iniziale e sulla definizione di una pianificazione personalizzata per l'agente snapshot, vedere [Creazione e applicazione dello snapshot iniziale](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="79508-289">For more information on generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
5.  <span data-ttu-id="79508-290">(Facoltativo) Verificare la presenza di un valore `true` per la proprietà <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> per determinare quando lo snapshot iniziale è pronto per l'utilizzo.</span><span class="sxs-lookup"><span data-stu-id="79508-290">Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
6.  <span data-ttu-id="79508-291">Creare un'istanza della classe <xref:Microsoft.SqlServer.Replication.MergePartition> e impostare i criteri di filtro con parametri per il Sottoscrittore utilizzando una o entrambe le proprietà seguenti:</span><span class="sxs-lookup"><span data-stu-id="79508-291">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePartition> class, and set the parameterized filtering criteria for the Subscriber by using one or both of the following properties:</span></span>  
  
    -   <span data-ttu-id="79508-292">Se la partizione del Sottoscrittore è definita dal risultato di [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), usare <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-292">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="79508-293">Se la partizione del Sottoscrittore è definita dal risultato di [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) o da un overload di questa funzione, usare <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-293">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="79508-294">Creare un'istanza della classe <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> e impostare la stessa proprietà indicata nel passaggio 6.</span><span class="sxs-lookup"><span data-stu-id="79508-294">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> class, and set the same property as in step 6.</span></span>  
  
8.  <span data-ttu-id="79508-295">Utilizzare la classe <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> per definire una pianificazione per la generazione dello snapshot filtrato per la partizione del Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="79508-295">Use the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> class to define a schedule for generating the filtered snapshot for the Subscriber partition.</span></span>  
  
9. <span data-ttu-id="79508-296">Utilizzando l'istanza di <xref:Microsoft.SqlServer.Replication.MergePublication> indicata nel passaggio 1, chiamare <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-296">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span></span> <span data-ttu-id="79508-297">Passare l'oggetto <xref:Microsoft.SqlServer.Replication.MergePartition> indicato nel passaggio 6.</span><span class="sxs-lookup"><span data-stu-id="79508-297">Pass the <xref:Microsoft.SqlServer.Replication.MergePartition> object from step 6.</span></span>  
  
10. <span data-ttu-id="79508-298">Utilizzando l'istanza di <xref:Microsoft.SqlServer.Replication.MergePublication> indicata nel passaggio 1, chiamare il metodo <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> .</span><span class="sxs-lookup"><span data-stu-id="79508-298">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call the <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> method.</span></span> <span data-ttu-id="79508-299">Passare l'oggetto <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> indicato nel passaggio 7 e l'oggetto <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> indicato nel passaggio 8.</span><span class="sxs-lookup"><span data-stu-id="79508-299">Pass the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object from step 7 and the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> object from step 8.</span></span>  
  
11. <span data-ttu-id="79508-300">Chiamare <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>e individuare l'oggetto <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> per il processo di snapshot partizionato appena aggiunto nella matrice restituita.</span><span class="sxs-lookup"><span data-stu-id="79508-300">Call <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>, and locate the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object for the newly added partitioned snapshot job in the returned array.</span></span>  
  
12. <span data-ttu-id="79508-301">Ottenere la proprietà <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> per il processo.</span><span class="sxs-lookup"><span data-stu-id="79508-301">Get the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> property for the job.</span></span>  
  
13. <span data-ttu-id="79508-302">Creare una connessione al server di distribuzione tramite la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="79508-302">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
14. <span data-ttu-id="79508-303">Creare un'istanza della classe <xref:Microsoft.SqlServer.Management.Smo.Server> SMO (SQL Server Management Objects) passando l'oggetto <xref:Microsoft.SqlServer.Management.Common.ServerConnection> indicato nel passaggio 13.</span><span class="sxs-lookup"><span data-stu-id="79508-303">Create an instance of the SQL Server Management Objects (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> class, passing the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> object from step 13.</span></span>  
  
15. <span data-ttu-id="79508-304">Creare un'istanza della classe <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> passando la proprietà <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> dell'oggetto <xref:Microsoft.SqlServer.Management.Smo.Server> indicato nel passaggio 14 e il nome del processo indicato nel passaggio 12.</span><span class="sxs-lookup"><span data-stu-id="79508-304">Create an instance of the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> class, passing the <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> property of the <xref:Microsoft.SqlServer.Management.Smo.Server> object from step 14 and the job name from step 12.</span></span>  
  
16. <span data-ttu-id="79508-305">Chiamare il metodo <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> per avviare il processo di snapshot partizionato.</span><span class="sxs-lookup"><span data-stu-id="79508-305">Call the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> method to start the partitioned snapshot job.</span></span>  
  
17. <span data-ttu-id="79508-306">Ripetere i passaggi da 6 a 16 per ogni Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="79508-306">Repeat steps 6-16 for each Subscriber.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="79508-307">Per creare una pubblicazione e creare manualmente gli snapshot per ogni partizione</span><span class="sxs-lookup"><span data-stu-id="79508-307">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="79508-308">Utilizzare un'istanza della classe <xref:Microsoft.SqlServer.Replication.MergePublication> per definire una pubblicazione di tipo merge.</span><span class="sxs-lookup"><span data-stu-id="79508-308">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="79508-309">Per altre informazioni, vedere [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="79508-309">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="79508-310">Utilizzare la proprietà <xref:Microsoft.SqlServer.Replication.MergeArticle> per aggiungere articoli alla pubblicazione. Specificare la proprietà <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> per almeno un articolo che definisce il filtro con parametri, quindi creare eventuali oggetti <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> che definiscono i filtri join tra gli articoli.</span><span class="sxs-lookup"><span data-stu-id="79508-310">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="79508-311">Per altre informazioni, vedere [definire un articolo](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="79508-311">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="79508-312">Generare lo snapshot iniziale.</span><span class="sxs-lookup"><span data-stu-id="79508-312">Generate the initial snapshot.</span></span> <span data-ttu-id="79508-313">Per altre informazioni, vedere [Creazione e applicazione dello snapshot iniziale](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="79508-313">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
4.  <span data-ttu-id="79508-314">Creare un'istanza della classe <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> e impostare le seguenti proprietà obbligatorie:</span><span class="sxs-lookup"><span data-stu-id="79508-314">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="79508-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> : nome del server di pubblicazione</span><span class="sxs-lookup"><span data-stu-id="79508-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="79508-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> : nome del database di pubblicazione</span><span class="sxs-lookup"><span data-stu-id="79508-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="79508-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> : nome della pubblicazione</span><span class="sxs-lookup"><span data-stu-id="79508-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="79508-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> : nome del server di distribuzione</span><span class="sxs-lookup"><span data-stu-id="79508-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="79508-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> : valore di <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> per usare l'autenticazione integrata di Windows o valore di <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> per usare l'autenticazione di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79508-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
    -   <span data-ttu-id="79508-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> : valore di <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> per usare l'autenticazione integrata di Windows o valore di <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> per usare l'autenticazione di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79508-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
5.  <span data-ttu-id="79508-321">Impostare un valore di <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> per <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-321">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
6.  <span data-ttu-id="79508-322">Impostare una o più delle seguenti proprietà per definire i parametri di partizionamento:</span><span class="sxs-lookup"><span data-stu-id="79508-322">Set one or more of the following properties to define the partitioning parameters:</span></span>  
  
    -   <span data-ttu-id="79508-323">Se la partizione del Sottoscrittore è definita dal risultato di [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), usare <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-323">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="79508-324">Se la partizione del Sottoscrittore è definita dal risultato di [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) o da un overload di questa funzione, usare <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span><span class="sxs-lookup"><span data-stu-id="79508-324">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="79508-325">Chiamare il metodo <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> .</span><span class="sxs-lookup"><span data-stu-id="79508-325">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
8.  <span data-ttu-id="79508-326">Ripetere i passaggi da 4 a 7 per ogni Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="79508-326">Repeat steps 4-7 for each Subscriber.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="79508-327">Esempi (RMO)</span><span class="sxs-lookup"><span data-stu-id="79508-327">Examples (RMO)</span></span>  
 <span data-ttu-id="79508-328">In questo esempio viene creata una pubblicazione di tipo merge che consente ai Sottoscrittori di richiedere la generazione di snapshot.</span><span class="sxs-lookup"><span data-stu-id="79508-328">This example creates a merge publication that allows Subscribers to requested snapshot generation.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
 <span data-ttu-id="79508-329">In questo esempio vengono creati manualmente la partizione del Sottoscrittore e lo snapshot filtrato per una pubblicazione di tipo merge con filtri di riga con parametri.</span><span class="sxs-lookup"><span data-stu-id="79508-329">This example manually creates the Subscriber partition and the filtered snapshot for a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePartition](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepartition)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePartition](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepartition)]  
  
 <span data-ttu-id="79508-330">In questo esempio viene avviato manualmente l'agente snapshot per generare lo snapshot di dati filtrati per un Sottoscrittore in una pubblicazione di tipo merge con filtri di riga con parametri.</span><span class="sxs-lookup"><span data-stu-id="79508-330">This example manually starts the Snapshot Agent to generate the filtered data snapshot for a Subscriber to a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateFilteredSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatefilteredsnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateFilteredSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatefilteredsnapshot)]  
  
## <a name="see-also"></a><span data-ttu-id="79508-331">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="79508-331">See Also</span></span>  
 <span data-ttu-id="79508-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span><span class="sxs-lookup"><span data-stu-id="79508-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span></span>  
 <span data-ttu-id="79508-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="79508-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="79508-334">[Snapshot per pubblicazioni di tipo merge con filtri con parametri](snapshots-for-merge-publications-with-parameterized-filters.md) </span><span class="sxs-lookup"><span data-stu-id="79508-334">[Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md) </span></span>  
 [<span data-ttu-id="79508-335">Procedure consigliate per la sicurezza della replica</span><span class="sxs-lookup"><span data-stu-id="79508-335">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
