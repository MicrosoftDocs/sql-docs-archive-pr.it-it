---
title: Strategie di backup e ripristino della replica snapshot e della replica transazionale | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- backups [SQL Server replication], snapshot replication
- restoring [SQL Server replication], transactional replication
- snapshot replication [SQL Server], backup and restore
- restoring [SQL Server replication], snapshot replication
- recovery [SQL Server replication], transactional replication
- transactional replication, backup and restore
- recovery [SQL Server replication], snapshot replication
- sync with backup [SQL Server replication]
- backups [SQL Server replication], transactional replication
ms.assetid: a8afcdbc-55db-4916-a219-19454f561f9e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e26f6cf1a61e4df9db79bc5fd90429f86d70a99f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87638390"
---
# <a name="strategies-for-backing-up-and-restoring-snapshot-and-transactional-replication"></a><span data-ttu-id="0556e-102">Strategie per il backup e il ripristino della replica snapshot e della replica transazionale</span><span class="sxs-lookup"><span data-stu-id="0556e-102">Strategies for Backing Up and Restoring Snapshot and Transactional Replication</span></span>
  <span data-ttu-id="0556e-103">Quando si progetta una strategia di backup e ripristino per la replica snapshot e la replica transazionale, è necessario considerare le tre aree di fattori seguenti:</span><span class="sxs-lookup"><span data-stu-id="0556e-103">When you design a backup and restore strategy for snapshot and transactional replication, there are three areas to consider:</span></span>  
  
-   <span data-ttu-id="0556e-104">Database di cui eseguire il backup.</span><span class="sxs-lookup"><span data-stu-id="0556e-104">Which databases to back up.</span></span>  
  
-   <span data-ttu-id="0556e-105">Impostazioni di backup per la replica transazionale.</span><span class="sxs-lookup"><span data-stu-id="0556e-105">Backup settings for transactional replication.</span></span>  
  
-   <span data-ttu-id="0556e-106">Passaggi richiesti per ripristinare un database,</span><span class="sxs-lookup"><span data-stu-id="0556e-106">The steps that are required to restore a database.</span></span> <span data-ttu-id="0556e-107">i quali variano in base al tipo di replica e alle opzioni scelte.</span><span class="sxs-lookup"><span data-stu-id="0556e-107">These depend on the type of replication and options chosen.</span></span>  
  
 <span data-ttu-id="0556e-108">In questo argomento vengono illustrate le tre aree elencate in precedenza.</span><span class="sxs-lookup"><span data-stu-id="0556e-108">This topic covers each of these areas in the next three sections.</span></span> <span data-ttu-id="0556e-109">Per altre informazioni sul backup e il ripristino per la pubblicazione Oracle, vedere [Backup e ripristino di server di pubblicazione Oracle](../non-sql/backup-and-restore-for-oracle-publishers.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-109">For information about backup and restore for Oracle publishing, see [Backup and Restore for Oracle Publishers](../non-sql/backup-and-restore-for-oracle-publishers.md).</span></span>  
  
## <a name="backing-up-databases"></a><span data-ttu-id="0556e-110">Backup di database</span><span class="sxs-lookup"><span data-stu-id="0556e-110">Backing up Databases</span></span>  
 <span data-ttu-id="0556e-111">Per la replica snapshot e la replica transazionale è necessario effettuare a intervalli regolari il backup dei database seguenti:</span><span class="sxs-lookup"><span data-stu-id="0556e-111">For snapshot and transactional replication, you should regularly back up the following databases:</span></span>  
  
-   <span data-ttu-id="0556e-112">Database di pubblicazione nel server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-112">The publication database at the Publisher.</span></span>  
  
-   <span data-ttu-id="0556e-113">Database di distribuzione nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-113">The distribution database at the Distributor.</span></span>  
  
-   <span data-ttu-id="0556e-114">Database di sottoscrizione in ogni Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="0556e-114">The subscription database at each Subscriber.</span></span>  
  
-   <span data-ttu-id="0556e-115">Database di sistema **master** e **msdb** nel server di pubblicazione, nel database di distribuzione e in tutti i Sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="0556e-115">The **master** and **msdb** system databases at the Publisher, Distributor and all Subscribers.</span></span> <span data-ttu-id="0556e-116">È necessario che il backup di questi database venga eseguito contemporaneamente e che venga inoltre eseguito nello stesso momento di quello del relativo database di replica.</span><span class="sxs-lookup"><span data-stu-id="0556e-116">These databases should be backed up at the same time as each other and the relevant replication database.</span></span> <span data-ttu-id="0556e-117">Eseguire ad esempio il backup dei database **master** e **msdb** nel server di pubblicazione nello stesso momento in cui si esegue il backup del database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-117">For example, back up the **master** and **msdb** databases at the Publisher at the same time that you back up the publication database.</span></span> <span data-ttu-id="0556e-118">Se il database di pubblicazione viene ripristinato, verificare che i database **master** e **msdb** siano consistenti con il database di pubblicazione in termini di impostazioni e configurazione della replica.</span><span class="sxs-lookup"><span data-stu-id="0556e-118">If the publication database is restored, make sure that the **master** and **msdb** databases are consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
 <span data-ttu-id="0556e-119">Se si eseguono backup regolari del log, le eventuali modifiche correlate alla replica dovrebbero essere incluse nei backup del log.</span><span class="sxs-lookup"><span data-stu-id="0556e-119">If you perform regular log backups, any replication-related changes should be captured in the log backups.</span></span> <span data-ttu-id="0556e-120">Se non si eseguono i backup del log, è necessario eseguire un backup ogni volta che un'impostazione relativa alla replica viene modificata.</span><span class="sxs-lookup"><span data-stu-id="0556e-120">If you do not perform log backups, a backup should be performed whenever a setting relevant to replication is changed.</span></span> <span data-ttu-id="0556e-121">Per altre informazioni, vedere [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-121">For more information, see [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span></span>  
  
## <a name="backup-settings-for-transactional-replication"></a><span data-ttu-id="0556e-122">Impostazioni di backup per la replica transazionale</span><span class="sxs-lookup"><span data-stu-id="0556e-122">Backup Settings for Transactional Replication</span></span>  
 <span data-ttu-id="0556e-123">La replica transazionale implica l'utilizzo dell'opzione **sync with backup** , che può essere impostata nel database di distribuzione e nel database di pubblicazione:</span><span class="sxs-lookup"><span data-stu-id="0556e-123">Transactional replication includes using the **sync with backup** option, which can be set on the distribution database and the publication database:</span></span>  
  
-   <span data-ttu-id="0556e-124">Si consiglia di impostare sempre questa opzione nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-124">We recommend that you always set this option on the distribution database.</span></span>  
  
     <span data-ttu-id="0556e-125">L'impostazione di questa opzione nel database di distribuzione impedisce che le transazioni nel log del database di pubblicazione vengano troncate fino al relativo backup nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-125">Setting this option on the distribution database ensures that transactions in the log of the publication database will not be truncated until they have been backed up at the distribution database.</span></span> <span data-ttu-id="0556e-126">È possibile ripristinare lo stato del database di distribuzione al momento dell'ultimo backup. Eventuali transazioni mancanti verranno recapitate dal database di pubblicazione al database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-126">The distribution database can be restored to the last backup, and any missing transactions are delivered from the publication database to the distribution database.</span></span> <span data-ttu-id="0556e-127">La replica continua senza interruzioni.</span><span class="sxs-lookup"><span data-stu-id="0556e-127">Replication continues unaffected.</span></span>  
  
     <span data-ttu-id="0556e-128">L'impostazione di questa opzione nel database di distribuzione non influisce sulla latenza di replica.</span><span class="sxs-lookup"><span data-stu-id="0556e-128">Setting this option on the distribution database does not affect replication latency.</span></span> <span data-ttu-id="0556e-129">L'opzione ritarderà tuttavia il troncamento del log nel database di pubblicazione fino a quando non viene eseguito il backup delle transazioni corrispondenti nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-129">However, the option will delay the truncation of the log on the publication database until the corresponding transactions in the distribution database have been backed up.</span></span> <span data-ttu-id="0556e-130">Ciò può comportare la creazione di un log delle transazioni di dimensioni maggiori nel database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-130">(This can create a larger transaction log in the publication database.)</span></span>  
  
-   <span data-ttu-id="0556e-131">Si consiglia di impostare questa opzione nel database di pubblicazione se l'applicazione in uso tollera un'ulteriore latenza.</span><span class="sxs-lookup"><span data-stu-id="0556e-131">We recommend that you set this option on the publication database if your application can tolerate additional latency.</span></span>  
  
     <span data-ttu-id="0556e-132">L'impostazione di questa opzione nel database di pubblicazione garantisce che le transazioni vengano recapitate al database di distribuzione solo dopo che è stato eseguito il backup nel database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-132">Setting this option on the publication database ensures that transactions are not delivered to the distribution database until they are backed up at the publication database.</span></span> <span data-ttu-id="0556e-133">Nel server di pubblicazione è quindi possibile ripristinare il backup più recente del database di pubblicazione, evitando che il database di distribuzione disponga di transazioni che risultino mancanti nel database di pubblicazione ripristinato.</span><span class="sxs-lookup"><span data-stu-id="0556e-133">The last publication database backup can then be restored at the Publisher without any chance of the distribution database having transactions that the restored publication database does not have.</span></span>  
  
     <span data-ttu-id="0556e-134">La latenza e la velocità effettiva sono interessate da questo aspetto, in quanto le transazioni possono essere recapitate al database di distribuzione solo dopo che ne è stato eseguito il backup nel server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-134">Latency and throughput are affected because transactions cannot be delivered to the distribution database until they have been backed up at the Publisher.</span></span> <span data-ttu-id="0556e-135">Se ad esempio viene eseguito un backup del log delle transazioni ogni cinque minuti, si verifica un'ulteriore latenza di cinque minuti tra l'esecuzione del commit di una transazione nel server di pubblicazione e il recapito della transazione al database di distribuzione e successivamente al Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="0556e-135">For example, if the transaction log is backed up every five minutes, there is an additional five minutes of latency between when a transaction is committed at the Publisher and when the transaction is delivered to the distribution database, and subsequently the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="0556e-136">L'opzione **sync with backup** garantisce la consistenza tra il database di pubblicazione e il database di distribuzione, ma non offre alcuna garanzia contro la perdita dei dati.</span><span class="sxs-lookup"><span data-stu-id="0556e-136">The **sync with backup** option ensures consistency between the publication database and the distribution database, but the option does not guarantee against data loss.</span></span> <span data-ttu-id="0556e-137">Se ad esempio il log delle transazioni viene perso, le transazioni di cui è stato eseguito il commit dopo l'ultimo backup del log non saranno disponibili nel database di pubblicazione o nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-137">For example, if the transaction log is lost, transactions that have been committed since the last transaction log backup will not be available in the publication database or the distribution database.</span></span> <span data-ttu-id="0556e-138">Questo comportamento è identico a quello di un database non replicato.</span><span class="sxs-lookup"><span data-stu-id="0556e-138">This is the same behavior as a nonreplicated database.</span></span>  
  
 <span data-ttu-id="0556e-139">**Per impostare l'opzione sync with backup**</span><span class="sxs-lookup"><span data-stu-id="0556e-139">**To set the sync with backup option**</span></span>  
  
-   <span data-ttu-id="0556e-140">Programmazione [!INCLUDE[tsql](../../../includes/tsql-md.md)] della replica: [Abilitare backup coordinati per la replica transazionale &#40;programmazione Transact-SQL della replica&#41;](enable-coordinated-backups-for-transactional-replication.md)</span><span class="sxs-lookup"><span data-stu-id="0556e-140">Replication [!INCLUDE[tsql](../../../includes/tsql-md.md)] programming: [Enable Coordinated Backups for Transactional Replication &#40;Replication Transact-SQL Programming&#41;](enable-coordinated-backups-for-transactional-replication.md)</span></span>  
  
## <a name="restoring-databases-involved-in-replication"></a><span data-ttu-id="0556e-141">Ripristino di database interessati da una replica</span><span class="sxs-lookup"><span data-stu-id="0556e-141">Restoring Databases Involved in Replication</span></span>  
 <span data-ttu-id="0556e-142">È possibile ripristinare tutti i database in una topologia di replica se sono disponibili backup recenti e viene eseguita la procedura appropriata.</span><span class="sxs-lookup"><span data-stu-id="0556e-142">You can restore all databases in a replication topology if recent backups are available and the appropriate steps are followed.</span></span> <span data-ttu-id="0556e-143">La procedura di ripristino per il database di pubblicazione dipende dal tipo di replica e dalle opzioni utilizzate, mentre quella per tutti gli altri database è indipendente da tali fattori.</span><span class="sxs-lookup"><span data-stu-id="0556e-143">The restore steps for the publication database depend on the type of replication and options that are used; however, the restore steps for all other databases are independent of the type and options.</span></span>  
  
 <span data-ttu-id="0556e-144">La replica supporta il ripristino dei database replicati nello stesso server e nello stesso database da cui è stato creato il backup.</span><span class="sxs-lookup"><span data-stu-id="0556e-144">Replication supports restoring replicated databases to the same server and database from which the backup was created.</span></span> <span data-ttu-id="0556e-145">Se si ripristina un backup di un database replicato in un altro server o database, le impostazioni di replica non potranno essere mantenute.</span><span class="sxs-lookup"><span data-stu-id="0556e-145">If you restore a backup of a replicated database to another server or database, replication settings cannot be preserved.</span></span> <span data-ttu-id="0556e-146">In questo caso, è necessario ricreare tutte le pubblicazioni e le sottoscrizioni dopo il ripristino dei backup.</span><span class="sxs-lookup"><span data-stu-id="0556e-146">In this case, you must re-create all publications and subscriptions after backups are restored.</span></span>  
  
### <a name="publisher"></a><span data-ttu-id="0556e-147">Editore</span><span class="sxs-lookup"><span data-stu-id="0556e-147">Publisher</span></span>  
 <span data-ttu-id="0556e-148">Sono disponibili procedure di ripristino per i tipi di replica seguenti:</span><span class="sxs-lookup"><span data-stu-id="0556e-148">There are restore steps provided for the following types of replication:</span></span>  
  
-   <span data-ttu-id="0556e-149">Replica snapshot</span><span class="sxs-lookup"><span data-stu-id="0556e-149">Snapshot replication</span></span>  
  
-   <span data-ttu-id="0556e-150">Replica transazionale di sola lettura</span><span class="sxs-lookup"><span data-stu-id="0556e-150">Read-only transactional replication</span></span>  
  
-   <span data-ttu-id="0556e-151">Replica transazionale con sottoscrizioni aggiornabili</span><span class="sxs-lookup"><span data-stu-id="0556e-151">Transactional replication with updating subscriptions</span></span>  
  
-   <span data-ttu-id="0556e-152">Replica transazionale peer-to-peer</span><span class="sxs-lookup"><span data-stu-id="0556e-152">Peer-to-peer transactional replication</span></span>  
  
 <span data-ttu-id="0556e-153">Il ripristino dei database **msdb** e **master** , descritti in questa sezione, è identico per tutti i quattro tipi.</span><span class="sxs-lookup"><span data-stu-id="0556e-153">The restore of the **msdb** and **master** databases, which are also covered in this section, is the same for all four types.</span></span>  
  
#### <a name="publication-database-snapshot-replication"></a><span data-ttu-id="0556e-154">Database di pubblicazione: Replica snapshot</span><span class="sxs-lookup"><span data-stu-id="0556e-154">Publication Database: Snapshot Replication</span></span>  
  
1.  <span data-ttu-id="0556e-155">Ripristinare il backup più recente del database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-155">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="0556e-156">Andare al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="0556e-156">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="0556e-157">Il backup del database di pubblicazione contiene la configurazione più recente per tutte le pubblicazioni e le sottoscrizioni?</span><span class="sxs-lookup"><span data-stu-id="0556e-157">Does the publication database backup contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="0556e-158">In caso affermativo, il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-158">If yes, the restore is completed.</span></span> <span data-ttu-id="0556e-159">In caso contrario, andare al passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="0556e-159">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="0556e-160">Rimuovere la configurazione della replica dal server di pubblicazione, dal database di distribuzione e dai Sottoscrittori, quindi ricreare la configurazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-160">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="0556e-161">Il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-161">Restore is completed.</span></span>  
  
     <span data-ttu-id="0556e-162">Per altre informazioni su come rimuovere la replica, vedere [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="0556e-162">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
#### <a name="publication-database-read-only-transactional-replication"></a><span data-ttu-id="0556e-163">Database di pubblicazione: Replica transazionale di sola lettura</span><span class="sxs-lookup"><span data-stu-id="0556e-163">Publication Database: Read-Only Transactional Replication</span></span>  
  
1.  <span data-ttu-id="0556e-164">Ripristinare il backup più recente del database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-164">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="0556e-165">Andare al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="0556e-165">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="0556e-166">L'opzione **sync with backup** era abilitata nel database di pubblicazione prima dell'errore?</span><span class="sxs-lookup"><span data-stu-id="0556e-166">Was the **sync with backup** setting enabled on the publication database before the failure?</span></span> <span data-ttu-id="0556e-167">In caso affermativo, andare al passaggio 3. In caso contrario, andare al passaggio 5.</span><span class="sxs-lookup"><span data-stu-id="0556e-167">If yes, go to step 3; if no, go to step 5.</span></span>  
  
     <span data-ttu-id="0556e-168">Se l'opzione è abilitata, la query `SELECT DATABASEPROPERTYEX('<PublicationDatabaseName>', 'IsSyncWithBackup')` restituisce "1".</span><span class="sxs-lookup"><span data-stu-id="0556e-168">If the setting is enabled, the query `SELECT DATABASEPROPERTYEX('<PublicationDatabaseName>', 'IsSyncWithBackup')` returns '1'.</span></span>  
  
3.  <span data-ttu-id="0556e-169">Il backup ripristinato è completo e aggiornato?</span><span class="sxs-lookup"><span data-stu-id="0556e-169">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="0556e-170">Contiene la configurazione più recente per tutte le pubblicazioni e le sottoscrizioni?</span><span class="sxs-lookup"><span data-stu-id="0556e-170">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="0556e-171">In caso affermativo, il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-171">If yes, the restore is completed.</span></span> <span data-ttu-id="0556e-172">In caso contrario, andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="0556e-172">If no, go to step 4.</span></span>  
  
4.  <span data-ttu-id="0556e-173">Le informazioni di configurazione nel database di pubblicazione ripristinato non sono aggiornate.</span><span class="sxs-lookup"><span data-stu-id="0556e-173">The configuration information in the restored publication database is not up-to-date.</span></span> <span data-ttu-id="0556e-174">È pertanto necessario assicurarsi che i Sottoscrittori dispongano di tutti i comandi in sospeso nel database di distribuzione, quindi eliminare e ricreare la configurazione della replica.</span><span class="sxs-lookup"><span data-stu-id="0556e-174">Therefore, you must make sure that the Subscribers have all outstanding commands in the distribution database, and then drop and re-create the replication configuration.</span></span>  
  
    1.  <span data-ttu-id="0556e-175">Eseguire l'agente di distribuzione fino a completare la sincronizzazione in tutti i Sottoscrittori dei comandi in sospeso nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-175">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="0556e-176">Verificare che tutti i comandi vengano recapitati ai Sottoscrittori utilizzando la scheda **Comandi non distribuiti** in Monitoraggio replica oppure eseguendo una query sulla vista [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-176">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="0556e-177">Andare al passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-177">Go to step b.</span></span>  
  
         <span data-ttu-id="0556e-178">Per altre informazioni su come eseguire l'agente di distribuzione, vedere [Avviare e arrestare un agente di replica &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) e [Concetti di base relativi ai file eseguibili dell'agente di replica](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-178">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
         <span data-ttu-id="0556e-179">Per ulteriori informazioni su come verificare i comandi, vedere [visualizzare comandi replicati e altre informazioni nel database di distribuzione &#40;programmazione Transact-SQL della replica&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) e [visualizzare le informazioni ed eseguire attività tramite Monitoraggio replica](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-179">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
    2.  <span data-ttu-id="0556e-180">Rimuovere la configurazione della replica dal server di pubblicazione, dal database di distribuzione e dai Sottoscrittori, quindi ricreare la configurazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-180">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="0556e-181">Quando si ricreano le sottoscrizioni, specificare che i dati sono già disponibili nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="0556e-181">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="0556e-182">Il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-182">The restore is completed.</span></span>  
  
         <span data-ttu-id="0556e-183">Per altre informazioni su come rimuovere la replica, vedere [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="0556e-183">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="0556e-184">Per ulteriori informazioni su come specificare che i dati sono già disponibili nel Sottoscrittore, vedere [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-184">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
5.  <span data-ttu-id="0556e-185">L'opzione **sync with backup** non è stata impostata nel database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-185">The **sync with backup** option was not set on the publication database.</span></span> <span data-ttu-id="0556e-186">Le transazioni che non sono state incluse nel backup ripristinato potrebbero pertanto essere state recapitate al database di distribuzione e ai Sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="0556e-186">Therefore, transactions that were not included in the restored backup might have been delivered to the Distributor and Subscribers.</span></span> <span data-ttu-id="0556e-187">È a questo punto necessario assicurarsi che i Sottoscrittori dispongano di tutti i comandi in sospeso nel database di distribuzione, quindi applicare manualmente al database di pubblicazione eventuali transazioni non incluse nel backup ripristinato.</span><span class="sxs-lookup"><span data-stu-id="0556e-187">You must now make sure that Subscribers have all outstanding commands in the distribution database, and then manually apply to the publication database any transactions that are not included in the restored backup.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="0556e-188">Questo processo può comportare il ripristino delle tabelle pubblicate in base a una temporizzazione più recente rispetto a quella di altre tabelle non pubblicate ripristinate dal backup.</span><span class="sxs-lookup"><span data-stu-id="0556e-188">Performing this process can cause published tables to be restored to a point in time that is more recent than the point in time of other nonpublished tables that are restored from the backup.</span></span>  
  
    1.  <span data-ttu-id="0556e-189">Eseguire l'agente di distribuzione fino a completare la sincronizzazione in tutti i Sottoscrittori dei comandi in sospeso nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-189">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="0556e-190">Verificare che tutti i comandi vengano recapitati ai Sottoscrittori utilizzando la scheda **Comandi non distribuiti** in Monitoraggio replica oppure eseguendo una query sulla vista [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-190">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="0556e-191">Andare al passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-191">Go to step b.</span></span>  
  
         <span data-ttu-id="0556e-192">Per altre informazioni su come eseguire l'agente di distribuzione, vedere [Avviare e arrestare un agente di replica &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) e [Concetti di base relativi ai file eseguibili dell'agente di replica](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-192">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
         <span data-ttu-id="0556e-193">Per ulteriori informazioni su come verificare i comandi, vedere [visualizzare comandi replicati e altre informazioni nel database di distribuzione &#40;programmazione Transact-SQL della replica&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) e [visualizzare le informazioni ed eseguire attività tramite Monitoraggio replica](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-193">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
    2.  <span data-ttu-id="0556e-194">Utilizzare l' [utilità tablediff](../../../tools/tablediff-utility.md) o un altro strumento per sincronizzare manualmente il server di pubblicazione con il Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="0556e-194">Use the [tablediff utility](../../../tools/tablediff-utility.md) or another tool to manually synchronize the Publisher with the Subscriber.</span></span> <span data-ttu-id="0556e-195">Questa operazione consente di recuperare i dati del database di sottoscrizione non inclusi nel backup del database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-195">This enables you to recover data from the subscription database that was not contained in the publication database backup.</span></span> <span data-ttu-id="0556e-196">Andare al passaggio c.</span><span class="sxs-lookup"><span data-stu-id="0556e-196">Go to step c.</span></span>  
  
         <span data-ttu-id="0556e-197">Per altre informazioni sull'utilità **tablediff**, vedere [Confrontare tabelle replicate al fine di individuare le differenze &#40;programmazione della replica&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-197">For more information about the **tablediff** utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    3.  <span data-ttu-id="0556e-198">Il backup ripristinato è completo e aggiornato?</span><span class="sxs-lookup"><span data-stu-id="0556e-198">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="0556e-199">Contiene la configurazione più recente per tutte le pubblicazioni e le sottoscrizioni?</span><span class="sxs-lookup"><span data-stu-id="0556e-199">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="0556e-200">In caso affermativo, eseguire la stored procedure [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) per risincronizzare i metadati del server di pubblicazione con i metadati del database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-200">If yes, execute the [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) stored procedure to resynchronize the Publisher metadata with the Distributor metadata.</span></span> <span data-ttu-id="0556e-201">Il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-201">The restore is completed.</span></span> <span data-ttu-id="0556e-202">In caso contrario, andare al passaggio d.</span><span class="sxs-lookup"><span data-stu-id="0556e-202">If no, go to step d.</span></span>  
  
    4.  <span data-ttu-id="0556e-203">Rimuovere la configurazione della replica dal server di pubblicazione, dal database di distribuzione e dai Sottoscrittori, quindi ricreare la configurazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-203">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="0556e-204">Quando si ricreano le sottoscrizioni, specificare che i dati sono già disponibili nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="0556e-204">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="0556e-205">Il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-205">The restore is completed.</span></span>  
  
         <span data-ttu-id="0556e-206">Per altre informazioni su come rimuovere la replica, vedere [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="0556e-206">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="0556e-207">Per ulteriori informazioni su come specificare che i dati sono già disponibili nel Sottoscrittore, vedere [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-207">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="publication-database-transactional-replication-with-updating-subscriptions"></a><span data-ttu-id="0556e-208">Database di pubblicazione: Replica transazionale con sottoscrizioni aggiornabili</span><span class="sxs-lookup"><span data-stu-id="0556e-208">Publication Database: Transactional Replication with Updating Subscriptions</span></span>  
  
1.  <span data-ttu-id="0556e-209">Ripristinare il backup più recente del database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-209">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="0556e-210">Andare al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="0556e-210">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="0556e-211">Eseguire l'agente di distribuzione fino a completare la sincronizzazione in tutti i Sottoscrittori dei comandi in sospeso nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-211">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="0556e-212">Verificare che tutti i comandi vengano recapitati ai Sottoscrittori utilizzando la scheda **Comandi non distribuiti** in Monitoraggio replica oppure eseguendo una query sulla vista [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-212">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor, or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="0556e-213">Andare al passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="0556e-213">Go to step 3.</span></span>  
  
     <span data-ttu-id="0556e-214">Per altre informazioni su come eseguire l'agente di distribuzione, vedere [Avviare e arrestare un agente di replica &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) e [Concetti di base relativi ai file eseguibili dell'agente di replica](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-214">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
     <span data-ttu-id="0556e-215">Per ulteriori informazioni su come verificare i comandi, vedere [visualizzare comandi replicati e altre informazioni nel database di distribuzione &#40;programmazione Transact-SQL della replica&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) e [visualizzare le informazioni ed eseguire attività tramite Monitoraggio replica](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-215">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
3.  <span data-ttu-id="0556e-216">Se si usano sottoscrizioni ad aggiornamento in coda, connettersi a ogni Sottoscrittore ed eliminare tutte le righe dalla tabella [MSreplication_queue &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/msreplication-queue-transact-sql) nel database di sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="0556e-216">If you are using queued updating subscriptions, connect to each Subscriber and delete all rows from the [MSreplication_queue &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/msreplication-queue-transact-sql) table in the subscription database.</span></span> <span data-ttu-id="0556e-217">Andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="0556e-217">Go to step 4.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="0556e-218">Se si utilizzano sottoscrizioni ad aggiornamento in coda e le tabelle contengono colonne Identity, è necessario assicurarsi che dopo un ripristino vengano assegnati gli intervalli di valori Identity corretti.</span><span class="sxs-lookup"><span data-stu-id="0556e-218">If you are using queued updating subscriptions and any tables contain identity columns, you must make sure that the correct identity ranges are assigned after a restore.</span></span> <span data-ttu-id="0556e-219">Per altre informazioni, vedere [Replicare colonne Identity](../publish/replicate-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-219">For more information, see [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
4.  <span data-ttu-id="0556e-220">È a questo punto necessario assicurarsi che i Sottoscrittori dispongano di tutti i comandi in sospeso nel database di distribuzione, quindi applicare manualmente al database di pubblicazione eventuali transazioni non incluse nel backup ripristinato.</span><span class="sxs-lookup"><span data-stu-id="0556e-220">You must now make sure that Subscribers have all outstanding commands in the distribution database, and then manually apply to the publication database any transactions that are not included in the restored backup.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="0556e-221">Questo processo può comportare il ripristino delle tabelle pubblicate in base a una temporizzazione più recente rispetto a quella di altre tabelle non pubblicate ripristinate dal backup.</span><span class="sxs-lookup"><span data-stu-id="0556e-221">Performing this process can cause published tables to be restored to a point in time that is more recent than the point in time of other nonpublished tables that are restored from the backup.</span></span>  
  
    1.  <span data-ttu-id="0556e-222">Eseguire l'agente di distribuzione fino a completare la sincronizzazione in tutti i Sottoscrittori dei comandi in sospeso nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-222">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="0556e-223">Verificare che tutti i comandi vengano recapitati ai Sottoscrittori utilizzando Monitoraggio replica oppure eseguendo una query sulla vista [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-223">Verify that all commands are delivered to Subscribers by using Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="0556e-224">Andare al passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-224">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="0556e-225">Utilizzare l' [tablediff Utility](../../../tools/tablediff-utility.md) o un altro strumento per sincronizzare manualmente il server di pubblicazione con il Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="0556e-225">Use the [tablediff Utility](../../../tools/tablediff-utility.md) or another tool to manually synchronize the Publisher with the Subscriber.</span></span> <span data-ttu-id="0556e-226">Questa operazione consente di recuperare i dati del database di sottoscrizione non inclusi nel backup del database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-226">This enables you to recover data from the subscription database that was not contained in the publication database backup.</span></span> <span data-ttu-id="0556e-227">Andare al passaggio c.</span><span class="sxs-lookup"><span data-stu-id="0556e-227">Go to step c.</span></span>  
  
         <span data-ttu-id="0556e-228">Per altre informazioni sull'utilità **tablediff**, vedere [Confrontare tabelle replicate al fine di individuare le differenze &#40;programmazione della replica&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-228">For more information about the **tablediff** utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    3.  <span data-ttu-id="0556e-229">Il backup ripristinato è completo e aggiornato?</span><span class="sxs-lookup"><span data-stu-id="0556e-229">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="0556e-230">Contiene la configurazione più recente per tutte le pubblicazioni e le sottoscrizioni?</span><span class="sxs-lookup"><span data-stu-id="0556e-230">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="0556e-231">In caso affermativo, eseguire la stored procedure [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) per risincronizzare i metadati del server di pubblicazione con i metadati del database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-231">If yes, execute the [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) stored procedure to resynchronize the Publisher metadata with the Distributor metadata.</span></span> <span data-ttu-id="0556e-232">Il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-232">The restore is completed.</span></span> <span data-ttu-id="0556e-233">In caso contrario, andare al passaggio d.</span><span class="sxs-lookup"><span data-stu-id="0556e-233">If no, go to step d.</span></span>  
  
    4.  <span data-ttu-id="0556e-234">Rimuovere la configurazione della replica dal server di pubblicazione, dal database di distribuzione e dai Sottoscrittori, quindi ricreare la configurazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-234">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="0556e-235">Quando si ricreano le sottoscrizioni, specificare che i dati sono già disponibili nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="0556e-235">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="0556e-236">Il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-236">The restore is completed.</span></span>  
  
         <span data-ttu-id="0556e-237">Per altre informazioni su come rimuovere la replica, vedere [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="0556e-237">For more information about how to remove replication, see and [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="0556e-238">Per ulteriori informazioni su come specificare che i dati sono già disponibili nel Sottoscrittore, vedere [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-238">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="publication-database-peer-to-peer-transactional-replication"></a><span data-ttu-id="0556e-239">Database di pubblicazione: Replica transazionale peer-to-peer</span><span class="sxs-lookup"><span data-stu-id="0556e-239">Publication Database: Peer-to-Peer Transactional Replication</span></span>  
 <span data-ttu-id="0556e-240">Nella procedura seguente i database di pubblicazione **A**, **B**e **C** sono inclusi in una topologia di replica transazionale peer-to-peer.</span><span class="sxs-lookup"><span data-stu-id="0556e-240">In the following steps, publication databases **A**, **B**, and **C** are in a peer-to-peer transactional replication topology.</span></span> <span data-ttu-id="0556e-241">I database **A** e **C** sono online e funzionano correttamente. Il database **B** è il database da ripristinare.</span><span class="sxs-lookup"><span data-stu-id="0556e-241">Databases **A** and **C** are online and functioning properly; database **B** is the database to be restored.</span></span> <span data-ttu-id="0556e-242">Il processo descritto, specialmente i passaggi 7, 10 e 11, è molto simile al processo per l'aggiunta di un nodo a una topologia peer-to-peer.</span><span class="sxs-lookup"><span data-stu-id="0556e-242">The process described here, especially steps 7, 10, and 11, is very similar to the process required to add a node to a peer-to-peer topology.</span></span> <span data-ttu-id="0556e-243">Il modo più semplice per eseguire questi passaggi consiste nell'utilizzare la Configurazione guidata topologia peer-to-peer, ma è possibile utilizzare anche stored procedure.</span><span class="sxs-lookup"><span data-stu-id="0556e-243">The most straightforward way to perform these steps is to use the Configure Peer-to-Peer Topology Wizard, but you can also use stored procedures.</span></span>  
  
1.  <span data-ttu-id="0556e-244">Eseguire gli agenti di distribuzione per sincronizzare le sottoscrizioni nei database **A** e **C**. Andare al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="0556e-244">Run the Distribution Agents to synchronize the subscriptions at databases **A** and **C**. Go to step 2.</span></span>  
  
     <span data-ttu-id="0556e-245">Per altre informazioni su come eseguire l'agente di distribuzione, vedere [Avviare e arrestare un agente di replica &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) e [Concetti di base relativi ai file eseguibili dell'agente di replica](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-245">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
2.  <span data-ttu-id="0556e-246">Se il database di distribuzione usato da **B** è ancora disponibile, eseguire gli agenti di distribuzione per sincronizzare le sottoscrizioni tra i database **B** e **A** e tra i database B e **C**. Andare al passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="0556e-246">If the distribution database that **B** uses is still available, run Distribution Agents to synchronize subscriptions between databases **B** and **A** and databases and B and **C**. Go to step 3.</span></span>  
  
3.  <span data-ttu-id="0556e-247">Rimuovere i metadati dal database di distribuzione usato da **B** eseguendo [sp_removedistpublisherdbreplication](/sql/relational-databases/system-stored-procedures/sp-removedistpublisherdbreplication-transact-sql) nel database di distribuzione per **B**. Andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="0556e-247">Remove metadata from the distribution database that **B** uses by executing [sp_removedistpublisherdbreplication](/sql/relational-databases/system-stored-procedures/sp-removedistpublisherdbreplication-transact-sql) at the distribution database for **B**. Go to step 4.</span></span>  
  
4.  <span data-ttu-id="0556e-248">Nei database **A** e **C** eliminare le sottoscrizioni della pubblicazione nel database **B**. Andare al passaggio 5.</span><span class="sxs-lookup"><span data-stu-id="0556e-248">At databases **A** and **C**, drop the subscriptions to the publication at database **B**. Go to step 5.</span></span>  
  
     <span data-ttu-id="0556e-249">Per ulteriori informazioni sull'eliminazione delle sottoscrizioni, vedere [Subscribe to Publications](../subscribe-to-publications.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-249">For more information about how to drop subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
5.  <span data-ttu-id="0556e-250">Eseguire un backup del log oppure un backup completo del database **A**. Andare al passaggio 6.</span><span class="sxs-lookup"><span data-stu-id="0556e-250">Perform a log backup or full backup of database **A**. Go to step 6.</span></span>  
  
6.  <span data-ttu-id="0556e-251">Ripristinare il backup del database **A** nel database **B**. Il database **B** contiene ora i dati del database **A**, ma non la configurazione della replica.</span><span class="sxs-lookup"><span data-stu-id="0556e-251">Restore the backup of database **A** at database **B**. Database **B** now has the data from database **A**, but not the replication configuration.</span></span> <span data-ttu-id="0556e-252">Quando si ripristina un backup in un altro server, la replica viene rimossa. La replica è stata quindi rimossa dal database **B**. Andare al passaggio 7.</span><span class="sxs-lookup"><span data-stu-id="0556e-252">When you restore a backup to another server, replication is removed; therefore, replication has been removed from database **B**. Go to step 7.</span></span>  
  
7.  <span data-ttu-id="0556e-253">Ricreare la pubblicazione nel database **B** e quindi ricreare le sottoscrizioni tra i database **A** e **B**. Le sottoscrizioni che interessano il database **C** vengono gestite in una fase successiva.</span><span class="sxs-lookup"><span data-stu-id="0556e-253">Re-create the publication at database **B**, and then re-create subscriptions between databases **A** and **B**. (Subscriptions that involve database **C** are handled at a later stage.).</span></span>  
  
    1.  <span data-ttu-id="0556e-254">Ricreare la pubblicazione nel database **B**. Andare al passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-254">Re-create the publication at database **B**. Go to step b.</span></span>  
  
    2.  <span data-ttu-id="0556e-255">Ricreare la sottoscrizione nel database **B** della pubblicazione nel database **a**, specificando che la sottoscrizione deve essere inizializzata con un backup (il valore **Initialize with backup** per il **@sync_type** parametro di [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="0556e-255">Re-create the subscription at database **B** to the publication at database **A**, specifying that the subscription should be initialized with a backup (a value of **initialize with backup** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="0556e-256">Andare al passaggio c.</span><span class="sxs-lookup"><span data-stu-id="0556e-256">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="0556e-257">Ricreare la sottoscrizione **nel database a** della pubblicazione nel database **B**, specificando che nel Sottoscrittore sono già presenti i dati (il valore **Replication support only** per il **@sync_type** parametro di [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="0556e-257">Re-create the subscription at database **A** to the publication at database **B**, specifying that the Subscriber already has the data (a value of **replication support only** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="0556e-258">Andare al passaggio 8.</span><span class="sxs-lookup"><span data-stu-id="0556e-258">Go to step 8.</span></span>  
  
8.  <span data-ttu-id="0556e-259">Eseguire gli agenti di distribuzione per sincronizzare le sottoscrizioni nei database **A** e **B**. In presenza di eventuali colonne Identity nelle tabelle pubblicate, andare al passaggio 9.</span><span class="sxs-lookup"><span data-stu-id="0556e-259">Run the Distribution Agents to synchronize the subscriptions at databases **A** and **B**. If there are any identity columns in published tables, go to step 9.</span></span> <span data-ttu-id="0556e-260">In caso contrario, andare al passaggio 10.</span><span class="sxs-lookup"><span data-stu-id="0556e-260">If not, go to step 10.</span></span>  
  
9. <span data-ttu-id="0556e-261">In seguito al ripristino, l'intervallo di valori Identity assegnato a ogni tabella nel database **A** verrà usato anche nel database **B**. Assicurarsi che il database **B** ripristinato abbia ricevuto tutte le modifiche del database **B** bloccato propagate nel database **A** e nel database **C** e quindi reinizializzare l'intervallo di valori Identity per ogni tabella.</span><span class="sxs-lookup"><span data-stu-id="0556e-261">After the restore, the identity range that you assigned for each table in database **A** would also be used in database **B**. Make sure that the restored database **B** has received all changes from the failed database **B** that were propagated to database **A** and database **C**; and then reseed the identity range for each table.</span></span>  
  
    1.  <span data-ttu-id="0556e-262">Eseguire [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) nel database **B** e recuperare il parametro di output **@request_id** .</span><span class="sxs-lookup"><span data-stu-id="0556e-262">Execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) at database **B** and retrieve the output parameter **@request_id**.</span></span> <span data-ttu-id="0556e-263">Andare al passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-263">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="0556e-264">Per impostazione predefinita, l'agente di distribuzione è impostato per l'esecuzione continua. I token dovrebbero pertanto essere inviati automaticamente a tutti i nodi.</span><span class="sxs-lookup"><span data-stu-id="0556e-264">By default, the Distribution Agent is set to run continuously; therefore, tokens should be sent to all nodes automatically.</span></span> <span data-ttu-id="0556e-265">Se l'agente di distribuzione non viene eseguito in modalità continua, eseguire l'agente.</span><span class="sxs-lookup"><span data-stu-id="0556e-265">If the Distribution Agent is not running in continuous mode, run the agent.</span></span> <span data-ttu-id="0556e-266">Per altre informazioni, vedere [Concetti di base relativi ai file eseguibili dell’agente di replica](../concepts/replication-agent-executables-concepts.md) o [Avviare e arrestare un agente di replica &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-266">For more information, see [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md) or [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span></span> <span data-ttu-id="0556e-267">Andare al passaggio c.</span><span class="sxs-lookup"><span data-stu-id="0556e-267">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="0556e-268">Eseguire [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), specificando il **@request_id** valore recuperato nel passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-268">Execute [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), providing the **@request_id** value retrieved in step b.</span></span> <span data-ttu-id="0556e-269">Attendere finché tutti i nodi indicano di avere ricevuto la richiesta peer.</span><span class="sxs-lookup"><span data-stu-id="0556e-269">Wait until all nodes indicate they have received the peer request.</span></span> <span data-ttu-id="0556e-270">Andare al passaggio d.</span><span class="sxs-lookup"><span data-stu-id="0556e-270">Go to step d.</span></span>  
  
    4.  <span data-ttu-id="0556e-271">Utilizzare [DBCC CHECKIDENT](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) per reinizializzare ciascuna tabella nel database **B** , in modo da garantire l'utilizzo di un intervallo appropriato.</span><span class="sxs-lookup"><span data-stu-id="0556e-271">Use [DBCC CHECKIDENT](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) to reseed each table in database **B** to make sure that an appropriate range is used.</span></span> <span data-ttu-id="0556e-272">Andare al passaggio 10.</span><span class="sxs-lookup"><span data-stu-id="0556e-272">Go to step 10.</span></span>  
  
     <span data-ttu-id="0556e-273">Per altre informazioni sulla gestione di intervalli di valori Identity, vedere la sezione "Assegnazione di intervalli per la gestione manuale degli intervalli di valori Identity" in [Replicare colonne Identity](../publish/replicate-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-273">For more information about how to manage identity ranges, see the "Assigning ranges for manual identity range management" section of [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
10. <span data-ttu-id="0556e-274">A questo punto, il database **B** e il database **C** non sono direttamente connessi, ma riceveranno le modifiche tramite il database **A**. Se la topologia contiene nodi in cui è eseguito [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], andare al passaggio 11. Altrimenti, andare al passaggio 12.</span><span class="sxs-lookup"><span data-stu-id="0556e-274">At this point, database **B** and database **C** are not directly connected, but they will receive changes through database **A**. If the topology contains any nodes that are running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], go to step 11; otherwise, go to step 12.</span></span>  
  
11. <span data-ttu-id="0556e-275">Mettere in stato di inattività il sistema e ricreare la sottoscrizione tra i database **B** e **C**. Mettere in stato di inattività un sistema significa arrestare le attività sulle tabelle pubblicate in tutti i nodi e verificare che ogni nodo abbia ricevuto tutte le modifiche dagli altri nodi:</span><span class="sxs-lookup"><span data-stu-id="0556e-275">Quiesce the system, and then re-create the subscription between databases **B** and **C**. Quiescing a system involves stopping activity on published tables at all nodes and making sure of that each node has received all changes from all other nodes.</span></span>  
  
    1.  <span data-ttu-id="0556e-276">Arrestare qualsiasi attività sulle tabelle pubblicate nella topologia peer-to-peer.</span><span class="sxs-lookup"><span data-stu-id="0556e-276">Stop all activity on published tables in the peer-to-peer topology.</span></span> <span data-ttu-id="0556e-277">Andare al passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-277">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="0556e-278">Eseguire [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) nel database **B** e recuperare il parametro di output **@request_id** .</span><span class="sxs-lookup"><span data-stu-id="0556e-278">Execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) at database **B** and retrieve the output parameter **@request_id**.</span></span> <span data-ttu-id="0556e-279">Andare al passaggio c.</span><span class="sxs-lookup"><span data-stu-id="0556e-279">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="0556e-280">Per impostazione predefinita, l'agente di distribuzione è impostato per l'esecuzione continua. I token dovrebbero pertanto essere inviati automaticamente a tutti i nodi.</span><span class="sxs-lookup"><span data-stu-id="0556e-280">By default, the Distribution Agent is set to run continuously; therefore, tokens should be sent to all nodes automatically.</span></span> <span data-ttu-id="0556e-281">Se l'agente di distribuzione non viene eseguito in modalità continua, eseguire l'agente.</span><span class="sxs-lookup"><span data-stu-id="0556e-281">If the Distribution Agent is not running in continuous mode, run the agent.</span></span> <span data-ttu-id="0556e-282">Andare al passaggio d.</span><span class="sxs-lookup"><span data-stu-id="0556e-282">Go to step d.</span></span>  
  
    4.  <span data-ttu-id="0556e-283">Eseguire [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), specificando il **@request_id** valore recuperato nel passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-283">Execute [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), providing the **@request_id** value retrieved in step b.</span></span> <span data-ttu-id="0556e-284">Attendere finché tutti i nodi indicano di avere ricevuto la richiesta peer.</span><span class="sxs-lookup"><span data-stu-id="0556e-284">Wait until all nodes indicate they have received the peer request.</span></span> <span data-ttu-id="0556e-285">Andare al passaggio e.</span><span class="sxs-lookup"><span data-stu-id="0556e-285">Go to step e.</span></span>  
  
    5.  <span data-ttu-id="0556e-286">Ricreare la sottoscrizione nel database **B** della pubblicazione nel database **C**, specificando che nel Sottoscrittore i dati sono già disponibili.</span><span class="sxs-lookup"><span data-stu-id="0556e-286">Re-create the subscription at database **B** to the publication at database **C**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="0556e-287">Andare al passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-287">Go to step b.</span></span>  
  
    6.  <span data-ttu-id="0556e-288">Ricreare la sottoscrizione nel database **C** della pubblicazione nel database **B**, specificando che nel Sottoscrittore i dati sono già disponibili.</span><span class="sxs-lookup"><span data-stu-id="0556e-288">Re-create the subscription at database **C** to the publication at database **B**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="0556e-289">Andare al passaggio 13.</span><span class="sxs-lookup"><span data-stu-id="0556e-289">Go to step 13.</span></span>  
  
12. <span data-ttu-id="0556e-290">Ricreare la sottoscrizione tra i database **B** e **C**:</span><span class="sxs-lookup"><span data-stu-id="0556e-290">Re-create the subscription between databases **B** and **C**:</span></span>  
  
    1.  <span data-ttu-id="0556e-291">Nel database **B**eseguire una query sulla tabella [MSpeer_lsns](/sql/relational-databases/system-tables/mspeer-lsns-transact-sql) per recuperare il numero di sequenza del file di log (LSN) della transazione più recente che il database **B** ha ricevuto dal database **C**.</span><span class="sxs-lookup"><span data-stu-id="0556e-291">At database **B**, query the [MSpeer_lsns](/sql/relational-databases/system-tables/mspeer-lsns-transact-sql) table to retrieve the log sequence number (LSN) of the most recent transaction that database **B** has received from database **C**.</span></span>  
  
    2.  <span data-ttu-id="0556e-292">Ricreare la sottoscrizione nel database **B** della pubblicazione nel database **C**, specificando che la sottoscrizione deve essere inizializzata in base al numero LSN (valore **Initialize from lsn** per il **@sync_type** parametro di [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="0556e-292">Re-create the subscription at database **B** to the publication at database **C**, specifying that the subscription should be initialized based on LSN (a value of **initialize from lsn** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="0556e-293">Andare al passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-293">Go to step b.</span></span>  
  
    3.  <span data-ttu-id="0556e-294">Ricreare la sottoscrizione nel database **C** della pubblicazione nel database **B**, specificando che nel Sottoscrittore i dati sono già disponibili.</span><span class="sxs-lookup"><span data-stu-id="0556e-294">Re-create the subscription at database **C** to the publication at database **B**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="0556e-295">Andare al passaggio 13.</span><span class="sxs-lookup"><span data-stu-id="0556e-295">Go to step 13.</span></span>  
  
13. <span data-ttu-id="0556e-296">Eseguire gli agenti di distribuzione per sincronizzare le sottoscrizioni nei database **B** e **C**. Il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-296">Run the Distribution Agents to synchronize the subscriptions at databases **B** and **C**. The restore is completed.</span></span>  
  
#### <a name="msdb-database-publisher"></a><span data-ttu-id="0556e-297">Database msdb (server di pubblicazione)</span><span class="sxs-lookup"><span data-stu-id="0556e-297">msdb Database (Publisher)</span></span>  
  
1.  <span data-ttu-id="0556e-298">Ripristinare il backup più recente del database **msdb** .</span><span class="sxs-lookup"><span data-stu-id="0556e-298">Restore the latest backup of the **msdb** database.</span></span>  
  
2.  <span data-ttu-id="0556e-299">Il backup ripristinato è completo e aggiornato?</span><span class="sxs-lookup"><span data-stu-id="0556e-299">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="0556e-300">Contiene la configurazione più recente per tutte le pubblicazioni e le sottoscrizioni?</span><span class="sxs-lookup"><span data-stu-id="0556e-300">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="0556e-301">In caso affermativo, il recupero viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-301">If yes, recovery is completed.</span></span> <span data-ttu-id="0556e-302">In caso contrario, andare al passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="0556e-302">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="0556e-303">Ricreare il processo di pulizia dei riferimenti alle sottoscrizioni dagli script di replica.</span><span class="sxs-lookup"><span data-stu-id="0556e-303">Re-create the subscription cleanup job from your replication scripts.</span></span> <span data-ttu-id="0556e-304">Il recupero viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-304">Recovery is completed.</span></span>  
  
#### <a name="master-database-publisher"></a><span data-ttu-id="0556e-305">Database master (server di pubblicazione)</span><span class="sxs-lookup"><span data-stu-id="0556e-305">master Database (Publisher)</span></span>  
  
1.  <span data-ttu-id="0556e-306">Ripristinare il backup più recente del database **master** .</span><span class="sxs-lookup"><span data-stu-id="0556e-306">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="0556e-307">Assicurarsi che il database sia consistente con il database di pubblicazione in termini di impostazioni e configurazione della replica.</span><span class="sxs-lookup"><span data-stu-id="0556e-307">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
### <a name="databases-at-the-distributor"></a><span data-ttu-id="0556e-308">Database nel database di distribuzione</span><span class="sxs-lookup"><span data-stu-id="0556e-308">Databases at the Distributor</span></span>  
  
#### <a name="distribution-database"></a><span data-ttu-id="0556e-309">Database di distribuzione</span><span class="sxs-lookup"><span data-stu-id="0556e-309">Distribution Database</span></span>  
  
1.  <span data-ttu-id="0556e-310">Ripristinare il backup più recente del database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-310">Restore the latest backup of the distribution database.</span></span>  
  
2.  <span data-ttu-id="0556e-311">L'opzione **sync with backup** era abilitata nel database di distribuzione prima dell'errore?</span><span class="sxs-lookup"><span data-stu-id="0556e-311">Was the **sync with backup** setting enabled on the distribution database before the failure?</span></span> <span data-ttu-id="0556e-312">In caso affermativo, andare al passaggio 3. In caso contrario, andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="0556e-312">If yes, go to step 3; if no, go to step 4.</span></span>  
  
     <span data-ttu-id="0556e-313">Se l'opzione è abilitata, la query `SELECT DATABASEPROPERTYEX('<DistributionDatabaseName>', 'IsSyncWithBackup')` restituisce "1".</span><span class="sxs-lookup"><span data-stu-id="0556e-313">If the setting is enabled, the query `SELECT DATABASEPROPERTYEX('<DistributionDatabaseName>', 'IsSyncWithBackup')` returns '1'.</span></span>  
  
3.  <span data-ttu-id="0556e-314">Il backup ripristinato è completo e aggiornato?</span><span class="sxs-lookup"><span data-stu-id="0556e-314">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="0556e-315">Contiene la configurazione più recente per tutte le pubblicazioni e le sottoscrizioni?</span><span class="sxs-lookup"><span data-stu-id="0556e-315">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="0556e-316">In caso affermativo, il recupero viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-316">If yes, recovery is completed.</span></span> <span data-ttu-id="0556e-317">In caso contrario, andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="0556e-317">If no, go to step 4.</span></span>  
  
4.  <span data-ttu-id="0556e-318">Le informazioni di configurazione nel database di distribuzione ripristinato non sono aggiornate o l'opzione **sync with backup** non è stata impostata nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-318">Either the configuration information in the restored distribution database is not up-to-date, or the **sync with backup** option was not set on the distribution database.</span></span> <span data-ttu-id="0556e-319">Dopo il ripristino, è possibile che nel database di distribuzione manchino le transazioni di cui è stato eseguito il commit nel server di pubblicazione, ma che non sono state ancora recapitate ai Sottoscrittori. Eliminare e ricreare la replica, quindi eseguire la convalida.</span><span class="sxs-lookup"><span data-stu-id="0556e-319">(After the restore, the distribution database might be missing transactions that were committed at the Publisher but have not yet been delivered to Subscribers.) Drop and re-create replication, and then run validation.</span></span>  
  
    1.  <span data-ttu-id="0556e-320">Rimuovere la configurazione della replica dal server di pubblicazione, dal database di distribuzione e dai Sottoscrittori, quindi ricreare la configurazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-320">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="0556e-321">Quando si ricreano le sottoscrizioni, specificare che i dati sono già disponibili nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="0556e-321">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="0556e-322">Andare al passaggio b.</span><span class="sxs-lookup"><span data-stu-id="0556e-322">Go to step b.</span></span>  
  
         <span data-ttu-id="0556e-323">Per altre informazioni su come rimuovere la replica, vedere [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="0556e-323">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="0556e-324">Per ulteriori informazioni su come specificare che i dati sono già disponibili nel Sottoscrittore, vedere [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-324">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
    2.  <span data-ttu-id="0556e-325">Contrassegnare tutte le pubblicazioni per la convalida.</span><span class="sxs-lookup"><span data-stu-id="0556e-325">Mark all publications for validation.</span></span> <span data-ttu-id="0556e-326">Reinizializzare eventuali sottoscrizioni che non superano la convalida.</span><span class="sxs-lookup"><span data-stu-id="0556e-326">Reinitialize any subscriptions that fail validation.</span></span> <span data-ttu-id="0556e-327">Il recupero viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-327">Recovery is completed.</span></span>  
  
         <span data-ttu-id="0556e-328">Per ulteriori informazioni sulla convalida, vedere [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-328">For more information about validation, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="0556e-329">Per altre informazioni sulla reinizializzazione, vedere [Reinizializzare le sottoscrizioni](../reinitialize-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-329">For more information about reinitialization, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
#### <a name="msdb-database-distributor"></a><span data-ttu-id="0556e-330">Database msdb (database di distribuzione)</span><span class="sxs-lookup"><span data-stu-id="0556e-330">msdb Database (Distributor)</span></span>  
  
1.  <span data-ttu-id="0556e-331">Ripristinare il backup più recente del database **msdb** .</span><span class="sxs-lookup"><span data-stu-id="0556e-331">Restore the latest backup of the **msdb** database.</span></span>  
  
2.  <span data-ttu-id="0556e-332">Il backup ripristinato è completo e aggiornato?</span><span class="sxs-lookup"><span data-stu-id="0556e-332">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="0556e-333">Contiene la configurazione più recente per tutte le pubblicazioni e le sottoscrizioni?</span><span class="sxs-lookup"><span data-stu-id="0556e-333">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="0556e-334">In caso affermativo, il recupero viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-334">If yes, recovery is completed.</span></span> <span data-ttu-id="0556e-335">In caso contrario, andare al passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="0556e-335">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="0556e-336">Rimuovere la configurazione della replica dal server di pubblicazione, dal database di distribuzione e dai Sottoscrittori, quindi ricreare la configurazione.</span><span class="sxs-lookup"><span data-stu-id="0556e-336">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="0556e-337">Quando si ricreano le sottoscrizioni, specificare che i dati sono già disponibili nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="0556e-337">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="0556e-338">Andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="0556e-338">Go to step 4.</span></span>  
  
     <span data-ttu-id="0556e-339">Per altre informazioni su come rimuovere la replica, vedere [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="0556e-339">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
     <span data-ttu-id="0556e-340">Per ulteriori informazioni su come specificare che i dati sono già disponibili nel Sottoscrittore, vedere [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-340">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
4.  <span data-ttu-id="0556e-341">Contrassegnare tutte le pubblicazioni per la convalida.</span><span class="sxs-lookup"><span data-stu-id="0556e-341">Mark all publications for validation.</span></span> <span data-ttu-id="0556e-342">Reinizializzare eventuali sottoscrizioni che non superano la convalida.</span><span class="sxs-lookup"><span data-stu-id="0556e-342">Reinitialize any subscriptions that fail validation.</span></span> <span data-ttu-id="0556e-343">Il recupero viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-343">Recovery is completed.</span></span>  
  
     <span data-ttu-id="0556e-344">Per ulteriori informazioni sulla convalida, vedere [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-344">For more information about validation, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="0556e-345">Per altre informazioni sulla reinizializzazione, vedere [Reinizializzare le sottoscrizioni](../reinitialize-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-345">For more information about reinitialization, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
#### <a name="master-database-distributor"></a><span data-ttu-id="0556e-346">Database master (database di distribuzione)</span><span class="sxs-lookup"><span data-stu-id="0556e-346">master Database (Distributor)</span></span>  
  
1.  <span data-ttu-id="0556e-347">Ripristinare il backup più recente del database **master** .</span><span class="sxs-lookup"><span data-stu-id="0556e-347">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="0556e-348">Assicurarsi che il database sia consistente con il database di pubblicazione in termini di impostazioni e configurazione della replica.</span><span class="sxs-lookup"><span data-stu-id="0556e-348">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
### <a name="databases-at-the-subscriber"></a><span data-ttu-id="0556e-349">Database nel Sottoscrittore</span><span class="sxs-lookup"><span data-stu-id="0556e-349">Databases at the Subscriber</span></span>  
  
#### <a name="subscription-database"></a><span data-ttu-id="0556e-350">Database di sottoscrizione</span><span class="sxs-lookup"><span data-stu-id="0556e-350">Subscription Database</span></span>  
  
1.  <span data-ttu-id="0556e-351">L'ultimo backup del database di sottoscrizione è più recente dell'impostazione minima relativa alla memorizzazione per la distribuzione nel database di distribuzione?</span><span class="sxs-lookup"><span data-stu-id="0556e-351">Is the latest subscription database backup more recent than the minimum distribution retention setting on the distribution database?</span></span> <span data-ttu-id="0556e-352">Questo aspetto determina se il database di distribuzione disponga ancora di tutti i comandi necessari per aggiornare il Sottoscrittore. In caso affermativo, andare al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="0556e-352">(This determines whether the Distributor still has all the commands that are required to bring the Subscriber up-to-date.) If yes, go to step 2.</span></span> <span data-ttu-id="0556e-353">In caso contrario, reinizializzare la sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="0556e-353">If no, reinitialize the subscription.</span></span> <span data-ttu-id="0556e-354">Il recupero viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-354">Recovery is completed.</span></span>  
  
     <span data-ttu-id="0556e-355">Per determinare l'impostazione massima relativa alla memorizzazione per la distribuzione, eseguire [sp_helpdistributiondb](/sql/relational-databases/system-stored-procedures/sp-helpdistributiondb-transact-sql) e recuperare il valore dalla colonna **max_distretention** . Questo valore è espresso in ore.</span><span class="sxs-lookup"><span data-stu-id="0556e-355">To determine the maximum distribution retention setting, execute [sp_helpdistributiondb](/sql/relational-databases/system-stored-procedures/sp-helpdistributiondb-transact-sql) and retrieve the value from the **max_distretention** column (this value is in hours).</span></span>  
  
     <span data-ttu-id="0556e-356">Per ulteriori informazioni sulla reinizializzazione di una sottoscrizione, vedere [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-356">For more information about how to reinitialize a subscription, see [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span></span>  
  
2.  <span data-ttu-id="0556e-357">Ripristinare il backup del database di sottoscrizione più recente.</span><span class="sxs-lookup"><span data-stu-id="0556e-357">Restore the latest subscription database backup.</span></span> <span data-ttu-id="0556e-358">Andare al passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="0556e-358">Go to step 3.</span></span>  
  
3.  <span data-ttu-id="0556e-359">Se il database di sottoscrizione contiene solo sottoscrizioni push, andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="0556e-359">If the subscription database contains only push subscriptions, go to step 4.</span></span> <span data-ttu-id="0556e-360">Se il database di sottoscrizione contiene sottoscrizioni pull, determinare quanto segue: le informazioni sulla sottoscrizione sono aggiornate?</span><span class="sxs-lookup"><span data-stu-id="0556e-360">If the subscription database contains any pull subscriptions, ask the following questions: Is the subscription information current?</span></span> <span data-ttu-id="0556e-361">Nel database sono incluse tutte le tabelle e le opzioni impostate al momento dell'errore?</span><span class="sxs-lookup"><span data-stu-id="0556e-361">Does the database include all tables and options that were set at the time of failure.</span></span> <span data-ttu-id="0556e-362">In caso affermativo, andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="0556e-362">If yes, go to step 4.</span></span> <span data-ttu-id="0556e-363">In caso contrario, reinizializzare la sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="0556e-363">If no, reinitialize the subscription.</span></span> <span data-ttu-id="0556e-364">Il recupero viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-364">Recovery is completed.</span></span>  
  
4.  <span data-ttu-id="0556e-365">Per sincronizzare il Sottoscrittore, eseguire l'agente di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0556e-365">To synchronize the Subscriber, run the Distribution Agent.</span></span> <span data-ttu-id="0556e-366">Il recupero viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-366">Recovery is completed.</span></span>  
  
     <span data-ttu-id="0556e-367">Per altre informazioni su come eseguire l'agente di distribuzione, vedere [Avviare e arrestare un agente di replica &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) e [Concetti di base relativi ai file eseguibili dell'agente di replica](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-367">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
#### <a name="msdb-database-subscriber"></a><span data-ttu-id="0556e-368">Database msdb (Sottoscrittore)</span><span class="sxs-lookup"><span data-stu-id="0556e-368">msdb Database (Subscriber)</span></span>  
  
1.  <span data-ttu-id="0556e-369">Ripristinare il backup più recente del database **msdb** .</span><span class="sxs-lookup"><span data-stu-id="0556e-369">Restore the latest backup of the **msdb** database.</span></span> <span data-ttu-id="0556e-370">Nel Sottoscrittore vengono utilizzate sottoscrizioni pull?</span><span class="sxs-lookup"><span data-stu-id="0556e-370">Are pull subscriptions used at this Subscriber?</span></span> <span data-ttu-id="0556e-371">In caso di risposta negativa, il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-371">If no, the restore is completed.</span></span> <span data-ttu-id="0556e-372">In caso affermativo, andare al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="0556e-372">If yes, go to step 2.</span></span>  
  
2.  <span data-ttu-id="0556e-373">Il backup ripristinato è completo e aggiornato?</span><span class="sxs-lookup"><span data-stu-id="0556e-373">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="0556e-374">Contiene la configurazione più recente per tutte le sottoscrizioni pull?</span><span class="sxs-lookup"><span data-stu-id="0556e-374">Does it contain the latest configuration for all pull subscriptions?</span></span> <span data-ttu-id="0556e-375">In caso affermativo, il recupero viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-375">If yes, recovery is completed.</span></span> <span data-ttu-id="0556e-376">In caso contrario, andare al passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="0556e-376">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="0556e-377">Eliminare e ricreare le sottoscrizioni pull.</span><span class="sxs-lookup"><span data-stu-id="0556e-377">Drop and re-create the pull subscriptions.</span></span> <span data-ttu-id="0556e-378">Quando si ricreano le sottoscrizioni, specificare che i dati sono già disponibili nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="0556e-378">When you re-create the subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="0556e-379">Il ripristino viene completato.</span><span class="sxs-lookup"><span data-stu-id="0556e-379">The restore is completed.</span></span>  
  
     <span data-ttu-id="0556e-380">Per ulteriori informazioni sull'eliminazione delle sottoscrizioni, vedere [Subscribe to Publications](../subscribe-to-publications.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-380">For more information about how to drop subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
     <span data-ttu-id="0556e-381">Per ulteriori informazioni su come specificare che i dati sono già disponibili nel Sottoscrittore, vedere [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="0556e-381">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="master-database-subscriber"></a><span data-ttu-id="0556e-382">Database master (Sottoscrittore)</span><span class="sxs-lookup"><span data-stu-id="0556e-382">master Database (Subscriber)</span></span>  
  
1.  <span data-ttu-id="0556e-383">Ripristinare il backup più recente del database **master** .</span><span class="sxs-lookup"><span data-stu-id="0556e-383">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="0556e-384">Assicurarsi che il database sia consistente con il database di pubblicazione in termini di impostazioni e configurazione della replica.</span><span class="sxs-lookup"><span data-stu-id="0556e-384">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0556e-385">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="0556e-385">See Also</span></span>  
 <span data-ttu-id="0556e-386">[Backup e ripristino di database SQL Server](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="0556e-386">[Back Up and Restore of SQL Server Databases](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span></span>  
 <span data-ttu-id="0556e-387">[Backup e ripristino di database replicati](back-up-and-restore-replicated-databases.md) </span><span class="sxs-lookup"><span data-stu-id="0556e-387">[Back Up and Restore Replicated Databases](back-up-and-restore-replicated-databases.md) </span></span>  
 <span data-ttu-id="0556e-388">[Configura distribuzione](../configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="0556e-388">[Configure Distribution](../configure-distribution.md) </span></span>  
 <span data-ttu-id="0556e-389">[Pubblicare dati e oggetti di database](../publish/publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="0556e-389">[Publish Data and Database Objects](../publish/publish-data-and-database-objects.md) </span></span>  
 <span data-ttu-id="0556e-390">[Subscribe to Publications](../subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="0556e-390">[Subscribe to Publications](../subscribe-to-publications.md) </span></span>  
 <span data-ttu-id="0556e-391">[Inizializzare una sottoscrizione](../initialize-a-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="0556e-391">[Initialize a Subscription](../initialize-a-subscription.md) </span></span>  
 [<span data-ttu-id="0556e-392">Sincronizzare i dati</span><span class="sxs-lookup"><span data-stu-id="0556e-392">Synchronize Data</span></span>](../synchronize-data.md)  
  
  
