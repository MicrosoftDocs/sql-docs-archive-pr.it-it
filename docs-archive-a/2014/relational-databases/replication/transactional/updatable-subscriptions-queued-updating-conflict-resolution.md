---
title: Rilevamento e risoluzione dei conflitti per l'aggiornamento in coda | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- conflict resolution [SQL Server replication], queued updating subscriptions
- viewing queued updating conflicts
- conflict resolution [SQL Server replication]
- queued updating subscriptions [SQL Server replication]
- articles [SQL Server replication], conflict resolution
ms.assetid: 084ac587-25e7-4bd0-a385-556bbe07d02f
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8c4608347ab119e25caa45b0ee4a592a953e34a4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87637745"
---
# <a name="queued-updating-conflict-detection-and-resolution"></a><span data-ttu-id="08212-102">Queued Updating Conflict Detection and Resolution</span><span class="sxs-lookup"><span data-stu-id="08212-102">Queued Updating Conflict Detection and Resolution</span></span>
  <span data-ttu-id="08212-103">Dato che le sottoscrizioni ad aggiornamento in coda consentono la modifica degli stessi dati in più posizioni, è possibile che durante la sincronizzazione dei dati nel server di pubblicazione si verifichino conflitti.</span><span class="sxs-lookup"><span data-stu-id="08212-103">Because queued updating subscriptions allow modifications to the same data at multiple locations, there may be conflicts when data is synchronized at the Publisher.</span></span> <span data-ttu-id="08212-104">I conflitti vengono rilevati quando le modifiche vengono sincronizzate con il server di pubblicazione e vengono risolti in base ai criteri di risoluzione selezionati durante la creazione della pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="08212-104">Replication detects any conflicts when changes are synchronized with the Publisher and resolves those conflicts using the resolution policy you selected when creating the publication.</span></span> <span data-ttu-id="08212-105">È possibile che si verifichino i conflitti seguenti:</span><span class="sxs-lookup"><span data-stu-id="08212-105">The following conflicts can occur:</span></span>  
  
-   <span data-ttu-id="08212-106">Conflitti di aggiornamento e inserimento.</span><span class="sxs-lookup"><span data-stu-id="08212-106">Update and insert conflicts.</span></span> <span data-ttu-id="08212-107">Questo tipo di conflitti si verifica quando gli stessi dati vengono modificati in due posizioni diverse.</span><span class="sxs-lookup"><span data-stu-id="08212-107">This conflict happens when the same data is changed at two locations.</span></span> <span data-ttu-id="08212-108">In questo caso, vengono confermate solo le modifiche apportate in una posizione.</span><span class="sxs-lookup"><span data-stu-id="08212-108">One change wins, and the other one loses.</span></span>  
  
-   <span data-ttu-id="08212-109">Conflitti di eliminazione.</span><span class="sxs-lookup"><span data-stu-id="08212-109">Delete conflicts.</span></span> <span data-ttu-id="08212-110">Si verificano se la stessa riga viene eliminata in una posizione e modificata in un'altra.</span><span class="sxs-lookup"><span data-stu-id="08212-110">This conflict occurs when the same row is deleted at one location and changed at the other.</span></span>  
  
 <span data-ttu-id="08212-111">Il rilevamento e la risoluzione dei conflitti può richiedere tempi lunghi e un numero elevato di risorse. È pertanto consigliabile ridurre al minimo i conflitti nelle applicazioni tramite la creazione di partizioni di dati in modo da consentire la modifica di subset di dati diversi in Sottoscrittori diversi.</span><span class="sxs-lookup"><span data-stu-id="08212-111">Conflict detection and resolution can be a time-consuming and resource-intensive process; therefore, it is best to minimize conflicts in the application by creating data partitions so that different Subscribers modify different subsets of data.</span></span>  
  
## <a name="detecting-conflicts"></a><span data-ttu-id="08212-112">Rilevamento dei conflitti</span><span class="sxs-lookup"><span data-stu-id="08212-112">Detecting Conflicts</span></span>  
 <span data-ttu-id="08212-113">Quando si crea una pubblicazione e si abilita l'aggiornamento in coda, viene aggiunta alla tabella sottostante una colonna di tipo **uniqueidentifier** (**msrepl_tran_version**) con il valore predefinito **newid()** .</span><span class="sxs-lookup"><span data-stu-id="08212-113">When creating a publication and enabling queued updating, replication adds a **uniqueidentifier** column (**msrepl_tran_version**) with the default of **newid()** to the underlying table.</span></span> <span data-ttu-id="08212-114">Quando si modificano i dati pubblicati nel server di pubblicazione o nel Sottoscrittore, le righe ricevono un nuovo identificatore univoco globale (GUID) a indicare che esiste una nuova versione della riga.</span><span class="sxs-lookup"><span data-stu-id="08212-114">When published data is changed at either the Publisher or the Subscriber, the row receives a new globally unique identifier (GUID) to indicate that a new row version exists.</span></span> <span data-ttu-id="08212-115">L'agente di lettura coda utilizza questa colonna durante la sincronizzazione per determinare se esiste un conflitto.</span><span class="sxs-lookup"><span data-stu-id="08212-115">The Queue Reader Agent uses this column during synchronization to determine if a conflict exists.</span></span>  
  
 <span data-ttu-id="08212-116">Le transazioni inserite in una coda mantengono i valori di versione nuovi e vecchi delle righe.</span><span class="sxs-lookup"><span data-stu-id="08212-116">A transaction in a queue maintains the old and new row version values.</span></span> <span data-ttu-id="08212-117">Quando la transazione viene applicata al server di pubblicazione, vengono confrontati i GUID della transazione e il GUID della pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="08212-117">When the transaction is applied at the Publisher, the GUIDs from the transaction and the GUID in the publication are compared.</span></span> <span data-ttu-id="08212-118">Se il vecchio GUID archiviato nella transazione corrisponde al GUID della pubblicazione, la pubblicazione viene aggiornata e il nuovo GUID viene assegnato alla riga generata dal Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="08212-118">If the old GUID stored in the transaction matches the GUID in the publication, the publication is updated and the row is assigned the new GUID that was generated by the Subscriber.</span></span> <span data-ttu-id="08212-119">In seguito all'aggiornamento della pubblicazione con il GUID della transazione, le versioni delle righe nella pubblicazione corrispondono alle versioni della transazione.</span><span class="sxs-lookup"><span data-stu-id="08212-119">By updating the publication with the GUID from the transaction, you have matching row versions in the publication and in the transaction.</span></span>  
  
 <span data-ttu-id="08212-120">Se il vecchio GUID archiviato nella transazione non corrisponde al GUID della pubblicazione, viene rilevato un conflitto.</span><span class="sxs-lookup"><span data-stu-id="08212-120">If the old GUID stored in the transaction does not match the GUID in the publication, a conflict is detected.</span></span> <span data-ttu-id="08212-121">Il nuovo GUID della pubblicazione indica che esistono due diverse versioni della riga: una versione nella transazione inviata dal Sottoscrittore e una versione più recente nel server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="08212-121">The new GUID in the publication indicates that two different row versions exist: one in the transaction being submitted by the Subscriber and a newer one that exists on the Publisher.</span></span> <span data-ttu-id="08212-122">Ciò significa che un altro Sottoscrittore o il server di pubblicazione hanno aggiornato la stessa riga della pubblicazione prima della sincronizzazione della transazione da parte del server di sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="08212-122">In this case, another Subscriber or the Publisher updated the same row in the publication before this Subscriber transaction was synchronized.</span></span>  
  
 <span data-ttu-id="08212-123">A differenza della replica di tipo merge, le colonne GUID non vengono utilizzate per identificare la riga stessa, ma per verificare se è stata modificata.</span><span class="sxs-lookup"><span data-stu-id="08212-123">Unlike merge replication, the use of a GUID column is not used to identify the row itself, but is used to check if the row has changed.</span></span>  
  
## <a name="resolving-conflicts"></a><span data-ttu-id="08212-124">Risoluzione dei conflitti</span><span class="sxs-lookup"><span data-stu-id="08212-124">Resolving Conflicts</span></span>  
 <span data-ttu-id="08212-125">Quando si crea una pubblicazione configurata per l'aggiornamento in coda, si seleziona un sistema di risoluzione dei conflitti da utilizzare qualora venissero rilevati dei conflitti.</span><span class="sxs-lookup"><span data-stu-id="08212-125">When you create a publication using queued updating, you select a conflict resolver to be used if any conflicts are detected.</span></span> <span data-ttu-id="08212-126">L'agente di lettura coda gestisce le versioni diverse della stessa riga rilevate durante la sincronizzazione in base al sistema di risoluzione dei conflitti.</span><span class="sxs-lookup"><span data-stu-id="08212-126">The conflict resolver governs how the Queue Reader Agent handles different versions of the same row encountered during synchronization.</span></span> <span data-ttu-id="08212-127">Dopo la creazione della pubblicazione è tuttavia possibile modificare i criteri di risoluzione dei conflitti a condizione che non esistano sottoscrizioni della pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="08212-127">You can change the conflict resolution policy after the publication is created as long as there are no subscriptions to the publication.</span></span> <span data-ttu-id="08212-128">Le opzioni del sistema di risoluzione dei conflitti sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="08212-128">The conflict resolver choices are the following:</span></span>  
  
-   <span data-ttu-id="08212-129">Prevale il server di pubblicazione (impostazione predefinita)</span><span class="sxs-lookup"><span data-stu-id="08212-129">Publisher wins (the default)</span></span>  
  
-   <span data-ttu-id="08212-130">Prevale il server di pubblicazione e la sottoscrizione viene reinizializzata</span><span class="sxs-lookup"><span data-stu-id="08212-130">Publisher wins and the subscription is reinitialized</span></span>  
  
-   <span data-ttu-id="08212-131">Prevale il Sottoscrittore</span><span class="sxs-lookup"><span data-stu-id="08212-131">Subscriber wins</span></span>  
  
 <span data-ttu-id="08212-132">I conflitti vengono registrati e possono essere visualizzati tramite il Visualizzatore conflitti.</span><span class="sxs-lookup"><span data-stu-id="08212-132">Conflicts are recorded and can be viewed using the Conflict Viewer.</span></span>  
  
 <span data-ttu-id="08212-133">**Per impostare i criteri di risoluzione dei conflitti per l'aggiornamento in coda**</span><span class="sxs-lookup"><span data-stu-id="08212-133">**To set the queued updating conflict resolution policy**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="08212-134">: [Impostare le opzioni di risoluzione dei conflitti per l'aggiornamento in coda &#40;SQL Server Management Studio&#41;](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span><span class="sxs-lookup"><span data-stu-id="08212-134">: [Set Queued Updating Conflict Resolution Options &#40;SQL Server Management Studio&#41;](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span></span>  
  
-   <span data-ttu-id="08212-135">Programmazione Transact-SQL della replica: [Abilitazione delle sottoscrizioni aggiornabili per le pubblicazioni transazionali](../publish/enable-updating-subscriptions-for-transactional-publications.md)</span><span class="sxs-lookup"><span data-stu-id="08212-135">Replication Transact-SQL programming: [Enable Updating Subscriptions for Transactional Publications](../publish/enable-updating-subscriptions-for-transactional-publications.md)</span></span>  
  
 <span data-ttu-id="08212-136">**Per visualizzare i conflitti di dati**</span><span class="sxs-lookup"><span data-stu-id="08212-136">**To view data conflicts**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="08212-137">: [Visualizzare i conflitti di dati per le pubblicazioni transazionali &#40;SQL Server Management Studio&#41;](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)</span><span class="sxs-lookup"><span data-stu-id="08212-137">: [View Data Conflicts for Transactional Publications &#40;SQL Server Management Studio&#41;](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)</span></span>  
  
### <a name="publisher-wins"></a><span data-ttu-id="08212-138">Prevale il server di pubblicazione</span><span class="sxs-lookup"><span data-stu-id="08212-138">Publisher Wins</span></span>  
 <span data-ttu-id="08212-139">Quando il criterio di risoluzione dei conflitti è impostato su Prevale il server di pubblicazione, la consistenza transazionale viene mantenuta in base ai dati del server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="08212-139">When the conflict resolution is set to the Publisher wins, transactional consistency is maintained based on the data at the Publisher.</span></span> <span data-ttu-id="08212-140">Viene eseguito il rollback della transazione in conflitto nel Sottoscrittore in cui è stata inizializzata.</span><span class="sxs-lookup"><span data-stu-id="08212-140">The conflicting transaction is rolled back at the Subscriber that initiated it.</span></span>  
  
 <span data-ttu-id="08212-141">Quando l'agente di lettura coda rileva un conflitto, vengono generati i comandi di compensazione, i quali vengono distribuiti al Sottoscrittore inserendoli nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="08212-141">The Queue Reader Agent detects a conflict and compensating commands are generated and propagated to the Subscriber by posting them in the distribution database.</span></span> <span data-ttu-id="08212-142">L'agente di distribuzione applica quindi i comandi di compensazione al Sottoscrittore che ha originato la transazione in conflitto.</span><span class="sxs-lookup"><span data-stu-id="08212-142">The Distribution Agent then applies the compensating commands to the Subscriber that originated the conflicting transaction.</span></span> <span data-ttu-id="08212-143">Le azioni di compensazione aggiornano le righe nel Sottoscrittore in modo che corrispondano alla riga nel server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="08212-143">The compensating actions update the rows on the Subscriber to match the rows on the Publisher.</span></span>  
  
 <span data-ttu-id="08212-144">Fino a quando non vengono applicati i comandi di compensazione, è possibile leggere i risultati di una transazione di cui verrà eseguito il rollback nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="08212-144">Until the compensating commands are applied, it is possible to read the results of a transaction that will eventually be rolled back at the Subscriber.</span></span> <span data-ttu-id="08212-145">Ciò equivale a una lettura dirty, ovvero al livello di isolamento Read Uncommitted.</span><span class="sxs-lookup"><span data-stu-id="08212-145">This is equivalent to a dirty read (read uncommitted isolation level).</span></span> <span data-ttu-id="08212-146">Per le successive transazioni dipendenti che possono verificarsi, non è prevista alcuna compensazione.</span><span class="sxs-lookup"><span data-stu-id="08212-146">There is no compensation for the subsequent dependent transactions that can occur.</span></span> <span data-ttu-id="08212-147">Vengono comunque rispettati i limiti delle transazioni e viene eseguito il commit, oppure in caso di conflitto, il rollback di tutte le azioni all'interno di una transazione.</span><span class="sxs-lookup"><span data-stu-id="08212-147">However, transaction boundaries are honored and all the actions within a transaction are either committed, or in the case of a conflict, rolled back.</span></span>  
  
### <a name="publisher-wins-and-the-subscription-is-reinitialized"></a><span data-ttu-id="08212-148">Prevale il server di pubblicazione e la sottoscrizione viene reinizializzata</span><span class="sxs-lookup"><span data-stu-id="08212-148">Publisher Wins and the Subscription Is Reinitialized</span></span>  
 <span data-ttu-id="08212-149">La reinizializzazione del Sottoscrittore per la risoluzione dei conflitti consente di mantenere un grado elevato di consistenza transazionale nel Sottoscrittore, ma può richiedere molto tempo se la pubblicazione contiene una quantità di dati elevata.</span><span class="sxs-lookup"><span data-stu-id="08212-149">Reinitializing the Subscriber to resolve conflicts maintains strict transactional consistency at the Subscriber, but it can be time consuming if the publication contains large amounts of data.</span></span>  
  
 <span data-ttu-id="08212-150">Quando l'agente di lettura coda rileva un conflitto, le altre transazioni della coda, compresa la transazione in conflitto, vengono rifiutate e il Sottoscrittore viene contrassegnato per la reinizializzazione.</span><span class="sxs-lookup"><span data-stu-id="08212-150">When the Queue Reader Agent detects a conflict, all remaining transactions in the queue (including the transaction in conflict) are rejected, and the Subscriber is marked for reinitialization.</span></span> <span data-ttu-id="08212-151">Il successivo snapshot generato per la pubblicazione viene applicato dall'agente di distribuzione al Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="08212-151">The next snapshot generated for the publication is applied by the Distribution Agent to the Subscriber.</span></span>  
  
### <a name="subscriber-wins"></a><span data-ttu-id="08212-152">Prevale il Sottoscrittore</span><span class="sxs-lookup"><span data-stu-id="08212-152">Subscriber Wins</span></span>  
 <span data-ttu-id="08212-153">Il rilevamento dei conflitti in base ai criteri Prevale il Sottoscrittore implica che l'ultima transazione del Sottoscrittore che aggiorna il server di pubblicazione risulta prioritaria.</span><span class="sxs-lookup"><span data-stu-id="08212-153">Conflict detection under the Subscriber wins policy means the last Subscriber transaction to update the Publisher wins.</span></span> <span data-ttu-id="08212-154">In questo caso, quando viene rilevato un conflitto, viene comunque utilizzata la transazione inviata dal Sottoscrittore e il server di pubblicazione viene aggiornato.</span><span class="sxs-lookup"><span data-stu-id="08212-154">In this case, when a conflict is detected, the transaction sent by the Subscriber is still used and the Publisher is updated.</span></span> <span data-ttu-id="08212-155">Questi criteri sono adatti alle applicazioni in cui tali modifiche non compromettono l'integrità dei dati.</span><span class="sxs-lookup"><span data-stu-id="08212-155">This policy is suitable for applications where such changes do not compromise data integrity.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="08212-156">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="08212-156">See Also</span></span>  
 [<span data-ttu-id="08212-157">Updatable Subscriptions for Transactional Replication</span><span class="sxs-lookup"><span data-stu-id="08212-157">Updatable Subscriptions for Transactional Replication</span></span>](updatable-subscriptions-for-transactional-replication.md)  
  
  
