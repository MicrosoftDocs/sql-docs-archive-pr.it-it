---
title: Replicare colonne Identity | Microsoft Docs
ms.custom: ''
ms.date: 10/04/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- identities [SQL Server replication]
- identity values [SQL Server replication]
- merge replication [SQL Server replication], identity range management
- publishing [SQL Server replication], identity columns
- transactional replication, identity range management
- identity columns [SQL Server], replication
ms.assetid: eb2f23a8-7ec2-48af-9361-0e3cb87ebaf7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: c899d902e403e9f7cdbdfd1a83cde110e627ab11
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87625305"
---
# <a name="replicate-identity-columns"></a><span data-ttu-id="a37c1-102">Replica di colonne Identity</span><span class="sxs-lookup"><span data-stu-id="a37c1-102">Replicate Identity Columns</span></span>
  <span data-ttu-id="a37c1-103">Quando si assegna la proprietà IDENTITY a una colonna, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] genera automaticamente numeri sequenziali per le nuove righe inserite nella tabella contenente la colonna Identity.</span><span class="sxs-lookup"><span data-stu-id="a37c1-103">When you assign an IDENTITY property to a column, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] automatically generates sequential numbers for new rows inserted in the table containing the identity column.</span></span> <span data-ttu-id="a37c1-104">Per altre informazioni, vedere [IDENTITY &#40;proprietà&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property).</span><span class="sxs-lookup"><span data-stu-id="a37c1-104">For more information, see [IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property).</span></span> <span data-ttu-id="a37c1-105">Dato che è possibile includere le colonne Identity come parte della chiave primaria, è importante evitare di inserire valori duplicati nelle colonne Identity.</span><span class="sxs-lookup"><span data-stu-id="a37c1-105">Because identity columns might be included as a part of the primary key, it is important to avoid duplicate values in the identity columns.</span></span> <span data-ttu-id="a37c1-106">Per utilizzare colonne Identity in una topologia di replica con aggiornamenti in più di un nodo, è necessario che ogni nodo presente nella topologia di replica utilizzi un intervallo di valori Identity diverso, in modo da non generare duplicati.</span><span class="sxs-lookup"><span data-stu-id="a37c1-106">To use identity columns in a replication topology that has updates at more than one node, each node in the replication topology must use a different range of identity values, so that duplicates do not occur.</span></span>  
  
 <span data-ttu-id="a37c1-107">Ad esempio, al server di pubblicazione potrebbe essere assegnato l'intervallo 1-100, al Sottoscrittore A l'intervallo 101-200 e al Sottoscrittore B l'intervallo 201-300.</span><span class="sxs-lookup"><span data-stu-id="a37c1-107">For example, the Publisher could be assigned the range 1-100, Subscriber A the range 101-200, and Subscriber B the range 201-300.</span></span> <span data-ttu-id="a37c1-108">Se una riga viene inserita nel server di pubblicazione e il valore Identity è, ad esempio, 65, tale valore viene replicato in ogni Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="a37c1-108">If a row is inserted at the Publisher and the identity value is, for example, 65, that value is replicated to each Subscriber.</span></span> <span data-ttu-id="a37c1-109">Durante l'inserimento dei dati nei Sottoscrittori, il valore della colonna Identity nella tabella dei Sottoscrittori non viene incrementato, bensì viene inserito il valore letterale di 65.</span><span class="sxs-lookup"><span data-stu-id="a37c1-109">When replication inserts data at each Subscriber, it does not increment the identity column value in the Subscriber table; instead, the literal value 65 is inserted.</span></span> <span data-ttu-id="a37c1-110">Il valore della colonna Identity viene incrementato solo in seguito a inserimenti da parte dell'utente e non a inserimenti generati dall'agente di replica.</span><span class="sxs-lookup"><span data-stu-id="a37c1-110">Only user inserts, but not replication agent inserts cause the identity column value to be incremented.</span></span>  
  
 <span data-ttu-id="a37c1-111">La replica consente di gestire le colonne Identity di tutti i tipi di pubblicazione e sottoscrizione. È pertanto possibile scegliere di gestire manualmente le colonne oppure di gestirle automaticamente tramite la replica.</span><span class="sxs-lookup"><span data-stu-id="a37c1-111">Replication handles identity columns across all publication and subscription types, allowing you to manage the columns manually or have replication manage them automatically.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a37c1-112">Non è consentito aggiungere una colonna Identity a una tabella pubblicata, perché ciò può impedire la convergenza dei dati durante la replica della colonna nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="a37c1-112">Adding an identity column to a published table is not supported, because it can result in non-convergence when the column is replicated to the Subscriber.</span></span> <span data-ttu-id="a37c1-113">I valori della colonna Identity nel server di pubblicazione dipendono dall'ordine in cui vengono fisicamente archiviate le righe della tabella interessata.</span><span class="sxs-lookup"><span data-stu-id="a37c1-113">The values in the identity column at the Publisher depend on the order in which the rows for the affected table are physically stored.</span></span> <span data-ttu-id="a37c1-114">Nel caso in cui le righe siano state archiviate in modo diverso nel Sottoscrittore, il valore della colonna Identity può essere diverso per le stesse righe.</span><span class="sxs-lookup"><span data-stu-id="a37c1-114">The rows might be stored differently at the Subscriber; therefore the value for the identity column can be different for the same rows.</span></span>  
  
## <a name="specifying-an-identity-range-management-option"></a><span data-ttu-id="a37c1-115">Specifica delle opzioni di gestione degli intervalli di valori Identity</span><span class="sxs-lookup"><span data-stu-id="a37c1-115">Specifying an Identity Range Management Option</span></span>  
 <span data-ttu-id="a37c1-116">Nella replica sono disponibili tre opzioni di gestione degli intervalli di valori Identity:</span><span class="sxs-lookup"><span data-stu-id="a37c1-116">Replication offers three identity range management options:</span></span>  
  
-   <span data-ttu-id="a37c1-117">Automatico.</span><span class="sxs-lookup"><span data-stu-id="a37c1-117">Automatic.</span></span> <span data-ttu-id="a37c1-118">Questa opzione viene utilizzata per la replica transazionale e di merge con aggiornamenti nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="a37c1-118">Used for merge replication and transactional replication with updates at the Subscriber.</span></span> <span data-ttu-id="a37c1-119">Specificare gli intervalli per il server di pubblicazione e i Sottoscrittori. L'assegnazione dei nuovi intervalli viene gestita automaticamente.</span><span class="sxs-lookup"><span data-stu-id="a37c1-119">Specify size ranges for the Publisher and Subscribers, and replication automatically manages the assignment of new ranges.</span></span> <span data-ttu-id="a37c1-120">Nella colonna Identity nel Sottoscrittore viene impostata l'opzione NOT FOR REPLICATION, in modo che il valore della colonna nel Sottoscrittore venga incrementato solo nel caso di inserimenti da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="a37c1-120">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber, so that only user inserts cause the value to be incremented at the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a37c1-121">È necessario sincronizzare i Sottoscrittori con il server di pubblicazione per ricevere i nuovi intervalli.</span><span class="sxs-lookup"><span data-stu-id="a37c1-121">Subscribers must synchronize with the Publisher to receive new ranges.</span></span> <span data-ttu-id="a37c1-122">Dato che gli intervalli di valori Identity vengono assegnati automaticamente ai Sottoscrittori, è possibile che un Sottoscrittore esaurisca gli intervalli disponibili se ne richiede ripetutamente di nuovi.</span><span class="sxs-lookup"><span data-stu-id="a37c1-122">Because Subscribers are assigned identity ranges automatically, it is possible for any Subscriber to exhaust the entire supply of identity ranges if it repeatedly requests new ranges.</span></span>  
  
-   <span data-ttu-id="a37c1-123">manuale.</span><span class="sxs-lookup"><span data-stu-id="a37c1-123">Manual.</span></span> <span data-ttu-id="a37c1-124">Questa opzione viene utilizzata per la replica snapshot e transazionale con aggiornamenti nel Sottoscrittore, per la replica transazionale peer-to-peer oppure se l'applicazione richiede il controllo degli intervalli di valori Identity a livello di programmazione.</span><span class="sxs-lookup"><span data-stu-id="a37c1-124">Used for snapshot and transactional replication without updates at the Subscriber, peer-to-peer transactional replication, or if your application must control identity ranges programmatically.</span></span> <span data-ttu-id="a37c1-125">Se si sceglie la gestione manuale, è necessario verificare che gli intervalli vengano assegnati al server di pubblicazione e a tutti i Sottoscrittori e che vengano assegnati nuovi intervalli se quelli iniziali sono già in uso.</span><span class="sxs-lookup"><span data-stu-id="a37c1-125">If you specify manual management, you must ensure that ranges are assigned to the Publisher and each Subscriber and that new ranges are assigned if the initial ranges are used.</span></span> <span data-ttu-id="a37c1-126">Nella replica l'opzione NOT FOR REPLICATION viene impostata nella colonna Identity del Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="a37c1-126">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber.</span></span>  
  
-   <span data-ttu-id="a37c1-127">No.</span><span class="sxs-lookup"><span data-stu-id="a37c1-127">None.</span></span> <span data-ttu-id="a37c1-128">Questa opzione è consigliata solo per la compatibilità con le versioni precedenti di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ed è disponibile solo dall'interfaccia delle stored procedure delle pubblicazioni transazionali.</span><span class="sxs-lookup"><span data-stu-id="a37c1-128">This option is recommended only for backwards compatibility with earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and is available only from the stored procedure interface for transactional publications.</span></span>  
  
 <span data-ttu-id="a37c1-129">Per specificare un'opzione di gestione degli intervalli di valori Identity, vedere [Gestire le colonne Identity](manage-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="a37c1-129">To specify an identity range management option, see [Manage Identity Columns](manage-identity-columns.md).</span></span>  
  
## <a name="assigning-identity-ranges"></a><span data-ttu-id="a37c1-130">Assegnazione degli intervalli di valori Identity</span><span class="sxs-lookup"><span data-stu-id="a37c1-130">Assigning Identity Ranges</span></span>  
 <span data-ttu-id="a37c1-131">In questa sezione vengono descritti i diversi metodi di assegnazione degli intervalli utilizzati per la replica di tipo merge e per la replica transazionale.</span><span class="sxs-lookup"><span data-stu-id="a37c1-131">Merge replication and transactional replication use different methods for assigning ranges; these methods are described in this section.</span></span>  
  
 <span data-ttu-id="a37c1-132">Nella replica di colonne Identity è opportuno considerare due tipi di intervalli, ovvero gli intervalli assegnati al server di pubblicazione e ai Sottoscrittori e l'intervallo del tipo di dati della colonna.</span><span class="sxs-lookup"><span data-stu-id="a37c1-132">There are two types of ranges to take into account when replicating identity columns: the ranges assigned to the Publisher and Subscribers, and the range of the data type in the column.</span></span> <span data-ttu-id="a37c1-133">Nella tabella seguente vengono illustrati gli intervalli disponibili per i tipi di dati utilizzati in genere nelle colonne Identity.</span><span class="sxs-lookup"><span data-stu-id="a37c1-133">The following table shows the ranges available for the data types typically used in identity columns.</span></span> <span data-ttu-id="a37c1-134">L'intervallo è applicato a tutti i nodi presenti in una topologia.</span><span class="sxs-lookup"><span data-stu-id="a37c1-134">The range is used across all nodes in a topology.</span></span> <span data-ttu-id="a37c1-135">Se ad esempio si usa a `smallint` partire da 1 con un incremento di 1, il numero massimo di inserimenti è 32.767 per il server di pubblicazione e per tutti i sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="a37c1-135">For example, if you use `smallint` starting at 1 with an increment of 1, the maximum number of inserts is 32,767 for the Publisher and all Subscribers.</span></span> <span data-ttu-id="a37c1-136">Il numero effettivo di inserimenti dipende dal fatto che vi siano o meno gap nei valori utilizzati e che venga utilizzato o meno un valore soglia.</span><span class="sxs-lookup"><span data-stu-id="a37c1-136">The actual number of inserts depends on whether there are gaps in the values used and whether a threshold value is used.</span></span> <span data-ttu-id="a37c1-137">Per ulteriori informazioni sulle soglie, vedere le sezioni seguenti relative alla replica di merge e alla replica transazionale con sottoscrizioni ad aggiornamento in coda.</span><span class="sxs-lookup"><span data-stu-id="a37c1-137">For more information about thresholds, see the following sections "Merge Replication" and "Transactional Replication with Queued Updating Subscriptions".</span></span>  
  
 <span data-ttu-id="a37c1-138">Se dopo un inserimento il server di pubblicazione esaurisce il proprio intervallo di valori Identity, è possibile assegnare automaticamente un nuovo intervallo a condizione che l'inserimento sia stato eseguito da un membro del ruolo predefinito del database **db_owner** .</span><span class="sxs-lookup"><span data-stu-id="a37c1-138">If the Publisher exhausts its identity range after an insert, it can automatically assign a new range if the insert was performed by a member of the **db_owner** fixed database role.</span></span> <span data-ttu-id="a37c1-139">Se l'inserimento è stato eseguito da un utente che non dispone di quel ruolo, è necessario che l'agente di lettura log, l'agente di merge o l'utente che è membro del ruolo **db_owner** esegua la stored procedure [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="a37c1-139">If the insert was performed by a user not in that role, the Log Reader Agent, Merge Agent, or a user who is a member of the **db_owner** role must run [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql).</span></span> <span data-ttu-id="a37c1-140">Nel caso di pubblicazioni transazionali, l'agente di lettura log deve essere in esecuzione per allocare automaticamente un nuovo intervallo di valori (per impostazione predefinita l'agente viene eseguito continuamente).</span><span class="sxs-lookup"><span data-stu-id="a37c1-140">For transactional publications, the Log Reader Agent must be running to automatically allocate a new range (the default is for the agent to run continuously).</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="a37c1-141">Durante l'inserimento di un batch di grandi dimensioni, il trigger di replica viene generato solo una volta, non per ogni riga inserita.</span><span class="sxs-lookup"><span data-stu-id="a37c1-141">During a large batch insert the replication trigger is fired only once, not for each row of the insert.</span></span> <span data-ttu-id="a37c1-142">Questa condizione può comportare un errore dell'istruzione di inserimento se un intervallo di valori Identity viene esaurito durante un inserimento di grandi dimensioni, ad esempio un'istruzione `INSERT INTO`.</span><span class="sxs-lookup"><span data-stu-id="a37c1-142">This can lead to a failure of the insert statement if an identity range is exhausted during an large insert, such as an `INSERT INTO` statement.</span></span>  
  
|<span data-ttu-id="a37c1-143">Tipo di dati</span><span class="sxs-lookup"><span data-stu-id="a37c1-143">Data type</span></span>|<span data-ttu-id="a37c1-144">Range</span><span class="sxs-lookup"><span data-stu-id="a37c1-144">Range</span></span>|  
|---------------|-----------|  
|`tinyint`|<span data-ttu-id="a37c1-145">Non supportato per la gestione automatica</span><span class="sxs-lookup"><span data-stu-id="a37c1-145">Not supported for automatic management</span></span>|  
|`smallint`|<span data-ttu-id="a37c1-146">da -2^15 (-32.768) a 2^15-1 (32.767)</span><span class="sxs-lookup"><span data-stu-id="a37c1-146">-2^15 (-32,768) to 2^15-1 (32,767)</span></span>|  
|`int`|<span data-ttu-id="a37c1-147">da -2^31 (-2.147.483.648) a 2^31-1 (2.147.483.647)</span><span class="sxs-lookup"><span data-stu-id="a37c1-147">-2^31 (-2,147,483,648) to 2^31-1 (2,147,483,647)</span></span>|  
|`bigint`|<span data-ttu-id="a37c1-148">da -2^63 (-9.223.372.036.854.775.808) a 2^63-1 (9.223.372.036.854.775.807)</span><span class="sxs-lookup"><span data-stu-id="a37c1-148">-2^63 (-9,223,372,036,854,775,808) to 2^63-1 (9,223,372,036,854,775,807)</span></span>|  
|<span data-ttu-id="a37c1-149">`decimal` e `numeric`</span><span class="sxs-lookup"><span data-stu-id="a37c1-149">`decimal` and `numeric`</span></span>|<span data-ttu-id="a37c1-150">da -10^38+1 a 10^38-1</span><span class="sxs-lookup"><span data-stu-id="a37c1-150">-10^38+1 through 10^38-1</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="a37c1-151">Per creare un numero a incremento automatico da usare in più tabelle o da chiamare dalle applicazioni senza fare riferimento ad alcuna tabella, vedere [Numeri di sequenza](../../sequence-numbers/sequence-numbers.md).</span><span class="sxs-lookup"><span data-stu-id="a37c1-151">To create an automatically incrementing number that can be used in multiple tables or that can be called from applications without referencing any table, see [Sequence Numbers](../../sequence-numbers/sequence-numbers.md).</span></span>  
  
### <a name="merge-replication"></a><span data-ttu-id="a37c1-152">Replica di tipo merge</span><span class="sxs-lookup"><span data-stu-id="a37c1-152">Merge Replication</span></span>  
 <span data-ttu-id="a37c1-153">Gli intervalli di valori Identity vengono gestiti dal server di pubblicazione e distribuiti ai Sottoscrittori dall'agente di merge. In una gerarchia di ripubblicazione, invece, gli intervalli vengono gestiti dal server di pubblicazione radice e dai server di ripubblicazione.</span><span class="sxs-lookup"><span data-stu-id="a37c1-153">Identity ranges are managed by the Publisher and propagated to Subscribers by the Merge Agent (in a republishing hierarchy, ranges are managed by the root Publisher and the republishers).</span></span> <span data-ttu-id="a37c1-154">I valori Identity vengono assegnati da un pool nel server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="a37c1-154">The identity values are assigned from a pool at the Publisher.</span></span> <span data-ttu-id="a37c1-155">Se si aggiunge un articolo con una colonna Identity a una pubblicazione mediante Creazione guidata nuova pubblicazione o usando la stored procedure [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), è necessario specificare i valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="a37c1-155">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="a37c1-156">Il parametro \*\* \@ identity_range\*\* , che controlla le dimensioni dell'intervallo di valori Identity inizialmente allocato al server di pubblicazione e ai sottoscrittori con sottoscrizioni client.</span><span class="sxs-lookup"><span data-stu-id="a37c1-156">The **\@identity_range** parameter, which controls the identity range size initially allocated both to the Publisher and to Subscribers with client subscriptions.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a37c1-157">Per i Sottoscrittori che eseguono versioni precedenti di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , questo parametro (anziché il parametro \*\* \@ pub_identity_range\*\* ) controlla anche le dimensioni dell'intervallo di valori Identity nei Sottoscrittori di ripubblicazione.</span><span class="sxs-lookup"><span data-stu-id="a37c1-157">For Subscribers running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], this parameter (rather than the **\@pub_identity_range** parameter) also controls the identity range size at republishing Subscribers.</span></span>  
  
-   <span data-ttu-id="a37c1-158">Il parametro \*\* \@ pub_identity_range\*\* , che controlla le dimensioni dell'intervallo di valori Identity per la ripubblicazione allocata ai sottoscrittori con sottoscrizioni server (necessarie per la ripubblicazione dei dati).</span><span class="sxs-lookup"><span data-stu-id="a37c1-158">The **\@pub_identity_range** parameter, which controls the identity range size for republishing allocated to Subscribers with server subscriptions (required for republishing data).</span></span> <span data-ttu-id="a37c1-159">Tutti i Sottoscrittori con sottoscrizioni server ricevono un intervallo per la ripubblicazione, anche se non eseguono la ripubblicazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="a37c1-159">All Subscribers with server subscriptions receive a range for republishing, even if they don't actually republish data.</span></span>  
  
-   <span data-ttu-id="a37c1-160">Il parametro \*\* \@ Threshold\*\* , utilizzato per determinare quando è necessario un nuovo intervallo di identità per una sottoscrizione di [!INCLUDE[ssEW](../../../includes/ssew-md.md)] o una versione precedente di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="a37c1-160">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription to [!INCLUDE[ssEW](../../../includes/ssew-md.md)] or a previous version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="a37c1-161">È ad esempio possibile specificare 10000 per \*\* \@ identity_range\*\* e 500000 per \*\* \@ pub_identity_range\*\*.</span><span class="sxs-lookup"><span data-stu-id="a37c1-161">For example, you could specify 10000 for **\@identity_range** and 500000 for **\@pub_identity_range**.</span></span> <span data-ttu-id="a37c1-162">Al server di pubblicazione e a tutti i Sottoscrittori che eseguono [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] o versione successiva, incluso il Sottoscrittore con la sottoscrizione server, viene assegnato un intervallo primario di 10000.</span><span class="sxs-lookup"><span data-stu-id="a37c1-162">The Publisher and all Subscribers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version, including the Subscriber with the server subscription, are assigned a primary range of 10000.</span></span> <span data-ttu-id="a37c1-163">Al Sottoscrittore con la sottoscrizione server viene inoltre assegnato un intervallo primario di 500000, che può essere utilizzato dai Sottoscrittori che si sincronizzano con il Sottoscrittore di ripubblicazione. è inoltre necessario specificare \*\* \@ identity_range**, \*\* \@ pub_identity_range**e \*\* \@ Threshold\*\* per gli articoli della pubblicazione nel Sottoscrittore di ripubblicazione.</span><span class="sxs-lookup"><span data-stu-id="a37c1-163">The Subscriber with the server subscription is also assigned a primary range of 500000, which can be used by Subscribers that synchronize with the republishing Subscriber (you must also specify **\@identity_range**, **\@pub_identity_range**, and **\@threshold** for the articles in the publication at the republishing Subscriber).</span></span>  
  
 <span data-ttu-id="a37c1-164">Tutti i Sottoscrittori che eseguono [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] o versione successiva ricevono inoltre un intervallo di valori Identity secondario.</span><span class="sxs-lookup"><span data-stu-id="a37c1-164">Each Subscriber running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version also receives a secondary identity range.</span></span> <span data-ttu-id="a37c1-165">Questo valore secondario ha le stesse dimensioni dell'intervallo primario. Quando quest'ultimo si esaurisce viene utilizzato l'intervallo secondario. L'agente di merge assegna al Sottoscrittore un nuovo intervallo,</span><span class="sxs-lookup"><span data-stu-id="a37c1-165">The secondary range is equal in size to the primary range; when the primary range is exhausted, the secondary range is used, and the Merge Agent assigns a new range to the Subscriber.</span></span> <span data-ttu-id="a37c1-166">che diventa l'intervallo secondario. In questo modo, quando vengono utilizzati i valori Identity del Sottoscrittore il processo continua.</span><span class="sxs-lookup"><span data-stu-id="a37c1-166">The new range becomes the secondary range, and the process continues as the Subscriber uses identity values.</span></span>  
  
  
### <a name="transactional-replication-with-queued-updating-subscriptions"></a><span data-ttu-id="a37c1-167">Replica transazionale con sottoscrizioni ad aggiornamento in coda</span><span class="sxs-lookup"><span data-stu-id="a37c1-167">Transactional Replication with Queued Updating Subscriptions</span></span>  
 <span data-ttu-id="a37c1-168">Gli intervalli di valori Identity vengono gestiti dal server di distribuzione e distribuiti ai Sottoscrittori dall'agente di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="a37c1-168">Identity ranges are managed by the Distributor and propagated to Subscribers by the Distribution Agent.</span></span> <span data-ttu-id="a37c1-169">I valori Identity vengono assegnati da un pool nel server di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="a37c1-169">The identity values are assigned from a pool at the Distributor.</span></span> <span data-ttu-id="a37c1-170">Le dimensioni del pool dipendono dalle dimensioni del tipo di dati e dall'incremento utilizzato per la colonna Identity.</span><span class="sxs-lookup"><span data-stu-id="a37c1-170">The pool size is based on the size of the data type and the increment used for the identity column.</span></span> <span data-ttu-id="a37c1-171">Se si aggiunge un articolo con una colonna Identity a una pubblicazione mediante Creazione guidata nuova pubblicazione o usando la stored procedure [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), è necessario specificare i valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="a37c1-171">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="a37c1-172">Il parametro \*\* \@ identity_range\*\* , che controlla le dimensioni dell'intervallo di valori Identity inizialmente allocato a tutti i sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="a37c1-172">The **\@identity_range** parameter, which controls the identity range size initially allocated to all Subscribers.</span></span>  
  
-   <span data-ttu-id="a37c1-173">Il parametro \*\* \@ pub_identity_range\*\* , che controlla le dimensioni dell'intervallo di valori Identity allocato al server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="a37c1-173">The **\@pub_identity_range** parameter, which controls the identity range size allocated to the Publisher.</span></span>  
  
-   <span data-ttu-id="a37c1-174">Il parametro \*\* \@ Threshold\*\* , utilizzato per determinare quando è necessario un nuovo intervallo di identità per una sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="a37c1-174">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription.</span></span>  
  
 <span data-ttu-id="a37c1-175">È ad esempio possibile specificare 10000 per \*\* \@ pub_identity_range**, 1000 per \*\* \@ identity_range** (presupponendo un minor numero di aggiornamenti nel Sottoscrittore) e 80% per la \*\* \@ soglia\*\*.</span><span class="sxs-lookup"><span data-stu-id="a37c1-175">For example, you could specify 10000 for **\@pub_identity_range**, 1000 for **\@identity_range** (assuming fewer updates at the Subscriber), and 80 percent for **\@threshold**.</span></span> <span data-ttu-id="a37c1-176">Dopo 800 inserimenti in un Sottoscrittore, pari all'80% di 1000, al Sottoscrittore viene assegnato un nuovo intervallo.</span><span class="sxs-lookup"><span data-stu-id="a37c1-176">After 800 inserts at a Subscriber (80 percent of 1000), a Subscriber is assigned a new range.</span></span> <span data-ttu-id="a37c1-177">Dopo 8.000 inserimenti nel server di pubblicazione, al server di pubblicazione viene assegnato un nuovo intervallo.</span><span class="sxs-lookup"><span data-stu-id="a37c1-177">After 8000 inserts at the Publisher, the Publisher is assigned a new range.</span></span> <span data-ttu-id="a37c1-178">A questo punto vi sarà un gap nell'intervallo di valori Identity della tabella.</span><span class="sxs-lookup"><span data-stu-id="a37c1-178">When a new range is assigned, there will be a gap in the identity range values in the table.</span></span> <span data-ttu-id="a37c1-179">Specificando una soglia più elevata si avranno gap più piccoli, ma il sistema sarà meno tollerante agli errori. Se per qualche ragione non è possibile eseguire l'agente di distribuzione, i Sottoscrittori potrebbero esaurire più facilmente i valori Identity.</span><span class="sxs-lookup"><span data-stu-id="a37c1-179">Specifying a higher threshold results in smaller gaps, but the system is less fault-tolerant: if the Distribution Agent cannot run for some reason, a Subscriber could more easily run out of identities.</span></span>  
  
## <a name="assigning-ranges-for-manual-identity-range-management"></a><span data-ttu-id="a37c1-180">Assegnazione di intervalli per la gestione manuale degli intervalli di valori Identity</span><span class="sxs-lookup"><span data-stu-id="a37c1-180">Assigning ranges for manual identity range management</span></span>  
 <span data-ttu-id="a37c1-181">Se si sceglie la gestione manuale, è necessario verificare che il server di pubblicazione e tutti i Sottoscrittori utilizzino intervalli di valori Identity diversi.</span><span class="sxs-lookup"><span data-stu-id="a37c1-181">If you specify manual identity range management, you must ensure that the Publisher and each Subscriber use different identity ranges.</span></span> <span data-ttu-id="a37c1-182">Si consideri, ad esempio, una tabella nel server di pubblicazione con una colonna Identity definita come `IDENTITY(1,1)`: la colonna Identity comincia col valore 1 e viene incrementata di 1 ogni volta che viene inserita una riga.</span><span class="sxs-lookup"><span data-stu-id="a37c1-182">For example, consider a table at the Publisher with an identity column defined as `IDENTITY(1,1)`: the identity column starts at 1 and is incremented by 1 each time a row is inserted.</span></span> <span data-ttu-id="a37c1-183">Se la tabella nel server di pubblicazione ha 5.000 righe e si prevede una crescita nella tabella superiore alla durata dell'applicazione, per il server di pubblicazione si potrebbe utilizzare l'intervallo 1-10.000.</span><span class="sxs-lookup"><span data-stu-id="a37c1-183">If the table at the Publisher has 5,000 rows, and you expect some growth in the table over the life of the application, the Publisher could use the range 1-10,000.</span></span> <span data-ttu-id="a37c1-184">Nel caso vi siano due Sottoscrittori, per il Sottoscrittore A si potrebbe usare l'intervallo 10.001-20.000 e per il Sottoscrittore B l'intervallo 20.001-30.000.</span><span class="sxs-lookup"><span data-stu-id="a37c1-184">Given two Subscribers, Subscriber A could use 10,001-20,000, and Subscriber B could use 20,001-30,000.</span></span>  
  
 <span data-ttu-id="a37c1-185">Dopo aver inizializzato un Sottoscrittore con uno snapshot o altri metodi, eseguire DBCC CHECKIDENT per assegnare al Sottoscrittore un punto di partenza per l'intervallo di valori Identity.</span><span class="sxs-lookup"><span data-stu-id="a37c1-185">After a Subscriber is initialized with a snapshot or through another means, execute DBCC CHECKIDENT to assign the Subscriber a starting point for its identity range.</span></span> <span data-ttu-id="a37c1-186">Ad esempio, nel Sottoscrittore A si eseguirà `DBCC CHECKIDENT('<TableName>','reseed',10001)`,</span><span class="sxs-lookup"><span data-stu-id="a37c1-186">For example, at Subscriber A, you would execute `DBCC CHECKIDENT('<TableName>','reseed',10001)`.</span></span> <span data-ttu-id="a37c1-187">mentre nel Sottoscrittore B si eseguirà `CHECKIDENT('<TableName>','reseed',20001)`.</span><span class="sxs-lookup"><span data-stu-id="a37c1-187">At Subscriber B, you would execute `CHECKIDENT('<TableName>','reseed',20001)`.</span></span>  
  
 <span data-ttu-id="a37c1-188">Per assegnare nuovi intervalli al server di pubblicazione o ai Sottoscrittori, eseguire DBCC CHECKIDENT e specificare un nuovo valore per reinizializzare la tabella.</span><span class="sxs-lookup"><span data-stu-id="a37c1-188">To assign new ranges to the Publisher or Subscribers, execute DBCC CHECKIDENT and specify a new value to reseed the table.</span></span> <span data-ttu-id="a37c1-189">È consigliabile definire un metodo per determinare quando è necessario assegnare un nuovo intervallo.</span><span class="sxs-lookup"><span data-stu-id="a37c1-189">You should have some way to determine when a new range must be assigned.</span></span> <span data-ttu-id="a37c1-190">Ad esempio, nell'applicazione potrebbe esserci un meccanismo che rileva quando un nodo sta per esaurire il proprio intervallo e quindi consente di assegnare un nuovo intervallo mediante DBCC CHECKIDENT.</span><span class="sxs-lookup"><span data-stu-id="a37c1-190">For example, your application could have a mechanism that detects when a node is about to use up its range and assign a new range using DBCC CHECKIDENT.</span></span> <span data-ttu-id="a37c1-191">È inoltre possibile aggiungere un vincolo CHECK per impedire che venga aggiunta una riga se ciò determina l'utilizzo di un valore Identity non compreso nell'intervallo disponibile.</span><span class="sxs-lookup"><span data-stu-id="a37c1-191">You can also add a check constraint to ensure that a row cannot be added if it would cause an out of range identity value to be used.</span></span>  
  
## <a name="handling-identity-ranges-after-a-database-restore"></a><span data-ttu-id="a37c1-192">Gestione degli intervalli di valori Identity dopo il ripristino di un database</span><span class="sxs-lookup"><span data-stu-id="a37c1-192">Handling Identity Ranges after a Database Restore</span></span>  
 <span data-ttu-id="a37c1-193">Se si utilizza la gestione automatica, quando un Sottoscrittore viene ripristinato da un backup, viene richiesto automaticamente un nuovo intervallo di valori Identity.</span><span class="sxs-lookup"><span data-stu-id="a37c1-193">If you are using automatic identity range management, when a Subscriber is restored from a backup, it automatically requests a new range of identity values.</span></span> <span data-ttu-id="a37c1-194">Se un server di pubblicazione viene ripristinato da un backup, è necessario verificare che al server di pubblicazione venga assegnato l'intervallo appropriato.</span><span class="sxs-lookup"><span data-stu-id="a37c1-194">If a Publisher is restored from a backup, you must ensure that the Publisher is assigned an appropriate range.</span></span> <span data-ttu-id="a37c1-195">Per la replica di tipo merge, assegnare un nuovo intervallo mediante [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="a37c1-195">For merge replication, assign a new range using [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql).</span></span> <span data-ttu-id="a37c1-196">Nella replica transazionale determinare il valore massimo utilizzato e quindi impostare il punto di partenza dei nuovi intervalli.</span><span class="sxs-lookup"><span data-stu-id="a37c1-196">For transactional replication, determine the highest value that has been used and then set the starting point for new ranges.</span></span> <span data-ttu-id="a37c1-197">Utilizzare la procedura seguente dopo aver ripristinato il database di pubblicazione:</span><span class="sxs-lookup"><span data-stu-id="a37c1-197">Use the following procedure after the publication database has been restored:</span></span>  
  
1.  <span data-ttu-id="a37c1-198">Arrestare tutte le attività di tutti i Sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="a37c1-198">Stop all activity on all Subscribers.</span></span>  
  
2.  <span data-ttu-id="a37c1-199">Per ogni tabella pubblicata che include una colonna Identity:</span><span class="sxs-lookup"><span data-stu-id="a37c1-199">For each published table that includes an identity column:</span></span>  
  
    1.  <span data-ttu-id="a37c1-200">Nel database di sottoscrizione di ogni Sottoscrittore eseguire `IDENT_CURRENT('<TableName>')`.</span><span class="sxs-lookup"><span data-stu-id="a37c1-200">In the subscription database at each Subscriber, execute `IDENT_CURRENT('<TableName>')`.</span></span>  
  
    2.  <span data-ttu-id="a37c1-201">Registrare il valore massimo rilevato in tutti i Sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="a37c1-201">Record the highest value found across all Subscribers.</span></span>  
  
    3.  <span data-ttu-id="a37c1-202">Nel database di pubblicazione del server di pubblicazione eseguire `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`.</span><span class="sxs-lookup"><span data-stu-id="a37c1-202">In the publication database at the Publisher, execute `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`).</span></span>  
  
    4.  <span data-ttu-id="a37c1-203">Nel database di pubblicazione del server di pubblicazione eseguire `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`.</span><span class="sxs-lookup"><span data-stu-id="a37c1-203">In the publication database at the Publisher, execute `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a37c1-204">Se il valore nella colonna Identity viene impostato per essere decrementato anziché incrementato, registrare il valore minimo rilevato e quindi reinizializzare tale valore.</span><span class="sxs-lookup"><span data-stu-id="a37c1-204">If the value in the identity column is set to decrement rather than increment, record the lowest value found, and then reseed with that value.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a37c1-205">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="a37c1-205">See Also</span></span>  
 <span data-ttu-id="a37c1-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a37c1-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 <span data-ttu-id="a37c1-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a37c1-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span></span>  
 <span data-ttu-id="a37c1-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a37c1-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span></span>  
 <span data-ttu-id="a37c1-209">[IDENTITY &#40;proprietà&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span><span class="sxs-lookup"><span data-stu-id="a37c1-209">[IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span></span>  
 [<span data-ttu-id="a37c1-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="a37c1-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql)  
  
  
