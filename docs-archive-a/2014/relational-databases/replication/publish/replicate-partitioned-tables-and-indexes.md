---
title: Replicare tabelle e indici partizionati | Microsoft Docs
ms.custom: ''
ms.date: 09/10/2015
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- partitioned indexes [SQL Server], replicating
- partitioned tables [SQL Server], replicating
- replication [SQL Server], partitioned tables
- publishing [SQL Server replication], partitioned tables
- transactional replication, partitioned tables
ms.assetid: c9fa81b1-6c81-4c11-927b-fab16301a8f5
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 616707bfb11b48b170fc8f0e8872076d2cd09d1c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87625304"
---
# <a name="replicate-partitioned-tables-and-indexes"></a><span data-ttu-id="09692-102">Replica di tabelle e indici partizionati</span><span class="sxs-lookup"><span data-stu-id="09692-102">Replicate Partitioned Tables and Indexes</span></span>
  <span data-ttu-id="09692-103">Il partizionamento semplifica la gestione di indici e tabelle di grandi dimensioni, in quanto consente di gestire e accedere in modo rapido ed efficace a subset di dati, preservando al contempo l'integrità di una raccolta dati.</span><span class="sxs-lookup"><span data-stu-id="09692-103">Partitioning makes large tables or indexes more manageable because partitioning enables you to manage and access subsets of data quickly and efficiently, and maintain the integrity of a data collection at the same time.</span></span> <span data-ttu-id="09692-104">Per ulteriori informazioni, vedere [Partitioned Tables and Indexes](../../partitions/partitioned-tables-and-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="09692-104">For more information, see [Partitioned Tables and Indexes](../../partitions/partitioned-tables-and-indexes.md).</span></span> <span data-ttu-id="09692-105">La replica supporta il partizionamento fornendo un set di proprietà che specificano la modalità di gestione di tabelle e indici partizionati.</span><span class="sxs-lookup"><span data-stu-id="09692-105">Replication supports partitioning by providing a set of properties that specify how partitioned tables and indexes should be treated.</span></span>  
  
## <a name="article-properties-for-transactional-and-merge-replication"></a><span data-ttu-id="09692-106">Proprietà degli articoli per la replica transazionale e di tipo merge</span><span class="sxs-lookup"><span data-stu-id="09692-106">Article Properties for Transactional and Merge Replication</span></span>  
 <span data-ttu-id="09692-107">Nella tabella seguente sono inclusi gli oggetti utilizzati per partizionare i dati.</span><span class="sxs-lookup"><span data-stu-id="09692-107">The following table lists the objects that are used to partition data.</span></span>  
  
|<span data-ttu-id="09692-108">Oggetto</span><span class="sxs-lookup"><span data-stu-id="09692-108">Object</span></span>|<span data-ttu-id="09692-109">Creato tramite</span><span class="sxs-lookup"><span data-stu-id="09692-109">Created by using</span></span>|  
|------------|----------------------|  
|<span data-ttu-id="09692-110">Tabella o indice partizionato</span><span class="sxs-lookup"><span data-stu-id="09692-110">Partitioned table or index</span></span>|<span data-ttu-id="09692-111">CREATE TABLE o CREATE INDEX</span><span class="sxs-lookup"><span data-stu-id="09692-111">CREATE TABLE or CREATE INDEX</span></span>|  
|<span data-ttu-id="09692-112">Funzione di partizione</span><span class="sxs-lookup"><span data-stu-id="09692-112">Partition function</span></span>|<span data-ttu-id="09692-113">CREATE PARTITION FUNCTION</span><span class="sxs-lookup"><span data-stu-id="09692-113">CREATE PARTITION FUNCTION</span></span>|  
|<span data-ttu-id="09692-114">Schema di partizione</span><span class="sxs-lookup"><span data-stu-id="09692-114">Partition scheme</span></span>|<span data-ttu-id="09692-115">CREATE PARTITION SCHEME</span><span class="sxs-lookup"><span data-stu-id="09692-115">CREATE PARTITION SCHEME</span></span>|  
  
 <span data-ttu-id="09692-116">Il primo set di proprietà correlato al partizionamento è costituito dalle opzioni dello schema dell'articolo che determinano se gli oggetti di partizionamento devono essere copiati nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="09692-116">The first set of properties related to partitioning are the article schema options that determine whether partitioning objects should be copied to the Subscriber.</span></span> <span data-ttu-id="09692-117">È possibile impostare tali opzioni nei modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="09692-117">These schema options can be set in the following ways:</span></span>  
  
-   <span data-ttu-id="09692-118">Nella pagina **Proprietà articolo** della Creazione guidata nuova pubblicazione o nella finestra di dialogo Proprietà pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="09692-118">In the **Article Properties** page of the New Publication Wizard or the Publication Properties dialog box.</span></span> <span data-ttu-id="09692-119">Per copiare gli oggetti elencati nella tabella precedente, specificare un valore `true` per le proprietà **Copia schemi di partizionamento delle tabelle** e **Copia schemi di partizionamento degli indici**.</span><span class="sxs-lookup"><span data-stu-id="09692-119">To copy the objects listed in the previous table, specify a value of `true` for the properties **Copy table partitioning schemes** and **Copy index partitioning schemes**.</span></span> <span data-ttu-id="09692-120">Per informazioni su come accedere alla pagina **Proprietà articolo**, vedere [Visualizzare e modificare le proprietà della pubblicazione](view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="09692-120">For information about how to access the **Article Properties** page, see [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
-   <span data-ttu-id="09692-121">Utilizzando il parametro *schema_option* di una delle stored procedure seguenti:</span><span class="sxs-lookup"><span data-stu-id="09692-121">By using the *schema_option* parameter of one of the following stored procedures:</span></span>  
  
    -   <span data-ttu-id="09692-122">[sp_addarticle](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) o [sp_changearticle](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql) per la replica transazionale</span><span class="sxs-lookup"><span data-stu-id="09692-122">[sp_addarticle](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) or [sp_changearticle](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql) for transactional replication</span></span>  
  
    -   <span data-ttu-id="09692-123">[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) o [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) per la replica di tipo merge</span><span class="sxs-lookup"><span data-stu-id="09692-123">[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) or [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) for merge replication</span></span>  
  
     <span data-ttu-id="09692-124">Per copiare gli oggetti elencati nella tabella precedente, specificare i valori dell'opzione dello schema appropriati.</span><span class="sxs-lookup"><span data-stu-id="09692-124">To copy the objects listed in the previous table, specify the appropriate schema option values.</span></span> <span data-ttu-id="09692-125">Per informazioni su come specificare le opzioni dello schema, vedere [Specify Schema Options](specify-schema-options.md).</span><span class="sxs-lookup"><span data-stu-id="09692-125">For information about how to specify schema options, see [Specify Schema Options](specify-schema-options.md).</span></span>  
  
 <span data-ttu-id="09692-126">Tramite la replica vengono copiati gli oggetti nel Sottoscrittore durante la sincronizzazione iniziale.</span><span class="sxs-lookup"><span data-stu-id="09692-126">Replication copies objects to the Subscriber during the initial synchronization.</span></span> <span data-ttu-id="09692-127">Se lo schema di partizione utilizza filegroup diversi dal filegroup PRIMARY, tali filegroup devono essere presenti nel Sottoscrittore prima della sincronizzazione iniziale.</span><span class="sxs-lookup"><span data-stu-id="09692-127">If the partition scheme uses filegroups other than the PRIMARY filegroup, those filegroups must exist on the Subscriber before the initial synchronization.</span></span>  
  
 <span data-ttu-id="09692-128">Al termine dell'inizializzazione del Sottoscrittore, le modifiche dei dati vengono propagate al Sottoscrittore e applicate alle partizioni appropriate.</span><span class="sxs-lookup"><span data-stu-id="09692-128">After the Subscriber is initialized, data changes are propagated to the Subscriber and applied to the appropriate partitions.</span></span> <span data-ttu-id="09692-129">Non sono tuttavia supportate le modifiche allo schema di partizione.</span><span class="sxs-lookup"><span data-stu-id="09692-129">However, changes to the partition scheme are not supported.</span></span> <span data-ttu-id="09692-130">Le repliche transazionale e di tipo merge non supportano la replica dei comandi seguenti: ALTER PARTITION FUNCTION, ALTER PARTITION SCHEME e l'istruzione REBUILD WITH PARTITION di ALTER INDEX.</span><span class="sxs-lookup"><span data-stu-id="09692-130">Transactional and merge replication do not support replicating the following commands: ALTER PARTITION FUNCTION, ALTER PARTITION SCHEME, or the REBUILD WITH PARTITION statement of ALTER INDEX.</span></span>  <span data-ttu-id="09692-131">Le modifiche associate non verranno replicate automaticamente nel sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="09692-131">The changes associated with them will not be automatically replicated to the Subscriber.</span></span> <span data-ttu-id="09692-132">È responsabilità dell'utente apportare manualmente modifiche simili nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="09692-132">It is the responsibility of the user to make similar changes manually at the Subscriber.</span></span>  
  
## <a name="replication-support-for-partition-switching"></a><span data-ttu-id="09692-133">Supporto della replica per il cambio della partizione</span><span class="sxs-lookup"><span data-stu-id="09692-133">Replication Support for Partition Switching</span></span>  
 <span data-ttu-id="09692-134">Uno dei vantaggi principali del partizionamento di tabelle consiste nella possibilità di spostare in modo rapido ed efficiente subset di dati tra partizioni.</span><span class="sxs-lookup"><span data-stu-id="09692-134">One of the key benefits of table partitioning is the ability to quickly and efficiently move subsets of data between partitions.</span></span> <span data-ttu-id="09692-135">I dati vengono spostati utilizzando il comando SWITCH PARTITION.</span><span class="sxs-lookup"><span data-stu-id="09692-135">Data is moved by using the SWITCH PARTITION command.</span></span> <span data-ttu-id="09692-136">Per impostazione predefinita, quando una tabella è abilitata per la replica, le operazioni SWITCH PARTITION sono bloccate per i motivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="09692-136">By default, when a table is enabled for replication, SWITCH PARTITION operations are blocked for the following reasons:</span></span>  
  
-   <span data-ttu-id="09692-137">Se i dati vengono spostati all'interno o all'esterno di una tabella presente nel server di pubblicazione ma non nel Sottoscrittore, il server di pubblicazione e il Sottoscrittore potrebbero risultare incoerenti uno rispetto all'altro.</span><span class="sxs-lookup"><span data-stu-id="09692-137">If data is moved into or out of a table that exists at the Publisher but does not exist at the Subscriber, the Publisher and Subscriber could become inconsistent with one another.</span></span> <span data-ttu-id="09692-138">Questo problema si verifica in genere quando i dati vengono spostati all'interno o all'esterno di una tabella di staging.</span><span class="sxs-lookup"><span data-stu-id="09692-138">This problem typically occurs when data is moved into or out of a staging table.</span></span>  
  
-   <span data-ttu-id="09692-139">Se il Sottoscrittore ha una definizione diversa per la tabella partizionata rispetto al server di pubblicazione, l'esecuzione dell'agente di distribuzione verrà interrotta quando questo tenta di applicare le modifiche nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="09692-139">If the Subscriber has a different definition for the partitioned table than the Publisher, the Distribution Agent will fail when it tries to apply changes at the Subscriber.</span></span>  
  
 <span data-ttu-id="09692-140">Nonostante questi possibili problemi, il cambio della partizione può essere abilitato per la replica transazionale.</span><span class="sxs-lookup"><span data-stu-id="09692-140">Despite these potential issues, partition switching can be enabled for transactional replication.</span></span> <span data-ttu-id="09692-141">Prima di abilitare il cambio della partizione, assicurarsi che tutte le tabelle interessate siano presenti nel server di pubblicazione e nel Sottoscrittore e verificare che le definizioni di tabella e di partizione siano identiche.</span><span class="sxs-lookup"><span data-stu-id="09692-141">Before you enable partition switching, make sure that all tables that are involved in partition switching exist at the Publisher and Subscriber, and make sure that the table and partition definitions are the same.</span></span>  
  
 <span data-ttu-id="09692-142">Quando lo schema di partizione delle partizioni è lo stesso nei server di pubblicazione e nei Sottoscrittori, è possibile abilitare *allow_partition_switch* insieme a *replication_partition_switch* tramite cui verrà eseguita la replica solo dell'istruzione switch della partizione al Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="09692-142">When partitions have the exact same partition scheme at the publishers and subscribers you can turn on *allow_partition_switch* along with *replication_partition_switch* which will only replicate the partition switch statement to the subscriber.</span></span> <span data-ttu-id="09692-143">È inoltre possibile abilitare *allow_partition_switch* senza la replica della DDL.</span><span class="sxs-lookup"><span data-stu-id="09692-143">You can also turn on *allow_partition_switch* without replicating the DDL.</span></span> <span data-ttu-id="09692-144">Questa operazione risulta utile nel caso in cui si desideri eseguire il roll out dei mesi precedenti della partizione ma mantenendo la partizione replicata per un altro anno per scopi di backup nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="09692-144">This is useful in the case where you want to roll old months out of the partition but keep the replicated partition in place for another year for backup purposes at the subscriber.</span></span>  
  
 <span data-ttu-id="09692-145">Se si abilita il cambio della partizione usando la versione corrente in SQL Server 2008 R2, successivamente potrebbero essere necessarie anche operazioni di divisione e merge.</span><span class="sxs-lookup"><span data-stu-id="09692-145">If you enable partition switching on SQL Server 2008 R2 through the current version, you might also need split and merge operations in near future.</span></span> <span data-ttu-id="09692-146">Prima di eseguire un'operazione di divisione o di unione su una tabella replicata assicurarsi che la partizione in questione non abbia comandi replicati in sospeso.</span><span class="sxs-lookup"><span data-stu-id="09692-146">Before executing a split or merge operation on a replicated table ensure that the partition in question does not have any pending replicated commands.</span></span> <span data-ttu-id="09692-147">È anche necessario assicurarsi che nessuna operazione DML venga eseguita sulla partizione durante le operazioni di divisione e unione.</span><span class="sxs-lookup"><span data-stu-id="09692-147">You should also ensure that no DML operations are executed on the partition during the split and merge operations.</span></span> <span data-ttu-id="09692-148">Se sono presenti transazioni non elaborate dalla lettura log o se le operazioni DML vengono eseguite in una partizione di una tabella replicata durante l'esecuzione di un'operazione di divisione o di merge che coinvolge tale partizione, si potrebbe verificare un errore di elaborazione nell'agente di lettura log.</span><span class="sxs-lookup"><span data-stu-id="09692-148">If there are transactions which the log reader has not processed, or if DML operations are performed on a partition of a replicated table while a split or merge operation is executed (involving the same partition), it could lead to a processing error with log reader agent.</span></span> <span data-ttu-id="09692-149">Per correggere l'errore è necessaria una reinizializzazione della sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="09692-149">In order to correct the error, it might require a re-initialization of the subscription.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="09692-150">Non è necessario abilitare il cambio della partizione per pubblicazioni peer-to-peer, a causa della colonna nascosta utilizzata per rilevare e risolvere conflitti.</span><span class="sxs-lookup"><span data-stu-id="09692-150">You should not enable partition switching for Peer-to-Peer publications, due to the hidden column which is used to detect and resolve conflict.</span></span>  
  
### <a name="enabling-partition-switching"></a><span data-ttu-id="09692-151">Abilitazione del cambio della partizione</span><span class="sxs-lookup"><span data-stu-id="09692-151">Enabling Partition Switching</span></span>  
 <span data-ttu-id="09692-152">Le proprietà seguenti per le pubblicazioni transazionali consentono agli utenti di controllare il comportamento del cambio della partizione in un ambiente replicato:</span><span class="sxs-lookup"><span data-stu-id="09692-152">The following properties for transactional publications enable users to control the behavior of partition switching in a replicated environment:</span></span>  
  
-   <span data-ttu-id="09692-153">\*\* \@ allow_partition_switch\*\*, se impostato su `true` , è possibile eseguire switch Partition sul database di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="09692-153">**\@allow_partition_switch**, when set to `true`, SWITCH PARTITION can be executed against the publication database.</span></span>  
  
-   <span data-ttu-id="09692-154">\*\* \@ replicate_partition_switch\*\* determina se l'istruzione switch Partition DDL deve essere replicata nei Sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="09692-154">**\@replicate_partition_switch** determines whether the SWITCH PARTITION DDL statement should be replicated to Subscribers.</span></span> <span data-ttu-id="09692-155">Questa opzione è valida solo quando \*\* \@ allow_partition_switch\*\* è impostato su `true` .</span><span class="sxs-lookup"><span data-stu-id="09692-155">This option is valid only when **\@allow_partition_switch** is set to `true`.</span></span>  
  
 <span data-ttu-id="09692-156">È possibile impostare queste proprietà utilizzando [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql) durante la creazione della pubblicazione oppure [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) al termine della creazione della pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="09692-156">You can set these properties by using [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql) when the publication is created, or by using [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) after the publication is created.</span></span> <span data-ttu-id="09692-157">Come notato in precedenza, la replica di tipo merge non supporta il cambio della partizione.</span><span class="sxs-lookup"><span data-stu-id="09692-157">As noted earlier, merge replication does not support partition switching.</span></span> <span data-ttu-id="09692-158">Per eseguire SWITCH PARTITION in una tabella abilitata per la replica di tipo merge, rimuovere la tabella dalla pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="09692-158">To execute SWITCH PARTITION on a table that is enabled for merge replication, remove the table from the publication.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="09692-159">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="09692-159">See Also</span></span>  
 [<span data-ttu-id="09692-160">Pubblicare dati e oggetti di database</span><span class="sxs-lookup"><span data-stu-id="09692-160">Publish Data and Database Objects</span></span>](publish-data-and-database-objects.md)  
  
  
