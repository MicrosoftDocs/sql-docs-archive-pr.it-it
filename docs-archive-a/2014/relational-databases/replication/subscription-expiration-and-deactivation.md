---
title: Scadenza e disattivazione delle sottoscrizioni | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Distributors [SQL Server replication], distribution retention period
- subscriptions [SQL Server replication], expiration
- publications [SQL Server replication], publication retention periods
- expiration [SQL Server replication]
- retention periods [SQL Server replication]
- publication retention periods
- distribution retention period
- subscriptions [SQL Server replication], deactivation
- deactivating subscriptions
ms.assetid: 4d03f5ab-e721-4f56-aebc-60f6a56c1e07
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6d81e8b5c02fcfe5399be9e63c8160036a999547
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87724472"
---
# <a name="subscription-expiration-and-deactivation"></a><span data-ttu-id="cd547-102">Scadenza e disattivazione delle sottoscrizioni</span><span class="sxs-lookup"><span data-stu-id="cd547-102">Subscription Expiration and Deactivation</span></span>
  <span data-ttu-id="cd547-103">Le sottoscrizioni possono essere disattivate o scadere se non vengono sincronizzate entro il *periodo di memorizzazione*specificato.</span><span class="sxs-lookup"><span data-stu-id="cd547-103">Subscriptions can be deactivated or can expire if they are not synchronized within a specified *retention period*.</span></span> <span data-ttu-id="cd547-104">Vengono eseguite azioni diverse a seconda del tipo di replica e del periodo di memorizzazione scaduto.</span><span class="sxs-lookup"><span data-stu-id="cd547-104">The action that occurs depends on the type of replication and the retention period that is exceeded.</span></span>  
  
 <span data-ttu-id="cd547-105">Per impostare i periodi di memorizzazione, vedere [Impostare il periodo di scadenza per le sottoscrizioni](publish/set-the-expiration-period-for-subscriptions.md), [Impostare il periodo di memorizzazione per la distribuzione per le pubblicazioni transazionali &#40;SQL Server Management Studio&#41;](set-distribution-retention-period-for-transactional-publications.md), e [Configurare la pubblicazione e la distribuzione](configure-publishing-and-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="cd547-105">To set retention periods, see [Set the Expiration Period for Subscriptions](publish/set-the-expiration-period-for-subscriptions.md), [Set the Distribution Retention Period for Transactional Publications &#40;SQL Server Management Studio&#41;](set-distribution-retention-period-for-transactional-publications.md), and [Configure Publishing and Distribution](configure-publishing-and-distribution.md).</span></span>  
  
## <a name="transactional-replication"></a><span data-ttu-id="cd547-106">Replica transazionale</span><span class="sxs-lookup"><span data-stu-id="cd547-106">Transactional Replication</span></span>  
 <span data-ttu-id="cd547-107">La replica transazionale utilizza il periodo di memorizzazione massimo per la distribuzione (il **@max_distretention** parametro di [sp_adddistributiondb &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql)) e il periodo di memorizzazione della pubblicazione (il **@retention** parametro di [sp_addpublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql)):</span><span class="sxs-lookup"><span data-stu-id="cd547-107">Transactional replication uses the maximum distribution retention period (the **@max_distretention** parameter of [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql)) and the publication retention period (the **@retention** parameter of [sp_addpublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql)):</span></span>  
  
-   <span data-ttu-id="cd547-108">Se una sottoscrizione non è stata sincronizzata entro il periodo massimo di memorizzazione per la distribuzione (72 ore per impostazione predefinita) e nel database di distribuzione sono presenti modifiche che non sono state recapitate al Sottoscrittore, la sottoscrizione viene contrassegnata come disattivata dal processo **Eliminazione del contenuto della distribuzione** in esecuzione nel server di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="cd547-108">If a subscription is not synchronized within the maximum distribution retention period (default of 72 hours) and there are changes in the distribution database that have not been delivered to the Subscriber, the subscription will be marked deactivated by the **Distribution clean up** job that runs on the Distributor.</span></span> <span data-ttu-id="cd547-109">La sottoscrizione deve essere reinizializzata.</span><span class="sxs-lookup"><span data-stu-id="cd547-109">The subscription must be reinitialized.</span></span>  
  
-   <span data-ttu-id="cd547-110">Se una sottoscrizione non è stata sincronizzata entro il periodo di memorizzazione per la pubblicazione (336 ore per impostazione predefinita), la sottoscrizione scade e viene eliminata dal processo **Pulizia dei riferimenti alla sottoscrizione scaduta** in esecuzione nel server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="cd547-110">If a subscription is not synchronized within the publication retention period (default of 336 hours), the subscription will expire and be dropped by the **Expired subscription clean up** job that runs on the Publisher.</span></span> <span data-ttu-id="cd547-111">La sottoscrizione deve essere ricreata e sincronizzata.</span><span class="sxs-lookup"><span data-stu-id="cd547-111">The subscription must be recreated and synchronized.</span></span>  
  
     <span data-ttu-id="cd547-112">Se una sottoscrizione push scade, viene completamente rimossa, a differenza delle sottoscrizioni pull,</span><span class="sxs-lookup"><span data-stu-id="cd547-112">If a push subscription expires, it is completely removed, but pull subscriptions are not.</span></span> <span data-ttu-id="cd547-113">che devono essere eliminate nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="cd547-113">You must clean up pull subscriptions at the Subscriber.</span></span> <span data-ttu-id="cd547-114">Per altre informazioni, vedere [Delete a Pull Subscription](delete-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="cd547-114">For more information, see [Delete a Pull Subscription](delete-a-pull-subscription.md).</span></span>  
  
## <a name="merge-replication"></a><span data-ttu-id="cd547-115">Replica di tipo merge</span><span class="sxs-lookup"><span data-stu-id="cd547-115">Merge Replication</span></span>  
 <span data-ttu-id="cd547-116">La replica di tipo merge utilizza il periodo di memorizzazione della pubblicazione (i **@retention** **@retention_period_unit** parametri e di [Sp_addmergepublication &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="cd547-116">Merge replication uses the publication retention period (the **@retention** and **@retention_period_unit** parameters of [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)).</span></span> <span data-ttu-id="cd547-117">Se una sottoscrizione è scaduta, è necessario reinizializzarla, poiché i relativi metadati vengono rimossi.</span><span class="sxs-lookup"><span data-stu-id="cd547-117">When a subscription expires, it must be reinitialized, because metadata for the subscription is removed.</span></span> <span data-ttu-id="cd547-118">Le sottoscrizioni che non vengono reinizializzate vengono rimosse mediante il processo **Pulizia dei riferimenti alla sottoscrizione scaduta** eseguito sul server di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="cd547-118">Subscriptions that are not reinitialized are dropped by the **Expired subscription clean up** job that runs on the Publisher.</span></span> <span data-ttu-id="cd547-119">Per impostazione predefinita, questo processo viene eseguito ogni giorno e rimuove tutte le sottoscrizioni push che non sono state sincronizzate per il doppio della durata del periodo di memorizzazione per la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="cd547-119">By default, this job runs daily; it removes all push subscriptions that have not synchronized for double the length of the publication retention period.</span></span> <span data-ttu-id="cd547-120">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="cd547-120">For example:</span></span>  
  
-   <span data-ttu-id="cd547-121">Se una pubblicazione ha un periodo di memorizzazione di 14 giorni, una sottoscrizione può scadere se non è stata sincronizzata entro 14 giorni.</span><span class="sxs-lookup"><span data-stu-id="cd547-121">If a publication has a retention period of 14 days, a subscription can expire if it has not synchronized within 14 days.</span></span>  
  
     <span data-ttu-id="cd547-122">Se il server di pubblicazione esegue [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] o una versione successiva e l'agente per la sottoscrizione appartiene a [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] o a una versione successiva, una sottoscrizione scade solo se sono state apportate modifiche ai dati nella relativa partizione.</span><span class="sxs-lookup"><span data-stu-id="cd547-122">If the Publisher is running [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or a later version and the agent for the subscription is from [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or a later version, a subscription only expires if there have been changes to the data in that subscription's partition.</span></span> <span data-ttu-id="cd547-123">Ad esempio, si supponga che un Sottoscrittore riceva dati relativi solo ai clienti residenti in Germania.</span><span class="sxs-lookup"><span data-stu-id="cd547-123">For example, suppose a Subscriber receives customer data only for customers in Germany.</span></span> <span data-ttu-id="cd547-124">Se il periodo di memorizzazione impostato è pari 14 giorni, la sottoscrizione scade il 14° giorno solo se sono state apportate modifiche ai dati dei clienti tedeschi negli ultimi 14 giorni.</span><span class="sxs-lookup"><span data-stu-id="cd547-124">If the retention period is set to 14 days, the subscription expires on day 14 only if there have been changes to the German customer data in the last 14 days.</span></span>  
  
-   <span data-ttu-id="cd547-125">È possibile reinizializzare la sottoscrizione da 14 a 27 giorni dopo l'ultima sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="cd547-125">From 14 days to 27 days after the last synchronization, the subscription can be reinitialized.</span></span>  
  
-   <span data-ttu-id="cd547-126">Dopo 28 giorni dall'ultima sincronizzazione, la sottoscrizione viene rimossa mediante il processo **Pulizia dei riferimenti alla sottoscrizione scaduta** .</span><span class="sxs-lookup"><span data-stu-id="cd547-126">At 28 days after the last synchronization, the subscription is dropped by the **Expired subscription clean up** job.</span></span> <span data-ttu-id="cd547-127">Se una sottoscrizione push scade, viene completamente rimossa, a differenza delle sottoscrizioni pull,</span><span class="sxs-lookup"><span data-stu-id="cd547-127">If a push subscription expires, it is completely removed, but pull subscriptions are not.</span></span> <span data-ttu-id="cd547-128">che devono essere eliminate nel Sottoscrittore.</span><span class="sxs-lookup"><span data-stu-id="cd547-128">You must clean up pull subscriptions at the Subscriber.</span></span> <span data-ttu-id="cd547-129">Per altre informazioni, vedere [Delete a Pull Subscription](delete-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="cd547-129">For more information, see [Delete a Pull Subscription](delete-a-pull-subscription.md).</span></span>  
  
### <a name="considerations-for-setting-the-publication-retention-period-for-merge-publications"></a><span data-ttu-id="cd547-130">Considerazioni sull'impostazione del periodo di memorizzazione per la pubblicazione per le pubblicazioni di tipo merge</span><span class="sxs-lookup"><span data-stu-id="cd547-130">Considerations for Setting the Publication Retention Period for Merge Publications</span></span>  
 <span data-ttu-id="cd547-131">Tenere sempre presenti le considerazioni seguenti nell'impostazione del periodo di memorizzazione per le pubblicazioni di tipo merge:</span><span class="sxs-lookup"><span data-stu-id="cd547-131">Keep the following considerations in mind when setting the retention period for merge publications:</span></span>  
  
-   <span data-ttu-id="cd547-132">Il periodo di memorizzazione per le pubblicazioni di tipo merge ha un periodo di prova di 24 ore per adattarsi ai Sottoscrittori dei diversi fusi orari.</span><span class="sxs-lookup"><span data-stu-id="cd547-132">The retention period for merge publications has a 24-hour grace period to accommodate Subscribers in different time zones.</span></span> <span data-ttu-id="cd547-133">Se, ad esempio, si imposta un periodo di memorizzazione di un giorno, il periodo di memorizzazione effettivo sarà di 48 ore.</span><span class="sxs-lookup"><span data-stu-id="cd547-133">If, for example, you set a retention period of one day, the actual retention period is 48 hours.</span></span>  
  
-   <span data-ttu-id="cd547-134">La pulizia dei metadati di replica di tipo merge dipende dal periodo di memorizzazione per la pubblicazione:</span><span class="sxs-lookup"><span data-stu-id="cd547-134">Cleanup of merge replication metadata is dependent on the publication retention period:</span></span>  
  
    -   <span data-ttu-id="cd547-135">La replica non è in grado di eliminare i metadati dei database di pubblicazione e sottoscrizione prima della scadenza del periodo di memorizzazione.</span><span class="sxs-lookup"><span data-stu-id="cd547-135">Replication cannot clean up metadata in the publication and subscription databases until the retention period is reached.</span></span> <span data-ttu-id="cd547-136">Quando si imposta un valore elevato per il periodo di memorizzazione, verificare che non sia tale da avere effetti negativi sulle prestazioni della replica.</span><span class="sxs-lookup"><span data-stu-id="cd547-136">Use caution in specifying a high value for the retention period, because it can negatively impact replication performance.</span></span> <span data-ttu-id="cd547-137">Se si prevede che la sincronizzazione di tutti i Sottoscrittori verrà eseguita regolarmente entro tale periodo di tempo, è consigliabile specificare un valore inferiore.</span><span class="sxs-lookup"><span data-stu-id="cd547-137">It is recommended that you use a lower setting if you can reliably predict that all Subscribers will synchronize regularly within that time period.</span></span>  
  
    -   <span data-ttu-id="cd547-138">È possibile specificare che le sottoscrizioni non scadono mai (un valore pari a 0 per **@retention** ), ma è consigliabile non utilizzare questo valore, poiché i metadati non possono essere eliminati.</span><span class="sxs-lookup"><span data-stu-id="cd547-138">It is possible to specify that subscriptions never expire (a value of 0 for **@retention**), but it is strongly recommended that you do not use this value, because metadata cannot be cleaned up.</span></span>  
  
-   <span data-ttu-id="cd547-139">Il periodo di memorizzazione per i server di ripubblicazione deve essere impostato su un valore uguale o minore del periodo di memorizzazione impostato nel server di pubblicazione originale.</span><span class="sxs-lookup"><span data-stu-id="cd547-139">The retention period for any republisher must be set to a value equal to or less than the retention period set at the original Publisher.</span></span> <span data-ttu-id="cd547-140">Impostare lo stesso periodo di memorizzazione delle pubblicazioni per tutti i server di pubblicazione e i relativi partner di sincronizzazione alternativi.</span><span class="sxs-lookup"><span data-stu-id="cd547-140">You should also use the same publication retention values for all Publishers and their alternate synchronization partners.</span></span> <span data-ttu-id="cd547-141">L'impostazione di periodi di memorizzazione diversi potrebbe causare la non convergenza dei dati.</span><span class="sxs-lookup"><span data-stu-id="cd547-141">Using different values may lead to non-convergence.</span></span> <span data-ttu-id="cd547-142">Se è necessario modificare il periodo di memorizzazione della pubblicazione, reinizializzare manualmente il Sottoscrittore per evitare la non convergenza dei dati.</span><span class="sxs-lookup"><span data-stu-id="cd547-142">If you need to change the publication retention value, reinitialize the Subscriber to avoid the non-convergence of data.</span></span>  
  
-   <span data-ttu-id="cd547-143">Se, dopo la pulizia dei metadati, si incrementa il periodo di memorizzazione della pubblicazione e una sottoscrizione tenta di eseguire il merge con il server di pubblicazione (in cui i metadati sono già stati eliminati), a causa dell'incremento del periodo di memorizzazione la sottoscrizione non scadrà.</span><span class="sxs-lookup"><span data-stu-id="cd547-143">If, after a clean up, the publication retention period is increased and a subscription tries to merge with the Publisher (which has already deleted the metadata), the subscription will not expire because of the increased retention value.</span></span> <span data-ttu-id="cd547-144">Tuttavia, il server di pubblicazione non dispone di metadati sufficienti per scaricare le modifiche al Sottoscrittore e si avrà pertanto una situazione di non convergenza.</span><span class="sxs-lookup"><span data-stu-id="cd547-144">However, the Publisher does not have enough metadata to download changes to the Subscriber, which leads to non-convergence.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cd547-145">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="cd547-145">See Also</span></span>  
 <span data-ttu-id="cd547-146">[Reinizializzare le sottoscrizioni](reinitialize-subscriptions.md) </span><span class="sxs-lookup"><span data-stu-id="cd547-146">[Reinitialize Subscriptions](reinitialize-subscriptions.md) </span></span>  
 <span data-ttu-id="cd547-147">[Amministrazione dell'agente di replica](agents/replication-agent-administration.md) </span><span class="sxs-lookup"><span data-stu-id="cd547-147">[Replication Agent Administration](agents/replication-agent-administration.md) </span></span>  
 [<span data-ttu-id="cd547-148">Sottoscrizione delle pubblicazioni</span><span class="sxs-lookup"><span data-stu-id="cd547-148">Subscribe to Publications</span></span>](subscribe-to-publications.md)  
  
  
