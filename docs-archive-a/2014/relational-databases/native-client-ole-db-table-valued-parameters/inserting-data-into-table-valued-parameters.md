---
title: Inserimento di dati in parametri con valori di tabella | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters, inserting data into
ms.assetid: 9c1a3234-4675-40d3-b473-8df06208f880
author: rothja
ms.author: jroth
ms.openlocfilehash: 38e33c6e58bc2633591fa80e095ceafe46f67045
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87626741"
---
# <a name="inserting-data-into-table-valued-parameters"></a><span data-ttu-id="20da4-102">Inserimento di dati in parametri con valori di tabella</span><span class="sxs-lookup"><span data-stu-id="20da4-102">Inserting Data into Table-Valued Parameters</span></span>
  <span data-ttu-id="20da4-103">Il [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provider di OLE DB di Native Client supporta due modelli che consentono al consumer di specificare i dati per le righe di parametri con valori di tabella: un modello push e un modello pull.</span><span class="sxs-lookup"><span data-stu-id="20da4-103">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider supports two models for the consumer to specify data for table valued parameter rows: a push model and a pull model.</span></span> <span data-ttu-id="20da4-104">Per un esempio in cui viene illustrato il modello pull, vedere la pagina relativa agli [esempi di programmazione dati di SQL Server](https://msftdpprodsamples.codeplex.com/).</span><span class="sxs-lookup"><span data-stu-id="20da4-104">A sample that demonstrates the pull model is available; see [SQL Server Data Programming Samples](https://msftdpprodsamples.codeplex.com/).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="20da4-105">Una colonna di parametri con valori di tabella deve includere valori non predefiniti in tutte le righe o valori predefiniti in tutte le righe.</span><span class="sxs-lookup"><span data-stu-id="20da4-105">A table-valued parameter column must have either non-default values in all rows or default values in all rows.</span></span> <span data-ttu-id="20da4-106">Non è possibile che vi siano valori predefiniti in alcune righe e non in altre.</span><span class="sxs-lookup"><span data-stu-id="20da4-106">It is not possible to have default values in some rows but not others.</span></span> <span data-ttu-id="20da4-107">Nelle associazioni di parametri con valori di tabella, pertanto, gli unici valori di stato consentiti per i dati di colonna dei set di righe di parametri con valori di tabella sono DBSTATUS_S_ISNULL e DBSTATUS_S_OK.</span><span class="sxs-lookup"><span data-stu-id="20da4-107">Therefore, in table-valued parameter bindings, the only status values allowed for table-valued parameter rowset column data are DBSTATUS_S_ISNULL and DBSTATUS_S_OK.</span></span> <span data-ttu-id="20da4-108">DBSTATUS_S_DEFAULT comporteranno un errore e il valore di stato associato verrà impostato su DBSTATUS_E_BADSTATUS.</span><span class="sxs-lookup"><span data-stu-id="20da4-108">DBSTATUS_S_DEFAULT will result in a failure and the bound status value will be set to DBSTATUS_E_BADSTATUS.</span></span>  
  
## <a name="push-model-loads-all-table-valued-paremeter-data-in-memory"></a><span data-ttu-id="20da4-109">Modello push (carica in memoria tutti i dati dei parametri con valori di tabella)</span><span class="sxs-lookup"><span data-stu-id="20da4-109">Push Model (Loads All Table-Valued Paremeter Data in Memory)</span></span>  
 <span data-ttu-id="20da4-110">L'uso del modello push è simile all'uso di set di parametri, ovvero del parametro DBPARAMS in ICommand::Execute.</span><span class="sxs-lookup"><span data-stu-id="20da4-110">The push model is similar to the use of parameter sets (that is, the DBPARAMS parameter in ICommand::Execute).</span></span> <span data-ttu-id="20da4-111">Il modello push viene usato solo se gli oggetti set di righe di parametri con valori di tabella vengono usati senza un'implementazione personalizzata delle interfacce IRowset.</span><span class="sxs-lookup"><span data-stu-id="20da4-111">The push model is only used if table-valued parameter rowset objects are used without a customized implementation of IRowset interfaces.</span></span> <span data-ttu-id="20da4-112">Il modello push è consigliabile quando il numero di righe nel set di righe di parametri con valori di tabella è ridotto e non si prevede un utilizzo elevato della memoria nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="20da4-112">The push model is recommended when the number of rows in the table-valued parameter rowset is small and is not expected to put excessive memory pressure on the application.</span></span> <span data-ttu-id="20da4-113">Questo modello è più semplice del modello pull, in quanto non richiede altre funzionalità dall'applicazione consumer rispetto a quelle comuni normalmente utilizzate nelle applicazioni OLE DB tipiche.</span><span class="sxs-lookup"><span data-stu-id="20da4-113">This is simpler than the pull model, because it does not require any more functionality from the consumer application than what is currently common in typical OLE DB applications.</span></span>  
  
 <span data-ttu-id="20da4-114">In genere il consumer fornisce al provider tutti i dati dei parametri con valori di tabella prima di eseguire un comando.</span><span class="sxs-lookup"><span data-stu-id="20da4-114">The consumer is expected to provide all the table-valued parameter data to the provider before executing a command.</span></span> <span data-ttu-id="20da4-115">Per fornire i dati, il consumer popola un oggetto set di righe di parametri con valori di tabella per ogni parametro con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="20da4-115">To provide the data, the consumer populates a table-valued parameter rowset object for each table-valued parameter.</span></span> <span data-ttu-id="20da4-116">L'oggetto set di righe di parametri con valori di tabella espone operazioni Insert, Set e Delete per il set di righe che verranno utilizzate dal consumer per modificare i dati dei parametri con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="20da4-116">The table-valued parameter rowset object exposes rowset Insert, Set, and Delete operations, which the consumer will use to manipulate the table-valued parameter data.</span></span> <span data-ttu-id="20da4-117">Il provider recupererà i dati da questo oggetto set di righe di parametri con valori di tabella in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="20da4-117">The provider will fetch the data from this table-valued parameter rowset object at execution time.</span></span>  
  
 <span data-ttu-id="20da4-118">Quando al consumer viene fornito un oggetto set di righe di parametri con valori di tabella, il consumer può elaborarlo come oggetto set di righe.</span><span class="sxs-lookup"><span data-stu-id="20da4-118">When a table-valued parameter rowset object is provided to the consumer, the consumer can process it as a rowset object.</span></span> <span data-ttu-id="20da4-119">Il consumer può ottenere le informazioni sul tipo per ogni colonna, ovvero tipo, lunghezza massima, precisione e scala, utilizzando il metodo di interfaccia IColumnsInfo::GetColumnInfo or IColumnsRowset::GetColumnsRowset.</span><span class="sxs-lookup"><span data-stu-id="20da4-119">The consumer can obtain the type information of each column (type, maximum length, precision, and scale) by using the IColumnsInfo::GetColumnInfo or IColumnsRowset::GetColumnsRowset interface method.</span></span> <span data-ttu-id="20da4-120">Il consumer crea quindi una funzione di accesso per specificare le associazioni per i dati.</span><span class="sxs-lookup"><span data-stu-id="20da4-120">The consumer then creates an accessor to specify the bindings for the data.</span></span> <span data-ttu-id="20da4-121">Il passaggio successivo consiste nell'inserire righe di dati nel set di righe di parametri con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="20da4-121">The next step is to insert rows of data into the table-valued parameter rowset.</span></span> <span data-ttu-id="20da4-122">A tale scopo, è possibile usare IRowsetChange::InsertRow.</span><span class="sxs-lookup"><span data-stu-id="20da4-122">This can be done by using IRowsetChange::InsertRow.</span></span> <span data-ttu-id="20da4-123">È inoltre possibile usare IRowsetChange::SetData o IRowsetChange::DeleteRows nell'oggetto set di righe di parametri con valori di tabella nel caso in cui sia necessario modificare i dati.</span><span class="sxs-lookup"><span data-stu-id="20da4-123">IRowsetChange::SetData or IRowsetChange::DeleteRows can also be used on the table-valued parameter rowset object if you have to manipulate the data.</span></span> <span data-ttu-id="20da4-124">Gli oggetti set di righe di parametri con valori di tabella sono soggetti a conteggio dei riferimenti, analogamente agli oggetti di flusso.</span><span class="sxs-lookup"><span data-stu-id="20da4-124">Table-valued parameter rowset objects are reference counted, similar to stream objects.</span></span>  
  
 <span data-ttu-id="20da4-125">Se si usa IColumnsRowset::GetColumnsRowset, verranno effettuate chiamate successive ai metodi IRowset::GetNextRows, IRowset::GetData e IRowset::ReleaseRows nell'oggetto set di righe della colonna risultante.</span><span class="sxs-lookup"><span data-stu-id="20da4-125">If IColumnsRowset::GetColumnsRowset is used, there will be subsequent calls to IRowset::GetNextRows, IRowset::GetData, and IRowset::ReleaseRows methods on the rowset object of the resulting column.</span></span>  
  
 <span data-ttu-id="20da4-126">Al termine dell' [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] esecuzione del comando da parte del Provider OLE DB di Native client, i valori dei parametri con valori di tabella verranno recuperati da questo oggetto set di righe di parametri con valori di tabella e inviati al server.</span><span class="sxs-lookup"><span data-stu-id="20da4-126">After the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider begins executing the command, the table-valued parameter values will be fetched from this table-valued parameter rowset object and sent to the server.</span></span>  
  
 <span data-ttu-id="20da4-127">Il modello push richiede attività minime da parte del consumer, ma utilizza una maggiore quantità di memoria rispetto al modello pull, in quanto tutti i dati dei parametri con valori di tabella devono essere presenti in memoria in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="20da4-127">The push model requires minimal work by the consumer, but uses more memory than the pull model, because all the table-valued parameter data has to be in memory at execution time.</span></span>  
  
## <a name="pull-model-obtaining-table-valued-parameter-data-on-demand-from-the-consumer"></a><span data-ttu-id="20da4-128">Modello pull (recupero di dati dei parametri con valori di tabella su richiesta dal consumer)</span><span class="sxs-lookup"><span data-stu-id="20da4-128">Pull Model (Obtaining Table-Valued Parameter Data on Demand from the Consumer)</span></span>  
 <span data-ttu-id="20da4-129">Il modello pull è utile per due scenari:</span><span class="sxs-lookup"><span data-stu-id="20da4-129">The pull model is useful for two scenarios:</span></span>  
  
-   <span data-ttu-id="20da4-130">Per eseguire il flusso di righe.</span><span class="sxs-lookup"><span data-stu-id="20da4-130">To stream rows.</span></span>  
  
-   <span data-ttu-id="20da4-131">Se si utilizza un set di righe di un altro provider come valore di parametro con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="20da4-131">If a rowset from another provider is being used as the table-valued parameter value.</span></span>  
  
 <span data-ttu-id="20da4-132">Nel modello pull il consumer fornisce dati su richiesta al provider.</span><span class="sxs-lookup"><span data-stu-id="20da4-132">In the pull model, the consumer provides data on demand to the provider.</span></span> <span data-ttu-id="20da4-133">Utilizzare questo approccio se nell'applicazione vengono eseguiti molti inserimenti di dati, e i dati del set di righe di parametri con valori di tabella in memoria comporterebbero un eccessivo accesso alla memoria.</span><span class="sxs-lookup"><span data-stu-id="20da4-133">Use this approach if your application has many data insertions, and table-valued parameter rowset data in memory would result in excessive memory access.</span></span> <span data-ttu-id="20da4-134">Se si utilizzano più provider OLE DB, il modello pull del consumer consente al consumer di fornire qualsiasi oggetto set di righe come valore di parametro con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="20da4-134">If multiple OLE DB providers are used, the consumer pull model enables the consumer to provide any rowset object as the table-valued parameter value.</span></span>  
  
 <span data-ttu-id="20da4-135">Per utilizzare il modello pull, i consumer devono specificare l'implementazione personalizzata di un oggetto set di righe.</span><span class="sxs-lookup"><span data-stu-id="20da4-135">To use the pull model, consumers have to provide their own implementation of a rowset object.</span></span> <span data-ttu-id="20da4-136">Quando si utilizza il modello pull con set di righe di parametri con valori di tabella (CLSID_ROWSET_TVP), al consumer viene richiesto di aggregare l'oggetto set di righe di parametri con valori di tabella esposto dal provider tramite il metodo ITableDefinitionWithConstraints::CreateTableWithConstraints method o IOpenRowset::OpenRowset.</span><span class="sxs-lookup"><span data-stu-id="20da4-136">When using the pull model with table-valued parameter rowsets (CLSID_ROWSET_TVP), the consumer is required to aggregate the table-valued parameter rowset object that the provider exposes through the ITableDefinitionWithConstraints::CreateTableWithConstraints method or the IOpenRowset::OpenRowset method.</span></span> <span data-ttu-id="20da4-137">Il comportamento previsto per l'oggetto consumer consiste esclusivamente nel sostituire l'implementazione dell'interfaccia IRowset.</span><span class="sxs-lookup"><span data-stu-id="20da4-137">The consumer object is only expected to override the IRowset interface implementation.</span></span> <span data-ttu-id="20da4-138">È necessario sostituire le funzioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="20da4-138">You must override the following functions:</span></span>  
  
-   <span data-ttu-id="20da4-139">IRowset::GetNextRows</span><span class="sxs-lookup"><span data-stu-id="20da4-139">IRowset::GetNextRows</span></span>  
  
-   <span data-ttu-id="20da4-140">IRowset::AddRefRows</span><span class="sxs-lookup"><span data-stu-id="20da4-140">IRowset::AddRefRows</span></span>  
  
-   <span data-ttu-id="20da4-141">IRowset::GetData</span><span class="sxs-lookup"><span data-stu-id="20da4-141">IRowset::GetData</span></span>  
  
-   <span data-ttu-id="20da4-142">IRowset::ReleaseRows</span><span class="sxs-lookup"><span data-stu-id="20da4-142">IRowset::ReleaseRows</span></span>  
  
-   <span data-ttu-id="20da4-143">IRowset::RestartPosition</span><span class="sxs-lookup"><span data-stu-id="20da4-143">IRowset::RestartPosition</span></span>  
  
 <span data-ttu-id="20da4-144">Il provider OLE DB per [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client leggerà una o più righe per volta dall'oggetto set di righe del consumer per supportare l'esecuzione del flusso in parametri con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="20da4-144">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider will read one or more rows at a time from the consumer rowset object to support streaming behavior in table-valued parameters.</span></span> <span data-ttu-id="20da4-145">L'utente, ad esempio, potrebbe disporre dei dati dei set di righe di parametri con valori di tabella su disco (non in memoria) e implementare la funzionalità di lettura dei dati dal disco se richiesto dal provider OLE DB per [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client.</span><span class="sxs-lookup"><span data-stu-id="20da4-145">For example, the user might have the table-valued parameter rowset data on disk (not in memory) and might implement the functionality to read data from the disk when required by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider.</span></span>  
  
 <span data-ttu-id="20da4-146">Il consumer comunicherà il formato dei dati a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider utilizzando IAccessor:: CreateAccessor nell'oggetto set di righe di parametri con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="20da4-146">The consumer will communicate its data format to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider by using IAccessor::CreateAccessor on the table-valued parameter rowset object.</span></span> <span data-ttu-id="20da4-147">Durante la lettura dei dati dal buffer del consumer, il provider verifica che tutte le colonne accessibili in scrittura e non predefinite siano disponibili tramite almeno un handle della funzione di accesso e utilizza gli handle corrispondenti per leggere i dati delle colonne.</span><span class="sxs-lookup"><span data-stu-id="20da4-147">When reading data from the consumer buffer, the provider verifies that all the writable and non-default columns are available through at least one accessor handle, and uses the corresponding handles to read columns data.</span></span> <span data-ttu-id="20da4-148">Per evitare ambiguità, deve essere presente una corrispondenza uno-a-uno tra una colonna del set di righe di parametri con valori di tabella e un'associazione.</span><span class="sxs-lookup"><span data-stu-id="20da4-148">To avoid ambiguity, there should be a one-to-one correspondence between a table-valued parameter rowset column and a binding.</span></span> <span data-ttu-id="20da4-149">Associazioni duplicate alla stessa colonna comporteranno un errore.</span><span class="sxs-lookup"><span data-stu-id="20da4-149">Duplicate bindings to the same column will result in an error.</span></span> <span data-ttu-id="20da4-150">Per ogni funzione di accesso, inoltre, il membro *iOrdinal* di DBBindings deve essere in sequenza.</span><span class="sxs-lookup"><span data-stu-id="20da4-150">Also, each accessor is expected to have the *iOrdinal* member of DBBindings in sequence.</span></span> <span data-ttu-id="20da4-151">Verranno eseguite tante chiamate a IRowset::GetData quanto è il numero di funzioni di accesso per riga e l'ordine delle chiamate sarà basato sull'ordine del valore *iOrdinal*, dai valori inferiori a quelli superiori.</span><span class="sxs-lookup"><span data-stu-id="20da4-151">There will be as many calls to IRowset::GetData as the number of accessors per row, and the order of calls will be based on the order of *iOrdinal* value from lower to higher values.</span></span>  
  
 <span data-ttu-id="20da4-152">Il comportamento previsto del provider consiste nell'implementare la maggior parte delle interfacce esposte dall'oggetto set di righe di parametri con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="20da4-152">The provider is expected to implement most of the interfaces exposed by the table-valued parameter rowset object.</span></span> <span data-ttu-id="20da4-153">Il consumer implementerà un oggetto set di righe con interfacce minime (IRowset).</span><span class="sxs-lookup"><span data-stu-id="20da4-153">The consumer will implement a rowset object with minimal interfaces (IRowset).</span></span> <span data-ttu-id="20da4-154">A causa dell'aggregazione nascosta, le interfacce obbligatorie rimanenti dell'oggetto set di righe verranno implementate dall'oggetto set di righe di parametri con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="20da4-154">Because of blind aggregation, the remaining mandatory rowset object interfaces will be implemented by the table-valued parameter rowset object.</span></span>  
  
 <span data-ttu-id="20da4-155">Per qualsiasi altro oggetto set di righe, ad esempio gli oggetti set di righe ottenuti per qualunque provider OLE DB, il set di righe fornito dal consumer deve implementare tutte le interfacce dell'oggetto set di righe obbligatorie in base a quanto indicato dalla specifica OLE DB.</span><span class="sxs-lookup"><span data-stu-id="20da4-155">For any other rowset object, such as rowset objects obtained for any OLE DB provider, the consumer-provided rowset must implement all the mandatory rowset object interfaces as specified in the OLE DB specification.</span></span>  
  
 <span data-ttu-id="20da4-156">In fase di esecuzione, il provider OLE DB per [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client richiamerà l'oggetto set di righe per recuperare righe e leggere i dati delle colonne.</span><span class="sxs-lookup"><span data-stu-id="20da4-156">At the time of execution, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider will call back to the rowset object to fetch rows and read column data.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="20da4-157">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="20da4-157">See Also</span></span>  
 <span data-ttu-id="20da4-158">[Parametri con valori di tabella &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="20da4-158">[Table-Valued Parameters &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span></span>  
 [<span data-ttu-id="20da4-159">Usare parametri con valori di tabella &#40;OLE DB&#41;</span><span class="sxs-lookup"><span data-stu-id="20da4-159">Use Table-Valued Parameters &#40;OLE DB&#41;</span></span>](../native-client-ole-db-how-to/use-table-valued-parameters-ole-db.md)  
  
