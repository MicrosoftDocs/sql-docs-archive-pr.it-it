---
title: Change Data Capture e altre funzionalità di SQL Server | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data capture [SQL Server], other SQL Server features and
ms.assetid: 7dfcb362-1904-4578-8274-da16681a960e
author: rothja
ms.author: jroth
ms.openlocfilehash: acafd5ba49bec92fd4c6b93c4163affaa42ab7f1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87630392"
---
# <a name="change-data-capture-and-other-sql-server-features"></a><span data-ttu-id="49a84-102">Change Data Capture e altre funzionalità di SQL Server</span><span class="sxs-lookup"><span data-stu-id="49a84-102">Change Data Capture and Other SQL Server Features</span></span>
  <span data-ttu-id="49a84-103">In questo argomento viene descritta l'interazione tra Change Data Capture e le funzionalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="49a84-103">This topic describes how the following features interact with change data capture:</span></span>  
  
-   [<span data-ttu-id="49a84-104">Change tracking</span><span class="sxs-lookup"><span data-stu-id="49a84-104">Change tracking</span></span>](#ChangeTracking)  
  
-   [<span data-ttu-id="49a84-105">Mirroring del database</span><span class="sxs-lookup"><span data-stu-id="49a84-105">Database mirroring</span></span>](#DatabaseMirroring)  
  
-   [<span data-ttu-id="49a84-106">Replica transazionale</span><span class="sxs-lookup"><span data-stu-id="49a84-106">Transactional replication</span></span>](#TransReplication)  
  
-   [<span data-ttu-id="49a84-107">Ripristino o collegamento di un database abilitato per Change Data Capture</span><span class="sxs-lookup"><span data-stu-id="49a84-107">Restoring or Attaching a Database Enabled for Change Data Capture</span></span>](#RestoreOrAttach)  
  
##  <a name="change-tracking"></a><a name="ChangeTracking"></a> <span data-ttu-id="49a84-108">Rilevamento delle modifiche</span><span class="sxs-lookup"><span data-stu-id="49a84-108">Change Tracking</span></span>  
 <span data-ttu-id="49a84-109">Le funzionalità Change Data Capture e [rilevamento modifiche](about-change-tracking-sql-server.md) possono essere abilitate nello stesso database.</span><span class="sxs-lookup"><span data-stu-id="49a84-109">Change data capture and [change tracking](about-change-tracking-sql-server.md) can be enabled on the same database.</span></span> <span data-ttu-id="49a84-110">Non richiedono considerazioni particolari.</span><span class="sxs-lookup"><span data-stu-id="49a84-110">No special considerations are required.</span></span> <span data-ttu-id="49a84-111">Per altre informazioni, vedere [Usare il rilevamento delle modifiche &#40;SQL Server&#41;](work-with-change-tracking-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="49a84-111">For more information, see [Work with Change Tracking &#40;SQL Server&#41;](work-with-change-tracking-sql-server.md).</span></span>  
  
##  <a name="database-mirroring"></a><a name="DatabaseMirroring"></a> <span data-ttu-id="49a84-112">Mirroring del database</span><span class="sxs-lookup"><span data-stu-id="49a84-112">Database Mirroring</span></span>  
 <span data-ttu-id="49a84-113">È possibile eseguire il mirroring di un database per il quale la funzionalità Change Data Capture è abilitata.</span><span class="sxs-lookup"><span data-stu-id="49a84-113">A database that is enabled for change data capture can be mirrored.</span></span> <span data-ttu-id="49a84-114">Per assicurarsi che i processi di acquisizione e pulizia vengano eseguiti automaticamente dopo un failover, effettuare i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="49a84-114">To ensure that capture and cleanup happen automatically after a failover, follow these steps:</span></span>  
  
1.  <span data-ttu-id="49a84-115">Verificare che [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent sia in esecuzione nella nuova istanza del server principale.</span><span class="sxs-lookup"><span data-stu-id="49a84-115">Ensure that [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent is running on the new principal server instance.</span></span>  
  
2.  <span data-ttu-id="49a84-116">Creare i processi di acquisizione e di pulizia nel nuovo database principale (il database mirror precedente).</span><span class="sxs-lookup"><span data-stu-id="49a84-116">Create the capture job and cleanup job on the new principal database (the former mirror database).</span></span> <span data-ttu-id="49a84-117">Per creare i processi, usare la stored procedure [sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="49a84-117">To create the jobs, use the [sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) stored procedure.</span></span>  
  
 <span data-ttu-id="49a84-118">Per visualizzare la configurazione corrente di un processo di pulizia o di acquisizione, usare la stored procedure [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) nella nuova istanza del server principale.</span><span class="sxs-lookup"><span data-stu-id="49a84-118">To view the current configuration of a cleanup or capture job, use the [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) stored procedure on the new principal server instance.</span></span> <span data-ttu-id="49a84-119">Per un database specificato, il processo di acquisizione viene denominato cdc.*database_name*_capture e il processo di pulizia viene denominato cdc.*database_name*_cleanup, dove *database_name* è il nome del database.</span><span class="sxs-lookup"><span data-stu-id="49a84-119">For a given database, the capture job is named cdc.*database_name*_capture, and the cleanup job is named cdc.*database_name*_cleanup, where *database_name* is the name of the database.</span></span>  
  
 <span data-ttu-id="49a84-120">Per modificare la configurazione di un processo, usare la stored procedure [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="49a84-120">To change the configuration of a job, use the [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) stored procedure.</span></span>  
  
 <span data-ttu-id="49a84-121">Per informazioni sul mirroring del database, vedere [Mirroring del database &#40;SQL Server&#41;](../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="49a84-121">For information about database mirroring, see [Database Mirroring &#40;SQL Server&#41;](../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span></span>  
  
##  <a name="transactional-replication"></a><a name="TransReplication"></a><span data-ttu-id="49a84-122">Replica transazionale</span><span class="sxs-lookup"><span data-stu-id="49a84-122">Transactional Replication</span></span>  
 <span data-ttu-id="49a84-123">Le funzionalità Change Data Capture e replica transazionale possono coesistere nello stesso database, tuttavia il popolamento delle tabelle delle modifiche viene gestito in modo diverso se entrambe le funzionalità sono abilitate.</span><span class="sxs-lookup"><span data-stu-id="49a84-123">Change data capture and transactional replication can coexist in the same database, but population of the change tables is handled differently when both features are enabled.</span></span> <span data-ttu-id="49a84-124">Change Data Capture e la replica transazionale usano sempre la stessa stored procedure, [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql), per leggere le modifiche dal log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="49a84-124">Change data capture and transactional replication always use the same procedure, [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql), to read changes from the transaction log.</span></span> <span data-ttu-id="49a84-125">Quando Change Data Capture è la sola funzionalità abilitata, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent chiama `sp_replcmds`.</span><span class="sxs-lookup"><span data-stu-id="49a84-125">When change data capture is enabled on its own, a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job calls `sp_replcmds`.</span></span> <span data-ttu-id="49a84-126">Quando entrambe le funzionalità sono abilitate nello stesso database, il agente di lettura log chiama `sp_replcmds` .</span><span class="sxs-lookup"><span data-stu-id="49a84-126">When both features are enabled on the same database, the Log Reader Agent calls `sp_replcmds`.</span></span> <span data-ttu-id="49a84-127">Questo agente popola sia le tabelle delle modifiche sia le tabelle del database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="49a84-127">This agent populates both the change tables and the distribution database tables.</span></span> <span data-ttu-id="49a84-128">Per altre informazioni, vedere [Replication Log Reader Agent](../replication/agents/replication-log-reader-agent.md).</span><span class="sxs-lookup"><span data-stu-id="49a84-128">For more information, see [Replication Log Reader Agent](../replication/agents/replication-log-reader-agent.md).</span></span>  
  
 <span data-ttu-id="49a84-129">Si consideri uno scenario in cui la funzionalità Change Data Capture è abilitata nel database [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] e due tabelle sono abilitate per l'acquisizione.</span><span class="sxs-lookup"><span data-stu-id="49a84-129">Consider a scenario in which change data capture is enabled on the [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database, and two tables are enabled for capture.</span></span> <span data-ttu-id="49a84-130">Per popolare le tabelle delle modifiche, il processo di acquisizione chiama `sp_replcmds`.</span><span class="sxs-lookup"><span data-stu-id="49a84-130">To populate the change tables, the capture job calls `sp_replcmds`.</span></span> <span data-ttu-id="49a84-131">Il database viene abilitato per la replica transazionale e viene creata una pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="49a84-131">The database is enabled for transactional replication, and a publication is created.</span></span> <span data-ttu-id="49a84-132">L'agente di lettura log viene creato per il database e il processo di acquisizione viene eliminato.</span><span class="sxs-lookup"><span data-stu-id="49a84-132">Now, the Log Reader Agent is created for the database and the capture job is deleted.</span></span> <span data-ttu-id="49a84-133">L'agente di lettura log continua ad analizzare il log dall'ultimo numero di sequenza di cui è stato eseguito il commit nella tabella delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="49a84-133">The Log Reader Agent continues to scan the log from the last log sequence number that was committed to the change table.</span></span> <span data-ttu-id="49a84-134">In questo modo, viene assicurata la coerenza dei dati nelle tabelle delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="49a84-134">This ensures data consistency in the change tables.</span></span> <span data-ttu-id="49a84-135">Se la replica transazionale è disabilitata in questo database, l'agente di lettura log viene rimosso e il processo di acquisizione viene ricreato.</span><span class="sxs-lookup"><span data-stu-id="49a84-135">If transactional replication is disabled in this database, the Log Reader Agent is removed and the capture job is re-created.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="49a84-136">Quando l'agente di lettura log viene utilizzato sia per Change Data Capture sia per la replica transazionale, le modifiche replicate vengono innanzitutto scritte nel database di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="49a84-136">When the Log Reader Agent is used for both change data capture and transactional replication, replicated changes are first written to the distribution database.</span></span> <span data-ttu-id="49a84-137">Le modifiche acquisite vengono quindi scritte nelle tabelle delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="49a84-137">Then, captured changes are written to the change tables.</span></span> <span data-ttu-id="49a84-138">Il commit di entrambe le operazioni viene eseguito contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="49a84-138">Both operations are committed together.</span></span> <span data-ttu-id="49a84-139">Se si verifica della latenza durante la scrittura nel database di distribuzione, si verificherà latenza prima che le modifiche vengano visualizzate nelle tabelle delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="49a84-139">If there is any latency in writing to the distribution database, there will be a corresponding latency before changes appear in the change tables.</span></span>  
  
 <span data-ttu-id="49a84-140">L'opzione **proc exec** della replica transazionale non è disponibile quando l'acquisizione dati delle modifiche è abilitata.</span><span class="sxs-lookup"><span data-stu-id="49a84-140">The **proc exec** option of transactional replication is not available when change data capture is enabled.</span></span>  
  
##  <a name="restoring-or-attaching-a-database-enabled-for-change-data-capture"></a><a name="RestoreOrAttach"></a><span data-ttu-id="49a84-141">Ripristino o connessione di un database abilitato per Change Data Capture</span><span class="sxs-lookup"><span data-stu-id="49a84-141">Restoring or Attaching a Database Enabled for Change Data Capture</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="49a84-142">viene utilizzata la logica seguente per determinare se la funzionalità Change Data Capture rimane abilitata anche dopo il ripristino o il collegamento di un database:</span><span class="sxs-lookup"><span data-stu-id="49a84-142">uses the following logic to determine if change data capture remains enabled after a database is restored or attached:</span></span>  
  
-   <span data-ttu-id="49a84-143">Se un database viene ripristinato nello stesso server con lo stesso nome di database, la funzionalità Change Data Capture rimane abilitata.</span><span class="sxs-lookup"><span data-stu-id="49a84-143">If a database is restored to the same server with the same database name, change data capture remains enabled.</span></span>  
  
-   <span data-ttu-id="49a84-144">Se un database viene ripristinato in un altro server, per impostazione predefinita la funzionalità Change Data Capture viene disabilitata e tutti i metadati correlati vengono eliminati.</span><span class="sxs-lookup"><span data-stu-id="49a84-144">If a database is restored to another server, by default change data capture is disabled and all related metadata is deleted.</span></span>  
  
     <span data-ttu-id="49a84-145">Per mantenere abilitata la funzionalità Change Data Capture, utilizzare l'opzione `KEEP_CDC` durante il ripristino del database.</span><span class="sxs-lookup"><span data-stu-id="49a84-145">To retain change data capture, use the `KEEP_CDC` option when restoring the database.</span></span> <span data-ttu-id="49a84-146">Per ulteriori informazioni su questa opzione, vedere [RESTORE](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="49a84-146">For more information about this option, see [RESTORE](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
-   <span data-ttu-id="49a84-147">Se un database viene scollegato e collegato allo stesso o a un altro server, la funzionalità Change Data Capture rimane abilitata.</span><span class="sxs-lookup"><span data-stu-id="49a84-147">If a database is detached and attached to the same server or another server, change data capture remains enabled.</span></span>  
  
-   <span data-ttu-id="49a84-148">Se un database viene collegato o ripristinato con l' `KEEP_CDC` opzione in qualsiasi edizione diversa da Enterprise, l'operazione viene bloccata perché Change Data Capture richiede [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span><span class="sxs-lookup"><span data-stu-id="49a84-148">If a database is attached or restored with the `KEEP_CDC` option to any edition other than Enterprise, the operation is blocked because change data capture requires [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span></span> <span data-ttu-id="49a84-149">Viene visualizzato il messaggio di errore 934:</span><span class="sxs-lookup"><span data-stu-id="49a84-149">Error message 934 is displayed:</span></span>  
  
     `SQL Server cannot load database '%.*ls' because change data capture is enabled. The currently installed edition of SQL Server does not support change data capture. Either disable change data capture in the database by using a supported edition of SQL Server, or upgrade the instance to one that supports change data capture.`  
  
 <span data-ttu-id="49a84-150">È possibile usare [sys.sp_cdc_disable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-disable-db-transact-sql) per rimuovere Change Data Capture da un database collegato o ripristinato.</span><span class="sxs-lookup"><span data-stu-id="49a84-150">You can use [sys.sp_cdc_disable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-disable-db-transact-sql) to remove change data capture from a restored or attached database.</span></span>  
  
## <a name="change-data-capture-and-alwayson"></a><span data-ttu-id="49a84-151">Change Data Capture e AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="49a84-151">Change Data Capture and AlwaysON</span></span>  
 <span data-ttu-id="49a84-152">Quando si utilizza AlwaysOn, è consigliabile eseguire un'enumerazione delle modifiche nella replica secondaria per ridurre il carico su disco nella replica primaria.</span><span class="sxs-lookup"><span data-stu-id="49a84-152">When you use AlwaysON, change enumeration should be done on the Secondary replication to reduce the disk load on the primary.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="49a84-153">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="49a84-153">See Also</span></span>  
 [<span data-ttu-id="49a84-154">Amministrare e monitorare Change Data Capture &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="49a84-154">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
