---
title: Informazioni su Change Data Capture (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data capture [SQL Server], about
- change data capture [SQL Server]
- 22832 (Database Engine error)
ms.assetid: 7d8c4684-9eb1-4791-8c3b-0f0bb15d9634
author: rothja
ms.author: jroth
ms.openlocfilehash: cf8045ff45e7467a626bee85857ae8319f5d2649
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87630401"
---
# <a name="about-change-data-capture-sql-server"></a><span data-ttu-id="eea84-102">Informazioni su Change Data Capture (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="eea84-102">About Change Data Capture (SQL Server)</span></span>
  <span data-ttu-id="eea84-103">Change Data Capture consente di registrare le attività di inserimento, aggiornamento ed eliminazione applicate a una tabella di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ,</span><span class="sxs-lookup"><span data-stu-id="eea84-103">Change data capture records insert, update, and delete activity that is applied to a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] table.</span></span> <span data-ttu-id="eea84-104">rendendo disponibili i dettagli delle modifiche in un formato relazionale facilmente utilizzabile.</span><span class="sxs-lookup"><span data-stu-id="eea84-104">This makes the details of the changes available in an easily consumed relational format.</span></span> <span data-ttu-id="eea84-105">Le informazioni sulla colonna e i metadati necessari per applicare le modifiche a un ambiente di destinazione vengono acquisiti per le righe modificate e archiviati in tabelle delle modifiche che riflettono la struttura della colonna delle tabelle di origine con rilevamento.</span><span class="sxs-lookup"><span data-stu-id="eea84-105">Column information and the metadata that is required to apply the changes to a target environment is captured for the modified rows and stored in change tables that mirror the column structure of the tracked source tables.</span></span> <span data-ttu-id="eea84-106">Per consentire ai consumer di accedere in modo sistematico ai dati delle modifiche, sono disponibili funzioni con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="eea84-106">Table-valued functions are provided to allow systematic access to the change data by consumers.</span></span>  
  
 <span data-ttu-id="eea84-107">Un buon esempio di consumer di dati cui questa tecnologia è destinata è un'applicazione ETL di estrazione, trasformazione e caricamento.</span><span class="sxs-lookup"><span data-stu-id="eea84-107">A good example of a data consumer that is targeted by this technology is an extraction, transformation, and loading (ETL) application.</span></span> <span data-ttu-id="eea84-108">Un'applicazione di questo tipo carica incrementalmente dati delle modifiche dalle tabelle di origine di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] in un data warehouse oppure in un data mart.</span><span class="sxs-lookup"><span data-stu-id="eea84-108">An ETL application incrementally loads change data from [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] source tables to a data warehouse or data mart.</span></span> <span data-ttu-id="eea84-109">Anche se la rappresentazione delle tabelle di origine all'interno del data warehouse deve riflettere le modifiche in tali tabelle, una tecnologia end-to-end che aggiorna una replica dell'origine non è appropriata.</span><span class="sxs-lookup"><span data-stu-id="eea84-109">Although the representation of the source tables within the data warehouse must reflect changes in the source tables, an end-to-end technology that refreshes a replica of the source is not appropriate.</span></span> <span data-ttu-id="eea84-110">È necessario invece un flusso affidabile di dati delle modifiche strutturato in modo che i consumer possano applicarlo a rappresentazioni di destinazione dei dati diverse.</span><span class="sxs-lookup"><span data-stu-id="eea84-110">Instead, you need a reliable stream of change data that is structured so that consumers can apply it to dissimilar target representations of the data.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="eea84-111">Change Data Capture fornisce questa tecnologia.</span><span class="sxs-lookup"><span data-stu-id="eea84-111">change data capture provides this technology.</span></span>  
  
## <a name="change-data-capture-data-flow"></a><span data-ttu-id="eea84-112">Flusso di dati di Change Data Capture</span><span class="sxs-lookup"><span data-stu-id="eea84-112">Change Data Capture Data Flow</span></span>  
 <span data-ttu-id="eea84-113">Nella figura seguente viene illustrato il flusso di dati principale per Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="eea84-113">The following illustration shows the principal data flow for change data capture.</span></span>  
  
 <span data-ttu-id="eea84-114">![Flusso di dati di Change Data Capture](../../database-engine/media/cdcdataflow.gif "Flusso di dati di Change Data Capture")</span><span class="sxs-lookup"><span data-stu-id="eea84-114">![Change data capture data flow](../../database-engine/media/cdcdataflow.gif "Change data capture data flow")</span></span>  
  
 <span data-ttu-id="eea84-115">L'origine dei dati delle modifiche per la funzionalità Change Data Capture è data dal log delle transazioni di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="eea84-115">The source of change data for change data capture is the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction log.</span></span> <span data-ttu-id="eea84-116">Man mano che alle tabelle di origine con rilevamento vengono applicati inserimenti, aggiornamenti ed eliminazioni, le voci che descrivono tali modifiche vengono aggiunte al log.</span><span class="sxs-lookup"><span data-stu-id="eea84-116">As inserts, updates, and deletes are applied to tracked source tables, entries that describe those changes are added to the log.</span></span> <span data-ttu-id="eea84-117">Il log viene utilizzato come input per il processo di acquisizione</span><span class="sxs-lookup"><span data-stu-id="eea84-117">The log serves as input to the capture process.</span></span> <span data-ttu-id="eea84-118">Il log viene letto e le informazioni relative alle modifiche vengono aggiunte alla tabella delle modifiche associata alla tabella con rilevamento.</span><span class="sxs-lookup"><span data-stu-id="eea84-118">This reads the log and adds information about changes to the tracked table's associated change table.</span></span> <span data-ttu-id="eea84-119">Per enumerare le modifiche visualizzate nelle tabelle delle modifiche in un intervallo specificato, sono disponibili diverse funzioni che restituiscono le informazioni in un set di risultati filtrato.</span><span class="sxs-lookup"><span data-stu-id="eea84-119">Functions are provided to enumerate the changes that appear in the change tables over a specified range, returning the information in the form of a filtered result set.</span></span> <span data-ttu-id="eea84-120">Tale set di risultati viene utilizzato in genere da un processo dell'applicazione per aggiornare una rappresentazione dell'origine in alcuni ambienti esterni.</span><span class="sxs-lookup"><span data-stu-id="eea84-120">The filtered result set is typically used by an application process to update a representation of the source in some external environment.</span></span>  
  
## <a name="understanding-change-data-capture-and-the-capture-instance"></a><span data-ttu-id="eea84-121">Informazioni su Change Data Capture e l'istanza di acquisizione</span><span class="sxs-lookup"><span data-stu-id="eea84-121">Understanding Change Data Capture and the Capture Instance</span></span>  
 <span data-ttu-id="eea84-122">Affinché sia possibile rilevare le modifiche apportate a qualsiasi tabella singola di un database, è necessario che Change Data Capture venga abilitato in modo esplicito per il database.</span><span class="sxs-lookup"><span data-stu-id="eea84-122">Before changes to any individual tables within a database can be tracked, change data capture must be explicitly enabled for the database.</span></span> <span data-ttu-id="eea84-123">Per eseguire questa operazione, usare la stored procedure [sys.sp_cdc_enable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-db-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="eea84-123">This is done by using the stored procedure [sys.sp_cdc_enable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-db-transact-sql).</span></span> <span data-ttu-id="eea84-124">Quando il database è abilitato, le tabelle di origine possono essere identificate come tabelle con rilevamento usando la stored procedure [sys.sp_cdc_enable_table](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="eea84-124">When the database is enabled, source tables can be identified as tracked tables by using the stored procedure [sys.sp_cdc_enable_table](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql).</span></span> <span data-ttu-id="eea84-125">Quando la funzionalità Change Data Capture viene abilitata per una tabella, per supportare la distribuzione dei dati delle modifiche nella tabella di origine viene creata un'istanza di acquisizione associata</span><span class="sxs-lookup"><span data-stu-id="eea84-125">When a table is enabled for change data capture, an associated capture instance is created to support the dissemination of the change data in the source table.</span></span> <span data-ttu-id="eea84-126">costituita da una tabella delle modifiche e da una o due funzioni della query.</span><span class="sxs-lookup"><span data-stu-id="eea84-126">The capture instance consists of a change table and up to two query functions.</span></span> <span data-ttu-id="eea84-127">I metadati che descrivono i dettagli di configurazione dell'istanza di acquisizione vengono mantenuti nelle tabelle di metadati di Change Data Capture `cdc.change_tables`, `cdc.index_columns` e `cdc.captured_columns`.</span><span class="sxs-lookup"><span data-stu-id="eea84-127">Metadata that describes the configuration details of the capture instance is retained in the change data capture metadata tables `cdc.change_tables`, `cdc.index_columns`, and `cdc.captured_columns`.</span></span> <span data-ttu-id="eea84-128">È possibile recuperare queste informazioni usando la stored procedure [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="eea84-128">This information can be retrieved by using the stored procedure [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql).</span></span>  
  
 <span data-ttu-id="eea84-129">Tutti gli oggetti associati a un'istanza di acquisizione vengono creati nello schema relativo a Change Data Capture del database abilitato.</span><span class="sxs-lookup"><span data-stu-id="eea84-129">All objects that are associated with a capture instance are created in the change data capture schema of the enabled database.</span></span> <span data-ttu-id="eea84-130">Il nome dell'istanza di acquisizione deve essere un nome di oggetto valido e univoco in tutte le istanze di acquisizione del database.</span><span class="sxs-lookup"><span data-stu-id="eea84-130">The requirements for the capture instance name is that it be a valid object name, and that it be unique across the database capture instances.</span></span> <span data-ttu-id="eea84-131">Per impostazione predefinita, il nome è \<*schema name*_*table name*> della tabella di origine.</span><span class="sxs-lookup"><span data-stu-id="eea84-131">By default, the name is \<*schema name*_*table name*> of the source table.</span></span> <span data-ttu-id="eea84-132">Il nome assegnato alla tabella delle modifiche associata viene creato aggiungendo `_CT` al nome dell'istanza di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="eea84-132">Its associated change table is named by appending `_CT` to the capture instance name.</span></span> <span data-ttu-id="eea84-133">Il nome assegnato alla funzione utilizzata per eseguire una query relativa a tutte le modifiche viene creato anteponendo `fn_cdc_get_all_changes_` al nome dell'istanza di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="eea84-133">The function that is used to query for all changes is named by prepending `fn_cdc_get_all_changes_` to the capture instance name.</span></span> <span data-ttu-id="eea84-134">Se l'istanza di acquisizione è configurata per supportare `net changes` , `net_changes` anche la funzione di query viene creata e denominata **anteponendo \_ fn_cdc_get_net_changes** al nome dell'istanza di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="eea84-134">If the capture instance is configured to support `net changes`, the `net_changes` query function is also created and named by prepending **fn_cdc_get_net_changes\_** to the capture instance name.</span></span>  
  
## <a name="change-table"></a><span data-ttu-id="eea84-135">Tabella delle modifiche</span><span class="sxs-lookup"><span data-stu-id="eea84-135">Change Table</span></span>  
 <span data-ttu-id="eea84-136">Le prime cinque colonne di una tabella delle modifiche di Change Data Capture sono costituite da metadati</span><span class="sxs-lookup"><span data-stu-id="eea84-136">The first five columns of a change data capture change table are metadata columns.</span></span> <span data-ttu-id="eea84-137">che forniscono informazioni aggiuntive attinenti alla modifica registrata.</span><span class="sxs-lookup"><span data-stu-id="eea84-137">These provide additional information that is relevant to the recorded change.</span></span> <span data-ttu-id="eea84-138">Le colonne rimanenti rispecchiano le colonne acquisite identificate dalla tabella di origine nel nome e, generalmente, nel tipo.</span><span class="sxs-lookup"><span data-stu-id="eea84-138">The remaining columns mirror the identified captured columns from the source table in name and, typically, in type.</span></span> <span data-ttu-id="eea84-139">Tali colonne contengono i dati delle colonne acquisite raccolti dalla tabella di origine.</span><span class="sxs-lookup"><span data-stu-id="eea84-139">These columns hold the captured column data that is gathered from the source table.</span></span>  
  
 <span data-ttu-id="eea84-140">Ogni operazione di inserimento o eliminazione applicata a una tabella di origine viene visualizzata in un'unica riga all'interno della tabella delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="eea84-140">Each insert or delete operation that is applied to a source table appears as a single row within the change table.</span></span> <span data-ttu-id="eea84-141">Le colonne di dati della riga che costituisce il risultato di un'operazione di inserimento contengono i valori della colonna dopo l'inserimento,</span><span class="sxs-lookup"><span data-stu-id="eea84-141">The data columns of the row that results from an insert operation contain the column values after the insert.</span></span> <span data-ttu-id="eea84-142">mentre le colonne di dati della riga che costituisce il risultato di un'operazione di eliminazione contengono i valori della colonna prima dell'eliminazione.</span><span class="sxs-lookup"><span data-stu-id="eea84-142">The data columns of the row that results from a delete operation contain the column values before the delete.</span></span> <span data-ttu-id="eea84-143">Per eseguire un'operazione di aggiornamento sono necessarie due voci di riga, una per identificare i valori della colonna prima dell'aggiornamento e l'altra per identificare i valori della colonna dopo l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="eea84-143">An update operation requires one row entry to identify the column values before the update, and a second row entry to identify the column values after the update.</span></span>  
  
 <span data-ttu-id="eea84-144">Ogni riga di una tabella delle modifiche contiene inoltre metadati aggiuntivi che consentono di interpretare l'attività di modifica.</span><span class="sxs-lookup"><span data-stu-id="eea84-144">Each row in a change table also contains additional metadata to allow interpretation of the change activity.</span></span> <span data-ttu-id="eea84-145">La colonna __$start_lsn identifica il numero di sequenza del file di log (LSN) del commit assegnato alla modifica.</span><span class="sxs-lookup"><span data-stu-id="eea84-145">The column __$start_lsn identifies the commit log sequence number (LSN) that was assigned to the change.</span></span> <span data-ttu-id="eea84-146">Il valore LSN di commit identifica le modifiche di cui è stato eseguito il commit all'interno della stessa transazione e ordina inoltre tali transazioni.</span><span class="sxs-lookup"><span data-stu-id="eea84-146">The commit LSN both identifies changes that were committed within the same transaction, and orders those transactions.</span></span> <span data-ttu-id="eea84-147">La colonna \_\_$seqval può essere usata per ordinare più modifiche che si verificano all'interno di una stessa transazione,</span><span class="sxs-lookup"><span data-stu-id="eea84-147">The column \_\_$seqval can be used to order more changes that occur in the same transaction.</span></span> <span data-ttu-id="eea84-148">La colonna \_\_$operation registra l'operazione associata alla modifica: 1 = eliminazione, 2 = inserimento, 3 = aggiornamento (prima dell'immagine) e 4 = aggiornamento (dopo l'immagine).</span><span class="sxs-lookup"><span data-stu-id="eea84-148">The column \_\_$operation records the operation that is associated with the change: 1 = delete, 2 = insert, 3 = update (before image), and 4 = update (after image).</span></span> <span data-ttu-id="eea84-149">La colonna \_\_$update_mask, infine, è una maschera di bit variabile con un bit definito per ogni colonna acquisita.</span><span class="sxs-lookup"><span data-stu-id="eea84-149">The column \_\_$update_mask is a variable bit mask with one defined bit for each captured column.</span></span> <span data-ttu-id="eea84-150">Per le voci relative all'inserimento e all'eliminazione dei dati, tutti i bit della maschera di aggiornamento verranno sempre impostati.</span><span class="sxs-lookup"><span data-stu-id="eea84-150">For insert and delete entries, the update mask will always have all bits set.</span></span> <span data-ttu-id="eea84-151">Per le righe aggiornate, tuttavia, saranno impostati solo i bit corrispondenti alle colonne modificate.</span><span class="sxs-lookup"><span data-stu-id="eea84-151">Update rows, however, will only have those bits set that correspond to changed columns.</span></span>  
  
## <a name="change-data-capture-validity-interval-for-a-database"></a><span data-ttu-id="eea84-152">Intervallo di validità di Change Data Capture per un database</span><span class="sxs-lookup"><span data-stu-id="eea84-152">Change Data Capture Validity Interval for a Database</span></span>  
 <span data-ttu-id="eea84-153">L'intervallo di validità di Change Data Capture per un database è rappresentato dal periodo di tempo durante il quale i dati delle modifiche sono disponibili per le istanze di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="eea84-153">The change data capture validity interval for a database is the time during which change data is available for capture instances.</span></span> <span data-ttu-id="eea84-154">L'intervallo di validità ha inizio nel momento in cui viene creata la prima istanza di acquisizione e si estende fino al momento corrente.</span><span class="sxs-lookup"><span data-stu-id="eea84-154">The validity interval begins when the first capture instance is created for a database table, and continues to the present time.</span></span>  
  
 <span data-ttu-id="eea84-155">Se non vengono eliminati in modo periodico e sistematico, i dati inseriti nelle tabelle delle modifiche aumenteranno notevolmente e non sarà più possibile gestirli.</span><span class="sxs-lookup"><span data-stu-id="eea84-155">Data that is deposited in change tables will grow unmanageably if you do not periodically and systematically prune the data.</span></span> <span data-ttu-id="eea84-156">Il processo di pulizia di Change Data Capture è responsabile dell'applicazione dei criteri di pulizia basati sulla memorizzazione.</span><span class="sxs-lookup"><span data-stu-id="eea84-156">The change data capture cleanup process is responsible for enforcing the retention-based cleanup policy.</span></span> <span data-ttu-id="eea84-157">Tale processo sposta innanzitutto l'endpoint inferiore dell'intervallo di validità in modo da soddisfare la restrizione relative al tempo</span><span class="sxs-lookup"><span data-stu-id="eea84-157">First, it moves the low endpoint of the validity interval to satisfy the time restriction.</span></span> <span data-ttu-id="eea84-158">e successivamente rimuove le voci della tabella delle modifiche scadute.</span><span class="sxs-lookup"><span data-stu-id="eea84-158">Then, it removes expired change table entries.</span></span> <span data-ttu-id="eea84-159">Per impostazione predefinita, i dati vengono mantenuti per tre giorni.</span><span class="sxs-lookup"><span data-stu-id="eea84-159">By default, three days of data is retained.</span></span>  
  
 <span data-ttu-id="eea84-160">A livello dell'endpoint superiore, poiché il processo di acquisizione esegue il commit di ogni nuovo batch di dati delle modifiche, le nuove voci vengono aggiunte a `cdc.lsn_time_mapping` per ogni transazione cui sono associate voci della tabella delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="eea84-160">At the high end, as the capture process commits each new batch of change data, new entries are added to `cdc.lsn_time_mapping` for each transaction that has change table entries.</span></span> <span data-ttu-id="eea84-161">Nella tabella di mapping vengono mantenuti sia un numero di sequenza del file di log (LSN) del commit che l'ora in cui è stato eseguito il commit della transazione (colonne start_lsn e tran_end_time, rispettivamente).</span><span class="sxs-lookup"><span data-stu-id="eea84-161">Within the mapping table, both a commit Log Sequence Number (LSN) and a transaction commit time (columns start_lsn and tran_end_time, respectively) are retained.</span></span> <span data-ttu-id="eea84-162">Il valore LSN massimo presente in `cdc.lsn_time_mapping` rappresenta il limite superiore dell'intervallo di validità del database.</span><span class="sxs-lookup"><span data-stu-id="eea84-162">The maximum LSN value that is found in `cdc.lsn_time_mapping` represents the high water mark of the database validity window.</span></span> <span data-ttu-id="eea84-163">L'ora corrispondente in cui viene eseguito il commit viene utilizzata come base per il calcolo del nuovo limite inferiore da parte del criterio di pulizia basato sulla memorizzazione.</span><span class="sxs-lookup"><span data-stu-id="eea84-163">Its corresponding commit time is used as the base from which retention based cleanup computes a new low water mark.</span></span>  
  
 <span data-ttu-id="eea84-164">Poiché il processo di acquisizione estrae dati delle modifiche dal log delle transazioni, è presente una latenza predefinita tra il momento in cui viene eseguito il commit di una modifica in una tabella di origine e quello in cui la modifica viene visualizzata nella tabella delle modifiche associate.</span><span class="sxs-lookup"><span data-stu-id="eea84-164">Because the capture process extracts change data from the transaction log, there is a built in latency between the time that a change is committed to a source table and the time that the change appears within its associated change table.</span></span> <span data-ttu-id="eea84-165">Mentre tale latenza è in genere bassa, è tuttavia importante tenere presente che i dati delle modifiche non sono disponibili fino a quando il processo di acquisizione non ha elaborato le voci di log correlate.</span><span class="sxs-lookup"><span data-stu-id="eea84-165">While this latency is typically small, it is nevertheless important to remember that change data is not available until the capture process has processed the related log entries.</span></span>  
  
## <a name="change-data-capture-validity-interval-for-a-capture-instance"></a><span data-ttu-id="eea84-166">Intervallo di validità di Change Data Capture per un'istanza di acquisizione</span><span class="sxs-lookup"><span data-stu-id="eea84-166">Change Data Capture Validity Interval for a Capture Instance</span></span>  
 <span data-ttu-id="eea84-167">Sebbene l'intervallo di validità per il database e quello per l'istanza di acquisizione singola in genere coincidano, questa situazione non si verifica sempre.</span><span class="sxs-lookup"><span data-stu-id="eea84-167">Although it is common for the database validity interval and the validity interval of individual capture instance to coincide, this is not always true.</span></span> <span data-ttu-id="eea84-168">L'intervallo di validità dell'istanza di acquisizione viene avviato quando il processo di acquisizione riconosce l'istanza e avvia la registrazione delle modifiche associate nella relativa tabella.</span><span class="sxs-lookup"><span data-stu-id="eea84-168">The validity interval of the capture instance starts when the capture process recognizes the capture instance and starts to log associated changes to its change table.</span></span> <span data-ttu-id="eea84-169">Di conseguenza, se le istanze di acquisizione vengono create in momenti diversi, a ciascuna sarà associato inizialmente un endpoint inferiore diverso.</span><span class="sxs-lookup"><span data-stu-id="eea84-169">As a result, if capture instances are created at different times, each will initially have a different low endpoint.</span></span> <span data-ttu-id="eea84-170">La colonna start_lsn del set di risultati restituito da [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql) visualizza l'endpoint basso corrente per ogni istanza di acquisizione definita.</span><span class="sxs-lookup"><span data-stu-id="eea84-170">The start_lsn column of the result set that is returned by [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql) shows the current low endpoint for each defined capture instance.</span></span> <span data-ttu-id="eea84-171">Quando il processo di pulizia elimina le voci della tabella delle modifiche, modifica anche i valori di start_lsn affinché tutte le istanze di acquisizione riflettano il nuovo limite inferiore per i dati delle modifiche disponibili.</span><span class="sxs-lookup"><span data-stu-id="eea84-171">When the cleanup process cleans up change table entries, it adjusts the start_lsn values for all capture instances to reflect the new low water mark for available change data.</span></span> <span data-ttu-id="eea84-172">Vengono modificate solo le istanze di acquisizione per cui i valori di start_lsn sono attualmente minori rispetto al nuovo limite inferiore.</span><span class="sxs-lookup"><span data-stu-id="eea84-172">Only those capture instances that have start_lsn values that are currently less than the new low water mark are adjusted.</span></span> <span data-ttu-id="eea84-173">Con il tempo, se non viene creata alcuna nuova istanza di acquisizione, gli intervalli di validità per tutte le istanze singole tenderanno a coincidere con l'intervallo di validità per il database.</span><span class="sxs-lookup"><span data-stu-id="eea84-173">Over time, if no new capture instances are created, the validity intervals for all individual instances will tend to coincide with the database validity interval.</span></span>  
  
 <span data-ttu-id="eea84-174">L'intervallo di validità è importante per i consumer dei dati delle modifiche perché l'intervallo di estrazione per una richiesta deve essere interamente compreso nell'intervallo di validità di Change Data Capture per l'istanza di acquisizione corrente.</span><span class="sxs-lookup"><span data-stu-id="eea84-174">The validity interval is important to consumers of change data because the extraction interval for a request must be fully covered by the current change data capture validity interval for the capture instance.</span></span> <span data-ttu-id="eea84-175">Se l'endpoint inferiore dell'intervallo di estrazione è minore dell'endpoint inferiore dell'intervallo di validità, alcuni dati delle modifiche potrebbero non essere disponibili a causa di una pulizia eccessiva.</span><span class="sxs-lookup"><span data-stu-id="eea84-175">If the low endpoint of the extraction interval is to the left of the low endpoint of the validity interval, there could be missing change data due to aggressive cleanup.</span></span> <span data-ttu-id="eea84-176">Se invece l'endpoint superiore dell'intervallo di estrazione è maggiore dell'endpoint superiore dell'intervallo di validità, il processo di acquisizione non ha ancora eseguito alcuna elaborazione durante il periodo di tempo rappresentato dall'intervallo di estrazione, provocando anche in questo caso la non disponibilità dei dati delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="eea84-176">If the high endpoint of the extraction interval is to the right of the high endpoint of the validity interval, the capture process has not yet processed through the time period that is represented by the extraction interval, and change data could also be missing.</span></span>  
  
 <span data-ttu-id="eea84-177">La funzione [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) consente di recuperare il valore LSN minimo corrente per un'istanza di acquisizione, mentre [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) consente di recuperare il valore LSN massimo corrente.</span><span class="sxs-lookup"><span data-stu-id="eea84-177">The function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) is used to retrieve the current minimum LSN for a capture instance, while [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) is used to retrieve the current maximum LSN value.</span></span> <span data-ttu-id="eea84-178">In caso di esecuzione di una query sui dati delle modifiche, se l'intervallo LSN specificato non è compreso tra questi due valori LSN, non sarà possibile eseguire le funzioni della query relative a Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="eea84-178">When querying for change data, if the specified LSN range does not lie within these two LSN values, the change data capture query functions will fail.</span></span>  
  
## <a name="handling-changes-to-source-tables"></a><span data-ttu-id="eea84-179">Gestione delle modifiche nelle tabelle di origine</span><span class="sxs-lookup"><span data-stu-id="eea84-179">Handling Changes to Source Tables</span></span>  
 <span data-ttu-id="eea84-180">L'adattamento delle modifiche delle colonne nelle tabelle di origine per cui deve essere eseguito il rilevamento delle modifiche costituisce un problema di difficile risoluzione per i consumer a valle.</span><span class="sxs-lookup"><span data-stu-id="eea84-180">To accommodate column changes in the source tables that are being tracked is a difficult issue for downstream consumers.</span></span> <span data-ttu-id="eea84-181">Sebbene l'abilitazione di Change Data Capture in una tabella di origine non impedisca il verificarsi di tali modifiche DDL, tale funzionalità consente tuttavia di mitigare l'effetto sui consumer consentendo ai set di risultati recapitati restituiti tramite l'API di rimanere invariati anche se la struttura della colonna della tabella di origine sottostante subisce modifiche.</span><span class="sxs-lookup"><span data-stu-id="eea84-181">Although enabling change data capture on a source table does not prevent such DDL changes from occurring, change data capture helps to mitigate the effect on consumers by allowing the delivered result sets that are returned through the API to remain unchanged even as the column structure of the underlying source table changes.</span></span> <span data-ttu-id="eea84-182">Tale struttura fissa viene riflessa anche nella tabella delle modifiche sottostante alla quale accedono le funzioni della query definite.</span><span class="sxs-lookup"><span data-stu-id="eea84-182">This fixed column structure is also reflected in the underlying change table that the defined query functions access.</span></span>  
  
 <span data-ttu-id="eea84-183">Per adattare una tabella delle modifiche con struttura della colonna fissa, il processo di acquisizione responsabile del popolamento della tabella delle modifiche ignorerà qualsiasi nuova colonna non identificata per l'acquisizione al momento dell'abilitazione di Change Data Capture per la tabella di origine.</span><span class="sxs-lookup"><span data-stu-id="eea84-183">To accommodate a fixed column structure change table, the capture process responsible for populating the change table will ignore any new columns that are not identified for capture when the source table was enabled for change data capture.</span></span> <span data-ttu-id="eea84-184">Se una colonna con rilevamento viene eliminata, per tale colonna verranno specificati valori Null nelle voci di modifica successive.</span><span class="sxs-lookup"><span data-stu-id="eea84-184">If a tracked column is dropped, null values will be supplied for the column in the subsequent change entries.</span></span> <span data-ttu-id="eea84-185">Tuttavia, se una colonna esistente subisce una modifica relativa al tipo di dati, la modifica viene propagata alla tabella delle modifiche per garantire che il meccanismo di acquisizione non provochi una perdita di dati nelle colonne con rilevamento.</span><span class="sxs-lookup"><span data-stu-id="eea84-185">However, if an existing column undergoes a change in its data type, the change is propagated to the change table to ensure that the capture mechanism does not introduce data loss to tracked columns.</span></span> <span data-ttu-id="eea84-186">Il processo di acquisizione invia inoltre tutte le modifiche rilevate nella struttura della colonna di tabelle con rilevamento alla tabella cdc.ddl_history.</span><span class="sxs-lookup"><span data-stu-id="eea84-186">The capture process also posts any detected changes to the column structure of tracked tables to the cdc.ddl_history table.</span></span> <span data-ttu-id="eea84-187">Gli utenti che vogliono ricevere un avviso relativo alle modifiche eventualmente apportate ad applicazioni a valle possono usare la stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="eea84-187">Consumers wishing to be alerted of adjustments that might have to be made in downstream applications, use the stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span></span>  
  
 <span data-ttu-id="eea84-188">Quando alla tabella di origine associata vengono applicate modifiche DDL, l'istanza di acquisizione corrente continuerà in genere a mantenere la propria forma.</span><span class="sxs-lookup"><span data-stu-id="eea84-188">Typically, the current capture instance will continue to retain its shape when DDL changes are applied to its associated source table.</span></span> <span data-ttu-id="eea84-189">È tuttavia possibile creare una seconda istanza di acquisizione per la tabella che rifletta la nuova struttura della colonna.</span><span class="sxs-lookup"><span data-stu-id="eea84-189">However, it is possible to create a second capture instance for the table that reflects the new column structure.</span></span> <span data-ttu-id="eea84-190">In questo modo il processo di acquisizione è in grado di trasferire le modifiche apportate alla stessa tabella di origine in due tabelle delle modifiche distinte con strutture della colonna diverse.</span><span class="sxs-lookup"><span data-stu-id="eea84-190">This allows the capture process to make changes to the same source table into two distinct change tables having two different column structures.</span></span> <span data-ttu-id="eea84-191">Di conseguenza, mentre una tabella delle modifiche può continuare a essere utilizzata da programmi operativi correnti, la seconda può risultare utile in un ambiente di sviluppo in cui devono essere incorporati i nuovi dati della colonna.</span><span class="sxs-lookup"><span data-stu-id="eea84-191">Thus, while one change table can continue to feed current operational programs, the second one can drive a development environment that is trying to incorporate the new column data.</span></span> <span data-ttu-id="eea84-192">Se si consente al meccanismo di acquisizione di popolare entrambe le tabelle delle modifiche contemporaneamente, una transizione da una tabella all'altra può essere eseguita senza perdita di dati delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="eea84-192">Allowing the capture mechanism to populate both change tables in tandem means that a transition from one to the other can be accomplished without loss of change data.</span></span> <span data-ttu-id="eea84-193">Questa situazione può verificarsi tutte le volte che due cronologie di Change Data Capture si sovrappongono.</span><span class="sxs-lookup"><span data-stu-id="eea84-193">This can happen any time the two change data capture timelines overlap.</span></span> <span data-ttu-id="eea84-194">Quando la transizione viene effettuata, l'istanza di acquisizione obsoleta può essere rimossa.</span><span class="sxs-lookup"><span data-stu-id="eea84-194">When the transition is effected, the obsolete capture instance can be removed.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="eea84-195">Il numero massimo di istanze di acquisizione che possono essere associate contemporaneamente a un'unica tabella di origine è due.</span><span class="sxs-lookup"><span data-stu-id="eea84-195">The maximum number of capture instances that can be concurrently associated with a single source table is two.</span></span>  
  
## <a name="relationship-between-the-capture-job-and-the-transactional-replication-logreader"></a><span data-ttu-id="eea84-196">Relazione tra il processo di acquisizione e l'agente di lettura log della replica transazionale</span><span class="sxs-lookup"><span data-stu-id="eea84-196">Relationship Between the Capture Job and the Transactional Replication Logreader</span></span>  
 <span data-ttu-id="eea84-197">La logica del processo Change Data Capture è incorporata nella stored procedure [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql), una funzione del server interna compilata come parte del processo sqlservr.exe e usata anche dalla replica transazionale per raccogliere modifiche dal log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="eea84-197">The logic for change data capture process is embedded in the stored procedure [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql), an internal server function built as part of sqlservr.exe and also used by transactional replication to harvest changes from the transaction log.</span></span> <span data-ttu-id="eea84-198">Quando per un database è abilitata solo la funzionalità Change Data Capture, per richiamare sp_replcmds viene creato il processo di acquisizione di SQL Server Agent relativo a Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="eea84-198">When change data capture alone is enabled for a database, you create the change data capture SQL Server Agent capture job as the vehicle for invoking sp_replcmds.</span></span> <span data-ttu-id="eea84-199">Se è presente anche la replica, l'agente di lettura log transazionale viene utilizzato da solo per soddisfare le esigenze relative ai dati delle modifiche per entrambi i consumer.</span><span class="sxs-lookup"><span data-stu-id="eea84-199">When replication is also present, the transactional logreader alone is used to satisfy the change data needs for both of these consumers.</span></span> <span data-ttu-id="eea84-200">Questa strategia consente di ridurre in modo significativo le contese relative al log quando per lo stesso database sono abilitati sia la replica che Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="eea84-200">This strategy significantly reduces log contention when both replication and change data capture are enabled for the same database.</span></span>  
  
 <span data-ttu-id="eea84-201">Il passaggio tra queste due modalità operative per l'acquisizione dei dati delle modifiche viene eseguito automaticamente tutte le volte che lo stato della replica di un database abilitato per Change Data Capture subisce una modifica.</span><span class="sxs-lookup"><span data-stu-id="eea84-201">The switch between these two operational modes for capturing change data occurs automatically whenever there is a change in the replication status of a change data capture enabled database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="eea84-202">Per entrambe le istanze della logica di acquisizione è necessario che [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent sia in esecuzione affinché il processo venga eseguito.</span><span class="sxs-lookup"><span data-stu-id="eea84-202">Both instances of the capture logic require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent to be running for the process to execute.</span></span>  
  
 <span data-ttu-id="eea84-203">L'attività principale del processo di acquisizione consiste nell'analisi del log e nella scrittura dei dati delle colonne e delle informazioni relative alla transazione nelle tabelle delle modifiche di Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="eea84-203">The principal task of the capture process is to scan the log and write column data and transaction related information to the change data capture change tables.</span></span> <span data-ttu-id="eea84-204">Per garantire un limite coerente a livello di transazione in tutte le tabelle delle modifiche di Change Data Capture che popola, il processo di acquisizione apre ed esegue il commit della propria transazione a ogni ciclo di analisi.</span><span class="sxs-lookup"><span data-stu-id="eea84-204">To ensure a transactionally consistent boundary across all the change data capture change tables that it populates, the capture process opens and commits its own transaction on each scan cycle.</span></span> <span data-ttu-id="eea84-205">Il processo rileva il momento in cui per le tabelle viene abilitato Change Data Capture e include automaticamente tali tabelle nel set di tabelle per le quali viene eseguito il monitoraggio delle voci di modifica nel log.</span><span class="sxs-lookup"><span data-stu-id="eea84-205">It detects when tables are newly enabled for change data capture, and automatically includes them in the set of tables that are actively monitored for change entries in the log.</span></span> <span data-ttu-id="eea84-206">Analogamente, verrà rilevata anche la disabilitazione di Change Data Capture, provocando la rimozione della tabella di origine dal set di tabelle per le quali viene eseguito il monitoraggio dei dati delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="eea84-206">Similarly, disabling change data capture will also be detected, causing the source table to be removed from the set of tables actively monitored for change data.</span></span> <span data-ttu-id="eea84-207">Quando l'elaborazione relativa a una sezione del log è completata, il processo di acquisizione segnala la logica di troncamento del log al server, che utilizza queste informazioni per identificare le voci di log idonee per il troncamento.</span><span class="sxs-lookup"><span data-stu-id="eea84-207">When processing for a section of the log is finished, the capture process signals the server log truncation logic, which uses this information to identify log entries eligible for truncation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="eea84-208">Quando un database è abilitato per Change Data Capture, anche se la modalità di recupero è impostata sul recupero semplice, il punto di troncamento del log non avanzerà finché tutte le modifiche contrassegnate per l'acquisizione non sono state raccolte dal processo di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="eea84-208">When a database is enabled for change data capture, even if the recovery mode is set to simple recovery the log truncation point will not advance until all the changes that are marked for capture have been gathered by the capture process.</span></span> <span data-ttu-id="eea84-209">Se il processo di acquisizione non è in esecuzione e sono disponibili modifiche per la raccolta, l'esecuzione di CHECKPOINT non comporterà il troncamento del log.</span><span class="sxs-lookup"><span data-stu-id="eea84-209">If the capture process is not running and there are changes to be gathered, executing CHECKPOINT will not truncate the log.</span></span>  
  
 <span data-ttu-id="eea84-210">Il processo di acquisizione viene inoltre utilizzato per gestire la cronologia relativa alle modifiche DDL apportate alle tabelle con rilevamento.</span><span class="sxs-lookup"><span data-stu-id="eea84-210">The capture process is also used to maintain history on the DDL changes to tracked tables.</span></span> <span data-ttu-id="eea84-211">Le istruzioni DDL associate a Change Data Capture inseriscono voci nel log delle transazioni del database ogni volta che una tabella o un database per cui la funzionalità Change Data Capture è abilitata viene eliminato o ogni volta che vengono aggiunte, modificate o eliminate colonne di una tabella per cui tale funzionalità è abilitata.</span><span class="sxs-lookup"><span data-stu-id="eea84-211">The DDL statements that are associated with change data capture make entries to the database transaction log whenever a change data capture-enabled database or table is dropped or columns of a change data capture-enabled table are added, modified, or dropped.</span></span> <span data-ttu-id="eea84-212">Tali voci di log vengono elaborate dal processo di acquisizione, che successivamente invia gli eventi DDL associati alla tabella cdc.ddl_history.</span><span class="sxs-lookup"><span data-stu-id="eea84-212">These log entries are processed by the capture process, which then posts the associated DDL events to the cdc.ddl_history table.</span></span> <span data-ttu-id="eea84-213">È possibile ottenere informazioni sugli eventi DDL che interessano le tabelle con rilevamento usando la stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="eea84-213">You can obtain information about DDL events that affect tracked tables by using the stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span></span>  
  
## <a name="change-data-capture-agent-jobs"></a><span data-ttu-id="eea84-214">Processi dell'agente di Change Data Capture</span><span class="sxs-lookup"><span data-stu-id="eea84-214">Change Data Capture Agent Jobs</span></span>  
 <span data-ttu-id="eea84-215">A un database abilitato per la funzionalità Change Data Capture sono in genere associati due processi di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent, uno usato per popolare le tabelle delle modifiche del database e uno responsabile della pulizia di tali tabelle.</span><span class="sxs-lookup"><span data-stu-id="eea84-215">Two [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs are typically associated with a change data capture enabled database: one that is used to populate the database change tables, and one that is responsible for change table cleanup.</span></span> <span data-ttu-id="eea84-216">Entrambi i processi sono costituiti da un solo passaggio che esegue il comando [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="eea84-216">Both jobs consist of a single step that runs a [!INCLUDE[tsql](../../includes/tsql-md.md)] command.</span></span> <span data-ttu-id="eea84-217">Il comando [!INCLUDE[tsql](../../includes/tsql-md.md)] richiamato è una stored procedure definita di Change Data Capture che implementa la logica del processo.</span><span class="sxs-lookup"><span data-stu-id="eea84-217">The [!INCLUDE[tsql](../../includes/tsql-md.md)] command that is invoked is a change data capture defined stored procedure that implements the logic of the job.</span></span> <span data-ttu-id="eea84-218">I processi vengono creati nel momento in cui per la prima tabella del database viene abilitato Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="eea84-218">The jobs are created when the first table of the database is enabled for change data capture.</span></span> <span data-ttu-id="eea84-219">Mentre il processo di pulizia viene sempre creato,</span><span class="sxs-lookup"><span data-stu-id="eea84-219">The Cleanup Job is always created.</span></span> <span data-ttu-id="eea84-220">il processo di acquisizione verrà creato solo se non sono state definite pubblicazioni transazionali per il database.</span><span class="sxs-lookup"><span data-stu-id="eea84-220">The capture job will only be created if there are no defined transactional publications for the database.</span></span> <span data-ttu-id="eea84-221">Il processo di acquisizione viene creato anche quando per un database sono abilitati sia Change Data Capture che la replica transazionale e il processo di lettura log transazionale viene rimosso perché al database non sono più associate pubblicazioni definite.</span><span class="sxs-lookup"><span data-stu-id="eea84-221">The capture job is also created when both change data capture and transactional replication are enabled for a database, and the transactional logreader job is removed because the database no longer has defined publications.</span></span>  
  
 <span data-ttu-id="eea84-222">Sia il processo di acquisizione che quello di pulizia vengono creati utilizzando parametri predefiniti.</span><span class="sxs-lookup"><span data-stu-id="eea84-222">Both the capture and cleanup jobs are created by using default parameters.</span></span> <span data-ttu-id="eea84-223">Il processo di acquisizione viene avviato immediatamente.</span><span class="sxs-lookup"><span data-stu-id="eea84-223">The capture job is started immediately.</span></span> <span data-ttu-id="eea84-224">L'esecuzione è continua e la capacità di elaborazione prevede un massimo di 1.000 transazioni per ciclo di analisi con un'attesa di 5 secondi tra un ciclo e l'altro.</span><span class="sxs-lookup"><span data-stu-id="eea84-224">It runs continuously, processing a maximum of 1000 transactions per scan cycle with a wait of 5 seconds between cycles.</span></span> <span data-ttu-id="eea84-225">Il processo di pulizia viene eseguito quotidianamente alle 02.00.</span><span class="sxs-lookup"><span data-stu-id="eea84-225">The cleanup job runs daily at 2 A.M.</span></span> <span data-ttu-id="eea84-226">Tale processo consente di memorizzare le voci della tabella delle modifiche per 4320 minuti o 3 giorni, rimuovendo un massimo di 5000 voci con una singola istruzione Delete.</span><span class="sxs-lookup"><span data-stu-id="eea84-226">It retains change table entries for 4320 minutes or 3 days, removing a maximum of 5000 entries with a single delete statement.</span></span>  
  
 <span data-ttu-id="eea84-227">I processi dell'agente di Change Data Capture vengono rimossi quando la funzionalità viene disabilitata per il database.</span><span class="sxs-lookup"><span data-stu-id="eea84-227">The change data capture agent jobs are removed when change data capture is disabled for a database.</span></span> <span data-ttu-id="eea84-228">Il processo di acquisizione può essere rimosso anche quando la prima pubblicazione viene aggiunta a un database e le funzionalità Change Data Capture e replica transazionale sono entrambe abilitate.</span><span class="sxs-lookup"><span data-stu-id="eea84-228">The capture job can also be removed when the first publication is added to a database, and both change data capture and transactional replication are enabled.</span></span>  
  
 <span data-ttu-id="eea84-229">Internamente, i processi dell'agente Change Data Capture vengono creati e rilasciati usando rispettivamente le stored procedure [sys.sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) e [sys.sp_cdc_drop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-drop-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="eea84-229">Internally, change data capture agent jobs are created and dropped by using the stored procedures [sys.sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) and [sys.sp_cdc_drop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-drop-job-transact-sql), respectively.</span></span> <span data-ttu-id="eea84-230">Tali stored procedure vengono inoltre esposte in modo che gli amministratori possano controllare la creazione e la rimozione dei processi.</span><span class="sxs-lookup"><span data-stu-id="eea84-230">These stored procedures are also exposed so that administrators can control the creation and removal of these jobs.</span></span>  
  
 <span data-ttu-id="eea84-231">Un amministratore non dispone di alcun controllo esplicito sulla configurazione predefinita dei processi dell'agente di Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="eea84-231">An administrator has no explicit control over the default configuration of the change data capture agent jobs.</span></span> <span data-ttu-id="eea84-232">A tale scopo viene fornita la stored procedure [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) che consente di modificare i parametri di configurazione predefiniti.</span><span class="sxs-lookup"><span data-stu-id="eea84-232">The stored procedure [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) is provided to allow the default configuration parameters to be modified.</span></span> <span data-ttu-id="eea84-233">Inoltre, la stored procedure [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) consente di visualizzare i parametri di configurazione correnti.</span><span class="sxs-lookup"><span data-stu-id="eea84-233">In addition, the stored procedure [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) allows current configuration parameters to be viewed.</span></span> <span data-ttu-id="eea84-234">Sia il processo di acquisizione che quello di pulizia estraggono parametri di configurazione dalla tabella msdb.dbo.cdc_jobs all'avvio.</span><span class="sxs-lookup"><span data-stu-id="eea84-234">Both the capture job and the cleanup job extract configuration parameters from the table msdb.dbo.cdc_jobs on startup.</span></span> <span data-ttu-id="eea84-235">Qualsiasi modifica apportata a tali valori usando [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) non avrà effetto finché il processo non viene arrestato e riavviato.</span><span class="sxs-lookup"><span data-stu-id="eea84-235">Any changes made to these values by using [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) will not take effect until the job is stopped and restarted.</span></span>  
  
 <span data-ttu-id="eea84-236">Per avviare e arrestare i processi dell'agente di Change Data Capture, sono disponibili due stored procedure aggiuntive, [sys.sp_cdc_start_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-start-job-transact-sql) e [sys.sp_cdc_stop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-stop-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="eea84-236">Two additional stored procedures are provided to allow the change data capture agent jobs to be started and stopped: [sys.sp_cdc_start_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-start-job-transact-sql) and [sys.sp_cdc_stop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-stop-job-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="eea84-237">L'avvio e l'arresto del processo di acquisizione non comportano alcuna perdita dei dati delle modifiche,</span><span class="sxs-lookup"><span data-stu-id="eea84-237">Starting and stopping the capture job does not result in a loss of change data.</span></span> <span data-ttu-id="eea84-238">ma consentono solo di evitare che il processo esegua l'analisi del log per inserire voci di modifica nelle tabelle delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="eea84-238">It only prevents the capture process from actively scanning the log for change entries to deposit in the change tables.</span></span> <span data-ttu-id="eea84-239">Una strategia ragionevole per impedire che l'analisi del log aumenti il carico durante i periodi in cui la richiesta è massima consiste nell'arresto del processo e nel successivo riavvio quando la richiesta è diminuita.</span><span class="sxs-lookup"><span data-stu-id="eea84-239">A reasonable strategy to prevent log scanning from adding load during periods of peak demand is to stop the capture job and restart it when demand is reduced.</span></span>  
  
 <span data-ttu-id="eea84-240">Entrambi i processi di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent sono stati progettati per essere sufficientemente flessibili e configurabili in modo da soddisfare le esigenze di base degli ambienti in cui viene usata la funzionalità Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="eea84-240">Both [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs were designed to be flexible enough and sufficiently configurable to meet the basic needs of change data capture environments.</span></span> <span data-ttu-id="eea84-241">In entrambi casi, tuttavia, le stored procedure sottostanti che forniscono le funzionalità di base sono state esposte per poter applicare ulteriore personalizzazione.</span><span class="sxs-lookup"><span data-stu-id="eea84-241">In both cases, however, the underlying stored procedures that provide the core functionality have been exposed so that further customization is possible.</span></span>  
  
 <span data-ttu-id="eea84-242">Change Data Capture non funziona correttamente quando il servizio Motore di database o SQL Server Agent è in esecuzione con l'account NETWORK SERVICE.</span><span class="sxs-lookup"><span data-stu-id="eea84-242">Change data capture cannot function properly when the Database Engine service or the SQL Server Agent service is running under the NETWORK SERVICE account.</span></span> <span data-ttu-id="eea84-243">Questa situazione può generare l'errore 22832.</span><span class="sxs-lookup"><span data-stu-id="eea84-243">This can result in error 22832.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="eea84-244">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="eea84-244">See Also</span></span>  
 <span data-ttu-id="eea84-245">[Tenere traccia delle modifiche ai dati &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="eea84-245">[Track Data Changes &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="eea84-246">[Abilitare e disabilitare Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="eea84-246">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="eea84-247">[Usare Change Data &#40;SQL Server&#41;](../track-changes/work-with-change-data-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="eea84-247">[Work with Change Data &#40;SQL Server&#41;](../track-changes/work-with-change-data-sql-server.md) </span></span>  
 [<span data-ttu-id="eea84-248">Amministrare e monitorare Change Data Capture &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="eea84-248">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
