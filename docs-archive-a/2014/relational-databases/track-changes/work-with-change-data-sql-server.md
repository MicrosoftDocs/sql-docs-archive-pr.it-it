---
title: Usare i dati delle modifiche (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data [SQL Server]
- change data capture [SQL Server], query function scenarios
- change data capture [SQL Server], LSN boundaries
- change data capture [SQL Server], query functions
ms.assetid: 5346b852-1af8-4080-b278-12efb9b735eb
author: rothja
ms.author: jroth
ms.openlocfilehash: 018d5add95e5d0936f6055e1c6710b6a8ddabdab
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87630384"
---
# <a name="work-with-change-data-sql-server"></a><span data-ttu-id="50c15-102">Utilizzare i dati delle modifiche (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="50c15-102">Work with Change Data (SQL Server)</span></span>
  <span data-ttu-id="50c15-103">I dati delle modifiche vengono resi disponibili ai consumer della funzionalità Change Data Capture tramite funzioni con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="50c15-103">Change data is made available to change data capture consumers through table-valued functions (TVFs).</span></span> <span data-ttu-id="50c15-104">Per tutte le query di queste funzioni sono necessari due parametri che definiscono l'intervallo di numeri di sequenza del file di log (LSN) idonei durante lo sviluppo del set di risultati restituito.</span><span class="sxs-lookup"><span data-stu-id="50c15-104">All queries of these functions require two parameters to define the range of Log Sequence Numbers (LSNs) that are eligible for consideration when developing the returned result set.</span></span> <span data-ttu-id="50c15-105">Entrambi i valori LSN che rappresentano il limite inferiore e quello superiore dell'intervallo sono inclusi nell'intervallo stesso.</span><span class="sxs-lookup"><span data-stu-id="50c15-105">Both the upper and lower LSN values that bound the interval are considered to be included within the interval.</span></span>  
  
 <span data-ttu-id="50c15-106">Per stabilire i valori LSN appropriati da utilizzare per l'esecuzione di query su una funzione con valori di tabella, sono disponibili numerose funzioni.</span><span class="sxs-lookup"><span data-stu-id="50c15-106">Several functions are provided to help determine appropriate LSN values for use in querying a TVF.</span></span> <span data-ttu-id="50c15-107">La funzione [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) restituisce il valore LSN meno elevato associato a un intervallo di validità di un'istanza di acquisizione,</span><span class="sxs-lookup"><span data-stu-id="50c15-107">The function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) returns the smallest LSN that is associated with a capture instance validity interval.</span></span> <span data-ttu-id="50c15-108">ovvero all'intervallo di tempo durante il quale i dati delle modifiche rimangono disponibili per le relative istanze di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="50c15-108">The validity interval is the time interval for which change data is currently available for its capture instances.</span></span> <span data-ttu-id="50c15-109">La funzione [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) restituisce il valore LSN più elevato nell'intervallo di validità.</span><span class="sxs-lookup"><span data-stu-id="50c15-109">The function [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) returns the largest LSN in the validity interval.</span></span> <span data-ttu-id="50c15-110">Le funzioni [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) e [sys.fn_cdc_map_lsn_to_time](/sql/relational-databases/system-functions/sys-fn-cdc-map-lsn-to-time-transact-sql) possono essere usate per includere i valori LSN in una cronologia convenzionale.</span><span class="sxs-lookup"><span data-stu-id="50c15-110">The functions [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) and [sys.fn_cdc_map_lsn_to_time](/sql/relational-databases/system-functions/sys-fn-cdc-map-lsn-to-time-transact-sql) are available to help place LSN values on a conventional timeline.</span></span> <span data-ttu-id="50c15-111">Poiché in Change Data Capture vengono utilizzati intervalli di query chiusi, talvolta risulta necessario generare il valore LSN successivo in una sequenza per garantire che le modifiche non vengano duplicate in finestre di query consecutive.</span><span class="sxs-lookup"><span data-stu-id="50c15-111">Because change data capture uses closed query intervals, it is sometimes necessary to generate the next LSN value in a sequence to ensure that changes are not duplicated in consecutive query windows.</span></span> <span data-ttu-id="50c15-112">Le funzioni [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) e [sys.fn_cdc_decrement_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-decrement-lsn-transact-sql) sono utili quando è necessario modificare in modo incrementale un valore LSN.</span><span class="sxs-lookup"><span data-stu-id="50c15-112">The functions [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) and [sys.fn_cdc_decrement_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-decrement-lsn-transact-sql) are useful when an incremental adjustment to an LSN value is required.</span></span>  
  
##  <a name="validating-lsn-boundaries"></a><a name="LSN"></a> <span data-ttu-id="50c15-113">Convalida dei limiti LSN</span><span class="sxs-lookup"><span data-stu-id="50c15-113">Validating LSN Boundaries</span></span>  
 <span data-ttu-id="50c15-114">È consigliabile convalidare i limiti LSN da utilizzare in una query con funzione con valori di tabella prima dell'utilizzo.</span><span class="sxs-lookup"><span data-stu-id="50c15-114">We recommend validating the LSN boundaries that are to be used in a TVF query before their use.</span></span> <span data-ttu-id="50c15-115">Endpoint con valore Null oppure endpoint esterni all'intervallo di validità per un'istanza di acquisizione provocheranno la restituzione di un errore da parte di una funzione con valori di tabella relativa a Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="50c15-115">Null endpoints or endpoints that lie outside the validity interval for a capture instance will force an error to be returned by a change data capture TVF.</span></span>  
  
 <span data-ttu-id="50c15-116">L'errore seguente viene ad esempio restituito per una query per tutte le modifiche quando un parametro utilizzato per definire l'intervallo di query non è valido, non è compreso nell'intervallo oppure l'opzione del filtro di riga non è valida.</span><span class="sxs-lookup"><span data-stu-id="50c15-116">For example, the following error is returned for a query for all changes when a parameter that is used to define the query interval is not valid, or is out of range, or the row filter option is invalid.</span></span>  
  
 `Msg 313, Level 16, State 3, Line 1`  
  
 `An insufficient number of arguments were supplied for the procedure or function cdc.fn_cdc_get_all_changes_ ...`  
  
 <span data-ttu-id="50c15-117">L'errore corrispondente restituito per una query `net changes` è il seguente:</span><span class="sxs-lookup"><span data-stu-id="50c15-117">The corresponding error returned for a `net changes` query is the following:</span></span>  
  
 `Msg 313, Level 16, State 3, Line 1`  
  
 `An insufficient number of arguments were supplied for the procedure or function cdc.fn_cdc_get_net_changes_ ...`  
  
> [!NOTE]  
>  <span data-ttu-id="50c15-118">È noto che il messaggio 313 è fuorviante e non indica la causa effettiva dell'errore.</span><span class="sxs-lookup"><span data-stu-id="50c15-118">It is recognized that the message for Msg 313 is misleading and does not convey the actual cause of the failure.</span></span> <span data-ttu-id="50c15-119">Questo utilizzo non opportuno del messaggio deriva dall'impossibilità di generare un errore esplicito dall'interno di una funzione con valori di tabella.</span><span class="sxs-lookup"><span data-stu-id="50c15-119">This awkward usage stems from the inability to raise an explicit error from within a TVF.</span></span> <span data-ttu-id="50c15-120">Si è tuttavia ritenuto preferibile restituire un errore riconoscibile, sebbene inaccurato, rispetto a non restituire alcun risultato.</span><span class="sxs-lookup"><span data-stu-id="50c15-120">Nevertheless, the value of returning a recognizable, if inaccurate, error was deemed preferable to simply returning an empty result.</span></span> <span data-ttu-id="50c15-121">Un set di risultati vuoto non sarebbe infatti distinguibile da una query valida che non restituisce alcuna modifica.</span><span class="sxs-lookup"><span data-stu-id="50c15-121">An empty result set would not be distinguishable from a valid query returning no changes.</span></span>  
  
 <span data-ttu-id="50c15-122">Quando viene eseguita una query per tutte le modifiche, gli errori di autorizzazione negata restituiranno altri errori, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="50c15-122">Authorization failures will return failures when querying for all changes, as shown:</span></span>  
  
 `Msg 229, Level 14, State 5, Line 1`  
  
 `The SELECT permission was denied on the object 'fn_cdc_get_all_changes_...', database 'MyDB', schema 'cdc'.`  
  
 <span data-ttu-id="50c15-123">Lo stesso messaggio è valido in caso di esecuzione di una query per le modifiche totali:</span><span class="sxs-lookup"><span data-stu-id="50c15-123">The same is true when querying for net changes:</span></span>  
  
 `Msg 229, Level 14, State 5, Line 1`  
  
 `The SELECT permission was denied on the object fn_cdc_get_net_changes_...', database 'MyDB', schema 'cdc'.`  
  
 <span data-ttu-id="50c15-124">Vedere il modello Enumerate Net Changes Using TRY CATCH per una dimostrazione di come vengono intercettati questi errori noti relativi alle funzioni con valori di tabella e come vengono restituite informazioni più significative relative all'errore.</span><span class="sxs-lookup"><span data-stu-id="50c15-124">See the template Enumerate Net Changes Using TRY CATCH for a demonstration of how to intercept these known TVF errors and return more meaningful information about the failure.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="50c15-125">Per trovare i modelli di Change Data Capture in SQL Server Management Studio, scegliere **Esplora modelli** dal menu **Visualizza**, espandere **Modelli di SQL Server** , quindi espandere la cartella **Change Data Capture** .</span><span class="sxs-lookup"><span data-stu-id="50c15-125">To locate change data capture templates in SQL Server Management Studio, on the **View** menu, click **Template Explorer**, expand **SQL Server Templates** and then expand the **Change Data Capture** folder.</span></span>  
  
##  <a name="query-functions"></a><a name="Functions"></a> <span data-ttu-id="50c15-126">Funzioni di query</span><span class="sxs-lookup"><span data-stu-id="50c15-126">Query Functions</span></span>  
 <span data-ttu-id="50c15-127">A seconda delle caratteristiche della tabella di origine per cui viene eseguito il rilevamento delle modifiche e del modo in cui la relativa istanza di acquisizione viene configurata, vengono generate una o due funzioni con valori di tabella per l'esecuzione di query sui dati delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="50c15-127">Depending on the characteristics of the source table being tracked and the way in which its capture instance is configured, either one or two TVFs for querying change data are generated.</span></span>  
  
-   <span data-ttu-id="50c15-128">La funzione [cdc.fn_cdc_get_all_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql) restituisce tutte le modifiche che si sono verificate per l'intervallo specificato.</span><span class="sxs-lookup"><span data-stu-id="50c15-128">The function [cdc.fn_cdc_get_all_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql) returns all changes that occurred for the specified interval.</span></span> <span data-ttu-id="50c15-129">Questa funzione viene sempre generata.</span><span class="sxs-lookup"><span data-stu-id="50c15-129">This function is always generated.</span></span> <span data-ttu-id="50c15-130">Le voci vengono restituite sempre in modo ordinato, prima in base al valore LSN del commit della transazione e successivamente in base a un valore che ordina in sequenza la modifica all'interno della transazione.</span><span class="sxs-lookup"><span data-stu-id="50c15-130">Entries are always returned sorted, first by the transaction commit LSN of the change, and then by a value that sequences the change within its transaction.</span></span> <span data-ttu-id="50c15-131">A seconda dell'opzione del filtro di riga scelta, un aggiornamento può comportare la restituzione della riga finale (opzione del filtro di riga "all") o dei valori nuovi e precedenti (opzione del filtro di riga "all update old").</span><span class="sxs-lookup"><span data-stu-id="50c15-131">Depending on the row filter option chosen, either the final row is returned on update (row filter option "all") or both the new and old values are returned on update (row filter option "all update old"').</span></span>  
  
-   <span data-ttu-id="50c15-132">La funzione [cdc.fn_cdc_get_net_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql) viene generata quando il parametro @supports_net_changes è impostato su 1 e la tabella di origine è abilitata.</span><span class="sxs-lookup"><span data-stu-id="50c15-132">The function [cdc.fn_cdc_get_net_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql) is generated when the parameter @supports_net_changes is set to 1 when the source table is enabled.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="50c15-133">Questa opzione è supportata solo se la tabella di origine contiene una chiave primaria definita o se il parametro @index_name è stato usato per identificare un indice univoco.</span><span class="sxs-lookup"><span data-stu-id="50c15-133">This option is only supported if the source table has a defined primary key or if the parameter @index_name has been used to identify a unique index.</span></span>  
  
     <span data-ttu-id="50c15-134">La funzione **netchanges** restituisce una modifica per ogni riga della tabella di origine modificata.</span><span class="sxs-lookup"><span data-stu-id="50c15-134">The **netchanges** function returns one change per modified source table row.</span></span> <span data-ttu-id="50c15-135">Se durante l'intervallo specificato viene registrata più di una modifica relativa alla riga, i valori della colonna rifletteranno i contenuti finali della riga.</span><span class="sxs-lookup"><span data-stu-id="50c15-135">If more than one change is logged for the row during the specified interval, the column values will reflect the final contents of the row.</span></span> <span data-ttu-id="50c15-136">Per identificare correttamente l'operazione necessaria all'aggiornamento dell'ambiente di destinazione, è necessario che nella funzione con valori di tabella vengano considerate sia l'operazione iniziale sulla riga durante l'intervallo sia l'operazione finale sulla riga stessa.</span><span class="sxs-lookup"><span data-stu-id="50c15-136">To correctly identify the operation that is necessary to update the target environment, the TVF must consider both the initial operation on the row during the interval and the final operation on the row.</span></span> <span data-ttu-id="50c15-137">Quando viene specificata l'opzione del filtro di riga 'all', le operazioni restituite da una query `net changes` vengono inserite, eliminate o aggiornate (valori nuovi).</span><span class="sxs-lookup"><span data-stu-id="50c15-137">When the row filter option 'all' is specified, the operations that are returned by a `net changes` query will either be insert, delete, or update (new values).</span></span> <span data-ttu-id="50c15-138">Questa opzione restituisce sempre un valore Null per la maschera di aggiornamento perché al calcolo di una maschera di aggregazione è associato un costo.</span><span class="sxs-lookup"><span data-stu-id="50c15-138">This option always returns the update mask as null because there is a cost associated with computing an aggregate mask.</span></span> <span data-ttu-id="50c15-139">Se è necessaria una maschera di aggregazione che rifletta tutte le modifiche apportate a una riga, utilizzare l'opzione 'all with mask'.</span><span class="sxs-lookup"><span data-stu-id="50c15-139">If you require an aggregate mask that reflects all changes to a row, use the 'all with mask' option.</span></span> <span data-ttu-id="50c15-140">Se l'elaborazione a valle non richiede la distinzione tra operazioni di inserimento e di aggiornamento, utilizzare l'opzione 'all with merge'.</span><span class="sxs-lookup"><span data-stu-id="50c15-140">If downstream processing does not require inserts and updates to be distinguished, use the 'all with merge' option.</span></span> <span data-ttu-id="50c15-141">In questo caso, il valore dell'operazione accetterà solo due valori, 1 per l'eliminazione e 5 per un'operazione che potrebbe essere un inserimento o un aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="50c15-141">In this case, the operation value will only take on two values: 1 for delete and 5 for an operation that could be either an insert or an update.</span></span> <span data-ttu-id="50c15-142">Questa opzione elimina le operazioni di elaborazione aggiuntive necessarie per determinare se l'operazione derivata deve essere un inserimento o un aggiornamento e può migliorare le prestazioni della query quando questa differenziazione non è necessaria.</span><span class="sxs-lookup"><span data-stu-id="50c15-142">This option eliminates the additional processing needed to determine whether the derived operation should be an insert or an update, and can improve the performance of the query when this differentiation is not necessary.</span></span>  
  
 <span data-ttu-id="50c15-143">La maschera di aggiornamento restituita da una funzione della query è una rappresentazione compatta che identifica tutte le colonne modificate in una riga di dati delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="50c15-143">The update mask that is returned from a query function is a compact representation that identifies all columns that changed in a row of change data.</span></span> <span data-ttu-id="50c15-144">Generalmente, queste informazioni sono necessarie solo per un subset delle colonne acquisite di dimensioni ridotte.</span><span class="sxs-lookup"><span data-stu-id="50c15-144">Typically, this information is only required for a small subset of the captured columns.</span></span> <span data-ttu-id="50c15-145">Le funzioni sono disponibili per consentire l'estrazione delle informazioni dalla maschera in una forma utilizzabile dalle applicazioni in modo più diretto.</span><span class="sxs-lookup"><span data-stu-id="50c15-145">Functions are available to assist in extracting information from the mask in a form that is more directly usable by applications.</span></span> <span data-ttu-id="50c15-146">La funzione [sys.fn_cdc_get_column_ordinal](/sql/relational-databases/system-functions/sys-fn-cdc-get-column-ordinal-transact-sql) restituisce la posizione ordinale di una colonna denominata per una determinata istanza di acquisizione, mentre la funzione [sys.fn_cdc_is_bit_set](/sql/relational-databases/system-functions/sys-fn-cdc-is-bit-set-transact-sql) restituisce la parità del bit nella maschera fornita in base al numero ordinale passato nella chiamata alla funzione.</span><span class="sxs-lookup"><span data-stu-id="50c15-146">The function [sys.fn_cdc_get_column_ordinal](/sql/relational-databases/system-functions/sys-fn-cdc-get-column-ordinal-transact-sql) returns the ordinal position of a named column for a given capture instance, whereas the function [sys.fn_cdc_is_bit_set](/sql/relational-databases/system-functions/sys-fn-cdc-is-bit-set-transact-sql) returns the parity of the bit in the provided mask based on the ordinal that was passed in the function call.</span></span> <span data-ttu-id="50c15-147">Se utilizzate insieme, queste due funzioni consentono l'estrazione e la restituzione efficienti delle informazioni dalla maschera di aggiornamento con la richiesta dei dati delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="50c15-147">Together, these two functions allow information from the update mask to be efficiently extracted and returned with the request for change data.</span></span> <span data-ttu-id="50c15-148">Vedere il modello Enumerate Net Changes Using All With Mask per una dimostrazione di come utilizzare queste funzioni.</span><span class="sxs-lookup"><span data-stu-id="50c15-148">See the template Enumerate Net Changes Using All With Mask for a demonstration of how these functions are used.</span></span>  
  
##  <a name="query-function-scenarios"></a><a name="Scenarios"></a> <span data-ttu-id="50c15-149">Scenari di funzioni di query</span><span class="sxs-lookup"><span data-stu-id="50c15-149">Query Function Scenarios</span></span>  
 <span data-ttu-id="50c15-150">Nelle sezioni seguenti vengono descritti scenari comuni per l'esecuzione di query sui dati di Change Data Capture tramite le funzioni di query cdc.fn_cdc_get_all_changes_<capture_instance> e cdc.fn_cdc_get_net_changes_<capture_instance>.</span><span class="sxs-lookup"><span data-stu-id="50c15-150">The following sections describe common scenarios for querying change data capture data by using the query functions cdc.fn_cdc_get_all_changes_<capture_instance> and cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span>  
  
### <a name="querying-for-all-changes-within-the-capture-instance-validity-interval"></a><span data-ttu-id="50c15-151">Esecuzione di query per tutte le modifiche comprese nell'intervallo di validità dell'istanza di acquisizione</span><span class="sxs-lookup"><span data-stu-id="50c15-151">Querying for All Changes Within the Capture Instance Validity Interval</span></span>  
 <span data-ttu-id="50c15-152">La richiesta più diretta di dati delle modifiche consiste nella restituzione di tutti i dati delle modifiche correnti compresi nell'intervallo di validità di un'istanza di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="50c15-152">The most straightforward request for change data is one that returns all of the current change data in a capture instance's validity interval.</span></span> <span data-ttu-id="50c15-153">Per eseguire questa richiesta, determinare innanzitutto i limiti LSN superiore e inferiore dell'intervallo di validità.</span><span class="sxs-lookup"><span data-stu-id="50c15-153">To make this request, first determine the lower and upper LSN boundaries of the validity interval.</span></span> <span data-ttu-id="50c15-154">Usare quindi questi valori per identificare i parametri @from_lsn e@to_lsn passati alla funzione di query cdc.fn_cdc_get_all_changes_<capture_instance> o cdc.fn_cdc_get_net_changes_<capture_instance>.</span><span class="sxs-lookup"><span data-stu-id="50c15-154">Then, use these values to identify the parameters @from_lsn and @to_lsn passed to the query function cdc.fn_cdc_get_all_changes_<capture_instance> or cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span> <span data-ttu-id="50c15-155">Usare la funzione [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) per ottenere il limite inferiore e [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) per ottenere il limite superiore.</span><span class="sxs-lookup"><span data-stu-id="50c15-155">Use the function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) to obtain the lower bound, and [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) to obtain the upper bound.</span></span> <span data-ttu-id="50c15-156">Vedere il modello Enumerate All Changes for the Valid Range affinché nel codice di esempio venga eseguita una query per tutte le modifiche valide correnti tramite la funzione di query cdc.fn_cdc_get_all_changes_<capture_instance>.</span><span class="sxs-lookup"><span data-stu-id="50c15-156">See the template Enumerate All Changes for the Valid Range for sample code to query for all current valid changes by using the query function cdc.fn_cdc_get_all_changes_<capture_instance>.</span></span> <span data-ttu-id="50c15-157">Vedere il modello Enumerate Net Changes for the Valid Range per un esempio simile relativo all'utilizzo della funzione cdc.fn_cdc_get_net_changes_<capture_instance>.</span><span class="sxs-lookup"><span data-stu-id="50c15-157">See the template Enumerate Net Changes for the Valid Range for a similar example of using the function cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span>  
  
### <a name="querying-for-all-new-changes-since-the-last-set-of-changes"></a><span data-ttu-id="50c15-158">Esecuzione di query per tutte le nuove modifiche successive all'ultimo set di modifiche</span><span class="sxs-lookup"><span data-stu-id="50c15-158">Querying for All New Changes Since the Last Set of Changes</span></span>  
 <span data-ttu-id="50c15-159">Per applicazioni tipiche, il processo di esecuzione di query per i dati delle modifiche è continuo, con richieste periodiche di tutte le modifiche apportate dopo l'ultima richiesta.</span><span class="sxs-lookup"><span data-stu-id="50c15-159">For typical applications, querying for change data will be an ongoing process, making periodic requests for all of the changes that occurred since the last request.</span></span> <span data-ttu-id="50c15-160">Per query di questo tipo, è possibile usare la funzione [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) per dedurre il limite inferiore della query corrente dal limite superiore della query precedente.</span><span class="sxs-lookup"><span data-stu-id="50c15-160">For such queries, you can use the function [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) to derive the lower bound of the current query from the upper bound of the previous query.</span></span> <span data-ttu-id="50c15-161">Tramite questo metodo è possibile garantire che nessuna riga venga ripetuta perché l'intervallo di query viene sempre considerato come un intervallo chiuso dove entrambi gli endpoint sono inclusi nell'intervallo.</span><span class="sxs-lookup"><span data-stu-id="50c15-161">This method ensures that no rows are repeated because the query interval is always treated as a closed interval where both end-points are included in the interval.</span></span> <span data-ttu-id="50c15-162">Usare la funzione [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) per ottenere l'endpoint alto per il nuovo intervallo della richiesta.</span><span class="sxs-lookup"><span data-stu-id="50c15-162">Then, use the function [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) to obtain the high end-point for the new request interval.</span></span> <span data-ttu-id="50c15-163">Vedere il modello Enumerate All Changes Since Previous Request affinché nel codice di esempio la finestra Query venga spostata sistematicamente per ottenere tutte le modifiche apportate dopo l'ultima richiesta.</span><span class="sxs-lookup"><span data-stu-id="50c15-163">See the template Enumerate All Changes Since Previous Request for sample code to systematically move the query window to obtain all changes since the last request.</span></span>  
  
### <a name="querying-for-all-new-changes-up-until-now"></a><span data-ttu-id="50c15-164">Esecuzione di query per tutte le nuove modifiche apportate finora</span><span class="sxs-lookup"><span data-stu-id="50c15-164">Querying for all New Changes Up Until Now</span></span>  
 <span data-ttu-id="50c15-165">Un vincolo tipico posto sulle modifiche restituite da una funzione di query consiste nella necessità di dover includere solo le modifiche che si sono verificate tra la richiesta precedente e la data e l'ora correnti.</span><span class="sxs-lookup"><span data-stu-id="50c15-165">A typical constraint that is placed on the changes returned by a query function is to include only the changes that occurred between the previous request until the current date and time.</span></span> <span data-ttu-id="50c15-166">Per questa query, applicare la funzione sys.fn_cdc_increment_lsn al valore @from_lsn usato nella richiesta precedente per determinare il limite inferiore.</span><span class="sxs-lookup"><span data-stu-id="50c15-166">For this query, apply the function sys.fn_cdc_increment_lsn to the @from_lsn value that was used in the previous request to determine the lower bound.</span></span> <span data-ttu-id="50c15-167">Poiché il limite superiore dell'intervallo di tempo viene espresso come momento specifico nel tempo, è necessario convertirlo in un valore LSN prima che possa essere utilizzato da una funzione di query.</span><span class="sxs-lookup"><span data-stu-id="50c15-167">Because the upper bound on the time interval is expressed as a specific point in time, it must be converted to an LSN value before it can be used by a query function.</span></span> <span data-ttu-id="50c15-168">Prima di poter convertire il valore datetime in un valore LSN corrispondente, è necessario assicurarsi che il processo di acquisizione abbia elaborato tutte le modifiche di cui è stato eseguito il commit attraverso il limite superiore specificato.</span><span class="sxs-lookup"><span data-stu-id="50c15-168">Before the datetime value can be converted to a corresponding LSN value, you must ensure that the capture process has processed all changes that were committed through the specified upper bound.</span></span> <span data-ttu-id="50c15-169">Solo così è possibile assicurarsi che tutte le modifiche valide siano state propagate alla tabella delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="50c15-169">This is required to ensure that all the qualifying changes have been propagated to the change table.</span></span> <span data-ttu-id="50c15-170">Un modo possibile per eseguire questa operazione consiste nel strutturare un ciclo di attesa che controlli periodicamente se il valore LSN di commit massimo corrente registrato per qualsiasi tabella delle modifiche del database supera l'ora di fine desiderata dell'intervallo della richiesta.</span><span class="sxs-lookup"><span data-stu-id="50c15-170">One way to do this is to structure a wait loop that periodically checks to see if the current maximum commit lsn recorded for any database change table exceeds the desired end time of the request interval.</span></span>  
  
 <span data-ttu-id="50c15-171">Dopo che il ciclo di ritardo verifica se il processo di acquisizione abbia già elaborato tutte le voci di log rilevanti, usare la funzione [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) per determinare il nuovo endpoint alto espresso come un valore LSN.</span><span class="sxs-lookup"><span data-stu-id="50c15-171">After the delay loop verifies that the capture process has already processed all the relevant log entries, use the function [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) to determine the new high end-point expressed as an LSN value.</span></span> <span data-ttu-id="50c15-172">Per assicurarsi che tutte le voci di cui è stato eseguito il commit nel periodo di tempo specificato siano state recuperate, chiamare la funzione sys.fn_cdc_map_time_to_lsn e utilizzare l'opzione 'largest less than or equal'.</span><span class="sxs-lookup"><span data-stu-id="50c15-172">To ensure that all entries that were committed through the specified time are retrieved, call the function sys.fn_cdc_map_time_to_lsn, and use the option 'largest less than or equal'.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="50c15-173">In periodi di inattività, viene aggiunta una voce fittizia alla tabella cdc.lsn_time_mapping per contrassegnare il fatto che il processo di acquisizione ha elaborato le modifiche entro un periodo di commit specificato.</span><span class="sxs-lookup"><span data-stu-id="50c15-173">In periods of inactivity, a dummy entry is added to the table cdc.lsn_time_mapping to mark the fact that the capture process has processed the changes up to a given commit time.</span></span> <span data-ttu-id="50c15-174">Ciò evita che il processo sembri in ritardo con l'acquisizione, quando invece semplicemente non esistono modifiche recenti da elaborare.</span><span class="sxs-lookup"><span data-stu-id="50c15-174">This prevents it from appearing that the capture process has fallen behind when there are simply no recent changes to process.</span></span>  
  
 <span data-ttu-id="50c15-175">Il modello Enumerate All Changes Up Until Now è una dimostrazione di come utilizzare la strategia precedente per eseguire query per i dati delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="50c15-175">The template Enumerate All Changes Up Until Now demonstrates how to use the previous strategy to query for change data.</span></span>  
  
### <a name="adding-a-commit-time-to-an-all-changes-result-set"></a><span data-ttu-id="50c15-176">Aggiunta di un'ora di commit a un set di risultati di tutte le modifiche</span><span class="sxs-lookup"><span data-stu-id="50c15-176">Adding a Commit Time to an All Changes Result Set</span></span>  
 <span data-ttu-id="50c15-177">L'ora di commit di ogni transazione con una voce associata in una tabella delle modifiche del database è disponibile nella tabella [cdc.lsn_time_mapping](/sql/relational-databases/system-tables/cdc-lsn-time-mapping-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="50c15-177">The commit time of each transaction with an associated entry in a database change table is available in the table [cdc.lsn_time_mapping](/sql/relational-databases/system-tables/cdc-lsn-time-mapping-transact-sql).</span></span> <span data-ttu-id="50c15-178">Unendo in join il valore __$start_lsn restituito in una richiesta di tutte le modifiche al valore start_lsn di una voce della tabella cdc.lsn_time_mapping, è possibile restituire il valore tran_end_time insieme ai dati delle modifiche per contrassegnare la modifica con l'ora di commit della transazione all'origine.</span><span class="sxs-lookup"><span data-stu-id="50c15-178">By joining the __$start_lsn value returned in a request for all changes with the start_lsn value of a cdc.lsn_time_mapping table entry, you can return the tran_end_time along with the change data to stamp the change with the commit time of the transaction at the source.</span></span> <span data-ttu-id="50c15-179">Il modello Append Commit Time to All Changes Result Set è una dimostrazione di come eseguire questo join.</span><span class="sxs-lookup"><span data-stu-id="50c15-179">The template Append Commit Time to All Changes Result Set demonstrates how to perform this join.</span></span>  
  
### <a name="joining-change-data-with-other-data-from-the-same-transaction"></a><span data-ttu-id="50c15-180">Join dei dati delle modifiche con altri dati della stessa transazione</span><span class="sxs-lookup"><span data-stu-id="50c15-180">Joining Change Data with Other Data from the Same Transaction</span></span>  
 <span data-ttu-id="50c15-181">È talvolta utile creare un join dei dati delle modifiche con altre informazioni raccolte sulla transazione quando il relativo commit viene eseguito all'origine.</span><span class="sxs-lookup"><span data-stu-id="50c15-181">Occasionally, it is useful to join change data with other information gathered about the transaction when it committed at the source.</span></span> <span data-ttu-id="50c15-182">Nella colonna tran_begin_lsn della tabella cdc.lsn_time_mapping sono contenute le informazioni necessarie per eseguire questo join.</span><span class="sxs-lookup"><span data-stu-id="50c15-182">The tran_begin_lsn column in the table cdc.lsn_time_mapping provides the information needed to perform such a join.</span></span> <span data-ttu-id="50c15-183">Quando si verifica l'aggiornamento dell'origine, il valore di database_transaction_begin_lsn della vista dinamica del sistema [sys.dm_tran_database_transactions](/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions-transact-sql) deve essere salvato insieme a qualsiasi altra informazione da unire con i dati delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="50c15-183">When the update of the source occurs, the value for database_transaction_begin_lsn from the system dynamic view [sys.dm_tran_database_transactions](/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions-transact-sql) must be saved along with any other information to be joined with the change data.</span></span> <span data-ttu-id="50c15-184">Utilizzare la funzione fn_convertnumericlsntobinary per confrontare i valori database_transaction_begin_lsn e tran_begin_lsn.</span><span class="sxs-lookup"><span data-stu-id="50c15-184">Use the function fn_convertnumericlsntobinary to compare the database_transaction_begin_lsn and tran_begin_lsn values.</span></span> <span data-ttu-id="50c15-185">Il codice per creare questa funzione è disponibile nel modello Create Function fn_convertnumericlsntobinary.</span><span class="sxs-lookup"><span data-stu-id="50c15-185">The code to create this function is available in the template Create Function fn_convertnumericlsntobinary.</span></span> <span data-ttu-id="50c15-186">Il modello Return All Changes with a Given tran_begin_lsn è una dimostrazione di come attuare il join.</span><span class="sxs-lookup"><span data-stu-id="50c15-186">The template Return All Changes with a Given tran_begin_lsn demonstrates how to effect the join.</span></span>  
  
### <a name="querying-using-datetime-wrapper-functions"></a><span data-ttu-id="50c15-187">Esecuzione di query utilizzando le funzioni del wrapper datetime</span><span class="sxs-lookup"><span data-stu-id="50c15-187">Querying Using Datetime Wrapper Functions</span></span>  
 <span data-ttu-id="50c15-188">Un tipico scenario dell'applicazione relativo all'esecuzione di query per i dati delle modifiche consiste nel richiedere periodicamente i dati delle modifiche tramite una finestra temporale scorrevole delimitata da valori datetime.</span><span class="sxs-lookup"><span data-stu-id="50c15-188">A typical application scenario for querying for change data is to periodically request change data by using a sliding window bounded by datetime values.</span></span> <span data-ttu-id="50c15-189">Per questa classe di consumer, Change Data Capture fornisce la stored procedure [sys.sp_cdc_generate_wrapper_function](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql) che consente di generare script per creare funzioni wrapper personalizzate per le funzioni di query di Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="50c15-189">For this class of consumers, change data capture provides the stored procedure [sys.sp_cdc_generate_wrapper_function](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql) that generates scripts to create custom wrapper functions for the change data capture query functions.</span></span> <span data-ttu-id="50c15-190">Questi wrapper personalizzati consentono di esprimere l'intervallo di query come coppia datetime.</span><span class="sxs-lookup"><span data-stu-id="50c15-190">These custom wrappers allow the query interval to be expressed as a datetime pair.</span></span>  
  
 <span data-ttu-id="50c15-191">Le opzioni di chiamata per la stored procedure consentono di generare wrapper per tutte le istanze di acquisizione a cui può accedere il chiamante o per una sola istanza di acquisizione specificata.</span><span class="sxs-lookup"><span data-stu-id="50c15-191">Calling options for the stored procedure allow for wrappers to be generated for all capture instances that the caller has access to, or only a specified capture instance.</span></span> <span data-ttu-id="50c15-192">Le opzioni supportate includono inoltre la possibilità di specificare se l'endpoint alto dell'intervallo di acquisizione deve essere aperto o chiuso, quale colonna acquisita disponibile deve essere inclusa nel set di risultati e a quali colonne incluse è necessario associare flag di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="50c15-192">Supported options also include the ability to specify whether the high end-point of the capture interval should be open or closed, which of the available captured columns should be included in the result set and which of the included columns should have associated update flags.</span></span> <span data-ttu-id="50c15-193">La procedura restituisce un set di risultati con due colonne: il nome della funzione generata, derivabile dal nome dell'istanza di acquisizione, e l'istruzione CREATE per la stored procedure del wrapper.</span><span class="sxs-lookup"><span data-stu-id="50c15-193">The procedure returns a result set with two columns: the generated function name, which is derivable from the capture instance name, and the create statement for the wrapper stored procedure.</span></span> <span data-ttu-id="50c15-194">La funzione per eseguire il wrapping della query di tutte le modifiche viene sempre generata.</span><span class="sxs-lookup"><span data-stu-id="50c15-194">The function to wrap the all changes query is always generated.</span></span> <span data-ttu-id="50c15-195">Se il parametro @supports_net_changes è stato impostato in fase di creazione dell'istanza di acquisizione, viene anche generata la funzione di wrapping della query per le modifiche delta.</span><span class="sxs-lookup"><span data-stu-id="50c15-195">If the @supports_net_changes parameter was set when the capture instance was created, the function to wrap the net changes function is also generated.</span></span>  
  
 <span data-ttu-id="50c15-196">È responsabilità del progettista dell'applicazione chiamare la stored procedure per la generazione dello script per generare le istruzioni CREATE per le stored procedure del wrapper ed eseguire gli script di creazione risultanti per creare le funzioni.</span><span class="sxs-lookup"><span data-stu-id="50c15-196">It is the responsibility of the application designer to call the script generation stored procedure to generate the create statements for the wrapper stored procedures, and to execute the resulting create scripts to create the functions.</span></span> <span data-ttu-id="50c15-197">Questo processo non viene eseguito automaticamente alla creazione di un'istanza di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="50c15-197">This does not occur automatically when a capture instance is created.</span></span>  
  
 <span data-ttu-id="50c15-198">I wrapper datetime sono di proprietà dell'utente e non vengono creati nello schema predefinito del chiamante.</span><span class="sxs-lookup"><span data-stu-id="50c15-198">Datetime wrappers are owned by the user, and not are created in the default schema of the caller.</span></span> <span data-ttu-id="50c15-199">La funzione generata è utilizzabile dalla maggior parte degli utenti senza necessità di apportare modifiche.</span><span class="sxs-lookup"><span data-stu-id="50c15-199">The generated function is suitable without modification for most users.</span></span> <span data-ttu-id="50c15-200">Lo script generato può comunque essere ulteriormente personalizzato prima di creare la funzione.</span><span class="sxs-lookup"><span data-stu-id="50c15-200">However, further customization can always be applied to the generated script prior to creating the function.</span></span>  
  
 <span data-ttu-id="50c15-201">Il nome della funzione di wrapping della query per tutte le modifiche è fn_all_changes_ seguito dal nome dell'istanza di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="50c15-201">The name of the function to wrap the all changes query is fn_all_changes_ followed by the capture instance name.</span></span> <span data-ttu-id="50c15-202">Il prefisso utilizzato per il wrapper delle modifiche delta è fn_net_changes_.</span><span class="sxs-lookup"><span data-stu-id="50c15-202">The prefix that is used for the net changes wrapper is fn_net_changes_.</span></span> <span data-ttu-id="50c15-203">Entrambe le funzioni accettano tre argomenti, proprio come le funzioni con valori di tabella di Change Data Capture associate.</span><span class="sxs-lookup"><span data-stu-id="50c15-203">Both functions take three arguments, just as their associated change data capture TVFs do.</span></span> <span data-ttu-id="50c15-204">Tuttavia, l'intervallo di query per i wrapper è limitato da due valori datetime e non da due valori LSN.</span><span class="sxs-lookup"><span data-stu-id="50c15-204">However, the query interval for the wrappers is bounded by two datetime values instead of than by two LSN values.</span></span> <span data-ttu-id="50c15-205">Il parametro @row_filter_option è identico per entrambi i set di funzioni.</span><span class="sxs-lookup"><span data-stu-id="50c15-205">The @row_filter_option parameter for both sets of functions are the same.</span></span>  
  
 <span data-ttu-id="50c15-206">Le funzioni wrapper generate supportano la convenzione seguente per l'esame sistematico della cronologia di Change Data Capture: si prevede che il parametro @end_time dell'intervallo precedente venga usato come parametro @start_time dell'intervallo successivo.</span><span class="sxs-lookup"><span data-stu-id="50c15-206">The generated wrapper functions support the following convention for systematically walking the change data capture timeline: It is expected that the @end_time parameter of the previous interval be used as the @start_time parameter of the subsequent interval.</span></span> <span data-ttu-id="50c15-207">La funzione wrapper esegue il mapping dei valori datetime ai valori LSN e si assicura che nessun dato venga perso o ripetuto se viene seguita questa convenzione.</span><span class="sxs-lookup"><span data-stu-id="50c15-207">The wrapper function takes care of mapping the datetime values to LSN values and ensuring that no data is lost or repeated if this convention is followed.</span></span>  
  
 <span data-ttu-id="50c15-208">È possibile generare i wrapper affinché supportino un limite superiore chiuso o un limite superiore aperto nella finestra di query specificata.</span><span class="sxs-lookup"><span data-stu-id="50c15-208">The wrappers can be generated to support either a closed upper bound or an open upper bound on the specified query window.</span></span> <span data-ttu-id="50c15-209">Il chiamante può quindi specificare se le voci con un'ora di commit corrispondente al limite superiore dell'intervallo di estrazione debbano essere incluse nell'intervallo.</span><span class="sxs-lookup"><span data-stu-id="50c15-209">That is, the caller can specify whether entries having a commit time equal to the upper bound of the extraction interval are to be included within the interval.</span></span> <span data-ttu-id="50c15-210">Per impostazione predefinita, il limite superiore è incluso.</span><span class="sxs-lookup"><span data-stu-id="50c15-210">By default, the upper bound is included.</span></span>  
  
 <span data-ttu-id="50c15-211">Se le funzioni con valori di tabella della query generata hanno esito negativo nel caso in cui venga fornito un valore Null per @from_lsn o @to_lsn, le funzioni del wrapper datetime usano Null per consentire ai wrapper datetime di restituire tutte le modifiche correnti.</span><span class="sxs-lookup"><span data-stu-id="50c15-211">While the generated query TVFs fail if supplied a null value for either the @from_lsn value or the @to_lsn value, the datetime wrapper functions use null to allow the datetime wrappers to return all current changes.</span></span> <span data-ttu-id="50c15-212">Se Null viene passato come endpoint basso della finestra di query al wrapper datetime, l'endpoint basso dell'intervallo di validità dell'istanza di acquisizione viene utilizzato nell'istruzione SELECT sottostante applicata alla funzione con valori di tabella della query.</span><span class="sxs-lookup"><span data-stu-id="50c15-212">That is, if null is passed as the low end-point of the query window to the datetime wrapper, the low end point of the capture instance validity interval is used in the underlying SELECT statement that is applied to the query TVF.</span></span> <span data-ttu-id="50c15-213">Analogamente, se Null viene passato come endpoint alto della finestra di query, l'endpoint alto dell'intervallo di validità dell'istanza di acquisizione viene utilizzato per la selezione eseguita dalla funzione con valori di tabella della query.</span><span class="sxs-lookup"><span data-stu-id="50c15-213">Similarly, if null is passed as the high end-point of the query window, the high end-point of the capture instance validity interval is used when selecting from the query TVF.</span></span>  
  
 <span data-ttu-id="50c15-214">Il set di risultati restituito da una funzione wrapper include tutte le colonne richieste seguite da una colonna dell'operazione, registrata come uno o due caratteri per identificare l'operazione associata alla riga.</span><span class="sxs-lookup"><span data-stu-id="50c15-214">The result set returned by a wrapper function includes all the requested columns followed by an operation column, recoded as one or two characters to identify the operation that is associated with the row.</span></span> <span data-ttu-id="50c15-215">Se sono stati richiesti flag di aggiornamento, vengono visualizzati come colonne bit dopo il codice dell'operazione, nell'ordine specificato nel parametro @update_flag_list.</span><span class="sxs-lookup"><span data-stu-id="50c15-215">If update flags have been requested, they appear as bit columns after the operation code, in the order specified in the @update_flag_list parameter.</span></span> <span data-ttu-id="50c15-216">Per informazioni sulle opzioni di chiamata per la personalizzazione dei wrapper datetime generati, vedere [sys.sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="50c15-216">For information about the calling options for customizing the generated datetime wrappers, see [sys.sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql).</span></span>  
  
 <span data-ttu-id="50c15-217">Il modello Instantiate a Wrapper TVF With Update Flag è una dimostrazione di come personalizzare una funzione wrapper generata per aggiungere un flag di aggiornamento per una colonna specificata al set di risultati restituito da una query delle modifiche delta.</span><span class="sxs-lookup"><span data-stu-id="50c15-217">The template Instantiate a Wrapper TVF With Update Flag shows how to customize a generated wrapper function to append an update flag for a specified column to the result set returned by a net changes query.</span></span> <span data-ttu-id="50c15-218">Il modello Instantiate CDC Wrapper TVFs for a Schema è una dimostrazione di come creare un'istanza dei wrapper datetime per le funzioni con valori di tabella delle query per tutte le istanze di acquisizione create per le tabelle di origine in un determinato schema del database.</span><span class="sxs-lookup"><span data-stu-id="50c15-218">The template Instantiate CDC Wrapper TVFs for a Schema shows how to instantiate the Datetime Wrappers for the Query TVFs for all of the capture instances created for the source tables in a given database schema.</span></span>  
  
 <span data-ttu-id="50c15-219">Per un esempio di utilizzo di un wrapper datetime per eseguire una query per i dati delle modifiche, vedere il modello Get Net Changes Using Wrapper With Update Flags.</span><span class="sxs-lookup"><span data-stu-id="50c15-219">For an example that uses a datetime wrapper to query for change data, see the template Get Net Changes Using Wrapper With Update Flags.</span></span> <span data-ttu-id="50c15-220">Questo modello è una dimostrazione di come eseguire query per le modifiche delta con una funzione wrapper quando il wrapper è configurato per la restituzione di flag di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="50c15-220">This template demonstrates how to query for net changes with a wrapper function when the wrapper is configured to return update flags.</span></span> <span data-ttu-id="50c15-221">Si noti che l'opzione del filtro di riga 'all with mask' è necessaria affinché la funzione di query sottostante restituisca una maschera di aggiornamento non Null all'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="50c15-221">Note that the row filter option 'all with mask' is required for the underlying query function to return a non-null update mask on update.</span></span> <span data-ttu-id="50c15-222">I valori Null vengono passati per i limiti inferiore e superiore dell'intervallo datetime per indicare alla funzione di utilizzare l'endpoint basso e l'endpoint alto dell'intervallo di validità per l'istanza di acquisizione durante l'esecuzione della query basata su LSN sottostante.</span><span class="sxs-lookup"><span data-stu-id="50c15-222">Null values are passed for both the lower and upper datetime interval boundaries to signal the function to use the low end point and the high end point of the validity interval for the capture instance when performing the underlying LSN based query.</span></span> <span data-ttu-id="50c15-223">La query restituisce una riga per ogni modifica a una riga di origine che si è verificata nell'intervallo valido per l'istanza di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="50c15-223">The query returns one row for each modification to a source row that occurred within the valid range for the capture instance.</span></span>  
  
### <a name="using-the-datetime-wrapper-functions-to-transition-between-capture-instances"></a><span data-ttu-id="50c15-224">Utilizzo delle funzioni wrapper datetime per la transizione tra istanze di acquisizione</span><span class="sxs-lookup"><span data-stu-id="50c15-224">Using the Datetime Wrapper Functions to Transition Between Capture Instances</span></span>  
 <span data-ttu-id="50c15-225">Change Data Capture supporta fino a due istanze di acquisizione per una singola tabella di origine in cui viene eseguito il rilevamento delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="50c15-225">Change data capture supports up to two capture instances for a single tracked source table.</span></span> <span data-ttu-id="50c15-226">L'utilizzo principale di questa funzionalità consiste nell'inserire una transizione tra più istanze di acquisizione quando le modifiche DDL (Data Definition Language) apportate alla tabella di origine espandono il set di colonne disponibili per il rilevamento.</span><span class="sxs-lookup"><span data-stu-id="50c15-226">The principal use of this capability is to accommodate a transition between multiple capture instances when data definition language (DDL) changes to the source table expand the set of available columns for tracking.</span></span> <span data-ttu-id="50c15-227">Durante la transizione a una nuova istanza di acquisizione, è possibile proteggere i livelli dell'applicazione più elevati dalle modifiche ai nomi delle funzioni di query sottostanti eseguendo il wrapping della chiamata sottostante tramite un'apposita funzione.</span><span class="sxs-lookup"><span data-stu-id="50c15-227">When transitioning to a new capture instance, one way to protect higher application levels from changes in the names of the underlying query functions is to use a wrapper function to wrap the underlying call.</span></span> <span data-ttu-id="50c15-228">Assicurarsi che il nome della funzione wrapper rimanga invariato.</span><span class="sxs-lookup"><span data-stu-id="50c15-228">Then, ensure that the name of the wrapper function remains the same.</span></span> <span data-ttu-id="50c15-229">Al momento della transizione, è possibile eliminare la funzione wrapper precedente e crearne una nuova con lo stesso nome che faccia riferimento alle nuove funzioni di query.</span><span class="sxs-lookup"><span data-stu-id="50c15-229">When the switch is to occur, the old wrapper function can be dropped, and a new one with the same name created that references the new query functions.</span></span> <span data-ttu-id="50c15-230">Modificando lo script generato per creare una funzione wrapper con lo stesso nome, è possibile passare a una nuova istanza di acquisizione senza influire sui livelli dell'applicazione più elevati.</span><span class="sxs-lookup"><span data-stu-id="50c15-230">By first modifying the generated script to create a wrapper function of the same name, you can make the switch to a new capture instance without affecting higher application layers.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="50c15-231">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="50c15-231">See Also</span></span>  
 <span data-ttu-id="50c15-232">[Tenere traccia delle modifiche ai dati &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="50c15-232">[Track Data Changes &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="50c15-233">[Informazioni su Change Data Capture &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="50c15-233">[About Change Data Capture &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="50c15-234">[Abilitare e disabilitare Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="50c15-234">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 [<span data-ttu-id="50c15-235">Amministrare e monitorare Change Data Capture &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="50c15-235">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
