---
title: Considerazioni relative all'uso di server di prova | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- overhead [Database Engine Tuning Advisor]
- tuning overhead [SQL Server]
- reducing production server tuning load
- Database Engine Tuning Advisor [SQL Server], test servers
- xp_msver
- test servers [Database Engine Tuning Advisor]
- production servers [SQL Server]
- offload tuning overhead [SQL Server]
ms.assetid: 94e6c3e5-1f09-4616-9da2-4e44d066d494
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 3fe835c1e92b382e3e2fadd7e80d4b2984929cc5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87714219"
---
# <a name="considerations-for-using-test-servers"></a><span data-ttu-id="b33a0-102">Considerazioni relative all'utilizzo di server di prova</span><span class="sxs-lookup"><span data-stu-id="b33a0-102">Considerations for Using Test Servers</span></span>
  <span data-ttu-id="b33a0-103">L'utilizzo di un server di prova per ottimizzare un database su un server di produzione è un importante vantaggio offerto da Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b33a0-103">Using a test server to tune a database on a production server is an important benefit of [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor.</span></span> <span data-ttu-id="b33a0-104">Attraverso questa funzionalità è possibile ripartire su un server di prova il carico dell'overhead generato dall'ottimizzazione senza copiare i dati effettivi dal server di produzione al server di prova.</span><span class="sxs-lookup"><span data-stu-id="b33a0-104">Using this feature, you can offload tuning overhead to a test server without copying the actual data over to the test server from the production server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b33a0-105">La funzionalità di ottimizzazione del server di prova non è supportata nell'interfaccia utente grafica (GUI) di Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b33a0-105">The test server tuning feature is not supported in the [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor graphical user interface (GUI).</span></span>  
  
 <span data-ttu-id="b33a0-106">Per utilizzare correttamente questa funzionalità, valutare le considerazioni riportate nelle sezioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="b33a0-106">To use this feature successfully, review the considerations listed in the following sections.</span></span>  
  
## <a name="setting-up-the-test-serverproduction-server-environment"></a><span data-ttu-id="b33a0-107">Configurazione dell'ambiente del server di prova e del server di produzione</span><span class="sxs-lookup"><span data-stu-id="b33a0-107">Setting Up the Test Server/Production Server Environment</span></span>  
  
-   <span data-ttu-id="b33a0-108">L'utente che desidera utilizzare un server di prova per ottimizzare un database su un server di produzione deve essere presente su entrambi i server, altrimenti l'operazione non riuscirà.</span><span class="sxs-lookup"><span data-stu-id="b33a0-108">The user who wants to use a test server to tune a database on a production server must exist on both servers, or this scenario will not work.</span></span>  
  
-   <span data-ttu-id="b33a0-109">Per usare lo scenario server di prova/server di produzione è necessario abilitare la stored procedure estesa **xp_msver**.</span><span class="sxs-lookup"><span data-stu-id="b33a0-109">The extended stored procedure, **xp_msver**, must be enabled to use the test server/production server scenario.</span></span> [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="b33a0-110">Ottimizzazione guidata usa questa stored procedure estesa per recuperare le informazioni sul numero di processori e sulla memoria disponibile nel server di produzione da usare per l'ottimizzazione del server di prova.</span><span class="sxs-lookup"><span data-stu-id="b33a0-110">Tuning Advisor uses this extended stored procedure to fetch the number of processors and the available memory of the production server to use while tuning the test server.</span></span> <span data-ttu-id="b33a0-111">Se la stored procedure **xp_msver** non è abilitata, Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] usa le caratteristiche hardware del computer in cui viene eseguito Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b33a0-111">If **xp_msver** is not enabled, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor assumes the hardware characteristics of the computer where [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor is running.</span></span> <span data-ttu-id="b33a0-112">Se le caratteristiche hardware del computer su cui Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] è in esecuzione non sono disponibili, si suppone che siano disponibili un processore e 1024 MB di memoria.</span><span class="sxs-lookup"><span data-stu-id="b33a0-112">If the hardware characteristics of the computer where [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor is running are not available, one processor and 1024 megabytes (MBs) of memory are assumed.</span></span> <span data-ttu-id="b33a0-113">Questa stored procedure estesa è attiva per impostazione predefinita quando si installa [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b33a0-113">This extended stored procedure is turned on by default when you install [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="b33a0-114">Per altre informazioni, vedere [Configurazione superficie di attacco](../security/surface-area-configuration.md) e [xp_msver &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/xp-msver-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b33a0-114">For more information, see [Surface Area Configuration](../security/surface-area-configuration.md) and [xp_msver &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/xp-msver-transact-sql).</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="b33a0-115">Ottimizzazione guidata prevede che le edizioni di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] siano identiche nel server di prova e nel server di produzione.</span><span class="sxs-lookup"><span data-stu-id="b33a0-115">Tuning Advisor expects the editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to be the same on both the test server and the production server.</span></span> <span data-ttu-id="b33a0-116">In caso contrario, l'edizione in uso nel server di prova ha la precedenza.</span><span class="sxs-lookup"><span data-stu-id="b33a0-116">If there are two different editions, the edition on the test server takes precedence.</span></span> <span data-ttu-id="b33a0-117">Ad esempio, se nel server di prova è in esecuzione [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard Edition, Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] non includerà tra le indicazioni le viste indicizzate, il partizionamento e le operazioni online, anche se nel server di produzione è in esecuzione [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise Edition.</span><span class="sxs-lookup"><span data-stu-id="b33a0-117">For example, if the test server is running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor will not include indexed views, partitioning, and online operations in its recommendations even if the production server is running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span></span>  
  
## <a name="about-test-serverproduction-server-behavior"></a><span data-ttu-id="b33a0-118">Informazioni sul comportamento del server di prova e del server di produzione</span><span class="sxs-lookup"><span data-stu-id="b33a0-118">About Test Server/Production Server Behavior</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="b33a0-119">Nella generazione delle indicazioni, Ottimizzazione guidata tiene in considerazione le differenze hardware esistenti tra il server di produzione e il server di prova.</span><span class="sxs-lookup"><span data-stu-id="b33a0-119">Tuning Advisor takes into account hardware differences between the production and the test server when creating recommendations.</span></span> <span data-ttu-id="b33a0-120">L'indicazione è identica a quella che verrebbe generata nel caso in cui l'ottimizzazione venisse eseguita sul solo server di produzione.</span><span class="sxs-lookup"><span data-stu-id="b33a0-120">The recommendation is the same as though the tuning was done on the production server alone.</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="b33a0-121">Ottimizzazione guidata può imporre un carico aggiuntivo al server di produzione per la raccolta dei metadati e per la creazione delle statistiche necessarie per eseguire l'ottimizzazione.</span><span class="sxs-lookup"><span data-stu-id="b33a0-121">Tuning Advisor may impose some load on the production server for gathering metadata as well as creation of statistics necessary for tuning.</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="b33a0-122">Ottimizzazione guidata non copia i dati effettivi dal server di produzione sul server di prova,</span><span class="sxs-lookup"><span data-stu-id="b33a0-122">Tuning Advisor does not copy actual data from the production server to the test server.</span></span> <span data-ttu-id="b33a0-123">Vengono copiati unicamente i metadati dei database e le necessarie statistiche.</span><span class="sxs-lookup"><span data-stu-id="b33a0-123">It only copies the metadata of the databases and the necessary statistics.</span></span>  
  
-   <span data-ttu-id="b33a0-124">Tutte le informazioni sulla sessione vengono archiviate in **msdb** sul server di produzione.</span><span class="sxs-lookup"><span data-stu-id="b33a0-124">All session information is stored in **msdb** on the production server.</span></span> <span data-ttu-id="b33a0-125">In questo modo, per eseguire l'ottimizzazione è possibile utilizzare qualsiasi server di prova disponibile, mentre le informazioni relative a tutte le sessioni si trovano in un'unica posizione, ovvero sul server di produzione.</span><span class="sxs-lookup"><span data-stu-id="b33a0-125">This allows you to exploit any available test server for tuning, and information about all sessions is available in one place (the production server).</span></span>  
  
## <a name="issues-related-to-the-shell-database"></a><span data-ttu-id="b33a0-126">Problemi relativi allo scheletro di database</span><span class="sxs-lookup"><span data-stu-id="b33a0-126">Issues Related to the Shell Database</span></span>  
  
-   <span data-ttu-id="b33a0-127">Dopo aver eseguito l'ottimizzazione, Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] rimuove tutti i metadati creati sul server di prova durante il processo di ottimizzazione.</span><span class="sxs-lookup"><span data-stu-id="b33a0-127">After tuning, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor should remove any metadata that it created on the test server during the tuning process.</span></span> <span data-ttu-id="b33a0-128">Viene rimosso anche lo scheletro di database.</span><span class="sxs-lookup"><span data-stu-id="b33a0-128">This includes the shell database.</span></span> <span data-ttu-id="b33a0-129">Se si stanno eseguendo più sessioni di ottimizzazione utilizzando gli stessi server di produzione e di prova, è possibile conservare lo scheletro di database per risparmiare tempo.</span><span class="sxs-lookup"><span data-stu-id="b33a0-129">If you are performing a series of tuning sessions with the same production and test servers, you may want to retain this shell database to save time.</span></span> <span data-ttu-id="b33a0-130">Nel file di input XML specificare il sottoelemento **RetainShellDB** insieme agli altri sottoelementi all'interno dell'elemento padre **TuningOptions** .</span><span class="sxs-lookup"><span data-stu-id="b33a0-130">In the XML input file, specify the **RetainShellDB** subelement with the other sub elements under the **TuningOptions** parent element.</span></span> <span data-ttu-id="b33a0-131">L'utilizzo di queste opzioni specifica a Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] di conservare lo scheletro di database.</span><span class="sxs-lookup"><span data-stu-id="b33a0-131">Using these options causes [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor to retain the shell database.</span></span> <span data-ttu-id="b33a0-132">Per altre informazioni, vedere [Guida di riferimento ai file di input XML &#40;Ottimizzazione guidata motore di database&#41;](database-engine-tuning-advisor.md).</span><span class="sxs-lookup"><span data-stu-id="b33a0-132">For more information, see [XML Input File Reference &#40;Database Engine Tuning Advisor&#41;](database-engine-tuning-advisor.md).</span></span>  
  
-   <span data-ttu-id="b33a0-133">Dopo una sessione di ottimizzazione riuscita che prevede l'utilizzo combinato di un server di prova e un server di produzione, è possibile che gli scheletri di database rimangano nel server di prova, anche se non è stato usato il sottoelemento **RetainShellDB** .</span><span class="sxs-lookup"><span data-stu-id="b33a0-133">Shell databases may be left behind on the test server after a successful test server/production server tuning session even if you have not specified the **RetainShellDB** subelement.</span></span> <span data-ttu-id="b33a0-134">Tali scheletri di database indesiderati possono interferire con le sessioni di ottimizzazione successive e devono essere eliminati prima di eseguire una nuova sessione di ottimizzazione che prevede l'utilizzo combinato di un server di prova e un server di produzione.</span><span class="sxs-lookup"><span data-stu-id="b33a0-134">These unwanted shell databases may interfere with subsequent tuning sessions and should be dropped before performing another test server/production server tuning session.</span></span> <span data-ttu-id="b33a0-135">Inoltre, se una sessione di ottimizzazione si interrompe in modo imprevisto, è possibile che gli scheletri di database nei server di prova e gli oggetti presenti in tali database rimangano nei server di prova.</span><span class="sxs-lookup"><span data-stu-id="b33a0-135">In addition, if a tuning session exits unexpectedly, the shell databases on the test server and the objects within those databases may be left behind on the test server.</span></span> <span data-ttu-id="b33a0-136">Prima di avviare una nuova sessione di ottimizzazione che prevede l'utilizzo combinato di un server di prova e un server di produzione è necessario eliminare anche tali database e oggetti.</span><span class="sxs-lookup"><span data-stu-id="b33a0-136">You should also delete these databases and objects before starting a new test server/production server tuning session.</span></span>  
  
## <a name="issues-related-to-the-tuning-process"></a><span data-ttu-id="b33a0-137">Problemi relativi al processo di ottimizzazione</span><span class="sxs-lookup"><span data-stu-id="b33a0-137">Issues Related to the Tuning Process</span></span>  
  
-   <span data-ttu-id="b33a0-138">L'utente deve controllare il contenuto del log di ottimizzazione per individuare eventuali errori di ottimizzazione causati dalle differenze esistenti tra il server di produzione e quello di prova ed errori risultanti dalla copia dei metadati dal server di produzione a quello di prova.</span><span class="sxs-lookup"><span data-stu-id="b33a0-138">The user must check the tuning log for tuning errors that result from differences between the production and test servers, and for errors that result from copying metadata from the production to the test server.</span></span> <span data-ttu-id="b33a0-139">Potrebbe ad esempio accadere che l'account di accesso di un utente non esista sul server di prova.</span><span class="sxs-lookup"><span data-stu-id="b33a0-139">For example, a user login may not exist on the test server.</span></span> <span data-ttu-id="b33a0-140">Se l'account di accesso di un utente non è presente sul server di prova, gli eventi nel carico di lavoro generati da quell'utente potrebbero non essere ottimizzabili.</span><span class="sxs-lookup"><span data-stu-id="b33a0-140">If a user login does not exist on the test server, those events in the workload that are issued by that user login may not be tunable.</span></span> <span data-ttu-id="b33a0-141">Utilizzare la GUI di Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] per visualizzare il log di ottimizzazione.</span><span class="sxs-lookup"><span data-stu-id="b33a0-141">Use the [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor GUI to view the tuning log.</span></span> <span data-ttu-id="b33a0-142">Per altre informazioni, vedere [Visualizzare e utilizzare l'output di Ottimizzazione guidata motore di database](view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md)</span><span class="sxs-lookup"><span data-stu-id="b33a0-142">For more information, see [View and Work with the Output from the Database Engine Tuning Advisor](view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md)</span></span>  
  
-   <span data-ttu-id="b33a0-143">Se Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] non riesce a ottimizzare molti eventi perché alcuni oggetti risultano mancanti nello scheletro di database creato da Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] nel server di prova, l'utente deve controllare il log di ottimizzazione.</span><span class="sxs-lookup"><span data-stu-id="b33a0-143">If [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor cannot tune many events because objects are missing in the shell database that [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor creates on the test server, the user must check the tuning log.</span></span> <span data-ttu-id="b33a0-144">In questo log sono elencati gli eventi che non è possibile ottimizzare.</span><span class="sxs-lookup"><span data-stu-id="b33a0-144">Events that cannot be tuned are listed in the log.</span></span> <span data-ttu-id="b33a0-145">Per ottimizzare correttamente il database sul server di prova, è necessario che l'utente crei gli oggetti mancanti nello scheletro di database e che quindi avvii una nuova sessione di ottimizzazione</span><span class="sxs-lookup"><span data-stu-id="b33a0-145">To successfully tune the database on the test server, the user must create the missing objects in the shell database, and then start a new tuning session.</span></span>  
  
-   <span data-ttu-id="b33a0-146">Se sul server di prova esiste già un database con lo stesso nome, Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] non copia i metadati, continua l'ottimizzazione e procede con la raccolta delle statistiche necessarie.</span><span class="sxs-lookup"><span data-stu-id="b33a0-146">If a database with the same name already exists on the test server, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor does not copy metadata, but continues tuning and gathers statistics as necessary.</span></span> <span data-ttu-id="b33a0-147">Questa funzionalità è utile nel caso in cui l'utente abbia già creato un database sul server di prova e abbia copiato i metadati appropriati prima di eseguire Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b33a0-147">This is useful if the user has already created a database on the test server and has copied the appropriate metadata before invoking [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor.</span></span>  
  
-   <span data-ttu-id="b33a0-148">Se sul server di produzione è stata attivata l'opzione DATE_CORRELATION_OPTIMIZATION per un database, i metadati e i dati associati a questa opzione non vengono inseriti completamente in uno script durante l'ottimizzazione del server di prova.</span><span class="sxs-lookup"><span data-stu-id="b33a0-148">If the DATE_CORRELATION_OPTIMIZATION option is turned on for a database on the production server, metadata and the data associated with this option are not completely scripted while tuning the test server.</span></span> <span data-ttu-id="b33a0-149">Quando l'ottimizzazione viene eseguita in uno scenario con server di prova/server di produzione, possono verificarsi i problemi seguenti:</span><span class="sxs-lookup"><span data-stu-id="b33a0-149">When tuning is performed for a test server/production server scenario, the following issues may apply:</span></span>  
  
    -   <span data-ttu-id="b33a0-150">Possono essere presenti utenti con piani di query differenti sui server per query che utilizzano l'opzione DATE_CORRELATION_OPTIMIZATION.</span><span class="sxs-lookup"><span data-stu-id="b33a0-150">Users can have different query plans on the servers for queries that use the DATE_CORRELATION_OPTIMIZATION option.</span></span>  
  
    -   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="b33a0-151">Ottimizzazione guidata potrebbe consigliare di eliminare le viste indicizzate che impongono l'opzione DATE_CORRELATION_OPTIMIZATION nello script di indicazioni.</span><span class="sxs-lookup"><span data-stu-id="b33a0-151">Tuning Advisor may suggest dropping indexed views that enforce the DATE_CORRELATION_OPTIMIZATION option in the recommendation script.</span></span>  
  
     <span data-ttu-id="b33a0-152">È pertanto possibile ignorare le indicazioni generate da Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] per le viste indicizzate relative alle statistiche di correlazione, dato che Ottimizzazione guidata [!INCLUDE[ssDE](../../includes/ssde-md.md)] ne conosce i costi ma non i vantaggi.</span><span class="sxs-lookup"><span data-stu-id="b33a0-152">Therefore, you may want to ignore any recommendations that [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor makes about the indexed views that hold correlation statistics because [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor knows their costs but not their benefits.</span></span> [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="b33a0-153">Ottimizzazione guidata potrebbe consigliare di non selezionare determinati indici, ad esempio gli indici cluster in colonne **datetime** , che potrebbero risultare utili quando l'opzione DATE_CORRELATION_OPTIMIZATION è abilitata.</span><span class="sxs-lookup"><span data-stu-id="b33a0-153">Tuning Advisor may not recommend selection of certain indexes such as clustered indexes on **datetime** columns, which could be beneficial when DATE_CORRELATION_OPTIMIZATION is enabled.</span></span>  
  
     <span data-ttu-id="b33a0-154">Per determinare se una vista è basata su statistiche di correlazione, selezionare la colonna **is_date_correlation_view** della vista del catalogo [sys.views](/sql/relational-databases/system-catalog-views/sys-views-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="b33a0-154">To determine if a view is based on correlation statistics, select the **is_date_correlation_view** column of the [sys.views](/sql/relational-databases/system-catalog-views/sys-views-transact-sql) catalog view.</span></span>  
  
  
