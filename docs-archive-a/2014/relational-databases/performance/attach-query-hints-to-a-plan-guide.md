---
title: Associare gli hint per le query a una guida di piano | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
ms.assetid: 2131f796-6359-4f9e-9047-da0b3d4dedaf
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 074c69ffefd2b5a7b2ef445f941f97b7130b0732
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87635000"
---
# <a name="attach-query-hints-to-a-plan-guide"></a><span data-ttu-id="8a801-102">Associazione degli hint per le query a una guida di piano</span><span class="sxs-lookup"><span data-stu-id="8a801-102">Attach Query Hints to a Plan Guide</span></span>
  <span data-ttu-id="8a801-103">In una guida di piano è possibile utilizzare qualsiasi combinazione di hint per la query validi.</span><span class="sxs-lookup"><span data-stu-id="8a801-103">Any combination of valid query hints can be used in a plan guide.</span></span> <span data-ttu-id="8a801-104">Quando una guida di piano corrisponde a una query, la clausola OPTION specificata nella clausola dell'hint di una guida di piano viene aggiunta alla query prima che questa venga compilata e ottimizzata.</span><span class="sxs-lookup"><span data-stu-id="8a801-104">When a plan guide matches a query, the OPTION clause specified in the hints clause of a plan guide is added to the query before it compiles and optimizes.</span></span> <span data-ttu-id="8a801-105">Se una query che corrisponde a una guida di piano contiene già una clausola OPTION, gli hint per la query specificati nella guida di piano sostituiscono quelli della query.</span><span class="sxs-lookup"><span data-stu-id="8a801-105">If a query that is matched to a plan guide already has an OPTION clause, the query hints specified in the plan guide replace those in the query.</span></span> <span data-ttu-id="8a801-106">Perché una guida di piano possa corrispondere a una query che già contiene una clausola OPTION è tuttavia necessario includere la clausola OPTION della query quando si specifica il testo della query da far corrispondere nell'istruzione sp_create_plan_guide.</span><span class="sxs-lookup"><span data-stu-id="8a801-106">However, for a plan guide to match a query that already has an OPTION clause, you must include the OPTION clause of the query when you specify the text of the query to match in the sp_create_plan_guide statement.</span></span> <span data-ttu-id="8a801-107">Se si desidera che gli hint specificati nella guida di piano vengano aggiunti agli hint già esistenti nella query, invece di sostituirli è necessario specificare sia gli hint originali che gli hint aggiuntivi nella clausola OPTION della guida di piano.</span><span class="sxs-lookup"><span data-stu-id="8a801-107">If you want the hints specified in the plan guide to be added to the hints that already exist on the query, instead of replacing them, you must specify both the original hints and the additional hints in the OPTION clause of the plan guide.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="8a801-108">L'utilizzo non corretto degli hint per la query da parte delle guide di piano può provocare problemi di compilazione, esecuzione o prestazioni.</span><span class="sxs-lookup"><span data-stu-id="8a801-108">Plan guides that misuse query hints can cause compilation, execution, or performance problems.</span></span> <span data-ttu-id="8a801-109">È consigliabile che le guide di piano vengano utilizzate solo da sviluppatori e amministratori esperti di database.</span><span class="sxs-lookup"><span data-stu-id="8a801-109">Plan guides should be used only by experienced developers and database administrators.</span></span>  
  
## <a name="common-query-hints-used-in-plan-guides"></a><span data-ttu-id="8a801-110">Hint per le query comuni utilizzate nelle guide di piano</span><span class="sxs-lookup"><span data-stu-id="8a801-110">Common Query Hints Used in Plan Guides</span></span>  
 <span data-ttu-id="8a801-111">Le query che possono trarre vantaggio dall'utilizzo di guide di piano sono in genere basate su parametri ed è possibile che le prestazioni siano insufficienti a causa dell'utilizzo di piani di query memorizzati nella cache nei quali i valori dei parametri non rappresentano il caso peggiore o lo scenario più rappresentativo.</span><span class="sxs-lookup"><span data-stu-id="8a801-111">Queries that can benefit from plan guides are generally parameter-based, and may be performing poorly because they use cached query plans whose parameter values do not represent a worst-case or most representative scenario.</span></span> <span data-ttu-id="8a801-112">Per la risoluzione di questo problema è possibile utilizzare gli hint per le query OPTIMIZE FOR e RECOMPILE.</span><span class="sxs-lookup"><span data-stu-id="8a801-112">The OPTIMIZE FOR and RECOMPILE query hints can be used to address this problem.</span></span> <span data-ttu-id="8a801-113">OPTIMIZE FOR indica a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] di utilizzare un valore particolare per un parametro quando la query viene ottimizzata.</span><span class="sxs-lookup"><span data-stu-id="8a801-113">OPTIMIZE FOR instructs [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to use a particular value for a parameter when the query is optimized.</span></span> <span data-ttu-id="8a801-114">RECOMPILE indica al server di eliminare un piano di query dopo l'esecuzione, forzando Query Optimizer alla compilazione di un nuovo piano di query alla successiva esecuzione della stessa query.</span><span class="sxs-lookup"><span data-stu-id="8a801-114">RECOMPILE instructs the server to discard a query plan after execution, forcing the query optimizer to recompile a new query plan the next time that the same query is executed.</span></span> <span data-ttu-id="8a801-115">Per un esempio, vedere [Guide di piano](plan-guides.md).</span><span class="sxs-lookup"><span data-stu-id="8a801-115">For an example, see [Plan Guides](plan-guides.md).</span></span>  
  
 <span data-ttu-id="8a801-116">Inoltre, è possibile specificare gli hint di tabella INDEX, FORCESCAN e FORCESEEK come hint per le query.</span><span class="sxs-lookup"><span data-stu-id="8a801-116">In addition, you can specify the table hints INDEX, FORCESCAN, and FORCESEEK as query hints.</span></span> <span data-ttu-id="8a801-117">Se specificati come hint per le query, tali hint si comportano come un hint di vista o di una tabella inline.</span><span class="sxs-lookup"><span data-stu-id="8a801-117">When specified as query hints, these hints behave like an inline table or view hint.</span></span> <span data-ttu-id="8a801-118">L'hint INDEX impone a Query Optimizer di utilizzare soltanto gli indici specificati per accedere ai dati nella tabella o nella vista.</span><span class="sxs-lookup"><span data-stu-id="8a801-118">The INDEX hint forces the query optimizer to use only the specified indexes to access the data in the referenced table or view.</span></span> <span data-ttu-id="8a801-119">L’hint FORCESEEK impone a Optimizer di utilizzare soltanto un’operazione Index Seek per accedere ai dati nella tabella o nella vista a cui si fa riferimento.</span><span class="sxs-lookup"><span data-stu-id="8a801-119">The FORCESEEK hint forces the optimizer to use only an index seek operation to access the data in the referenced table or view.</span></span> <span data-ttu-id="8a801-120">Tali hint forniscono funzionalità della guida di piano aggiuntive e consentono di avere maggiore influenza sull'ottimizzazione di query che utilizzano la guida di piano.</span><span class="sxs-lookup"><span data-stu-id="8a801-120">These hints provide additional plan guide functionality and allow you to have more influence over the optimization of queries that use the plan guide.</span></span>  
  
  
