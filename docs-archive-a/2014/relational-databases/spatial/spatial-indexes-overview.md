---
title: Panoramica degli indici spaziali | Microsoft Docs
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- spatial indexes [SQL Server]
ms.assetid: b1ae7b78-182a-459e-ab28-f743e43f8293
author: MladjoA
ms.author: mlandzic
ms.openlocfilehash: 36406bd60b4204469aca3d20862020870a8832fe
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87629766"
---
# <a name="spatial-indexes-overview"></a><span data-ttu-id="83269-102">Panoramica degli indici spaziali</span><span class="sxs-lookup"><span data-stu-id="83269-102">Spatial Indexes Overview</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="83269-103">supporta dati e indici spaziali.</span><span class="sxs-lookup"><span data-stu-id="83269-103">supports spatial data and spatial indexes.</span></span> <span data-ttu-id="83269-104">Un *indice spaziale* è un tipo di indice esteso che consente di indicizzare una colonna spaziale.</span><span class="sxs-lookup"><span data-stu-id="83269-104">A *spatial index* is a type of extended index that allows you to index a spatial column.</span></span> <span data-ttu-id="83269-105">Una colonna spaziale è una colonna della tabella che contiene dati spaziali, ad esempio `geometry` o `geography`.</span><span class="sxs-lookup"><span data-stu-id="83269-105">A spatial column is a table column that contains data of a spatial data type, such as `geometry` or `geography`.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="83269-106">Per una descrizione dettagliata ed esempi delle nuove funzionalità spaziali di [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], incluse le funzionalità che incidono sugli indici spaziali, scaricare il white paper [New Spatial Features in SQL Server 2012](https://go.microsoft.com/fwlink/?LinkId=226407)(Nuove funzionalità spaziali in SQL Server 2012).</span><span class="sxs-lookup"><span data-stu-id="83269-106">For a detailed description and examples of spatial features introduced in [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], including features that affect spatial indexes, download the white paper, [New Spatial Features in SQL Server 2012](https://go.microsoft.com/fwlink/?LinkId=226407).</span></span>

##  <a name="about-spatial-indexes"></a><a name="about"></a> <span data-ttu-id="83269-107">Informazioni sugli indici spaziali</span><span class="sxs-lookup"><span data-stu-id="83269-107">About Spatial Indexes</span></span>

###  <a name="decomposing-indexed-space-into-a-grid-hierarchy"></a><a name="decompose"></a> <span data-ttu-id="83269-108">Scomposizione dello spazio indicizzato in una gerarchia di griglie</span><span class="sxs-lookup"><span data-stu-id="83269-108">Decomposing Indexed Space into a Grid Hierarchy</span></span>
 <span data-ttu-id="83269-109">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]gli indici spaziali vengono compilati utilizzando alberi B, pertanto gli indici devono rappresentare i dati spaziali bidimensionali nell'ordine lineare degli alberi B.</span><span class="sxs-lookup"><span data-stu-id="83269-109">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], spatial indexes are built using B-trees, which means that the indexes must represent the 2-dimensional spatial data in the linear order of B-trees.</span></span> <span data-ttu-id="83269-110">Pertanto, prima della lettura di dati in un indice spaziale, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] consente di implementare una scomposizione gerarchica uniforme dello spazio.</span><span class="sxs-lookup"><span data-stu-id="83269-110">Therefore, before reading data into a spatial index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] implements a hierarchical uniform decomposition of space.</span></span> <span data-ttu-id="83269-111">Il processo di creazione dell'indice *scompone* lo spazio in una *gerarchia di griglie*a quattro livelli.</span><span class="sxs-lookup"><span data-stu-id="83269-111">The index-creation process *decomposes* the space into a four-level *grid hierarchy*.</span></span> <span data-ttu-id="83269-112">Questi livelli vengono indicati come *livello 1* (il livello principale), *livello 2*, *livello 3*e *livello 4*.</span><span class="sxs-lookup"><span data-stu-id="83269-112">These levels are referred to as *level 1* (the top level), *level 2*, *level 3*, and *level 4*.</span></span>

 <span data-ttu-id="83269-113">Ogni livello successivo scompone ulteriormente il livello precedente, pertanto ogni cella di livello superiore contiene una griglia completa al livello successivo.</span><span class="sxs-lookup"><span data-stu-id="83269-113">Each successive level further decomposes the level above it, so each upper-level cell contains a complete grid at the next level.</span></span> <span data-ttu-id="83269-114">Su un livello specificato, tutte le griglie hanno lo stesso numero di celle lungo entrambi gli assi (ad esempio, 4x4 o 8x8) e le celle hanno tutte la stessa dimensione.</span><span class="sxs-lookup"><span data-stu-id="83269-114">On a given level, all the grids have the same number of cells along both axes (for example, 4x4 or 8x8), and the cells are all one size.</span></span>

 <span data-ttu-id="83269-115">Nell'illustrazione seguente viene mostrata la scomposizione per la cella in alto destra a ogni livello della gerarchia di griglie in una griglia da 4x4.</span><span class="sxs-lookup"><span data-stu-id="83269-115">The following illustration shows the decomposition for the upper-right cell at each level of the grid hierarchy into a 4x4 grid.</span></span> <span data-ttu-id="83269-116">In realtà, tutte le celle vengono scomposte in questo modo.</span><span class="sxs-lookup"><span data-stu-id="83269-116">In reality, all the cells are decomposed in this way.</span></span> <span data-ttu-id="83269-117">Quindi, ad esempio, scomponendo uno spazio in quattro livelli di griglie 4x4 si produce un totale di 65.536 celle a quattro livelli.</span><span class="sxs-lookup"><span data-stu-id="83269-117">Thus, for example, decomposing a space into four levels of 4x4 grids actually produces a total of 65,536 level-four cells.</span></span>

 <span data-ttu-id="83269-118">![Quattro livelli di mosaico ricorsivo](../../database-engine/media/spndx-recursive-levels-telescoped.gif "Quattro livelli di mosaico ricorsivo")</span><span class="sxs-lookup"><span data-stu-id="83269-118">![Four-levels of recursive tessellation](../../database-engine/media/spndx-recursive-levels-telescoped.gif "Four-levels of recursive tessellation")</span></span>

> [!NOTE]
>  <span data-ttu-id="83269-119">La scomposizione dello spazio per un indice spaziale è indipendente dall'unità di misura utilizzata dai dati dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="83269-119">The decomposition of space for a spatial index is independent of the unit of measurement that the application data uses.</span></span>

 <span data-ttu-id="83269-120">Le celle di una gerarchia di griglie sono numerate in modo lineare tramite una variazione della curva di riempimento dello spazio di Hilbert.</span><span class="sxs-lookup"><span data-stu-id="83269-120">Grid hierarchy cells are numbered in a linear fashion by using a variation of the Hilbert space-filling curve.</span></span> <span data-ttu-id="83269-121">Tuttavia, a scopo illustrativo, viene utilizzata una semplice numerazione per riga, invece della numerazione effettivamente prodotta dalla curva di Hilbert.</span><span class="sxs-lookup"><span data-stu-id="83269-121">For the purpose of illustration, however, this discussion uses a simple row-wise numbering, instead of the numbering that is actually produced by the Hilbert curve.</span></span> <span data-ttu-id="83269-122">Nell'illustrazione seguente molti poligoni che rappresentano edifici e linee che rappresentano strade sono già stati posizionati in una griglia 4x4 di livello 1.</span><span class="sxs-lookup"><span data-stu-id="83269-122">In the following illustration, several polygons that represent buildings, and lines that represent streets, have already been placed into a 4x4, level-1 grid.</span></span> <span data-ttu-id="83269-123">Le celle di 1 livello sono numerate da 1 a 16 partendo dalla cella in alto a sinistra.</span><span class="sxs-lookup"><span data-stu-id="83269-123">The level-1 cells are numbered from 1 through 16, starting with the upper-left cell.</span></span>

 <span data-ttu-id="83269-124">![Poligoni e linee posizionati in una griglia 4x4 di livello 1](../../database-engine/media/spndx-level-1-objects.gif "Poligoni e linee posizionati in una griglia 4x4 di livello 1")</span><span class="sxs-lookup"><span data-stu-id="83269-124">![Polygons and lines placed into a 4x4 level-1 grid](../../database-engine/media/spndx-level-1-objects.gif "Polygons and lines placed into a 4x4 level-1 grid")</span></span>

#### <a name="grid-density"></a><span data-ttu-id="83269-125">Densità della griglia</span><span class="sxs-lookup"><span data-stu-id="83269-125">Grid Density</span></span>
 <span data-ttu-id="83269-126">Il numero di celle lungo gli assi di una griglia ne determina *densità*. Maggiore è il numero di celle, più densa è la griglia.</span><span class="sxs-lookup"><span data-stu-id="83269-126">The number of cells along the axes of a grid determines its *density*: the larger the number, the denser the grid.</span></span> <span data-ttu-id="83269-127">Ad esempio, una griglia 8x8 (che crea 64 celle) è più densa di una griglia 4x4 (che crea 16 celle).</span><span class="sxs-lookup"><span data-stu-id="83269-127">For example, an 8x8 grid (which produces 64 cells), is denser than a 4x4 grid (which produces 16 cells).</span></span> <span data-ttu-id="83269-128">La densità della griglia è definita per ogni livello.</span><span class="sxs-lookup"><span data-stu-id="83269-128">Grid density is defined on a per-level basis.</span></span>

 <span data-ttu-id="83269-129">L'istruzione [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] supporta una clausola GRIDS che consente di specificare diverse densità di griglia a livelli differenti.</span><span class="sxs-lookup"><span data-stu-id="83269-129">The [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement supports a GRIDS clause that enables you to specify different grid densities at different levels.</span></span> <span data-ttu-id="83269-130">La densità della griglia per un determinato livello viene specificata utilizzando una delle parole chiave seguenti.</span><span class="sxs-lookup"><span data-stu-id="83269-130">The grid density for a given level is specified by using one of the following keywords.</span></span>

|<span data-ttu-id="83269-131">Parola chiave</span><span class="sxs-lookup"><span data-stu-id="83269-131">Keyword</span></span>|<span data-ttu-id="83269-132">Configurazione della griglia</span><span class="sxs-lookup"><span data-stu-id="83269-132">Grid configuration</span></span>|<span data-ttu-id="83269-133">Numero di celle</span><span class="sxs-lookup"><span data-stu-id="83269-133">Number of cells</span></span>|
|-------------|------------------------|---------------------|
|<span data-ttu-id="83269-134">LOW</span><span class="sxs-lookup"><span data-stu-id="83269-134">LOW</span></span>|<span data-ttu-id="83269-135">4X4</span><span class="sxs-lookup"><span data-stu-id="83269-135">4X4</span></span>|<span data-ttu-id="83269-136">16</span><span class="sxs-lookup"><span data-stu-id="83269-136">16</span></span>|
|<span data-ttu-id="83269-137">MEDIUM</span><span class="sxs-lookup"><span data-stu-id="83269-137">MEDIUM</span></span>|<span data-ttu-id="83269-138">8X8</span><span class="sxs-lookup"><span data-stu-id="83269-138">8X8</span></span>|<span data-ttu-id="83269-139">64</span><span class="sxs-lookup"><span data-stu-id="83269-139">64</span></span>|
|<span data-ttu-id="83269-140">HIGH</span><span class="sxs-lookup"><span data-stu-id="83269-140">HIGH</span></span>|<span data-ttu-id="83269-141">16X16</span><span class="sxs-lookup"><span data-stu-id="83269-141">16X16</span></span>|<span data-ttu-id="83269-142">256</span><span class="sxs-lookup"><span data-stu-id="83269-142">256</span></span>|

 <span data-ttu-id="83269-143">Quando in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]il livello di compatibilità del database è impostato su 100 o su un valore inferiore, l'impostazione predefinita è MEDIUM in tutti i livelli.</span><span class="sxs-lookup"><span data-stu-id="83269-143">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], when the database compatibility level is set to 100 or lower, then the default is MEDIUM on all levels.</span></span> <span data-ttu-id="83269-144">Quando il livello di compatibilità del database è impostato su 110 o su un valore superiore, l'impostazione predefinita è uno schema a griglia automatica.</span><span class="sxs-lookup"><span data-stu-id="83269-144">When the database compatibility level is set to 110 or higher, then the default is an auto grid scheme.</span></span>

 <span data-ttu-id="83269-145">È possibile controllare il processo di scomposizione specificando densità della griglia non predefinite.</span><span class="sxs-lookup"><span data-stu-id="83269-145">You can control the decomposition process by specifying non-default grid densities.</span></span> <span data-ttu-id="83269-146">Diverse densità della griglia a livelli diversi, ad esempio, potrebbero essere utili per l'ottimizzazione di un indice in base alle dimensioni dello spazio indicizzato e agli oggetti nella colonna spaziale.</span><span class="sxs-lookup"><span data-stu-id="83269-146">For example, different grid densities on different levels might be useful for fine tuning an index based on the size of the indexed space and the objects in the spatial column.</span></span>

> [!NOTE]
>  <span data-ttu-id="83269-147">Le densità della griglia di un indice spaziale sono visibili nelle colonne level_1_grid, level_2_grid, level_3_grid e level_4_grid della vista del catalogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) quando il livello di compatibilità del database è impostato su 100 o su un valore inferiore.</span><span class="sxs-lookup"><span data-stu-id="83269-147">The grid densities of a spatial index are visible in the level_1_grid, level_2_grid, level_3_grid, and level_4_grid columns of the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view when the database compatibility level is set to 100 or lower.</span></span> <span data-ttu-id="83269-148">Le `GEOMETRY_AUTO_GRID` / `GEOGRAPHY_AUTO_GRID` Opzioni dello schema a mosaico non popolano queste colonne.</span><span class="sxs-lookup"><span data-stu-id="83269-148">The `GEOMETRY_AUTO_GRID`/`GEOGRAPHY_AUTO_GRID` tessellation scheme options do not populate these columns.</span></span> <span data-ttu-id="83269-149">sys. spatial_index_tessellations vista del catalogo dispone `NULL` di valori per queste colonne quando si utilizzano le opzioni di griglia automatica.</span><span class="sxs-lookup"><span data-stu-id="83269-149">sys.spatial_index_tessellations catalog view has `NULL` values for these columns when the auto grid options are used.</span></span>

###  <a name="tessellation"></a><a name="tessellation"></a><span data-ttu-id="83269-150">Tassellatura</span><span class="sxs-lookup"><span data-stu-id="83269-150">Tessellation</span></span>
 <span data-ttu-id="83269-151">Dopo la scomposizione di uno spazio indicizzato in una gerarchia di griglie, l'indice spaziale legge i dati dalla colonna spaziale, riga per riga.</span><span class="sxs-lookup"><span data-stu-id="83269-151">After decomposition of an indexed space into a grid hierarchy, the spatial index reads the data from the spatial column, row by row.</span></span> <span data-ttu-id="83269-152">Al termine della lettura dei dati per un oggetto spaziale (o istanza), l'indice spaziale esegue un *processo di suddivisione a mosaico* per l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="83269-152">After reading the data for a spatial object (or instance), the spatial index performs a *tessellation process* for that object.</span></span> <span data-ttu-id="83269-153">Il processo di suddivisione a mosaico adatta l'oggetto alla gerarchia di griglie associandolo a un set di celle della griglia interessate dall'oggetto stesso (*celle interessate*).</span><span class="sxs-lookup"><span data-stu-id="83269-153">The tessellation processfits the object into the grid hierarchy by associating the object with a set of grid cells that it touches (*touched cells*).</span></span> <span data-ttu-id="83269-154">Partendo dal livello 1 della gerarchia di griglie, la suddivisione a mosaico procede *prima in profondità* attraverso il livello.</span><span class="sxs-lookup"><span data-stu-id="83269-154">Starting at level 1 of the grid hierarchy, the tessellation process proceeds *breadth first* across the level.</span></span> <span data-ttu-id="83269-155">Potenzialmente, il processo può continuare per tutti i quattro livelli, uno dopo l'altro.</span><span class="sxs-lookup"><span data-stu-id="83269-155">Potentially, the process can continue through all four levels, one level at a time.</span></span>

 <span data-ttu-id="83269-156">L'output del processo a mosaico è un set di celle interessate registrate nell'indice spaziale per l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="83269-156">The output of the tessellation process is a set of touched cells that are recorded in the spatial index for the object.</span></span> <span data-ttu-id="83269-157">Riferendosi a queste celle registrate, l'indice spaziale può trovare l'oggetto nello spazio in relazione ad altri oggetti nella colonna spaziale che sono archiviati anche nell'indice.</span><span class="sxs-lookup"><span data-stu-id="83269-157">By referring to these recorded cells, the spatial index can locate the object in space relative to other objects in the spatial column that are also stored in the index.</span></span>

#### <a name="tessellation-rules"></a><span data-ttu-id="83269-158">Regole della suddivisione a mosaico</span><span class="sxs-lookup"><span data-stu-id="83269-158">Tessellation Rules</span></span>
 <span data-ttu-id="83269-159">Per limitare il numero di celle interessate registrate per un oggetto, nel processo di suddivisione a mosaico vengono applicate diverse regole,</span><span class="sxs-lookup"><span data-stu-id="83269-159">To limit the number of touched cells that are recorded for an object, the tessellation process applies several tessellation rules.</span></span> <span data-ttu-id="83269-160">che permettono di determinare la profondità del processo e indicare quali delle celle interessate devono essere registrate nell'indice.</span><span class="sxs-lookup"><span data-stu-id="83269-160">These rules determine the depth of the tessellation process and which of the touched cells are recorded in the index.</span></span>

 <span data-ttu-id="83269-161">Le regole sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="83269-161">These rules are as follows:</span></span>

-   <span data-ttu-id="83269-162">Regola di copertura</span><span class="sxs-lookup"><span data-stu-id="83269-162">The covering rule</span></span>

     <span data-ttu-id="83269-163">Se l'oggetto copre completamente una cella, tale cella viene definita *coperta* dall'oggetto.</span><span class="sxs-lookup"><span data-stu-id="83269-163">If the object completely covers a cell, that cell is said to be *covered* by the object.</span></span> <span data-ttu-id="83269-164">Una cella coperta viene inserita nel conteggio e non viene suddivisa a mosaico.</span><span class="sxs-lookup"><span data-stu-id="83269-164">A covered cell is counted and is not tessellated.</span></span> <span data-ttu-id="83269-165">Questa regola è valida per tutti i livelli della gerarchia di griglie.</span><span class="sxs-lookup"><span data-stu-id="83269-165">This rule applies at all levels of the grid hierarchy.</span></span> <span data-ttu-id="83269-166">La regola di copertura semplifica il processo a mosaico e riduce la quantità di dati registrata da un indice spaziale.</span><span class="sxs-lookup"><span data-stu-id="83269-166">The covering rule simplifies the tessellation process and reduces the amount of data that a spatial index records.</span></span>

-   <span data-ttu-id="83269-167">Regola delle celle per oggetto</span><span class="sxs-lookup"><span data-stu-id="83269-167">The cells-per-object rule</span></span>

     <span data-ttu-id="83269-168">Questa regola stabilisce il *limite di celle per oggetto*e determina il numero massimo di celle che possono essere conteggiate per ogni oggetto, a eccezione del livello 1.</span><span class="sxs-lookup"><span data-stu-id="83269-168">This rule enforces the *cells-per-object limit*, which determines the maximum number of cells that can be counted for each object, except on level 1.</span></span> <span data-ttu-id="83269-169">A livelli inferiori, la regola delle celle per oggetto consente di controllare la quantità di informazioni che possono essere registrate sull'oggetto.</span><span class="sxs-lookup"><span data-stu-id="83269-169">At lower levels, the cells-per-object rule controls the amount of information that can be recorded about the object.</span></span>

-   <span data-ttu-id="83269-170">Regola della cella più in basso</span><span class="sxs-lookup"><span data-stu-id="83269-170">The deepest-cell rule</span></span>

     <span data-ttu-id="83269-171">La regola della cella più in basso genera la migliore approssimazione di un oggetto registrando solo le celle più in basso suddivise a mosaico per l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="83269-171">The deepest-cell rule generates the best approximation of an object by recording only the bottom-most cells that have been tessellated for the object.</span></span> <span data-ttu-id="83269-172">Le celle padre non contribuiscono al conteggio celle per oggetto e non sono registrate nell'indice.</span><span class="sxs-lookup"><span data-stu-id="83269-172">Parent cells do not contribute to the cells-per-object count, and they are not recorded in the index.</span></span>

 <span data-ttu-id="83269-173">Queste regole vengono applicate in modo ricorsivo a ogni livello della griglia.</span><span class="sxs-lookup"><span data-stu-id="83269-173">These tessellation rules are applied recursively on each grid level.</span></span> <span data-ttu-id="83269-174">Nella parte restante di questa sezione vengono descritte le regole in maggiore dettaglio.</span><span class="sxs-lookup"><span data-stu-id="83269-174">The rest of this section describes the tessellation rules in more detail.</span></span>

#### <a name="covering-rule"></a><span data-ttu-id="83269-175">Regola di copertura</span><span class="sxs-lookup"><span data-stu-id="83269-175">Covering Rule</span></span>
 <span data-ttu-id="83269-176">Se un oggetto copre completamente una cella, quella cella viene definita *coperta* dall'oggetto.</span><span class="sxs-lookup"><span data-stu-id="83269-176">If an object completely covers a cell, that cell is said to be *covered* by the object.</span></span> <span data-ttu-id="83269-177">Ad esempio, nell'illustrazione seguente, una delle celle di secondo livello, 15.11, è completamente coperta dalla parte centrale di un ottagono.</span><span class="sxs-lookup"><span data-stu-id="83269-177">For example, in the following illustration, one of the second-level cells, 15.11, is completely covered by the middle portion of an octagon.</span></span>

 <span data-ttu-id="83269-178">![Ottimizzazione della copertura](../../database-engine/media/spndx-opt-covering.gif "Ottimizzazione della copertura")</span><span class="sxs-lookup"><span data-stu-id="83269-178">![Covering optimization](../../database-engine/media/spndx-opt-covering.gif "Covering optimization")</span></span>

 <span data-ttu-id="83269-179">Una cella coperta viene inserita nel conteggio e registrata nell'indice e non è più suddivisa a mosaico.</span><span class="sxs-lookup"><span data-stu-id="83269-179">A covered cell is counted and recorded in the index, and the cell is not tessellated any further.</span></span>

#### <a name="cells-per-object-rule"></a><span data-ttu-id="83269-180">Regola delle celle per oggetto</span><span class="sxs-lookup"><span data-stu-id="83269-180">Cells-Per-Object Rule</span></span>
 <span data-ttu-id="83269-181">L'entità della suddivisione a mosaico di ogni oggetto dipende principalmente dal *limite di celle per oggetto* dell'indice spaziale.</span><span class="sxs-lookup"><span data-stu-id="83269-181">The extent of tessellation of each object depends primarily on the *cells-per-object limit* of the spatial index.</span></span> <span data-ttu-id="83269-182">Questo limite definisce il numero massimo di celle che la suddivisione a mosaico può conteggiare per ogni oggetto.</span><span class="sxs-lookup"><span data-stu-id="83269-182">This limit defines the maximum number of cells that tessellation can count per object.</span></span> <span data-ttu-id="83269-183">Tuttavia la regola delle celle per oggetto non viene applicata per il livello 1, pertanto è possibile superare questo limite.</span><span class="sxs-lookup"><span data-stu-id="83269-183">Note, however, that the cells-per-object rule is not enforced for level 1, so it is possible to exceed this limit.</span></span> <span data-ttu-id="83269-184">Se il livello 1 raggiunge o supera il limite di celle per oggetto, non si verifica alcun altro inserimento nel mosaico ai livelli inferiori.</span><span class="sxs-lookup"><span data-stu-id="83269-184">If the level-1 count reaches, or exceeds, the cells-per-object limit, no further tessellation occurs at the lower levels.</span></span>

 <span data-ttu-id="83269-185">Finché il conteggio è inferiore al limite di celle per oggetto, il processo a mosaico continua.</span><span class="sxs-lookup"><span data-stu-id="83269-185">As long as the count is less than the cells-per-object limit, the tessellation process continues.</span></span> <span data-ttu-id="83269-186">Partendo dalla cella interessata con il numero più basso (ad esempio, cella 15.6 nell'illustrazione precedente), ogni cella viene testata durante il processo per valutare se conteggiarla o suddividerla a mosaico.</span><span class="sxs-lookup"><span data-stu-id="83269-186">Starting with the lowest-number touched cell (for example, cell 15.6 in the preceding illustration), the process tests each cell to evaluate whether to count it or tessellate it.</span></span> <span data-ttu-id="83269-187">Se la suddivisione di una cella a mosaico determina il superamento del limite di celle per oggetto, la cella viene conteggiata e non viene suddivisa a mosaico;</span><span class="sxs-lookup"><span data-stu-id="83269-187">If tessellating a cell would exceed the cells-per-object limit, the cell is counted and not tessellated.</span></span> <span data-ttu-id="83269-188">in caso contrario è suddivisa a mosaico e le celle di livello inferiore interessate dall'oggetto vengono conteggiate.</span><span class="sxs-lookup"><span data-stu-id="83269-188">Otherwise, the cell is tessellated, and the lower-level cells that are touched by the object are counted.</span></span> <span data-ttu-id="83269-189">Il processo continua in questo modo, nel senso della larghezza, attraverso il livello</span><span class="sxs-lookup"><span data-stu-id="83269-189">The tessellation process continues in this way, breadth-wise, across the level.</span></span> <span data-ttu-id="83269-190">e viene ripetuto in modo ricorsivo per le griglie di livello inferiore delle celle a mosaico fino al raggiungimento del limite oppure al conteggio di tutte le celle.</span><span class="sxs-lookup"><span data-stu-id="83269-190">This process is repeated recursively for the lower-level grids of the tessellated cells until the limit is reached or there are no more cells to count.</span></span>

 <span data-ttu-id="83269-191">Ad esempio, nell'illustrazione precedente viene mostrato un ottagono che si inserisce perfettamente nella cella 15 della griglia di livello 1.</span><span class="sxs-lookup"><span data-stu-id="83269-191">For example, consider the preceding illustration, which shows an octagon that fits completely into cell 15 of the level-1 grid.</span></span> <span data-ttu-id="83269-192">Nella figura, la cella 15 è stata suddivisa a mosaico, sezionando l'ottagono in nove celle di livello 2.</span><span class="sxs-lookup"><span data-stu-id="83269-192">In the figure, cell 15 has been tessellated, dissecting the octagon into nine level-2 cells.</span></span> <span data-ttu-id="83269-193">In questa illustrazione si presuppone che il limite di celle per oggetto sia 9 o più.</span><span class="sxs-lookup"><span data-stu-id="83269-193">This illustration assumes that the cells-per-object limit is 9 or more.</span></span> <span data-ttu-id="83269-194">Se tuttavia il limite di celle per oggetto è pari o inferiore a 8, la cella 15 non viene suddivisa e viene conteggiata da sola per l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="83269-194">If the cells-per-object limit were 8 or less, however, cell 15 would not be tessellated, and only that cell 15 would be counted for the object.</span></span>

 <span data-ttu-id="83269-195">Per impostazione predefinita il limite di celle per oggetto è pari a 16, una soluzione intermedia soddisfacente tra spazio e precisione per la maggior parte di indici spaziali.</span><span class="sxs-lookup"><span data-stu-id="83269-195">By default, the cells-per-object limit is 16 cells per object, which provides a satisfactory trade-off between space and precision for most spatial indexes.</span></span> <span data-ttu-id="83269-196">Tuttavia, l'istruzione [create Spatial Index](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] supporta una clausola CELLS_PER_OBJECT `=` *n* che consente di specificare un limite di celle per oggetto compreso tra 1 e 8192 inclusi.</span><span class="sxs-lookup"><span data-stu-id="83269-196">However, the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement supports a CELLS_PER_OBJECT`=`*n* clause that enables you to specify a cells-per-object limit between 1 and 8192, inclusive.</span></span>

> [!NOTE]
>  <span data-ttu-id="83269-197">L'impostazione **cells_per_object** di un indice spaziale è visibile nella vista del catalogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="83269-197">The **cells_per_object** setting of a spatial index is visible in the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="deepest-cell-rule"></a><span data-ttu-id="83269-198">Regola della cella più in basso</span><span class="sxs-lookup"><span data-stu-id="83269-198">Deepest-Cell Rule</span></span>
 <span data-ttu-id="83269-199">La regola della cella più in basso sfrutta il fatto che ogni cella di livello inferiore appartiene alla cella a essa superiore: una cella di livello 4 appartiene a una cella di livello 3, una cella di livello 3 appartiene a una cella di livello 2 e una cella di livello 2 appartiene a una cella di livello 1.</span><span class="sxs-lookup"><span data-stu-id="83269-199">The deepest-cell rule exploits the fact that every lower-level cell belongs to the cell above it: a level-4 cell belongs to a level-3 cell, a level-3 cell belongs to a level-2 cell, and a level-2 cell belongs to a level-1 cell.</span></span> <span data-ttu-id="83269-200">Un oggetto che appartiene alla cella 1.1.1.1, ad esempio, appartiene anche alle celle 1.1.1, 1.1 e 1.</span><span class="sxs-lookup"><span data-stu-id="83269-200">For example, an object that belongs to cell 1.1.1.1 also belongs to cell 1.1.1, cell 1.1, and cell 1.</span></span> <span data-ttu-id="83269-201">Il riconoscimento di tali relazioni gerarchiche tra celle è incorporata in Query Processor.</span><span class="sxs-lookup"><span data-stu-id="83269-201">Knowledge of such cell-hierarchy relationships is built into the query processor.</span></span> <span data-ttu-id="83269-202">Pertanto, solo le celle di livello più basso devono essere registrate nell'indice, rendendo minime le informazioni da archiviare.</span><span class="sxs-lookup"><span data-stu-id="83269-202">Therefore, only the deepest-level cells need to be recorded in the index, minimizing the information that the index needs to store.</span></span>

 <span data-ttu-id="83269-203">Nell'illustrazione seguente, un poligono a forma di diamante relativamente piccolo è suddiviso a mosaico.</span><span class="sxs-lookup"><span data-stu-id="83269-203">In the following illustration, a relatively small diamond-shaped polygon is tessellated.</span></span> <span data-ttu-id="83269-204">L'indice utilizza il limite di celle per oggetto predefinito di 16 che non è raggiunto per questo piccolo oggetto.</span><span class="sxs-lookup"><span data-stu-id="83269-204">The index uses the default cells-per-object limit of 16, which is not reached for this small object.</span></span> <span data-ttu-id="83269-205">La suddivisione a mosaico, pertanto, continua fino al livello 4.</span><span class="sxs-lookup"><span data-stu-id="83269-205">Therefore, tessellation continues down to level 4.</span></span> <span data-ttu-id="83269-206">Il poligono si trova nelle celle comprese tra il livello 1 e il livello 3 seguenti: 4, 4.4 e 4.4.10 e 4.4.14.</span><span class="sxs-lookup"><span data-stu-id="83269-206">The polygon resides in the following level-1 through level-3 cells: 4, 4.4, and 4.4.10 and 4.4.14.</span></span> <span data-ttu-id="83269-207">Utilizzando la regola della cella più in basso, tuttavia, nella suddivisione a mosaico vengono contate solo le 12 celle di livello 4: 4.4.10.13-15 e 4.4.14.1-3, 4.4.14.5-7 e 4.4.14.9-11.</span><span class="sxs-lookup"><span data-stu-id="83269-207">However, using the deepest-cell rule, the tessellation counts only the twelve level-4 cells: 4.4.10.13-15 and 4.4.14.1-3, 4.4.14.5-7, and 4.4.14.9-11.</span></span>

 <span data-ttu-id="83269-208">![Ottimizzazione della cella più in basso](../../database-engine/media/spndx-opt-deepest-cell.gif "Ottimizzazione della cella più in basso")</span><span class="sxs-lookup"><span data-stu-id="83269-208">![Deepest-cell optimization](../../database-engine/media/spndx-opt-deepest-cell.gif "Deepest-cell optimization")</span></span>

###  <a name="tessellation-schemes"></a><a name="schemes"></a><span data-ttu-id="83269-209">Schemi a mosaico</span><span class="sxs-lookup"><span data-stu-id="83269-209">Tessellation Schemes</span></span>
 <span data-ttu-id="83269-210">Il comportamento di un indice spaziale dipende parzialmente dal relativo *schema a mosaico*.</span><span class="sxs-lookup"><span data-stu-id="83269-210">The behavior of a spatial index depends partly on its *tessellation scheme*.</span></span> <span data-ttu-id="83269-211">Lo schema a mosaico è specifico per il tipo di dati.</span><span class="sxs-lookup"><span data-stu-id="83269-211">The tessellation scheme is data-type specific.</span></span> <span data-ttu-id="83269-212">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]gli indici spaziali supportano due schemi a mosaico:</span><span class="sxs-lookup"><span data-stu-id="83269-212">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], spatial indexes support two tessellation schemes:</span></span>

-   <span data-ttu-id="83269-213">*Mosaico della griglia di geometria*, ovvero lo schema per il `geometry` tipo di dati.</span><span class="sxs-lookup"><span data-stu-id="83269-213">*Geometry grid tessellation*, which is the scheme for the `geometry` data type.</span></span>

-   <span data-ttu-id="83269-214">*Mosaico della griglia geografica*, applicabile alle colonne del `geography` tipo di dati.</span><span class="sxs-lookup"><span data-stu-id="83269-214">*Geography grid tessellation*, which applies to columns of the `geography` data type.</span></span>

> [!NOTE]
>  <span data-ttu-id="83269-215">L'impostazione **tessellation_scheme** di un indice spaziale è visibile nella vista del catalogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="83269-215">The **tessellation_scheme** setting of a spatial index is visible in the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="geometry-grid-tessellation-scheme"></a><span data-ttu-id="83269-216">Schema a mosaico per griglia di geometria</span><span class="sxs-lookup"><span data-stu-id="83269-216">Geometry Grid Tessellation Scheme</span></span>
 <span data-ttu-id="83269-217">Lo schema a mosaico GEOMETRY_AUTO_GRID è lo schema a mosaico predefinito per il tipo di dati `geometry` per [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="83269-217">GEOMETRY_AUTO_GRID tessellation is the default tessellation scheme for the `geometry` data type for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and later.</span></span>  <span data-ttu-id="83269-218">Lo schema a mosaico GEOMETRY_GRID è l'unico schema a mosaico disponibile per il tipo di dati geometry in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="83269-218">GEOMETRY_GRID tessellation is the only tessellation scheme available for geometry data types in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="83269-219">In questa sezione vengono trattati alcuni aspetti della suddivisione a mosaico per la griglia di geometria che sono rilevanti per l'utilizzo di indici spaziali, ovvero i metodi e i rettangoli di selezione supportati.</span><span class="sxs-lookup"><span data-stu-id="83269-219">This section discusses aspects of geometry grid tessellation that are relevant to working with spatial indexes: supported methods and bounding boxes.</span></span>

> [!NOTE]
>  <span data-ttu-id="83269-220">È possibile specificare in modo esplicito questo schema a mosaico utilizzando la clausola USING (GEOMETRY_AUTO_GRID/GEOMETRY_GRID) dell'istruzione [create Spatial Index](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="83269-220">You can explicitly specify this tessellation scheme by using the USING (GEOMETRY_AUTO_GRID/GEOMETRY_GRID) clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

##### <a name="the-bounding-box"></a><span data-ttu-id="83269-221">Riquadro</span><span class="sxs-lookup"><span data-stu-id="83269-221">The Bounding Box</span></span>
 <span data-ttu-id="83269-222">I dati geometrici occupano un piano che può essere infinito.</span><span class="sxs-lookup"><span data-stu-id="83269-222">Geometric data occupies a plane that can be infinite.</span></span> <span data-ttu-id="83269-223">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], tuttavia, un indice spaziale richiede uno spazio finito.</span><span class="sxs-lookup"><span data-stu-id="83269-223">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], however, a spatial index requires a finite space.</span></span> <span data-ttu-id="83269-224">Per stabilire uno spazio finito per la scomposizione, lo schema a mosaico per la griglia di geometria richiede un *riquadro*rettangolare.</span><span class="sxs-lookup"><span data-stu-id="83269-224">To establish a finite space for decomposition, the geometry grid tessellation scheme requires a rectangular *bounding box*.</span></span> <span data-ttu-id="83269-225">Il rettangolo di delimitazione è definito da quattro coordinate, `(` _x-min_**,**_y-min_ `)` e `(` _x-max_**,**_y-max_ `)` , che vengono archiviate come proprietà dell'indice spaziale.</span><span class="sxs-lookup"><span data-stu-id="83269-225">The bounding box is defined by four coordinates, `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)`, which are stored as properties of the spatial index.</span></span> <span data-ttu-id="83269-226">Queste coordinate rappresentano gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="83269-226">These coordinates represent the following:</span></span>

-   <span data-ttu-id="83269-227">*x-min* è la coordinata x dell'angolo inferiore sinistro del rettangolo di selezione.</span><span class="sxs-lookup"><span data-stu-id="83269-227">*x-min* is the x-coordinate of the lower-left corner of the bounding box.</span></span>

-   <span data-ttu-id="83269-228">*y-min* è la coordinata y dell'angolo inferiore sinistro.</span><span class="sxs-lookup"><span data-stu-id="83269-228">*y-min* is the y-coordinate of the lower-left corner.</span></span>

-   <span data-ttu-id="83269-229">*x-max* è la coordinata x dell'angolo superiore destro.</span><span class="sxs-lookup"><span data-stu-id="83269-229">*x-max* is the x-coordinate of the upper-right corner.</span></span>

-   <span data-ttu-id="83269-230">*y-max* è la coordinata y dell'angolo superiore destro.</span><span class="sxs-lookup"><span data-stu-id="83269-230">*y-max* is the y-coordinate of upper-right corner.</span></span>

> [!NOTE]
>  <span data-ttu-id="83269-231">Queste coordinate sono specificate dalla clausola BOUNDING_BOX dell'istruzione [create Spatial Index](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="83269-231">These coordinates are specified by the BOUNDING_BOX clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

 <span data-ttu-id="83269-232">Le `(` coordinate _x-min_**,**_y-min_ `)` e `(` _x-max_**,**_y-max_ `)` determinano la posizione e le dimensioni del rettangolo di selezione.</span><span class="sxs-lookup"><span data-stu-id="83269-232">The `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)` coordinates determine the placement and dimensions of the bounding box.</span></span> <span data-ttu-id="83269-233">Lo spazio al di fuori del riquadro viene considerato come una cella unica numerata con 0.</span><span class="sxs-lookup"><span data-stu-id="83269-233">The space outside of the bounding box is treated as a single cell that is numbered 0.</span></span>

 <span data-ttu-id="83269-234">L'indice spaziale scompone lo spazio nel riquadro.</span><span class="sxs-lookup"><span data-stu-id="83269-234">The spatial index decomposes the space inside the bounding box.</span></span> <span data-ttu-id="83269-235">che viene riempito dalla griglia di livello 1 della gerarchia di griglie.</span><span class="sxs-lookup"><span data-stu-id="83269-235">The level-1 grid of the grid hierarchy fills the bounding box.</span></span> <span data-ttu-id="83269-236">Per posizionare un oggetto geometrico nella gerarchia di griglie, l'indice spaziale confronta le coordinate dell'oggetto con quelle del riquadro.</span><span class="sxs-lookup"><span data-stu-id="83269-236">To place a geometric object in the grid hierarchy, the spatial index compares the coordinates of the object to the bounding-box coordinates.</span></span>

 <span data-ttu-id="83269-237">Nella figura seguente vengono mostrati i punti definiti dalle `(` coordinate _x-min_**,**_y-min_ `)` e `(` _x-max_**,**_y-max_ `)` del rettangolo di delimitazione.</span><span class="sxs-lookup"><span data-stu-id="83269-237">The following illustration shows the points defined by the `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)` coordinates of the bounding box.</span></span> <span data-ttu-id="83269-238">Il livello superiore della gerarchia di griglie viene mostrato come una griglia 4x4.</span><span class="sxs-lookup"><span data-stu-id="83269-238">The top-level of the grid hierarchy is shown as a 4x4 grid.</span></span> <span data-ttu-id="83269-239">Ai fini dell'illustrazione, i livelli inferiori sono omessi.</span><span class="sxs-lookup"><span data-stu-id="83269-239">For the purpose of illustration, the lower levels are omitted.</span></span> <span data-ttu-id="83269-240">Lo spazio al di fuori del riquadro è indicato da uno zero (0).</span><span class="sxs-lookup"><span data-stu-id="83269-240">The space outside of the bounding box is indicated by a zero (0).</span></span> <span data-ttu-id="83269-241">L'oggetto 'A' si estende in parte oltre il riquadro e l'oggetto 'B' si trova completamente al di fuori del riquadro nella cella 0.</span><span class="sxs-lookup"><span data-stu-id="83269-241">Note that object 'A' extends partly beyond the box, and object 'B' lies completely outside the box in cell 0.</span></span>

 <span data-ttu-id="83269-242">![Rettangolo di selezione contenente le coordinate e la cella 0](../../database-engine/media/spndx-bb-4x4-objects.gif "Rettangolo di selezione contenente le coordinate e la cella 0.").</span><span class="sxs-lookup"><span data-stu-id="83269-242">![Bounding box showing coordinates and cell 0.](../../database-engine/media/spndx-bb-4x4-objects.gif "Bounding box showing coordinates and cell 0.")</span></span>

 <span data-ttu-id="83269-243">Un riquadro corrisponde ad alcune parti dei dati spaziali di un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="83269-243">A bounding box corresponds to some portion of an application's spatial data.</span></span> <span data-ttu-id="83269-244">In base all'applicazione, il riquadro dell'indice può contenere tutti o solo una parte dei dati archiviati nella colonna spaziale.</span><span class="sxs-lookup"><span data-stu-id="83269-244">Whether the bounding-box of the index completely contains the data stored in the spatial column, or only contains a portion, is up to the application.</span></span> <span data-ttu-id="83269-245">Solo le operazioni calcolate su oggetti che sono completamente inseriti nel riquadro traggono vantaggio dall'indice spaziale.</span><span class="sxs-lookup"><span data-stu-id="83269-245">Only operations computed on objects that are entirely inside of the bounding box benefit from the spatial index.</span></span> <span data-ttu-id="83269-246">Pertanto, per ottenere il massimo vantaggio da un indice spaziale in una colonna `geometry`, è necessario specificare un riquadro che contenga tutti o la maggior parte degli oggetti.</span><span class="sxs-lookup"><span data-stu-id="83269-246">Therefore, to gain the greatest advantage from a spatial index on a `geometry` column, you need to specify a bounding-box that contains all or most of the objects.</span></span>

> [!NOTE]
>  <span data-ttu-id="83269-247">Le densità della griglia di un indice spaziale sono visibili nelle colonne bounding_box_xmin, bounding_box_ymin, bounding_box_xmax e bounding_box_ymax della vista del catalogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="83269-247">The grid densities of a spatial index are visible in the bounding_box_xmin, bounding_box_ymin, bounding_box_xmax, and bounding_box_ymax columns of the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="the-geography-grid-tessellation-scheme"></a><span data-ttu-id="83269-248">Schema a mosaico per la griglia di geografia</span><span class="sxs-lookup"><span data-stu-id="83269-248">The Geography Grid Tessellation Scheme</span></span>
 <span data-ttu-id="83269-249">Questo schema a mosaico si applica solo a una colonna `geography`.</span><span class="sxs-lookup"><span data-stu-id="83269-249">This tessellation scheme applies only to a `geography` column.</span></span> <span data-ttu-id="83269-250">In questa sezione vengono riepilogati i metodi supportati dal mosaico della griglia di geografia e discusso il modo in cui lo spazio geodetico è proiettato su un piano scomposto in una gerarchia di griglie.</span><span class="sxs-lookup"><span data-stu-id="83269-250">This section summarizes the methods that are supported by geography grid tessellation and discusses how geodetic space is projected onto a plane, which is then decomposed into a grid hierarchy.</span></span>

> [!NOTE]
>  <span data-ttu-id="83269-251">È possibile specificare in modo esplicito questo schema a mosaico utilizzando la clausola USING (GEOGRAPHY_AUTO_GRID/GEOGRAPHY_GRID) dell'istruzione [create Spatial Index](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="83269-251">You can explicitly specify this tessellation scheme by using the USING (GEOGRAPHY_AUTO_GRID/GEOGRAPHY_GRID) clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

##### <a name="projection-of-the-geodetic-space-onto-a-plane"></a><span data-ttu-id="83269-252">Proiezione dello spazio geodetico su un piano</span><span class="sxs-lookup"><span data-stu-id="83269-252">Projection of the Geodetic Space onto a Plane</span></span>
 <span data-ttu-id="83269-253">I calcoli sulle istanze (oggetti) `geography` considerano lo spazio che contiene gli oggetti come un ellissoide geodetico.</span><span class="sxs-lookup"><span data-stu-id="83269-253">Computations on `geography` instances (objects) treat the space containing the objects as a geodetic ellipsoid.</span></span> <span data-ttu-id="83269-254">Per scomporre questo spazio lo schema a mosaico della griglia di geografia divide la superficie dell'ellissoide negli emisferi superiori e inferiori e quindi esegue i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="83269-254">To decompose this space, the geography grid tessellation scheme divides the surface of the ellipsoid into its upper and lower hemispheres and then performs the following steps:</span></span>

1.  <span data-ttu-id="83269-255">Proiezione di ogni emisfero sui facet di una piramide del quadrilatero.</span><span class="sxs-lookup"><span data-stu-id="83269-255">Projects each hemisphere onto the facets of a quadrilateral pyramid.</span></span>

2.  <span data-ttu-id="83269-256">Appiattimento delle due piramidi.</span><span class="sxs-lookup"><span data-stu-id="83269-256">Flattens the two pyramids.</span></span>

3.  <span data-ttu-id="83269-257">Unione delle piramidi piatte per formare un piano non euclideo.</span><span class="sxs-lookup"><span data-stu-id="83269-257">Joins the flattened pyramids to form a non-Euclidean plane.</span></span>

 <span data-ttu-id="83269-258">Nell'illustrazione seguente viene mostrata una vista schematica del processo di scomposizione a tre passaggi.</span><span class="sxs-lookup"><span data-stu-id="83269-258">The following illustration shows a schematic view of the three-step decomposition process.</span></span> <span data-ttu-id="83269-259">Nelle piramidi, le linee punteggiate rappresentano i limiti dei quattro facet di ogni piramide.</span><span class="sxs-lookup"><span data-stu-id="83269-259">In the pyramids, the dotted lines represent the boundaries of the four facets of each pyramid.</span></span> <span data-ttu-id="83269-260">I passaggi 1 e 2 illustrano l'ellissoide geodetico, utilizzando una linea verde orizzontale per rappresentare la linea longitudinale dell'equatore e una serie di linee verdi verticali per rappresentare diverse linee della latitudine.</span><span class="sxs-lookup"><span data-stu-id="83269-260">Steps 1 and 2 illustrate the geodetic ellipsoid, using a green horizontal line to represent the equatorial longitude line and a series of green vertical lines to represent several latitude lines.</span></span> <span data-ttu-id="83269-261">Il passaggio 1 mostra le piramidi proiettate sui due emisferi.</span><span class="sxs-lookup"><span data-stu-id="83269-261">Step 1 shows the pyramids being projected over the two hemispheres.</span></span> <span data-ttu-id="83269-262">Il passaggio 2 mostra le piramidi appiattite.</span><span class="sxs-lookup"><span data-stu-id="83269-262">Step 2 shows the pyramids being flattened.</span></span> <span data-ttu-id="83269-263">Il passaggio 3 illustra le piramidi bidimensionali, dopo che sono state combinate per formare un piano, mostrando un certo numero di linee longitudinali proiettate.</span><span class="sxs-lookup"><span data-stu-id="83269-263">Step 3 illustrates the flattened pyramids, after they have been combined to form a plane, showing a number of projected longitude lines.</span></span> <span data-ttu-id="83269-264">Queste linee proiettate sono dritte e di lunghezza diversa, a seconda di dove cadono sulle piramidi.</span><span class="sxs-lookup"><span data-stu-id="83269-264">Notice that these projected lines are straightened and vary in length, depending on where they fall on the pyramids.</span></span>

 <span data-ttu-id="83269-265">![Proiezione dell'ellissoide in un piano](../../database-engine/media/spndx-geodetic-projection.gif "Proiezione dell'ellissoide in un piano")</span><span class="sxs-lookup"><span data-stu-id="83269-265">![Projection of the ellipsoid onto a plane](../../database-engine/media/spndx-geodetic-projection.gif "Projection of the ellipsoid onto a plane")</span></span>

 <span data-ttu-id="83269-266">Una volta che lo spazio è stato proiettato sul piano, questo viene scomposto in una gerarchia di griglie a quattro livelli.</span><span class="sxs-lookup"><span data-stu-id="83269-266">Once the space has been projected onto the plane, the plane is decomposed into the four-level grid hierarchy.</span></span> <span data-ttu-id="83269-267">Livelli diversi possono utilizzare densità della griglia differenti.</span><span class="sxs-lookup"><span data-stu-id="83269-267">Different levels can use different grid densities.</span></span> <span data-ttu-id="83269-268">Nell'illustrazione seguente viene mostrato il piano dopo essere stato scomposto in una griglia a 1 livello 4x4.</span><span class="sxs-lookup"><span data-stu-id="83269-268">The following illustration shows the plane after it has been decomposed into a 4x4 level-1 grid.</span></span> <span data-ttu-id="83269-269">Ai fini dell'illustrazione, i livelli inferiori della gerarchia di griglie sono omessi.</span><span class="sxs-lookup"><span data-stu-id="83269-269">For the purposes of illustration, the lower-levels of the grid hierarchy are omitted.</span></span> <span data-ttu-id="83269-270">In effetti, il piano è completamente scomposto in una gerarchia di griglie a quattro livelli.</span><span class="sxs-lookup"><span data-stu-id="83269-270">In actuality, the plane is fully decomposed into a four-level grid hierarchy.</span></span> <span data-ttu-id="83269-271">Al termine del processo di scomposizione, i dati geografici vengono letti, riga per riga, dalla colonna relativa e il processo a mosaico viene eseguito per ogni oggetto.</span><span class="sxs-lookup"><span data-stu-id="83269-271">After the decomposition process finishes, the geographic data is read, row by row, from the geography column, and the tessellation process is performed for each object in turn.</span></span>

 <span data-ttu-id="83269-272">![Griglia di geografia di livello 1](../../database-engine/media/spndx-geodetic-level1grid.gif "Griglia di geografia di livello 1")</span><span class="sxs-lookup"><span data-stu-id="83269-272">![Level-1 geography grid](../../database-engine/media/spndx-geodetic-level1grid.gif "Level-1 geography grid")</span></span>

##  <a name="methods-supported-by-spatial-indexes"></a><a name="methods"></a><span data-ttu-id="83269-273">Metodi supportati dagli indici spaziali</span><span class="sxs-lookup"><span data-stu-id="83269-273">Methods Supported by Spatial Indexes</span></span>

###  <a name="geometry-methods-supported-by-spatial-indexes"></a><a name="geometry"></a><span data-ttu-id="83269-274">Metodi Geometry supportati dagli indici spaziali</span><span class="sxs-lookup"><span data-stu-id="83269-274">Geometry Methods Supported by Spatial Indexes</span></span>
 <span data-ttu-id="83269-275">In alcuni casi, gli indici spaziali supportano i metodi geometry orientati ai set seguenti: STContains(), STDistance(), STEquals(), STIntersects(), STOverlaps(), STTouches() e STWithin().</span><span class="sxs-lookup"><span data-stu-id="83269-275">Spatial indexes support the following set-oriented geometry methods under certain conditions: STContains(), STDistance(), STEquals(), STIntersects(), STOverlaps(), STTouches(), and STWithin().</span></span> <span data-ttu-id="83269-276">Per essere supportati da un indice spaziale questi metodi devono essere utilizzati all'interno della clausola WHERE o JOIN ON di una query e devono verificarsi all'interno di un predicato del seguente form generale:</span><span class="sxs-lookup"><span data-stu-id="83269-276">To be supported by a spatial index, these methods must be used within the WHERE or JOIN ON clause of a query, and they must occur within a predicate of the following general form:</span></span>

 <span data-ttu-id="83269-277">*Geometry1*. *method_name*(*Geometry2*)*comparison_operator \* \* valid_number*</span><span class="sxs-lookup"><span data-stu-id="83269-277">*geometry1*.*method_name*(*geometry2*)*comparison_operator\*\*valid_number*</span></span>

 <span data-ttu-id="83269-278">Per ottenere un risultato non Null, *geometry1* e *geometry2* devono avere lo stesso [identificatore SRID (Spatial Reference Identifier)](../spatial/spatial-reference-identifiers-srids.md).</span><span class="sxs-lookup"><span data-stu-id="83269-278">To return a non-null result, *geometry1* and *geometry2* must have the same [spatial reference identifier (SRID)](../spatial/spatial-reference-identifiers-srids.md).</span></span> <span data-ttu-id="83269-279">In caso contrario, il metodo restituisce NULL.</span><span class="sxs-lookup"><span data-stu-id="83269-279">Otherwise, the method returns NULL.</span></span>

 <span data-ttu-id="83269-280">Gli indici spaziali supportano i seguenti form di predicato:</span><span class="sxs-lookup"><span data-stu-id="83269-280">Spatial indexes support the following predicate forms:</span></span>

-   <span data-ttu-id="83269-281">*geometry1*.[STContains](/sql/t-sql/spatial-geometry/stcontains-geometry-data-type)(*geometry2*) = 1</span><span class="sxs-lookup"><span data-stu-id="83269-281">*geometry1*.[STContains](/sql/t-sql/spatial-geometry/stcontains-geometry-data-type)(*geometry2*) = 1</span></span>

-   <span data-ttu-id="83269-282">*Geometry1*. [STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*Geometry2*) < *numero*</span><span class="sxs-lookup"><span data-stu-id="83269-282">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) < *number*</span></span>

-   <span data-ttu-id="83269-283">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) <= *numero*</span><span class="sxs-lookup"><span data-stu-id="83269-283">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) <= *number*</span></span>

-   <span data-ttu-id="83269-284">*geometry1*.[STEquals](/sql/t-sql/spatial-geometry/stequals-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="83269-284">*geometry1*.[STEquals](/sql/t-sql/spatial-geometry/stequals-geometry-data-type)(*geometry2*)= 1</span></span>

-   <span data-ttu-id="83269-285">*geometry1*.[STIntersects](/sql/t-sql/spatial-geometry/stintersects-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="83269-285">*geometry1*.[STIntersects](/sql/t-sql/spatial-geometry/stintersects-geometry-data-type)(*geometry2*)= 1</span></span>

-   <span data-ttu-id="83269-286">*geometry1.*</span><span class="sxs-lookup"><span data-stu-id="83269-286">*geometry1.*</span></span> <span data-ttu-id="83269-287">[STOverlaps](/sql/t-sql/spatial-geometry/stoverlaps-geometry-data-type) *(geometry2) = 1*</span><span class="sxs-lookup"><span data-stu-id="83269-287">[STOverlaps](/sql/t-sql/spatial-geometry/stoverlaps-geometry-data-type) *(geometry2) = 1*</span></span>

-   <span data-ttu-id="83269-288">*geometry1*.[STTouches](/sql/t-sql/spatial-geometry/sttouches-geometry-data-type)(*geometry2*) = 1</span><span class="sxs-lookup"><span data-stu-id="83269-288">*geometry1*.[STTouches](/sql/t-sql/spatial-geometry/sttouches-geometry-data-type)(*geometry2*) = 1</span></span>

-   <span data-ttu-id="83269-289">*geometry1*.[STWithin](/sql/t-sql/spatial-geometry/stwithin-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="83269-289">*geometry1*.[STWithin](/sql/t-sql/spatial-geometry/stwithin-geometry-data-type)(*geometry2*)= 1</span></span>

###  <a name="geography-methods-supported-by-spatial-indexes"></a><a name="geography"></a><span data-ttu-id="83269-290">Metodi geography supportati dagli indici spaziali</span><span class="sxs-lookup"><span data-stu-id="83269-290">Geography Methods Supported by Spatial Indexes</span></span>
 <span data-ttu-id="83269-291">In alcuni casi, gli indici spaziali supportano i metodi geography orientati ai set seguenti: STIntersects(),STEquals() e STDistance().</span><span class="sxs-lookup"><span data-stu-id="83269-291">Under certain conditions, spatial indexes support the following set-oriented geography methods: STIntersects(),STEquals(), and STDistance().</span></span> <span data-ttu-id="83269-292">Per essere supportati da un indice spaziale questi metodi devono essere utilizzati all'interno della clausola WHERE di una query e devono verificarsi all'interno di un predicato del seguente form generale:</span><span class="sxs-lookup"><span data-stu-id="83269-292">To be supported by a spatial index, these methods must be used within the WHERE clause of a query, and they must occur within a predicate of the following general form:</span></span>

 <span data-ttu-id="83269-293">*geography1*. *method_name*(*geography2*)*comparison_operator \* \* valid_number*</span><span class="sxs-lookup"><span data-stu-id="83269-293">*geography1*.*method_name*(*geography2*)*comparison_operator\*\*valid_number*</span></span>

 <span data-ttu-id="83269-294">Per ottenere un risultato non Null, *geography1* e *geography2* devono avere lo stesso [identificatore SRID (Spatial Reference Identifier)](../spatial/spatial-reference-identifiers-srids.md).</span><span class="sxs-lookup"><span data-stu-id="83269-294">To return a non-null result, *geography1* and *geography2* must have the same [Spatial Reference Identifier (SRID)](../spatial/spatial-reference-identifiers-srids.md).</span></span> <span data-ttu-id="83269-295">In caso contrario, il metodo restituisce NULL.</span><span class="sxs-lookup"><span data-stu-id="83269-295">Otherwise, the method returns NULL.</span></span>

 <span data-ttu-id="83269-296">Gli indici spaziali supportano i seguenti form di predicato:</span><span class="sxs-lookup"><span data-stu-id="83269-296">Spatial indexes support the following predicate forms:</span></span>

-   <span data-ttu-id="83269-297">*geography1*.[STIntersects](/sql/t-sql/spatial-geography/stintersects-geography-data-type)(*geography2*)= 1</span><span class="sxs-lookup"><span data-stu-id="83269-297">*geography1*.[STIntersects](/sql/t-sql/spatial-geography/stintersects-geography-data-type)(*geography2*)= 1</span></span>

-   <span data-ttu-id="83269-298">*geography1*.[STEquals](/sql/t-sql/spatial-geography/stequals-geography-data-type)(*geography2*)= 1</span><span class="sxs-lookup"><span data-stu-id="83269-298">*geography1*.[STEquals](/sql/t-sql/spatial-geography/stequals-geography-data-type)(*geography2*)= 1</span></span>

-   <span data-ttu-id="83269-299">*geography1*. [STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) < *numero*</span><span class="sxs-lookup"><span data-stu-id="83269-299">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) < *number*</span></span>

-   <span data-ttu-id="83269-300">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) <= *numero*</span><span class="sxs-lookup"><span data-stu-id="83269-300">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) <= *number*</span></span>

### <a name="queries-that-use-spatial-indexes"></a><span data-ttu-id="83269-301">Query con indici spaziali</span><span class="sxs-lookup"><span data-stu-id="83269-301">Queries that use Spatial Indexes</span></span>
 <span data-ttu-id="83269-302">Gli indici spaziali sono supportati solo nelle query che prevedono un operatore spaziale indicizzato nella clausola `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="83269-302">Spatial indexes are only supported in queries that include an indexed spatial operator in the `WHERE` clause.</span></span> <span data-ttu-id="83269-303">Ad esempio, la sintassi seguente:</span><span class="sxs-lookup"><span data-stu-id="83269-303">For example syntax such as:</span></span>

```
[spatial object].SpatialMethod([reference spatial object]) [ = | < ] [const literal or variable]
```

 <span data-ttu-id="83269-304">Query Optimizer riconosce la commutatività di operazioni spaziali ( `@a.STIntersects(@b) = @b.STInterestcs(@a)` ).</span><span class="sxs-lookup"><span data-stu-id="83269-304">The query optimizer understands the commutativity of spatial operations (that `@a.STIntersects(@b) = @b.STInterestcs(@a)` ).</span></span> <span data-ttu-id="83269-305">Tuttavia, l'indice spaziale non verrà utilizzato se l'inizio di un confronto non contiene l'operatore spaziale (ad esempio `WHERE 1 = spatial op` non utilizzerà l'indice spaziale).</span><span class="sxs-lookup"><span data-stu-id="83269-305">However, the spatial index will not be used if the beginning of a comparison does not contain the spatial operator (for example `WHERE 1 = spatial op` will not use the spatial index).</span></span> <span data-ttu-id="83269-306">Per utilizzare l'indice spaziale, riscrivere il confronto (ad esempio `WHERE spatial op = 1`).</span><span class="sxs-lookup"><span data-stu-id="83269-306">To use the spatial index, rewrite the comparison (for example `WHERE spatial op = 1`).</span></span>

 <span data-ttu-id="83269-307">Analogamente a qualsiasi altro indice, quando è supportato un indice spaziale, l'utilizzo di quest'ultimo viene scelto in base al costo, pertanto tramite Query Optimizer non è possibile scegliere di utilizzare l'indice spaziale anche se vengono soddisfatti tutti i requisiti per utilizzarlo.</span><span class="sxs-lookup"><span data-stu-id="83269-307">As with any other index, when a spatial index is supported, the use of the spatial index is chosen based on cost, so the query optimizer might not choose to use the spatial index even though all requirements for using it are met.</span></span> <span data-ttu-id="83269-308">Utilizzare showplan per verificare se l'indice spaziale è stato utilizzato e, se necessario, specificare gli hint per la query per forzare un piano di query desiderato.</span><span class="sxs-lookup"><span data-stu-id="83269-308">Use showplan to see if the spatial index was used and if necessary provide query hints to force a desired query plan.</span></span>

 <span data-ttu-id="83269-309">Il tipo adiacente più prossimo di query supporta anche gli indici spaziali, tuttavia solo se viene scritta una sintassi di query specifica.</span><span class="sxs-lookup"><span data-stu-id="83269-309">The nearest neighbor type of query also supports spatial indexes however only if a specific query syntax is written.</span></span> <span data-ttu-id="83269-310">La sintassi appropriata è:</span><span class="sxs-lookup"><span data-stu-id="83269-310">The appropriate syntax is:</span></span>

```
SELECT TOP(K) [WITH TIES] * 
FROM <Table> AS T [WITH(INDEX(<SpatialIndex>))]
WHERE <SpatialColumn>.STDistance(@reference_object) IS NOT NULL
ORDER BY <SpatialColumn>.STDistance(@reference_object) [;]
```

## <a name="see-also"></a><span data-ttu-id="83269-311">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="83269-311">See Also</span></span>
 [<span data-ttu-id="83269-312">Dati spaziali &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="83269-312">Spatial Data &#40;SQL Server&#41;</span></span>](../spatial/spatial-data-sql-server.md)


