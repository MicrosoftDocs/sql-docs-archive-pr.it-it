---
title: Esecuzione preparata | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- deferred statement preparation
- prepared execution [ODBC]
- SQLPrepare function
- ODBC applications, statements
- SQLExecute function
- statements [ODBC], prepared execution
ms.assetid: f3a9d32b-6cd7-4f0c-b38d-c8ccc4ee40c3
author: rothja
ms.author: jroth
ms.openlocfilehash: 33ab9f35cd9d3eaf04e688a89390b5eb3f00ae58
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87624112"
---
# <a name="prepared-execution"></a><span data-ttu-id="e3ce2-102">Esecuzione preparata</span><span class="sxs-lookup"><span data-stu-id="e3ce2-102">Prepared Execution</span></span>
  <span data-ttu-id="e3ce2-103">L'API ODBC definisce l'esecuzione preparata per ridurre l'overhead dell'analisi e della compilazione associato all'esecuzione ripetuta di un'istruzione [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e3ce2-103">The ODBC API defines prepared execution as a way to reduce the parsing and compiling overhead associated with repeatedly executing a [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span> <span data-ttu-id="e3ce2-104">Nell'applicazione viene compilata una stringa di caratteri contenente un'istruzione SQL che viene eseguita in due fasi.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-104">The application builds a character string containing an SQL statement and then executes it in two stages.</span></span> <span data-ttu-id="e3ce2-105">Chiama la [funzione SQLPrepare](https://go.microsoft.com/fwlink/?LinkId=59360) una volta per analizzare e compilare l'istruzione in un piano di esecuzione da [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e3ce2-105">It calls [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360) once to have the statement parsed and compiled into an execution plan by the [!INCLUDE[ssDE](../../../includes/ssde-md.md)].</span></span> <span data-ttu-id="e3ce2-106">Viene quindi chiamato **SQLExecute** per ogni esecuzione del piano di esecuzione preparato.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-106">It then calls **SQLExecute** for each execution of the prepared execution plan.</span></span> <span data-ttu-id="e3ce2-107">con conseguente risparmio dell'overhead correlato all'analisi e alla compilazione in ogni esecuzione.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-107">This saves the parsing and compiling overhead on each execution.</span></span> <span data-ttu-id="e3ce2-108">L'esecuzione preparata viene generalmente utilizzata dalle applicazioni per eseguire ripetutamente la stessa istruzione SQL con parametri.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-108">Prepared execution is commonly used by applications to repeatedly execute the same, parameterized SQL statement.</span></span>  
  
 <span data-ttu-id="e3ce2-109">Per la maggior parte dei database, l'esecuzione preparata è più veloce dell'esecuzione diretta per le istruzioni eseguite più di tre o quattro volte, sopratutto perché l'istruzione viene compilata una sola volta, mentre le istruzioni eseguite direttamente vengono compilate ogni volta che vengono eseguite.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-109">For most databases, prepared execution is faster than direct execution for statements executed more than three or four times primarily because the statement is compiled only once, while statements executed directly are compiled each time they are executed.</span></span> <span data-ttu-id="e3ce2-110">L'esecuzione preparata può inoltre offrire una riduzione del traffico di rete perché il driver può inviare all'origine dati un identificatore del piano di esecuzione e i valori dei parametri, anziché un'intera istruzione SQL, ogni volta che viene eseguita l'istruzione.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-110">Prepared execution can also provide a reduction in network traffic because the driver can send an execution plan identifier and the parameter values, rather than an entire SQL statement, to the data source each time the statement is executed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="e3ce2-111">riduce la differenza di prestazioni tra l'esecuzione diretta e preparata tramite algoritmi ottimizzati per il rilevamento e il riutilizzo dei piani di esecuzione da **SQLExecDirect**.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-111">reduces the performance difference between direct and prepared execution through improved algorithms for detecting and reusing execution plans from **SQLExecDirect**.</span></span> <span data-ttu-id="e3ce2-112">offrendo alle istruzioni eseguite direttamente alcuni dei vantaggi di prestazioni associati all'esecuzione preparata.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-112">This makes some of the performance benefits of prepared execution available to statements executed directly.</span></span> <span data-ttu-id="e3ce2-113">Per ulteriori informazioni, vedere [esecuzione diretta](direct-execution.md).</span><span class="sxs-lookup"><span data-stu-id="e3ce2-113">For more information, see [Direct Execution](direct-execution.md).</span></span>  
  
 <span data-ttu-id="e3ce2-114">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] è inoltre disponibile il supporto nativo per l'esecuzione preparata.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-114">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] also provides native support for prepared execution.</span></span> <span data-ttu-id="e3ce2-115">Un piano di esecuzione viene compilato in **SQLPrepare** e successivamente eseguito quando viene chiamato **SQLExecute** .</span><span class="sxs-lookup"><span data-stu-id="e3ce2-115">An execution plan is built on **SQLPrepare** and later executed when **SQLExecute** is called.</span></span> <span data-ttu-id="e3ce2-116">Poiché [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] non è necessario per compilare stored procedure temporanee in **SQLPrepare**, non si verifica alcun overhead aggiuntivo nelle tabelle di sistema in **tempdb**.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-116">Because [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not required to build temporary stored procedures on **SQLPrepare**, there is no extra overhead on the system tables in **tempdb**.</span></span>  
  
 <span data-ttu-id="e3ce2-117">Per motivi di prestazioni, la preparazione dell'istruzione viene posticipata fino alla chiamata a **SQLExecute** o all'esecuzione di un'operazione di metaproprietà, ad esempio [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) o [SQLDescribeParam](../../native-client-odbc-api/sqldescribeparam.md) in ODBC.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-117">For performance reasons, the statement preparation is deferred until **SQLExecute** is called or a metaproperty operation (such as [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) or [SQLDescribeParam](../../native-client-odbc-api/sqldescribeparam.md) in ODBC) is performed.</span></span> <span data-ttu-id="e3ce2-118">Questo è il comportamento predefinito.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-118">This is the default behavior.</span></span> <span data-ttu-id="e3ce2-119">Eventuali errori nell'istruzione da preparare saranno noti solo dopo l'esecuzione dell'istruzione o dell'operazione di metaproprietà.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-119">Any errors in the statement being prepared are not known until the statement is executed or a metaproperty operation is performed.</span></span> <span data-ttu-id="e3ce2-120">È possibile disattivare questo comportamento predefinito impostando l'attributo SQL_SOPT_SS_DEFER_PREPARE dell'istruzione specifica del driver ODBC di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client su SQL_DP_OFF.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-120">Setting the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver-specific statement attribute SQL_SOPT_SS_DEFER_PREPARE to SQL_DP_OFF can turn off this default behavior.</span></span>  
  
 <span data-ttu-id="e3ce2-121">In caso di preparazione posticipata, la chiamata a **SQLDescribeCol** o **SQLDescribeParam** prima di chiamare **SQLExecute** genera un round trip aggiuntivo al server.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-121">In case of deferred prepare, calling either **SQLDescribeCol** or **SQLDescribeParam** before calling **SQLExecute** generates an extra roundtrip to the server.</span></span> <span data-ttu-id="e3ce2-122">In **SQLDescribeCol**il driver rimuove la clausola WHERE dalla query e la invia al server con SET FMTONLY ON per ottenere la descrizione delle colonne del primo set di risultati restituito dalla query.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-122">On **SQLDescribeCol**, the driver removes the WHERE clause from the query and sends it to the server with SET FMTONLY ON to get the description of the columns in the first result set returned by the query.</span></span> <span data-ttu-id="e3ce2-123">In **SQLDescribeParam**il driver chiama il server per ottenere una descrizione delle espressioni o delle colonne a cui fanno riferimento i marcatori dei parametri nella query.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-123">On **SQLDescribeParam**, the driver calls the server to get a description of the expressions or columns referenced by any parameter markers in the query.</span></span> <span data-ttu-id="e3ce2-124">Questo metodo presenta inoltre alcune restrizioni, ad esempio non è in grado di risolvere i parametri nelle sottoquery.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-124">This method also has some restrictions, such as not being able to resolve parameters in subqueries.</span></span>  
  
 <span data-ttu-id="e3ce2-125">Un utilizzo eccessivo di **SQLPrepare** con il [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC di Native Client comporta un peggioramento delle prestazioni, soprattutto quando si è connessi a versioni precedenti di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-125">Excess use of **SQLPrepare** with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver degrades performance, especially when connected to earlier versions of SQL Server.</span></span> <span data-ttu-id="e3ce2-126">L'esecuzione preparata non deve essere utilizzata per le istruzioni eseguite una sola volta.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-126">Prepared execution should not be used for statements executed a single time.</span></span> <span data-ttu-id="e3ce2-127">L'esecuzione preparata è più lenta dell'esecuzione diretta per una singola esecuzione di un'istruzione perché richiede un round trip in rete aggiuntivo dal client al server.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-127">Prepared execution is slower than direct execution for a single execution of a statement because it requires an extra network roundtrip from the client to the server.</span></span> <span data-ttu-id="e3ce2-128">Nelle versioni precedenti di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] viene inoltre generata una stored procedure temporanea.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-128">On earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] it also generates a temporary stored procedure.</span></span>  
  
 <span data-ttu-id="e3ce2-129">Le istruzioni preparate non possono essere utilizzate per creare oggetti temporanei in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e3ce2-129">Prepared statements cannot be used to create temporary objects on [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="e3ce2-130">Alcune applicazioni ODBC iniziali utilizzano **SQLPrepare** ogni volta che si utilizza [SQLBindParameter](../../native-client-odbc-api/sqlbindparameter.md) .</span><span class="sxs-lookup"><span data-stu-id="e3ce2-130">Some early ODBC applications used **SQLPrepare** any time [SQLBindParameter](../../native-client-odbc-api/sqlbindparameter.md) was used.</span></span> <span data-ttu-id="e3ce2-131">**SQLBindParameter** non richiede l'uso di **SQLPrepare**, può essere usato con **SQLExecDirect**.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-131">**SQLBindParameter** does not require the use of **SQLPrepare**, it can be used with **SQLExecDirect**.</span></span> <span data-ttu-id="e3ce2-132">Ad esempio, utilizzare **SQLExecDirect** con **SQLBindParameter** per recuperare il codice restituito o i parametri di output da un stored procedure eseguito una sola volta.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-132">For example, use **SQLExecDirect** with **SQLBindParameter** to retrieve the return code or output parameters from a stored procedure that is only executed one time.</span></span> <span data-ttu-id="e3ce2-133">Non usare **SQLPrepare** con **SQLBindParameter** a meno che la stessa istruzione non venga eseguita più volte.</span><span class="sxs-lookup"><span data-stu-id="e3ce2-133">Do not use **SQLPrepare** with **SQLBindParameter** unless the same statement will be executed multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e3ce2-134">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="e3ce2-134">See Also</span></span>  
 [<span data-ttu-id="e3ce2-135">Esecuzione di istruzioni &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="e3ce2-135">Executing Statements &#40;ODBC&#41;</span></span>](executing-statements-odbc.md)  
  
  
