---
title: SQL Server file di dati in Azure | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
ms.assetid: 38ffd9c2-18a5-43d2-b674-e425addec4e4
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 21f960a50ed48ff2b146d96b73a1609d73b35c32
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87712003"
---
# <a name="sql-server-data-files-in-azure"></a><span data-ttu-id="25a2a-102">File di dati di SQL Server in Azure</span><span class="sxs-lookup"><span data-stu-id="25a2a-102">SQL Server Data Files in Azure</span></span>
  <span data-ttu-id="25a2a-103">SQL Server file di dati in Azure consente il supporto nativo per i file di database SQL Server archiviati come BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-103">SQL Server Data Files in Azure enables native support for SQL Server database files stored as Azure Blobs.</span></span> <span data-ttu-id="25a2a-104">Consente di creare un database in SQL Server in esecuzione in locale o in una macchina virtuale in Azure con un percorso di archiviazione dedicato per i dati nell'archivio BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-104">It allows you to create a database in SQL Server running in on-premises or in a virtual machine in Azure with a dedicated storage location for your data in Azure Blob Storage.</span></span> <span data-ttu-id="25a2a-105">Questo miglioramento semplifica in particolar modo lo spostamento di database tra computer mediante le operazioni di collegamento e scollegamento.</span><span class="sxs-lookup"><span data-stu-id="25a2a-105">This enhancement especially simplifies to move databases between machines by using detach and attach operations.</span></span> <span data-ttu-id="25a2a-106">Inoltre, fornisce un percorso di archiviazione alternativo per i file di backup del database consentendo di eseguire il ripristino da o in archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-106">In addition, it provides an alternative storage location for your database backup files by allowing you to restore from or to Azure Storage.</span></span> <span data-ttu-id="25a2a-107">Pertanto, rende possibile l'utilizzo di diverse soluzioni ibride offrendo numerosi vantaggi per la virtualizzazione dei dati, lo spostamento dei dati, la sicurezza e la disponibilità nonché costi moderatamente bassi e manutenzione per una disponibilità elevata e una scalabilità elastica.</span><span class="sxs-lookup"><span data-stu-id="25a2a-107">Therefore, it enables several hybrid solutions by providing several benefits for data virtualization, data movement, security and availability, and any easy low costs and maintenance for high-availability and elastic scaling.</span></span>  
  
 <span data-ttu-id="25a2a-108">Questo argomento introduce i concetti e le considerazioni fondamentali per archiviare i file di dati SQL Server nel servizio di archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-108">This topic introduces concepts and considerations that are central to storing SQL Server data files in Azure Storage Service.</span></span>  
  
 <span data-ttu-id="25a2a-109">Per un'esperienza pratica pratica su come usare questa nuova funzionalità, vedere [esercitazione: SQL Server di file di dati nel servizio di archiviazione di Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="25a2a-109">For a practical hands-on experience on how to use this new feature, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="25a2a-110">Il diagramma seguente illustra che questa funzionalità avanzata consente di archiviare i file di database di SQL Server come BLOB di Azure in archiviazione di Azure, indipendentemente dalla posizione in cui risiede il server.</span><span class="sxs-lookup"><span data-stu-id="25a2a-110">The following diagram demonstrates that this enhancement enables you to store SQL Server database files as Azure blobs in Azure Storage regardless of where your server resides.</span></span>  
  
 <span data-ttu-id="25a2a-111">![Integrazione di SQL Server con archiviazione di Azure](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "Integrazione di SQL Server con archiviazione di Azure")</span><span class="sxs-lookup"><span data-stu-id="25a2a-111">![SQL Server Integration with Azure Storage](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "SQL Server Integration with Azure Storage")</span></span>  
  
## <a name="benefits-of-using-sql-server-data-files-in-azure"></a><span data-ttu-id="25a2a-112">Vantaggi dell'uso di SQL Server file di dati in Azure</span><span class="sxs-lookup"><span data-stu-id="25a2a-112">Benefits of using SQL Server Data Files in Azure</span></span>  
  
-   <span data-ttu-id="25a2a-113">**Vantaggi di una migrazione semplice e rapida:** questa funzionalità semplifica il processo di migrazione spostando un database alla volta tra computer locali nonché tra l'ambiente locale e l'ambiente cloud senza alcuna modifica alle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="25a2a-113">**Easy and fast migration benefits:** This feature simplifies the migration process by moving one database at a time between machines in on-premises as well as between on-premises and cloud environments without any application changes.</span></span> <span data-ttu-id="25a2a-114">Pertanto, supporta una migrazione incrementale senza influire sull'infrastruttura locale esistente.</span><span class="sxs-lookup"><span data-stu-id="25a2a-114">Therefore, it supports an incremental migration while maintaining your existing on-premises infrastructure in place.</span></span> <span data-ttu-id="25a2a-115">Inoltre, l'accesso a un'archiviazione dati centralizzata semplifica la logica dell'applicazione quando un'applicazione deve essere eseguita in più posizioni in un ambiente locale.</span><span class="sxs-lookup"><span data-stu-id="25a2a-115">In addition, having access to a centralized data storage simplifies the application logic when an application needs to run in multiple locations in an on-premises environment.</span></span> <span data-ttu-id="25a2a-116">In alcuni casi, potrebbe essere necessario installare rapidamente centri di calcolo in località geografiche diverse per la raccolta di dati da molte origini diverse.</span><span class="sxs-lookup"><span data-stu-id="25a2a-116">In some cases, you may need to rapidly setup computer centers in geographically dispersed locations, which gather data from many different sources.</span></span> <span data-ttu-id="25a2a-117">Grazie a questa nuova funzionalità avanzata, anziché trasferire i dati da una posizione all'altra, è possibile archiviare molti database come BLOB di Azure e quindi eseguire script Transact-SQL per creare database in computer locali o macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="25a2a-117">By using this new enhancement, instead of moving data from one location to another, you can store many databases as Azure blobs, and then run Transact-SQL scripts to create databases on the local machines or virtual machines.</span></span>  
  
-   <span data-ttu-id="25a2a-118">**Vantaggi di archiviazione senza limiti e senza costi:** Questa funzionalità consente di avere un'archiviazione fuori sede illimitata in Azure, sfruttando al contempo le risorse di calcolo locali.</span><span class="sxs-lookup"><span data-stu-id="25a2a-118">**Cost and limitless storage benefits:** This feature enables you to have limitless off-site storage in Azure while leveraging on-premises compute resources.</span></span> <span data-ttu-id="25a2a-119">Quando si usa Azure come posizione di archiviazione, è possibile concentrarsi sulla logica dell'applicazione senza l'overhead della gestione dell'hardware.</span><span class="sxs-lookup"><span data-stu-id="25a2a-119">When you use Azure as a storage location, you can easily focus on the application logic without the overhead of hardware management.</span></span> <span data-ttu-id="25a2a-120">Se si perde un nodo di calcolo locale, è possibile configurarne uno nuovo senza alcuno spostamento dei dati.</span><span class="sxs-lookup"><span data-stu-id="25a2a-120">If you lose a computation node on-premises, you can set up a new one without any data movement.</span></span>  
  
-   <span data-ttu-id="25a2a-121">**Vantaggi della disponibilità elevata e del ripristino di emergenza:** L'uso di SQL Server file di dati in Azure può semplificare le soluzioni per la disponibilità elevata e il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="25a2a-121">**High availability and disaster recovery benefits:** Using SQL Server Data Files in Azure feature might simplify the high availability and disaster recovery solutions.</span></span> <span data-ttu-id="25a2a-122">Se ad esempio una macchina virtuale in Azure o un'istanza di SQL Server si arresta in modo anomalo, è possibile ricreare i database in una nuova macchina semplicemente ristabilendo i collegamenti ai BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-122">For example, if a virtual machine in Azure or an instance of SQL Server crashes, you can re-create your databases in a new machine by just re-establishing links to Azure Blobs.</span></span>  
  
-   <span data-ttu-id="25a2a-123">**Vantaggi a livello di sicurezza:** con questo nuovo miglioramento è possibile separare un'istanza di calcolo da un'istanza di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="25a2a-123">**Security benefits:** This new enhancement allows you to separate a compute instance from a storage instance.</span></span> <span data-ttu-id="25a2a-124">È possibile disporre di un database completamente crittografato da decrittografare solo in un'istanza di calcolo e non in un'istanza di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="25a2a-124">You can have a fully encrypted database with decryption only occurring on compute instance but not in a storage instance.</span></span> <span data-ttu-id="25a2a-125">In altri termini, usando questa nuova funzionalità avanzata è possibile crittografare tutti i dati in un cloud pubblico tramite i certificati TDE (Transparent Data Encryption) che sono separati fisicamente dai dati.</span><span class="sxs-lookup"><span data-stu-id="25a2a-125">In other words, using this new enhancement, you can encrypt all data in public cloud using Transparent Data Encryption (TDE)  certificates, which are physically separated from the data.</span></span> <span data-ttu-id="25a2a-126">Le chiavi TDE possono essere archiviate nel database master, che viene archiviato in locale nel computer fisicamente protetto in locale e di cui viene eseguito il backup in locale.</span><span class="sxs-lookup"><span data-stu-id="25a2a-126">The TDE keys can be stored in the master database, which is stored locally in your physically secure on-premises machine and backed up locally.</span></span> <span data-ttu-id="25a2a-127">È possibile usare queste chiavi locali per crittografare i dati che si trovano in archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-127">You can use these local keys to encrypt the data, which resides in Azure Storage.</span></span> <span data-ttu-id="25a2a-128">Se le credenziali dell'account di archiviazione del cloud vengono rubate, i dati rimangono protetti perché i certificati TDE risiedono sempre in locale.</span><span class="sxs-lookup"><span data-stu-id="25a2a-128">If your cloud storage account credentials are stolen, your data still stays secure as the TDE certificates always reside in on-premises.</span></span>  
  
## <a name="concepts-and-requirements"></a><span data-ttu-id="25a2a-129">Concetti e requisiti</span><span class="sxs-lookup"><span data-stu-id="25a2a-129">Concepts and Requirements</span></span>  
  
### <a name="azure-storage-concepts"></a><span data-ttu-id="25a2a-130">Concetti relativi ad Archiviazione di Azure</span><span class="sxs-lookup"><span data-stu-id="25a2a-130">Azure Storage Concepts</span></span>  
 <span data-ttu-id="25a2a-131">Quando si usa la funzionalità relativa ai file di dati SQL Server in Azure, è necessario creare un account di archiviazione e un contenitore in Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-131">When using SQL Server Data Files in Azure feature, you need to create a storage account and a container in Azure.</span></span> <span data-ttu-id="25a2a-132">Quindi, è necessario creare credenziali di SQL Server in cui includere le informazioni sui criteri del contenitore nonché una firma di accesso condiviso, necessaria per accedere al contenitore.</span><span class="sxs-lookup"><span data-stu-id="25a2a-132">Then, you need to create a SQL Server credential, which includes information on the policy of the container as well as a shared access signature that is necessary to access the container.</span></span>  
  
 <span data-ttu-id="25a2a-133">In Azure, un account di archiviazione rappresenta il livello più elevato dello spazio dei nomi per l'accesso ai BLOB.</span><span class="sxs-lookup"><span data-stu-id="25a2a-133">In Azure, a storage account represents the highest level of the namespace for accessing Blobs.</span></span> <span data-ttu-id="25a2a-134">Un account di archiviazione può contenere un numero illimitato di contenitori, purché la dimensione totale sia minore di 500 TB.</span><span class="sxs-lookup"><span data-stu-id="25a2a-134">A storage account can contain an unlimited number of containers, as long as their total size is under 500 TB.</span></span> <span data-ttu-id="25a2a-135">Per le informazioni più recenti sui limiti di archiviazione, vedere [Sottoscrizione di Azure e limiti, quote e vincoli dei servizi](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span><span class="sxs-lookup"><span data-stu-id="25a2a-135">For the latest information on storage limits, see [Azure Subscription and Service Limits, Quotas, and Constraints](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span></span> <span data-ttu-id="25a2a-136">Un contenitore fornisce un raggruppamento di un set di oggetti BLOB.</span><span class="sxs-lookup"><span data-stu-id="25a2a-136">A container provides a grouping of a set of Blobs.</span></span> <span data-ttu-id="25a2a-137">Tutti gli oggetti BLOB devono essere inclusi in un contenitore.</span><span class="sxs-lookup"><span data-stu-id="25a2a-137">All Blobs must be in a container.</span></span> <span data-ttu-id="25a2a-138">Un account può contenere un numero illimitato di contenitori.</span><span class="sxs-lookup"><span data-stu-id="25a2a-138">An account can contain an unlimited number of containers.</span></span> <span data-ttu-id="25a2a-139">Analogamente, in un contenitore è possibile archiviare un numero illimitato di oggetti BLOB.</span><span class="sxs-lookup"><span data-stu-id="25a2a-139">Similarly, a container can store an unlimited number of Blobs as well.</span></span> <span data-ttu-id="25a2a-140">Esistono due tipi di oggetti BLOB che è possibile archiviare in Archiviazione di Azure: BLOB in blocchi e BLOB di pagine.</span><span class="sxs-lookup"><span data-stu-id="25a2a-140">There are two types of blobs that can be stored in Azure Storage: block and page blobs.</span></span> <span data-ttu-id="25a2a-141">Questa nuova funzionalità usano i BLOB di pagine, che possono essere avere una dimensione massima di 1 TB, e sono più efficienti quando gli intervalli di byte in un file vengono modificati spesso.</span><span class="sxs-lookup"><span data-stu-id="25a2a-141">This new feature uses Page blobs, which can be up to 1TB in size, and are more efficient when ranges of bytes in a file are modified frequently.</span></span> <span data-ttu-id="25a2a-142">È possibile accedere agli oggetti BLOB utilizzando il seguente formato di URL: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span><span class="sxs-lookup"><span data-stu-id="25a2a-142">You can access Blobs using the following URL format: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span></span>  
  
### <a name="azure-billing-considerations"></a><span data-ttu-id="25a2a-143">Considerazioni sulla fatturazione in Azure</span><span class="sxs-lookup"><span data-stu-id="25a2a-143">Azure Billing Considerations</span></span>  
 <span data-ttu-id="25a2a-144">La stima dei costi associati all'uso dei servizi Azure è un aspetto importante del processo decisionale e di pianificazione.</span><span class="sxs-lookup"><span data-stu-id="25a2a-144">Estimating the cost of using Azure Services is an important matter in the decision making and planning process.</span></span> <span data-ttu-id="25a2a-145">Quando si archiviano file di dati di SQL Server in Archiviazione di Azure, è necessario pagare i costi associati all'archiviazione e alle transazioni.</span><span class="sxs-lookup"><span data-stu-id="25a2a-145">When storing SQL Server data files in Azure Storage, you need to pay costs associated with storage and transactions.</span></span> <span data-ttu-id="25a2a-146">Inoltre, l'implementazione della funzionalità relativa ai file di dati di SQL Server in Archiviazione di Azure richiede il rinnovo del lease di un oggetto BLOB ogni 45-60 secondi in modo implicito.</span><span class="sxs-lookup"><span data-stu-id="25a2a-146">In addition, the implementation of SQL Server Data Files in Azure Storage feature requires a renewal of Blob lease every 45 to 60 seconds implicitly.</span></span> <span data-ttu-id="25a2a-147">Questa operazione comporta dei costi di transazione per ogni file di database, ad esempio per i file con estensione MDF o LDF.</span><span class="sxs-lookup"><span data-stu-id="25a2a-147">This also results in transaction costs per database file, such as .mdf or .ldf.</span></span> <span data-ttu-id="25a2a-148">Secondo alcune stime il costo di rinnovamento dei lease per due file di database (con estensione MDF e LDF) è di circa 2 centesimi al mese in base al modello di determinazione prezzi corrente.</span><span class="sxs-lookup"><span data-stu-id="25a2a-148">Based on our estimations, the cost of renewing leases for two database files (.mdf and .ldf) would be about 2 cents per month according to the current pricing model.</span></span> <span data-ttu-id="25a2a-149">È consigliabile usare le informazioni disponibili nella pagina [Prezzi di Azure](https://azure.microsoft.com/pricing/) per calcolare i costi mensili associati all'uso di Archiviazione e Macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-149">We recommend that you use the information on the [Azure Pricing](https://azure.microsoft.com/pricing/) page to help estimate the monthly costs associated with the use of Azure Storage and Azure Virtual Machines.</span></span>  
  
### <a name="sql-server-concepts"></a><span data-ttu-id="25a2a-150">Concetti relativi a SQL Server</span><span class="sxs-lookup"><span data-stu-id="25a2a-150">SQL Server Concepts</span></span>  
 <span data-ttu-id="25a2a-151">Quando si usa questa nuova funzionalità avanzata, è necessario eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="25a2a-151">When using this new enhancement, you are required to do the followings:</span></span>  
  
-   <span data-ttu-id="25a2a-152">È necessario creare i criteri in un contenitore nonché generare una chiave di firma di accesso condiviso (SAS, Shared Access Signature).</span><span class="sxs-lookup"><span data-stu-id="25a2a-152">You must create a policy on a container and also generate a shared access signature (SAS) key.</span></span>  
  
-   <span data-ttu-id="25a2a-153">Per ogni contenitore usato da un file di dati o di log, è necessario creare credenziali di SQL Server il cui nome corrisponda al percorso del contenitore.</span><span class="sxs-lookup"><span data-stu-id="25a2a-153">For each container used by a data or a log file, you must create a SQL Server Credential whose name matches the container path.</span></span>  
  
-   <span data-ttu-id="25a2a-154">È necessario archiviare le informazioni relative al contenitore di Archiviazione di Azure, il nome dei criteri e la chiave SAS associati nell'archivio delle credenziali di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="25a2a-154">You must store the information regarding Azure Storage container, its associated policy name, and SAS key in the SQL Server credential store.</span></span>  
  
 <span data-ttu-id="25a2a-155">Nell'esempio seguente si presuppone che sia stato creato un contenitore di archiviazione di Azure e che i criteri siano stati creati con diritti di lettura, scrittura ed elenco.</span><span class="sxs-lookup"><span data-stu-id="25a2a-155">The following example assumes that an Azure Storage container has been created, and a policy has been created with read, write, list, rights.</span></span> <span data-ttu-id="25a2a-156">La creazione dei criteri in un contenitore genera una chiave SAS che può essere conservata non crittografata in memoria e che è richiesta da SQL Server per accedere ai file BLOB nel contenitore.</span><span class="sxs-lookup"><span data-stu-id="25a2a-156">Creating a policy on a container generates a SAS key which is safe to keep unencrypted in memory and needed by SQL Server to access the blob files in the container.</span></span> <span data-ttu-id="25a2a-157">Nel frammento di codice seguente sostituire `'your SAS key'` con una voce simile alla seguente: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span><span class="sxs-lookup"><span data-stu-id="25a2a-157">In the following code snippet, replace `'your SAS key'` with an entry similar to the following: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span></span> <span data-ttu-id="25a2a-158">Per altre informazioni, vedere [creare e usare una firma di accesso condiviso](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span><span class="sxs-lookup"><span data-stu-id="25a2a-158">For more information, see [Create and Use a Shared Access Signature](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span></span>  
  
```sql
-- Create a credential  
CREATE CREDENTIAL [https://testdb.blob.core.windows.net/data]  
WITH IDENTITY='SHARED ACCESS SIGNATURE',  
SECRET = 'your SAS key'  
  
-- Create database with data and log files in Azure container.  
CREATE DATABASE testdb   
ON  
( NAME = testdb_dat,  
    FILENAME = 'https://testdb.blob.core.windows.net/data/TestData.mdf' )  
 LOG ON  
( NAME = testdb_log,  
    FILENAME =  'https://testdb.blob.core.windows.net/data/TestLog.ldf')
```  
  
> [!IMPORTANT]
> <span data-ttu-id="25a2a-159">se sono presenti riferimenti attivi ai file di dati in un contenitore, i tentativi di eliminare le credenziali di SQL Server corrispondenti non riescono.</span><span class="sxs-lookup"><span data-stu-id="25a2a-159">If there are any active references to data files in a container, attempts to delete the corresponding SQL Server credential fails.</span></span>  
  
### <a name="security"></a><span data-ttu-id="25a2a-160">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="25a2a-160">Security</span></span>  
 <span data-ttu-id="25a2a-161">Di seguito sono riportati requisiti e considerazioni sulla sicurezza a cui attenersi durante l'archiviazione di file di dati di SQL Server in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-161">The following are security considerations and requirements when storing SQL Server Data Files in Azure Storage.</span></span>  
  
-   <span data-ttu-id="25a2a-162">Quando si crea un contenitore per il servizio di archiviazione BLOB di Azure, è consigliabile impostare l'accesso su privato.</span><span class="sxs-lookup"><span data-stu-id="25a2a-162">When creating a container for the Azure Blob storage service, we recommend that you set the access to private.</span></span> <span data-ttu-id="25a2a-163">Quando si imposta l'accesso su privato, i dati del contenitore e del BLOB possono essere letti solo dal proprietario dell'account Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-163">When you set the access to private, container and blob data can be read by the Azure account owner only.</span></span>  
  
-   <span data-ttu-id="25a2a-164">Quando si archiviano i file di database di SQL Server in Archiviazione di Azure, è necessario usare una firma di accesso condiviso, un URI che concede diritti di accesso limitati a contenitori, BLOB, code e tabelle.</span><span class="sxs-lookup"><span data-stu-id="25a2a-164">When storing SQL Server database files in Azure Storage, you need to use a shared access signature, a URI that grants restricted access rights to containers, blobs, queues, and tables.</span></span> <span data-ttu-id="25a2a-165">Con la firma di accesso condiviso è possibile abilitare SQL Server all'accesso alle risorse nell'account di archiviazione senza condividere la chiave dell'account di archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-165">By using a shared access signature, you can enable SQL Server to access resources in your storage account without sharing your Azure storage account key.</span></span>  
  
-   <span data-ttu-id="25a2a-166">Inoltre, è consigliabile continuare a implementare le procedure di sicurezza locali tradizionali dei database.</span><span class="sxs-lookup"><span data-stu-id="25a2a-166">In addition, we recommend that you continue implementing the traditional on-premises security practices for your databases.</span></span>  
  
### <a name="installation-prerequisites"></a><span data-ttu-id="25a2a-167">Prerequisiti di installazione</span><span class="sxs-lookup"><span data-stu-id="25a2a-167">Installation Prerequisites</span></span>  
 <span data-ttu-id="25a2a-168">Di seguito sono riportati i prerequisiti di installazione per l'archiviazione di file di dati di SQL Server in Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-168">The followings are installation prerequisites when storing SQL Server Data Files in Azuree.</span></span>  
  
-   <span data-ttu-id="25a2a-169">**Istanza locale di SQL Server:** questa funzionalità è inclusa in SQL Server 2014.</span><span class="sxs-lookup"><span data-stu-id="25a2a-169">**SQL Server on-premises:** SQL Server 2014 version includes this feature.</span></span> <span data-ttu-id="25a2a-170">Per informazioni sul download di SQL Server 2014, vedere [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span><span class="sxs-lookup"><span data-stu-id="25a2a-170">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
-   <span data-ttu-id="25a2a-171">SQL Server in esecuzione in una macchina virtuale di Azure: se si installa SQL Server in una macchina virtuale di Azure, installare SQL Server 2014 oppure aggiornare l'istanza esistente.</span><span class="sxs-lookup"><span data-stu-id="25a2a-171">SQL Server running in an Azure virtual machine: If you are installing SQL Server on an Azure Virtual Machine, install SQL Server 2014, or update your existing instance.</span></span> <span data-ttu-id="25a2a-172">Analogamente, è anche possibile creare una nuova macchina virtuale in Azure usando SQL Server immagine della piattaforma 2014.</span><span class="sxs-lookup"><span data-stu-id="25a2a-172">Similarly, you can also create a new virtual machine in Azure using SQL Server 2014 platform image.</span></span> <span data-ttu-id="25a2a-173">Per informazioni sul download di SQL Server 2014, vedere [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span><span class="sxs-lookup"><span data-stu-id="25a2a-173">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
###  <a name="limitations"></a><a name="bkmk_Limitations"></a> <span data-ttu-id="25a2a-174">Limitazioni</span><span class="sxs-lookup"><span data-stu-id="25a2a-174">Limitations</span></span>  
  
-   <span data-ttu-id="25a2a-175">Nella versione corrente di questa funzionalità, l'archiviazione `FileStream` dei dati in archiviazione di Azure non è supportata.</span><span class="sxs-lookup"><span data-stu-id="25a2a-175">In the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span> <span data-ttu-id="25a2a-176">È possibile archiviare `Filestream` i dati in un database locale integrato di archiviazione di Azure, ma non è possibile spostare i dati FILESTREAM tra computer con archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-176">You can store `Filestream` data in an Azure Storage integrated local database but you cannot move Filestream data between machines using Azure Storage.</span></span> <span data-ttu-id="25a2a-177">Per i dati `FileStream`, è consigliabile continuare a usare le tecniche tradizionali per spostare i file (con estensione MDF, LDF) associati a FILESTREAM tra computer diversi.</span><span class="sxs-lookup"><span data-stu-id="25a2a-177">For `FileStream` data, we recommend that you continue using the traditional techniques to move the files (.mdf, .ldf) associated with Filestream between different machines.</span></span>  
  
-   <span data-ttu-id="25a2a-178">attualmente, questo nuovo miglioramento non supporta l'accesso simultaneo di più istanze di SQL Server agli stessi file di database in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-178">Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="25a2a-179">Se ServerA è online con un file di database attivo e se ServerB viene avviato per errore e include anch'esso un database che punta allo stesso file di dati, il secondo server non riuscirà ad avviare il database generando il codice errore **5120 Impossibile aprire il file fisico "%.\*ls". Errore del sistema operativo %d: "%ls"** .</span><span class="sxs-lookup"><span data-stu-id="25a2a-179">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error code **5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"**.</span></span>  
  
-   <span data-ttu-id="25a2a-180">Solo i file con estensione mdf, ldf e ndf possono essere archiviati in Archiviazione di Azure con la funzionalità relativa ai file di dati di SQL Server in Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-180">Only .mdf, .ldf, and .ndf files can be stored in Azure Storage by using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="25a2a-181">Quando si usa la funzionalità relativa ai file di dati di SQL Server in Azure, la replica geografica per l'account di archiviazione non è supportata.</span><span class="sxs-lookup"><span data-stu-id="25a2a-181">When using the SQL Server Data Files in Azure feature, geo-replication for your storage account is not supported.</span></span> <span data-ttu-id="25a2a-182">Se un account di archiviazione viene sottoposto alla replica a livello geografico e si verifica un failover a livello geografico, il database può danneggiarsi.</span><span class="sxs-lookup"><span data-stu-id="25a2a-182">If a storage account is geo-replicated and a geo-failover happened, database corruption could occur.</span></span>  
  
-   <span data-ttu-id="25a2a-183">Ogni oggetto BLOB può avere una dimensione massima di 1 TB,</span><span class="sxs-lookup"><span data-stu-id="25a2a-183">Each Blob can be up to maximum 1 TB in size.</span></span> <span data-ttu-id="25a2a-184">creando un limite massimo per i singoli file di dati e file di log del database che possono essere archiviati in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-184">This creates an upper limit on individual database data and log files that can be stored in Azure Storage.</span></span>  
  
-   <span data-ttu-id="25a2a-185">Non è possibile archiviare i dati di OLTP in memoria in BLOB di Azure usando la funzionalità relativa ai file di dati di SQL Server in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-185">It is not possible to store In-Memory OLTP data in Azure Blob using the SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="25a2a-186">Questo perché OLTP in memoria presenta una dipendenza da `FileStream` e, nella versione corrente di questa funzionalità, l'archiviazione `FileStream` dei dati in archiviazione di Azure non è supportata.</span><span class="sxs-lookup"><span data-stu-id="25a2a-186">This is because In-Memory OLTP has a dependency on `FileStream` and, in the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span>  
  
-   <span data-ttu-id="25a2a-187">Quando si usa la funzionalità file di dati SQL Server in Azure, SQL Server esegue tutti i confronti di URL o percorsi di file usando le regole di confronto impostate nel `master` database.</span><span class="sxs-lookup"><span data-stu-id="25a2a-187">When using SQL Server Data Files in Azure feature, SQL Server performs all URL or file path comparisons using the Collation set in the `master` database.</span></span>  
  
-   <span data-ttu-id="25a2a-188">I `AlwaysOn Availability Groups` sono supportati solo se non si aggiungono nuovi file di database al database primario.</span><span class="sxs-lookup"><span data-stu-id="25a2a-188">`AlwaysOn Availability Groups` are supported as long as you do not add new database files to the primary database.</span></span> <span data-ttu-id="25a2a-189">Se un'operazione sul database richiede la creazione di un nuovo file nel database primario, disabilitare prima i gruppi di disponibilità AlwaysOn nel nodo secondario.</span><span class="sxs-lookup"><span data-stu-id="25a2a-189">If a database operation requires a new file to be created in the primary database, first disable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="25a2a-190">Eseguire quindi l'operazione sul database primario ed eseguire il backup del database nel nodo primario.</span><span class="sxs-lookup"><span data-stu-id="25a2a-190">Then, perform the database operation on the primary database and backup the database in the primary node.</span></span> <span data-ttu-id="25a2a-191">Successivamente, ripristinare il database nel nodo secondario e abilitare i gruppi di disponibilità AlwaysOn nel nodo secondario.</span><span class="sxs-lookup"><span data-stu-id="25a2a-191">Next, restore the database to the secondary node, and enable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="25a2a-192">Si noti che le istanze del cluster di failover AlwaysOn non sono supportate quando si usa la funzionalità file di dati di SQL Server in Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-192">Note that AlwaysOn Failover Cluster Instances is not supported when using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="25a2a-193">Durante il normale funzionamento, in SQL Server vengono usati lease temporanei per riservare gli oggetti BLOB per l'archiviazione con un rinnovo del lease di ciascun oggetto BLOB ogni 45-60 secondi.</span><span class="sxs-lookup"><span data-stu-id="25a2a-193">During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="25a2a-194">Se un server viene arrestato in modo anomalo e viene avviata un'altra istanza di SQL Server configurata per usare gli stessi oggetti BLOB, la nuova istanza dovrà attendere fino a 60 secondi per la scadenza del lease esistente nell'oggetto BLOB.</span><span class="sxs-lookup"><span data-stu-id="25a2a-194">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="25a2a-195">Se si desidera collegare il database a un'altra istanza e non è possibile attendere i 60 secondi per la scadenza del lease, è possibile interrompere in modo esplicito il lease nell'oggetto BLOB per evitare eventuali errori nelle operazioni di collegamento.</span><span class="sxs-lookup"><span data-stu-id="25a2a-195">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
## <a name="tools-and-programming-reference-support"></a><span data-ttu-id="25a2a-196">Strumenti e supporto di riferimento per la programmazione</span><span class="sxs-lookup"><span data-stu-id="25a2a-196">Tools and programming reference support</span></span>  
 <span data-ttu-id="25a2a-197">Questa sezione descrive gli strumenti e le librerie di riferimento per la programmazione che è possibile usare quando si archiviano file di dati di SQL Server in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-197">This section describes which tools and programming reference libraries can be used when storing SQL Server data files in Azure Storage.</span></span>  
  
### <a name="powershell-support"></a><span data-ttu-id="25a2a-198">Supporto PowerShell</span><span class="sxs-lookup"><span data-stu-id="25a2a-198">PowerShell support</span></span>  
 <span data-ttu-id="25a2a-199">In SQL Server 2014 è possibile usare i cmdlet di PowerShell per archiviare i file di dati SQL Server nel servizio di archiviazione BLOB di Azure facendo riferimento a un percorso URL di archiviazione BLOB anziché a un percorso di file.</span><span class="sxs-lookup"><span data-stu-id="25a2a-199">In SQL Server 2014, you can use PowerShell cmdlets to store SQL Server data files in Azure Blob Storage service by referencing a Blob Storage URL path instead of a file path.</span></span> <span data-ttu-id="25a2a-200">È possibile accedere agli oggetti BLOB usando il seguente formato di URL`: http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span><span class="sxs-lookup"><span data-stu-id="25a2a-200">You can access Blobs using the following URL format`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span></span>  
  
### <a name="sql-server-object-and-performance-counters-support"></a><span data-ttu-id="25a2a-201">Supporto di oggetti di SQL Server e dei contatori delle prestazioni</span><span class="sxs-lookup"><span data-stu-id="25a2a-201">SQL Server Object and performance counters support</span></span>  
 <span data-ttu-id="25a2a-202">A partire da SQL Server 2014 è stato aggiunto un nuovo oggetto di SQL Server da usare con la funzionalità relativa ai file di dati di SQL Server in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-202">Starting with SQL Server 2014, a new SQL Server object has been added to be used with SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="25a2a-203">Il nuovo oggetto di SQL Server è denominato [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) e può essere usato da Monitoraggio di sistema per monitorare l'attività quando SQL Server viene eseguito con Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-203">The new SQL Server object is called as [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) and it can be used by System Monitor to monitor activity when running SQL Server with Azure Storage.</span></span>  
  
### <a name="sql-server-management-studio-support"></a><span data-ttu-id="25a2a-204">Supporto di SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="25a2a-204">SQL Server Management Studio support</span></span>  
 <span data-ttu-id="25a2a-205">SQL Server Management Studio consente di usare questa funzionalità tramite diverse finestre di dialogo.</span><span class="sxs-lookup"><span data-stu-id="25a2a-205">SQL Server Management Studio allows you to use this feature via several dialog windows.</span></span> <span data-ttu-id="25a2a-206">Ad esempio, è possibile digitare il percorso URL del contenitore di archiviazione, ad esempio `https://teststorageaccnt.blob.core.windows.net/testcontainer/`, come **Percorso** in diverse finestre di dialogo quali **Nuovo database**, **Collega database** e **Ripristina database**.</span><span class="sxs-lookup"><span data-stu-id="25a2a-206">For example, you can type the URL path of the storage container, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/` as a **Path** in several dialog windows, such as **New Database**, **Attach Database**, and **Restore Database**.</span></span> <span data-ttu-id="25a2a-207">Per altre informazioni, vedere [esercitazione: SQL Server di file di dati nel servizio di archiviazione di Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="25a2a-207">For more information, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
### <a name="sql-server-management-objects-support"></a><span data-ttu-id="25a2a-208">Supporto di SQL Server Management Objects</span><span class="sxs-lookup"><span data-stu-id="25a2a-208">SQL Server Management Objects support</span></span>  
 <span data-ttu-id="25a2a-209">Quando si usa la funzionalità relativa ai file di dati di SQL Server in Azure, sono supportati tutti gli oggetti SMO (SQL Server Management Objects).</span><span class="sxs-lookup"><span data-stu-id="25a2a-209">When using the SQL Server Data Files in Azure feature, all SQL Server Management Objects (SMO) are supported.</span></span> <span data-ttu-id="25a2a-210">Se un oggetto SMO richiede un percorso di file, usare il formato URL dell'oggetto BLOB anziché un percorso di file locale, ad esempio `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span><span class="sxs-lookup"><span data-stu-id="25a2a-210">If an SMO object requires a file path, use the BLOB URL format instead of a local file path, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span></span> <span data-ttu-id="25a2a-211">Per altre informazioni su SQL Server Management Objects (SMO), vedere [Guida alla programmazione di SMO &#40;SQL Server Management Objects&#41;](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) nella documentazione online di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="25a2a-211">For more information about SQL Server Management Objects (SMO), see [SQL Server Management Objects &#40;SMO&#41; Programming Guide](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) in SQL Server Books Online.</span></span>  
  
### <a name="transact-sql-support"></a><span data-ttu-id="25a2a-212">Supporto di Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="25a2a-212">Transact-SQL support</span></span>  
 <span data-ttu-id="25a2a-213">Questa nuova funzionalità ha introdotto la seguente modifica nella superficie di attacco di Transact-SQL:</span><span class="sxs-lookup"><span data-stu-id="25a2a-213">This new feature has introduced the following change in the Transact-SQL surface area:</span></span>  
  
-   <span data-ttu-id="25a2a-214">Una nuova colonna **int** , **credential_id**, nella vista di sistema **sys.master_files** .</span><span class="sxs-lookup"><span data-stu-id="25a2a-214">A new **int** column, **credential_id**, in the **sys.master_files** system view.</span></span> <span data-ttu-id="25a2a-215">La colonna **credential_id** viene usata in modo che i file di dati abilitati per il servizio di archiviazione di Microsoft Azure possano essere riassociati con un riferimento incrociato a sys.credentials per le credenziali create per i file stessi.</span><span class="sxs-lookup"><span data-stu-id="25a2a-215">The **credential_id** column is used to enable Azure Storage enabled data files to be cross-referenced back to sys.credentials for the credentials created for them.</span></span> <span data-ttu-id="25a2a-216">È possibile usarla per la risoluzione dei problemi, ad esempio quando una credenziale non può essere eliminata se usata da un file di database.</span><span class="sxs-lookup"><span data-stu-id="25a2a-216">You can use it for troubleshooting, such as a credential cannot be deleted when there is a database file which uses it.</span></span>  
  
##  <a name="troubleshooting-for-sql-server-data-files-in-azure"></a><a name="bkmk_Troubleshooting"></a><span data-ttu-id="25a2a-217">Risoluzione dei problemi per i file di dati SQL Server in Azure</span><span class="sxs-lookup"><span data-stu-id="25a2a-217">Troubleshooting for SQL Server Data Files in Azure</span></span>  
 <span data-ttu-id="25a2a-218">Per evitare errori a causa di limitazioni o funzionalità non supportate, rivedere innanzitutto [Limitazioni](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span><span class="sxs-lookup"><span data-stu-id="25a2a-218">To avoid errors due to unsupported features or limitations, first review [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span></span>  
  
 <span data-ttu-id="25a2a-219">Di seguito è riportato l'elenco di errori che possono verificarsi durante l'uso della funzionalità relativa ai file di dati di SQL Server in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-219">The list of errors that you might get when using the SQL Server Data Files in Azure Storage feature are as follows.</span></span>  
  
 <span data-ttu-id="25a2a-220">**Errori di autenticazione**</span><span class="sxs-lookup"><span data-stu-id="25a2a-220">**Authentication errors**</span></span>  
  
-   <span data-ttu-id="25a2a-221">*Impossibile eliminare le credenziali '%.\*ls' perché usate da un file di database attivo.*  </span><span class="sxs-lookup"><span data-stu-id="25a2a-221">*Cannot drop the credential '%.\*ls' because it is used by an active database file.* </span></span>  
    <span data-ttu-id="25a2a-222">Risoluzione: questo errore può essere visualizzato quando si tenta di eliminare credenziali ancora usate da un file di database attivo in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-222">Resolution: You may see this error when you try to drop a credential that is still being used by an active database file in Azure Storage.</span></span> <span data-ttu-id="25a2a-223">Per eliminare le credenziali, è innanzitutto necessario eliminare l'oggetto BLOB associato a questo file di database.</span><span class="sxs-lookup"><span data-stu-id="25a2a-223">To drop the credential, first you must delete the associated blob that has this database file.</span></span> <span data-ttu-id="25a2a-224">Per eliminare un BLOB con un lease attivo è innanzitutto necessario interrompere il lease.</span><span class="sxs-lookup"><span data-stu-id="25a2a-224">To delete a blob that has an active lease, you must first break the lease.</span></span>  
  
-   <span data-ttu-id="25a2a-225">*La firma di accesso condiviso non è stata creata correttamente nel contenitore.*  </span><span class="sxs-lookup"><span data-stu-id="25a2a-225">*Shared Access Signature has not been created on the container correctly.* </span></span>  
     <span data-ttu-id="25a2a-226">Risoluzione: assicurarsi di avere creato correttamente una firma di accesso condiviso nel contenitore.</span><span class="sxs-lookup"><span data-stu-id="25a2a-226">Resolution: Make sure that you have created a Shared Access Signature on the container correctly.</span></span> <span data-ttu-id="25a2a-227">Esaminare le istruzioni della lezione 2 in [esercitazione: SQL Server di file di dati nel servizio di archiviazione di Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="25a2a-227">Review the instructions given in Lesson 2 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
-   <span data-ttu-id="25a2a-228">*Le credenziali di SQL Server non sono state create correttamente.*  </span><span class="sxs-lookup"><span data-stu-id="25a2a-228">*SQL Server credential has not been not created correctly.* </span></span>  
    <span data-ttu-id="25a2a-229">Risoluzione: verificare di aver usato "Shared Access Signature" per il campo **Identity** e di aver creato correttamente un segreto.</span><span class="sxs-lookup"><span data-stu-id="25a2a-229">Resolution: Make sure that you have used 'Shared Access Signature' for the **Identity** field and created a secret correctly.</span></span> <span data-ttu-id="25a2a-230">Esaminare le istruzioni della lezione 3 in [esercitazione: SQL Server di file di dati nel servizio di archiviazione di Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="25a2a-230">Review the instructions given in Lesson 3 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="25a2a-231">**Errori di lease di oggetti BLOB:**</span><span class="sxs-lookup"><span data-stu-id="25a2a-231">**Lease blob errors:**</span></span>  
  
-   <span data-ttu-id="25a2a-232">Errore quando si tenta di avviare SQL Server dopo che un'altra istanza che usava gli stessi file BLOB si è arrestata in modo anomalo.</span><span class="sxs-lookup"><span data-stu-id="25a2a-232">Error when trying to start SQL Server after another instance using the same blob files has crashed.</span></span> <span data-ttu-id="25a2a-233">Risoluzione: durante il normale funzionamento, in SQL Server vengono utilizzati lease temporanei per riservare gli oggetti BLOB per l'archiviazione con un rinnovo del lease di ciascun oggetto BLOB ogni 45-60 secondi.</span><span class="sxs-lookup"><span data-stu-id="25a2a-233">Resolution: During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="25a2a-234">Se un server viene arrestato in modo anomalo e viene avviata un'altra istanza di SQL Server configurata per usare gli stessi oggetti BLOB, la nuova istanza dovrà attendere fino a 60 secondi per la scadenza del lease esistente nell'oggetto BLOB.</span><span class="sxs-lookup"><span data-stu-id="25a2a-234">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="25a2a-235">Se si desidera collegare il database a un'altra istanza e non è possibile attendere i 60 secondi per la scadenza del lease, è possibile interrompere in modo esplicito il lease nell'oggetto BLOB per evitare eventuali errori nelle operazioni di collegamento.</span><span class="sxs-lookup"><span data-stu-id="25a2a-235">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
 <span data-ttu-id="25a2a-236">**Errori di database**</span><span class="sxs-lookup"><span data-stu-id="25a2a-236">**Database errors**</span></span>  
  
1.  <span data-ttu-id="25a2a-237">*Errori durante la creazione di un database* </span><span class="sxs-lookup"><span data-stu-id="25a2a-237">*Errors when creating a database* </span></span>  
    <span data-ttu-id="25a2a-238">Risoluzione: rivedere le istruzioni della lezione 4 in [esercitazione: SQL Server di file di dati nel servizio di archiviazione di Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="25a2a-238">Resolution: Review the instructions given in Lesson 4 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
2.  <span data-ttu-id="25a2a-239">*Errori durante l'esecuzione dell'istruzione Alter* </span><span class="sxs-lookup"><span data-stu-id="25a2a-239">*Errors when running the Alter statement* </span></span>  
    <span data-ttu-id="25a2a-240">Risoluzione: accertarsi di eseguire l'istruzione Alter Database quando il database è online.</span><span class="sxs-lookup"><span data-stu-id="25a2a-240">Resolution: Make sure to execute the Alter Database statement when the database is online.</span></span> <span data-ttu-id="25a2a-241">Quando si copiano i file di dati in Archiviazione di Azure, creare sempre un BLOB di pagine e non un BLOB in blocchi.</span><span class="sxs-lookup"><span data-stu-id="25a2a-241">When copying the data files to Azure Storage, always create a page blob not a block blob.</span></span> <span data-ttu-id="25a2a-242">In caso contrario, l'istruzione ALTER Database avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="25a2a-242">Otherwise, ALTER Database will fail.</span></span> <span data-ttu-id="25a2a-243">Esaminare le istruzioni della lezione 7 in [esercitazione: SQL Server di file di dati nel servizio di archiviazione di Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="25a2a-243">Review the instructions given in Lesson 7 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
3.  <span data-ttu-id="25a2a-244">*Codice di errore 5120 Impossibile aprire il file fisico "%. \* ls ". Errore del sistema operativo% d: "% ls"* </span><span class="sxs-lookup"><span data-stu-id="25a2a-244">*Error code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"* </span></span>  
    <span data-ttu-id="25a2a-245">Risoluzione: attualmente, questo nuovo miglioramento non supporta l'accesso simultaneo di più istanze di SQL Server agli stessi file di database in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-245">Resolution: Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="25a2a-246">Se ServerA è online con un file di database attivo e se ServerB viene avviato per errore e include anch'esso un database che punta allo stesso file di dati, il secondo server non riuscirà ad avviare il database generando il codice errore *5120 Impossibile aprire il file fisico "%.\*ls". Errore del sistema operativo %d: "%ls"* .</span><span class="sxs-lookup"><span data-stu-id="25a2a-246">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error *code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"*.</span></span>  
  
     <span data-ttu-id="25a2a-247">Per risolvere questo problema, determinare innanzitutto se è necessario che ServerA acceda al file di database in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-247">To resolve this issue, first determine if you need ServerA to access the database file in Azure Storage or not.</span></span> <span data-ttu-id="25a2a-248">Se non è necessario, rimuovere qualsiasi connessione tra ServerA e i file di database in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="25a2a-248">If not, simply remove any connection between ServerA and the database files in Azure Storage.</span></span> <span data-ttu-id="25a2a-249">A questo scopo, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="25a2a-249">To do this, follow these steps:</span></span>  
  
    1.  <span data-ttu-id="25a2a-250">Impostare il percorso di file di ServerA su una cartella locale tramite l'istruzione ALTER Database.</span><span class="sxs-lookup"><span data-stu-id="25a2a-250">Set the file path of Server A to a local folder by using the ALTER Database statement.</span></span>  
  
    2.  <span data-ttu-id="25a2a-251">Impostare il database come offline in ServerA.</span><span class="sxs-lookup"><span data-stu-id="25a2a-251">Set the database offline in Server A.</span></span>  
  
    3.  <span data-ttu-id="25a2a-252">Copiare quindi i file di database da Archiviazione di Azure nella cartella locale in ServerA, in modo da garantire che ServerA contenga una copia del database in locale.</span><span class="sxs-lookup"><span data-stu-id="25a2a-252">Then, copy database files from Azure Storage to the local folder in Server A. This ensures that ServerA still has a copy of the database locally.</span></span>  
  
    4.  <span data-ttu-id="25a2a-253">Impostare il database come online.</span><span class="sxs-lookup"><span data-stu-id="25a2a-253">Set the database online.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="25a2a-254">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="25a2a-254">See Also</span></span>  
 [<span data-ttu-id="25a2a-255">Esercitazione: File di dati di SQL Server nel servizio Archiviazione di Azure</span><span class="sxs-lookup"><span data-stu-id="25a2a-255">Tutorial: SQL Server Data Files in Azure Storage service</span></span>](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)  
