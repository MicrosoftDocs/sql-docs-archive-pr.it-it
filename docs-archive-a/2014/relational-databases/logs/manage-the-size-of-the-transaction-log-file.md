---
title: Gestire le dimensioni del file di log delle transazioni | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- transaction logs [SQL Server], size management
ms.assetid: 3a70e606-303f-47a8-96d4-2456a18d4297
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 219ba0605d60bab0b13675f7f9f7ff01cace5755
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87627241"
---
# <a name="manage-the-size-of-the-transaction-log-file"></a><span data-ttu-id="f8702-102">Gestione delle dimensioni del file di log delle transazioni</span><span class="sxs-lookup"><span data-stu-id="f8702-102">Manage the Size of the Transaction Log File</span></span>
  <span data-ttu-id="f8702-103">In alcuni casi, può essere utile per ridurre o espandere fisicamente il file di log fisico del log delle transazioni di un database [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f8702-103">In some cases, it can be useful to physically shrink or expand the physical log file of the transaction log of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database.</span></span> <span data-ttu-id="f8702-104">In questo argomento sono contenute informazioni sul monitoraggio delle dimensioni di un log delle transazioni [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , sulla relativa compattazione, sull'aumento delle dimensioni di un file di log delle transazioni, sull'ottimizzazione del tasso di aumento del log delle transazioni di **tempdb** e sul controllo dell'aumento delle dimensioni di un file di log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="f8702-104">This topic contains information about how to monitor the size of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction log, shrink the transaction log, add or enlarge a transaction log file, optimize the **tempdb** transaction log growth rate, and control the growth of a transaction log file.</span></span>  
  
  
##  <a name="monitor-log-space-use"></a><a name="MonitorSpaceUse"></a><span data-ttu-id="f8702-105">Monitorare l'utilizzo dello spazio del log</span><span class="sxs-lookup"><span data-stu-id="f8702-105">Monitor Log Space Use</span></span>  
 <span data-ttu-id="f8702-106">È possibile monitorare l'utilizzo dello spazio del log mediante DBCC SQLPERF (LOGSPACE).</span><span class="sxs-lookup"><span data-stu-id="f8702-106">You can monitor log space use by using DBCC SQLPERF (LOGSPACE).</span></span> <span data-ttu-id="f8702-107">Questo comando restituisce informazioni sulla quantità di spazio del log attualmente utilizzata e indica quando il log delle transazioni deve essere troncato.</span><span class="sxs-lookup"><span data-stu-id="f8702-107">This command returns information about the amount of log space currently used and indicates when the transaction log is in need of truncation.</span></span> <span data-ttu-id="f8702-108">Per altre informazioni, vedere [DBCC SQLPERF &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-sqlperf-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f8702-108">For more information, see [DBCC SQLPERF &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-sqlperf-transact-sql).</span></span> <span data-ttu-id="f8702-109">Per informazioni sulle dimensioni correnti di un file di log, sulle relative dimensioni massime e sull'opzione di aumento automatico delle dimensioni per il file, è anche possibile usare le colonne **size**, **max_size** e **growth** per il file di log in **sys.database_files**.</span><span class="sxs-lookup"><span data-stu-id="f8702-109">For information about the current size of a log file, its maximum size, and the autogrow option for the file, you can also use the **size**, **max_size**, and **growth** columns for that log file in **sys.database_files**.</span></span> <span data-ttu-id="f8702-110">Per altre informazioni, vedere [sys.database_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f8702-110">For more information, see [sys.database_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="f8702-111">È consigliabile evitare l'overload del disco per il log.</span><span class="sxs-lookup"><span data-stu-id="f8702-111">We recommend that you avoid overloading the log disk.</span></span>  
  
  
##  <a name="shrink-the-size-of-the-log-file"></a><a name="ShrinkSize"></a><span data-ttu-id="f8702-112">Compattare le dimensioni del file di log</span><span class="sxs-lookup"><span data-stu-id="f8702-112">Shrink the Size of the Log File</span></span>  
 <span data-ttu-id="f8702-113">Per ridurre la dimensione fisica di un file di log fisico, è necessario ridurre il file di log.</span><span class="sxs-lookup"><span data-stu-id="f8702-113">To reduce the physical size of a physical log file, you must shrink the log file.</span></span> <span data-ttu-id="f8702-114">Ciò può risultare utile se si è a conoscenza del fatto che un file di log delle transazioni contiene spazio inutilizzato che non sarà più necessario.</span><span class="sxs-lookup"><span data-stu-id="f8702-114">This is useful if you know that a transaction log file contains unused space that you will not be needing.</span></span> <span data-ttu-id="f8702-115">La compattazione può verificarsi solo mentre il database è online e quando almeno un file di log virtuale è disponibile.</span><span class="sxs-lookup"><span data-stu-id="f8702-115">Shrinking a log file can occur only while the database is online and, also, at least one virtual log file is free.</span></span> <span data-ttu-id="f8702-116">In alcuni casi, la compattazione del log potrebbe non essere possibile finché il log non viene troncato.</span><span class="sxs-lookup"><span data-stu-id="f8702-116">In some cases, shrinking the log may not be possible until after the next log truncation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f8702-117">Fattori come una transazione con esecuzione prolungata, che mantiene i file di log virtuali attivi per un lungo periodo di tempo, possono limitare in tutto o in parte la compattazione del log.</span><span class="sxs-lookup"><span data-stu-id="f8702-117">Factors, such as a long-running transaction, that keep virtual log files active for an extended period can restrict log shrinkage or even prevent the log from shrinking at all.</span></span> <span data-ttu-id="f8702-118">Per informazioni sui fattori che possono ritardare il troncamento del log, vedere [Log delle transazioni &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f8702-118">For information about factors that can delay log truncation, see [The Transaction Log &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="f8702-119">Il processo di compattazione di un file di log comporta la rimozione di uno o più file di log virtuali che non contengono alcuna parte del log logico (ossia *file di log virtuali inattivi*).</span><span class="sxs-lookup"><span data-stu-id="f8702-119">Shrinking a log file removes one or more virtual log files that do not hold any part of the logical log (that is, *inactive virtual log files*).</span></span> <span data-ttu-id="f8702-120">Quando si compatta un file di log delle transazioni, viene rimosso dalla fine del file di log un numero di file di log virtuali inattivi sufficiente a ridurre il log approssimativamente alle dimensioni di destinazione.</span><span class="sxs-lookup"><span data-stu-id="f8702-120">When a transaction log file is shrunk, enough inactive virtual log files are removed from the end of the log file to reduce the log to approximately the target size.</span></span>  
  
 <span data-ttu-id="f8702-121">**Per compattare un file di log (senza compattare i file di database)**</span><span class="sxs-lookup"><span data-stu-id="f8702-121">**To shrink a log file (without shrinking database files)**</span></span>  
  
-   [<span data-ttu-id="f8702-122">DBCC SHRINKFILE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="f8702-122">DBCC SHRINKFILE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-shrinkfile-transact-sql)  
  
-   [<span data-ttu-id="f8702-123">Compattare un file</span><span class="sxs-lookup"><span data-stu-id="f8702-123">Shrink a File</span></span>](../databases/shrink-a-file.md)  
  
 <span data-ttu-id="f8702-124">**Per monitorare gli eventi di compattazione dei file di log**</span><span class="sxs-lookup"><span data-stu-id="f8702-124">**To monitor log-file shrink events**</span></span>  
  
-   <span data-ttu-id="f8702-125">[Log File Auto Shrink Event Class](../event-classes/log-file-auto-shrink-event-class.md).</span><span class="sxs-lookup"><span data-stu-id="f8702-125">[Log File Auto Shrink Event Class](../event-classes/log-file-auto-shrink-event-class.md).</span></span>  
  
 `To monitor log space`  
  
-   [<span data-ttu-id="f8702-126">DBCC SQLPERF &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="f8702-126">DBCC SQLPERF &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-sqlperf-transact-sql)  
  
-   <span data-ttu-id="f8702-127">[sys.database_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql) (Vedere le colonne **size**, **max_size** e **growth** per il file o i file di log).</span><span class="sxs-lookup"><span data-stu-id="f8702-127">[sys.database_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql) (See the **size**, **max_size**, and **growth** columns for the log file or files.)</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f8702-128">La compattazione dei file di log e di database può essere impostata in modo da essere eseguita automaticamente.</span><span class="sxs-lookup"><span data-stu-id="f8702-128">Shrinking database and log files can be set to occur automatically.</span></span> <span data-ttu-id="f8702-129">È consigliabile tuttavia evitare di eseguire la compattazione automatica impostando la proprietà del database `autoshrink` su FALSE per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="f8702-129">However, we recommend against automatic shrinking, and the `autoshrink` database property is set to FALSE by default.</span></span> <span data-ttu-id="f8702-130">Se `autoshrink` viene impostato su TRUE, la compattazione automatica riduce le dimensioni di un file solo quando più del 25 percento dello spazio del file risulta inutilizzato.</span><span class="sxs-lookup"><span data-stu-id="f8702-130">If `autoshrink` is set to TRUE, automatic shrinking reduces the size of a file only when more than 25 percent of its space is unused.</span></span> <span data-ttu-id="f8702-131">Il file viene compattato fino a quando la percentuale di spazio inutilizzato nel file non risulta pari al 25 percento oppure fino a quando il file non raggiunge le dimensioni originali, a seconda di quale tra questi due sia il valore maggiore.</span><span class="sxs-lookup"><span data-stu-id="f8702-131">The file is shrunk either to the size at which only 25 percent of the file is unused space or to the original size of the file, whichever is larger.</span></span> <span data-ttu-id="f8702-132">Per informazioni sulla modifica dell'impostazione della `autoshrink` proprietà, vedere [visualizzare o modificare le proprietà di un database](../databases/view-or-change-the-properties-of-a-database.md). utilizzare la proprietà **compattazione automatica** nella pagina **opzioni** o [Opzioni ALTER database set &#40;&#41;Transact-SQL ](/sql/t-sql/statements/alter-database-transact-sql-set-options)-utilizzare l'opzione AUTO_SHRINK.</span><span class="sxs-lookup"><span data-stu-id="f8702-132">For information about changing the setting of the `autoshrink` property, see [View or Change the Properties of a Database](../databases/view-or-change-the-properties-of-a-database.md)-use the **Auto Shrink** property on the **Options** page-or [ALTER DATABASE SET Options &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options)-use the AUTO_SHRINK option.</span></span>  
  
  
##  <a name="add-or-enlarge-a-log-file"></a><a name="AddOrEnlarge"></a><span data-ttu-id="f8702-133">Aggiungere o ingrandire un file di log</span><span class="sxs-lookup"><span data-stu-id="f8702-133">Add or Enlarge a Log File</span></span>  
 <span data-ttu-id="f8702-134">In alternativa, è possibile guadagnare spazio aumentando le dimensioni del file di log esistente, se lo spazio è sufficiente, oppure aggiungendo un file di log al database, in genere in un disco diverso.</span><span class="sxs-lookup"><span data-stu-id="f8702-134">Alternatively, you can gain space by enlarging the existing log file (if disk space permits) or by adding a log file to the database, typically on a different disk.</span></span>  
  
-   <span data-ttu-id="f8702-135">Per aggiungere un file di log al database, utilizzare la clausola ADD LOG FILE dell'istruzione ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="f8702-135">To add a log file to the database, use the ADD LOG FILE clause of the ALTER DATABASE statement.</span></span> <span data-ttu-id="f8702-136">L'aggiunta di un file di log consente l'aumento delle dimensioni del log.</span><span class="sxs-lookup"><span data-stu-id="f8702-136">Adding a log file allows the log to grow.</span></span>  
  
-   <span data-ttu-id="f8702-137">Per aumentare le dimensioni del file di log, utilizzare la clausola MODIFY FILE dell'istruzione ALTER DATABASE, specificando la sintassi SIZE e MAXSIZE.</span><span class="sxs-lookup"><span data-stu-id="f8702-137">To enlarge the log file, use the MODIFY FILE clause of the ALTER DATABASE statement, specifying the SIZE and MAXSIZE syntax.</span></span> <span data-ttu-id="f8702-138">Per altre informazioni, vedere [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f8702-138">For more information, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
  
##  <a name="optimize-the-size-of-the-tempdb-transaction-log"></a><a name="tempdbOptimize"></a><span data-ttu-id="f8702-139">Ottimizzare le dimensioni del log delle transazioni di tempdb</span><span class="sxs-lookup"><span data-stu-id="f8702-139">Optimize the Size of the tempdb Transaction Log</span></span>  
 <span data-ttu-id="f8702-140">Il riavvio di un'istanza del server riporta il log delle transazioni del database **tempdb** alle dimensioni originali, antecedenti all'aumento automatico delle dimensioni.</span><span class="sxs-lookup"><span data-stu-id="f8702-140">Restarting a server instance resizes the transaction log of the **tempdb** database to its original, pre-autogrow size.</span></span> <span data-ttu-id="f8702-141">Questo può comportare una riduzione delle prestazioni del log delle transazioni di **tempdb** .</span><span class="sxs-lookup"><span data-stu-id="f8702-141">This can reduce the performance of the **tempdb** transaction log.</span></span> <span data-ttu-id="f8702-142">Per evitare tale overhead, è possibile incrementare le dimensioni del log delle transazioni di **tempdb** dopo l'avvio o il riavvio dell'istanza del server.</span><span class="sxs-lookup"><span data-stu-id="f8702-142">You can avoid this overhead by increasing the size of the **tempdb** transaction log after starting or restarting the server instance.</span></span> <span data-ttu-id="f8702-143">Per altre informazioni, vedere [tempdb Database](../databases/tempdb-database.md).</span><span class="sxs-lookup"><span data-stu-id="f8702-143">For more information, see [tempdb Database](../databases/tempdb-database.md).</span></span>  
  
  
##  <a name="control-the-growth-of-a-transaction-log-file"></a><a name="ControlGrowth"></a><span data-ttu-id="f8702-144">Controllare la crescita di un file di log delle transazioni</span><span class="sxs-lookup"><span data-stu-id="f8702-144">Control the Growth of a Transaction Log File</span></span>  
 <span data-ttu-id="f8702-145">È possibile usare l'istruzione [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) per gestire la crescita di un file di log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="f8702-145">You can use the [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) statement to manage the growth of a transaction log file.</span></span> <span data-ttu-id="f8702-146">Tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="f8702-146">Note the following:</span></span>  
  
-   <span data-ttu-id="f8702-147">Per modificare le dimensioni del file corrente in unità KB, MB, GB e TB, utilizzare l'opzione SIZE.</span><span class="sxs-lookup"><span data-stu-id="f8702-147">To change the current file size in KB, MB, GB, and TB units, use the SIZE option.</span></span>  
  
-   <span data-ttu-id="f8702-148">Per modificare l'incremento di crescita, utilizzare l'opzione FILEGROWTH.</span><span class="sxs-lookup"><span data-stu-id="f8702-148">To change the growth increment, use the FILEGROWTH option.</span></span> <span data-ttu-id="f8702-149">Il valore 0 indica che l'aumento automatico delle dimensioni è disattivato e non è consentita l'allocazione di spazio aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="f8702-149">A value of 0 indicates that automatic growth is set to off and no additional space is permitted.</span></span> <span data-ttu-id="f8702-150">Anche un piccolo aumento automatico delle dimensioni di un file di log può comportare una riduzione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8702-150">A small autogrowth increment on a log file can reduce performance.</span></span> <span data-ttu-id="f8702-151">È consigliabile specificare un incremento di crescita per un file di log sufficientemente grande da consentire di evitare l'espansione frequente.</span><span class="sxs-lookup"><span data-stu-id="f8702-151">The file growth increment on a log file should be sufficiently large to avoid frequent expansion.</span></span> <span data-ttu-id="f8702-152">L'incremento di crescita predefinito pari al 10% è solitamente appropriato.</span><span class="sxs-lookup"><span data-stu-id="f8702-152">The default growth increment of 10 percent is generally suitable.</span></span>  
  
     <span data-ttu-id="f8702-153">Per informazioni sulla modifica della proprietà di aumento delle dimensioni dei file in un file di log, vedere [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f8702-153">For information on changing the file-growth property on a log file, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
-   <span data-ttu-id="f8702-154">Per controllare le dimensioni massime di un file di log in unità KB, MB, GB e TB o per impostare la crescita su UNLIMITED, utilizzare l'opzione MAXSIZE.</span><span class="sxs-lookup"><span data-stu-id="f8702-154">To control the maximum the size of a log file in KB, MB, GB, and TB units or to set growth to UNLIMITED, use the MAXSIZE option.</span></span>  
  
  
## <a name="see-also"></a><span data-ttu-id="f8702-155">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="f8702-155">See Also</span></span>  
 <span data-ttu-id="f8702-156">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f8702-156">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 [<span data-ttu-id="f8702-157">Risolvere i problemi relativi a un log delle transazioni completo &#40;Errore di SQL Server 9002&#41;</span><span class="sxs-lookup"><span data-stu-id="f8702-157">Troubleshoot a Full Transaction Log &#40;SQL Server Error 9002&#41;</span></span>](troubleshoot-a-full-transaction-log-sql-server-error-9002.md)  
  
  
