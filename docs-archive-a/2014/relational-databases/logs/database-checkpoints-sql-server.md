---
title: Checkpoint di database (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 10/13/2015
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- automatic checkpoints
- transaction logs [SQL Server], checkpoints
- logs [SQL Server], active
- pages [SQL Server], dirty
- MinLSN
- checkpoints [SQL Server]
- pages [SQL Server], flushing
- dirty pages
- transaction logs [SQL Server], active logs
- recovery interval option [SQL Server]
- buffer cache [SQL Server]
- logs [SQL Server], checkpoints
- Minimum Recovery LSN
- flushing pages
- active logs
ms.assetid: 98a80238-7409-4708-8a7d-5defd9957185
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 5776d4a23223637c50ac40098fa44342d5cd94a9
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87627248"
---
# <a name="database-checkpoints-sql-server"></a><span data-ttu-id="bb434-102">Checkpoint di database (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="bb434-102">Database Checkpoints (SQL Server)</span></span>
  <span data-ttu-id="bb434-103">In questo argomento viene fornita una panoramica dei checkpoint del database di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="bb434-103">This topic provides an overview of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database checkpoints.</span></span> <span data-ttu-id="bb434-104">Un *checkpoint* crea un punto valido noto da cui [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] può iniziare ad applicare le modifiche contenute nel log durante il recupero successivo a un arresto anomalo del sistema.</span><span class="sxs-lookup"><span data-stu-id="bb434-104">A *checkpoint* creates a known good point from which the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] can start applying changes contained in the log during recovery after an unexpected shutdown or crash.</span></span>  
  
  
##  <a name="overview-of-checkpoints"></a><a name="Overview"></a><span data-ttu-id="bb434-105">Panoramica dei checkpoint</span><span class="sxs-lookup"><span data-stu-id="bb434-105">Overview of Checkpoints</span></span>  
 <span data-ttu-id="bb434-106">Per motivi correlati alle prestazioni, tramite il [!INCLUDE[ssDE](../../includes/ssde-md.md)] vengono apportate modifiche alle pagine del database in memoria, nella cache buffer, ma queste pagine non vengono scritte su disco dopo ogni modifica.</span><span class="sxs-lookup"><span data-stu-id="bb434-106">For performance reasons, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] performs modifications to database pages in memory-in the buffer cache-and does not write these pages to disk after every change.</span></span> <span data-ttu-id="bb434-107">Il [!INCLUDE[ssDE](../../includes/ssde-md.md)] pubblica periodicamente un checkpoint su ogni database.</span><span class="sxs-lookup"><span data-stu-id="bb434-107">Rather, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] periodically issues a checkpoint on each database.</span></span> <span data-ttu-id="bb434-108">Un *checkpoint* scrive le pagine modificate in memoria correnti, note come pagine *dirty*e le informazioni sul log delle transazioni dalla memoria sul disco e registra le informazioni sul log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="bb434-108">A *checkpoint* writes the current in-memory modified pages (known as *dirty pages*) and transaction log information from memory to disk and, also, records information about the transaction log.</span></span>  
  
 <span data-ttu-id="bb434-109">Il [!INCLUDE[ssDE](../../includes/ssde-md.md)] supporta molti tipi di checkpoint: automatici, indiretti, manuali e interni.</span><span class="sxs-lookup"><span data-stu-id="bb434-109">The [!INCLUDE[ssDE](../../includes/ssde-md.md)] supports several types of checkpoints: automatic, indirect, manual, and internal.</span></span> <span data-ttu-id="bb434-110">Nella tabella seguente vengono riepilogati i tipi di checkpoint.</span><span class="sxs-lookup"><span data-stu-id="bb434-110">The following table summarizes the types of checkpoints.</span></span>  
  
|<span data-ttu-id="bb434-111">Nome</span><span class="sxs-lookup"><span data-stu-id="bb434-111">Name</span></span>|[!INCLUDE[tsql](../../includes/tsql-md.md)] <span data-ttu-id="bb434-112">Interfaccia</span><span class="sxs-lookup"><span data-stu-id="bb434-112">Interface</span></span>|<span data-ttu-id="bb434-113">Descrizione</span><span class="sxs-lookup"><span data-stu-id="bb434-113">Description</span></span>|  
|----------|----------------------------------|-----------------|  
|<span data-ttu-id="bb434-114">Automatico</span><span class="sxs-lookup"><span data-stu-id="bb434-114">Automatic</span></span>|<span data-ttu-id="bb434-115">EXEC sp_configure **' `recovery interval` ',' *`seconds`* '**</span><span class="sxs-lookup"><span data-stu-id="bb434-115">EXEC sp_configure **'`recovery interval`','*`seconds`*'**</span></span>|<span data-ttu-id="bb434-116">Emesso automaticamente in background per rispettare il limite di tempo superiore suggerito dall' `recovery interval` opzione di configurazione del server.</span><span class="sxs-lookup"><span data-stu-id="bb434-116">Issued automatically in the background to meet the upper time limit suggested by the `recovery interval` server configuration option.</span></span> <span data-ttu-id="bb434-117">I checkpoint automatici vengono eseguiti fino al completamento.</span><span class="sxs-lookup"><span data-stu-id="bb434-117">Automatic checkpoints run to completion.</span></span>  <span data-ttu-id="bb434-118">I checkpoint automatici sono limitati in base al numero di scritture in sospeso e al fatto che il [!INCLUDE[ssDE](../../includes/ssde-md.md)] rilevi o meno un aumento della latenza di scrittura superiore ai 20 millisecondi.</span><span class="sxs-lookup"><span data-stu-id="bb434-118">Automatic checkpoints are throttled based on the number of outstanding writes and whether the [!INCLUDE[ssDE](../../includes/ssde-md.md)] detects an increase in write latency above 20 milliseconds.</span></span><br /><br /> <span data-ttu-id="bb434-119">Per altre informazioni, vedere [Configurare l'opzione di configurazione del server recovery interval](../../database-engine/configure-windows/configure-the-recovery-interval-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="bb434-119">For more information, see [Configure the recovery interval Server Configuration Option](../../database-engine/configure-windows/configure-the-recovery-interval-server-configuration-option.md).</span></span>|  
|<span data-ttu-id="bb434-120">Indiretto</span><span class="sxs-lookup"><span data-stu-id="bb434-120">Indirect</span></span>|<span data-ttu-id="bb434-121">ALTER DATABASE... IMPOSTA TARGET_RECOVERY_TIME **=** _TARGET_RECOVERY_TIME_ {secondi &#124; minuti}</span><span class="sxs-lookup"><span data-stu-id="bb434-121">ALTER DATABASE ... SET TARGET_RECOVERY_TIME **=**_target_recovery_time_ { SECONDS &#124; MINUTES }</span></span>|<span data-ttu-id="bb434-122">Emesso in background per rispettare un tempo di recupero di destinazione specificato dall'utente per un determinato database.</span><span class="sxs-lookup"><span data-stu-id="bb434-122">Issued in the background to meet a user-specified target recovery time for a given database.</span></span> <span data-ttu-id="bb434-123">Il tempo di recupero di destinazione predefinito è 0 che comporta l'utilizzo di un approccio euristico dei checkpoint automatici nel database.</span><span class="sxs-lookup"><span data-stu-id="bb434-123">The default target recovery time is 0, which causes automatic checkpoint heuristics to be used on the database.</span></span> <span data-ttu-id="bb434-124">Se si utilizza ALTER DATABASE per impostare TARGET_RECOVERY_TIME su >0, viene utilizzato questo valore e non l'intervallo di recupero specificato per l'istanza del server.</span><span class="sxs-lookup"><span data-stu-id="bb434-124">If you have used ALTER DATABASE to set TARGET_RECOVERY_TIME to >0, this value is used, rather than the recovery interval specified for the server instance.</span></span><br /><br /> <span data-ttu-id="bb434-125">Per altre informazioni, vedere [Modificare il tempo di recupero di riferimento di un database &#40;SQL Server&#41;](change-the-target-recovery-time-of-a-database-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="bb434-125">For more information, see [Change the Target Recovery Time of a Database &#40;SQL Server&#41;](change-the-target-recovery-time-of-a-database-sql-server.md).</span></span>|  
|<span data-ttu-id="bb434-126">Manuale</span><span class="sxs-lookup"><span data-stu-id="bb434-126">Manual</span></span>|<span data-ttu-id="bb434-127">CHECKPOINT [ *checkpoint_duration* ]</span><span class="sxs-lookup"><span data-stu-id="bb434-127">CHECKPOINT [ *checkpoint_duration* ]</span></span>|<span data-ttu-id="bb434-128">Emesso quando si esegue un comando CHECKPOINT [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="bb434-128">Issued when you execute a [!INCLUDE[tsql](../../includes/tsql-md.md)] CHECKPOINT command.</span></span> <span data-ttu-id="bb434-129">Il checkpoint manuale si verifica nel database corrente per la connessione.</span><span class="sxs-lookup"><span data-stu-id="bb434-129">The manual checkpoint occurs in the current database for your connection.</span></span> <span data-ttu-id="bb434-130">Per impostazione predefinita, i checkpoint manuali vengono eseguiti fino al completamento.</span><span class="sxs-lookup"><span data-stu-id="bb434-130">By default, manual checkpoints run to completion.</span></span> <span data-ttu-id="bb434-131">La limitazione funziona come per i checkpoint automatici.</span><span class="sxs-lookup"><span data-stu-id="bb434-131">Throttling works the same way as for automatic checkpoints.</span></span>  <span data-ttu-id="bb434-132">Facoltativamente, il parametro *checkpoint_duration* specifica una quantità di tempo richiesta, in secondi, per il completamento del checkpoint.</span><span class="sxs-lookup"><span data-stu-id="bb434-132">Optionally, the *checkpoint_duration* parameter specifies a requested amount of time, in seconds, for the checkpoint to complete.</span></span><br /><br /> <span data-ttu-id="bb434-133">Per altre informazioni, vedere [CHECKPOINT &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/checkpoint-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="bb434-133">For more information, see [CHECKPOINT &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/checkpoint-transact-sql).</span></span>|  
|<span data-ttu-id="bb434-134">Interno</span><span class="sxs-lookup"><span data-stu-id="bb434-134">Internal</span></span>|<span data-ttu-id="bb434-135">No.</span><span class="sxs-lookup"><span data-stu-id="bb434-135">None.</span></span>|<span data-ttu-id="bb434-136">Emesso da varie operazioni del server quali backup e creazione dello snapshot del database per garantire che le immagini del disco corrispondano allo stato corrente del log.</span><span class="sxs-lookup"><span data-stu-id="bb434-136">Issued by various server operations such as backup and database-snapshot creation to guarantee that disk images match the current state of the log.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="bb434-137">L'opzione di impostazione avanzata `-k` di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] consente a un amministratore del database di limitare il comportamento di I/O del checkpoint in base alla velocità effettiva del sottosistema di I/O per alcuni tipi di checkpoint.</span><span class="sxs-lookup"><span data-stu-id="bb434-137">The `-k`[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] advanced setup option enables a database administrator to throttle checkpoint I/O behavior based on the throughput of the I/O subsystem for some types of checkpoints.</span></span> <span data-ttu-id="bb434-138">L' `-k` opzione di installazione si applica ai checkpoint automatici ed eventuali checkpoint manuali e interni altrimenti non limitati.</span><span class="sxs-lookup"><span data-stu-id="bb434-138">The `-k` setup option applies to automatic checkpoints and any otherwise unthrottled manual and internal checkpoints.</span></span>  
  
 <span data-ttu-id="bb434-139">Per i checkpoint automatici, manuali e interni, solo le modifiche apportate dopo l'ultimo checkpoint devono essere sottoposte a rollforward durante il recupero del database.</span><span class="sxs-lookup"><span data-stu-id="bb434-139">For automatic, manual, and internal checkpoints, only modifications made after the latest checkpoint need to be rolled forward during database recovery.</span></span> <span data-ttu-id="bb434-140">Ne consegue una riduzione del tempo necessario per recuperare un database.</span><span class="sxs-lookup"><span data-stu-id="bb434-140">This reduces the time required to recover a database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="bb434-141">Le transazioni di cui non è stato eseguito il commit con esecuzione prolungata aumentano il tempo di recupero per tutti i tipi di checkpoint.</span><span class="sxs-lookup"><span data-stu-id="bb434-141">Long-running uncommitted transactions increase recovery time for all types of checkpoints.</span></span>  
  
  
  
###  <a name="interaction-of-the-target_recovery_time-and-recovery-interval-options"></a><a name="InteractionBwnSettings"></a> <span data-ttu-id="bb434-142">Interazione delle opzioni TARGET_RECOVERY_TIME e 'intervallo di recupero'</span><span class="sxs-lookup"><span data-stu-id="bb434-142">Interaction of the TARGET_RECOVERY_TIME and 'recovery interval' Options</span></span>  
 <span data-ttu-id="bb434-143">Nella tabella seguente viene riepilogata l'interazione tra l'impostazione del **sp_configure " `recovery interval` "** a livello di server e il database ALTER database... Impostazione TARGET_RECOVERY_TIME.</span><span class="sxs-lookup"><span data-stu-id="bb434-143">The following table summarizes the interaction between the server-wide **sp_configure'`recovery interval`'** setting and the database-specific ALTER DATABASE ... TARGET_RECOVERY_TIME setting.</span></span>  
  
|<span data-ttu-id="bb434-144">target_recovery_time</span><span class="sxs-lookup"><span data-stu-id="bb434-144">TARGET_RECOVERY_TIME</span></span>|<span data-ttu-id="bb434-145">'intervallo di recupero'</span><span class="sxs-lookup"><span data-stu-id="bb434-145">'recovery interval'</span></span>|<span data-ttu-id="bb434-146">Tipo di checkpoint utilizzato</span><span class="sxs-lookup"><span data-stu-id="bb434-146">Type of Checkpoint Used</span></span>|  
|----------------------------|-------------------------|-----------------------------|  
|<span data-ttu-id="bb434-147">0</span><span class="sxs-lookup"><span data-stu-id="bb434-147">0</span></span>|<span data-ttu-id="bb434-148">0</span><span class="sxs-lookup"><span data-stu-id="bb434-148">0</span></span>|<span data-ttu-id="bb434-149">checkpoint automatici il cui intervallo di recupero di destinazione è pari a 1 minuto.</span><span class="sxs-lookup"><span data-stu-id="bb434-149">automatic checkpoints whose target recovery interval is 1 minute.</span></span>|  
|<span data-ttu-id="bb434-150">0</span><span class="sxs-lookup"><span data-stu-id="bb434-150">0</span></span>|<span data-ttu-id="bb434-151">>0</span><span class="sxs-lookup"><span data-stu-id="bb434-151">>0</span></span>|<span data-ttu-id="bb434-152">Checkpoint automatici il cui intervallo di recupero di destinazione è specificato dall'impostazione definita dall'utente dell'opzione **sp_configure intervallo di recupero**.</span><span class="sxs-lookup"><span data-stu-id="bb434-152">Automatic checkpoints whose target recovery interval is specified by the user defined setting of the **sp_configurerecovery interval** option.</span></span>|  
|<span data-ttu-id="bb434-153">>0</span><span class="sxs-lookup"><span data-stu-id="bb434-153">>0</span></span>|<span data-ttu-id="bb434-154">Non applicabile.</span><span class="sxs-lookup"><span data-stu-id="bb434-154">Not applicable.</span></span>|<span data-ttu-id="bb434-155">Checkpoint indiretti il cui tempo di recupero di destinazione è determinato dall'impostazione TARGET_RECOVERY_TIME, espresso in secondi.</span><span class="sxs-lookup"><span data-stu-id="bb434-155">Indirect checkpoints whose target recovery time is determined by the TARGET_RECOVERY_TIME setting, expressed in seconds.</span></span>|  
  
###  <a name="automatic-checkpoints"></a><a name="AutomaticChkpt"></a><span data-ttu-id="bb434-156">Checkpoint automatici</span><span class="sxs-lookup"><span data-stu-id="bb434-156">Automatic Checkpoints</span></span>  
 <span data-ttu-id="bb434-157">Viene eseguito un checkpoint automatico ogni volta che il numero di record di log raggiunge il numero di [!INCLUDE[ssDE](../../includes/ssde-md.md)] stime che può elaborare durante il periodo di tempo specificato nell' `recovery interval` opzione di configurazione del server.</span><span class="sxs-lookup"><span data-stu-id="bb434-157">An automatic checkpoint occurs each time that  the number of log records reaches the number the [!INCLUDE[ssDE](../../includes/ssde-md.md)] estimates it can process during the time specified in the `recovery interval` server configuration option.</span></span> <span data-ttu-id="bb434-158">In ogni database senza un tempo di recupero di destinazione definito dall'utente, il [!INCLUDE[ssDE](../../includes/ssde-md.md)] genera checkpoint automatici.</span><span class="sxs-lookup"><span data-stu-id="bb434-158">In every database without a user-defined target recovery time, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] generates automatic checkpoints.</span></span> <span data-ttu-id="bb434-159">La frequenza di checkpoint automatici dipende dall' `recovery interval` opzione di configurazione avanzata del server, che specifica il tempo massimo che una determinata istanza del server deve utilizzare per recuperare un database durante un riavvio del sistema.</span><span class="sxs-lookup"><span data-stu-id="bb434-159">The frequency of automatic checkpoints depends on the `recovery interval` advanced server configuration option, which specifies the maximum time that a given server instance should use to recover a database during a system restart.</span></span> <span data-ttu-id="bb434-160">Il [!INCLUDE[ssDE](../../includes/ssde-md.md)] valuta il numero massimo di record di log che può elaborare nell'intervallo di recupero.</span><span class="sxs-lookup"><span data-stu-id="bb434-160">The [!INCLUDE[ssDE](../../includes/ssde-md.md)] estimates the maximum number of log records it can process within the recovery interval.</span></span> <span data-ttu-id="bb434-161">Quando un database che utilizza i checkpoint automatici raggiunge il numero massimo specificato di record di log, il [!INCLUDE[ssDE](../../includes/ssde-md.md)] pubblica un checkpoint sul database.</span><span class="sxs-lookup"><span data-stu-id="bb434-161">When a database that is using automatic checkpoints reaches this maximum number of log records, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] issues an checkpoint on the database.</span></span> <span data-ttu-id="bb434-162">L'intervallo di tempo tra checkpoint automatici può essere estremamente variabile.</span><span class="sxs-lookup"><span data-stu-id="bb434-162">The time interval between automatic checkpoints can be highly variable.</span></span> <span data-ttu-id="bb434-163">In un database con un considerevole carico di lavoro di transazioni si verificheranno checkpoint più frequenti rispetto a un database utilizzato principalmente per le operazioni in sola lettura.</span><span class="sxs-lookup"><span data-stu-id="bb434-163">A database with a substantial transaction workload will have more frequent checkpoints than a database that is used primarily for read-only operations.</span></span>  
  
 <span data-ttu-id="bb434-164">Inoltre, in base al modello di recupero con registrazione minima, viene messo in coda un checkpoint automatico se il log è pieno al 70 percento.</span><span class="sxs-lookup"><span data-stu-id="bb434-164">Also, under the simple recovery model, an automatic checkpoint is also queued if the log becomes 70 percent full.</span></span>  
  
 <span data-ttu-id="bb434-165">In base al modello di recupero con registrazione minima, a meno che alcuni fattori non ritardino il troncamento del log, un checkpoint automatico tronca la sezione inutilizzata del log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="bb434-165">Under the simple recovery model, unless some factor is delaying log truncation, an automatic checkpoint truncates the unused section of the transaction log.</span></span> <span data-ttu-id="bb434-166">Al contrario, in base ai modelli di recupero con registrazione minima delle operazioni bulk e con registrazione completa, dopo avere stabilito una catena di backup del log, i checkpoint automatici non causano il troncamento del log.</span><span class="sxs-lookup"><span data-stu-id="bb434-166">In contrast, under the full and bulk-logged recovery models, once a log backup chain has been established, automatic checkpoints do not cause log truncation.</span></span> <span data-ttu-id="bb434-167">Per altre informazioni, vedere [Log delle transazioni &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="bb434-167">For more information, see [The Transaction Log &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="bb434-168">Dopo un arresto anomalo del sistema, la quantità di tempo necessaria per recuperare un database dipende in larga misura dalla quantità di I/O casuale necessario per ripristinare le pagine dirty al momento dell'arresto anomalo del sistema.</span><span class="sxs-lookup"><span data-stu-id="bb434-168">After a system crash, the length of time required to recover a given database is largely dependent on the amount of random I/O needed to redo pages that were dirty at the time of the crash.</span></span> <span data-ttu-id="bb434-169">Ciò significa che l' `recovery interval` impostazione non è affidabile.</span><span class="sxs-lookup"><span data-stu-id="bb434-169">This means that the `recovery interval` setting is unreliable.</span></span> <span data-ttu-id="bb434-170">Non è in grado di determinare una durata accurata del recupero.</span><span class="sxs-lookup"><span data-stu-id="bb434-170">It cannot determine an accurate recovery duration.</span></span> <span data-ttu-id="bb434-171">Inoltre, quando è in corso un checkpoint automatico, l'attività di I/O generale per i dati aumenta in modo significativo e imprevedibile.</span><span class="sxs-lookup"><span data-stu-id="bb434-171">Furthermore, when an automatic checkpoint is in progress, the general I/O activity for data increases significantly and quite unpredictably.</span></span>  
  
  
####  <a name="impact-of-recovery-interval-on-recovery-performance"></a><a name="PerformanceImpact"></a><span data-ttu-id="bb434-172">Conseguenze dell'intervallo di recupero sulle prestazioni di ripristino</span><span class="sxs-lookup"><span data-stu-id="bb434-172">Impact of Recovery Interval on Recovery Performance</span></span>  
 <span data-ttu-id="bb434-173">Per un sistema di elaborazione delle transazioni online (OLTP) che utilizza transazioni brevi, `recovery interval` rappresenta il fattore principale che determina il tempo di recupero.</span><span class="sxs-lookup"><span data-stu-id="bb434-173">For an online transaction processing (OLTP) system using short transactions, `recovery interval` is the primary factor determining recovery time.</span></span> <span data-ttu-id="bb434-174">Tuttavia, l' `recovery interval` opzione non influisce sul tempo necessario per annullare una transazione con esecuzione prolungata.</span><span class="sxs-lookup"><span data-stu-id="bb434-174">However, the `recovery interval` option does not affect the time required to undo a long-running transaction.</span></span> <span data-ttu-id="bb434-175">Il ripristino di un database con una transazione con esecuzione prolungata può richiedere molto più tempo rispetto a quello specificato nell' `recovery interval` opzione.</span><span class="sxs-lookup"><span data-stu-id="bb434-175">Recovery of a database with a long-running transaction can take much longer than the specified in the `recovery interval` option.</span></span> <span data-ttu-id="bb434-176">Se, ad esempio, una transazione con esecuzione prolungata impiega due ore per eseguire gli aggiornamenti prima che l'istanza del server venga disabilitata, il recupero effettivo richiede molto più tempo del `recovery interval` valore per recuperare la transazione lunga.</span><span class="sxs-lookup"><span data-stu-id="bb434-176">For example, if a long-running transaction took two hours to perform updates before the server instance became disabled, the actual recovery takes considerably longer than the `recovery interval` value to recover the long transaction.</span></span> <span data-ttu-id="bb434-177">Per informazioni sull'impatto di una transazione con esecuzione prolungata sul tempo di recupero, vedere [Log delle transazioni &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="bb434-177">For more information about the impact of a long running transaction on recovery time, see [The Transaction Log &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="bb434-178">In genere, i valori predefiniti forniscono prestazioni di recupero ottimali.</span><span class="sxs-lookup"><span data-stu-id="bb434-178">Typically, the default values provides optimal recovery performance.</span></span> <span data-ttu-id="bb434-179">Tuttavia, la modifica dell'intervallo di recupero potrebbe migliorare le prestazioni nelle circostanze seguenti:</span><span class="sxs-lookup"><span data-stu-id="bb434-179">However, changing the recovery interval might improve performance in the following circumstances:</span></span>  
  
-   <span data-ttu-id="bb434-180">Se il recupero richiede regolarmente più di 1 minuto quando non viene eseguito il rollback delle transazioni con esecuzione prolungata.</span><span class="sxs-lookup"><span data-stu-id="bb434-180">If recovery routinely takes significantly longer than 1 minute when long-running transactions are not being rolled back.</span></span>  
  
-   <span data-ttu-id="bb434-181">Se si nota che checkpoint frequenti riducono le prestazioni su un database.</span><span class="sxs-lookup"><span data-stu-id="bb434-181">If you notice that frequent checkpoints are impairing performance on a database.</span></span>  
  
 <span data-ttu-id="bb434-182">Se si decide di aumentare l'impostazione `recovery interval`, è consigliabile aumentarla gradualmente di piccoli incrementi e valutare l'effetto di ogni aumento incrementale sulle prestazioni del recupero.</span><span class="sxs-lookup"><span data-stu-id="bb434-182">If you decide to increase the `recovery interval` setting, we recommend increasing it gradually by small increments and evaluating the effect of each incremental increase on recovery performance.</span></span> <span data-ttu-id="bb434-183">Questo approccio è importante perché man mano `recovery interval` che l'impostazione aumenta, il recupero del database richiede molto più tempo per il completamento.</span><span class="sxs-lookup"><span data-stu-id="bb434-183">This approach is important because as the `recovery interval` setting increases, database recovery takes that many times longer to complete.</span></span> <span data-ttu-id="bb434-184">Se, ad esempio, si modifica `recovery interval` 10, il recupero richiede circa 10 volte più tempo del completamento rispetto a quando `recovery interval` è impostato su zero.</span><span class="sxs-lookup"><span data-stu-id="bb434-184">For example, if you change `recovery interval` 10, recovery takes approximately 10 times longer to complete than when `recovery interval` is set to zero.</span></span>  
  
  
###  <a name="indirect-checkpoints"></a><a name="IndirectChkpt"></a><span data-ttu-id="bb434-185">Checkpoint indiretti</span><span class="sxs-lookup"><span data-stu-id="bb434-185">Indirect Checkpoints</span></span>  
 <span data-ttu-id="bb434-186">I checkpoint indiretti, nuovi in [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], offrono un'alternativa a livello di database configurabile ai checkpoint automatici.</span><span class="sxs-lookup"><span data-stu-id="bb434-186">Indirect checkpoints, new in [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], provide a configurable database-level alternative to automatic checkpoints.</span></span> <span data-ttu-id="bb434-187">In caso di un arresto anomalo del sistema, i checkpoint indiretti consentono un tempo di recupero potenzialmente più veloce e più prevedibile rispetto ai checkpoint automatici.</span><span class="sxs-lookup"><span data-stu-id="bb434-187">In the event of a system crash, indirect checkpoints provide potentially faster, more predictable recovery time than automatic checkpoints.</span></span> <span data-ttu-id="bb434-188">I checkpoint indiretti offrono i vantaggi riportati di seguito:</span><span class="sxs-lookup"><span data-stu-id="bb434-188">Indirect checkpoints offer the following advantages:</span></span>  
  
-   <span data-ttu-id="bb434-189">Un carico di lavoro transazionale online su un database configurato per i checkpoint indiretti potrebbe subire un calo delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="bb434-189">An online transactional workload on a database that is configured for indirect checkpoints could experience performance degradation.</span></span> <span data-ttu-id="bb434-190">I checkpoint indiretti assicurano che il numero di pagine dirty è inferiore a una determinata soglia, in modo che il recupero del database viene completato entro il tempo di recupero di riferimento.</span><span class="sxs-lookup"><span data-stu-id="bb434-190">Indirect checkpoints make sure that the number of dirty pages are below a certain threshold so that the database recovery completes within the target recovery time.</span></span> <span data-ttu-id="bb434-191">A differenza dei checkpoint indiretti che usano il numero di pagine dirty, l'opzione di configurazione recovery interval usa il numero di transazioni per determinare il tempo di recupero.</span><span class="sxs-lookup"><span data-stu-id="bb434-191">The recovery interval configuration option uses the number of transactions to determine the recovery time as opposed to indirect checkpoints which makes use of number of dirty pages.</span></span> <span data-ttu-id="bb434-192">Quando i checkpoint indiretti sono abilitati per un database che riceve un numero elevato di operazioni DML, il writer in background può iniziare a scaricare i buffer dirty su disco in modo intensivo per garantire che il tempo necessario per eseguire il recupero non superi il tempo di recupero di riferimento impostato per il database.</span><span class="sxs-lookup"><span data-stu-id="bb434-192">When indirect checkpoints are enabled on a database receiving a large number of DML operations, the background writer can start aggressively flushing dirty buffers to disk to ensure that the time required to perform recovery is within the target recovery time set of the database.</span></span> <span data-ttu-id="bb434-193">Questo può causare in determinati sistemi ulteriore attività di I/O che può comportare un collo di bottiglia delle prestazioni se il sottosistema del disco opera al di sopra o in prossimità della soglia di I/O.</span><span class="sxs-lookup"><span data-stu-id="bb434-193">This can cause additional I/O activity on certain systems which can contribute to a performance bottleneck if the disk subsystem is operating above or nearing the I/O threshold.</span></span>  
  
-   <span data-ttu-id="bb434-194">I checkpoint indiretti consentono di controllare in modo affidabile il tempo di recupero del database tramite factoring del costo di operazioni di I/O casuali durante REDO.</span><span class="sxs-lookup"><span data-stu-id="bb434-194">Indirect checkpoints enable you to reliably control database recovery time by factoring in the cost of random I/O during REDO.</span></span> <span data-ttu-id="bb434-195">In questo modo si consente a un'istanza del server di rimanere entro il limite superiore per i tempi di recupero per un determinato database, tranne quando una transazione con esecuzione prolungata causa tempi UNDO eccessivi.</span><span class="sxs-lookup"><span data-stu-id="bb434-195">This enables a server instance to stay within an upper-bound on recovery times for a given database (except when a long-running transaction causes excessive UNDO times).</span></span>  
  
-   <span data-ttu-id="bb434-196">I checkpoint indiretti riducono i picchi di I/O correlati ai checkpoint scrivendo continuamente pagine dirty su disco in background.</span><span class="sxs-lookup"><span data-stu-id="bb434-196">Indirect checkpoints reduce checkpoint-related I/O spiking by continually writing dirty pages to disk in the background.</span></span>  
  
 <span data-ttu-id="bb434-197">Tuttavia, un carico di lavoro transazionale online su un database configurato per i checkpoint indiretti potrebbe subire un calo delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="bb434-197">However, an online transactional workload on a database that is configured for indirect checkpoints could experience performance degradation.</span></span> <span data-ttu-id="bb434-198">Questo perché il writer in background utilizzato dai checkpoint indiretti aumenta talvolta il carico di scrittura totale di un'istanza del server.</span><span class="sxs-lookup"><span data-stu-id="bb434-198">This is because the background writer used by indirect checkpoint sometimes increases the total write load for a server instance.</span></span>  
  
  
###  <a name="internal-checkpoints"></a><a name="EventsCausingChkpt"></a><span data-ttu-id="bb434-199">Checkpoint interni</span><span class="sxs-lookup"><span data-stu-id="bb434-199">Internal Checkpoints</span></span>  
 <span data-ttu-id="bb434-200">I checkpoint interni vengono generati da vari componenti server per garantire che le immagini sul disco corrispondano allo stato corrente del log.</span><span class="sxs-lookup"><span data-stu-id="bb434-200">Internal Checkpoints are generated by various server components to guarantee that disk images match the current state of the log.</span></span> <span data-ttu-id="bb434-201">I checkpoint interni vengono generati in risposta agli eventi seguenti:</span><span class="sxs-lookup"><span data-stu-id="bb434-201">Internal checkpoint are generated in response to the following events:</span></span>  
  
-   <span data-ttu-id="bb434-202">Vengono aggiunti o rimossi file di database utilizzando l'istruzione ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="bb434-202">Database files have been added or removed by using ALTER DATABASE.</span></span>  
  
-   <span data-ttu-id="bb434-203">Viene eseguito un backup del database.</span><span class="sxs-lookup"><span data-stu-id="bb434-203">A database backup is taken.</span></span>  
  
-   <span data-ttu-id="bb434-204">Viene creato uno snapshot del database, in modo esplicito o internamente per CHECK DBCC.</span><span class="sxs-lookup"><span data-stu-id="bb434-204">A database snapshot is created, whether explicitly or internally for DBCC CHECK.</span></span>  
  
-   <span data-ttu-id="bb434-205">Viene eseguita un'attività che richiede la chiusura di un database.</span><span class="sxs-lookup"><span data-stu-id="bb434-205">An activity requiring a database shutdown is performed.</span></span> <span data-ttu-id="bb434-206">Ad esempio, AUTO_CLOSE è impostata su ON e la connessione al database dell'ultimo utente viene chiusa, oppure viene eseguita una modifica a un'opzione di database che richiede un riavvio del database.</span><span class="sxs-lookup"><span data-stu-id="bb434-206">For example, AUTO_CLOSE is ON and the last user connection to the database is closed, or a database option change is made that requires a restart of the database.</span></span>  
  
-   <span data-ttu-id="bb434-207">Un'istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] viene arrestata in seguito all'arresto del servizio [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (MSSQLSERVER).</span><span class="sxs-lookup"><span data-stu-id="bb434-207">An instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is stopped by stopping the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (MSSQLSERVER) service .</span></span> <span data-ttu-id="bb434-208">Entrambe le azioni causano un checkpoint in ogni database dell'istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="bb434-208">Either action  causes a checkpoint in each database in the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="bb434-209">Impostazione della modalità offline per un'istanza del cluster di failover di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="bb434-209">Bringing a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover cluster instance (FCI) offline.</span></span>  
  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="bb434-210">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="bb434-210">Related Tasks</span></span>  
 <span data-ttu-id="bb434-211">**Per modificare l'intervallo di recupero su un'istanza del server**</span><span class="sxs-lookup"><span data-stu-id="bb434-211">**To change the recovery interval on a server instance**</span></span>  
  
-   [<span data-ttu-id="bb434-212">Configurare l'opzione di configurazione del server intervallo di recupero</span><span class="sxs-lookup"><span data-stu-id="bb434-212">Configure the recovery interval Server Configuration Option</span></span>](../../database-engine/configure-windows/configure-the-recovery-interval-server-configuration-option.md)  
  
 <span data-ttu-id="bb434-213">**Per configurare checkpoint indiretti su un database**</span><span class="sxs-lookup"><span data-stu-id="bb434-213">**To configure indirect checkpoints on a database**</span></span>  
  
-   [<span data-ttu-id="bb434-214">Modificare il tempo di recupero di riferimento di un database &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="bb434-214">Change the Target Recovery Time of a Database &#40;SQL Server&#41;</span></span>](change-the-target-recovery-time-of-a-database-sql-server.md)  
  
 <span data-ttu-id="bb434-215">**Per emettere un checkpoint manuale su un database**</span><span class="sxs-lookup"><span data-stu-id="bb434-215">**To issue a manual checkpoint on a database**</span></span>  
  
-   [<span data-ttu-id="bb434-216">CHECKPOINT &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="bb434-216">CHECKPOINT &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/language-elements/checkpoint-transact-sql)  
  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="bb434-217">Contenuto correlato</span><span class="sxs-lookup"><span data-stu-id="bb434-217">Related Content</span></span>  
  
-   <span data-ttu-id="bb434-218">[Architettura fisica del log delle transazioni](https://technet.microsoft.com/library/ms179355.aspx) (nella documentazione online di [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] )</span><span class="sxs-lookup"><span data-stu-id="bb434-218">[Transaction Log Physical Architecture](https://technet.microsoft.com/library/ms179355.aspx) (in [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] Books Oline)</span></span>  
  
  
## <a name="see-also"></a><span data-ttu-id="bb434-219">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="bb434-219">See Also</span></span>  
 [<span data-ttu-id="bb434-220">Log delle transazioni &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="bb434-220">The Transaction Log &#40;SQL Server&#41;</span></span>](the-transaction-log-sql-server.md)  
  
  
