---
title: Controllare la durabilità delle transazioni | Microsoft Docs
ms.custom: ''
ms.date: 05/19/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- delayed durability
- Lazy Commit
ms.assetid: 3ac93b28-cac7-483e-a8ab-ac44e1cc1c76
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: f37bcaf8719f4a2f3b1e7fbca1cf332717bd936e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87627251"
---
# <a name="control-transaction-durability"></a><span data-ttu-id="80482-102">Controllo della durabilità delle transazioni</span><span class="sxs-lookup"><span data-stu-id="80482-102">Control Transaction Durability</span></span>
  <span data-ttu-id="80482-103">Il commit delle transazioni di[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] può essere completamente durevole, l'impostazione predefinita di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , oppure con durabilità ritardata (noto come Lazy Commit).</span><span class="sxs-lookup"><span data-stu-id="80482-103">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction commits can be either fully durable, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] default, or delayed durable (also known as lazy commit).</span></span>  
  
 <span data-ttu-id="80482-104">Il commit delle transazioni completamente durevole è sincrono e segnala il completamento del commit restituendo il controllo al client solo dopo che i record del log per la transazione vengono scritti su disco.</span><span class="sxs-lookup"><span data-stu-id="80482-104">Fully durable transaction commits are synchronous and report a commit as successful and return control to the client only after the log records for the transaction are written to disk.</span></span> <span data-ttu-id="80482-105">Il commit delle transazioni con durabilità ritardata è asincrono e segnala il completamento del commit prima che i record del log per la transazione vengano scritti su disco.</span><span class="sxs-lookup"><span data-stu-id="80482-105">Delayed durable transaction commits are asynchronous and report a commit as successful before the log records for the transaction are written to disk.</span></span> <span data-ttu-id="80482-106">La scrittura delle voci di log delle transazioni su disco è necessaria affinché una transazione sia durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-106">Writing the transaction log entries to disk is required for a transaction to be durable.</span></span> <span data-ttu-id="80482-107">Le transazioni con durabilità ritardata diventano durevoli quando le voci di log delle transazioni vengono scaricate su disco.</span><span class="sxs-lookup"><span data-stu-id="80482-107">Delayed durable transactions become durable when the transaction log entries are flushed to disk.</span></span>  
  
 <span data-ttu-id="80482-108">In questo argomento vengono descritte in dettaglio le transazioni con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-108">This topic details delayed durable transactions.</span></span>  
  
## <a name="full-vs-delayed-transaction-durability"></a><span data-ttu-id="80482-109">Transazioni completamente durevoli e  transazioni con durabilità ritardata</span><span class="sxs-lookup"><span data-stu-id="80482-109">Full vs. Delayed Transaction Durability</span></span>  
 <span data-ttu-id="80482-110">Le transazioni con durabilità completa e quelle con durabilità ritardata hanno sia vantaggi che svantaggi.</span><span class="sxs-lookup"><span data-stu-id="80482-110">Both full and delayed transaction durability have their advantages and disadvantages.</span></span> <span data-ttu-id="80482-111">Un'applicazione può contenere una combinazione di transazioni completamente durevoli e transazioni con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-111">An application can have a mix of fully and delayed durable transactions.</span></span> <span data-ttu-id="80482-112">È necessario valutare attentamente le esigenze aziendali e determinare quale dei due tipi vi si adatti meglio.</span><span class="sxs-lookup"><span data-stu-id="80482-112">You should carefully consider your business needs and how each fits into those needs.</span></span>  
  
### <a name="full-transaction-durability"></a><span data-ttu-id="80482-113">Transazioni con durabilità completa</span><span class="sxs-lookup"><span data-stu-id="80482-113">Full transaction durability</span></span>  
 <span data-ttu-id="80482-114">Le transazioni completamente durevoli scrivono il log delle transazioni su disco prima di restituire il controllo al client.</span><span class="sxs-lookup"><span data-stu-id="80482-114">Fully durable transactions write the transaction log to disk before returning control to the client.</span></span> <span data-ttu-id="80482-115">Utilizzare le transazioni con durabilità completa ogni volta che:</span><span class="sxs-lookup"><span data-stu-id="80482-115">You should use fully durable transactions whenever:</span></span>  
  
-   <span data-ttu-id="80482-116">Il sistema non può tollerare alcuna perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="80482-116">Your system cannot tolerate any data loss.</span></span>   
    <span data-ttu-id="80482-117">Per informazioni sul momento in cui può verificarsi una perdita di dati, vedere la sezione [Quando può verificarsi una perdita di dati?](#when-can-i-lose-data) .</span><span class="sxs-lookup"><span data-stu-id="80482-117">See the section [When can I lose data?](#when-can-i-lose-data) for information on when you can lose some of your data.</span></span>  
  
-   <span data-ttu-id="80482-118">Il collo di bottiglia non è causato dalla latenza di scrittura del log delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="80482-118">The bottleneck is not due to transaction log write latency.</span></span>  
  
 <span data-ttu-id="80482-119">Le transazioni con durabilità ritardata riducono la latenza causata dall'I/O del log mantenendo i record del log delle transazioni in memoria e scrivendo nel log delle transazioni in batch, richiedendo pertanto un numero minore di operazioni di I/O.</span><span class="sxs-lookup"><span data-stu-id="80482-119">Delayed transaction durability reduces the latency due to log I/O by keeping the transaction log records in memory and writing to the transaction log in batches, thus requiring fewer I/O operations.</span></span> <span data-ttu-id="80482-120">Le transazioni con durabilità ritardata riducono potenzialmente la contesa di I/O del log, riducendo pertanto le attese del sistema.</span><span class="sxs-lookup"><span data-stu-id="80482-120">Delayed transaction durability potentially reduces log I/O contention, thus reducing waits in the system.</span></span>  
  
 <span data-ttu-id="80482-121">**Garanzie delle transazioni con durabilità completa**</span><span class="sxs-lookup"><span data-stu-id="80482-121">**Full Transaction Durability Guarantees**</span></span>  
  
-   <span data-ttu-id="80482-122">Una volta completato il commit della transazione, le modifiche apportate dalla transazione sono visibili alle altre transazioni nel sistema.</span><span class="sxs-lookup"><span data-stu-id="80482-122">Once transaction commit succeeds, the changes made by the transaction are visible to the other transactions in the system.</span></span> <span data-ttu-id="80482-123">Per ulteriori informazioni, vedere l'argomento [livelli di isolamento delle transazioni](../../database-engine/transaction-isolation-levels.md) .</span><span class="sxs-lookup"><span data-stu-id="80482-123">See the topic [Transaction Isolation Levels](../../database-engine/transaction-isolation-levels.md) for more information.</span></span>  
  
-   <span data-ttu-id="80482-124">La durabilità è garantita in fase di commit.</span><span class="sxs-lookup"><span data-stu-id="80482-124">Durability is guaranteed on commit.</span></span> <span data-ttu-id="80482-125">I record di log corrispondenti vengono salvati in modo permanente sul disco prima del completamento del commit delle transazioni restituendo il controllo al client.</span><span class="sxs-lookup"><span data-stu-id="80482-125">Corresponding log records are persisted to disk before the transaction commit succeeds and returns control to the client.</span></span>  
  
### <a name="delayed-transaction-durability"></a><span data-ttu-id="80482-126">Transazioni con durabilità ritardata</span><span class="sxs-lookup"><span data-stu-id="80482-126">Delayed transaction durability</span></span>  
 <span data-ttu-id="80482-127">Le transazioni con durabilità ritardata vengono eseguite utilizzando scritture del log su disco asincrone.</span><span class="sxs-lookup"><span data-stu-id="80482-127">Delayed transaction durability is accomplished using asynchronous log writes to disk.</span></span> <span data-ttu-id="80482-128">I record del log delle transazioni vengono mantenuti in un buffer e vengono scritti su disco quando il buffer si riempie o quando si verifica un evento di scaricamento del buffer.</span><span class="sxs-lookup"><span data-stu-id="80482-128">Transaction log records are kept in a buffer and written to disk when the buffer fills or a buffer flushing event takes place.</span></span> <span data-ttu-id="80482-129">Le transazioni con durabilità ritardata riducono la latenza e la contesa nel sistema in quanto:</span><span class="sxs-lookup"><span data-stu-id="80482-129">Delayed transaction durability reduces both latency and contention within the system because:</span></span>  
  
-   <span data-ttu-id="80482-130">L'elaborazione del commit delle transazioni non attende il completamento delle operazioni di I/O del log e la restituzione del controllo al client.</span><span class="sxs-lookup"><span data-stu-id="80482-130">The transaction commit processing does not wait for log IO to finish and return control to the client.</span></span>  
  
-   <span data-ttu-id="80482-131">La contesa di I/O del log da parte delle transazioni simultanee è meno probabile; al contrario, il buffer del log può essere scaricato su disco in blocchi più grandi, riducendo la contesa e aumentando la velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="80482-131">Concurrent transactions are less likely to contend for log IO; instead, the log buffer can be flushed to disk in larger chunks, reducing contention, and increasing throughput.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="80482-132">È comunque possibile che si verifichi una contesa di I/O del log se esiste un livello elevato di concorrenza, specialmente se il buffer del log si riempie più velocemente di quanto si scarichi.</span><span class="sxs-lookup"><span data-stu-id="80482-132">You may still have log I/O contention if there is a high degree of concurrency, particularly if you fill up the log buffer faster than you flush it.</span></span>  
  
 <span data-ttu-id="80482-133">**Quando utilizzare le transazioni con durabilità ritardata**</span><span class="sxs-lookup"><span data-stu-id="80482-133">**When to use delayed transaction durability**</span></span>  
  
 <span data-ttu-id="80482-134">Alcuni dei casi in cui è possibile trarre vantaggio dall'utilizzo delle transazioni con durabilità ritardata sono:</span><span class="sxs-lookup"><span data-stu-id="80482-134">Some of the cases in which you could benefit from using delayed transaction durability are:</span></span>  
  
 <span data-ttu-id="80482-135">**Possibilità di tollerare un'eventuale perdita di dati.** </span><span class="sxs-lookup"><span data-stu-id="80482-135">**You can tolerate some data loss.**</span></span>  
 <span data-ttu-id="80482-136">Se è possibile tollerare un'eventuale perdita di dati, ad esempio la perdita di singoli record non cruciali, purché si disponga della maggior parte dei dati, potrebbe essere opportuno considerare la durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-136">If you can tolerate some data loss, for example, where individual records are not critical as long as you have most of the data, then delayed durability may be worth considering.</span></span> <span data-ttu-id="80482-137">Se non è possibile tollerare un'eventuale perdita di dati, non utilizzare le transazioni con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-137">If you cannot tolerate any data loss, do not use delayed transaction durability.</span></span>  
  
 <span data-ttu-id="80482-138">**Collo di bottiglia nella scrittura del log delle transazioni.** </span><span class="sxs-lookup"><span data-stu-id="80482-138">**You are experiencing a bottleneck on transaction log writes.**</span></span>  
 <span data-ttu-id="80482-139">Se i problemi di prestazioni sono dovuti alla latenza nella scrittura del log delle transazioni, l'applicazione probabilmente trarrà vantaggio dall'utilizzo delle transazioni con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-139">If your performance issues are due to latency in transaction log writes, your application will likely benefit from using delayed transaction durability.</span></span>  
  
 <span data-ttu-id="80482-140">**Carichi di lavoro con una frequenza elevata di contesa.** </span><span class="sxs-lookup"><span data-stu-id="80482-140">**Your workloads have a high contention rate.**</span></span>  
 <span data-ttu-id="80482-141">Se nel sistema sono presenti carichi di lavoro con un livello elevato di contesa, si perde molto tempo nell'attesa del rilascio dei blocchi.</span><span class="sxs-lookup"><span data-stu-id="80482-141">If your system has workloads with a high contention level much time is lost waiting for locks to be released.</span></span> <span data-ttu-id="80482-142">Le transazioni con durabilità ritardata riducono il tempo di commit rilasciando i blocchi più velocemente con una velocità effettiva più elevata.</span><span class="sxs-lookup"><span data-stu-id="80482-142">Delayed transaction durability reduces commit time and thus releases locks faster which results in higher throughput.</span></span>  
  
 <span data-ttu-id="80482-143">**Garanzie delle transazioni con durabilità ritardata**</span><span class="sxs-lookup"><span data-stu-id="80482-143">**Delayed Transaction Durability Guarantees**</span></span>  
  
-   <span data-ttu-id="80482-144">Una volta completato il commit della transazione, le modifiche apportate dalla transazione sono visibili alle altre transazioni nel sistema.</span><span class="sxs-lookup"><span data-stu-id="80482-144">Once transaction commit succeeds, the changes made by the transaction are visible to the other transactions in the system.</span></span>  
  
-   <span data-ttu-id="80482-145">La durabilità delle transazioni viene garantita solo in seguito a uno scaricamento su disco del log delle transazioni in memoria.</span><span class="sxs-lookup"><span data-stu-id="80482-145">Transaction durability is guaranteed only following a flush of the in-memory transaction log to disk.</span></span> <span data-ttu-id="80482-146">Il log delle transazioni in memoria viene scaricato su disco quando:</span><span class="sxs-lookup"><span data-stu-id="80482-146">The in-memory transaction log is flushed to disk when:</span></span>  
  
    -   <span data-ttu-id="80482-147">Una transazione completamente durevole nello stesso database apporta una modifica nel database e ne viene completato il commit.</span><span class="sxs-lookup"><span data-stu-id="80482-147">A fully durable transaction in the same database makes a change in the database and successfully commits.</span></span>  
  
    -   <span data-ttu-id="80482-148">L'utente esegue correttamente la stored procedure di sistema `sp_flush_log` .</span><span class="sxs-lookup"><span data-stu-id="80482-148">The user executes the system stored procedure `sp_flush_log` successfully.</span></span>  
  
    -   <span data-ttu-id="80482-149">Il buffer del log delle transazioni in memoria si riempie e si scarica automaticamente su disco.</span><span class="sxs-lookup"><span data-stu-id="80482-149">The in-memory transaction log buffer fills up and automatically flushes to disk.</span></span>  
  
     <span data-ttu-id="80482-150">Se è stato completato il commit di una transazione completamente durevole o di sp_flush_log, tutte le transazioni con durabilità ritardata di cui è stato eseguito il commit in precedenza diventano durevoli.</span><span class="sxs-lookup"><span data-stu-id="80482-150">If a fully durable transaction or sp_flush_log successfully commit, all previously committed delayed durability transactions have been made durable.</span></span>  
  
 <span data-ttu-id="80482-151">Il log può essere scaricato su disco periodicamente.</span><span class="sxs-lookup"><span data-stu-id="80482-151">The log may be flushed to disk periodically.</span></span> <span data-ttu-id="80482-152">Tuttavia, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] non fornisce alcuna garanzia di durabilità oltre alle transazioni durevoli e a sp_flush_log.</span><span class="sxs-lookup"><span data-stu-id="80482-152">However, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] does not provide any durability guarantees other than durable transactions and sp_flush_log.</span></span>  
  
## <a name="how-to-control-transaction-durability"></a><span data-ttu-id="80482-153">Come controllare la durabilità delle transazioni</span><span class="sxs-lookup"><span data-stu-id="80482-153">How to control transaction durability</span></span>  
  
### <a name="database-level-control"></a><span data-ttu-id="80482-154">Controllo a livello di database</span><span class="sxs-lookup"><span data-stu-id="80482-154">Database level control</span></span>  
 <span data-ttu-id="80482-155">L'amministratore del database può controllare se gli utenti possono utilizzare le transazioni con durabilità ritardata in un database con l'istruzione seguente.</span><span class="sxs-lookup"><span data-stu-id="80482-155">You, the DBA, can control whether users can use delayed transaction durability on a database with the following statement.</span></span> <span data-ttu-id="80482-156">È necessario impostare il valore per la durabilità ritardata con ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="80482-156">You must set the delayed durability setting with ALTER DATABASE.</span></span>  
  
```sql  
ALTER DATABASE ... SET DELAYED_DURABILITY = { DISABLED | ALLOWED | FORCED }  
```  
  
 `DISABLED`  
 <span data-ttu-id="80482-157">[impostazione predefinita] Con questa impostazione, tutte le transazioni di cui è stato eseguito il commit nel database sono completamente durevoli, indipendentemente dall'impostazione del livello di commit (DELAYED_DURABILITY=[ON | OFF]).</span><span class="sxs-lookup"><span data-stu-id="80482-157">[default] With this setting, all transactions that commit on the database are fully durable, regardless of the commit level setting (DELAYED_DURABILITY=[ON | OFF]).</span></span> <span data-ttu-id="80482-158">Non è necessaria alcuna modifica e ricompilazione delle stored procedure.</span><span class="sxs-lookup"><span data-stu-id="80482-158">There is no need for stored procedure change and recompilation.</span></span> <span data-ttu-id="80482-159">In questo modo è possibile garantire che i dati non verranno in alcun modo messi in pericolo dalla durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-159">This allows you to ensure that no data is ever put at risk by delayed durability.</span></span>  
  
 `ALLOWED`  
 <span data-ttu-id="80482-160">Con questa impostazione, la durabilità di ogni transazione viene determinata a livello di transazione (DELAYED_DURABILITY = { *OFF* | ON }).</span><span class="sxs-lookup"><span data-stu-id="80482-160">With this setting, each transaction's durability is determined at the transaction level - DELAYED_DURABILITY = { *OFF* | ON }.</span></span> <span data-ttu-id="80482-161">Per ulteriori informazioni, vedere [controllo a livello di blocco atomico-stored procedure compilate](#atomic-block-level-control---natively-compiled-stored-procedures) in modo nativo e [controllo a livello di commit-Transact-SQL](#commit-level-control---t-sql) .</span><span class="sxs-lookup"><span data-stu-id="80482-161">See [Atomic block level control - Natively Compiled Stored Procedures](#atomic-block-level-control---natively-compiled-stored-procedures) and [COMMIT level control - Transact-SQL](#commit-level-control---t-sql) for more information.</span></span>  
  
 `FORCED`  
 <span data-ttu-id="80482-162">Con questa impostazione, ogni transazione di cui viene eseguito il commit nel database è con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-162">With this setting, every transaction that commits on the database is delayed durable.</span></span> <span data-ttu-id="80482-163">Indipendentemente dal fatto che venga specificata una transazione completamente durevole (DELAYED_DURABILITY = OFF) o non venga specificata alcuna impostazione, la transazione è con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-163">Whether the transaction specifies fully durable (DELAYED_DURABILITY = OFF) or makes no specification, the transaction is delayed durable.</span></span> <span data-ttu-id="80482-164">Tale impostazione risulta utile quando è necessario specificare le transazioni con durabilità ritardata per un database e non si desidera modificare il codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="80482-164">This setting is useful when delayed transaction durability is useful for a database and you do not want to change any application code.</span></span>  
  
### <a name="atomic-block-level-control---natively-compiled-stored-procedures"></a><span data-ttu-id="80482-165"> Controllo a livello di blocco atomico: stored procedure compilate in modo nativo</span><span class="sxs-lookup"><span data-stu-id="80482-165">Atomic block level control - Natively Compiled Stored Procedures</span></span>  
 <span data-ttu-id="80482-166">Il codice seguente va inserito nel blocco atomico.</span><span class="sxs-lookup"><span data-stu-id="80482-166">The following code goes inside the atomic block.</span></span>  
  
```sql  
DELAYED_DURABILITY = { OFF | ON }  
```  
  
 `OFF`  
 <span data-ttu-id="80482-167">[impostazione predefinita] La transazione è completamente durevole, a meno che non sia attiva l'opzione di database DELAYED_DURABLITY = FORCED, nel qual caso il commit è asincrono e pertanto con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-167">[default] The transaction is fully durable, unless the database option DELAYED_DURABLITY = FORCED is in effect, in which case the commit is asynchronous and thus delayed durable.</span></span> <span data-ttu-id="80482-168">Per altre informazioni, vedere [Controllo a livello di database](#database-level-control) .</span><span class="sxs-lookup"><span data-stu-id="80482-168">See [Database level control](#database-level-control) for more information.</span></span>  
  
 `ON`  
 <span data-ttu-id="80482-169">La transazione è con durabilità ritardata, a meno che non sia attiva l'opzione di database DELAYED_DURABLITY = DISABLED, nel qual caso il commit è sincrono e pertanto completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-169">The transaction is delayed durable, unless the database option DELAYED_DURABLITY = DISABLED is in effect, in which case the commit is synchronous and thus fully durable.</span></span>  <span data-ttu-id="80482-170">Per altre informazioni, vedere [Controllo a livello di database](#database-level-control) .</span><span class="sxs-lookup"><span data-stu-id="80482-170">See [Database level control](#database-level-control) for more information.</span></span>  
  
 <span data-ttu-id="80482-171">**Codice di esempio:**</span><span class="sxs-lookup"><span data-stu-id="80482-171">**Example Code:**</span></span>  
  
```sql  
CREATE PROCEDURE <procedureName> ...  
WITH NATIVE_COMPILATION, SCHEMABINDING, EXECUTE AS OWNER  
AS BEGIN ATOMIC WITH   
(  
    DELAYED_DURABILITY = ON,  
    TRANSACTION ISOLATION LEVEL = SNAPSHOT,  
    LANGUAGE = N'English'  
    ...  
)  
END  
```  
  
### <a name="table-1-durability-in-atomic-blocks"></a><span data-ttu-id="80482-172">Tabella 1: durabilità nei blocchi ATOMIC</span><span class="sxs-lookup"><span data-stu-id="80482-172">Table 1: Durability in Atomic Blocks</span></span>  
  
|<span data-ttu-id="80482-173">Opzione di durabilità nei blocchi atomici</span><span class="sxs-lookup"><span data-stu-id="80482-173">Atomic block durability option</span></span>|<span data-ttu-id="80482-174">Nessuna transazione esistente</span><span class="sxs-lookup"><span data-stu-id="80482-174">No existing transaction</span></span>|<span data-ttu-id="80482-175">Transazione in corso (completamente durevole o con durabilità ritardata)</span><span class="sxs-lookup"><span data-stu-id="80482-175">Transaction in process (fully or delayed durable)</span></span>|  
|------------------------------------|-----------------------------|---------------------------------------------------------|  
|`DELAYED_DURABILITY = OFF`|<span data-ttu-id="80482-176">Il blocco atomico avvia una nuova transazione completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-176">Atomic block starts a new fully durable transaction.</span></span>|<span data-ttu-id="80482-177">Il blocco atomico crea un punto di salvataggio nella transazione esistente, quindi avvia una nuova transazione.</span><span class="sxs-lookup"><span data-stu-id="80482-177">Atomic block creates a save point in the existing transaction, then begins the new transaction.</span></span>|  
|`DELAYED_DURABILITY = ON`|<span data-ttu-id="80482-178">Il blocco atomico avvia una nuova transazione con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-178">Atomic block starts a new delayed durable transaction.</span></span>|<span data-ttu-id="80482-179">Il blocco atomico crea un punto di salvataggio nella transazione esistente, quindi avvia una nuova transazione.</span><span class="sxs-lookup"><span data-stu-id="80482-179">Atomic block creates a save point in the existing transaction, then begins the new transaction.</span></span>|  
  
### <a name="commit-level-control---t-sql"></a><span data-ttu-id="80482-180">Controllo a livello di COMMIT-(T-SQL)</span><span class="sxs-lookup"><span data-stu-id="80482-180">COMMIT level control - (T-SQL)</span></span>
 <span data-ttu-id="80482-181">La sintassi di COMMIT viene estesa in modo da poter forzare le transazioni con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-181">The COMMIT syntax is extended so you can force delayed transaction durability.</span></span> <span data-ttu-id="80482-182">Se DELAYED_DURABILITY è DISABLED o FORCED a livello di database (vedere sopra) questa opzione di COMMIT viene ignorata.</span><span class="sxs-lookup"><span data-stu-id="80482-182">If DELAYED_DURABILITY is DISABLED or FORCED at the database level (see above) this COMMIT option is ignored.</span></span>  
  
```sql  
COMMIT [ { TRAN | TRANSACTION } ] [ transaction_name | @tran_name_variable ] ] [ WITH ( DELAYED_DURABILITY = { OFF | ON } ) ]  
  
```  
  
 `OFF`  
 <span data-ttu-id="80482-183">[impostazione predefinita] Il COMMIT della transazione è completamente durevole, a meno che non sia attiva l'opzione di database DELAYED_DURABLITY = FORCED, nel qual caso il COMMIT è asincrono e pertanto con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-183">[default] The transaction COMMIT is fully durable, unless the database option DELAYED_DURABLITY = FORCED is in effect, in which case the COMMIT is asynchronous and thus delayed durable.</span></span> <span data-ttu-id="80482-184">Per altre informazioni, vedere [Controllo a livello di database](#database-level-control) .</span><span class="sxs-lookup"><span data-stu-id="80482-184">See [Database level control](#database-level-control) for more information.</span></span>  
  
 `ON`  
 <span data-ttu-id="80482-185">Il COMMIT della transazione è con durabilità ritardata, a meno che non sia attiva l'opzione di database DELAYED_DURABLITY = DISABLED, nel qual caso il COMMIT è sincrono e pertanto completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-185">The transaction COMMIT is delayed durable, unless the database option DELAYED_DURABLITY = DISABLED is in effect, in which case the COMMIT is synchronous and thus fully durable.</span></span> <span data-ttu-id="80482-186">Per altre informazioni, vedere [Controllo a livello di database](#database-level-control) .</span><span class="sxs-lookup"><span data-stu-id="80482-186">See [Database level control](#database-level-control) for more information.</span></span>  
  
### <a name="summary-of-options-and-their-interactions"></a><span data-ttu-id="80482-187">Riepilogo delle opzioni e relative interazioni</span><span class="sxs-lookup"><span data-stu-id="80482-187">Summary of options and their interactions</span></span>  
 <span data-ttu-id="80482-188">Nella tabella seguente vengono riepilogate le interazioni tra le impostazioni di durabilità ritardata a livello di database e le impostazioni a livello di commit.</span><span class="sxs-lookup"><span data-stu-id="80482-188">This table summarizes the interactions between database level delayed durability settings and commit level settings.</span></span> <span data-ttu-id="80482-189">Le impostazioni a livello di database hanno sempre la precedenza sulle impostazioni a livello di commit.</span><span class="sxs-lookup"><span data-stu-id="80482-189">Database level settings always take precedence over commit level settings.</span></span>  
  
|<span data-ttu-id="80482-190">Impostazione di COMMIT/Impostazione di database</span><span class="sxs-lookup"><span data-stu-id="80482-190">COMMIT setting/Database setting</span></span>|<span data-ttu-id="80482-191">DELAYED_DURABILITY = DISABLED</span><span class="sxs-lookup"><span data-stu-id="80482-191">DELAYED_DURABILITY = DISABLED</span></span>|<span data-ttu-id="80482-192">DELAYED_DURABILITY = ALLOWED</span><span class="sxs-lookup"><span data-stu-id="80482-192">DELAYED_DURABILITY = ALLOWED</span></span>|<span data-ttu-id="80482-193">DELAYED_DURABILITY = FORCED</span><span class="sxs-lookup"><span data-stu-id="80482-193">DELAYED_DURABILITY = FORCED</span></span>|  
|--------------------------------------|-------------------------------------|------------------------------------|-----------------------------------|  
|<span data-ttu-id="80482-194">`DELAYED_DURABILITY = OFF` Transazioni a livello di database.</span><span class="sxs-lookup"><span data-stu-id="80482-194">`DELAYED_DURABILITY = OFF` Database level transactions.</span></span>|<span data-ttu-id="80482-195">La transazione è completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-195">Transaction is fully durable.</span></span>|<span data-ttu-id="80482-196">La transazione è completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-196">Transaction is fully durable.</span></span>|<span data-ttu-id="80482-197">La transazione è con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-197">Transaction is delayed durable.</span></span>|  
|<span data-ttu-id="80482-198">`DELAYED_DURABILITY = ON` Transazioni a livello di database.</span><span class="sxs-lookup"><span data-stu-id="80482-198">`DELAYED_DURABILITY = ON` Database level transactions.</span></span>|<span data-ttu-id="80482-199">La transazione è completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-199">Transaction is fully durable.</span></span>|<span data-ttu-id="80482-200">La transazione è con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-200">Transaction is delayed durable.</span></span>|<span data-ttu-id="80482-201">La transazione è con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-201">Transaction is delayed durable.</span></span>|  
|<span data-ttu-id="80482-202">`DELAYED_DURABILITY = OFF` Transazione distribuita o tra database.</span><span class="sxs-lookup"><span data-stu-id="80482-202">`DELAYED_DURABILITY = OFF` Cross database or distributed transaction.</span></span>|<span data-ttu-id="80482-203">La transazione è completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-203">Transaction is fully durable.</span></span>|<span data-ttu-id="80482-204">La transazione è completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-204">Transaction is fully durable.</span></span>|<span data-ttu-id="80482-205">La transazione è completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-205">Transaction is fully durable.</span></span>|  
|<span data-ttu-id="80482-206">`DELAYED_DURABILITY = ON` Transazione distribuita o tra database.</span><span class="sxs-lookup"><span data-stu-id="80482-206">`DELAYED_DURABILITY = ON` Cross database or distributed transaction.</span></span>|<span data-ttu-id="80482-207">La transazione è completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-207">Transaction is fully durable.</span></span>|<span data-ttu-id="80482-208">La transazione è completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-208">Transaction is fully durable.</span></span>|<span data-ttu-id="80482-209">La transazione è completamente durevole.</span><span class="sxs-lookup"><span data-stu-id="80482-209">Transaction is fully durable.</span></span>|  
  
## <a name="how-to-force-a-transaction-log-flush"></a><span data-ttu-id="80482-210">Come forzare lo scaricamento di un log delle transazioni</span><span class="sxs-lookup"><span data-stu-id="80482-210">How to force a transaction log flush</span></span>  
 <span data-ttu-id="80482-211">Sono disponibili due metodi per forzare lo scaricamento del log delle transazioni su disco.</span><span class="sxs-lookup"><span data-stu-id="80482-211">There are two means to force flush the transaction log to disk.</span></span>  
  
-   <span data-ttu-id="80482-212">Eseguire una transazione completamente durevole che modifica lo stesso database.</span><span class="sxs-lookup"><span data-stu-id="80482-212">Execute any fully durable transaction that alters the same database.</span></span> <span data-ttu-id="80482-213">In questo modo viene forzato lo scaricamento su disco dei record del log di tutte transazioni con durabilità ritardata di cui è stato eseguito il commit in precedenza.</span><span class="sxs-lookup"><span data-stu-id="80482-213">This forces a flush of the log records of all preceding committed delayed durability transactions to disk.</span></span>  
  
-   <span data-ttu-id="80482-214">Eseguire la stored procedure di sistema `sp_flush_log`.</span><span class="sxs-lookup"><span data-stu-id="80482-214">Execute the system stored procedure `sp_flush_log`.</span></span> <span data-ttu-id="80482-215">In questo modo viene forzato lo scaricamento su disco dei record del log di tutte transazioni con durabilità ritardata di cui è stato eseguito il commit in precedenza.</span><span class="sxs-lookup"><span data-stu-id="80482-215">This procedure forces a flush of the log records of all preceding committed delayed durable transactions to disk.</span></span> <span data-ttu-id="80482-216">Per altre informazioni, vedere [sys.sp_flush_log &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-flush-log-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="80482-216">For more information see [sys.sp_flush_log &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-flush-log-transact-sql).</span></span>  
  
##  <a name="delayed-durability-and-other-sql-server-features"></a><span data-ttu-id="80482-217">Durabilità ritardata e altre funzionalità di SQL Server</span><span class="sxs-lookup"><span data-stu-id="80482-217">Delayed durability and other SQL Server features</span></span>  
 <span data-ttu-id="80482-218">**Rilevamento delle modifiche e Change Data Capture**</span><span class="sxs-lookup"><span data-stu-id="80482-218">**Change tracking and change data capture**</span></span>  
 <span data-ttu-id="80482-219">Tutte le transazioni con rilevamento delle modifiche sono completamente durevoli.</span><span class="sxs-lookup"><span data-stu-id="80482-219">All transactions with change tracking are fully durable.</span></span> <span data-ttu-id="80482-220">Una transazione dispone della proprietà di rilevamento delle modifiche se esegue operazioni di scrittura in tabelle abilitate per il rilevamento delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="80482-220">A transaction has the change tracking property if it does any write operations to tables that are enabled for change tracking.</span></span> <span data-ttu-id="80482-221">L'uso di durabilità posticipata non è supportato per i database che usano Change Data Capture (CDC).</span><span class="sxs-lookup"><span data-stu-id="80482-221">The use of delayed durability is not supported for databases which use change data capture (CDC).</span></span>   
  
 <span data-ttu-id="80482-222">**Recupero a seguito dell'arresto anomalo del sistema**</span><span class="sxs-lookup"><span data-stu-id="80482-222">**Crash recovery**</span></span>  
 <span data-ttu-id="80482-223">La coerenza è garantita, ma alcune modifiche delle transazioni con durabilità ritardata di cui è stato eseguito il commit possono andare perse.</span><span class="sxs-lookup"><span data-stu-id="80482-223">Consistency is guaranteed, but some changes from delayed durable transactions that have committed may be lost.</span></span>  
  
 <span data-ttu-id="80482-224">**Transazione distribuita o tra database**</span><span class="sxs-lookup"><span data-stu-id="80482-224">**Cross-database and DTC**</span></span>  
 <span data-ttu-id="80482-225">Se una transazione è distribuita o tra database, è completamente durevole, indipendentemente da qualsiasi impostazione del commit della transazione o del database.</span><span class="sxs-lookup"><span data-stu-id="80482-225">If a transaction is cross-database or distributed, if is fully durable, regardless of any database or transaction commit setting.</span></span>  
  
 <span data-ttu-id="80482-226">**Gruppi di disponibilità AlwaysOn e mirroring**</span><span class="sxs-lookup"><span data-stu-id="80482-226">**Always On Availability Groups and Mirroring**</span></span>  
 <span data-ttu-id="80482-227">Le transazioni con durabilità ritardata non garantiscono alcuna durabilità nel database primario né in quelli secondari.</span><span class="sxs-lookup"><span data-stu-id="80482-227">Delayed durable transactions do not guarantee any durability on either the primary or any of the secondaries.</span></span> <span data-ttu-id="80482-228">Inoltre, non garantiscono informazioni sulla transazione nel database secondario.</span><span class="sxs-lookup"><span data-stu-id="80482-228">In addition, they do not guarantee any knowledge about the transaction at the secondary.</span></span> <span data-ttu-id="80482-229">Dopo il commit, il controllo viene restituito al client prima che venga ricevuto un acknowledgement da un database secondario sincrono.</span><span class="sxs-lookup"><span data-stu-id="80482-229">After commit, control is returned to the client before any acknowledgement is received from any synchronous secondary.</span></span>  
  
 <span data-ttu-id="80482-230">**Clustering di failover**</span><span class="sxs-lookup"><span data-stu-id="80482-230">**Failover clustering**</span></span>  
 <span data-ttu-id="80482-231">Alcune scritture delle transazioni con durabilità ritardata potrebbero andare perse.</span><span class="sxs-lookup"><span data-stu-id="80482-231">Some delayed durable transaction writes might be lost.</span></span>  
  
 <span data-ttu-id="80482-232">**Replica transazionale**</span><span class="sxs-lookup"><span data-stu-id="80482-232">**Transaction Replication**</span></span>  
 <span data-ttu-id="80482-233">La replica transazionale non supporta le transazioni con durabilità ritardata.</span><span class="sxs-lookup"><span data-stu-id="80482-233">Delayed durable transactions is not supported with Transactional Replication.</span></span>  
  
 <span data-ttu-id="80482-234">**Log shipping**</span><span class="sxs-lookup"><span data-stu-id="80482-234">**Log shipping**</span></span>  
 <span data-ttu-id="80482-235">Solo le transazioni che sono diventate durevoli vengono incluse nel log shipping.</span><span class="sxs-lookup"><span data-stu-id="80482-235">Only transactions that have been made durable are included in the log that is shipped.</span></span>  
  
 <span data-ttu-id="80482-236">**Backup del log**</span><span class="sxs-lookup"><span data-stu-id="80482-236">**Log Backup**</span></span>  
 <span data-ttu-id="80482-237">Solo le transazioni che sono diventate durevoli vengono incluse nel backup.</span><span class="sxs-lookup"><span data-stu-id="80482-237">Only transactions that have been made durable are included in the backup.</span></span>  
  
## <a name="when-can-i-lose-data"></a><span data-ttu-id="80482-238">Quando può verificarsi una perdita di dati?</span><span class="sxs-lookup"><span data-stu-id="80482-238">When can I lose data?</span></span>  
 <span data-ttu-id="80482-239">Se si implementa la durabilità ritardata in una delle tabelle, è importante comprendere che in determinate circostanze può verificarsi una perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="80482-239">If you implement delayed durability on any of your tables, you should understand that certain circumstances can lead to data loss.</span></span> <span data-ttu-id="80482-240">Se non è possibile tollerare un'eventuale perdita di dati, è consigliabile non usare la durabilità ritardata nelle tabelle.</span><span class="sxs-lookup"><span data-stu-id="80482-240">If you cannot tolerate any data loss, you should not use delayed durability on your tables.</span></span>  
  
### <a name="catastrophic-events"></a><span data-ttu-id="80482-241">Eventi irreversibili</span><span class="sxs-lookup"><span data-stu-id="80482-241">Catastrophic events</span></span>  
 <span data-ttu-id="80482-242">Nel caso di un evento irreversibile, come ad esempio un arresto anomalo del server, si verificherà una perdita di dati per tutte le transazioni di cui è stato eseguito il commit che non sono state salvate su disco.</span><span class="sxs-lookup"><span data-stu-id="80482-242">In the case of a catastrophic event, like a server crash, you will lose the data for all committed transactions that have not been saved to disk.</span></span> <span data-ttu-id="80482-243">Le transazioni con durabilità ritardata vengono salvate su disco ogni volta che in una tabella del database (durevole ottimizzata per la memoria o basata su disco) viene eseguita una transazione completamente durevole o viene chiamato `sp_flush_log`.</span><span class="sxs-lookup"><span data-stu-id="80482-243">Delayed durable transactions are saved to disk whenever a fully durable transaction is executed against any table (durable memory-optimized or disk-based) in the database, or `sp_flush_log` is called.</span></span> <span data-ttu-id="80482-244">Se si usano le transazioni con durabilità ritardata, è possibile creare una tabella di piccole dimensioni nel database da aggiornare periodicamente oppure è possibile chiamare periodicamente `sp_flush_log` per salvare tutte le transazioni in sospeso di cui è stato eseguito il commit.</span><span class="sxs-lookup"><span data-stu-id="80482-244">If you are using delayed durable transactions, you may want to create a small table in the database that you can periodically update or periodically call `sp_flush_log` to save all outstanding committed transactions.</span></span> <span data-ttu-id="80482-245">Inoltre, il log delle transazioni viene scaricato ogni volta che diventa pieno, condizione che però è difficile da prevedere e impossibile da controllare.</span><span class="sxs-lookup"><span data-stu-id="80482-245">The transaction log also flushes whenever it becomes full, but that is hard to predict and impossible to control.</span></span>  
  
### <a name="sql-server-shutdown-and-restart"></a><span data-ttu-id="80482-246">Arresto e riavvio SQL Server</span><span class="sxs-lookup"><span data-stu-id="80482-246">SQL Server shutdown and restart</span></span>  
 <span data-ttu-id="80482-247">Per la durabilità ritardata non esiste alcuna differenza tra un arresto imprevisto e un arresto/riavvio previsto di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="80482-247">For delayed durability, there is no difference between an unexpected shutdown and an expected shutdown/restart of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="80482-248">Analogamente agli eventi irreversibili, occorre prevedere la possibilità di una perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="80482-248">Like catastrophic events, you should plan for data loss.</span></span> <span data-ttu-id="80482-249">In un arresto/riavvio pianificato alcune transazioni che non sono state scritte su dico possono essere prima salvate su disco ma non è una condizione che è possibile pianificare.</span><span class="sxs-lookup"><span data-stu-id="80482-249">In a planned shutdown/restart some transactions that have not been written to disk may first be saved to disk, but you should not plan on it.</span></span> <span data-ttu-id="80482-250">Considerare un arresto/riavvio, indipendentemente che sia pianificato o meno, allo stesso modo di un evento irreversibile in cui può verificarsi una perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="80482-250">Plan as though a shutdown/restart, whether planned or unplanned, loses the data the same as a catastrophic event.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="80482-251">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="80482-251">See Also</span></span>  
 <span data-ttu-id="80482-252">[Livelli di isolamento delle transazioni](../../database-engine/transaction-isolation-levels.md) </span><span class="sxs-lookup"><span data-stu-id="80482-252">[Transaction Isolation Levels](../../database-engine/transaction-isolation-levels.md) </span></span>  
 [<span data-ttu-id="80482-253">Linee guida per i livelli di isolamento delle transazioni con tabelle con ottimizzazione per la memoria</span><span class="sxs-lookup"><span data-stu-id="80482-253">Guidelines for Transaction Isolation Levels with Memory-Optimized Tables</span></span>](../in-memory-oltp/memory-optimized-tables.md)  
  
  
