---
title: Indici columnstore descritti | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- indexes creation, columnstore
- indexes [SQL Server], columnstore
- columnstore index
- columnstore index, described
- xVelocity, columnstore indexes
ms.assetid: f98af4a5-4523-43b1-be8d-1b03c3217839
author: mikeraymsft
ms.author: mikeray
ms.openlocfilehash: 80a29b8e8cc5b53c09369156a5cf5f717e9447a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87724640"
---
# <a name="columnstore-indexes-described"></a><span data-ttu-id="50058-102">Columnstore Indexes Described</span><span class="sxs-lookup"><span data-stu-id="50058-102">Columnstore Indexes Described</span></span>
  <span data-ttu-id="50058-103">L' [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] *indice columnstore in memoria* consente di archiviare e gestire i dati tramite l'archiviazione dei dati basata su colonne e l'elaborazione delle query basata su colonne.</span><span class="sxs-lookup"><span data-stu-id="50058-103">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] *in-memory columnstore index* stores and manages data by using column-based data storage and column-based query processing.</span></span> <span data-ttu-id="50058-104">Gli indici columnstore sono ideali per i carichi di lavoro di data warehousing che eseguono principalmente caricamenti bulk e query di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="50058-104">Columnstore indexes work well for data warehousing workloads that primarily perform bulk loads and read-only queries.</span></span> <span data-ttu-id="50058-105">Usare l'indice columnstore per migliorare fino a **10 volte le prestazioni delle query** rispetto all'archiviazione tradizionale orientata alle righe e fino a **7 volte la compressione dei dati** rispetto alle dimensioni dei dati non compressi.</span><span class="sxs-lookup"><span data-stu-id="50058-105">Use the columnstore index to achieve up to **10x query performance** gains over traditional row-oriented storage, and up to **7x data compression** over the uncompressed data size.</span></span>

> [!NOTE]
>  <span data-ttu-id="50058-106">L'indice columnstore cluster viene considerato lo standard per l'archiviazione di grandi tabelle dei fatti di data warehouse e si prevede venga utilizzato nella maggior parte degli scenari di data warehouse.</span><span class="sxs-lookup"><span data-stu-id="50058-106">We view the clustered columnstore index as the standard for storing large data warehousing fact tables, and expect it will be used in most data warehousing scenarios.</span></span> <span data-ttu-id="50058-107">Poiché l'indice columnstore cluster è aggiornabile, il carico di lavoro può eseguire molte operazioni di inserimento, aggiornamento ed eliminazione.</span><span class="sxs-lookup"><span data-stu-id="50058-107">Since the clustered columnstore index is updateable, your workload can perform a large number of insert, update, and delete operations.</span></span>

## <a name="contents"></a><span data-ttu-id="50058-108">Contenuto</span><span class="sxs-lookup"><span data-stu-id="50058-108">Contents</span></span>

-   [<span data-ttu-id="50058-109">Nozioni di base</span><span class="sxs-lookup"><span data-stu-id="50058-109">Basics</span></span>](#basics)

-   [<span data-ttu-id="50058-110">Caricamento dei dati</span><span class="sxs-lookup"><span data-stu-id="50058-110">Loading Data</span></span>](#dataload)

-   [<span data-ttu-id="50058-111">Suggerimenti sulle prestazioni</span><span class="sxs-lookup"><span data-stu-id="50058-111">Performance Tips</span></span>](#performance)

-   [<span data-ttu-id="50058-112">Attività e argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="50058-112">Related Tasks and Topics</span></span>](#related)

##  <a name="basics"></a><a name="basics"></a><span data-ttu-id="50058-113">Basi</span><span class="sxs-lookup"><span data-stu-id="50058-113">Basics</span></span>
 <span data-ttu-id="50058-114">L' *columnstore index* è una tecnologia per l'archiviazione, il recupero e la gestione dei dati utilizzando un formato di dati in colonna, detto columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-114">A *columnstore index* is a technology for storing, retrieving and managing data by using a columnar data format, called a columnstore.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="50058-115">supporta gli indici columnstore sia cluster sia non cluster.</span><span class="sxs-lookup"><span data-stu-id="50058-115">supports both clustered and nonclustered columnstore indexes.</span></span> <span data-ttu-id="50058-116">Entrambi utilizzano la stessa tecnologia columnstore in memoria, ma presentano differenze nello scopo e nelle funzionalità supportate.</span><span class="sxs-lookup"><span data-stu-id="50058-116">Both use the same in-memory columnstore technology, but they do have differences in purpose and in features they support.</span></span>

###  <a name="benefits"></a><a name="benefits"></a> <span data-ttu-id="50058-117">Vantaggi</span><span class="sxs-lookup"><span data-stu-id="50058-117">Benefits</span></span>
 <span data-ttu-id="50058-118">Gli indici columnstore sono ottimali per la maggior parte delle query di sola lettura che eseguono analisi su grandi set di dati.</span><span class="sxs-lookup"><span data-stu-id="50058-118">Columnstore indexes work well for mostly read-only queries that perform analysis on large data sets.</span></span> <span data-ttu-id="50058-119">Spesso, si tratta di query per carichi di lavoro di data warehousing.</span><span class="sxs-lookup"><span data-stu-id="50058-119">Often, these are queries for data warehousing workloads.</span></span> <span data-ttu-id="50058-120">Gli indici columnstore consentono di migliorare notevolmente le prestazioni delle query che utilizzano scansioni complete delle tabelle e non sono particolarmente adatti per le query eseguite per cercare un valore specifico nei dati.</span><span class="sxs-lookup"><span data-stu-id="50058-120">Columnstore indexes give high performance gains for queries that use full table scans, and are not well-suited for queries that seek into the data, searching for a particular value.</span></span>

 <span data-ttu-id="50058-121">Vantaggi dell'indice columnstore:</span><span class="sxs-lookup"><span data-stu-id="50058-121">Columnstore Index benefits:</span></span>

-   <span data-ttu-id="50058-122">Le colonne contengono spesso dati simili che generano frequenze di compressione elevate.</span><span class="sxs-lookup"><span data-stu-id="50058-122">Columns often have similar data, which results in high compression rates.</span></span>

-   <span data-ttu-id="50058-123">Le frequenze di compressione elevate migliorano le prestazioni delle query utilizzando un footprint di memoria più piccolo.</span><span class="sxs-lookup"><span data-stu-id="50058-123">High compression rates improve query performance by using a smaller in-memory footprint.</span></span> <span data-ttu-id="50058-124">A loro volta, le prestazioni delle query costituiscono un miglioramento in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] in quanto è possibile eseguire un numero maggiore di operazioni di dati e query in memoria.</span><span class="sxs-lookup"><span data-stu-id="50058-124">In turn, query performance can improve because [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can perform more query and data operations in-memory.</span></span>

-   <span data-ttu-id="50058-125">In SQL Server è stato aggiunto un nuovo meccanismo per l'esecuzione di query, denominato modalità batch, che consente di ridurre in modo significativo l'utilizzo della CPU.</span><span class="sxs-lookup"><span data-stu-id="50058-125">A new query execution mechanism called batch-mode execution has been added to SQL Server that reduces CPU usage by a large amount.</span></span> <span data-ttu-id="50058-126">L'esecuzione in modalità batch è strettamente integrata al formato di archiviazione columnstore, per il quale è ottimizzata.</span><span class="sxs-lookup"><span data-stu-id="50058-126">Batch-mode execution is closely integrated with, and optimized around, the columnstore storage format.</span></span> <span data-ttu-id="50058-127">L'esecuzione in modalità batch talvolta è detta esecuzione basata su vettore o vettorizzata.</span><span class="sxs-lookup"><span data-stu-id="50058-127">Batch-mode execution is sometimes known as vector-based or vectorized execution.</span></span>

-   <span data-ttu-id="50058-128">Le query spesso selezionano solo alcune colonne di una tabella, riducendo il totale delle operazioni di I/O su un supporto fisico.</span><span class="sxs-lookup"><span data-stu-id="50058-128">Queries often select only a few columns from a table, which reduces total I/O from the physical media.</span></span>

### <a name="columnstore-versions"></a><span data-ttu-id="50058-129">Versioni columnstore</span><span class="sxs-lookup"><span data-stu-id="50058-129">Columnstore Versions</span></span>
 <span data-ttu-id="50058-130">In SQL Server 2012, SQL Server 2012 Parallel Data Warehouse e SQL Server 2014 vengono utilizzati gli indici columnstore per velocizzare le query di data warehouse comuni.</span><span class="sxs-lookup"><span data-stu-id="50058-130">SQL Server 2012, SQL Server 2012 Parallel Data Warehouse, and SQL Server 2014 all use columnstore indexes to accelerate common data warehouse queries.</span></span> <span data-ttu-id="50058-131">In SQL Server 2012 sono state introdotte due nuove funzionalità: un indice columnstore non cluster e una funzionalità di esecuzione di query basata su vettore che elabora i dati in unità denominate "batch".</span><span class="sxs-lookup"><span data-stu-id="50058-131">SQL Server 2012 introduced two new features: a nonclustered columnstore index and a vector-based query execution capability that processes data in units called "batches."</span></span> <span data-ttu-id="50058-132">Oltre alle funzionalità di SQL Server 2012, in SQL Server 2014 sono disponibili gli indici columnstore cluster aggiornabili.</span><span class="sxs-lookup"><span data-stu-id="50058-132">SQL Server 2014 has the features of SQL Server 2012 plus updateable clustered columnstore indexes.</span></span>

### <a name="key-characteristics"></a><span data-ttu-id="50058-133">Caratteristiche chiave</span><span class="sxs-lookup"><span data-stu-id="50058-133">Key Characteristics</span></span>

||
|-|
|<span data-ttu-id="50058-134">**Si applica a**: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] tramite [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="50058-134">**Applies to**: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] through [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|

 <span data-ttu-id="50058-135">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], un indice columnstore cluster:</span><span class="sxs-lookup"><span data-stu-id="50058-135">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a clustered columnstore index:</span></span>

-   <span data-ttu-id="50058-136">È disponibile nelle edizioni Enterprise, Developer ed Evaluation.</span><span class="sxs-lookup"><span data-stu-id="50058-136">Is available in Enterprise, Developer, and Evaluation editions.</span></span>

-   <span data-ttu-id="50058-137">È aggiornabile.</span><span class="sxs-lookup"><span data-stu-id="50058-137">Is updateable.</span></span>

-   <span data-ttu-id="50058-138">È il metodo di archiviazione primario per l'intera tabella.</span><span class="sxs-lookup"><span data-stu-id="50058-138">Is the primary storage method for the entire table.</span></span>

-   <span data-ttu-id="50058-139">Non ha colonne chiave.</span><span class="sxs-lookup"><span data-stu-id="50058-139">Has no key columns.</span></span> <span data-ttu-id="50058-140">Tutte le colonne sono incluse.</span><span class="sxs-lookup"><span data-stu-id="50058-140">All columns are included columns.</span></span>

-   <span data-ttu-id="50058-141">È l'unico indice nella tabella.</span><span class="sxs-lookup"><span data-stu-id="50058-141">Is the only index on the table.</span></span> <span data-ttu-id="50058-142">Non può essere combinato con altri indici.</span><span class="sxs-lookup"><span data-stu-id="50058-142">It cannot be combined with any other indexes.</span></span>

-   <span data-ttu-id="50058-143">Può essere configurato per utilizzare columnstore o la compressione dell'archivio columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-143">Can be configured to use columnstore or columnstore archival compression.</span></span>

-   <span data-ttu-id="50058-144">Non archivia fisicamente le colonne in base a un ordinamento.</span><span class="sxs-lookup"><span data-stu-id="50058-144">Does not physically store columns in a sorted order.</span></span> <span data-ttu-id="50058-145">Archivia i dati per migliorare la compressione e le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="50058-145">Instead, it stores data to improve compression and performance.</span></span>

||
|-|
|<span data-ttu-id="50058-146">**Si applica a**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] tramite [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="50058-146">**Applies to**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] through [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|

 <span data-ttu-id="50058-147">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], un indice columnstore non cluster:</span><span class="sxs-lookup"><span data-stu-id="50058-147">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a nonclustered columnstore index:</span></span>

-   <span data-ttu-id="50058-148">È possibile indicizzare un subset di colonne nell'heap o nell'indice cluster.</span><span class="sxs-lookup"><span data-stu-id="50058-148">Can index a subset of columns in the clustered index or heap.</span></span> <span data-ttu-id="50058-149">Ad esempio, è possibile indicizzare le colonne utilizzate di frequente.</span><span class="sxs-lookup"><span data-stu-id="50058-149">For example, it can index the frequently used columns.</span></span>

-   <span data-ttu-id="50058-150">Richiede uno spazio di archiviazione aggiuntivo per archiviare una copia delle colonne dell'indice.</span><span class="sxs-lookup"><span data-stu-id="50058-150">Requires extra storage to store a copy of the columns in the index.</span></span>

-   <span data-ttu-id="50058-151">Viene aggiornato ricompilando l'indice o cambiando le partizioni. Non è aggiornabile tramite le operazioni DML, ad esempio INSERT, Update e DELETE.</span><span class="sxs-lookup"><span data-stu-id="50058-151">Is updated by rebuilding the index or switching partitions in and out. It is not updateable by using the DML operations such as insert, update, and delete.</span></span>

-   <span data-ttu-id="50058-152">Può essere combinato con altri indici nella tabella.</span><span class="sxs-lookup"><span data-stu-id="50058-152">Can be combined with other indexes on the table.</span></span>

-   <span data-ttu-id="50058-153">Può essere configurato per utilizzare columnstore o la compressione dell'archivio columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-153">Can be configured to use columnstore or columnstore archival compression.</span></span>

-   <span data-ttu-id="50058-154">Non archivia fisicamente le colonne in base a un ordinamento.</span><span class="sxs-lookup"><span data-stu-id="50058-154">Does not physically store columns in a sorted order.</span></span> <span data-ttu-id="50058-155">Archivia i dati per migliorare la compressione e le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="50058-155">Instead, it stores data to improve compression and performance.</span></span> <span data-ttu-id="50058-156">Non è obbligatorio preordinare i dati prima di creare l'indice columnstore, ma questa operazione può migliorare la compressione columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-156">Pre-sorting the data before creating the columnstore index is not required, but can improve columnstore compression.</span></span>

###  <a name="key-concepts-and-terms"></a><a name="Concepts"></a><span data-ttu-id="50058-157">Concetti e termini chiave</span><span class="sxs-lookup"><span data-stu-id="50058-157">Key Concepts and Terms</span></span>
 <span data-ttu-id="50058-158">I seguenti concetti e termini chiave sono associati agli indici columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-158">The following key terms and concepts are associated with columnstore indexes.</span></span>

 <span data-ttu-id="50058-159">indice columnstore: un *indice columnstore* è una tecnologia per l'archiviazione, il recupero e la gestione dei dati tramite un formato di dati a colonne, denominato columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-159">columnstore index A *columnstore index* is a technology for storing, retrieving and managing data by using a columnar data format, called a columnstore.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="50058-160">supporta gli indici columnstore sia cluster sia non cluster.</span><span class="sxs-lookup"><span data-stu-id="50058-160">supports both clustered and nonclustered columnstore indexes.</span></span> <span data-ttu-id="50058-161">Entrambi utilizzano la stessa tecnologia columnstore in memoria, ma presentano differenze nello scopo e nelle funzionalità supportate.</span><span class="sxs-lookup"><span data-stu-id="50058-161">Both use the same in-memory columnstore technology, but they do have differences in purpose and in features they support.</span></span>

 <span data-ttu-id="50058-162">columnstore un *columnstore* è costituito da dati organizzati logicamente in una tabella con righe e colonne e archiviati fisicamente in un formato di dati a livello di colonna.</span><span class="sxs-lookup"><span data-stu-id="50058-162">columnstore A *columnstore* is data that is logically organized as a table with rows and columns, and physically stored in a column-wise data format.</span></span>

 <span data-ttu-id="50058-163">rowstore un *rowstore* è costituito da dati organizzati logicamente in una tabella con righe e colonne e quindi archiviati fisicamente in un formato di dati a livello di riga.</span><span class="sxs-lookup"><span data-stu-id="50058-163">rowstore A *rowstore* is data that is logically organized as a table with rows and columns, and then physically stored in a row-wise data format.</span></span> <span data-ttu-id="50058-164">È stata la modalità di archiviazione tradizionale per archiviare dati relazionali di tabella.</span><span class="sxs-lookup"><span data-stu-id="50058-164">This has been the traditional way to store relational table data.</span></span>

 <span data-ttu-id="50058-165">RowGroups e segmenti di colonna per le prestazioni elevate e i tassi di compressione elevati, l'indice columnstore suddivide la tabella in gruppi di righe, denominati gruppi di righe, quindi comprime ogni gruppo di righe in modo per colonna.</span><span class="sxs-lookup"><span data-stu-id="50058-165">rowgroups and column segments For high performance and high compression rates, the columnstore index slices the table into groups of rows, called row groups, and then compresses each row group in a column-wise manner.</span></span> <span data-ttu-id="50058-166">Il numero di righe nel gruppo di righe deve essere sufficientemente grande da migliorare le frequenze di compressione e sufficientemente ridotto da poter trarre vantaggio dalle operazioni in memoria.</span><span class="sxs-lookup"><span data-stu-id="50058-166">The number of rows in the row group must be large enough to improve compression rates, and small enough to benefit from in-memory operations.</span></span>

 <span data-ttu-id="50058-167">il gruppo di righe A *rowgroup* è un gruppo di righe che vengono compresse nel formato columnstore nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="50058-167">row group A *rowgroup* is a group of rows that are compressed into columnstore format at the same time.</span></span>

 <span data-ttu-id="50058-168">segmento di colonna un *segmento di colonna* è una colonna di dati all'interno di rowgroup.</span><span class="sxs-lookup"><span data-stu-id="50058-168">column segment A *column segment* is a column of data from within the rowgroup.</span></span>

-   <span data-ttu-id="50058-169">Un rowgroup contiene in genere il numero massimo di righe per rowgroup, pari a 1.048.576 righe.</span><span class="sxs-lookup"><span data-stu-id="50058-169">A rowgroup usually contains the maximum number of rows per rowgroup which is 1,048,576 rows.</span></span>

-   <span data-ttu-id="50058-170">Ogni rowgroup contiene un segmento di colonna per ogni colonna della tabella.</span><span class="sxs-lookup"><span data-stu-id="50058-170">Each rowgroup contains one column segment for every column in the table.</span></span>

-   <span data-ttu-id="50058-171">Ogni segmento di colonna è compresso e archiviato su un supporto fisico.</span><span class="sxs-lookup"><span data-stu-id="50058-171">Each column segment is compressed together and stored on physical media.</span></span>

 <span data-ttu-id="50058-172">![Segmento di colonna](../../database-engine/media/sql-server-pdw-columnstore-columnsegment.gif "segmento di colonna")</span><span class="sxs-lookup"><span data-stu-id="50058-172">![Column segment](../../database-engine/media/sql-server-pdw-columnstore-columnsegment.gif "Column segment")</span></span>

 <span data-ttu-id="50058-173">indice columnstore non cluster: un indice *columnstore non cluster* è un indice di sola lettura creato in un indice cluster o in una tabella heap esistente.</span><span class="sxs-lookup"><span data-stu-id="50058-173">nonclustered columnstore index A *nonclustered columnstore index* is a read-only index created on an existing clustered index or heap table.</span></span> <span data-ttu-id="50058-174">Contiene una copia di un subset di colonne, fino a includere tutte le colonne della tabella.</span><span class="sxs-lookup"><span data-stu-id="50058-174">It contains a copy of a subset of columns, up to and including all of the columns in the table..</span></span> <span data-ttu-id="50058-175">La tabella è di sola lettura mentre contiene un indice columnstore non cluster.</span><span class="sxs-lookup"><span data-stu-id="50058-175">The table is read-only while it contains a nonclustered columnstore index.</span></span>

 <span data-ttu-id="50058-176">Un indice columnstore non cluster consente di disporre di un indice columnstore per eseguire query di analisi e, contemporaneamente, operazioni di sola lettura nella tabella originale.</span><span class="sxs-lookup"><span data-stu-id="50058-176">A nonclustered columnstore index provides a way to have a columnstore index for running analysis queries while at the same time performing read-only operations on the original table.</span></span>

 <span data-ttu-id="50058-177">![indice columnstore non cluster](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage-nonclustered.gif "indice columnstore non cluster")</span><span class="sxs-lookup"><span data-stu-id="50058-177">![Nonclustered columnstore index](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage-nonclustered.gif "Nonclustered columnstore index")</span></span>

 <span data-ttu-id="50058-178">indice columnstore cluster un *indice columnstore cluster* è l'archivio fisico per l'intera tabella ed è l'unico indice per la tabella.</span><span class="sxs-lookup"><span data-stu-id="50058-178">clustered columnstore index A *clustered columnstore index* is the physical storage for the entire table and is the only index for the table.</span></span> <span data-ttu-id="50058-179">L'indice cluster è aggiornabile.</span><span class="sxs-lookup"><span data-stu-id="50058-179">The clustered index is updateable.</span></span> <span data-ttu-id="50058-180">È possibile eseguire nell'indice operazioni di inserimento, eliminazione e aggiornamento, nonché il caricamento bulk dei dati.</span><span class="sxs-lookup"><span data-stu-id="50058-180">You can perform insert, delete, and update operations on the index and you can bulk load data into the index.</span></span>

 <span data-ttu-id="50058-181">![Indice columnstore cluster](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage.gif "Indice columnstore cluster")</span><span class="sxs-lookup"><span data-stu-id="50058-181">![Clustered Columnstore Index](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage.gif "Clustered Columnstore Index")</span></span>

 <span data-ttu-id="50058-182">Per ridurre la frammentazione dei segmenti di colonna e migliorare le prestazioni, l'indice columnstore può archiviare alcuni dati temporaneamente in una tabella rowstore, denominata deltastore, nonché un albero B di ID per le righe eliminate.</span><span class="sxs-lookup"><span data-stu-id="50058-182">To reduce fragmentation of the column segments and improve performance, the columnstore index might store some data temporarily into a rowstore table, called a deltastore, plus a B-Tree of IDs for deleted rows.</span></span> <span data-ttu-id="50058-183">Le operazioni deltastore sono gestite in modo automatico.</span><span class="sxs-lookup"><span data-stu-id="50058-183">The deltastore operations are handled behind the scenes.</span></span> <span data-ttu-id="50058-184">Per tornare ai risultati della query corretti, l'indice columnstore cluster combina i risultati della query da columnstore e deltastore.</span><span class="sxs-lookup"><span data-stu-id="50058-184">To return the correct query results, the clustered columnstore index combines query results from both the columnstore and the deltastore.</span></span>

 <span data-ttu-id="50058-185">deltastore usato solo con indici columnstore cluster, un *deltastore* è una tabella rowstore che archivia le righe fino a quando il numero di righe è sufficientemente grande da essere spostato nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-185">deltastore Used with clustered columnstore indexes only, a *deltastore* is a rowstore table that stores rows until the number of rows is large enough to be moved into the columnstore.</span></span> <span data-ttu-id="50058-186">Un deltastore viene utilizzato con indici columnstore cluster per migliorare le prestazioni del caricamento e di altre operazioni DML.</span><span class="sxs-lookup"><span data-stu-id="50058-186">A deltastore is used with clustered columnstore indexes to improve performance for loading and other DML operations.</span></span>

 <span data-ttu-id="50058-187">Durante un caricamento bulk di grandi dimensioni, la maggior parte delle righe viene direttamente indirizzata al columnstore senza passare per il deltastore.</span><span class="sxs-lookup"><span data-stu-id="50058-187">During a large bulk load, most of the rows go directly to the columnstore without passing through the deltastore.</span></span> <span data-ttu-id="50058-188">È possibile che alla fine del caricamento bulk il numero delle righe sia insufficiente a soddisfare le dimensioni minime di un rowgroup, pari a 102.400.</span><span class="sxs-lookup"><span data-stu-id="50058-188">Some rows at the end of the bulk load might be too few in number to meet the minimum size of a rowgroup which is 102,400 rows.</span></span> <span data-ttu-id="50058-189">In questo caso, le righe finali vengono indirizzate al deltastore anziché al columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-189">When this happens, the final rows go to the deltastore instead of the columnstore.</span></span> <span data-ttu-id="50058-190">Per i caricamenti bulk di piccole dimensioni, con meno di 102.400 righe, tutte le righe passano direttamente al deltastore.</span><span class="sxs-lookup"><span data-stu-id="50058-190">For small bulk loads with less than 102,400 rows, all of the rows go directly to the deltastore.</span></span>

 <span data-ttu-id="50058-191">Quando il deltastore raggiunge il numero massimo di righe, viene chiuso.</span><span class="sxs-lookup"><span data-stu-id="50058-191">When the deltastore reaches the maximum number of rows, it becomes closed.</span></span> <span data-ttu-id="50058-192">Un processo tuple-move controlla i gruppi di righe chiusi.</span><span class="sxs-lookup"><span data-stu-id="50058-192">A tuple-move process checks for closed row groups.</span></span> <span data-ttu-id="50058-193">Quando trova il rowgroup chiuso, lo comprime e lo archivia nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-193">When it finds the closed rowgroup, it compresses it and stores it into the columnstore.</span></span>

##  <a name="loading-data"></a><a name="dataload"></a><span data-ttu-id="50058-194">Caricamento dei dati</span><span class="sxs-lookup"><span data-stu-id="50058-194">Loading Data</span></span>

###  <a name="loading-data-into-a-nonclustered-columnstore-index"></a><a name="dataload_nci"></a><span data-ttu-id="50058-195">Caricamento di dati in un indice columnstore non cluster</span><span class="sxs-lookup"><span data-stu-id="50058-195">Loading Data into a Nonclustered Columnstore Index</span></span>
 <span data-ttu-id="50058-196">Per caricare i dati in un indice columnstore non cluster, caricare innanzitutto i dati in una tabella rowstore tradizionale archiviata come indice cluster o heap, quindi creare l'indice columnstore non cluster con [create columnstore index &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="50058-196">To load data into a nonclustered columnstore index, first load data into a traditional rowstore table stored as a heap or clustered index, and then create the nonclustered columnstore index with [CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span></span>

 <span data-ttu-id="50058-197">![Caricamento dati in un indice columnstore](../../database-engine/media/sql-server-pdw-columnstore-loadprocess-nonclustered.gif "Caricamento dati in un indice columnstore")</span><span class="sxs-lookup"><span data-stu-id="50058-197">![Loading data into a columnstore index](../../database-engine/media/sql-server-pdw-columnstore-loadprocess-nonclustered.gif "Loading data into a columnstore index")</span></span>

 <span data-ttu-id="50058-198">Una tabella con un indice columnstore non cluster è di sola lettura finché l'indice non viene eliminato o disabilitato.</span><span class="sxs-lookup"><span data-stu-id="50058-198">A table with a nonclustered columnstore index is read-only until the index is dropped or disabled.</span></span> <span data-ttu-id="50058-199">Per aggiornare la tabella e l'indice columnstore non cluster è possibile attivare e disattivare le partizioni. È inoltre possibile disabilitare l'indice, aggiornare la tabella, quindi ricompilare l'indice.</span><span class="sxs-lookup"><span data-stu-id="50058-199">To update the table and the nonclustered columnstore index you can switch partitions in and out. You can also disable the index, update the table, and then rebuild the index.</span></span>

 <span data-ttu-id="50058-200">Per ulteriori informazioni, vedere [Using Nonclustered Columnstore Indexes](indexes.md).</span><span class="sxs-lookup"><span data-stu-id="50058-200">For more information see [Using Nonclustered Columnstore Indexes](indexes.md)</span></span>

###  <a name="loading-data-into-a-clustered-columnstore-index"></a><a name="dataload_cci"></a><span data-ttu-id="50058-201">Caricamento di dati in un indice columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="50058-201">Loading Data into a Clustered Columnstore Index</span></span>
 <span data-ttu-id="50058-202">![Caricamento in un indice cluster columnstore](../../database-engine/media/sql-server-pdw-columnstore-loadprocess.gif "Caricamento in un indice cluster columnstore")</span><span class="sxs-lookup"><span data-stu-id="50058-202">![Loading into a clustered columnstore index](../../database-engine/media/sql-server-pdw-columnstore-loadprocess.gif "Loading into a clustered columnstore index")</span></span>

 <span data-ttu-id="50058-203">Come illustrato nel diagramma, per caricare i dati in un indice columnstore cluster di [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="50058-203">As the diagram suggests, to load data into a clustered columnstore index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>

1.  <span data-ttu-id="50058-204">I rowgroup di dimensioni massime vengono inseriti direttamente nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-204">Inserts maximum-size rowgroups directly into the columnstore.</span></span> <span data-ttu-id="50058-205">Quando i dati vengono caricati in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], le righe di dati vengono assegnate in ordine di arrivo in un rowgroup aperto.</span><span class="sxs-lookup"><span data-stu-id="50058-205">As the data is loaded, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] assigns the data rows in a first-come first-serve order into an open rowgroup.</span></span>

2.  <span data-ttu-id="50058-206">Per ogni rowgroup, dopo aver raggiunto le dimensioni massime in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="50058-206">For each rowgroup, after it reaches the maximum size, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>

    1.  <span data-ttu-id="50058-207">Il rowgroup viene contrassegnato come CLOSED.</span><span class="sxs-lookup"><span data-stu-id="50058-207">Marks the rowgroup as CLOSED.</span></span>

    2.  <span data-ttu-id="50058-208">Il deltastore viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="50058-208">Bypasses the deltastore.</span></span>

    3.  <span data-ttu-id="50058-209">Ogni segmento di colonna viene compresso con il rowgroup con la compressione del columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-209">Compresses each column segment with the rowgroup with columnstore compression.</span></span>

    4.  <span data-ttu-id="50058-210">Ogni segmento di colonna compresso viene fisicamente archiviato nel columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-210">Physically stores each compressed column segment into the columnstore.</span></span>

3.  <span data-ttu-id="50058-211">Le righe rimanenti vengono inserite nel columnstore o nel deltastore come segue:</span><span class="sxs-lookup"><span data-stu-id="50058-211">Inserts the remaining rows into the columnstore or the deltastore as follows:</span></span>

    1.  <span data-ttu-id="50058-212">Se il numero di righe soddisfa il requisito minimo di righe per rowgroup, le righe vengono aggiunte al columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-212">If the number of rows meets the minimum rows per rowgroup requirement, the rows are added to the columnstore.</span></span>

    2.  <span data-ttu-id="50058-213">Se il numero di righe è inferiore al requisito minimo di righe per rowgroup, le righe vengono aggiunte al deltastore.</span><span class="sxs-lookup"><span data-stu-id="50058-213">If the number of rows is less than the minimum rows per rowgroup, the rows are added to the deltastore.</span></span>

 <span data-ttu-id="50058-214">Per ulteriori informazioni sulle attività e i processi deltastore, vedere [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="50058-214">For more information about deltastore tasks and processes, see [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md)</span></span>

##  <a name="performance-tips"></a><a name="performance"></a><span data-ttu-id="50058-215">Suggerimenti sulle prestazioni</span><span class="sxs-lookup"><span data-stu-id="50058-215">Performance Tips</span></span>

### <a name="plan-for-enough-memory-to-create-columnstore-indexes-in-parallel"></a><span data-ttu-id="50058-216">Pianificare una quantità di memoria sufficiente per creare indici columnstore in parallelo</span><span class="sxs-lookup"><span data-stu-id="50058-216">Plan for enough memory to create columnstore indexes in parallel</span></span>
 <span data-ttu-id="50058-217">Per impostazione predefinita, la creazione di un indice columnstore è un'operazione parallela, a meno che la memoria non sia vincolata.</span><span class="sxs-lookup"><span data-stu-id="50058-217">Creating a columnstore index is by default a parallel operation unless memory is constrained.</span></span> <span data-ttu-id="50058-218">La creazione dell'indice in parallelo richiede più memoria rispetto alla creazione dell'indice in modo seriale.</span><span class="sxs-lookup"><span data-stu-id="50058-218">Creating the index in parallel requires more memory than creating the index serially.</span></span> <span data-ttu-id="50058-219">Se si dispone di un'ampia quantità di memoria, la creazione di un indice columnstore richiede un tempo di circa 1,5 volte superiore rispetto alla compilazione di un albero B nelle stesse colonne.</span><span class="sxs-lookup"><span data-stu-id="50058-219">When there is ample memory, creating a columnstore index takes on the order of 1.5 times as long as building a B-tree on the same columns.</span></span>

 <span data-ttu-id="50058-220">La memoria richiesta per la creazione di un indice columnstore dipende dal numero di colonne, dal numero di colonne stringa, dal grado di parallelismo e dalle caratteristiche dei dati.</span><span class="sxs-lookup"><span data-stu-id="50058-220">The memory required for creating a columnstore index depends on the number of columns, the number of string columns, the degree of parallelism (DOP), and the characteristics of the data.</span></span> <span data-ttu-id="50058-221">Ad esempio, se la tabella contiene meno di un milione di righe, SQL Server utilizzerà un solo thread per creare l'indice columnstore.</span><span class="sxs-lookup"><span data-stu-id="50058-221">For example, if your table has fewer than one million rows, SQL Server will use only one thread to create the columnstore index.</span></span>

 <span data-ttu-id="50058-222">Se la tabella dispone di più di un milione di righe, ma SQL Server non ha a disposizione memoria sufficiente per creare l'indice utilizzando MAXDOP, SQL Server ridurrà automaticamente MAXDOP secondo le esigenze per adattarsi alla memoria disponibile.</span><span class="sxs-lookup"><span data-stu-id="50058-222">If your table has more than one million rows, but SQL Server cannot get a large enough memory grant to create the index using MAXDOP, SQL Server will automatically decrease MAXDOP as needed to fit into the available memory grant.</span></span>  <span data-ttu-id="50058-223">In alcuni casi, è necessario ridurre il grado di parallelismo a uno per compilare l'indice nella memoria vincolata.</span><span class="sxs-lookup"><span data-stu-id="50058-223">In some cases, DOP must be decreased to one in order to build the index under constrained memory.</span></span>

##  <a name="related-tasks-and-topics"></a><a name="related"></a><span data-ttu-id="50058-224">Attività e argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="50058-224">Related Tasks and Topics</span></span>

### <a name="nonclustered-columnstore-indexes"></a><span data-ttu-id="50058-225">Indici columnstore non cluster</span><span class="sxs-lookup"><span data-stu-id="50058-225">Nonclustered Columnstore Indexes</span></span>
 <span data-ttu-id="50058-226">Per le attività comuni, vedere [Using Nonclustered Columnstore Indexes](../../database-engine/using-nonclustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="50058-226">For common tasks, see [Using Nonclustered Columnstore Indexes](../../database-engine/using-nonclustered-columnstore-indexes.md).</span></span>

-   [<span data-ttu-id="50058-227">CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-227">CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-columnstore-index-transact-sql)

-   <span data-ttu-id="50058-228">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) con REBUILD.</span><span class="sxs-lookup"><span data-stu-id="50058-228">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) with REBUILD.</span></span>

-   [<span data-ttu-id="50058-229">DROP INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-229">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)

### <a name="clustered-columnstore-indexes"></a><span data-ttu-id="50058-230">Indici columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="50058-230">Clustered Columnstore Indexes</span></span>
 <span data-ttu-id="50058-231">Per le attività comuni, vedere [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="50058-231">For common tasks, see [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span></span>

-   [<span data-ttu-id="50058-232">CREARE un indice COLUMNStore CLUSTER &#40;&#41;Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="50058-232">CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-columnstore-index-transact-sql)

-   <span data-ttu-id="50058-233">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) con REBUILD o REORGANIZE.</span><span class="sxs-lookup"><span data-stu-id="50058-233">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) with REBUILD or REORGANIZE.</span></span>

-   [<span data-ttu-id="50058-234">DROP INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-234">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)

-   [<span data-ttu-id="50058-235">INSERT &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-235">INSERT &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/insert-transact-sql)

-   [<span data-ttu-id="50058-236">UPDATE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-236">UPDATE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/queries/update-transact-sql)

-   [<span data-ttu-id="50058-237">DELETE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-237">DELETE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/delete-transact-sql)

### <a name="metadata"></a><span data-ttu-id="50058-238">Metadati</span><span class="sxs-lookup"><span data-stu-id="50058-238">Metadata</span></span>
 <span data-ttu-id="50058-239">Tutte le colonne di un indice columnstore vengono archiviate nei metadati come colonne incluse.</span><span class="sxs-lookup"><span data-stu-id="50058-239">All of the columns in a columnstore index are stored in the metadata as included columns.</span></span> <span data-ttu-id="50058-240">L'indice columnstore non contiene colonne chiave.</span><span class="sxs-lookup"><span data-stu-id="50058-240">The columnstore index does not have key columns.</span></span>

-   [<span data-ttu-id="50058-241">sys.indexes &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-241">sys.indexes &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-indexes-transact-sql)

-   [<span data-ttu-id="50058-242">sys.index_columns &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-242">sys.index_columns &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-index-columns-transact-sql)

-   [<span data-ttu-id="50058-243">sys.partitions &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-243">sys.partitions &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-partitions-transact-sql)

-   [<span data-ttu-id="50058-244">sys.column_store_segments &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-244">sys.column_store_segments &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-segments-transact-sql)

-   [<span data-ttu-id="50058-245">sys.column_store_dictionaries &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-245">sys.column_store_dictionaries &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-dictionaries-transact-sql)

-   [<span data-ttu-id="50058-246">sys.column_store_row_groups &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="50058-246">sys.column_store_row_groups &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-row-groups-transact-sql)


