---
title: Aggiornamenti posizionati (ODBC) | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client ODBC driver, cursors
- SQLSetPos function
- SQLSetCursorName function
- ODBC applications, cursors
- cursors [ODBC], positioned updates
- positioned updates [ODBC]
- ODBC cursors, positioned updates
ms.assetid: ff404e02-630f-474d-b5d4-06442b756991
author: rothja
ms.author: jroth
ms.openlocfilehash: 20272014e32632117e6282e5929d1d21789852df
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87626768"
---
# <a name="positioned-updates-odbc"></a><span data-ttu-id="7b32a-102">Aggiornamenti posizionati (ODBC)</span><span class="sxs-lookup"><span data-stu-id="7b32a-102">Positioned Updates (ODBC)</span></span>
  <span data-ttu-id="7b32a-103">In ODBC sono supportati due metodi per eseguire gli aggiornamenti posizionati in un cursore:</span><span class="sxs-lookup"><span data-stu-id="7b32a-103">ODBC supports two methods for performing positioned updates in a cursor:</span></span>  
  
-   <span data-ttu-id="7b32a-104">**SQLSetPos**</span><span class="sxs-lookup"><span data-stu-id="7b32a-104">**SQLSetPos**</span></span>  
  
-   <span data-ttu-id="7b32a-105">Clausola WHERE CURRENT OF</span><span class="sxs-lookup"><span data-stu-id="7b32a-105">WHERE CURRENT OF clause</span></span>  
  
 <span data-ttu-id="7b32a-106">L'approccio più comune consiste nell'usare **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="7b32a-106">The more common approach is to use **SQLSetPos**.</span></span> <span data-ttu-id="7b32a-107">che dispone delle opzioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="7b32a-107">It has the following options.</span></span>  
  
 <span data-ttu-id="7b32a-108">SQL_POSITION</span><span class="sxs-lookup"><span data-stu-id="7b32a-108">SQL_POSITION</span></span>  
 <span data-ttu-id="7b32a-109">Posiziona il cursore in una riga specifica del set di righe corrente.</span><span class="sxs-lookup"><span data-stu-id="7b32a-109">Positions the cursor on a specific row in the current rowset.</span></span>  
  
 <span data-ttu-id="7b32a-110">SQL_REFRESH</span><span class="sxs-lookup"><span data-stu-id="7b32a-110">SQL_REFRESH</span></span>  
 <span data-ttu-id="7b32a-111">Aggiorna le variabili di programma associate alle colonne del set di risultati in base ai valori della riga su cui è posizionato il cursore.</span><span class="sxs-lookup"><span data-stu-id="7b32a-111">Refreshes program variables bound to the result set columns with the values from the row the cursor is currently positioned on.</span></span>  
  
 <span data-ttu-id="7b32a-112">SQL_UPDATE</span><span class="sxs-lookup"><span data-stu-id="7b32a-112">SQL_UPDATE</span></span>  
 <span data-ttu-id="7b32a-113">Aggiorna la riga corrente del cursore con i valori archiviati nelle variabili di programma associate alle colonne del set di risultati.</span><span class="sxs-lookup"><span data-stu-id="7b32a-113">Updates the current row in the cursor with the values stored in the program variables bound to the result set columns.</span></span>  
  
 <span data-ttu-id="7b32a-114">SQL_DELETE</span><span class="sxs-lookup"><span data-stu-id="7b32a-114">SQL_DELETE</span></span>  
 <span data-ttu-id="7b32a-115">Elimina la riga corrente dal cursore.</span><span class="sxs-lookup"><span data-stu-id="7b32a-115">Deletes the current row in the cursor.</span></span>  
  
 <span data-ttu-id="7b32a-116">**SQLSetPos** può essere utilizzato con qualsiasi set di risultati di istruzioni quando gli attributi del cursore dell'handle di istruzione sono impostati per utilizzare i cursori server.</span><span class="sxs-lookup"><span data-stu-id="7b32a-116">**SQLSetPos** can be used with any statement result set when the statement handle cursor attributes are set to use server cursors.</span></span> <span data-ttu-id="7b32a-117">Le colonne del set di risultati devono essere associate a variabili di programma.</span><span class="sxs-lookup"><span data-stu-id="7b32a-117">The result set columns must be bound to program variables.</span></span> <span data-ttu-id="7b32a-118">Non appena l'applicazione ha recuperato una riga, chiama **SQLSetPos**(SQL_POSTION) per posizionare il cursore sulla riga.</span><span class="sxs-lookup"><span data-stu-id="7b32a-118">As soon as the application has fetched a row it calls **SQLSetPos**(SQL_POSTION) to position the cursor on the row.</span></span> <span data-ttu-id="7b32a-119">È possibile quindi chiamare SQLSetPos (SQL_DELETE) per eliminare la riga corrente o spostare i nuovi valori dei dati nelle variabili di programma associate e chiamare SQLSetPos (SQL_UPDATE) per aggiornare la riga corrente.</span><span class="sxs-lookup"><span data-stu-id="7b32a-119">The application could then call SQLSetPos(SQL_DELETE) to delete the current row, or it can move new data values into the bound program variables and call SQLSetPos(SQL_UPDATE) to update the current row.</span></span>  
  
 <span data-ttu-id="7b32a-120">Le applicazioni possono aggiornare o eliminare qualsiasi riga del set di righe con **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="7b32a-120">Applications can update or delete any row in the rowset with **SQLSetPos**.</span></span> <span data-ttu-id="7b32a-121">La chiamata di **SQLSetPos** è una pratica alternativa alla costruzione e all'esecuzione di un'istruzione SQL.</span><span class="sxs-lookup"><span data-stu-id="7b32a-121">Calling **SQLSetPos** is a convenient alternative to constructing and executing an SQL statement.</span></span> <span data-ttu-id="7b32a-122">**SQLSetPos** opera sul set di righe corrente e può essere utilizzato solo dopo una chiamata a [SQLFetchScroll](../native-client-odbc-api/sqlfetchscroll.md).</span><span class="sxs-lookup"><span data-stu-id="7b32a-122">**SQLSetPos** operates on the current rowset and can be used only after a call to [SQLFetchScroll](../native-client-odbc-api/sqlfetchscroll.md).</span></span>  
  
 <span data-ttu-id="7b32a-123">Le dimensioni del set di righe vengono impostate da una chiamata a [SQLSetStmtAttr](../native-client-odbc-api/sqlsetstmtattr.md) con un argomento attribute di SQL_ATTR_ROW_ARRAY_SIZE.</span><span class="sxs-lookup"><span data-stu-id="7b32a-123">Rowset size is set by a call to [SQLSetStmtAttr](../native-client-odbc-api/sqlsetstmtattr.md) with an attribute argument of SQL_ATTR_ROW_ARRAY_SIZE.</span></span> <span data-ttu-id="7b32a-124">**SQLSetPos** utilizza una nuova dimensione del set di righe, ma solo dopo una chiamata a **SQLFetch** o **SQLFetchScroll**.</span><span class="sxs-lookup"><span data-stu-id="7b32a-124">**SQLSetPos** uses a new rowset size, but only after a call to **SQLFetch** or **SQLFetchScroll**.</span></span> <span data-ttu-id="7b32a-125">Se, ad esempio, le dimensioni del set di righe vengono modificate, viene chiamato **SQLSetPos** e viene chiamato **SQLFetch** o **SQLFetchScroll** .</span><span class="sxs-lookup"><span data-stu-id="7b32a-125">For example, if the rowset size is changed, **SQLSetPos** is called and then **SQLFetch** or **SQLFetchScroll** is called.</span></span> <span data-ttu-id="7b32a-126">La chiamata a **SQLSetPos** usa le dimensioni del set di righe precedenti, ma **SQLFetch** o **SQLFetchScroll** usa le nuove dimensioni del set di righe.</span><span class="sxs-lookup"><span data-stu-id="7b32a-126">The call to **SQLSetPos** uses the old rowset size, but **SQLFetch** or **SQLFetchScroll** uses the new rowset size.</span></span>  
  
 <span data-ttu-id="7b32a-127">La prima riga nel set di righe è il numero di riga 1.</span><span class="sxs-lookup"><span data-stu-id="7b32a-127">The first row in the rowset is row number 1.</span></span> <span data-ttu-id="7b32a-128">L'argomento RowNumber in **SQLSetPos** deve identificare una riga nel set di righe; ovvero, il valore deve essere compreso tra 1 e il numero di righe recuperate più di recente.</span><span class="sxs-lookup"><span data-stu-id="7b32a-128">The RowNumber argument in **SQLSetPos** must identify a row in the rowset; that is, its value must be in the range between 1 and the number of rows that were most recently fetched.</span></span> <span data-ttu-id="7b32a-129">Questo valore potrebbe essere inferiore alle dimensioni del set di righe.</span><span class="sxs-lookup"><span data-stu-id="7b32a-129">This may be less than the rowset size.</span></span> <span data-ttu-id="7b32a-130">Se RowNumber è 0, l'operazione viene applicata a ogni riga nel set di righe.</span><span class="sxs-lookup"><span data-stu-id="7b32a-130">If RowNumber is 0, the operation applies to every row in the rowset.</span></span>  
  
 <span data-ttu-id="7b32a-131">L'operazione di eliminazione di **SQLSetPos** consente all'origine dati di eliminare una o più righe selezionate di una tabella.</span><span class="sxs-lookup"><span data-stu-id="7b32a-131">The delete operation of **SQLSetPos** makes the data source delete one or more selected rows of a table.</span></span> <span data-ttu-id="7b32a-132">Per eliminare righe con **SQLSetPos**, l'applicazione chiama **SQLSetPos** con Operation set su SQL_DELETE e RowNumber impostato sul numero della riga da eliminare.</span><span class="sxs-lookup"><span data-stu-id="7b32a-132">To delete rows with **SQLSetPos**, the application calls **SQLSetPos** with Operation set to SQL_DELETE and RowNumber set to the number of the row to delete.</span></span> <span data-ttu-id="7b32a-133">Se RowNumber è 0, tutte le righe nel set di righe vengono eliminate.</span><span class="sxs-lookup"><span data-stu-id="7b32a-133">If RowNumber is 0, all rows in the rowset are deleted.</span></span>  
  
 <span data-ttu-id="7b32a-134">Quando **SQLSetPos** restituisce, la riga eliminata è la riga corrente e il relativo stato è SQL_ROW_DELETED.</span><span class="sxs-lookup"><span data-stu-id="7b32a-134">After **SQLSetPos** returns, the deleted row is the current row and its status is SQL_ROW_DELETED.</span></span> <span data-ttu-id="7b32a-135">La riga non può essere usata in altre operazioni posizionate, ad esempio le chiamate a [SQLGetData](../native-client-odbc-api/sqlgetdata.md) o **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="7b32a-135">The row cannot be used in any additional positioned operations, such as calls to [SQLGetData](../native-client-odbc-api/sqlgetdata.md) or **SQLSetPos**.</span></span>  
  
 <span data-ttu-id="7b32a-136">Quando si eliminano tutte le righe del set di righe (RowNumber è uguale a 0), l'applicazione può impedire al driver di eliminare determinate righe usando la matrice dell'operazione di riga come per l'operazione di aggiornamento di **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="7b32a-136">When you delete all rows of the rowset (RowNumber is equal to 0), the application can prevent the driver from deleting certain rows by using the row operation array just like for the update operation of **SQLSetPos**.</span></span>  
  
 <span data-ttu-id="7b32a-137">Ogni riga eliminata deve essere una riga che esiste nel set di risultati.</span><span class="sxs-lookup"><span data-stu-id="7b32a-137">Every row that is deleted should be a row that exists in the result set.</span></span> <span data-ttu-id="7b32a-138">Se dopo il recupero i buffer dell'applicazione risultano pieni e se è stata conservata una matrice di stato della riga, i valori in ognuna di queste posizioni delle righe non devono essere SQL_ROW_DELETED, SQL_ROW_ERROR o SQL_ROW_NOROW.</span><span class="sxs-lookup"><span data-stu-id="7b32a-138">If the application buffers were filled by fetching, and if a row status array has been maintained, its values at each of these row positions should not be SQL_ROW_DELETED, SQL_ROW_ERROR, or SQL_ROW_NOROW.</span></span>  
  
 <span data-ttu-id="7b32a-139">Gli aggiornamenti posizionati possono inoltre essere eseguiti utilizzando la clausola WHERE CURRENT OF nelle istruzioni UPDATE, DELETE e INSERT.</span><span class="sxs-lookup"><span data-stu-id="7b32a-139">Positioned updates can also be performed using the WHERE CURRENT OF clause on UPDATE, DELETE, and INSERT statements.</span></span> <span data-ttu-id="7b32a-140">LADDOVE CURRENT OF richiede un nome di cursore che verrà generato da ODBC quando viene chiamata la funzione [SQLGetCursorName](../native-client-odbc-api/sqlgetcursorname.md) o che è possibile specificare chiamando **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="7b32a-140">WHERE CURRENT OF requires a cursor name that ODBC will generate when the [SQLGetCursorName](../native-client-odbc-api/sqlgetcursorname.md) function is called, or which you can specify by calling **SQLSetCursorName**.</span></span> <span data-ttu-id="7b32a-141">Di seguito sono riportati i passaggi generali utilizzati per eseguire un aggiornamento di WHERE CURRENT OF in un'applicazione ODBC:</span><span class="sxs-lookup"><span data-stu-id="7b32a-141">The following are general steps used to perform a WHERE CURRENT OF update in an ODBC application:</span></span>  
  
-   <span data-ttu-id="7b32a-142">Chiamare **SQLSetCursorName** per stabilire un nome di cursore per l'handle dell'istruzione.</span><span class="sxs-lookup"><span data-stu-id="7b32a-142">Call **SQLSetCursorName** to establish a cursor name for the statement handle.</span></span>  
  
-   <span data-ttu-id="7b32a-143">Compilare un'istruzione SELECT con una clausola FOR UPDATE OF ed eseguirla.</span><span class="sxs-lookup"><span data-stu-id="7b32a-143">Build a SELECT statement with a FOR UPDATE OF clause and execute it.</span></span>  
  
-   <span data-ttu-id="7b32a-144">Chiamare **SQLFetchScroll** per recuperare un set di righe o **SQLFetch** per recuperare una riga.</span><span class="sxs-lookup"><span data-stu-id="7b32a-144">Call **SQLFetchScroll** to retrieve a rowset or **SQLFetch** to retrieve a row.</span></span>  
  
-   <span data-ttu-id="7b32a-145">Chiamare **SQLSetPos** (SQL_POSITION) per posizionare il cursore sulla riga.</span><span class="sxs-lookup"><span data-stu-id="7b32a-145">Call **SQLSetPos** (SQL_POSITION) to position the cursor on the row.</span></span>  
  
-   <span data-ttu-id="7b32a-146">Compilare ed eseguire un'istruzione UPDATE con una clausola WHERE CURRENT OF utilizzando il nome del cursore impostato con **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="7b32a-146">Build and execute an UPDATE statement with a WHERE CURRENT OF clause using the cursor name set with **SQLSetCursorName**.</span></span>  
  
 <span data-ttu-id="7b32a-147">In alternativa, è possibile chiamare **SQLGetCursorName** dopo l'esecuzione dell'istruzione SELECT anziché chiamare **SQLSetCursorName** prima di eseguire l'istruzione SELECT.</span><span class="sxs-lookup"><span data-stu-id="7b32a-147">Alternatively, you could call **SQLGetCursorName** after you execute the SELECT statement instead of calling **SQLSetCursorName** before executing the SELECT statement.</span></span> <span data-ttu-id="7b32a-148">**SQLGetCursorName** restituisce un nome di cursore predefinito assegnato da ODBC se non si imposta un nome di cursore utilizzando **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="7b32a-148">**SQLGetCursorName** returns a default cursor name assigned by ODBC if you do not set a cursor name using **SQLSetCursorName**.</span></span>  
  
 <span data-ttu-id="7b32a-149">**SQLSetPos** è preferibile rispetto a where current of quando si utilizzano i cursori server.</span><span class="sxs-lookup"><span data-stu-id="7b32a-149">**SQLSetPos** is preferred over WHERE CURRENT OF when you are using server cursors.</span></span> <span data-ttu-id="7b32a-150">Se si utilizza un cursore statico aggiornabile con la libreria di cursore ODBC, la libreria di cursori implementa gli aggiornamenti di WHERE CURRENT OF aggiungendo una clausola WHERE con i valori chiave per la tabella sottostante.</span><span class="sxs-lookup"><span data-stu-id="7b32a-150">If you are using a static, updatable cursor with the ODBC cursor library, the cursor library implements WHERE CURRENT OF updates by adding a WHERE clause with the key values for the underlying table.</span></span> <span data-ttu-id="7b32a-151">Se le chiavi nella tabella non sono univoche, possono verificarsi aggiornamenti non desiderati.</span><span class="sxs-lookup"><span data-stu-id="7b32a-151">This can cause unintended updates if the keys in the table are not unique.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7b32a-152">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="7b32a-152">See Also</span></span>  
 [<span data-ttu-id="7b32a-153">Utilizzo di cursori &#40;&#41;ODBC</span><span class="sxs-lookup"><span data-stu-id="7b32a-153">Using Cursors &#40;ODBC&#41;</span></span>](using-cursors-odbc.md)  
  
  
