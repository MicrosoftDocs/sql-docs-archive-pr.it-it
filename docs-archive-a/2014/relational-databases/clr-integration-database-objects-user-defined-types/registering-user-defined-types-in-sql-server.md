---
title: Registrazione di tipi definiti dall'utente in SQL Server | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
dev_langs:
- TSQL
helpviewer_keywords:
- UDTs [CLR integration], maintaining
- user-defined types [CLR integration], maintaining
- dependencies [CLR integration]
- deploying user-defined types [CLR integration]
- CurrencyConversion function
- user-defined types [CLR integration], deploying
- Transact-SQL deploying UDTs
- assemblies [CLR integration], user-defined types
- cross-database UDT support
- CREATE ASSEMBLY statement
- DROP TYPE statement
- Currency UDT
- CREATE TYPE statement
- registering user-defined types
- UDTs [CLR integration], deploying
- removing user-defined types
- user-defined types [CLR integration], registering
- ALTER ASSEMBLY statement
- UDTs [CLR integration], registering
- ADD FILE clause
ms.assetid: f7da3e92-e407-4f0b-b3a3-f214e442b37d
author: rothja
ms.author: jroth
ms.openlocfilehash: 7d24f7948e093335eff708f3c4a8a7361cfc156f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87625418"
---
# <a name="registering-user-defined-types-in-sql-server"></a><span data-ttu-id="8a576-102">Registrazione dei tipi definiti dall'utente in SQL Server</span><span class="sxs-lookup"><span data-stu-id="8a576-102">Registering User-Defined Types in SQL Server</span></span>
  <span data-ttu-id="8a576-103">Per utilizzare un tipo definito dall'utente (UDT) in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , è necessario registrarlo.</span><span class="sxs-lookup"><span data-stu-id="8a576-103">In order to use a user-defined type (UDT) in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you must register it.</span></span> <span data-ttu-id="8a576-104">La registrazione di un tipo definito dall'utente (UDT) comporta la registrazione dell'assembly e la creazione del tipo nel database in cui si desidera utilizzarlo.</span><span class="sxs-lookup"><span data-stu-id="8a576-104">Registering a UDT involves registering the assembly and creating the type in the database in which you wish to use it.</span></span> <span data-ttu-id="8a576-105">I tipi definiti dall'utente (UDT) vengono definiti nell'ambito di un singolo database e non possono essere utilizzati in più database a meno che lo stesso assembly e lo stesso tipo definito dall'utente (UDT) non vengano registrati con ogni database.</span><span class="sxs-lookup"><span data-stu-id="8a576-105">UDTs are scoped to a single database, and cannot be used in multiple databases unless the identical assembly and UDT are registered with each database.</span></span> <span data-ttu-id="8a576-106">Dopo la registrazione dell'assembly del tipo definito dall'utente (UDT) e la creazione del tipo, è possibile utilizzare il tipo definito dall'utente (UDT) in [!INCLUDE[tsql](../../includes/tsql-md.md)] e nel codice client.</span><span class="sxs-lookup"><span data-stu-id="8a576-106">Once the UDT assembly is registered and the type created, you can use the UDT in [!INCLUDE[tsql](../../includes/tsql-md.md)] and in client code.</span></span> <span data-ttu-id="8a576-107">Per altre informazioni, vedere [Tipi CLR definiti dall'utente](clr-user-defined-types.md).</span><span class="sxs-lookup"><span data-stu-id="8a576-107">For more information, see [CLR User-Defined Types](clr-user-defined-types.md).</span></span>  
  
## <a name="using-visual-studio-to-deploy-udts"></a><span data-ttu-id="8a576-108">Utilizzo di Visual Studio per distribuire i tipi definiti dall'utente (UDT)</span><span class="sxs-lookup"><span data-stu-id="8a576-108">Using Visual Studio to Deploy UDTs</span></span>  
 <span data-ttu-id="8a576-109">Il modo più semplice per distribuire il tipo definito dall'utente (UDT) è utilizzare [!INCLUDE[msCoName](../../includes/msconame-md.md)] Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="8a576-109">The easiest way to deploy your UDT is by using [!INCLUDE[msCoName](../../includes/msconame-md.md)] Visual Studio.</span></span> <span data-ttu-id="8a576-110">Per scenari di distribuzione più complessi e una maggiore flessibilità utilizzare tuttavia [!INCLUDE[tsql](../../includes/tsql-md.md)] come illustrato più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="8a576-110">For more complex deployment scenarios and the greatest flexibility, however, use [!INCLUDE[tsql](../../includes/tsql-md.md)] as discussed later in this topic.</span></span>  
  
 <span data-ttu-id="8a576-111">Seguire questi passaggi per creare e distribuire un tipo definito dall'utente (UDT) mediante Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="8a576-111">Follow these steps to create and deploy a UDT using Visual Studio:</span></span>  
  
1.  <span data-ttu-id="8a576-112">Creare un nuovo progetto di **database** nei nodi del linguaggio **Visual Basic** o **Visual C#** .</span><span class="sxs-lookup"><span data-stu-id="8a576-112">Create a new **Database** project in the **Visual Basic** or **Visual C#** language nodes.</span></span>  
  
2.  <span data-ttu-id="8a576-113">Aggiungere un riferimento al database di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] che conterrà il tipo definito dall'utente (UDT).</span><span class="sxs-lookup"><span data-stu-id="8a576-113">Add a reference to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database that will contain the UDT.</span></span>  
  
3.  <span data-ttu-id="8a576-114">Aggiungere una classe di **tipo definito dall'utente** .</span><span class="sxs-lookup"><span data-stu-id="8a576-114">Add a **User-Defined Type** class.</span></span>  
  
4.  <span data-ttu-id="8a576-115">Scrivere il codice per implementare il tipo definito dall'utente (UDT).</span><span class="sxs-lookup"><span data-stu-id="8a576-115">Write code to implement the UDT.</span></span>  
  
5.  <span data-ttu-id="8a576-116">Scegliere **Distribuisci**dal menu **Compila** .</span><span class="sxs-lookup"><span data-stu-id="8a576-116">From the **Build** menu, select **Deploy**.</span></span> <span data-ttu-id="8a576-117">per registrare l'assembly e creare il tipo nel database di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8a576-117">This registers the assembly and creates the type in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database.</span></span>  
  
## <a name="using-transact-sql-to-deploy-udts"></a><span data-ttu-id="8a576-118">Utilizzo di Transact-SQL per distribuire i tipi definiti dall'utente (UDT)</span><span class="sxs-lookup"><span data-stu-id="8a576-118">Using Transact-SQL to Deploy UDTs</span></span>  
 <span data-ttu-id="8a576-119">La sintassi [!INCLUDE[tsql](../../includes/tsql-md.md)] CREATE ASSEMBLY viene utilizzata per registrare l'assembly nel database in cui si desidera utilizzare il tipo definito dall'utente (UDT).</span><span class="sxs-lookup"><span data-stu-id="8a576-119">The [!INCLUDE[tsql](../../includes/tsql-md.md)] CREATE ASSEMBLY syntax is used to register the assembly in the database in which you wish to use the UDT.</span></span> <span data-ttu-id="8a576-120">Viene archiviata internamente nelle tabelle di sistema del database e non esternamente nel file system.</span><span class="sxs-lookup"><span data-stu-id="8a576-120">It is stored internally in database system tables, not externally in the file system.</span></span> <span data-ttu-id="8a576-121">Se il tipo definito dall'utente (UDT) dipende dagli assembly esterni, questi dovranno essere caricati nel database.</span><span class="sxs-lookup"><span data-stu-id="8a576-121">If the UDT is dependent on external assemblies, they too must be loaded into the database.</span></span> <span data-ttu-id="8a576-122">L'istruzione CREATE TYPE viene utilizzata per creare il tipo definito dall'utente (UDT) nel database in cui deve essere utilizzato.</span><span class="sxs-lookup"><span data-stu-id="8a576-122">The CREATE TYPE statement is used to create the UDT in the database in which it is to be used.</span></span> <span data-ttu-id="8a576-123">Per altre informazioni, vedere [CREATE ASSEMBLY &#40;Transact-sql&#41;](/sql/t-sql/statements/create-assembly-transact-sql) e [create Type &#40;transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="8a576-123">For more information, see [CREATE ASSEMBLY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-assembly-transact-sql) and [CREATE TYPE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span></span>  
  
### <a name="using-create-assembly"></a><span data-ttu-id="8a576-124">Utilizzo di CREATE ASSEMBLY</span><span class="sxs-lookup"><span data-stu-id="8a576-124">Using CREATE ASSEMBLY</span></span>  
 <span data-ttu-id="8a576-125">La sintassi CREATE ASSEMBLY registra l'assembly nel database in cui si desidera utilizzare il tipo definito dall'utente (UDT).</span><span class="sxs-lookup"><span data-stu-id="8a576-125">The CREATE ASSEMBLY syntax registers the assembly in the database in which you wish to use the UDT.</span></span> <span data-ttu-id="8a576-126">Dopo avere registrato l'assembly, non saranno presenti dipendenze.</span><span class="sxs-lookup"><span data-stu-id="8a576-126">Once the assembly is registered, it has no dependencies.</span></span>  
  
 <span data-ttu-id="8a576-127">Non è possibile creare più versioni dello stesso assembly in uno specifico database.</span><span class="sxs-lookup"><span data-stu-id="8a576-127">Creating multiple versions of the same assembly in a given database is not allowed.</span></span> <span data-ttu-id="8a576-128">È tuttavia possibile creare più versioni dello stesso assembly basate sulle impostazioni cultura in un database specificato.</span><span class="sxs-lookup"><span data-stu-id="8a576-128">However, it is possible to create multiple versions of the same assembly based on culture in a given database.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="8a576-129">distingue più versioni dell'impostazione cultura di un assembly dai nomi diversi come registrate nell'istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8a576-129">distinguishes multiple culture versions of an assembly by different names as registered in the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8a576-130">Per ulteriori informazioni, vedere la sezione relativa alla creazione e all'utilizzo di assembly con nome sicuro in .NET Framework SDK.</span><span class="sxs-lookup"><span data-stu-id="8a576-130">For more information, see "Creating and Using Strong-Named Assemblies" in the .NET Framework SDK.</span></span>  
  
 <span data-ttu-id="8a576-131">Quando CREATE ASSEMBLY viene eseguito con il set di autorizzazioni SAFE o EXTERNAL_ACCESS, l'assembly viene controllato per garantire che sia verificabile e indipendente dai tipi.</span><span class="sxs-lookup"><span data-stu-id="8a576-131">When CREATE ASSEMBLY is executed with the SAFE or EXTERNAL_ACCESS permission sets, the assembly is checked to make sure that it is verifiable and type safe.</span></span> <span data-ttu-id="8a576-132">Se non si specifica un set di autorizzazioni, viene utilizzato SAFE.</span><span class="sxs-lookup"><span data-stu-id="8a576-132">If you omit specifying a permission set, SAFE is assumed.</span></span> <span data-ttu-id="8a576-133">Il codice con il set di autorizzazioni UNSAFE non viene controllato.</span><span class="sxs-lookup"><span data-stu-id="8a576-133">Code with the UNSAFE permission set is not checked.</span></span> <span data-ttu-id="8a576-134">Per altre informazioni sui set di autorizzazioni per gli assembly, vedere [Progettazione di assembly](../../relational-databases/clr-integration/assemblies-designing.md).</span><span class="sxs-lookup"><span data-stu-id="8a576-134">For more information about assembly permission sets, see [Designing Assemblies](../../relational-databases/clr-integration/assemblies-designing.md).</span></span>  
  
#### <a name="example"></a><span data-ttu-id="8a576-135">Esempio</span><span class="sxs-lookup"><span data-stu-id="8a576-135">Example</span></span>  
 <span data-ttu-id="8a576-136">Nell'istruzione seguente viene [!INCLUDE[tsql](../../includes/tsql-md.md)] registrato l'assembly point in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] nel database **AdventureWorks** con il set di autorizzazioni SAFE.</span><span class="sxs-lookup"><span data-stu-id="8a576-136">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement registers the Point assembly in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] in the **AdventureWorks** database, with the SAFE permission set.</span></span> <span data-ttu-id="8a576-137">Se la clausola WITH PERMISSION_SET viene omessa, l'assembly viene registrato con il set di autorizzazioni SAFE.</span><span class="sxs-lookup"><span data-stu-id="8a576-137">If the WITH PERMISSION_SET clause is omitted, the assembly is registered with the SAFE permission set.</span></span>  
  
```  
USE AdventureWorks;  
CREATE ASSEMBLY Point  
FROM '\\ShareName\Projects\Point\bin\Point.dll'   
WITH PERMISSION_SET = SAFE;  
```  
  
 <span data-ttu-id="8a576-138">Nell'istruzione seguente viene [!INCLUDE[tsql](../../includes/tsql-md.md)] registrato l'assembly utilizzando *<assembly_bits argomento>* nella clausola from.</span><span class="sxs-lookup"><span data-stu-id="8a576-138">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement registers the assembly using *<assembly_bits>* argument in the FROM clause.</span></span> <span data-ttu-id="8a576-139">Il valore `varbinary` rappresenta il file come flusso di byte.</span><span class="sxs-lookup"><span data-stu-id="8a576-139">This `varbinary` value represents the file as a stream of bytes.</span></span>  
  
```  
USE AdventureWorks;  
CREATE ASSEMBLY Point  
FROM 0xfeac4 ... 21ac78  
```  
  
### <a name="using-create-type"></a><span data-ttu-id="8a576-140">Utilizzo di CREATE TYPE</span><span class="sxs-lookup"><span data-stu-id="8a576-140">Using CREATE TYPE</span></span>  
 <span data-ttu-id="8a576-141">Dopo avere caricato l'assembly nel database, è possibile creare il tipo utilizzando l'istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] CREATE TYPE.</span><span class="sxs-lookup"><span data-stu-id="8a576-141">Once the assembly is loaded into the database, you can then create the type using the [!INCLUDE[tsql](../../includes/tsql-md.md)] CREATE TYPE statement.</span></span> <span data-ttu-id="8a576-142">In questo modo il tipo viene aggiunto all'elenco di tipi disponibili per il database.</span><span class="sxs-lookup"><span data-stu-id="8a576-142">This adds the type to the list of available types for that database.</span></span> <span data-ttu-id="8a576-143">Il tipo viene definito nell'ambito del database e può essere utilizzato solo nel database in cui è stato creato.</span><span class="sxs-lookup"><span data-stu-id="8a576-143">The type has database scope and the type can only be used in the database in which it was created.</span></span> <span data-ttu-id="8a576-144">Se il tipo definito dall'utente (UDT) esiste già nel database, l'istruzione CREATE TYPE ha esito negativo e restituisce un errore.</span><span class="sxs-lookup"><span data-stu-id="8a576-144">If the UDT already exists in the database, the CREATE TYPE statement fails with an error.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8a576-145">La sintassi CREATE TYPE viene utilizzata anche per la creazione dei tipi di dati alias [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] nativi e deve sostituire `sp_addtype` per creare i tipi di dati alias.</span><span class="sxs-lookup"><span data-stu-id="8a576-145">The CREATE TYPE syntax is also used for creating native [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] alias data types, and is intended to replace `sp_addtype` as a means of creating alias data types.</span></span> <span data-ttu-id="8a576-146">Alcuni argomenti facoltativi nella sintassi CREATE TYPE si riferiscono alla creazione dei tipi definiti dall'utente (UDT) e non sono applicabili alla creazione dei tipi di dati alias, ad esempio il tipo di base.</span><span class="sxs-lookup"><span data-stu-id="8a576-146">Some of the optional arguments in the CREATE TYPE syntax refer to creating UDTs, and are not applicable to creating alias data types (such as base type).</span></span>  
  
 <span data-ttu-id="8a576-147">Per ulteriori informazioni, vedere [CREATE TYPE &#40;&#41;Transact-SQL ](/sql/t-sql/statements/create-type-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="8a576-147">For more information, see [CREATE TYPE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span></span>  
  
#### <a name="example"></a><span data-ttu-id="8a576-148">Esempio</span><span class="sxs-lookup"><span data-stu-id="8a576-148">Example</span></span>  
 <span data-ttu-id="8a576-149">Nell'istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] seguente viene creato il tipo `Point`.</span><span class="sxs-lookup"><span data-stu-id="8a576-149">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement creates the `Point` type.</span></span> <span data-ttu-id="8a576-150">Il nome esterno viene specificato utilizzando la sintassi di denominazione in due parti di *AssemblyName*. *NomeUDT*.</span><span class="sxs-lookup"><span data-stu-id="8a576-150">The EXTERNAL NAME is specified using the two-part naming syntax of *AssemblyName*.*UDTName*.</span></span>  
  
```  
CREATE TYPE dbo.Point   
EXTERNAL NAME Point.[Point];  
```  
  
## <a name="removing-a-udt-from-the-database"></a><span data-ttu-id="8a576-151">Rimozione di un tipo definito dall'utente (UDT) dal database</span><span class="sxs-lookup"><span data-stu-id="8a576-151">Removing a UDT from the Database</span></span>  
 <span data-ttu-id="8a576-152">L'istruzione DROP TYPE rimuove un tipo definito dall'utente (UDT) dal database corrente.</span><span class="sxs-lookup"><span data-stu-id="8a576-152">The DROP TYPE statement removes a UDT from the current database.</span></span> <span data-ttu-id="8a576-153">Dopo avere eliminato un tipo definito dall'utente (UDT), è possibile utilizzare l'istruzione DROP ASSEMBLY per eliminare l'assembly dal database.</span><span class="sxs-lookup"><span data-stu-id="8a576-153">Once a UDT is dropped, you can use the DROP ASSEMBLY statement to drop the assembly from the database.</span></span>  
  
 <span data-ttu-id="8a576-154">L'istruzione DROP TYPE non viene eseguita nelle situazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="8a576-154">The DROP TYPE statement does not execute in the following situations:</span></span>  
  
-   <span data-ttu-id="8a576-155">Tabelle del database che contengono colonne definite mediante il tipo definito dall'utente (UDT).</span><span class="sxs-lookup"><span data-stu-id="8a576-155">Tables in the database that contain columns defined using the UDT.</span></span>  
  
-   <span data-ttu-id="8a576-156">Funzioni, stored procedure o trigger che utilizzano variabili o parametri del tipo definito dall'utente (UDT), creati nel database con la clausola WITH SCHEMABINDING.</span><span class="sxs-lookup"><span data-stu-id="8a576-156">Functions, stored procedures, or triggers that use variables or parameters of the UDT, created in the database with the WITH SCHEMABINDING clause.</span></span>  
  
### <a name="example"></a><span data-ttu-id="8a576-157">Esempio</span><span class="sxs-lookup"><span data-stu-id="8a576-157">Example</span></span>  
 <span data-ttu-id="8a576-158">La seguente istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] deve essere eseguita nell'ordine indicato.</span><span class="sxs-lookup"><span data-stu-id="8a576-158">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] must execute in the following order.</span></span> <span data-ttu-id="8a576-159">È necessario eliminare prima la tabella a cui fa riferimento il tipo definito dall'utente (UDT) `Point`, quindi il tipo e infine l'assembly.</span><span class="sxs-lookup"><span data-stu-id="8a576-159">First the table which references the `Point` UDT must be dropped, then the type, and finally the assembly.</span></span>  
  
```  
DROP TABLE dbo.Points;  
DROP TYPE dbo.Point;  
DROP ASSEMBLY Point;  
```  
  
### <a name="finding-udt-dependencies"></a><span data-ttu-id="8a576-160">Ricerca di dipendenze di tipi definiti dall'utente (UDT)</span><span class="sxs-lookup"><span data-stu-id="8a576-160">Finding UDT Dependencies</span></span>  
 <span data-ttu-id="8a576-161">Se sono presenti oggetti dipendenti, ad esempio tabelle con definizioni di colonne con tipo definito dall'utente (UDT), l'istruzione DROP TYPE avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="8a576-161">If there are dependent objects, such as tables with UDT column definitions, the DROP TYPE statement fails.</span></span> <span data-ttu-id="8a576-162">L'istruzione avrà esito negativo anche se nel database sono stati creati trigger, funzioni o stored procedure mediante la clausola WITH SCHEMABINDING, e tali routine utilizzano variabili o parametri del tipo definito dall'utente (UDT).</span><span class="sxs-lookup"><span data-stu-id="8a576-162">It also fails if there are functions, stored procedures, or triggers created in the database using the WITH SCHEMABINDING clause, if these routines use variables or parameters of the user-defined type.</span></span> <span data-ttu-id="8a576-163">È necessario innanzitutto eliminare tutti gli oggetti dipendenti, quindi eseguire l'istruzione DROP TYPE.</span><span class="sxs-lookup"><span data-stu-id="8a576-163">You must first drop all dependent objects, and then execute the DROP TYPE statement.</span></span>  
  
 <span data-ttu-id="8a576-164">Nella query seguente vengono [!INCLUDE[tsql](../../includes/tsql-md.md)] individuate tutte le colonne e i parametri che utilizzano un tipo definito dall'utente nel database **AdventureWorks** .</span><span class="sxs-lookup"><span data-stu-id="8a576-164">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] query locates all of the columns and parameters that use a UDT in the **AdventureWorks** database.</span></span>  
  
```  
USE Adventureworks;  
SELECT o.name AS major_name, o.type_desc AS major_type_desc  
     , c.name AS minor_name, c.type_desc AS minor_type_desc  
     , at.assembly_class  
  FROM (  
        SELECT object_id, name, user_type_id, 'SQL_COLUMN' AS type_desc  
          FROM sys.columns  
     UNION ALL  
        SELECT object_id, name, user_type_id, 'SQL_PROCEDURE_PARAMETER'  
          FROM sys.parameters  
     ) AS c  
  JOIN sys.objects AS o  
    ON o.object_id = c.object_id  
  JOIN sys.assembly_types AS at  
    ON at.user_type_id = c.user_type_id;  
```  
  
## <a name="maintaining-udts"></a><span data-ttu-id="8a576-165">Gestione di tipi definiti dall'utente (UDT)</span><span class="sxs-lookup"><span data-stu-id="8a576-165">Maintaining UDTs</span></span>  
 <span data-ttu-id="8a576-166">Non è possibile modificare un tipo definito dall'utente (UDT) una volta creato in un database di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], sebbene sia possibile modificare l'assembly sul quale si basa il tipo.</span><span class="sxs-lookup"><span data-stu-id="8a576-166">You cannot modify a UDT once it is created in a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database, although you can alter the assembly on which the type is based.</span></span> <span data-ttu-id="8a576-167">Nella maggior parte dei casi, è necessario rimuovere il tipo definito dall'utente (UDT) dal database con l'istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] DROP TYPE, apportare le modifiche all'assembly sottostante e ricaricarlo mediante l'istruzione ALTER ASSEMBLY.</span><span class="sxs-lookup"><span data-stu-id="8a576-167">In most cases, you must remove the UDT from the database with the [!INCLUDE[tsql](../../includes/tsql-md.md)] DROP TYPE statement, make changes to the underlying assembly, and reload it using the ALTER ASSEMBLY statement.</span></span> <span data-ttu-id="8a576-168">È necessario quindi ricreare il tipo definito dall'utente (UDT) e tutti gli oggetti dipendenti.</span><span class="sxs-lookup"><span data-stu-id="8a576-168">You then need to re-create the UDT and any dependent objects.</span></span>  
  
### <a name="example"></a><span data-ttu-id="8a576-169">Esempio</span><span class="sxs-lookup"><span data-stu-id="8a576-169">Example</span></span>  
 <span data-ttu-id="8a576-170">L'istruzione ALTER ASSEMBLY viene utilizzata dopo avere apportato le modifiche al codice sorgente nell'assembly del tipo definito dall'utente (UDT) e averlo ricompilato.</span><span class="sxs-lookup"><span data-stu-id="8a576-170">The ALTER ASSEMBLY statement is used after you have made changes to the source code in your UDT assembly and recompiled it.</span></span> <span data-ttu-id="8a576-171">Il file con estensione dll viene copiato nel server e riassociato al nuovo assembly.</span><span class="sxs-lookup"><span data-stu-id="8a576-171">It copies the .dll file to the server and rebinds to the new assembly.</span></span> <span data-ttu-id="8a576-172">Per la sintassi completa, vedere [ALTER ASSEMBLY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-assembly-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="8a576-172">For the complete syntax, see [ALTER ASSEMBLY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-assembly-transact-sql).</span></span>  
  
 <span data-ttu-id="8a576-173">L'istruzione [!INCLUDE[tsql](../../includes/tsql-md.md)] ALTER ASSEMBLY seguente ricarica l'assembly Point.dll dal percorso specificato su disco.</span><span class="sxs-lookup"><span data-stu-id="8a576-173">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] ALTER ASSEMBLY statement reloads the Point.dll assembly from the specified location on disk.</span></span>  
  
```  
ALTER ASSEMBLY Point  
FROM '\\Projects\Point\bin\Point.dll'  
```  
  
### <a name="using-alter-assembly-to-add-source-code"></a><span data-ttu-id="8a576-174">Utilizzo di ALTER ASSEMBLY per aggiungere codice sorgente</span><span class="sxs-lookup"><span data-stu-id="8a576-174">Using ALTER ASSEMBLY to Add Source Code</span></span>  
 <span data-ttu-id="8a576-175">La clausola ADD FILE nella sintassi ALTER ASSEMBLY non è presente in CREATE ASSEMBLY.</span><span class="sxs-lookup"><span data-stu-id="8a576-175">The ADD FILE clause in the ALTER ASSEMBLY syntax is not present in CREATE ASSEMBLY.</span></span> <span data-ttu-id="8a576-176">È possibile utilizzarla per aggiungere codice sorgente o altri file associati a un assembly.</span><span class="sxs-lookup"><span data-stu-id="8a576-176">You can use it to add source code or any other files associated with an assembly.</span></span> <span data-ttu-id="8a576-177">I file vengono copiati dai percorsi originali e vengono archiviati nelle tabelle di sistema del database.</span><span class="sxs-lookup"><span data-stu-id="8a576-177">The files are copied from their original locations and stored in system tables in the database.</span></span> <span data-ttu-id="8a576-178">In questo modo il codice sorgente o gli altri file saranno sempre disponibili nel caso in cui sia necessario ricreare o documentare la versione corrente del tipo definito dall'utente (UDT).</span><span class="sxs-lookup"><span data-stu-id="8a576-178">This ensures that you always have source code or other files on hand should you ever need to re-create or document the current version of the UDT.</span></span>  
  
 <span data-ttu-id="8a576-179">L' [!INCLUDE[tsql](../../includes/tsql-md.md)] istruzione ALTER assembly seguente aggiunge il codice sorgente della classe Point.cs per il `Point` tipo definito dall'utente.</span><span class="sxs-lookup"><span data-stu-id="8a576-179">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] ALTER ASSEMBLY statement adds the Point.cs class source code for the `Point` UDT.</span></span> <span data-ttu-id="8a576-180">Il testo contenuto nel file Point.cs viene copiato e archiviato nel database con il nome "PointSource".</span><span class="sxs-lookup"><span data-stu-id="8a576-180">This copies the text contained in the Point.cs file and stores it in the database under the name "PointSource".</span></span>  
  
```  
ALTER ASSEMBLY Point  
ADD FILE FROM '\\Projects\Point\Point.cs' AS PointSource;  
```  
  
 <span data-ttu-id="8a576-181">Le informazioni sull'assembly vengono archiviate nella tabella **sys. assembly_files** nel database in cui è stato installato l'assembly.</span><span class="sxs-lookup"><span data-stu-id="8a576-181">Assembly information is stored in the **sys.assembly_files** table in the database where the assembly has been installed.</span></span> <span data-ttu-id="8a576-182">La tabella **sys. assembly_files** contiene le colonne seguenti.</span><span class="sxs-lookup"><span data-stu-id="8a576-182">The **sys.assembly_files** table contains the following columns.</span></span>  
  
 <span data-ttu-id="8a576-183">**assembly_id**</span><span class="sxs-lookup"><span data-stu-id="8a576-183">**assembly_id**</span></span>  
 <span data-ttu-id="8a576-184">Identificatore definito per l'assembly.</span><span class="sxs-lookup"><span data-stu-id="8a576-184">The identifier defined for the assembly.</span></span> <span data-ttu-id="8a576-185">Questo numero viene assegnato a tutti gli oggetti relativi allo stesso assembly.</span><span class="sxs-lookup"><span data-stu-id="8a576-185">This number is assigned to all objects relating to the same assembly.</span></span>  
  
 <span data-ttu-id="8a576-186">**nome**</span><span class="sxs-lookup"><span data-stu-id="8a576-186">**name**</span></span>  
 <span data-ttu-id="8a576-187">Nome dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="8a576-187">The name of the object.</span></span>  
  
 <span data-ttu-id="8a576-188">**file_id**</span><span class="sxs-lookup"><span data-stu-id="8a576-188">**file_id**</span></span>  
 <span data-ttu-id="8a576-189">Numero che identifica ogni oggetto, con il primo oggetto associato a un dato **assembly_id** a cui viene assegnato il valore 1.</span><span class="sxs-lookup"><span data-stu-id="8a576-189">A number identifying each object, with the first object associated with a given **assembly_id** being given the value of 1.</span></span> <span data-ttu-id="8a576-190">Se sono presenti più oggetti associati alla stessa **assembly_id**, ogni valore **file_id** successivo viene incrementato di 1.</span><span class="sxs-lookup"><span data-stu-id="8a576-190">If there are multiple objects associated with the same **assembly_id**, then each subsequent **file_id** value is incremented by 1.</span></span>  
  
 <span data-ttu-id="8a576-191">**content**</span><span class="sxs-lookup"><span data-stu-id="8a576-191">**content**</span></span>  
 <span data-ttu-id="8a576-192">Rappresentazione esadecimale dell'assembly o del file.</span><span class="sxs-lookup"><span data-stu-id="8a576-192">The hexadecimal representation of the assembly or file.</span></span>  
  
 <span data-ttu-id="8a576-193">È possibile utilizzare la funzione CAST o CONVERT per convertire il contenuto della colonna **contenuto** in testo leggibile.</span><span class="sxs-lookup"><span data-stu-id="8a576-193">You can use the CAST or CONVERT function to convert the contents of the **content** column to readable text.</span></span> <span data-ttu-id="8a576-194">Nella query seguente il contenuto del file Point.cs viene convertito in testo leggibile, utilizzando il nome nella clausola WHERE per limitare il set di risultati a una singola riga.</span><span class="sxs-lookup"><span data-stu-id="8a576-194">The following query converts the contents of the Point.cs file to readable text, using the name in the WHERE clause to restrict the result set to a single row.</span></span>  
  
```  
SELECT CAST(content AS varchar(8000))   
  FROM sys.assembly_files   
  WHERE name='PointSource';  
```  
  
 <span data-ttu-id="8a576-195">Se i risultati vengono copiati e incollati in un editor di testo, si noterà come le interruzioni di riga e gli spazi presenti nell'originale sono stati conservati.</span><span class="sxs-lookup"><span data-stu-id="8a576-195">If you copy and paste the results in to a text editor, you will see that the line breaks and spaces that existed in the original have been preserved.</span></span>  
  
## <a name="managing-udts-and-assemblies"></a><span data-ttu-id="8a576-196">Gestione di assembly e di tipi definiti dall'utente (UDT)</span><span class="sxs-lookup"><span data-stu-id="8a576-196">Managing UDTs and Assemblies</span></span>  
 <span data-ttu-id="8a576-197">Quando si pianifica l'implementazione di tipi definiti dall'utente (UDT), considerare quali metodi sono necessari nell'assembly del tipo definito dall'utente (UDT) stesso e quali metodi devono essere creati in assembly separati e implementati come stored procedure o funzioni definite dall'utente.</span><span class="sxs-lookup"><span data-stu-id="8a576-197">When planning your implementation of UDTs, consider which methods are needed in the UDT assembly itself, and which methods should be created in separate assemblies and implemented as user-defined functions or stored procedures.</span></span> <span data-ttu-id="8a576-198">La separazione dei metodi in assembly distinti consente di aggiornare il codice senza influire sui dati che possono essere archiviati in una colonna con tipo definito dall'utente (UDT) di una tabella.</span><span class="sxs-lookup"><span data-stu-id="8a576-198">Separating methods into separate assemblies allows you to update code without affecting data that may be stored in a UDT column in a table.</span></span> <span data-ttu-id="8a576-199">È possibile modificare gli assembly del tipo definito dall'utente (UDT) senza eliminare le colonne con tipo definito dall'utente (UDT) e gli altri oggetti dipendenti solo quando la nuova definizione può leggere i valori precedenti e la firma del tipo non viene modificata.</span><span class="sxs-lookup"><span data-stu-id="8a576-199">You can modify UDT assemblies without dropping UDT columns and other dependent objects only when the new definition can read the former values and the signature of the type does not change.</span></span>  
  
 <span data-ttu-id="8a576-200">Separando il codice procedurale che può cambiare dal codice necessario per implementare il tipo definito dall'utente (UDT) si semplifica notevolmente la manutenzione.</span><span class="sxs-lookup"><span data-stu-id="8a576-200">Separating procedural code that may change from the code required to implement the UDT greatly simplifies maintenance.</span></span> <span data-ttu-id="8a576-201">Includendo solo il codice necessario per l'utilizzo del tipo definito dall'utente (UDT) e mantenendo le definizioni del tipo definito dall'utente (UDT) il più semplice possibile, si riduce il rischio di dovere eliminare il tipo definito dall'utente (UDT) dal database per revisioni del codice o correzioni di bug.</span><span class="sxs-lookup"><span data-stu-id="8a576-201">Including only code that is necessary for the UDT to function, and keeping your UDT definitions as simple as possible, reduces the risk that the UDT itself may need to be dropped from the database for code revisions or bug fixes.</span></span>  
  
### <a name="the-currency-udt-and-currency-conversion-function"></a><span data-ttu-id="8a576-202">Funzione di conversione valuta e tipo definito dall'utente (UDT) Currency</span><span class="sxs-lookup"><span data-stu-id="8a576-202">The Currency UDT and Currency Conversion Function</span></span>  
 <span data-ttu-id="8a576-203">Il tipo definito dall'utente **Currency** nel database di esempio **AdventureWorks** fornisce un esempio utile della modalità consigliata per strutturare un tipo definito dall'utente e le funzioni associate.</span><span class="sxs-lookup"><span data-stu-id="8a576-203">The **Currency** UDT in the **AdventureWorks** sample database provides a useful example of the recommended way to structure a UDT and its associated functions.</span></span> <span data-ttu-id="8a576-204">Il tipo definito dall'utente **Currency** viene usato per gestire i costi in base al sistema monetario di determinate impostazioni cultura e consente l'archiviazione di diversi tipi di valuta, ad esempio dollari, euro e così via.</span><span class="sxs-lookup"><span data-stu-id="8a576-204">The **Currency** UDT is used for handling money based on the monetary system of a particular culture, and allows for storage of different currency types, such as dollars, euros, and so forth.</span></span> <span data-ttu-id="8a576-205">La classe del tipo definito dall'utente (UDT) espone il nome della lingua come stringa e l'importo come tipo di dati `decimal`.</span><span class="sxs-lookup"><span data-stu-id="8a576-205">The UDT class exposes a culture name as a string, and an amount of money as a `decimal` data type.</span></span> <span data-ttu-id="8a576-206">Tutti i metodi di serializzazione necessari sono contenuti all'interno dell'assembly che definisce la classe.</span><span class="sxs-lookup"><span data-stu-id="8a576-206">All of the necessary serialization methods are contained within the assembly defining the class.</span></span> <span data-ttu-id="8a576-207">La funzione che implementa la conversione di valuta da una lingua a un'altra viene implementata come funzione esterna denominata **ConvertCurrency**e questa funzione si trova in un assembly separato.</span><span class="sxs-lookup"><span data-stu-id="8a576-207">The function that implements currency conversion from one culture to another is implemented as an external function named **ConvertCurrency**, and this function is located in a separate assembly.</span></span> <span data-ttu-id="8a576-208">La funzione **ConvertCurrency** esegue le operazioni recuperando il tasso di conversione da una tabella del database **AdventureWorks** .</span><span class="sxs-lookup"><span data-stu-id="8a576-208">The **ConvertCurrency** function does its work by retrieving the conversion rate from a table in the **AdventureWorks** database.</span></span> <span data-ttu-id="8a576-209">Se l'origine dei tassi di conversione deve essere modificata o se devono essere apportate altre modifiche al codice esistente, l'assembly può essere facilmente modificato senza influire sul tipo definito dall'utente di **valuta** .</span><span class="sxs-lookup"><span data-stu-id="8a576-209">If the source of the conversion rates should ever change, or if there should be any other changes to the existing code, the assembly can be easily modified without affecting the **Currency** UDT.</span></span>  
  
 <span data-ttu-id="8a576-210">Il listato di codice per le funzioni di tipo definito dall'utente **Currency** e **ConvertCurrency** può essere trovato installando gli esempi di Common Language Runtime (CLR).</span><span class="sxs-lookup"><span data-stu-id="8a576-210">The code listing for the **Currency** UDT and **ConvertCurrency** functions can be found by installing the common language runtime (CLR) samples.</span></span>  
  
### <a name="using-udts-across-databases"></a><span data-ttu-id="8a576-211">Utilizzo di tipi definiti dall'utente (UDT) tra database</span><span class="sxs-lookup"><span data-stu-id="8a576-211">Using UDTs Across Databases</span></span>  
 <span data-ttu-id="8a576-212">I tipi definiti dall'utente (UDT) vengono definiti nell'ambito di un singolo database.</span><span class="sxs-lookup"><span data-stu-id="8a576-212">UDTs are by definition scoped to a single database.</span></span> <span data-ttu-id="8a576-213">Un tipo definito dall'utente (UDT) in un database non può pertanto essere utilizzato in una definizione di colonna di un altro database.</span><span class="sxs-lookup"><span data-stu-id="8a576-213">Therefore, a UDT defined in one database cannot be used in a column definition in another database.</span></span> <span data-ttu-id="8a576-214">Per utilizzare i tipi definiti dall'utente (UDT) in più database, è necessario eseguire le istruzioni CREATE ASSEMBLY e CREATE TYPE in ogni database in assembly identici.</span><span class="sxs-lookup"><span data-stu-id="8a576-214">In order to use UDTs in multiple databases, you must execute the CREATE ASSEMBLY and CREATE TYPE statements in each database on identical assemblies.</span></span> <span data-ttu-id="8a576-215">Gli assembly sono considerati identici se hanno nome, nome sicuro, lingua, versione, set di autorizzazioni e contenuto binario identici.</span><span class="sxs-lookup"><span data-stu-id="8a576-215">Assemblies are considered identical if they have the same name, strong name, culture, version, permission set, and binary contents.</span></span>  
  
 <span data-ttu-id="8a576-216">Dopo avere registrato e reso accessibile il tipo definito dall'utente (UDT) in entrambi database, è possibile convertire un valore UDT in un database per utilizzarlo nell'altro.</span><span class="sxs-lookup"><span data-stu-id="8a576-216">Once the UDT is registered and accessible in both databases, you can convert a UDT value from one database for use in another.</span></span> <span data-ttu-id="8a576-217">I tipi definiti dall'utente (UDT) identici possono essere utilizzati tra i database negli scenari seguenti:</span><span class="sxs-lookup"><span data-stu-id="8a576-217">Identical UDTs can be used across databases in the following scenarios:</span></span>  
  
-   <span data-ttu-id="8a576-218">Chiamata a una stored procedure definita in database diversi.</span><span class="sxs-lookup"><span data-stu-id="8a576-218">Calling stored procedure defined in different databases.</span></span>  
  
-   <span data-ttu-id="8a576-219">Esecuzione di una query su tabelle definite in database diversi.</span><span class="sxs-lookup"><span data-stu-id="8a576-219">Querying tables defined in different databases.</span></span>  
  
-   <span data-ttu-id="8a576-220">Selezione di dati del tipo definito dall'utente (UDT) da una colonna con tipo definito dall'utente (UDT) della tabella di database e inserimento di tali dati in un secondo database con una colonna con tipo definito dall'utente (UDT) identica.</span><span class="sxs-lookup"><span data-stu-id="8a576-220">Selecting UDT data from one database table UDT column and inserting it into a second database with an identical UDT column.</span></span>  
  
 <span data-ttu-id="8a576-221">In queste situazioni, la conversione richiesta dal server viene eseguita automaticamente.</span><span class="sxs-lookup"><span data-stu-id="8a576-221">In these situations, any conversion required by the server occurs automatically.</span></span> <span data-ttu-id="8a576-222">Non è possibile eseguire le conversioni in modo esplicito mediante le funzioni [!INCLUDE[tsql](../../includes/tsql-md.md)] CAST o CONVERT.</span><span class="sxs-lookup"><span data-stu-id="8a576-222">You are not able to perform the conversions explicitly using the [!INCLUDE[tsql](../../includes/tsql-md.md)] CAST or CONVERT functions.</span></span>  
  
 <span data-ttu-id="8a576-223">Si noti che non è necessario eseguire alcuna azione per l'utilizzo dei tipi definiti dall'utente durante [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] la creazione di tabelle di lavoro nel database di sistema **tempdb** .</span><span class="sxs-lookup"><span data-stu-id="8a576-223">Note that you do not need to take any action for using UDTs when [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] creates work tables in the **tempdb** system database.</span></span> <span data-ttu-id="8a576-224">Sono incluse la gestione di cursori, variabili di tabella e funzioni con valori di tabella definite dall'utente che includono tipi definiti dall'utente e che utilizzano in modo trasparente **tempdb**.</span><span class="sxs-lookup"><span data-stu-id="8a576-224">This includes the handling of cursors, table variables, and user-defined table-valued functions that include UDTs and that transparently make use of **tempdb**.</span></span> <span data-ttu-id="8a576-225">Tuttavia, se si crea in modo esplicito una tabella temporanea in **tempdb** che definisce una colonna con tipo definito dall'utente, il tipo definito dall'utente deve essere registrato in **tempdb** allo stesso modo di un database utente.</span><span class="sxs-lookup"><span data-stu-id="8a576-225">However, if you explicitly create a temporary table in **tempdb** that defines a UDT column, then the UDT must be registered in **tempdb** the same way as for a user database.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8a576-226">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="8a576-226">See Also</span></span>  
 [<span data-ttu-id="8a576-227">Tipi definiti dall'utente CLR</span><span class="sxs-lookup"><span data-stu-id="8a576-227">CLR User-Defined Types</span></span>](clr-user-defined-types.md)  
  
  
