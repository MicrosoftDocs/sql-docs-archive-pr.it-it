---
title: Trigger LOGON | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
f1_keywords:
- logon triggers
- login triggers
helpviewer_keywords:
- triggers [SQL Server], logon
ms.assetid: 2f0ebb2f-de10-482d-9806-1a5de5b312b8
author: rothja
ms.author: jroth
ms.openlocfilehash: cda0be25f07ed2ee283b9707884041e7c6e4692f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87637129"
---
# <a name="logon-triggers"></a><span data-ttu-id="4903b-102">Trigger LOGON</span><span class="sxs-lookup"><span data-stu-id="4903b-102">Logon Triggers</span></span>
  <span data-ttu-id="4903b-103">I trigger LOGON consentono di attivare stored procedure in risposta a un evento LOGON</span><span class="sxs-lookup"><span data-stu-id="4903b-103">Logon triggers fire stored procedures in response to a LOGON event.</span></span> <span data-ttu-id="4903b-104">generato quando viene stabilita una sessione utente a un'istanza di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4903b-104">This event is raised when a user session is established with an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="4903b-105">I trigger LOGON vengono attivati dopo il completamento della fase di autenticazione della procedura di accesso, ma prima che la sessione utente venga effettivamente stabilita.</span><span class="sxs-lookup"><span data-stu-id="4903b-105">Logon triggers fire after the authentication phase of logging in finishes, but before the user session is actually established.</span></span> <span data-ttu-id="4903b-106">Per questo motivo, tutti i messaggi generati all'interno del trigger che verrebbero normalmente visualizzati all'utente, come i messaggi di errore e i messaggi dall'istruzione PRINT, vengono invece indirizzati al log degli errori di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4903b-106">Therefore, all messages originating inside the trigger that would typically reach the user, such as error messages and messages from the PRINT statement, are diverted to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span> <span data-ttu-id="4903b-107">I trigger LOGON non vengono attivati in caso di esito negativo dell'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="4903b-107">Logon triggers do not fire if authentication fails.</span></span>  
  
 <span data-ttu-id="4903b-108">È possibile utilizzare i trigger LOGON per controllare e gestire le sessioni server, ad esempio tenendo traccia delle attività di accesso, limitando gli accessi a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]o limitando il numero di sessioni per uno specifico account di accesso.</span><span class="sxs-lookup"><span data-stu-id="4903b-108">You can use logon triggers to audit and control server sessions, such as by tracking login activity, restricting logins to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], or limiting the number of sessions for a specific login.</span></span> <span data-ttu-id="4903b-109">Nel codice seguente, ad esempio, il trigger LOGON nega i tentativi di accesso a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] eseguiti dall'account di accesso *login_test* se esistono già tre sessioni utente in esecuzione create da tale account di accesso.</span><span class="sxs-lookup"><span data-stu-id="4903b-109">For example, in the following code, the logon trigger denies log in attempts to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] initiated by login *login_test* if there are already three user sessions created by that login.</span></span>  
  
 [!code-sql[TriggerDDL#LogonTrigger1](../../snippets/tsql/SQL14/tsql/triggerddl/transact-sql/snippet_create_alter_drop_trigger.sql#logontrigger1)]  
  
 <span data-ttu-id="4903b-110">Si noti che l'evento LOGON corrisponde all'evento di Traccia SQL AUDIT_LOGIN, che può essere usato nelle [notifiche di eventi](../service-broker/event-notifications.md).</span><span class="sxs-lookup"><span data-stu-id="4903b-110">Note that the LOGON event corresponds to the AUDIT_LOGIN SQL Trace event, which can be used in [Event Notifications](../service-broker/event-notifications.md).</span></span> <span data-ttu-id="4903b-111">La principale differenza tra i trigger e le notifiche di eventi è il fatto che i trigger vengono attivati in modo sincrono rispetto agli eventi, mentre le notifiche di eventi sono asincrone.</span><span class="sxs-lookup"><span data-stu-id="4903b-111">The primary difference between triggers and event notifications is that triggers are raised synchronously with events, whereas event notifications are asynchronous.</span></span> <span data-ttu-id="4903b-112">Ciò significa, ad esempio, che se si desidera arrestare l'attivazione di una sessione è necessario utilizzare un trigger LOGON.</span><span class="sxs-lookup"><span data-stu-id="4903b-112">This means, for example, that if you want to stop a session from being established, you must use a logon trigger.</span></span> <span data-ttu-id="4903b-113">Non è possibile utilizzare una notifica di evento per un evento AUDIT_LOGIN a tale scopo.</span><span class="sxs-lookup"><span data-stu-id="4903b-113">An event notification on an AUDIT_LOGIN event cannot be used for this purpose.</span></span>  
  
## <a name="specifying-first-and-last-trigger"></a><span data-ttu-id="4903b-114">Impostazione del primo e ultimo trigger</span><span class="sxs-lookup"><span data-stu-id="4903b-114">Specifying First and Last Trigger</span></span>  
 <span data-ttu-id="4903b-115">È possibile definire più trigger per l'evento LOGON.</span><span class="sxs-lookup"><span data-stu-id="4903b-115">Multiple triggers can be defined on the LOGON event.</span></span> <span data-ttu-id="4903b-116">Uno qualsiasi di questi trigger può essere designato come primo o ultimo trigger da attivare per un evento usando la stored procedure di sistema [sp_settriggerorder](/sql/relational-databases/system-stored-procedures/sp-settriggerorder-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="4903b-116">Any one of these triggers can be designated the first or last trigger to be fired on an event by using the [sp_settriggerorder](/sql/relational-databases/system-stored-procedures/sp-settriggerorder-transact-sql) system stored procedure.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="4903b-117">non garantisce l'ordine di esecuzione dei trigger rimanenti.</span><span class="sxs-lookup"><span data-stu-id="4903b-117">does not guarantee the execution order of the remaining triggers.</span></span>  
  
## <a name="managing-transactions"></a><span data-ttu-id="4903b-118">Gestione delle transazioni</span><span class="sxs-lookup"><span data-stu-id="4903b-118">Managing Transactions</span></span>  
 <span data-ttu-id="4903b-119">Prima che [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] attivi un trigger LOGON, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] crea una transazione implicita indipendente da qualsiasi altra transazione utente.</span><span class="sxs-lookup"><span data-stu-id="4903b-119">Before [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] fires a logon trigger, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] creates an implicit transaction that is independent from any user transaction.</span></span> <span data-ttu-id="4903b-120">Per questo motivo, quando viene attivato il primo trigger LOGON il numero di transazioni è 1</span><span class="sxs-lookup"><span data-stu-id="4903b-120">Therefore, when the first logon trigger starts firing, the transaction count is 1.</span></span> <span data-ttu-id="4903b-121">e al termine dell'esecuzione di tutti i trigger LOGON viene eseguito il commit della transazione.</span><span class="sxs-lookup"><span data-stu-id="4903b-121">After all the logon triggers finish executing, the transaction commits.</span></span> <span data-ttu-id="4903b-122">Come per tutti gli altri tipi di trigger, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] restituisce un errore se l'esecuzione di un trigger LOGON viene completata con un numero di transazioni pari a 0.</span><span class="sxs-lookup"><span data-stu-id="4903b-122">As with other types of triggers, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] returns an error if a logon trigger finishes execution with a transaction count of 0.</span></span> <span data-ttu-id="4903b-123">L'istruzione ROLLBACK TRANSACTION reimposta il numero di transazioni su 0, anche se viene eseguita all'interno di una transazione nidificata.</span><span class="sxs-lookup"><span data-stu-id="4903b-123">The ROLLBACK TRANSACTION statement resets the transaction count to 0, even if the statement is issued inside a nested transaction.</span></span> <span data-ttu-id="4903b-124">L'istruzione COMMIT TRANSACTION potrebbe ridurre il numero di transazioni a 0.</span><span class="sxs-lookup"><span data-stu-id="4903b-124">COMMIT TRANSACTION might decrement the transaction count to 0.</span></span> <span data-ttu-id="4903b-125">È pertanto consigliabile evitare l'esecuzione di istruzioni COMMIT TRANSACTION all'interno di trigger LOGON.</span><span class="sxs-lookup"><span data-stu-id="4903b-125">Therefore, we advise against issuing COMMIT TRANSACTION statements inside logon triggers.</span></span>  
  
 <span data-ttu-id="4903b-126">Tenere presenti le considerazioni seguenti per l'utilizzo di un'istruzione ROLLBACK TRANSACTION all'interno di trigger LOGON:</span><span class="sxs-lookup"><span data-stu-id="4903b-126">Consider the following when you are using a ROLLBACK TRANSACTION statement inside logon triggers:</span></span>  
  
-   <span data-ttu-id="4903b-127">Viene eseguito il rollback di qualsiasi modifica dei dati eseguita fino al punto dell'istruzione ROLLBACK TRANSACTION.</span><span class="sxs-lookup"><span data-stu-id="4903b-127">Any data modifications made up to the point of ROLLBACK TRANSACTION are rolled back.</span></span> <span data-ttu-id="4903b-128">Sono incluse le modifiche apportate dal trigger corrente e quelle apportate da trigger precedenti eseguiti sullo stesso evento.</span><span class="sxs-lookup"><span data-stu-id="4903b-128">These modifications include those made by the current trigger and those made by previous triggers that executed on the same event.</span></span> <span data-ttu-id="4903b-129">Gli eventuali trigger rimanenti per l'evento specifico non vengono eseguiti.</span><span class="sxs-lookup"><span data-stu-id="4903b-129">Any remaining triggers for the specific event are not executed.</span></span>  
  
-   <span data-ttu-id="4903b-130">Il trigger corrente continua l'esecuzione delle istruzioni rimanenti successive all'istruzione ROLLBACK.</span><span class="sxs-lookup"><span data-stu-id="4903b-130">The current trigger continues to execute any remaining statements that appear after the ROLLBACK statement.</span></span> <span data-ttu-id="4903b-131">Se tali istruzioni modificano i dati, non viene eseguito il rollback delle modifiche eseguite.</span><span class="sxs-lookup"><span data-stu-id="4903b-131">If any of these statements modify data, the modifications are not rolled back.</span></span>  
  
 <span data-ttu-id="4903b-132">Non viene stabilita una sessione utente se si verifica una della condizioni seguenti durante l'esecuzione di un trigger per un evento LOGON:</span><span class="sxs-lookup"><span data-stu-id="4903b-132">A user session is not established if any one of the following conditions occur during execution of a trigger on a LOGON event:</span></span>  
  
-   <span data-ttu-id="4903b-133">Viene eseguito il rollback della transazione implicita originale o la transazione ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="4903b-133">The original implicit transaction is rolled back or fails.</span></span>  
  
-   <span data-ttu-id="4903b-134">Viene generato un errore con gravità maggiore di 20 all'interno del corpo del trigger.</span><span class="sxs-lookup"><span data-stu-id="4903b-134">An error that has severity greater than 20 is raised inside the trigger body.</span></span>  
  
## <a name="disabling-a-logon-trigger"></a><span data-ttu-id="4903b-135">Disabilitazione di un trigger di accesso</span><span class="sxs-lookup"><span data-stu-id="4903b-135">Disabling a Logon Trigger</span></span>  
 <span data-ttu-id="4903b-136">Un trigger di accesso può impedire le connessioni al [!INCLUDE[ssDE](../../../includes/ssde-md.md)] per tutti gli utenti, inclusi i membri del ruolo predefinito del server `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="4903b-136">A logon trigger can effectively prevent successful connections to the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] for all users, including members of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="4903b-137">Quando un trigger di accesso impedisce le connessioni, i membri del ruolo predefinito del server `sysadmin` possono connettersi tramite la connessione amministrativa dedicata o avviando il [!INCLUDE[ssDE](../../../includes/ssde-md.md)] nella modalità di configurazione minima (- f).</span><span class="sxs-lookup"><span data-stu-id="4903b-137">When a logon trigger is preventing connections, members of the `sysadmin` fixed server role can connect by using the dedicated administrator connection, or by starting the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] in minimal configuration mode (-f).</span></span> <span data-ttu-id="4903b-138">Per altre informazioni, vedere [Opzioni di avvio del servizio del motore di database](../../database-engine/configure-windows/database-engine-service-startup-options.md).</span><span class="sxs-lookup"><span data-stu-id="4903b-138">For more information, see [Database Engine Service Startup Options](../../database-engine/configure-windows/database-engine-service-startup-options.md).</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="4903b-139">Attività correlate</span><span class="sxs-lookup"><span data-stu-id="4903b-139">Related Tasks</span></span>  
  
|<span data-ttu-id="4903b-140">Attività</span><span class="sxs-lookup"><span data-stu-id="4903b-140">Task</span></span>|<span data-ttu-id="4903b-141">Argomento</span><span class="sxs-lookup"><span data-stu-id="4903b-141">Topic</span></span>|  
|----------|-----------|  
|<span data-ttu-id="4903b-142">Viene illustrato come creare trigger di accesso.</span><span class="sxs-lookup"><span data-stu-id="4903b-142">Describes how to create logon triggers.</span></span> <span data-ttu-id="4903b-143">I trigger LOGON possono essere creati da qualsiasi database, ma vengono registrati a livello del server e memorizzati nel database **master** .</span><span class="sxs-lookup"><span data-stu-id="4903b-143">Logon triggers can be created from any database, but are registered at the server level and reside in the **master** database.</span></span>|[<span data-ttu-id="4903b-144">CREATE TRIGGER &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="4903b-144">CREATE TRIGGER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-trigger-transact-sql)|  
|<span data-ttu-id="4903b-145">Viene illustrato come modificare trigger LOGON.</span><span class="sxs-lookup"><span data-stu-id="4903b-145">Describes how to modify logon triggers.</span></span>|[<span data-ttu-id="4903b-146">ALTER TRIGGER &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="4903b-146">ALTER TRIGGER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-trigger-transact-sql)|  
|<span data-ttu-id="4903b-147">Viene illustrato come eliminare trigger LOGON.</span><span class="sxs-lookup"><span data-stu-id="4903b-147">Describes how to delete logon triggers.</span></span>|[<span data-ttu-id="4903b-148">DROP TRIGGER &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="4903b-148">DROP TRIGGER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-trigger-transact-sql)|  
|<span data-ttu-id="4903b-149">Viene descritto come restituire informazioni sui trigger LOGON.</span><span class="sxs-lookup"><span data-stu-id="4903b-149">Describes how to return information about logon triggers.</span></span>|[<span data-ttu-id="4903b-150">sys.server_triggers &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="4903b-150">sys.server_triggers &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-server-triggers-transact-sql)<br /><br /> [<span data-ttu-id="4903b-151">sys.server_trigger_events &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="4903b-151">sys.server_trigger_events &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-server-trigger-events-transact-sql)|  
|<span data-ttu-id="4903b-152">Viene descritto come acquisire dati degli eventi del trigger LOGON.</span><span class="sxs-lookup"><span data-stu-id="4903b-152">Describes how to capture logon trigger event data.</span></span>||  
  
## <a name="see-also"></a><span data-ttu-id="4903b-153">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="4903b-153">See Also</span></span>  
 [<span data-ttu-id="4903b-154">Trigger DDL</span><span class="sxs-lookup"><span data-stu-id="4903b-154">DDL Triggers</span></span>](../triggers/ddl-triggers.md)  
  
  
