---
title: Campi e record di diagnostica | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- header records [ODBC]
- SQL Server Native Client ODBC driver, errors
- messages [ODBC], diagnostic records
- ODBC error handling, diagnostic records
- SQLGetDiagField function
- diagnostic records [ODBC]
- errors [ODBC], diagnostic records
- fields [ODBC]
- status information [ODBC]
ms.assetid: 4949530c-62d1-4f1a-b592-144244444ce0
author: rothja
ms.author: jroth
ms.openlocfilehash: 4fe52b211eb6d5a0e4d875264609d036702b2b0b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/04/2020
ms.locfileid: "87722783"
---
# <a name="diagnostic-records-and-fields"></a><span data-ttu-id="15686-102">Campi e record di diagnostica</span><span class="sxs-lookup"><span data-stu-id="15686-102">Diagnostic Records and Fields</span></span>
  <span data-ttu-id="15686-103">I record di diagnostica sono associati a handle descrittore, di istruzione, di connessione o di ambiente ODBC.</span><span class="sxs-lookup"><span data-stu-id="15686-103">Diagnostic records are associated with ODBC environment, connection, statement, or descriptor handles.</span></span> <span data-ttu-id="15686-104">Quando una funzione ODBC genera un codice restituito diverso da SQL_SUCCESS o SQL_INVALID_HANDLE, l'handle chiamato dalla funzione presenta record di diagnostica associati che contengono messaggi informativi o di errore.</span><span class="sxs-lookup"><span data-stu-id="15686-104">When any ODBC function raises a return code other than SQL_SUCCESS or SQL_INVALID_HANDLE, the handle called by the function has associated diagnostic records that contain informational or error messages.</span></span> <span data-ttu-id="15686-105">Questi record vengono mantenuti fino a quando non vengono eliminati per effetto di una chiamata a un'altra funzione utilizzando l'handle specifico.</span><span class="sxs-lookup"><span data-stu-id="15686-105">These records are retained until another function is called using that handle, at which time they are discarded.</span></span> <span data-ttu-id="15686-106">Non esiste un limite nel numero di record di diagnostica che possono essere associati a un handle.</span><span class="sxs-lookup"><span data-stu-id="15686-106">There is no limit to the number of diagnostic records that can be associated with a handle at any one time.</span></span>  
  
 <span data-ttu-id="15686-107">Sono disponibili due tipi di record di diagnostica, ovvero di intestazione e di stato.</span><span class="sxs-lookup"><span data-stu-id="15686-107">There are two types of diagnostic records: header and status.</span></span> <span data-ttu-id="15686-108">Il record di intestazione è il record 0, mentre gli eventuali record di stato vengono numerati a partire da 1.</span><span class="sxs-lookup"><span data-stu-id="15686-108">The header record is record 0; when there are status records, they are records 1 and later.</span></span> <span data-ttu-id="15686-109">I record di diagnostica contengono campi diversi per il record di intestazione e i record di stato.</span><span class="sxs-lookup"><span data-stu-id="15686-109">Diagnostic records contain different fields for the header record and the status records.</span></span> <span data-ttu-id="15686-110">Per i componenti ODBC possono anche essere definiti campi dei record di diagnostica specifici.</span><span class="sxs-lookup"><span data-stu-id="15686-110">ODBC components can also define their own diagnostic record fields.</span></span>  
  
 <span data-ttu-id="15686-111">I campi del record di intestazione contengono informazioni generali sull'esecuzione di una funzione, inclusi il codice restituito, il conteggio delle righe, il numero di record di stato e il tipo di istruzione eseguita.</span><span class="sxs-lookup"><span data-stu-id="15686-111">Fields in the header record contain general information about a function's execution, including the return code, row count, number of status records, and type of statement executed.</span></span> <span data-ttu-id="15686-112">Il record di intestazione viene creato sempre, a meno che una funzione ODBC non restituisca SQL_INVALID_HANDLE.</span><span class="sxs-lookup"><span data-stu-id="15686-112">The header record is always created unless an ODBC function returns SQL_INVALID_HANDLE.</span></span> <span data-ttu-id="15686-113">Per un elenco completo dei campi nel record di intestazione, vedere [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span><span class="sxs-lookup"><span data-stu-id="15686-113">For a complete list of fields in the header record, see [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span></span>  
  
 <span data-ttu-id="15686-114">I campi dei record di stato contengono informazioni su errori o avvisi specifici restituiti da Gestione driver ODBC, dal driver o dall'origine dati, quali SQLSTATE, il numero dell'errore nativo, il messaggio di diagnostica, il numero di colonna e il numero di riga.</span><span class="sxs-lookup"><span data-stu-id="15686-114">Fields in the status records contain information about specific errors or warnings returned by the ODBC Driver Manager, driver, or data source, including the SQLSTATE, native error number, diagnostic message, column number, and row number.</span></span> <span data-ttu-id="15686-115">I record di stato vengono creati solo se la funzione restituisce SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA o SQL_STILL_EXECUTING.</span><span class="sxs-lookup"><span data-stu-id="15686-115">Status records are created only if the function returns SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA, or SQL_STILL_EXECUTING.</span></span> <span data-ttu-id="15686-116">Per un elenco completo dei campi nei record di stato, vedere **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="15686-116">For a complete list of fields in the status records, see **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="15686-117">**SQLGetDiagRec** recupera un singolo record di diagnostica insieme ai campi ODBC SQLSTATE, numero di errore nativo e messaggio di diagnostica.</span><span class="sxs-lookup"><span data-stu-id="15686-117">**SQLGetDiagRec** retrieves a single diagnostic record along with its ODBC SQLSTATE, native error number, and diagnostic-message fields.</span></span> <span data-ttu-id="15686-118">Questa funzionalità è simile a ODBC 2. _x_**SQLError** (funzione).</span><span class="sxs-lookup"><span data-stu-id="15686-118">This functionality is similar to the ODBC 2._x_**SQLError** function.</span></span> <span data-ttu-id="15686-119">Funzione di gestione degli errori più semplice in ODBC 3. *x* è possibile chiamare ripetutamente **SQLGetDiagRec** a partire dal parametro *RecNumber* impostato su 1 e incrementando *RecNumber* per 1 fino a quando **SQLGetDiagRec** non restituisce SQL_NO_DATA.</span><span class="sxs-lookup"><span data-stu-id="15686-119">The simplest error-handling function in ODBC 3.*x* is to repeatedly call **SQLGetDiagRec** starting with the *RecNumber* parameter set to 1 and incrementing *RecNumber* by 1 until **SQLGetDiagRec** returns SQL_NO_DATA.</span></span> <span data-ttu-id="15686-120">Equivale a ODBC 2. applicazione *x* che chiama **SQLError** fino a quando non restituisce SQL_NO_DATA_FOUND.</span><span class="sxs-lookup"><span data-stu-id="15686-120">This is equivalent to an ODBC 2.*x* application calling **SQLError** until it returns SQL_NO_DATA_FOUND.</span></span>  
  
 <span data-ttu-id="15686-121">ODBC 3. *x* supporta molto più informazioni di diagnostica rispetto a ODBC 2. *x*.</span><span class="sxs-lookup"><span data-stu-id="15686-121">ODBC 3.*x* supports much more diagnostic information than ODBC 2.*x*.</span></span> <span data-ttu-id="15686-122">Queste informazioni vengono archiviate in campi aggiuntivi nei record di diagnostica recuperati tramite **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="15686-122">This information is stored in additional fields in diagnostic records retrieved by using **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="15686-123">Il [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] driver ODBC di Native client dispone di campi di diagnostica specifici del driver che possono essere recuperati con **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="15686-123">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver has driver-specific diagnostic fields that can be retrieved with **SQLGetDiagField**.</span></span> <span data-ttu-id="15686-124">Le etichette di questi campi specifici del driver sono definite in sqlncli.h.</span><span class="sxs-lookup"><span data-stu-id="15686-124">Labels for these driver-specific fields are defined in sqlncli.h.</span></span> <span data-ttu-id="15686-125">Utilizzarle per recuperare lo stato, il livello di gravità, il nome del server, il nome della procedura e il numero di riga di [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] associati a ogni record di diagnostica.</span><span class="sxs-lookup"><span data-stu-id="15686-125">Use these labels to retrieve the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] state, severity level, server name, procedure name, and line number associated with each diagnostic record.</span></span> <span data-ttu-id="15686-126">Inoltre, sqlncli. h contiene le definizioni dei codici utilizzati dal driver per identificare le istruzioni Transact-SQL se un'applicazione chiama **SQLGetDiagField** con *DiagIdentifier* impostato su SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span><span class="sxs-lookup"><span data-stu-id="15686-126">Also, sqlncli.h contains definitions of the codes the driver uses to identify Transact-SQL statements if an application calls **SQLGetDiagField** with *DiagIdentifier* set to SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span></span>  
  
 <span data-ttu-id="15686-127">**SQLGetDiagField** viene elaborato da Gestione driver ODBC utilizzando le informazioni sugli errori memorizzate nella cache dal driver sottostante.</span><span class="sxs-lookup"><span data-stu-id="15686-127">**SQLGetDiagField** is processed by the ODBC Driver Manager using error information it caches from the underlying driver.</span></span> <span data-ttu-id="15686-128">Gestione driver ODBC memorizza nella cache i campi di diagnostica specifici del driver solo una volta stabilita una connessione.</span><span class="sxs-lookup"><span data-stu-id="15686-128">The ODBC Driver Manager does not cache driver-specific diagnostic fields until after a successful connection has been made.</span></span> <span data-ttu-id="15686-129">**SQLGetDiagField** restituisce SQL_ERROR se viene chiamato per ottenere i campi di diagnostica specifici del driver prima che una connessione venga completata correttamente.</span><span class="sxs-lookup"><span data-stu-id="15686-129">**SQLGetDiagField** returns SQL_ERROR if it is called to get driver-specific diagnostic fields before a successful connection has been completed.</span></span> <span data-ttu-id="15686-130">Se una funzione di connessione ODBC restituisce SQL_SUCCESS_WITH_INFO, i campi di diagnostica specifici del driver della funzione non sono ancora disponibili.</span><span class="sxs-lookup"><span data-stu-id="15686-130">If an ODBC connect function returns SQL_SUCCESS_WITH_INFO, the driver-specific diagnostic fields for the connect function are not yet available.</span></span> <span data-ttu-id="15686-131">È possibile iniziare a chiamare **SQLGetDiagField** per i campi di diagnostica specifici del driver solo dopo aver eseguito un'altra chiamata di funzione ODBC dopo la funzione Connect.</span><span class="sxs-lookup"><span data-stu-id="15686-131">You can start calling **SQLGetDiagField** for driver-specific diagnostic fields only after you have made another ODBC function call after the connect function.</span></span>  
  
 <span data-ttu-id="15686-132">La maggior parte degli errori segnalati dal [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] driver ODBC di Native client può essere diagnosticata efficacemente utilizzando solo le informazioni restituite da **SQLGetDiagRec**.</span><span class="sxs-lookup"><span data-stu-id="15686-132">Most errors reported by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver can be effectively diagnosed using only the information returned by **SQLGetDiagRec**.</span></span> <span data-ttu-id="15686-133">In alcuni casi, tuttavia, le informazioni restituite dai campi di diagnostica specifici del driver sono importanti per la diagnosi di un errore.</span><span class="sxs-lookup"><span data-stu-id="15686-133">In some cases, however, the information returned by the driver-specific diagnostic fields is important in diagnosing an error.</span></span> <span data-ttu-id="15686-134">Quando si codifica un gestore degli errori ODBC per le applicazioni che utilizzano il [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] driver ODBC di Native client, è consigliabile utilizzare anche **SQLGetDiagField** per recuperare almeno i campi SQL_DIAG_SS_MSGSTATE e SQL_DIAG_SS_SEVERITY specifici del driver.</span><span class="sxs-lookup"><span data-stu-id="15686-134">When coding an ODBC error handler for applications using the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver, it is a good idea to also use **SQLGetDiagField** to retrieve at least the SQL_DIAG_SS_MSGSTATE and SQL_DIAG_SS_SEVERITY driver-specific fields.</span></span> <span data-ttu-id="15686-135">Se un determinato errore può essere generato in diverse posizioni nel codice [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], SQL_DIAG_SS_MSGSTATE indica esattamente al supporto tecnico Microsoft il punto in cui è stato generato, fornendo in tal modo un'informazione che in alcuni casi facilita la diagnosi di un problema.</span><span class="sxs-lookup"><span data-stu-id="15686-135">If a particular error can be raised at several locations in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] code, SQL_DIAG_SS_MSGSTATE indicates to a Microsoft support engineer specifically where an error was raised, which sometimes aids in diagnosing a problem.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="15686-136">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="15686-136">See Also</span></span>  
 [<span data-ttu-id="15686-137">Gestione di errori e messaggi</span><span class="sxs-lookup"><span data-stu-id="15686-137">Handling Errors and Messages</span></span>](handling-errors-and-messages.md)  
  
  
